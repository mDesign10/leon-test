/*! Copyright (c) 2019 CommonTime Ltd */

function serviceFunc(e,t,n,a,o,i,r,s){function c(e){function a(){var e=m.init();e.on("registration",function(e){t.debug("Registered for push:",e.deviceToken),n.set("notification.voipToken",e.deviceToken)}),e.on("notification",function(e){c(e)}),e.on("error",function(e){t.error(e)})}var s=function(n){if(t.debug("[notification.fct.js] Push received:",n),void 0!==e.config&&e.config.length>0){var a=i.get("ActionFactory");e.config.forEach(function(e){if("push-event"==e["item-type"]){var t={$notification:n},o=!0;e.operations.length>0&&(o=a.evalOperations(e.operations,t)),o===!0&&a.triggerEvent("push-received",e.actions,t)}})}},c=function(n){if(t.debug("[notification.fct.js] Push received:",n),void 0!==e.config&&e.config.length>0){var a=i.get("ActionFactory");e.config.forEach(function(e){if("voip-push-event"==e["item-type"]){var t={$notification:n},o=!0;e.operations.length>0&&(o=a.evalOperations(e.operations,t)),o===!0&&a.triggerEvent("voip-push-received",e.actions,t)}})}};if(void 0!==window.device&&void 0!==window.device.platform&&void 0!==e&&void 0!==e.settings&&void 0!==e.settings["push-notifications"]){var l=e.settings["push-notifications"],u={};u.android={},u.ios={badge:"true",sound:"true",alert:"true"};var d=r.getSource("PushNotification");if(d!==!1){t.debug("Registering for push notifications...");var p=d.init(u);p.on("registration",function(e){var a=e.registrationId;t.debug("Registered for push:",a),n.set("notification.token",a)}),p.on("notification",s),p.on("error",function(e){t.error("Push error:",e)})}if(l.ios.voipEnabled){var m=r.getSource("VoIPPushNotification");if(m!==!1){var g=o.getSchemaConfigItemsByItemType("chatlayer")[0];if(g){var f=g.name;document.addEventListener("base-layer-ready:"+f,function(){setTimeout(function(){a()},0)})}else a()}}}}function l(){return r.getSource("notification")!==!1}function u(e){for(var t=5381,n=0;n<e.length;n++){var a=e.charCodeAt(n);t=(t<<5)+t+a}return t}function d(){var e=r.getSource("notification");g===!1&&l()&&(e.on("interactedWith",function(e){var t=o.getSchemaConfigItemsByItemType("device-notification");if(t.length>0){var n=i.get("ActionFactory");angular.forEach(t,function(t){if(void 0!==t.name&&u(t.name)==e.id&&void 0!==t.actions&&t.actions.length>0)if(void 0===e.actionResponseIdentifier)n.triggerEvent("notification-pressed",t.actions,{$notification:e});else{var a=e.actionResponseIdentifier+"-interaction-pressed";n.triggerEvent(a,t.actions,{$notification:e})}})}}),g=!0)}function p(c){var p=e.defer();if(void 0!==c.name){var m=o.getSchemaConfigItemByName(c.name);if(void 0!==m)if("device-notification"==m["item-type"])if(l()){var g=r.getSource("notification"),f=c.title||m.title;void 0!==f&&"string"==typeof f&&f.indexOf("{{")>-1&&(f=n.parse(f)),f=s.translate(f);var v=c.text||m.text;void 0!==v&&"string"==typeof v&&v.indexOf("{{")>-1&&(v=n.parse(v)),v=s.translate(v);var h=c.name+"_category",y={id:u(c.name),title:f,text:v};if(void 0!==m.interactions&&m.interactions.length>0&&(y.category={identifier:h,actions:[]},m.interactions.forEach(function(e){var t={title:s.translate(e.label),identifier:e.name,textInput:e.text===!0};y.category.actions.push(t)})),c.options.schedule===!0&&void 0!==c.options.model){var b=n.parse(c.options.model),w=new Date(b);isNaN(w.getTime())||(y.at=w.getTime())}if(void 0!==c.options.badge){var A=parseInt(c.options.badge);isNaN(A)?console.warning("⚠️ Skipping badge count because the specified value is not a number."):y.badge=A}c.options.silent&&c.options.silent===!0&&(y.sound="SILENT"),g.core.schedule(y,null,null,{skipPermission:!0}),d(),p.resolve()}else{var S="Native notifications are not available on this platform.";t.info(S),p.reject(S)}else{var $=null;switch(m.style){case"success":case"error":case"warning":$=m.style;break;case"info":default:$="info"}if(null!==$){var x=c.title||m.title||"";angular.isString(x)===!1&&void 0!==x.toString&&(x=x.toString()),x=s.translate(x);var E=c.text||m.text||"";if(angular.isString(E)===!1&&void 0!==E.toString&&(E=E.toString()),E=s.translate(E),void 0!==m.actions&&m.actions.length>0){var T=i.get("ActionFactory");m.options.onHidden=function(e){e===!0&&T.triggerEvent("click",m.actions)}}var C=angular.copy(m.options);C.autoDismiss!==!0&&(C.timeOut=0,C.extendedTimeOut=0),C.maxOne===!0&&a.clear(),a[$](E,x,C),p.resolve()}}else p.reject("Notification with name '"+c.name+"' could not be found in app config.")}else p.reject("Notification name has not been specified.");return p.promise}var m={call:p,init:c},g=!1;return m}serviceFunc.$inject=["$q","$log","StoreFactory","toastr","SchemaHelper","$injector","Plugin","TranslationService"],function(){"use strict";function e(){return++l}function t(e){return e&&e.window===e}function n(e){return"string"==typeof e}function a(e){if(null==e||t(e))return!1;var a=e.length;return!(1!==e.nodeType||!a)||(n(e)||Array.isArray(e)||0===a||"number"==typeof a&&a>0&&a-1 in e)}function o(){return Object.create(null)}function i(t,n){var a,o=typeof t;return"function"==o||"object"==o&&null!==t?"function"==typeof(a=t.$$hashKey)?a=t.$$hashKey():void 0===a&&(a=t.$$hashKey=(n||e)()):a=t,o+":"+a}function r(e,t,n){var a,o,i=[],r=[];for(a=0;a<t.length;a++)for(o=0;o<e.length;o++)e[o][n]?e[o][n]===t[a]&&r.push(e[o]):i.push(e[o]);return r=r.concat(i)}function s(e){var t=e[0],n=e[e.length-1],a=[t];do{if(t=t.nextSibling,!t)break;a.push(t)}while(t!==n);return angular.element(a)}function c(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}var l=0,u=function(e){return e.clone[0]},d=function(e){return e.clone[e.clone.length-1]},p=function(e,t,n,a,o,i,r,s){e[n]=a,o&&(e[o]=i),e.$index=t,e.$first=0===t,e.$last=t===r-1,e.$middle=!(e.$first||e.$last),e.$odd=!(e.$even=0===(1&t)),s&&(e.$group=s)},m=function(e,t){e.data("isolateScope",t)},g=function(e,t){var n,a=e.length;if(0===a)return!1;for(n=0;n<a;n++)if(S(t,e[n]))return!0;return!1},f=function(e,t){var n,a=e.length;if(0===a)return-1;for(n=0;n<a;n++)if(S(t,e[n]))return n;return-1},v=function(e,t,n){var a,o=e,i=typeof n;if(e==t)return null;do if("string"===i){if(a=" "+o.className+" ",1===o.nodeType&&a.replace(/[\t\r\n\f]/g," ").indexOf(n)>=0)return o}else if(o==n)return o;while((o=o.parentNode)&&o!=t&&9!==o.nodeType);return null},h=function(e){var t,n=e.className.replace(/[\t\r\n\f]/g," ").trim();t=n.split(" ");for(var a=0;a<t.length;a++)/\s+/.test(t[a])&&(t.splice(a,1),a--);return t},y=function(e,t){var n=h(e);return n.indexOf(t)!==-1},b=function(e,t){var n,a,o,i=e.children(),r=i.length;if(r>0)for(var s=0;s<r;s++){if(n=i.eq(s),a=!0,o=h(n[0]),o.length>0)for(var c=0;c<t.length;c++)if(o.indexOf(t[c])===-1){a=!1;break}if(a)return n}return[]},w=function(e,t){var n,a,o;if(e.text().toLowerCase().indexOf(t.toLowerCase())!==-1)return!0;for(n=e.children(),o=n.length,a=0;a<o;a++)if(n.eq(a).text().toLowerCase().indexOf(t.toLowerCase())!==-1)return!0;return!1},A=angular.element,S=angular.equals,$=angular.copy,x=angular.extend,E=angular.module("nya.bootstrap.select",[]);E.provider("nyaBsConfig",function(){var e=null,t={"en-us":{defaultNoneSelection:"Nothing selected",noSearchResult:"NO SEARCH RESULT",numberItemSelected:"%d item selected",selectAll:"Select All",deselectAll:"Deselect All"}},n=$(t);this.setLocalizedText=function(e,t){if(!e)throw new Error("localeId must be a string formatted as languageId-countryId");n[e]||(n[e]={}),n[e]=x(n[e],t)},this.useLocale=function(t){e=t},this.$get=["$locale",function(a){var o;return o=e?n[e]:n[a.id],o||(o=t["en-us"]),o}]}),E.controller("nyaBsSelectCtrl",function(){var e=this;e.keyIdentifier=null,e.valueIdentifier=null,e.isMultiple=!1,e.onCollectionChange=function(){},e.setId=function(t){e.id=t||"id#"+Math.floor(1e4*Math.random())}}),E.directive("nyaBsSelect",["$parse","$document","$timeout","nyaBsConfig",function(e,t,n,a){var o="Nothing selected",i='<button class="btn btn-default dropdown-toggle" type="button"><span class="pull-left filter-option"></span>&nbsp;<span class="caret"></span></button>',r='<div class="dropdown-menu open"></div>',s='<div class="bs-searchbox"><input type="text" class="form-control"></div>',l='<ul class="dropdown-menu inner"></ul>',u='<li class="no-search-result"><span>NO SEARCH RESULT</span></li>',d='<div class="bs-actionsbox"><div class="btn-group btn-group-sm btn-block"><button class="actions-btn bs-select-all btn btn-default">SELECT ALL</button><button class="actions-btn bs-deselect-all btn btn-default">DESELECT ALL</button></div></div>';return{restrict:"ECA",require:["ngModel","nyaBsSelect"],controller:"nyaBsSelectCtrl",compile:function(p,m){p.addClass("btn-group");var x,E,T,C,k,F,I,L,P=function(){var e;return e=m.titleTpl?A(m.titleTpl):m.title?document.createTextNode(m.title):M.defaultNoneSelectionTpl?A(M.defaultNoneSelectionTpl):M.defaultNoneSelection?document.createTextNode(M.defaultNoneSelection):document.createTextNode(o)},_=p.children(),D=A(i),N=A(r),O=A(l),M=a,R="undefined"!=typeof m.multiple;for(C=h(p[0]),C.forEach(function(e){/btn-(?:primary|info|success|warning|danger|inverse)/.test(e)&&(p.removeClass(e),D.removeClass("btn-default"),D.addClass(e)),/btn-(?:lg|sm|xs)/.test(e)&&(p.removeClass(e),D.addClass(e)),"form-control"===e&&D.addClass(e)}),O.append(_),k=_.length,F=0;F<k;F++)I=_.eq(F),(I.hasClass("nya-bs-option")||I.attr("nya-bs-option"))&&(I.find("a").attr("tabindex","0"),L=I.attr("value"),angular.isString(L)&&""!==L&&(I.attr("data-value",L),I.removeAttr("value")));return"true"===m.liveSearch&&(x=A(s),M.noSearchResultTpl?u=u.replace("NO SEARCH RESULT",M.noSearchResultTpl):M.noSearchResult&&(u=u.replace("NO SEARCH RESULT",M.noSearchResult)),E=A(u),N.append(x),O.append(E)),"true"===m.actionsBox&&R&&(M.selectAllTpl?d=d.replace("SELECT ALL",M.selectAllTpl):M.selectAll&&(d=d.replace("SELECT ALL",M.selectAll)),M.deselectAllTpl?d=d.replace("DESELECT ALL",M.deselectAllTpl):M.selectAll&&(d=d.replace("DESELECT ALL",M.deselectAll)),T=A(d),N.append(T)),D.children().eq(0).append(P()),N.append(O),p.append(D),p.append(N),function(a,o,i,r){function s(){var e,t,n=U.children(),a=n.length;for(e=0;e<a;e++)if(t=n.eq(e),t.hasClass("active")&&t.hasClass("nya-bs-option")&&!t.hasClass("not-match"))return t;return null}function l(e){for(var t,n=e.childNodes,a=n.length,o=0;o<a;o++)if(t=n[o],1===t.nodeType&&"a"===t.tagName.toLowerCase()){t.focus();break}}function u(e){var t;t=e?U.children().eq(0):U.children().eq(U.children().length-1);for(var n=0;n<U.children().length;n++){var a=U.children().eq(n);if(!a.hasClass("not-match")&&a.hasClass("selected"))return U.children().eq(n)[0]}return!t.hasClass("nya-bs-option")||t.hasClass("disabled")||t.hasClass("not-match")?e?d(t[0],"nextSibling"):d(t[0],"previousSibling"):t[0]}function d(e,t){if(!e||y(e,"nya-bs-option")){for(var n=e;(n=c(n,t))&&n.nodeType;)if(y(n,"nya-bs-option")&&!y(n,"disabled")&&!y(n,"not-match"))return n;return null}}function p(e){if(N&&!_){var t,n,o;if(t=U.find("li"),t.length>0){n=I.$modelValue,o=Array.isArray(n)?$(n):[];for(var i=0;i<t.length;i++){var r=A(t[i]);if(!r.hasClass("disabled")){var s,c;s=h(r),"undefined"!=typeof s&&(c=f(o,s),e&&c==-1?(o.push(s),r.addClass("selected")):e||c==-1||(o.splice(c,1),r.removeClass("selected")))}}I.$setViewValue(o),a.$digest(),E()}}}function m(e){var t,n,i,r=I.$modelValue;t=h(e),"undefined"!=typeof t&&(N?(n=Array.isArray(r)?$(r):[],i=f(n,t),i===-1?(n.push(t),e.addClass("selected")):(n.splice(i,1),e.removeClass("selected"))):(U.children().removeClass("selected"),n=t,e.addClass("selected"))),S(n,r)||o.triggerHandler("change"),I.$setViewValue(n),a.$digest(),N||(o.hasClass("open")&&o.triggerHandler("blur"),o.removeClass("open")),E()}function h(e){var t;return F?(t=e.data("isolateScope"),F(t)):L.valueIdentifier||L.keyIdentifier?(t=e.data("isolateScope"),t[L.valueIdentifier]||t[L.keyIdentifier]):e.attr("data-value")}function x(e){var t=e.find("a");return 0===t.children().length||t.children().eq(0).hasClass("check-mark")?t[0].firstChild.cloneNode(!1):t.children().eq(0)[0].cloneNode(!0)}function E(){var e=I.$modelValue,t=O.children().eq(0);return"undefined"==typeof e?(t.empty(),void t.append(P())):void(N&&0===e.length?(t.empty(),t.append(P())):n(function(){var n,a,o,r,s,c,l=U.children(),u=l.length,d=[];if(N&&"count"===i.selectedTextFormat?c=1:N&&i.selectedTextFormat&&(s=i.selectedTextFormat.match(/\s*count\s*>\s*(\d+)\s*/))&&(c=parseInt(s[1],10)),"undefined"!=typeof c&&e.length>c)return t.empty(),void(M.numberItemSelectedTpl?t.append(A(M.numberItemSelectedTpl.replace("%d",e.length))):M.numberItemSelected?t.append(document.createTextNode(M.numberItemSelected.replace("%d",e.length))):t.append(document.createTextNode(e.length+" items selected")));for(o=0;o<u;o++)a=l.eq(o),a.hasClass("nya-bs-option")&&(n=h(a),N?Array.isArray(e)&&g(e,n)&&(r=a.attr("title"),r?d.push(document.createTextNode(r)):d.push(x(a))):S(e,n)&&(r=a.attr("title"),r?d.push(document.createTextNode(r)):d.push(x(a))));if(0===d.length)t.empty(),t.append(P());else if(1===d.length)t.empty(),t.append(d[0]);else for(t.empty(),o=0;o<d.length;o++)t.append(d[o]),o<d.length-1&&t.append(document.createTextNode(", "))}))}function T(){var e,t,n=U.find("li"),a=n.length;for(t=0;t<a;t++)if(e=n.eq(t),e.hasClass("nya-bs-option")||e.attr("nya-bs-option")){C=e[0].clientHeight;break}if(/\d+/.test(i.size)){var o=parseInt(i.size,10);U.css("max-height",o*C+"px"),U.css("overflow-y","auto")}}var C,k,F,I=r[0],L=r[1],_=!1,D=e(L.valueExp),N="undefined"!=typeof i.multiple,O=b(o,["dropdown-toggle"]),R=O.next(),U=b(R,["dropdown-menu","inner"]),j=b(R,["bs-searchbox"]),q=b(U,["no-search-result"]),B=b(R,["bs-actionsbox"]);L.valueExp&&(F=function(e,t){return D(e,t)}),L.setId(o.attr("id")),N&&(L.isMultiple=!0,I.$isEmpty=function(e){return!e||0===e.length}),O.on("focus",function(){_||o.triggerHandler("focus")}),"undefined"!=typeof i.disabled&&a.$watch(i.disabled,function(e){e?(O.addClass("disabled"),k=O.attr("tabindex"),O.attr("tabindex","-1"),_=!0):(O.removeClass("disabled"),k?O.attr("tabindex",k):O.removeAttr("tabindex"),_=!1)}),L.onCollectionChange=function(e){var t,n,o=[],i=I.$modelValue;if(i){if(Array.isArray(e)&&e.length>0){if(F)for(t=0;t<e.length;t++)o.push(F(a,e[t]));else for(t=0;t<e.length;t++)L.valueIdentifier?o.push(e[t][L.valueIdentifier]):L.keyIdentifier&&o.push(e[t][L.keyIdentifier]);if(N){for(n=i.length,t=0;t<i.length;t++)g(o,i[t])||(i.splice(t,1),t--);n!==i.length&&(i=$(i))}else g(o,i)||(i=o[0])}I.$setViewValue(i),E()}},U.on("click",function(e){if(e.stopPropagation(),!_&&!A(e.target).hasClass("dropdown-header")){var t,n=v(e.target,U[0],"nya-bs-option");if(null!==n){if(t=A(n),t.hasClass("disabled"))return;m(t)}}});var V=function(e){null===v(e.target,o.parent()[0],o[0])&&(o.hasClass("open")&&o.triggerHandler("blur"),o.removeClass("open"))};t.on("click",V),O.on("blur",function(){o.hasClass("open")||o.triggerHandler("blur")}),O.on("click",function(){var e;o.toggleClass("open"),o.hasClass("open")&&"undefined"==typeof C&&T(),"true"===i.liveSearch&&o.hasClass("open")?(e=u(!0),e&&(U.children().removeClass("active"),A(e).addClass("active"))):o.hasClass("open")&&(e=u(!0),e&&l(e))}),"true"===i.actionsBox&&N&&(B.find("button").eq(0).on("click",function(){p(!0)}),B.find("button").eq(1).on("click",function(){p(!1)})),"true"===i.liveSearch&&j.children().on("input",function(){var e,t,n,a=j.children().val(),o=0,i=U.children(),r=i.length;if(a){for(e=0;e<r;e++)t=i.eq(e),t.hasClass("nya-bs-option")&&(w(t.find("a"),a)?(t.removeClass("not-match"),o++):t.addClass("not-match"));0===o?q.addClass("show"):q.removeClass("show")}else{for(e=0;e<r;e++)t=i.eq(e),t.hasClass("nya-bs-option")&&t.removeClass("not-match");q.removeClass("show")}n=u(!0),n&&(i.removeClass("active"),A(n).addClass("active"))}),I.$render=function(){var e,t,n=I.$modelValue,a=U.children(),o=a.length;if("undefined"==typeof n)for(e=0;e<o;e++)a.eq(e).hasClass("nya-bs-option")&&a.eq(e).removeClass("selected");else for(e=0;e<o;e++)a.eq(e).hasClass("nya-bs-option")&&(t=h(a.eq(e)),N?g(n,t)?a.eq(e).addClass("selected"):a.eq(e).removeClass("selected"):S(n,t)?a.eq(e).addClass("selected"):a.eq(e).removeClass("selected"));E()},o.on("keydown",function(e){var t=e.keyCode;if(27===t||13===t||38===t||40===t){if(e.preventDefault(),_)return void e.stopPropagation();var n,a,r,c,p=v(e.target,o[0],O[0]);"true"===i.liveSearch?a=v(e.target,o[0],j[0]):n=v(e.target,o[0],R[0]),p?13!==t&&38!==t&&40!==t||o.hasClass("open")||(e.stopPropagation(),o.addClass("open"),"undefined"==typeof C&&T(),"true"===i.liveSearch?(j.children().eq(0)[0].focus(),c=u(!0),c&&(U.children().removeClass("active"),A(c).addClass("active"))):(c=u(!0),c&&l(c))):n?27===t?(O[0].focus(),o.hasClass("open")&&o.triggerHandler("blur"),o.removeClass("open"),e.stopPropagation()):38===t?(e.stopPropagation(),c=d(e.target.parentNode,"previousSibling"),c?l(c):(c=u(!1),c&&l(c))):40===t?(e.stopPropagation(),c=d(e.target.parentNode,"nextSibling"),c?l(c):(c=u(!0),c&&l(c))):13===t&&(e.stopPropagation(),r=A(e.target.parentNode),r.hasClass("nya-bs-option")&&(m(r),N||O[0].focus())):a&&(27===t?(O[0].focus(),o.removeClass("open"),e.stopPropagation()):38===t?(e.stopPropagation(),r=s(),r&&(c=d(r[0],"previousSibling"),c?(r.removeClass("active"),A(c).addClass("active")):(c=u(!1),c&&(r.removeClass("active"),A(c).addClass("active"))))):40===t?(e.stopPropagation(),r=s(),r&&(c=d(r[0],"nextSibling"),c?(r.removeClass("active"),A(c).addClass("active")):(c=u(!0),c&&(r.removeClass("active"),A(c).addClass("active"))))):13===t&&(r=s(),r&&(m(r),N||O[0].focus())))}}),a.$on("$destroy",function(){U.off(),O.off(),j.off(),t.off("click",V)})}}}}]),E.directive("nyaBsOption",["$parse",function(e){var t=/^\s*(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+group\s+by\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/;return{restrict:"A",transclude:"element",priority:1e3,terminal:!0,require:["^nyaBsSelect","^ngModel"],compile:function(n,c){var l=c.nyaBsOption,f=document.createComment(" end nyaBsOption: "+l+" "),v=l.match(t);if(!v)throw new Error("invalid expression");var h,y,b,w,$,x=c.value,E=x?e(x):null,T=v[3]||v[1],C=v[2],k=v[4],F=v[5]?e(v[5]):null,I=v[6],L={$id:i},P={};return I?w=e(I):(h=function(e,t){return i(t)},y=function(e){return e}),function(e,t,n,i,c){function l(e){var n,i,l,w,x,E,k,F,L,P,D,O,M,R,U,j=t[0],q=o(),B=[];if($&&(O=[]),a(e))E=e,x=b||h;else{x=b||y,E=[];for(var V in e)e.hasOwnProperty(V)&&"$"!=V.charAt(0)&&E.push(V);E.sort()}for(k=E.length,F=new Array(k),n=0;n<k;n++)if(i=e===E?n:E[n],l=e[i],w=x(i,l,n),U={},C&&(U[C]=i),U[T]=l,B.push(U),$&&(P=$(i,l),O.indexOf(P)===-1&&P&&O.push(P)),N[w])L=N[w],delete N[w],$&&(L.group=P),L.key=i,L.value=l,q[w]=L,F[n]=L;else{if(q[w])throw F.forEach(function(e){e&&e.scope&&(N[e.id]=e)}),new Error("Duplicates in a select are not allowed. Use 'track by' expression to specify unique keys.");F[n]={id:w,scope:void 0,clone:void 0,key:i,value:l},q[w]=!0,P&&(F[n].group=P)}O&&O.length>0&&(F=r(F,O,"group"));for(var G in N)L=N[G],R=s(L.clone),R.removeData("isolateScope"),R.remove(),L.scope.$destroy();for(n=0;n<k;n++)L=F[n],L.scope?(D=j,u(L)!=D&&A(j).after(L.clone),j=d(L),p(L.scope,n,T,L.value,C,L.key,k,L.group)):c(function(e,t){m(e,t),L.scope=t;var a=f.cloneNode(!1);e[e.length++]=a,A(j).after(e),e.addClass("nya-bs-option"),l=v?v(L.key,L.value):L.value||L.key,I.isMultiple?Array.isArray(_.$modelValue)&&g(_.$modelValue,l)&&e.addClass("selected"):S(l,_.$modelValue)&&e.addClass("selected"),j=a,L.clone=e,q[L.id]=L,p(L.scope,n,T,L.value,C,L.key,k,L.group)}),O&&void 0!=O&&O.length>0&&(M&&M===L.group?L.clone.removeClass("first-in-group"):L.clone.addClass("first-in-group"),M=L.group,L.clone.addClass("group-item"));N=q,I.onCollectionChange(B)}var v,I=i[0],_=i[1],D={};w&&(b=function(t,n,a){return C&&(L[C]=t),L[T]=n,L.$index=a,w(e,L)}),F&&($=function(t,n){return C&&(P[C]=t),P[T]=n,F(e,P)}),C&&(I.keyIdentifier=C),T&&(I.valueIdentifier=T),E&&(I.valueExp=x,v=function(t,n){return C&&(D[C]=t),D[T]=n,E(e,D)});var N=o();"true"===n.deepWatch?e.$watch(k,l,!0):e.$watchCollection(k,l)}}}}])}(),angular.module("angular-datepicker",[]).directive("pickADate",["$timeout",function(e){return{restrict:"A",scope:{pickADate:"=",pickADateOptions:"="},link:function(t,n){function a(n){"function"==typeof p&&p.apply(this,arguments),t.$$phase||t.$root.$$phase||e(function(){n.hasOwnProperty("clear")?t.pickADate=null:n.hasOwnProperty("select")&&(t.pickADate=c(new Date(n.select)))},0)}function o(e){"function"==typeof m&&m.apply(this,arguments)}function i(e){if("function"==typeof g&&g.apply(this,arguments),window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard){var t=function(){window.cordova.plugins.Keyboard.close(),window.removeEventListener("native.keyboardshow",this)};window.addEventListener("native.keyboardshow",t),setTimeout(function(){window.removeEventListener("native.keyboardshow",t)},500)}}function r(e){return 1===e.toString().length?"0"+e:e.toString()}function s(e){return e&&e.getUTCDate?new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),0,0,0,0):null}function c(e){return e.getFullYear()+"-"+r(e.getMonth()+1)+"-"+r(e.getDate())}function l(e){var t=null,n=/\d{4}-\d{2}-\d{2}/;return"string"==typeof e&&n.test(e)?t=n.exec(e)[0]:e instanceof Date&&(t=e.getFullYear()+"-"+r(e.getMonth()+1)+"-"+r(e.getDate())),t?s(new Date(t)):null}function u(e){var a=l(e);a?n.pickadate("picker").set("select",a):(t.pickADate=null,n.pickadate("picker").set("clear"))}var d=t.pickADateOptions||{},p=d.onSet,m=d.onOpen,g=d.onClose;d.min&&"string"==typeof d.min?"current"!==d.min&&(d.min=l(d.min)):d.min="",d.max&&"string"==typeof d.max?"current"!==d.max&&(d.max=l(d.max)):d.max="",d["default"]&&"string"==typeof d["default"]&&!t.pickADate&&("current"===d["default"]?(t.pickADate=c(new Date),t.$parent.updateStore(t.pickADate)):(t.pickADate=c(l(d["default"])),t.$parent.updateStore(t.pickADate))),d.selectYears===!0&&(d.selectYears=200),n.pickadate(angular.extend(d,{onOpen:o,onSet:a,onClose:i,container:document.body})),t.pickADate&&u(t.pickADate),t.$watch("pickADate",function(e,n){e!==n&&(u(e),t.$parent.updateStore(e))})}}}]).directive("pickATime",["$timeout",function(e){return{restrict:"A",scope:{pickATime:"=",pickATimeOptions:"="},link:function(t,n){function a(n){"function"==typeof p&&p.apply(this,arguments),t.$$phase||t.$root.$$phase||e(function(){if(n.hasOwnProperty("clear"))t.pickATime=null;else if(n.hasOwnProperty("select")){var e=n.select,a=Math.floor(e/60),o=e%60;t.pickATime=r(a)+":"+r(o)}},0)}function o(e){"function"==typeof m&&m.apply(this,arguments)}function i(e){if("function"==typeof g&&g.apply(this,arguments),window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard){var t=function(){window.cordova.plugins.Keyboard.close(),window.removeEventListener("native.keyboardshow",this)};window.addEventListener("native.keyboardshow",t),setTimeout(function(){window.removeEventListener("native.keyboardshow",t)},500)}}function r(e){return 1===e.toString().length?"0"+e:e.toString()}function s(e){return e&&e.getUTCDate?new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),0,0):null}function c(e){return r(e.getHours())+":"+r(e.getMinutes())}function l(e){var t=null,n=/\d{2}:\d{2}/;return"string"==typeof e&&n.test(e)?t=n.exec(e)[0]:e instanceof Date&&(t=r(e.getHours())+":"+r(e.getMinutes())),t?s(new Date("1970-01-01T"+t+":00Z")):null}function u(e){var a=l(e);a?n.pickatime("picker").set("select",a):(t.pickATime=null,n.pickatime("picker").set("clear"))}var d=t.pickATimeOptions||{},p=d.onSet,m=d.onOpen,g=d.onClose;d.min&&"string"==typeof d.min?"current"!==d.min&&(d.min=l(d.min)):d.min="",d.max&&"string"==typeof d.max?"current"!==d.max&&(d.max=l(d.max)):d.max="",d["default"]&&"string"==typeof d["default"]&&!t.pickATime&&("current"===d["default"]?(t.pickATime=c(new Date),t.$parent.updateStore(t.pickATime)):(t.pickATime=c(l(d["default"])),t.$parent.updateStore(t.pickATime))),n.pickatime(angular.extend(d,{onSet:a,onOpen:o,onClose:i,container:document.body})),t.pickATime&&u(t.pickATime),t.$watch("pickATime",function(e,n){e!==n&&(u(e),t.$parent.updateStore(e))})}}}]),angular.module("gettext",[]),angular.module("gettext").constant("gettext",function(e){return e}),angular.module("gettext").factory("gettextCatalog",["gettextPlurals","$http","$cacheFactory","$interpolate","$rootScope",function(e,t,n,a,o){function i(e){return void 0===e||null===e||"string"!=typeof e||0==e.trim().length}function r(){o.$broadcast("gettextLanguageChanged")}var s,c="$$noContext",l='<span id="test" title="test" class="tested">test</span>',u=angular.element("<span>"+l+"</span>").html()!==l,d=function(e){return s.debug&&s.currentLanguage!==s.baseLanguage?s.debugPrefix+e+s.debugSuffix:e},p=function(e){return s.showTranslatedMarkers?s.translatedMarkerPrefix+e+s.translatedMarkerSuffix:e};return s={debug:!1,debugPrefix:"[MISSING]: ",debugSuffix:"",showTranslatedMarkers:!1,translatedMarkerPrefix:"[",translatedMarkerSuffix:"]",strings:{},baseLanguage:"en",currentLanguage:"en",cache:n("strings"),setCurrentLanguage:function(e){this.currentLanguage=e,r()},getCurrentLanguage:function(){return this.currentLanguage},setStrings:function(e,t){this.strings[e]||(this.strings[e]={});for(var n in t){var a=t[n];if(u&&(n=angular.element("<span>"+n+"</span>").html()),angular.isString(a)||angular.isArray(a)){var o={};o[c]=a,a=o}for(var i in a){var s=a[i];a[i]=angular.isArray(s)?s:[s]}this.strings[e][n]=a}r()},getStringForm:function(e,t,n){if(i(e))return"";var a=this.strings[this.currentLanguage]||this.strings["*"]||{},o=a[e]||{},r=o[n||c]||[];return r[t]},getString:function(e,t,n){return i(e)?"":(e=this.getStringForm(e,0,n)||d(e),e=t?a(e)(t):e,p(e))},hasTranslation:function(e){var t=this.strings[this.currentLanguage]||this.strings["*"]||{};return e in t},getPlural:function(t,n,o,r,s){if(i(n))return"";var c=e(this.currentLanguage,t);return n=this.getStringForm(n,c,s)||d(1===t?n:o),r&&(r.$count=t,n=a(n)(r)),p(n)},loadRemote:function(e){return t({method:"GET",url:e,cache:s.cache}).success(function(e){for(var t in e)s.setStrings(t,e[t])})}}}]),angular.module("gettext").directive("translate",["gettextCatalog","$parse","$animate","$compile","$window",function(e,t,n,a,o){function i(e,t,n){if(!e)throw new Error("You should add a "+t+" attribute whenever you add a "+n+" attribute.")}var r=function(){return String.prototype.trim?function(e){return"string"==typeof e?e.trim():e}:function(e){return"string"==typeof e?e.replace(/^\s*/,"").replace(/\s*$/,""):e}}(),s=parseInt((/msie (\d+)/.exec(angular.lowercase(o.navigator.userAgent))||[])[1],10);return{restrict:"AE",terminal:!0,compile:function(o,c){i(!c.translatePlural||c.translateN,"translate-n","translate-plural"),i(!c.translateN||c.translatePlural,"translate-plural","translate-n");var l=r(o.html()),u=c.translatePlural,d=c.translateContext;return s<=8&&"<!--IE fix-->"===l.slice(-13)&&(l=l.slice(0,-13)),{post:function(o,i,r){function s(){var t;u?(o=p||(p=o.$new()),o.$count=c(o),t=e.getPlural(o.$count,l,u,null,d)):t=e.getString(l,null,d);var r=angular.element("<span>"+t+"</span>");a(r.contents())(o);var s=i.contents(),m=r.contents();n.enter(m,i),n.leave(s)}var c=t(r.translateN),p=null;r.translateN&&o.$watch(r.translateN,s),o.$on("gettextLanguageChanged",s),s()}}}}}]),angular.module("gettext").filter("translate",["gettextCatalog",function(e){function t(t,n){return e.getString(t,null,n)}return t.$stateful=!0,t}]),angular.module("gettext").factory("gettextPlurals",function(){return function(e,t){switch(e){case"ay":case"bo":case"cgg":case"dz":case"fa":case"id":case"ja":case"jbo":case"ka":case"kk":case"km":case"ko":case"ky":case"lo":case"ms":case"my":case"sah":case"su":case"th":case"tt":case"ug":case"vi":case"wo":case"zh":return 0;case"is":return t%10!=1||t%100==11?1:0;case"jv":return 0!=t?1:0;case"mk":return 1==t||t%10==1?0:1;case"ach":case"ak":case"am":case"arn":case"br":case"fil":case"fr":case"gun":case"ln":case"mfe":case"mg":case"mi":case"oc":case"pt_BR":case"tg":case"ti":case"tr":case"uz":case"wa":case"zh":return t>1?1:0;case"lv":return t%10==1&&t%100!=11?0:0!=t?1:2;case"lt":return t%10==1&&t%100!=11?0:t%10>=2&&(t%100<10||t%100>=20)?1:2;case"be":case"bs":case"hr":case"ru":case"sr":case"uk":return t%10==1&&t%100!=11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2;case"mnk":return 0==t?0:1==t?1:2;case"ro":return 1==t?0:0==t||t%100>0&&t%100<20?1:2;case"pl":return 1==t?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2;case"cs":case"sk":return 1==t?0:t>=2&&t<=4?1:2;case"sl":return t%100==1?1:t%100==2?2:t%100==3||t%100==4?3:0;case"mt":return 1==t?0:0==t||t%100>1&&t%100<11?1:t%100>10&&t%100<20?2:3;case"gd":return 1==t||11==t?0:2==t||12==t?1:t>2&&t<20?2:3;case"cy":return 1==t?0:2==t?1:8!=t&&11!=t?2:3;case"kw":return 1==t?0:2==t?1:3==t?2:3;case"ga":return 1==t?0:2==t?1:t<7?2:t<11?3:4;case"ar":return 0==t?0:1==t?1:2==t?2:t%100>=3&&t%100<=10?3:t%100>=11?4:5;default:return 1!=t?1:0}}}),window.cti={},angular.module("app",["app.core","app.templates"]),angular.module("cti-directives",[]),angular.module("app.core",["cti-directives","ngSanitize","ngAnimate","ngRoute","ngTouch","LocalStorageModule","vr.directives.slider","tmh.dynamicLocale","angularLoad","angles","toastr","base64","ngMessages","angular-datepicker","nya.bootstrap.select","mobile-router","ngElectron","gettext"]).config(["localStorageServiceProvider","$compileProvider","$logProvider","$sceDelegateProvider","$provide",function(e,t,n,a,o){angular.extend(window.JSON,window.JSON2),delete window.JSON2,n.debugEnabled(!1),e.setPrefix(""),t.debugInfoEnabled(!0),t.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|content|file|ms-appx|cdvfile):/),t.imgSrcSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|content|file|ms-appx|cdvfile|data):/),angular.module("cti-directives").directive=t.directive,o.decorator("$log",["$delegate","LoggingFactory",function(e,t){return t.process$log(e)}]),a.resourceUrlWhitelist(["self","cdvfile://**"])}]).run(["Router","RouterConfig","SchemaHelper","SchemaService","StoreFactory","StoreProvider","Auth","$rootScope","ActionFactory","Platform","Plugin",function(e,t,n,a,o,i,r,s,c,l,u){function d(e,t){try{e=decodeURIComponent(e);for(var n=e.split(/\?(.+)?/)[1].split("&"),a=0;a<n.length;a++){var o=n[a];if(o.indexOf(t+"=")>-1){var i=o.split(/=(.+)?/);return i[1]}}return null}catch(r){return null}}function p(e,t){try{var n;e=decodeURIComponent(e);for(var a=e.split(/\?(.+)?/)[1].split("&"),o=0;o<a.length;o++){var i=a[o],r=i.split(/=(.+)?/)[0],s=i.split(/=(.+)?/)[1];void 0!==t&&t.includes(r)||(void 0===n&&(n={}),n[r]=s)}return n}catch(c){return null}}function m(e){for(var t={},n=e.split(","),a=0;a<n.length;a++){var o=n[a],i=o.split(/=(.+)?/),r=i[0].split("."),s=i[1];s=v(s),y(t,r,0,s)}return t}function g(e){var t={},n=t;n.xcallback={};for(var a=n.xcallback,o=e.split(","),i=0;i<o.length;i++){var r=o[i],s=r.split(/=(.+)?/);a[s[0]]=s[1]}return t}function f(e,t){for(var n in t)t.hasOwnProperty(n)&&"undefined"!=typeof e[n]?f(e[n],t[n]):e[n]=t[n]}function v(e){return h(e)&&(e=parseInt(e)),e}function h(e){return!isNaN(parseFloat(e))&&isFinite(e)}function y(e,t,n,a){n<t.length-1?(e=null==e[t[n]]?e[t[n]]={}:e[t[n]],y(e,t,n+1,a)):e[t[n]]=a}function b(e){e=decodeURIComponent(e);var t=new RegExp("[a-z]\\:\\/\\/oauth\\?"),n=t.test(e),a=new RegExp("\\/oauth\\?"),o=a.test(e);return!(!n&&!o)}function w(){if(void 0===window.orientation)return"portrait";switch(window.orientation){case-90:case 90:return"landscape";default:return"portrait"}}function A(e,t){var a={};"device"===l.getType()?a={batteryLevel:t.level,isPluggedIn:t.isPlugged}:"desktop"===l.getType()&&(a={batteryLevel:100*t.level,isPluggedIn:t.charging});var o=n.getSchemaConfigItemsByItemType(e);o&&o.length>0&&c.triggerEvent(e,o[0].actions,a)}function S(){var e={};e.connectionState="online","device"===l.getType()?e.connectionType=navigator.connection.type:e.connectionType=null;var t=n.getSchemaConfigItemsByItemType("onnetworkchange");t&&t.length>0&&c.triggerEvent("onnetworkchange",t[0].actions,e)}function $(){var e={connectionState:"offline",connectionType:null},t=n.getSchemaConfigItemsByItemType("onnetworkchange");t&&t.length>0&&c.triggerEvent("onnetworkchange",t[0].actions,e)}if(void 0===window.cti.api&&(window.cti.api={}),
window.handleOpenUrlWhenReady=function(a){setTimeout(function(){if(b(a)){var r=p(a);if(null==r)return;o.set("oauth",r);var s=n.getSchemaConfigItemsByItemType("onoauthdata");s&&s.length>0&&c.triggerEvent("onoauthdata",s[0].actions,r)}else{var l=d(a,"initial_data"),u=d(a,"page"),v=d(a,"xcallback");null!=l&&(l=decodeURIComponent(l));var h=null;null!=l&&(h=m(l)),null!=v&&(v=decodeURIComponent(v));var y=null;if(null!=v&&(y=g(v)),null!=y&&(null!=h?f(h,y):h=y),null!=u){u=decodeURIComponent(u);var w=e.getCurrent();void 0!==w?(null!=h&&o.mergeInitialData(h),e.go("/"+u)):(null!=h&&i.set("initialData",h),t.set("startPage","/"+u))}else null!=h&&i.set("initialData",h);var A=p(a,["initial_data","page","xcallback"]);if(A){o.set("query",A);var S=n.getSchemaConfigItemsByItemType("onqueryparamsdata");S&&S.length>0&&c.triggerEvent("onqueryparamsdata",S[0].actions,A)}}},0)},document.addEventListener("resume",function(){s.$broadcast("device-resume");var t=e.getCurrent();(void 0!==n.schema.settings&&n.schema.settings.auth===!0||void 0!==t&&t.auth===!0)&&r.authenticate("Please re-authenticate").then(function(){})["catch"](function(){e.go("/error")});var a=n.getSchemaConfigItemsByItemType("onappresume");a&&a.length>0&&c.triggerEvent("onappresume",a[0].actions)},!1),window.addEventListener("orientationchange",function(){var e={orientation:w()};o.set("env.orientation",e.orientation);var t=n.getSchemaConfigItemsByItemType("onorientationchange");t&&t.length>0&&c.triggerEvent("onorientationchange",t[0].actions,e)},!1),o.set("env.orientation",w()),void 0!==window.mayflower&&n.getSchemaSettingByName("minimise-on-back-button")&&document.addEventListener("backbutton",function(){window.mayflower.moveTaskToBack()},!1),"device"===l.getType()&&(window.addEventListener("batterystatus",function(e){A("onbatterychange",e)},!1),window.addEventListener("batterylow",function(e){A("onbatterylow",e)},!1),window.addEventListener("batterycritical",function(e){A("onbatterycritical",e)},!1)),"desktop"===l.getType()&&navigator.getBattery().then(function(e){e.addEventListener("chargingchange",function(){A("onbatterychange",e)}),e.addEventListener("levelchange",function(){A("onbatterychange",e)})}),"device"===l.getType()&&(document.addEventListener("online",S,!1),document.addEventListener("offline",$,!1)),"desktop"===l.getType()&&(window.addEventListener("online",S),window.addEventListener("offline",$)),window.addEventListener("keyboardDidShow",function(e){var t={};t.keyboardHeight=e.keyboardHeight;var a=n.getSchemaConfigItemsByItemType("onkeyboarddidshow");a&&a.length>0&&c.triggerEvent("onkeyboarddidshow",a[0].actions,t)}),window.addEventListener("keyboardDidHide",function(){var e=n.getSchemaConfigItemsByItemType("onkeyboarddidhide");e&&e.length>0&&c.triggerEvent("onkeyboarddidhide",e[0].actions)}),window.addEventListener("keyboardWillShow",function(e){var t={};t.keyboardHeight=e.keyboardHeight;var a=n.getSchemaConfigItemsByItemType("onkeyboardwillshow");a&&a.length>0&&c.triggerEvent("onkeyboardwillshow",a[0].actions,t)}),window.addEventListener("keyboardWillHide",function(){var e=n.getSchemaConfigItemsByItemType("onkeyboardwillhide");e&&e.length>0&&c.triggerEvent("onkeyboardwillhide",e[0].actions)}),"device"===l.getType()){var x=u.getSource("StatusBar");x&&x.overlaysWebView(!1)}window.cti.appReady=!0;var E=new CustomEvent("app-core-loaded");document.dispatchEvent(E)}]),window.cti=window.cti||{},window.cti.appReady=!1,window.cti.calls=[],window.cti.debug={ngStats:function(e){if(window.hasOwnProperty("showAngularStats"))window.showAngularStats(e);else{var t=document.createElement("script");t.src="./assets/js/ng-stats.min.js",t.onload=function(){window.showAngularStats(e)},document.head.appendChild(t)}}},window.handleOpenURL=function(e){window.cti.appReady?window.handleOpenUrlWhenReady(e):window.cti.calls.push({fn:"handleOpenUrlWhenReady",args:arguments})},document.addEventListener("app-core-loaded",function(){if(window.cti&&window.cti.calls){for(var e=0;e<window.cti.calls.length;e++)!function(e){"function"==typeof window[e.fn]&&window[e.fn].apply(window,e.args)}(window.cti.calls[e]);delete window.cti.calls}});var eventMethod=window.addEventListener?"addEventListener":"attachEvent",eventer=window[eventMethod],messageEvent="attachEvent"==eventMethod?"onmessage":"message";eventer(messageEvent,function(e){e.origin===window.location.origin&&e.data&&""!==e.data&&(window.cti.appReady?window.handleOpenUrlWhenReady(e.data):window.cti.calls.push({fn:"handleOpenUrlWhenReady",args:arguments}))},!1),angular.module("app.routes",[]).config(["$routeProvider",function(e){e.when("/error",{templateUrl:"components/error/error.tpl.html"}).otherwise({redirectTo:"/"})}]),angular.module("app.core").directive("mdApp",["$rootScope","$compile","$q","$timeout","$log","SchemaService","localStorageService","StudioStorage","SchemaHelper","ActionFactory","Router","Plugin","TranslationService","$filter","ForegroundBackground","ScreenOrientation",function(e,t,n,a,o,i,r,s,c,l,u,d,p,m,g,f){return{scope:{mdApp:"@",debug:"@",json:"="},restrict:"A",compile:function(){return{pre:function(n,r){var s=!1,l=window.cordova!==!1,d=function(){i.stop(n.mdApp).then(function(){return p.init()}).then(function(){var o=c.getSchemaSettingByName("orientation");if(o)switch(o.toLowerCase()){case"portrait":f.lockOrientation(f.ORIENTATION.PORTRAIT);break;case"landscape":f.lockOrientation(f.ORIENTATION.LANDSCAPE)}u.init(),r.html("<div mobile-view></div>"),t(r.contents())(n);var s=[];e.currentLanguage&&s.push("language-"+e.currentLanguage),i.isPreview()&&s.push("cti-preview"),i.isLivePreview()&&s.push("cti-live-preview"),s.length&&window.document.body.setAttribute("class",s.join(" ")),a(function(){e.grace&&a(function(){alert("This app will expire on "+m("date")(e.grace,"short"))},500)},1e3),g.init()})["catch"](function(e){o.error(e)})};l===!0?(document.addEventListener("deviceready",function(){d(),s=!0}),a(function(){s===!1&&d()},5e3)):d()}}}}}]),angular.module("app.core").directive("mdContextProvider",function(){return{restrict:"A",scope:{item:"=mdContextProvider",items:"=mdContextItemCollection"},controller:["$scope",function(e){var t=this;e.contextState||(e.contextState={}),t.getContextItemData=function(t){var n={$item:e.item,$state:e.contextState};if(e.items){var a=e.items.indexOf(e.item);a!==-1&&(n.$index=a,n.$totalItems=e.items.length)}if(t){var o={};return o[t]=n,o}return n},t.applyContextItemData=function(e,t){angular.extend(e,this.getContextItemData(t))},t.isRepeaterContextProvider=function(){var e=t.getContextItemData();return e.hasOwnProperty("$index")}}]}}),angular.module("app.core").controller("PageController",["$scope",function(e){var t=this;t.name=e.$parent.route.id,t.meta={valid:!1}}]),angular.module("app.core").directive("pageInfo",function(){return{restrict:"A",scope:!1,controller:["$scope",function(e){return{name:e.$parent.route.id}}]}}),angular.module("app.core").directive("mdForm",function(){return{restrict:"A",require:"^form",link:function(e,t,n,a){e.$watch(function(){return a.$valid},function(t){e.$parent.page.meta.valid=t})}}}),angular.module("app.core").directive("isolateForm",[function(){return{restrict:"A",require:"?form",link:function(e,t,n,a){if(a){var o={};angular.copy(a,o);var i=t.parent().controller("form");i.$removeControl(a);var r={$setValidity:function(e,t,n){o.$setValidity(e,t,n),i.$setValidity(e,!0,a)},$setDirty:function(){t.removeClass("ng-pristine").addClass("ng-dirty"),a.$dirty=!0,a.$pristine=!1}};angular.extend(a,r)}}}}]),angular.module("app.core").directive("mdContent",["TranslationService","AssetFactory",function(e,t){return{restrict:"E",compile:function(n,a){var o=null;if("markdown"===a.itemType){var i=n.text();i=e.translate(i);var r=new window.Showdown.converter({});o=r.makeHtml(i)||""}else{var s=n.html();s=e.translate(s),o=s||""}o=t.rewriteAssetPaths(o);var c=("content-block "+(a.classes||"")).trim(),l='<div class="'+c+'">'+o+"</div>";n.html(l)}}}]),angular.module("app.core").directive("starRating",function(){return{restrict:"A",scope:{ratingValue:"=",max:"=",disabled:"=",actions:"=",onRatingSelected:"&"},template:['<ul class="rating">','   <li ng-repeat="star in stars track by $index"        ng-class="star"        ng-click="toggle($index)" ','       md-actions="{{actions}}">','       <i class="fa fa-star" ng-class="{\'star-disabled\': (disabled) }"></i>',"   </li>","</ul>"].join(""),link:function(e){function t(){e.stars=[];for(var t=0;t<e.max;t++)e.stars.push({filled:t<e.ratingValue})}e.toggle=function(t){e.disabled||(e.ratingValue=t+1,e.onRatingSelected({rating:t+1}))},e.$watch("ratingValue",function(){t()})}}}),angular.module("app.core").directive("takePhoto",["$log","StoreFactory","Camera",function(e,t,n){return{restrict:"E",require:"ngModel",scope:{imageUrl:"=",source:"@",quality:"=","disabled:":"="},template:['<div class="photo-control-container">','   <button class="btn btn-primary btn-lg">','       <span ng-if="sourceIndex == 1">',"           <span class=\"fa fa-camera\"></span> {{ 'Take Photo' | translate }}","       </span>",'       <span ng-if="sourceIndex == 2">',"           <span class=\"fa fa-picture-o\"></span> {{ 'Choose Photo' | translate }}}","       </span>","   </button>","</div>"].join(""),link:function(e,t){switch(e.imageData=null,e.quality=void 0===e.quality?75:e.quality,e.source){case"gallery":e.sourceIndex=2;break;case"camera":default:e.sourceIndex=1}e.destination=1,e.encodingType=1,t.find("button").on("click",function(){2===e.source?n.selectPhoto().then(function(t){e.loadThumbnail(t)}):n.takePhoto(e.quality).then(function(t){e.loadThumbnail(t)})}),e.loadThumbnail=function(t){e.$parent.$parent.updateStore(t),e.imageData=t},e.removePhoto=function(){e.imageData=null,e.$parent.$parent.updateStore(void 0)};var a=function(){"undefined"!=typeof e.imageUrl&&e.loadThumbnail(e.imageUrl)};document.addEventListener("deviceready",a),window.parent.document.addEventListener("deviceready",a)}}}]),angular.module("app.core").directive("takeBarcode",["$log","Plugin",function(e,t){return{restrict:"E",require:"ngModel",replace:!0,templateUrl:"components/mdDynamicForm/fields/md-barcode.tpl.html",link:function(n,a,o,i){n.codeType=o.codeType,a.on("click",function(){var a=t.getSource("barcodeScanner");a!==!1&&a.scan(function(e){var t="object"==typeof e?e.text:e;n.$parent.$parent.updateStore(t),i.$setViewValue(t)},function(t){i.$setValidity("error",!1),e.error(t)})}),n.clear=function(){n.$parent.$parent.updateStore(""),i.$setViewValue("")}}}}]),angular.module("app.core").directive("mdSignature",function(){return{restrict:"A",disabled:"=",require:"ngModel",link:function(e,t,n,a){var o=t[0],i=new window.SignaturePad(o);i.onEnd=function(){var e=i.toDataURL();a.$setViewValue(e)};var r=o.getContext("2d");if(window.devicePixelRatio){var s=o.width,c=o.height,l=s,u=c;o.setAttribute("width",s*window.devicePixelRatio),o.setAttribute("height",c*window.devicePixelRatio),t.css("width",l+"px"),t.css("height",u+"px"),r.scale(window.devicePixelRatio,window.devicePixelRatio)}void 0!=e.inputModel&&""!=e.inputModel&&i.fromDataURL(e.inputModel),e.$watch("inputModel",function(e,t){void 0==e?i.clear():e!=t&&i.fromDataURL(e)}),e.$watch("disabled",function(){e.disabled?i.off():i.on()})}}}),angular.module("app.core").directive("mdSelect",["$rootScope","StoreFactory","$parse","$filter","$timeout","OptionFactory","TranslationService",function(e,t,n,a,o,i,r){return{restrict:"A",require:"ngModel",link:function(n,s,c,l){var u=null,d=i.get(n.pageName+"."+n.name);n.options=void 0===d?n.$parent.options:d,angular.forEach(n.options,function(e){e.label=r.translate(e.label),e.hasOwnProperty("group")&&(e.group=r.translate(e.group))}),n.$parent.searchable===!0&&(u=$(s),o(function(){u.selectpicker(),u.change(function(){l.$setViewValue(u.val())})})),"undefined"!=typeof n.$parent.optionsfilter&&(n.selectionValid=function(){var e=n.$parent.inputModel,i=!1;angular.forEach(n.$parent.optionsfilter,function(e,n){var a=t.evaluate(e);"undefined"!=typeof a&&(i===!1&&(i={}),i[n]=a)});var r=!1;if(i!==!1){var s=a("filter")(n.$parent.options,i);angular.forEach(s,function(t){t.value==e&&(r=!0)})}r===!1&&(l.$setViewValue(""),null!==u&&o(function(){u.selectpicker("deselectAll").selectpicker("refresh")}))},n.calcFilter=function(){"undefined"!=typeof n.optionsfilter&&(n.filterString={},angular.forEach(n.optionsfilter,function(e,a){var o=t.evaluate(e);"undefined"!=typeof o&&(n.filterString[a]=o)}),null!==u&&o(function(){u.selectpicker("refresh")}))},e.$on("StoreChanged",function(){n.calcFilter(),n.selectionValid()}),n.calcFilter(),n.selectionValid())}}}]),angular.module("app.core").directive("mdCheckbox",["OptionFactory",function(e){return{restrict:"E",replace:!0,scope:{required:"=",options:"=",disabled:"=",name:"=",model:"=",iconSelected:"@",iconUnselected:"@",actions:"@",validators:"@"},templateUrl:"components/mdDynamicForm/fields/md-checkbox.tpl.html",require:"^form",link:function(t,n,a,o){var i=e.get(t.$parent.$parent.pageName+"."+t.$parent.name);t.options=void 0===i?t.$parent.options:i;var r=function(){var e=!0;t.required!==!0&&"true"!=t.required||(e=!1,angular.forEach(t.model,function(t){t===!0&&(e=!0)})),o[t.name].$setValidity("validationValid",e)};r(),t.makeSelection=function(e){t.disabled||(void 0==t.model&&(t.model={}),t.model[e]=!t.model[e],r())},t.getClasses=function(e){var n={};if(void 0!==e["icon-selected"]?n[e["icon-selected"]]=void 0!=t.model&&1==t.model[e.id]:n[t.iconSelected]=void 0!=t.model&&1==t.model[e.id],void 0!==e["icon-unselected"]?n[e["icon-unselected"]]=void 0===t.model||1!=t.model[e.id]:n[t.iconUnselected]=void 0==t.model||1!=t.model[e.id],1===Object.keys(n).length){var a=void 0!==n[t.iconUnselected]?t.iconUnselected:e["icon-unselected"];n[a]=!0}return n}}}}]),angular.module("app.core").directive("mdRadio",["OptionFactory",function(e){return{restrict:"E",replace:!0,scope:{required:"=",options:"=",disabled:"=",name:"=",model:"=",iconSelected:"@",iconUnselected:"@",validators:"@",actions:"@"},templateUrl:"components/mdDynamicForm/fields/md-radio.tpl.html",require:"^form",link:function(t,n,a,o){var i=e.get(t.$parent.$parent.pageName+"."+t.$parent.name);t.options=void 0===i?t.$parent.options:i;var r=function(){var e=!0;t.required!==!0&&"true"!=t.required||(e="undefined"!=typeof t.model),o[t.name].$setValidity("validationValid",e)};r(),t.makeSelection=function(e){t.disabled||(t.model=e,r())},t.getClasses=function(e){var n={};if(void 0!==e["icon-selected"]?n[e["icon-selected"]]=void 0!=t.model&&t.model==e.value:n[t.iconSelected]=void 0!=t.model&&t.model==e.value,void 0!==e["icon-unselected"]?n[e["icon-unselected"]]=void 0==t.model||t.model!=e.value:n[t.iconUnselected]=void 0==t.model||t.model!=e.value,1===Object.keys(n).length){var a=void 0!==n[t.iconUnselected]?t.iconUnselected:e["icon-unselected"];n[a]=!0}return n}}}}]),angular.module("app.core").directive("validation",["ValidationFactory","$log",function(ValidationFactory,$log){return{restrict:"A",require:"ngModel",link:function($scope,elem,attrs,ctrl){var validationObject=!1;"undefined"!=typeof attrs.validation&&""!=attrs.validation&&(validationObject=angular.fromJson(attrs.validation)),validationObject!==!1&&angular.forEach(validationObject,function(validation){if(void 0!=validation.name&&void 0!=validation.type){var validationFunction=null;if("custom"!=validation.type)validationFunction=function(e,t){return ValidationFactory.isValid(t,validation,$scope.pageName,attrs.name)};else try{var code="validationFunction = "+validation.content;eval(code)}catch(e){$log.error("Could not eval validation function code.")}null!==validationFunction&&(ctrl.$validators[validation.name]=validationFunction)}}),$scope.$on("StoreChanged",function(){angular.forEach(validationObject,function(e){void 0!=e.name&&"regex"!=e.type&&ctrl.$setValidity(e.name,ctrl.$validators[e.name](null,ctrl.$viewValue))})})}}}]),angular.module("app.core").directive("validEmail",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){var o=function(e){return a.$setValidity("email",/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)),e};a.$formatters.push(o),a.$parsers.push(o)}}}),angular.module("app.core").directive("mdGroup",["$parse","StoreFactory",function(e,t){return{scope:{name:"@",repeat:"=",classes:"@"},restrict:"E",replace:!1,transclude:!0,template:['<div id="{{name}}" class="{{ classes }}">','   <ng-transclude class="group-contents"></ng-transclude>','   <div ng-if="repeat" class="group-controls">','       <button class="btn btn-success" ng-disabled="form.$invalid" ng-click="addItem()">',"           <span class=\"icon icon-plus-circle2\"></span> {{ 'Add' | translate }}","       </button>","   </div>","</div>"].join(""),require:["^pageInfo","?form","?^mdContextProvider"],link:function(n,a,o,i){var r=i[0],s=i[1],c=i[2],l=null,u=null,d=r.name;c&&(l=c.getContextItemData("$data")),n.repeat&&s&&(n.form=s,u="repeater."+d+"."+n.name),n.addItem=function(){if(n.repeat){var o={},i=a.find("md-question");angular.forEach(i,function(n){var i=angular.element(n).attr("name"),r=angular.element(n).attr("originalname"),s=angular.element(n).attr("modellocationoverride"),c=s||r||i,u=null!==l?"$data.$item."+c:"$store.pages."+d+"."+c,p=t.getForElement(u,a),m=e(c);m.assign(o,p),t.setForElement(u,void 0,a)}),null!==u&&t.push(u,o)}}}}}]),angular.module("app.core").directive("mdList",["$rootScope","$interpolate","$parse","$filter","$routeParams","StoreFactory","ActionFactory","ListFactory",function($rootScope,$interpolate,$parse,$filter,$routeParams,StoreFactory,ActionFactory,ListFactory){return{scope:{name:"@",actions:"="},restrict:"E",replace:!1,transclude:!0,templateUrl:"components/area/mdList/mdList.tpl.html",require:["?^mdContextProvider","?^scrollableItem","^pageInfo"],link:function($scope,$element,$attrs,$ctrls){function bindFromModel(){var e=StoreFactory.getForElement(model,$element);void 0!==e&&(listDataInitialized&&angular.equals(e,oldListData)||(clearTimeout(actionTimeout),clearTimeout(scrollTimeout),listDataInitialized&&(actionTimeout=setTimeout(function(){ActionFactory.triggerEvent("data-changed",actions,{oldItems:oldListData,newItems:e})},500)),autoScroll&&scrollToBottom(),bindData(e),oldListData=angular.copy(e)))}function scrollToBottom(){scrollTimeout=scrollableItemCtrl?setTimeout(function(){scrollableItemCtrl.scrollToBottom()},0):setTimeout(function(){var e=$element[0].querySelector(".main.scrollable");e.scrollTop=e.scrollHeight},0)}function attrEquals(e,t){return($attrs[e]||"").toLowerCase()===t}function prepareListState(){var e="",t="",n=null,a=orderProperty,o=orderReverse,i=1,r=getStateFromStore();r&&(search&&r.search&&(internalSearch&&"internal"===r.search.mode?(e=r.search.criteria,t=r.search.criteria):allowExternalSearch&&r.search.mode&&(n={simple:"simple"===r.search.mode,criteria:r.search.criteria})),r.order&&r.order.property&&(a=r.order.property,o="desc"===r.order.direction),pagination&&r.pagination&&(i=r&&pagination&&r.pagination.currentPage),angular.extend($scope.search,{inputValue:e,term:t,external:n}),angular.extend($scope.order,{property:a,reverse:o})),recalculatePagination(i,!0)}function bindData(e){angular.isArray(e)||(e=[]),$scope.listData=e,pagination&&($scope.pagination.totalPages=ListFactory.calculateNumberOfPages(e.length,$scope.pagination.limit),recalculatePagination($scope.pagination.currentPage||1,!0)),listDataInitialized=!0,setStateInStore()}function recalculatePagination(e,t){if(pagination){if(e<1&&(e=1),e>$scope.pagination.totalPages&&(e=$scope.pagination.totalPages),!t&&e===$scope.pagination.currentPage)return;$scope.pagination.currentPage=e,$scope.pagination.start=(e-1)*$scope.pagination.limit,$scope.pagination.visible=pagination&&$scope.pagination.totalPages>(paginationShowOnePage?0:1),$scope.pagination.visiblePages=ListFactory.calculateVisiblePages(e,$scope.pagination.totalPages,paginationPagesToDisplay)}else $scope.pagination.currentPage=1,$scope.pagination.start=0,$scope.pagination.limit=void 0;setStateInStore()}function getStateFromStore(){return ListFactory.getListState(pageName,listName)}function setStateInStore(){listDataInitialized&&(mdContextProviderCtrl&&mdContextProviderCtrl.isRepeaterContextProvider()||(clearTimeout(storeUpdateDebounce),storeUpdateDebounce=setTimeout(function(){ListFactory.setListStateFromListScope(pageName,listName,$scope)},250)))}var mdContextProviderCtrl=$ctrls[0],scrollableItemCtrl=$ctrls[1],pageInfoCtrl=$ctrls[2],pageName=pageInfoCtrl.name,listName=$scope.name,listDataInitialized=!1,listDataFiltered=!1,storeUpdateDebounce,staticData=attrEquals("datasource","static"),dynamicData=attrEquals("datasource","dynamic"),autoScroll=attrEquals("autoscroll","true"),data=JSON.parse($attrs.data||"[]"),model=$attrs.model,search=!attrEquals("search",""),internalSearch=search&&attrEquals("search","internal"),allowExternalSearch=search&&attrEquals("search","external"),searchOnType=internalSearch&&attrEquals("searchmode","type"),searchDebounce=searchOnType&&parseInt($attrs.searchdebounce)||0,searchOnButton=internalSearch&&attrEquals("searchmode","button"),customSearch=internalSearch&&attrEquals("searchwithin","custom"),searchFunctionJs=customSearch&&$attrs.searchfunction||"",searchFunctionExternalJs=allowExternalSearch&&$attrs.searchfunctionexternal||"",customSearchFunction=null,criticalSearchError=!1,order=attrEquals("order","true"),orderProperty=order?$attrs.orderproperty||"":void 0,orderReverse=order&&attrEquals("orderdirection","desc"),pagination=attrEquals("pagination","true"),paginationItemsPerPage=pagination&&parseInt($attrs.paginationitemsperpage)||void 0,paginationShowAbove=pagination&&attrEquals("paginationabove","true"),paginationShowBelow=pagination&&attrEquals("paginationbelow","true"),paginationShowOnePage=pagination&&attrEquals("paginationshowonepage","true"),paginationPagesToDisplay=pagination&&parseInt($attrs.paginationpagestodisplay)||void 0,showFirstLast=pagination&&attrEquals("paginationfirstlast","true"),showPrevNext=pagination&&attrEquals("paginationprevnext","true"),actions=angular.copy($scope.actions);if($scope.search={enabled:search,internal:internalSearch,allowExternal:allowExternalSearch,debounce:searchDebounce,showButton:searchOnButton,buttonIcon:$attrs.searchbuttonicon,buttonLabel:$attrs.searchbuttonlabel,inputValue:"",term:"",external:null},$scope.order={property:orderProperty,reverse:orderReverse},$scope.pagination={enabled:pagination,showAbove:paginationShowAbove,showBelow:paginationShowBelow,showFirstLast:showFirstLast,showPrevNext:showPrevNext,firstPageIcon:$attrs.paginationfirsticon,prevPageIcon:$attrs.paginationprevicon,nextPageIcon:$attrs.paginationnexticon,lastPageIcon:$attrs.paginationlasticon,firstPageLabel:$attrs.paginationfirstlabel,prevPageLabel:$attrs.paginationprevlabel,nextPageLabel:$attrs.paginationnextlabel,lastPageLabel:$attrs.paginationlastlabel,limit:paginationItemsPerPage,currentPage:1,start:0},prepareListState(),$scope.classes=$attrs.classes,$scope.listItemClasses=$attrs.listItemClasses,"bootstrap"===$attrs.theme&&($scope.classes=(($scope.classes||"")+" list-group").trim(),$scope.listItemClasses=(($scope.listItemClasses||"")+" list-group-item").trim()),$scope.itemTrackFn=function(e,t){return JSON.stringify(e)+"_"+t+"_"+$scope.listData.length},$scope.listOrder=function(e){return void 0===$scope.order.property?"":""===$scope.order.property?e:$parse($scope.order.property)(e)},$scope.filter=function(item){if(criticalSearchError)return!1;if(!search)return!0;if(internalSearch){if(!$scope.search.term)return!0;if(!customSearch)return $filter("filter")([item],$scope.search.term).length>0;if(null===customSearchFunction){if(!searchFunctionJs)throw criticalSearchError=!0,'List "'+$scope.name+'" on page "'+pageInfoCtrl.name+'" does not have a custom search function defined for built-in search.';eval("customSearchFunction = "+searchFunctionJs)}if("function"==typeof customSearchFunction)return customSearchFunction($scope.search.term||"",item)}else if(allowExternalSearch&&$scope.search.external){if($scope.search.external.simple)return $filter("filter")([item],$scope.search.external.criteria).length>0;if(null===customSearchFunction){if(!searchFunctionExternalJs)throw criticalSearchError=!0,'List "'+$scope.name+'" on page "'+pageInfoCtrl.name+'" does not have a custom search function defined for search actions.';eval("customSearchFunction = "+searchFunctionExternalJs)}if("function"==typeof customSearchFunction)return customSearchFunction($scope.search.external.criteria||{},item)}return!0},$scope.performSearch=function(e){internalSearch&&(searchOnButton||e===!0)&&ListFactory.setListSearchState(pageName,listName,"internal",$scope.search.inputValue,!0)},$scope.goToPage=function(e){pagination&&ListFactory.setListPaginationState(pageName,listName,e)},$scope.itemCssClass=function(e,t){if(!$scope.listItemClasses)return"";if($scope.listItemClasses.indexOf("\\{")===-1)return $scope.listItemClasses;var n=$scope.listItemClasses.replace(/\\{/g,"{"),a={$data:{$item:e,$index:t,$items:$scope.listData}};return $interpolate(n)(a)},$scope.$watch("filteredListData.length",function(e,t){if(!listDataFiltered||e!==t){$scope.pagination.totalPages=ListFactory.calculateNumberOfPages(e,$scope.pagination.limit);var n=Math.min($scope.pagination.currentPage,$scope.pagination.totalPages);recalculatePagination(n,!0),listDataFiltered=!0}}),searchOnType&&$scope.$watch("search.inputValue",function(){$scope.performSearch(!0)}),autoScroll&&scrollToBottom(),staticData===!0&&data)bindData(data);else if(dynamicData===!0&&model){var actionTimeout=null,scrollTimeout=null,oldListData=null;bindFromModel(),$scope.$on("StoreChanged",bindFromModel)}var unsubscribe=$rootScope.$on("UpdateList_"+pageInfoCtrl.name+"_"+$scope.name,prepareListState);$scope.$on("$destory",function(){unsubscribe()})},controller:["$scope",function(e){var t=this;t.getListScope=function(){return e}}]}}]),angular.module("app.core").directive("mdListItem",["ActionFactory",function(e){return{restrict:"A",require:["^mdList","mdContextProvider"],translude:!0,link:function(t,n,a,o,i){var r=o[0],s=o[1];i(function(t,a){s.applyContextItemData(a,"$data");var o=r.getListScope(),i=o.actions;n.on("click",function(t){if((!t.srcElement||["A","INPUT","BUTTON","TEXTAREA","SELECT"].indexOf(t.srcElement.tagName)===-1)&&i&&i.length){var n=s.getContextItemData();e.triggerEvent("click",i,n)}}),n.on("$destroy",function(){a.$destroy()}),n.append(t)})}}}]),angular.module("app.core").directive("mdTitle",["TranslationService","AssetFactory",function(e,t){return{restrict:"E",compile:function(n,a){var o=n.html();o=e.translate(o),o=t.rewriteAssetPaths(o);var i=(a.classes||"").trim(),r='<div class="'+i+'">'+o+"</div>";n.html(r)}}}]),angular.module("app.core").directive("mdQuestion",["$http","$rootScope","$parse","$filter","$timeout","SchemaService","$templateCache","$log","StoreFactory","ActionFactory","TranslationService",function(e,t,n,a,o,i,r,s,c,l,u){return{scope:{name:"@",itemType:"@",id:"@",label:"@",placeholder:"@",message:"@","default":"@",validators:"=",show:"@",disabled:"@",required:"@",model:"@",description:"@","extends":"=",leftIcon:"@",rightIcon:"@",classes:"@",options:"=",optionsfilter:"=",searchable:"=",maxlength:"@",multiline:"=",debounce:"=",content:"@",max:"@",min:"@",dual:"=",step:"@",actions:"=",optionSource:"@",labelProperty:"@",valueProperty:"@",groupProperty:"@",onText:"@",offText:"@",vertical:"=",iconSelected:"@",iconUnselected:"@",displayValue:"=",decimals:"@"},restrict:"E",template:["<div id=\"{{ name }}\" ng-if=\"show\" class=\"form-group item-{{itemType}} {{classes}}\" ng-class=\"{'has-error': (form[name].$invalid === true && showValidations()), 'has-success': (form[name].$invalid === false && showValidations()), 'no-error': (type == 'static')}\">",'   <label class="control-label">','       {{label | translate}} <span class="required-asterix fa fa-star" ng-if="required == \'true\' && form[name].$invalid === true"></span>',"   </label>",'   <p class="description" ng-if="description">{{description | translate}}</p>','   <div ng-include="templateUrl"></div>','   <div ng-show="form[name].$invalid === true && showValidations()" ng-messages="form[name].$error">','       <div class="form-input-error" ng-message="required">','           <span class="fa fa-times"></span> {{message | translate}}',"       </div>",'       <div class="form-input-error" ng-message="email">','           <span class="fa fa-times"></span> {{defaultMessage | translate}}',"       </div>",'       <div class="form-input-error" ng-repeat="validation in validators" ng-message-exp="validation.name">','           <span class="fa fa-times"></span> {{validation.message | translate}}',"       </div>","   </div>","</div>"].join(""),require:["^pageInfo","^form","?^mdContextProvider"],link:function(e,t,n,a){function o(e){if("number"==typeof e||"boolean"==typeof e)return!1;if("undefined"==typeof e||null===e)return!0;if("undefined"!=typeof e.length)return 0==e.length;var t=0;for(var n in e)e.hasOwnProperty(n)&&t++;return 0==t}function i(e){if(!n)return!1;if(!n.mdExpressions)return!1;var t=JSON.parse(n.mdExpressions);return t.hasOwnProperty(e)}var r=a[0],s=a[1],d=a[2];e.setTemplate=function(){switch(e.itemType){case"select":e.templateUrl="components/mdDynamicForm/fields/templates/select.tpl.html",e.defaultMessage="Please make a selection";break;case"radio":e.templateUrl="components/mdDynamicForm/fields/templates/radio.tpl.html",e.defaultMessage="Please make a selection";break;case"checkbox":e.templateUrl="components/mdDynamicForm/fields/templates/checkbox.tpl.html",e.defaultMessage="Please make a selection";break;case"date":e.templateUrl="components/mdDynamicForm/fields/templates/date.tpl.html",e.defaultMessage="Please provide a valid date";break;case"time":e.templateUrl="components/mdDynamicForm/fields/templates/time.tpl.html",e.defaultMessage="Please provide a valid time";break;case"datetime":e.templateUrl="components/mdDynamicForm/fields/templates/datetime.tpl.html",e.defaultMessage="Please provide a valid date & time";break;case"number":e.templateUrl="components/mdDynamicForm/fields/templates/number.tpl.html",e.defaultMessage="Please provide a number";break;case"email":e.templateUrl="components/mdDynamicForm/fields/templates/email.tpl.html",e.defaultMessage="Please provide a valid email address";break;case"slider":e.dual?e.templateUrl="components/mdDynamicForm/fields/templates/range-slider.tpl.html":e.templateUrl="components/mdDynamicForm/fields/templates/slider.tpl.html",e.defaultMessage="Please choose a value";break;case"rating":e.templateUrl="components/mdDynamicForm/fields/templates/rating.tpl.html",e.defaultMessage="Please provide a rating";break;case"barcode":e.templateUrl="components/mdDynamicForm/fields/templates/barcode.tpl.html",e.defaultMessage="Please capture the barcode";break;case"qrcode":e.templateUrl="components/mdDynamicForm/fields/templates/qrcode.tpl.html",e.defaultMessage="Please capture the QR code";break;case"signature":e.templateUrl="components/mdDynamicForm/fields/templates/signature.tpl.html",e.defaultMessage="Please provide your signature";break;case"switch":e.templateUrl="components/mdDynamicForm/fields/templates/switch.tpl.html",e.defaultMessage="Please make a selection";break;case"password":e.templateUrl="components/mdDynamicForm/fields/templates/password.tpl.html",e.defaultMessage="This is a required field";break;case"text":e.multi=void 0!=e.multiline&&e.multiline,e.templateUrl="components/mdDynamicForm/fields/templates/text.tpl.html",e.defaultMessage="This is a required field";break;default:void 0!==e["extends"]&&(e.type=e["extends"].type,e.itemType=e["extends"]["item-type"],e.setTemplate())}},e.message="undefined"!=typeof e.message?e.message:e.defaultMessage,e.form=s,e.pageName=r?r.name:"";var p=d?"$data.$item.":"$store.pages."+e.pageName+".",m=n.modellocationoverride||n.originalname||e.name;if(e.key=p+m,e.setTemplate(),e.inputModel=c.getForElement(e.key,t),e.updateStore=function(n){
c.setForElement(e.key,n,t)},e.$watch("inputModel",function(t,n){if(t!==n){e.updateStore(t);var a=["checkbox","radio","rating","smiley","thumbs","signature","barcode","record-audio"];a.indexOf(e.itemType)!==-1&&l.triggerEvent("change",e.actions)}},!0),void 0===e.inputModel&&void 0!==e["default"]&&!i("default")){var g=u.translate(e["default"]);e.updateStore(g),e.inputModel=g}e.disabled=void 0!=e.disabled&&e.disabled,e.required=void 0!=e.required&&e.required,e.show=void 0==e.show||e.show,e.search=void 0!=e.search&&e.search,e.evalModel=function(){void 0!=e.model&&(e.inputModel=c.evaluateForElement(e.model,t))},e.userInput=function(){void 0!==s[e.name]&&s[e.name].$setTouched(!0)},e.evalModel(),e.$on("StoreChanged",function(){e.evalModel()}),e.$watch(function(){return c.getForElement(e.key,t)},function(t){e.inputModel=t,void 0!==e.form[e.name]&&(e.form[e.name].$pristine=!1)},!0),"select"==e.itemType&&void 0!=e.optionSource&&e.$watchCollection(function(){return c.getForElement(e.optionSource,t)},function(t){var n=[];void 0!=e.labelProperty||void 0!=e.valueProperty||void 0!=e.groupValue?angular.forEach(t,function(t){var a={value:void 0!=e.valueProperty?t[e.valueProperty]:t.value,label:void 0!=e.labelProperty?t[e.labelProperty]:t.label,group:void 0!=e.groupProperty?t[e.groupProperty]:t.group};n.push(a)}):n=t,e.options=n}),e.showValidations=function(){return!o(e.inputModel)||e.form[e.name].$pristine===!1}}}}]),angular.module("app.core").directive("numberFormat",["$filter",function(e){return{restrict:"A",require:"ngModel",link:function(t,n,a,o){var i=parseInt(a.decimalPlaces);isNaN(i)===!1&&(o.$formatters.push(function(t){var n=parseFloat(t);if(isNaN(n)!==!0)return void 0!==t&&(t=e("number")(t,i),t=parseFloat(t.replace(",",""))),o.$setViewValue(t),t}),o.$parsers.push(function(e){if(void 0!==e&&null!==e){var t=e.toString(),n=t.split(".");if(void 0!==n[1]&&n[1].length>i)return o.$setViewValue(o.$modelValue),o.$render(),o.$modelValue}return e}))}}}]),angular.module("app.core").directive("mdComponent",["$rootScope","$timeout","ComponentFactory",function(e,t,n){return{restrict:"E",scope:{instanceId:"@"},require:["?^mdContextProvider"],link:function(t,a,o,i){var r=i[0],s=null,c=!1,l=n.getComponentById(t.instanceId);if(null!==l){var u=l.element;if(r){var d=r.getContextItemData();if(s={$data:d},void 0!==d.$index){u=l.element.cloneNode(!0);var p=u.getAttribute("id");u.setAttribute("id",p+"_"+d.$index),c=!0}}var m=a.children().length>0;if(m){var g=Array.prototype.slice.call(u.childNodes);l.processed!==!0&&(l.dynamicChildrenStartIndex=g.length);for(var f=l.dynamicChildrenStartIndex;f<g.length;f++)u.removeChild(g[f]);angular.forEach(a.children(),function(e){var t=a[0].removeChild(e);u.appendChild(t)})}n.setUpComponentAttributes(l,u,s,!0),a.replaceWith(u),e.$on("StoreChanged",function(){n.setUpComponentAttributes(l,u,s,!1)}),(c||l.processed!==!0)&&(setTimeout(function(){n.setUpComponentBindings(l,t)},0),l.processed=!0)}}}}]),angular.module("app.core").directive("mdChart",["$compile","StoreFactory",function(e,t){return{restrict:"E",scope:{title:"@","default":"=",model:"@",classes:"@"},link:function(n,a,o){var i={"line-chart":"Line","bar-chart":"Bar","doughnut-chart":"Doughnut","pie-chart":"Pie","polar-area-chart":"PolarArea","radar-chart":"Radar"};if(n.chartType=i[o.itemType],n.model){var r=t.getForElement(n.model,a);r&&(n.data=r),n.$watch(function(){return t.getForElement(n.model,a)},function(e,t){e!==t&&(n.data=e)})}else n.data=n["default"];var s=['<div class="chart-block {{ classes }}">','   <h4 ng-if="title">{{ title | translate }}</h4>','   <div class="md-chart-container">','       <canvas chart="{{ chartType }}" data="data" responsive="true"></canvas>',"   </div>","</div>"].join(""),c=e(s)(n);a.replaceWith(c)}}}]),angular.module("app.core").directive("mdGoogleMap",["GoogleMapService","StoreFactory","ActionFactory","DirectiveBridge","$log",function(e,t,n,a,o){return{restrict:"E",replace:!0,scope:{actions:"=",lat:"@",lng:"@",zoom:"@",maptype:"@",zoomcontrol:"@",streetviewcontrol:"@",maptypecontrol:"@",fullscreencontrol:"@",rotatecontrol:"@",scalecontrol:"@",traffic:"=",transit:"=",bicycling:"=",classes:"@",name:"@","static":"@",data:"@",model:"@",styles:"@",expose:"@",exposedproperty:"@",draggable:"@",scrollwheel:"@",doubleclick:"@"},template:'<div class="google-map {{classes}} " id="{{name}}" style="position: relative;" ></div>',controller:["$scope","$element","SchemaHelper",function(i,r,s){function c(){var t=s.schema.settings.mapping?s.schema.settings.mapping.googleMapsAPIKey:void 0;e.requestGoogleMapsScript(t).then(function(t){var n=!1;if(!t&&google&&google.maps){var a=new google.maps.Map(r[0],{zoom:parseInt(i.zoom),center:{lat:parseFloat(i.lat),lng:parseFloat(i.lng)},mapTypeId:i.maptype,zoomControl:"true"==i.zoomcontrol,streetViewControl:"true"==i.streetviewcontrol,mapTypeControl:"true"==i.maptypecontrol,fullscreenControl:"true"==i.fullscreencontrol,rotateControl:"true"==i.rotatecontrol,scaleControl:"true"==i.scalecontrol,draggable:"true"==i.draggable,scrollwheel:"true"==i.scrollwheel,disableDoubleClickZoom:"true"!=i.doubleclick,styles:JSON.parse(i.styles||"[]")});S.map=a,l(S),A(S.map,i.actions),e.registerResize(a),r.on("$destroy",function(){e.unregisterResize(a)}),google.maps.event.addListener(a,"tilesloaded",function(){n=!0,google.maps.event.clearListeners(a,"tilesloaded"),u(r[0]),google.maps.event.trigger(a,"resize")}),setTimeout(function(){n||d(r[0])},5e3),i.traffic&&(S.trafficLayer=S.trafficLayer||new google.maps.TrafficLayer,S.trafficLayer.setMap(S.map)),i.transit&&(S.transitLayer=S.transitLayer||new google.maps.TransitLayer,S.transitLayer.setMap(S.map)),i.bicycling&&(S.bicyclingLayer=S.bicyclingLayer||new google.maps.BicyclingLayer,S.bicyclingLayer.setMap(S.map)),"true"==i["static"]?p(JSON.parse(i.data||"[]")):i.model&&m(),"true"==i.expose&&(window.cti.maps||(window.cti.maps={}),window.cti.maps[i.exposedproperty]=S.map)}else d(r[0])})}function l(e){var t=r.controller("pageInfo").name;a.registerItemApi(t,i.name,{setMapLayers:function(t,n){var a;switch(t){case"traffic":a=e.trafficLayer||new google.maps.TrafficLayer,e.trafficLayer=a;break;case"transit":a=e.transitLayer||new google.maps.TransitLayer,e.transitLayer=a;break;case"bicycling":a=e.bicyclingLayer||new google.maps.BicyclingLayer,e.bicyclingLayer=a;break;default:return!1}return n?a.setMap(e.map):a.setMap(null),!0},setMapTypeId:function(t){e.map.setMapTypeId(t)},setLocation:function(t,n,a,o){o?e.map.panTo({lat:t,lng:n}):e.map.setCenter({lat:t,lng:n}),a&&e.map.setZoom(a)},setControls:function(t,n){switch(t){case"zoom":e.map.setOptions({zoomControl:n});break;case"maptype":e.map.setOptions({mapTypeControl:n});break;case"scale":e.map.setOptions({scaleControl:n});break;case"streetview":e.map.setOptions({streetViewControl:n});break;case"rotate":e.map.setOptions({rotateControl:n});break;case"fullscreen":e.map.setOptions({fullscreenControl:n});break;default:return!1}return!0}})}function u(e){var t=e.querySelector("div.google-map-failed");t&&t.parentNode.removeChild(t)}function d(e){var t=document.createElement("div");t.classList.add("google-map-failed"),t.innerHTML="<p>Map has failed to load, click to reload</p>",t.addEventListener("click",function(){c()}),e.appendChild(t)}function p(e){for(;S.overlays[0];)S.overlays.pop().setMap(null);e&&"[object Array]"===Object.prototype.toString.call(e)&&$.each(e,function(e,t){switch(t.type){case void 0:break;case"marker":v(t);break;case"polygon":y(t);break;case"polyline":b(t);break;case"heatmap":h(t);break;case"directions":g(t)}})}function m(){i.$watchCollection(function(){return t.get(i.model)},function(e){p(e)})}function g(e){var t={$schema:"http://json-schema.org/draft-04/schema#",type:"object",properties:{data:{type:"object",properties:{origin:{type:"string"},destination:{type:"string"},travelMode:{type:"string"},renderer:{type:"object",properties:{preserveViewport:{type:"boolean"},draggable:{type:"boolean"}},required:[],additionalProperties:!1},drivingOptions:{type:"object",properties:{departureTime:{type:"string",format:"date-time"}},required:[]}},required:["origin","destination"]},type:{type:"string",pattern:"^directions$"}},required:["data","type"]};if(w(e,t)){var n=angular.copy(e.data);delete n.renderer;var a=angular.copy(e.data.renderer||{});a.map=S.map,n.drivingOptions&&angular.isString(n.drivingOptions.departureTime)&&(n.drivingOptions.departureTime=new Date(n.drivingOptions.departureTime)),n.drivingOptions&&angular.isString(n.drivingOptions.arrivalTime)&&(n.drivingOptions.arrivalTime=new Date(n.drivingOptions.arrivalTime)),n.transitOptions&&angular.isString(n.transitOptions.departureTime)&&(n.transitOptions.departureTime=new Date(n.transitOptions.departureTime)),n.transitOptions&&angular.isString(n.transitOptions.arrivalTime)&&(n.transitOptions.arrivalTime=new Date(n.transitOptions.arrivalTime));var o=new google.maps.DirectionsRenderer(a);S.overlays.push(o);var i=new google.maps.DirectionsService;i.route(n,function(e,t){"OK"==t&&o.setDirections(e)})}}function f(e){var t={$schema:"http://json-schema.org/draft-04/schema#",type:"object",properties:{type:{type:"string",pattern:"^marker$"},data:{type:"object",properties:{position:{type:"object",properties:{lat:{type:"number",minimum:-90,maximum:90},lng:{type:"number",minimum:-180,maximum:180}},required:["lat","lng"],additionalProperties:!1},icon:{type:"string"},infoWindow:{type:"object",properties:{showOn:{type:"string"},content:{type:"string"}},required:["showOn","content"],additionalProperties:!1},clickable:{type:"boolean"},crossOnDrag:{type:"boolean"},cursor:{type:"string"},draggable:{type:"boolean"},label:{type:"string"},opacity:{type:"number",minimum:0,maximum:1},optimized:{type:"boolean"},place:{type:"object",properties:{location:{type:"object",properties:{lat:{type:"number",minimum:-90,maximum:90},lng:{type:"number",minimum:-180,maximum:180}}},placeId:{type:"string"},query:{type:"string"}},required:["location"],additionalProperties:!1},title:{type:"string"},visible:{type:"boolean"},zIndex:{type:"number"}},required:["position"]}},required:["type","data"]};if(!w(e,t))return null;var n=angular.copy(e.data);delete n.infoWindow;var a=new google.maps.Marker(n);if(e.data.infoWindow){var o=new google.maps.InfoWindow({content:e.data.infoWindow.content});"click"===e.data.infoWindow.showOn&&a.addListener("click",function(){o.open(S.map,a)}),"load"===e.data.infoWindow.showOn&&o.open(S.map,a)}return a}function v(e){var t=f(e);null!=t&&(t.setMap(S.map),S.overlays.push(t))}function h(e){var t={$schema:"http://json-schema.org/draft-04/schema#",type:"object",properties:{type:{type:"string",pattern:"^heatmap$"},data:{type:"array",items:{type:"object",properties:{lat:{type:"number",minimum:-90,maximum:90},lng:{type:"number",minimum:-180,maximum:180},weight:{type:"number",minimum:0}},required:["lat","lng"],additionalProperties:!1}},dissipating:{type:"boolean"},gradient:{type:"array",items:{type:"string"}},maxIntensity:{type:"number"},opacity:{type:"number"},radius:{type:"number"}},required:["type","data"],additionalProperties:!1};if(w(e,t)){var n=angular.copy(e.data),a=[];for(var o in n)a.push({location:new google.maps.LatLng(n[o].lat,n[o].lng),weight:n[o].weight||1});var i=new google.maps.visualization.HeatmapLayer({data:a});i.setMap(S.map),S.overlays.push(i)}}function y(e){var t={$schema:"http://json-schema.org/draft-04/schema#",type:"object",properties:{type:{type:"string",pattern:"^polygon$"},data:{type:"object",properties:{paths:{type:"array",items:{type:"object",properties:{lat:{type:"number",minimum:-90,maximum:90},lng:{type:"number",minimum:-180,maximum:180}},required:["lat","lng"],additionalProperties:!1}},strokeColor:{type:"string"},strokeOpacity:{type:"number"},strokeWeight:{type:"number"},fillColor:{type:"string"},fillOpacity:{type:"number"},clickable:{type:"boolean"},draggable:{type:"boolean"},editable:{type:"boolean"},geodesic:{type:"boolean"},visible:{type:"boolean"},zIndex:{type:"number"}},required:["paths"]}},required:["type","data"]};if(w(e,t)){var n=new google.maps.Polygon(e.data);n.setMap(S.map),S.overlays.push(n)}}function b(e){var t={$schema:"http://json-schema.org/draft-04/schema#",type:"object",properties:{type:{type:"string",pattern:"^polyline$"},data:{type:"object",properties:{path:{type:"array",items:{type:"object",properties:{lat:{type:"number",minimum:-90,maximum:90},lng:{type:"number",minimum:-180,maximum:180}},required:["lat","lng"],additionalProperties:!1}},strokeColor:{type:"string"},geodesic:{type:"boolean"},strokeOpacity:{type:"number"},clickable:{"type:":"boolean"},draggable:{"type:":"boolean"},editable:{"type:":"boolean"},strokeWeight:{"type:":"number"},visible:{"type:":"boolean"},zIndex:{"type:":"number"}},required:["paths"]}},required:["type","data"],additionalProperties:!1};if(w(e,t)){var n=new google.maps.Polyline(e.data);n.setMap(S.map),S.overlays.push(n)}}function w(e,t){var n=window.tv4.validate(e,t);return n||o.error("Google maps item validation failed: "+window.tv4.error.message+" "+window.tv4.error.dataPath),n}function A(e,t){e.addListener("center_changed",function(){n.triggerEvent("map-moved",t,{lat:e.getCenter().lat(),lng:e.getCenter().lng()})}),e.addListener("click",function(e){n.triggerEvent("map-clicked",t,{lat:e.latLng.lat(),lng:e.latLng.lng()})}),e.addListener("mousemove",function(e){n.triggerEvent("map-mouse-move",t,{lat:e.latLng.lat(),lng:e.latLng.lng()})}),e.addListener("rightclick",function(e){n.triggerEvent("map-right-clicked",t,{lat:e.latLng.lat(),lng:e.latLng.lng()})}),e.addListener("zoom_changed",function(){n.triggerEvent("map-zoom-changed",t,{zoom:e.getZoom()})}),e.addListener("tilesloaded",function(){n.triggerEvent("map-tiles-loaded",t,{})}),e.addListener("idle",function(){n.triggerEvent("map-idle",t,{})})}var S=this;S.overlays=[],S.trafficLayer=null,S.bicyclingLayer=null,S.trafficLayer=null,S.transitLayer=null,c()}]}}]),angular.module("app.core").directive("mdCustom",["$http","$templateCache","$log",function(e,t,n){return{scope:{name:"@",url:"@",data:"="},restrict:"E",template:'<div id="{{name}}" ng-if="show" class="form-group"><div ng-include="templateUrl"></div></div>',link:function(a,o,i){a.show=!0,"undefined"!=typeof i.url&&(void 0===t.get(i.url)&&e.get(i.url).then(function(e){t.put(i.url,e.data)},function(){n.error('Could not load specified template URL "'+i.url+'": '),i.show=a.show=!1}),a.templateUrl=i.url)}}}]),angular.module("app.core").directive("mdSlider",["$timeout",function(e){return{restrict:"E",scope:{required:"=",name:"=",model:"=",min:"@",max:"@",step:"@",validators:"@",disabled:"=",actions:"="},template:['<slider ng-model="modelValue" ','        ng-disabled="disabled" ','        validation="{{validators}}" ','        md-actions="{{actions}}" ','        ng-swipe-left="cancelSwipe($event)" ','        ng-swipe-right="cancelSwipe($event)" ','        floor="{{min}}" ','        ceiling="{{max}}" ','        step="{{step}}">',"</slider>",'<input type="hidden" ng-model="model" md-actions="{{actions}}" name="{{name}}" ng-required="required" />'].join(""),require:"^form",link:function(t,n,a,o){angular.isObject(t.model)&&(t.modelValue=t.model.lower||0);var i=function(e,a){var i=!0;t.required!==!0&&"true"!==t.required.toLowerCase()||(i=t.model>0),o[t.name].$setValidity("validationValid",i),e!==a&&n.find("input").triggerHandler("change")};t.cancelSwipe=function(){return t.disabled},t.$watch("model",i),e(function(){t.modelValue=t.model,t.$watch("modelValue",function(){t.model=t.modelValue})},0)}}}]).directive("mdRangeSlider",["$timeout","TranslationService",function(e,t){return{restrict:"E",scope:{required:"=",name:"=",model:"=",min:"@",max:"@",step:"@",validators:"@",disabled:"=",actions:"="},template:['<slider ng-model="modelLower" ','        ng-model-range="modelUpper" ','        ng-disabled="disabled" ','        validation="{{validators}}" ','        md-actions="{{actions}}" ','        ng-swipe-left="cancelSwipe($event)" ','        ng-swipe-right="cancelSwipe($event)" ','        translate-range-fn="translateRange(low, high)" ','        floor="{{min}}" ','        ceiling="{{max}}" ','        step="{{step}}">',"</slider>",'<input type="hidden" ng-model="model" md-actions="{{actions}}" name="{{name}}" ng-required="required" />'].join(""),require:"^form",link:function(n,a,o,i){function r(e,t){var o=!0;n.required!==!0&&"true"!==n.required.toLowerCase()||(o=n.model&&(n.model.lower>0||n.model.upper>0)),i[n.name].$setValidity("validationValid",o),angular.equals(e,t)||a.find("input").triggerHandler("change")}"string"==typeof n.model&&(isNaN(n.model)?n.model=JSON.parse(n.model):n.model={lower:0,upper:parseInt(n.model,10)}),n.translateRange=function(e,n){return t.translate("Range")+": "+(n-e)},n.cancelSwipe=function(){return n.disabled},n.$watch("model",r,!0),e(function(){n.model&&(n.modelLower=n.model.lower||0,n.modelUpper=n.model.upper||0),n.$watchGroup(["modelLower","modelUpper"],function(){n.model={lower:n.modelLower,upper:n.modelUpper}})},0)}}}]),angular.module("app.core").directive("mdButton",["$compile","TranslationService",function(e,t){return{restrict:"E",replace:!0,transclude:!0,scope:{id:"@",theme:"@",actions:"=",classes:"@",leftIcon:"@",rightIcon:"@"},template:['<div class="md-button-container">','  <a id="{{id}}" class="btn {{ class }} {{ classes }}" md-actions="{{:: actions }}" ng-disabled="disabled"></a>',"</div>"].join(""),link:function(n,a,o,i,r){n["class"]=void 0===n.theme||"default"===n.theme?"btn-default":n.theme;var s=a.find("a");r(function(o,i){var r=o.html()||"";r=t.translate(r),n.leftIcon&&(r='<span class="fa '+n.leftIcon+'"></span> '+r),n.rightIcon&&(r=r+' <span class="fa '+n.rightIcon+'"></span>');var c=angular.element("<div/>").html(r),l=e(c)(i).contents();s.empty(),s.append(l),a.on("$destroy",function(){i.$destroy()})})}}}]),angular.module("app.core").directive("mdActions",["$timeout","$injector","ActionFactory",function(e,t,n){return{restrict:"A",require:"?^mdContextProvider",link:function(a,o,i,r){function s(e){var t={};return u?t=e.detail||{}:(t={type:e.type,target:e.target,detail:e.detail,keyCode:e.keyCode,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey},e.target&&e.target.hasOwnProperty("value")&&(t.value=e.target.value),r&&r.applyContextItemData(t)),t}function c(t,a,o){var i=s(t);e.cancel(l[t.type]),l[t.type]=e(function(){n.triggerEvent(a,o,i,t)},100)}var l={},u="true"===i.mdActionsEventDetailOnly,d=[];if("from-callback"===i.mdActions&&i.mdActionsCallbackFactory){var p=i.mdActionsCallbackFactory.split("#")[0],m=i.mdActionsCallbackFactory.split("#")[1];p&&m&&t.get(p)[m](o,a._schema.actions)}else if("from-schema"===i.mdActions?a._schema&&a._schema.actions&&(d=a._schema.actions):d=JSON.parse(i.mdActions||"[]"),d.length){var g=[];d.forEach(function(e){if(e.event&&g.indexOf(e.event)===-1){switch(e.event){case"enter":o.bind("keydown",function(e){var t=e.keyCode||e.which;13===t&&c(e,"enter",d)});break;default:o.bind(e.event,function(t){c(t,e.event,d)})}g.push(e.event)}})}}}}]),angular.module("app.core").factory("InlineCSS",["$rootScope","$injector","AssetFactory",function(e,t,n){function a(e){if(e){var a=t.get("SchemaService");(a.isPreview()||a.isLivePreview())&&(e=n.rewriteAssetPaths(e)),i+=e}}function o(){return i}var i="";return{add:a,get:o}}]),angular.module("app.core").directive("themes",["InlineCSS","$rootScope",function(e,t){return{restrict:"A",link:function(){t.$on("ConfigComplete",function(){var t=e.get();if(t){var n=document.createElement("style");n.textContent=t,document.head.appendChild(n)}})}}}]),angular.module("app.core").directive("mdAttributes",["StoreFactory","$timeout",function(e,t){return{restrict:"A",scope:{mdAttributes:"="},link:function(n,a,o){var i={},r={};o.mdExpressions&&(r=angular.fromJson(o.mdExpressions)),void 0!=n.mdAttributes&&angular.forEach(n.mdAttributes,function(e,t){"string"==typeof e&&e.indexOf("{{")>-1&&(i[t]=e)}),n.setAttributes=function(){angular.forEach(i,function(t,n){o.$set(n,e.parse(t))})},n.evalExpressions=function(){Object.keys(r).length>0&&angular.forEach(r,function(t,n){switch(n){case"show":var o=e.evaluate(t);o===!0?a.removeClass("ng-hide"):a.addClass("ng-hide")}})},n.$on("StoreChanged",function(){n.setAttributes(),n.evalExpressions()}),t(function(){n.setAttributes(),n.evalExpressions()})}}}]),angular.module("app.core").directive("mdExpressions",["$timeout","StoreFactory","TranslationService",function(e,t,n){return{restrict:"A",require:"^form",link:function(a,o,i,r){function s(e){angular.forEach(u,function(n,i){if(!angular.isArray(e)||e.indexOf(i)!==-1){n.indexOf("$form.invalid")!==-1&&(n=n.replace(/\$form\.invalid/g,r.$invalid));var s=t.evaluate(n.toString(),a),u=l.hasOwnProperty(i),p=l[i];u&&angular.equals(s,p)||(l[i]=s,c(i,s,o,d))}})}function c(e,t,a,o){switch(e){case"show":t===!0?a.removeClass("ng-hide"):a.addClass("ng-hide");break;case"disabled":o&&(o.disabled=t);break;case"label":o&&(o.originalLabel||(o.originalLabel=o.label),t?o.label=t:o.originalLabel&&(o.label=o.originalLabel));break;case"default":if(o&&void 0===o.inputModel)if("select"===o.itemType){for(var i=0;i<o.options.length;i++)if(o.options[i].value===t){o.inputModel=o.options[i];break}}else o.inputModel=n.translate(t)}}if(i.mdExpressions){var l={},u=JSON.parse(i.mdExpressions);if(u&&Object.keys(u).length){for(var d=null,p=i.id,m=a.$$childHead;m;m=m.$$nextSibling)if(m.id===p){d=m;break}s(["show","disabled"]),e(function(){s(["disabled","label","default"]),a.$watch(function(){return r.$invalid},function(){s()}),a.$on("StoreChanged",function(){s()})})}}}}}]),angular.module("app.core").directive("mdDomReady",["$interpolate",function(e){return{restrict:"A",priority:Number.MIN_SAFE_INTEGER,link:function(t,n,a){function o(e){e.forEach(function(e){t.$eval(e)})}var i=a.mdDomReady.split(";"),r=!1,s=!1;0!==a.mdDomReady.trim().length&&(a.waitForInterpolation&&t.$eval(a.waitForInterpolation)&&(r=!0),a.readyCheck&&(s=!0),r||s?requestAnimationFrame(function c(){var l=!1,u=!1;l=!(r&&n.text().indexOf(e.startSymbol())>=0),u=!(s&&!t.$eval(a.readyCheck)),l&&u?o(i):requestAnimationFrame(c)}):o(i))}}}]),angular.module("app.core").directive("openDocument",["electron","Plugin","StoreFactory",function(e,t,n){return{restrict:"E",scope:{classes:"@"},template:['<button class="btn btn-primary {{classes}}" ng-disabled="!document" ng-click="open()">',"   <span class=\"icon\" ng-class=\"{'icon-file-pdf': (type == 'pdf'), 'icon-file-word': (type == 'worddocument')}\"></span> Open Document","</button>"].join(""),link:function(a,o,i){a.type=i.itemType,a.document=void 0,void 0===i["static"]||"true"===i["static"]?a.document=i.path:(a.document=n.getForElement(i.model,o),a.$watch(function(){return n.getForElement(i.model,o)},function(e){a.document=e},!0)),a.open=function(){var n=t.getSource("fileopener");if(n!==!1)n.openFile(function(){},function(){},a.document);else if(e.shell){var o=a.document;o.indexOf("user-assets")!=-1&&(o=e.app.getAppPath()+e.path.sep+"www"+e.path.sep+o),e.shell.openItem(o)}else window.open(a.document,"_blank")},document.addEventListener("media-deleted",function(e){e.detail.location===a.document&&(a.document=void 0)})}}}]),angular.module("app.core").directive("imageViewer",["StoreFactory","ActionFactory","Plugin","electron",function(e,t,n,a){return{restrict:"E",templateUrl:"components/mdDynamicForm/imageViewer/imageViewer.tpl.html",scope:{src:"@",model:"@",actions:"=",classes:"@",scaleImage:"=",openExternallyOnClick:"=",maxWidth:"@",maxHeight:"@"},link:function(o,i){function r(e){angular.isArray(e)?o.image=e[e.length-1]:o.image=e}if(o.multiple=!1,o.image=void 0,void 0!==o.model){var s=e.getForElement(o.model,i);r(s),o.$watch(function(){return e.getForElement(o.model,i)},function(e){r(e)},!0)}else void 0!==o.src&&""!=o.src&&(o.image=o.src);o.close=function(){var e=document.querySelector("#mediaViewerDisplayUi");document.body.removeChild(e)},o.open=function(){if(o.openExternallyOnClick){var e=n.getSource("fileopener");if(e!==!1)e.openFile(function(){},function(){},o.src);else if(a.shell){var i=o.src;i.indexOf("user-assets")!=-1&&(i=a.app.getAppPath()+a.path.sep+"www"+a.path.sep+i),a.shell.openItem(i)}else window.open(o.src,"_blank")}t.triggerEvent("click",o.actions)},document.addEventListener("media-deleted",function(e){e.detail.location===o.image&&(o.image=void 0)})}}}]),angular.module("app.core").directive("mediaPlayer",["StoreFactory",function(e){return{restrict:"E",templateUrl:"components/mdDynamicForm/mediaPlayer/mediaPlayer.tpl.html",scope:{src:"@",model:"@",multiple:"@",actions:"=",classes:"@",itemType:"@",name:"@"},link:function(t,n){function a(e){angular.isArray(e)?t.src=e.length>0?e[e.length-1]:"":t.src=void 0!==e?e:""}if(void 0===t.src&&void 0!==t.model){t.$watch(function(){return e.getForElement(t.model,n)},function(e){a(e)},!0);var o=e.getForElement(t.model,n);a(o),t.fileType="video"==t.itemType?"video/mp4":""}}}}]).filter("trusted",["$sce",function(e){return function(t){if(void 0!==t&&"string"==typeof t)return e.trustAsResourceUrl(t)}}]),angular.module("app.core").directive("audioPlayer",["$log","AudioPlayer","ActionFactory","$rootScope",function(e,t,n,a){return{restrict:"E",templateUrl:"components/mdDynamicForm/mediaPlayer/audioPlayer.tpl.html",scope:{src:"@",actions:"="},controllerAs:"ap",controller:["$scope","$element",function(e,o){function i(){t.play(e.src,{},function(e){a.$$phase?l(e):a.$apply(function(){l(e)})})}function r(){t.pause()}function s(){t.unpause()}function c(){t.stop()}function l(e){e.state!==m.info.state&&d(e.state),m.info.currentTime=e.currentTime,m.info.position=e.position,m.info.state=e.state;var t=parseInt(Math.ceil(m.info.position/m.info.duration*100).toFixed(0));t<=100&&(f.style.width=t+"%"),100===t&&c()}function u(){m.info=angular.copy(g),f.style.width="0%"}function d(e){switch(e){case"playing":p("play-audio");break;case"paused":p("pause-audio");break;case"stopped":p("stop-audio")}}function p(t){n.triggerEvent(t,e.actions)}var m=this,g={state:null,totalTime:"0:00",duration:0,currentTime:"0:00",position:0};m.info=angular.copy(g);var f=o[0].getElementsByClassName("filler")[0];m.getInfo=function(e){t.getDuration(e,function(e,t){m.info.duration=e,m.info.totalTime=t,m.info.state="stopped"})},m.getInfo(e.src),m.button=function(){if(null!==m.info.state)switch(m.info.state){case"running":r();break;case"paused":s();break;case"stopped":case"released":i()}},e.$watch("src",function(e,t){e!==t&&(""!=e?m.getInfo(e):u())}),document.addEventListener("media-deleted",function(t){t.detail.location===e.src&&(c(),u())})}]}}]),angular.module("app.core").directive("recordAudio",["StoreFactory","$interval","$log","ActionFactory","$timeout","Plugin","$q","FileSystem",function(e,t,n,a,o,i,r,s){return{restrict:"E",templateUrl:"components/mdDynamicForm/fields/record-audio.tpl.html",scope:{name:"@",mediaid:"@",label:"@",actions:"=",classes:"@",smallrecorder:"=",multiple:"="},link:function(o,c){function l(){var e=r.defer(),t=new Date,a=t.getTime(),o=a+".m4a";return s.getStorageLocation().then(function(t){0===t.indexOf("file://")&&(t=t.replace("file://",""));var n=t+o;e.resolve(n)})["catch"](function(e){n.error(e)}),e.promise}function u(e){var t=Math.floor(e/60),n=Math.floor(e%60);return""+t+":"+(n<10?"0":"")+n}function d(){n.debug("Start recording..."),f().then(function(){var e={SampleRate:44100,NumberOfChannels:1};o.media.startRecordWithCompression(e),a.triggerEvent("recording-started",o.actions),null!==h&&t.cancel(h);var n=null;h=t(function(){if(o.state===v.MEDIA_RUNNING){null===n&&(n=Date.now());var e=Date.now(),t=n-e,a=t/1e3,i=Math.abs(a);o.currentTime=u(i)}})})}function p(){null!==o.media&&(o.media.stopRecord(),t.cancel(h))}function m(){n.debug("Finished recording.");var t=e.getForElement(b,c);null!==t&&void 0!==t&&angular.isArray(t)||(t=[]),o.multiple?t.push(o.media.src):t[0]=o.media.src,n.debug("Saving filename:",o.media.src),e.set(b,t),o.isPopulated=!0,a.triggerEvent("recording-finished",o.actions)}function g(e){n.debug("Initialise new media object..."),o.media=new v(e,function(){},function(e){n.error(e)},function(e){n.debug("State changing",o.state,e),o.$apply(function(){switch(o.state=e,o.state){case v.MEDIA_STOPPED:m(),o.media.release()}})})}function f(){var e=r.defer();return n.debug("Get file name..."),l().then(function(t){n.debug("Created filename:",t),g(t),e.resolve()}),e.promise}o.media=null;var v=i.getSource("Media"),h=null,y=o.$parent.$parent.page||o.$parent.$parent.$parent.page;o.pageName=y.name;var b="$store.media."+o.mediaid+".audio",w=e.getForElement(b,c);null!==w&&void 0!==w&&angular.isArray(w)&&w.length>0&&(o.isPopulated=!0),o.currentTime=u(0),o.uiState=!1,o.recordButton=function(){switch(o.state){case v.MEDIA_RUNNING:p();break;case v.MEDIA_PAUSED:case v.MEDIA_STOPPED:case v.MEDIA_NONE:default:d()}};var A=function(){o.isPopulated=!1,o.currentTime=u(0)};o.$watch(function(){return e.getForElement(b,c)},function(e,t){e!==t&&(void 0===e||angular.isArray(e)&&0===e.length)&&A()}),document.addEventListener("media-deleted",function(t){if(o.multiple!==!0){var n=e.getForElement(b,c)[0];(void 0!==t.detail&&t.detail.location===n||void 0===n)&&A()}}),document.addEventListener("stop-all-recording",function(){p()})}}}]),angular.module("app.core").directive("mediaGallery",["StoreFactory","MediaViewerDisplay","ActionFactory","$rootScope",function(e,t,n,a){return{restrict:"E",templateUrl:"components/mdDynamicForm/imageViewer/imageViewer.tpl.html",scope:{sources:"=",actions:"=",classes:"@"},link:function(o,i){function r(){o.files=[];var t=[];o.staticFiles.forEach(function(e){o.files.push(e)}),o.models.forEach(function(n){var a=e.getForElement(n,i);angular.isArray(a)?a.forEach(function(e){void 0!==e&&t.push(e)}):void 0!==a&&t.push(a)}),t.sort(function(e,t){var n=e.split("/"),a=t.split("/"),o=parseInt(n[n.length-1].split(".")[0],10),i=parseInt(a[a.length-1].split(".")[0],10);return o>i?1:o<i?-1:0}),t.forEach(function(e){o.files.push(e)})}o.multiple=!0,o.files=[],o.models=[],o.staticFiles=[];for(var s=0;s<o.sources.length;s++){var c=o.sources[s];if(c.indexOf("{")>-1){var l=c.replace(/\{|}/g,"");o.models.push(l)}else o.staticFiles.push(a.assetDir+c)}void 0!==o.models&&o.models.length>0&&o.models.forEach(function(t){o.$watch(function(){return e.getForElement(t,i)},function(){r()},!0)}),r(),o.getFileType=function(e){if(void 0===e)return"none";var t=e.split("."),n=t[t.length-1].toLowerCase();return"aac"===n||"m4a"===n||"mp3"===n||"wav"===n?"audio":"image"},o.getViewableFilePath=function(e){if(void 0===e)return"";var t=e.split("/");return t[t.length-1]},o.close=function(){var e=document.querySelector("#mediaViewerDisplayUi");document.body.removeChild(e)},o.open=function(e){var a=o.files[e];void 0!==a&&t.open(a,o.actions).then(function(t){var a=o.actions[t];void 0!==a&&(a.data.index=e,a.data.model=o.model,n.triggerEvent(null,[a]).then(function(){o.close()})["catch"](function(){o.close()}))})["catch"](function(){o.close()})},document.addEventListener("media-deleted",function(e){var t=o.files.indexOf(e.detail.location);t!==-1&&(o.files=o.files.some(function(t){return t!==e.detail.location}))})}}}]),angular.module("app.core").factory("MediaViewerDisplay",["$q","$compile","$rootScope",function(e,t,n){function a(a,o){var i=e.defer(),r=['<div id="mediaViewerDisplayUi" class="image-viewer-display-container">','   <div class="image-frame">','       <img ng-if="fileType === \'image\'" ng-src="{{src}}" />','       <audio-player ng-if="fileType === \'audio\'" class="col-md-4 col-xs-12" item-type="{{fileType}}" src="{{src | trusted}}"></audio-player>',"   </div>",'   <div class="image-footer">','       <a ng-repeat="action in actions track by $index" href="javascript:void(0)" class="{{action.data.theme || \'\'}}" ng-click="callAction($index)">',"           <span ng-if=\"action.data['left-icon']\" class=\"fa {{action.data['left-icon']}}\"></span> {{action.data.label}} ","           <span ng-if=\"action.data['right-icon']\" class=\"fa {{action.data['right-icon']}}\"></span>","       </a>",'       <a href="javascript:void(0)" ng-click="close()" class="primary">','           <span class="fa fa-close"></span> Close',"       </a>","   </div>","</div>"].join(""),s=n.$new(!0);
s.src=a,s.actions=o;var c=s.src.split("."),l=c[c.length-1];s.fileType="aac"===l||"m4a"===l||"mp3"===l?"audio":"image",s.close=function(){i.reject()},s.callAction=function(e){i.resolve(e)};var u=angular.element(t(r)(s))[0];return document.body.appendChild(u),i.promise}var o={open:a};return o}]),angular.module("app.core").directive("mdThumbnail",["$log","Plugin","Platform",function(e,t,n){return{restrict:"A",scope:{mdThumbnail:"@"},link:function(a,o,i){a.genThumb=function(){var r,s;try{r=parseInt(i.mdThumbnailMaxwidth),s=parseInt(i.mdThumbnailMaxheight)}catch(c){e.debug("Failed to parse width and height from thumbnail")}void 0===r&&(r=200),void 0===s&&(s=200);var l=a.mdThumbnail.toLowerCase().indexOf(".svg")>-1;if(void 0===a.mdThumbnail||""==a.mdThumbnail||l)l&&(o.attr("width",r),o.attr("height",s),o.attr("src",a.mdThumbnail));else{var u=t.getSource("thumbnail"),d="winphone"===n.getName();u!==!1?u.makeThumbnail(function(e){o.attr("src",e)},function(t){e.error(t)},a.mdThumbnail,r,s,100):(d&&"/"!==a.mdThumbnail[0]&&a.mdThumbnail.length>0&&(a.mdThumbnail="/"+a.mdThumbnail),o.attr("src",a.mdThumbnail))}},a.genThumb(),a.$watch("mdThumbnail",function(e,t){e!=t&&a.genThumb()})}}}]),angular.module("app.core").directive("scrollableItem",function(){return{restrict:"A",scope:!1,controller:["$scope","$element",function(e,t){return{scrollToBottom:function(){t[0].scrollTop=t[0].scrollHeight}}}]}}),angular.module("app.core").directive("schemaSource",["SchemaHelper",function(e){return{restrict:"A",link:function(t,n,a){var o=a.schemaSource;if(o){var i=e.getSchemaByAutoId(o)[0];void 0!==i&&(t._schema=i)}}}}]),angular.module("app.core").directive("mdOnEnter",function(){return function(e,t,n){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(n.mdOnEnter)}),t.preventDefault())})}}),angular.module("app.core").factory("DirectiveBridge",function(){function e(e,t,o){var r=n(e,t);if(r){var s=i.indexOf(r);i[s].api=o}else{var c=a(e,t);i.push({id:c,api:o})}}function t(e,t){var a=n(e,t);return a&&a.api||null}function n(e,t){var n=a(e,t);return o(n)}function a(e,t){return"page_"+e+"_item_"+t}function o(e){for(var t=0;t<i.length;t++)if(i[t].id===e)return i[t];return null}var i=[];return{registerItemApi:e,getItemApi:t}}),angular.module("app.core").factory("Utilities",function(){return{uuid:function(){var e=Date.now();return window.performance&&"function"==typeof window.performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)})},escapeForRegExp:function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}}}),angular.module("app.core").factory("MimeTypes",function(){function e(e){return e.indexOf(".")!=-1&&(e=e.split(".").pop().toLowerCase()),r.hasOwnProperty(e)?r[e].mimeType:null}function t(e){return e.indexOf(".")!=-1&&(e=e.split(".").pop().toLowerCase()),r.hasOwnProperty(e)?r[e].mediaType:null}function n(e){var t=[];for(var n in r)r.hasOwnProperty(n)&&r[n].mimeType.toLowerCase()===(e||"").toLowerCase()&&t.push(n);return t}function a(e){var t=[];for(var n in r)r.hasOwnProperty(n)&&r[n].mimeType.toLowerCase()===(e||"").toLowerCase()&&t.push({extension:n,preferred:r[n].preferred||!1});if(1==t.length)return t[0].extension;if(t.length>1){for(var a=0;a<t.length;a++)if(t[a].preferred===!0)return t[a].extension;return t[0].extension}return null}function o(e){for(var t in r)if(r.hasOwnProperty(t)&&r[t].mimeType.toLowerCase()===(e||"").toLowerCase())return r[t].mediaType;return null}var i={IMAGE:"image",AUDIO:"audio",VIDEO:"video"},r={a:{mimeType:"application/octet-stream",mediaType:null},ai:{mimeType:"application/postscript",mediaType:null},aif:{mimeType:"audio/x-aiff",mediaType:i.AUDIO},aifc:{mimeType:"audio/x-aiff",mediaType:i.AUDIO},aiff:{mimeType:"audio/x-aiff",mediaType:i.AUDIO},au:{mimeType:"audio/basic",mediaType:i.AUDIO},avi:{mimeType:"video/x-msvideo",mediaType:null},bat:{mimeType:"text/plain",mediaType:null},bin:{mimeType:"application/octet-stream",mediaType:null},bmp:{mimeType:"image/x-ms-bmp",mediaType:i.IMAGE},c:{mimeType:"text/plain",mediaType:null},cdf:{mimeType:"application/x-cdf",mediaType:null},csh:{mimeType:"application/x-csh",mediaType:null},css:{mimeType:"text/css",mediaType:null},dll:{mimeType:"application/octet-stream",mediaType:null},doc:{mimeType:"application/msword",mediaType:null},docm:{mimeType:"application/vnd.ms-word.document.macroEnabled.12",mediaType:null},docx:{mimeType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",mediaType:null},dot:{mimeType:"application/msword",mediaType:null},dotx:{mimeType:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",mediaType:null},dvi:{mimeType:"application/x-dvi",mediaType:null},eml:{mimeType:"message/rfc822",mediaType:null},eps:{mimeType:"application/postscript",mediaType:null},etx:{mimeType:"text/x-setext",mediaType:null},exe:{mimeType:"application/octet-stream",mediaType:null},gif:{mimeType:"image/gif",mediaType:i.IMAGE},gtar:{mimeType:"application/x-gtar",mediaType:null},h:{mimeType:"text/plain",mediaType:null},hdf:{mimeType:"application/x-hdf",mediaType:null},htm:{mimeType:"text/html",mediaType:null},html:{mimeType:"text/html",mediaType:null},jpe:{mimeType:"image/jpe",mediaType:i.IMAGE},jpeg:{mimeType:"image/jpeg",mediaType:i.IMAGE},jpg:{mimeType:"image/jpeg",mediaType:i.IMAGE,preferred:!0},js:{mimeType:"application/javascript",mediaType:null},json:{mimeType:"application/json",mediaType:null},ksh:{mimeType:"text/plain",mediaType:null},latex:{mimeType:"application/x-latex",mediaType:null},m1v:{mimeType:"video/mpeg",mediaType:i.VIDEO},m4a:{mimeType:"audio/mpeg",mediaType:i.AUDIO,preferred:!0},man:{mimeType:"application/x-troff-man",mediaType:null},me:{mimeType:"application/x-troff-me",mediaType:null},mht:{mimeType:"message/rfc822",mediaType:null},mhtml:{mimeType:"message/rfc822",mediaType:null},mif:{mimeType:"application/x-mif",mediaType:null},mov:{mimeType:"video/quicktime",mediaType:i.VIDEO},movie:{mimeType:"video/x-sgi-movie",mediaType:i.VIDEO},mp2:{mimeType:"audio/mpeg",mediaType:i.AUDIO},mp3:{mimeType:"audio/mp3",mediaType:i.AUDIO},mp4:{mimeType:"video/mp4",mediaType:i.VIDEO},mpa:{mimeType:"video/mpeg",mediaType:i.VIDEO},mpe:{mimeType:"video/mpeg",mediaType:i.VIDEO},mpeg:{mimeType:"video/mpeg",mediaType:i.VIDEO},mpg:{mimeType:"video/mpeg",mediaType:i.VIDEO,preferred:!0},ms:{mimeType:"application/x-troff-ms",mediaType:null},nc:{mimeType:"application/x-netcdf",mediaType:null},nws:{mimeType:"message/rfc822",mediaType:null},o:{mimeType:"application/octet-stream",mediaType:null},obj:{mimeType:"application/octet-stream",mediaType:null},oda:{mimeType:"application/oda",mediaType:null},otf:{mimeType:"application/x-font-opentype",mediaType:null},pbm:{mimeType:"image/x-portable-bitmap",mediaType:i.IMAGE},pdf:{mimeType:"application/pdf",mediaType:null},pfx:{mimeType:"application/x-pkcs12",mediaType:null},pgm:{mimeType:"image/x-portable-graymap",mediaType:i.IMAGE},png:{mimeType:"image/png",mediaType:i.IMAGE},pnm:{mimeType:"image/x-portable-anymap",mediaType:i.IMAGE},po:{mimeType:"text/x-gettext-translation",mediaType:null},pot:{mimeType:"application/vnd.ms-powerpoint",mediaType:null},ppa:{mimeType:"application/vnd.ms-powerpoint",mediaType:null},ppm:{mimeType:"image/x-portable-pixmap",mediaType:i.IMAGE},pps:{mimeType:"application/vnd.ms-powerpoint",mediaType:null},ppt:{mimeType:"application/vnd.ms-powerpoint",mediaType:null},pptm:{mimeType:"application/vnd.ms-powerpoint.presentation.macroEnabled.12",mediaType:null},pptx:{mimeType:"application/vnd.openxmlformats-officedocument.presentationml.presentation",mediaType:null},ps:{mimeType:"application/postscript",mediaType:null},pwz:{mimeType:"application/vnd.ms-powerpoint",mediaType:null},py:{mimeType:"text/x-python",mediaType:null},pyc:{mimeType:"application/x-python-code",mediaType:null},pyo:{mimeType:"application/x-python-code",mediaType:null},qt:{mimeType:"video/quicktime",mediaType:i.VIDEO},ra:{mimeType:"audio/x-pn-realaudio",mediaType:i.AUDIO},ram:{mimeType:"application/x-pn-realaudio",mediaType:i.AUDIO},ras:{mimeType:"image/x-cmu-raster",mediaType:i.IMAGE},rdf:{mimeType:"application/xml",mediaType:null},rgb:{mimeType:"image/x-rgb",mediaType:i.IMAGE},roff:{mimeType:"application/x-troff",mediaType:null},rtx:{mimeType:"text/richtext",mediaType:null},sgm:{mimeType:"text/x-sgml",mediaType:null},sgml:{mimeType:"text/x-sgml",mediaType:null},sh:{mimeType:"application/x-sh",mediaType:null},shar:{mimeType:"application/x-shar",mediaType:null},snd:{mimeType:"audio/basic",mediaType:i.AUDIO},so:{mimeType:"application/octet-stream",mediaType:null},src:{mimeType:"application/x-wais-source",mediaType:null},svg:{mimeType:"image/svg+xml",mediaType:i.IMAGE},swf:{mimeType:"application/x-shockwave-flash",mediaType:null},t:{mimeType:"application/x-troff",mediaType:null},tar:{mimeType:"application/x-tar",mediaType:null},tcl:{mimeType:"application/x-tcl",mediaType:null},tex:{mimeType:"application/x-tex",mediaType:null},texi:{mimeType:"application/x-texinfo",mediaType:null},texinfo:{mimeType:"application/x-texinfo",mediaType:null},tif:{mimeType:"image/tiff",mediaType:i.IMAGE},tiff:{mimeType:"image/tiff",mediaType:i.IMAGE},tr:{mimeType:"application/x-troff",mediaType:null},tsv:{mimeType:"text/tab-separated-values",mediaType:null},ttf:{mimeType:"application/x-font-truetype",mediaType:null},txt:{mimeType:"text/plain",mediaType:null,preferred:!0},ustar:{mimeType:"application/x-ustar",mediaType:null},vcf:{mimeType:"text/x-vcard",mediaType:null},wav:{mimeType:"audio/x-wav",mediaType:i.AUDIO},woff:{mimeType:"application/font-woff",mediaType:null,preferred:!0},woff2:{mimeType:"application/font-woff",mediaType:null},wsdl:{mimeType:"application/xml",mediaType:null},xbm:{mimeType:"image/x-xbitmap",mediaType:i.IMAGE},xlb:{mimeType:"application/vnd.ms-excel",mediaType:null},xls:{mimeType:"application/vnd.ms-excel",mediaType:null},xlsm:{mimeType:"application/vnd.ms-excel.sheet.macroEnabled.12",mediaType:null},xlsx:{mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",mediaType:null},xml:{mimeType:"text/xml",mediaType:null},xpdl:{mimeType:"application/xml",mediaType:null},xpm:{mimeType:"image/x-xpixmap",mediaType:i.IMAGE},xsl:{mimeType:"application/xml",mediaType:null},xwd:{mimeType:"image/x-xwindowdump",mediaType:i.IMAGE},zip:{mimeType:"application/zip",mediaType:null}};return{MEDIA_TYPES:i,mimeTypeFromExtension:e,mediaTypeFromExtension:t,extensionsFromMimeType:n,extensionFromMimeType:a,mediaTypeFromMimeType:o}}),angular.module("app.core").factory("StudioStorage",["$q",function(e){function t(t){var n=e.defer(),i=null!==t?t:"com.commontime.infinity.studio";return a=new PouchDB(i,{revs_limit:10}),a.allDocs({include_docs:!0}).then(function(e){angular.forEach(e.rows,function(e){e.doc&&e.doc._id&&(o[e.doc._id]=e.doc.data)}),n.resolve()}),n.promise}function n(e){if(!e)throw new Error("key cannot be empty");return o[e]||null}var a=null,o={};return{init:t,getData:n}}]),angular.module("app.core").factory("SchemaHelper",["$filter",function(e){function t(){return l.schema.name}function n(e){return void 0!==l.schema.settings?l.schema.settings[e]:void 0}function a(e){return i("name",e,l.schema.config)[0]}function o(t){return e("filter")(l.schema.config,{"item-type":t})}function i(e,t,n,a){n=void 0!==n?n:l.schema;var o=[];for(var r in n)n.hasOwnProperty(r)&&("object"!=typeof n[r]||a!==!0&&"actions"==r?r==e&&n[e]==t&&o.push(n):o=o.concat(i(e,t,n[r],a)));return o}function r(e,t,n){var a=JSON.search(e,'//*[type="'+t+'"]');return a.filter(function(e){return!n||e["item-type"]===n})}function s(){return l.schema.language||{defaultLocale:"en_GB",initialLanguage:"",useDeviceLocale:!0}}function c(e){return i("_auto_id_",e)}var l={ITEM_AUTO_ID_PROPERTY:"_auto_id_",SCHEMA_CONTEXT_PREVIEW:1,SCHEMA_CONTEXT_LIVE_PREVIEW:2,schema:{},getSchemaConfigItemByName:a,getSchemaConfigItemsByItemType:o,search:i,getItems:r,getLanguageSettings:s,getSchemaByAutoId:c,getSchemaSettingByName:n,getAppName:t};return l}]),angular.module("app.core").factory("SchemaService",["$injector","$http","$q","$rootScope","$log","$templateCache","$location","StoreFactory","PluginFactory","$timeout","localStorageService","OptionFactory","ApiFactory","UrlFactory","Timer","InlineCSS","VariableFactory","$base64","ActionFactory","RouterConfig","Router","Auth","SchemaHelper","IBeaconFactory","GeofenceFactory","XmppFactory","MessageQueueFactory","Notification","Platform","DataflowFactory","AzureAppServicesFactory","RestFactory","ActionflowFactory","AssetFactory","LoadingStatus","ComponentFactory","StudioStorage","$interval","Utilities","WcUtils","ListFactory","LoggingFactory","ChatLayerFactory","IncidentLayerFactory","PagerLayerFactory","UserManagementLayerFactory","Plugin",function(e,t,n,a,o,i,r,s,c,l,u,d,p,m,g,f,v,h,y,b,w,A,S,$,x,E,T,C,k,F,I,L,P,_,D,N,O,M,R,U,j,q,B,V,G,H,z){function W(e){var t=!1;return angular.forEach(pe.content,function(n){"page"==n.type&&n.name==e&&(t=n)}),t}function J(){return me}function K(){var e=2;return"undefined"!=typeof pe.animation&&(e="off"!==pe.animation?"full"==pe.animation?2:1:0),e}function X(e){var a=n.defer();return t.get(e).then(function(e){pe=S.schema=e.data,a.resolve(pe)})["catch"](a.reject),a.promise}function Q(e){var t=n.defer();return e.settings&&e.settings.auth===!0?A.authenticate().then(t.resolve,t.reject):t.resolve(),t.promise}function Y(){w.addRoute("/error",{template:['<div class="error-container">','   <div class="alert alert-danger">','       <span class="fa fa-exclamation-triangle"></span> {{ $root.errorMessage || "An unknown error has occurred" }}',"   </div>",'   <div class="controls">','       <a href="#" class="btn md-btn btn-primary" onclick="location.reload();">','           <span class="fa fa-refresh"></span> Reload',"       </a>","   </div>","</div>"].join("")})}function Z(){function e(e){e&&angular.forEach(e,function(e,t){window.cti.store.preferences[t]=e})}function a(){var e=n.defer();return angular.forEach(pe.metadata,function(e){window.cti.store.preferences[e.key]=e.value}),e.resolve(),e.promise}function i(){var a=n.defer();if(se())a.resolve();else{var o=re()?"./client/preferences.json":"./preferences.json";t.get(o).then(function(t){e(t.data),a.resolve()})["catch"](a.reject)}return a.promise}function r(){var t=n.defer(),a=z.getSource("preferences");return a?a.getAllPreferences(function(n){e(n),t.resolve()},function(e){o.error("Error obtaining preferences",e),t.resolve()}):t.resolve(),t.promise}function s(){if(!d)return n.when();var t=n.defer(),a=d._appConfig;if(a){var o={};if(void 0!==a.RELEASE_DEBUGGING){var i=z.getSource("preferences");i&&("true"==a.RELEASE_DEBUGGING?i.enableWebDebugging(!0):i.enableWebDebugging(!1)),o.RELEASE_DEBUGGING=a.RELEASE_DEBUGGING}angular.forEach(a,function(e,t){o[t]=e}),e(o)}return t.resolve(),t.promise}function c(){var t=n.defer(),a={};return angular.forEach(window.cti.store.preferences,function(e,t){var n=u.get(t);n&&(a[t]=n)}),e(a),t.resolve(),t.promise}var l=n.defer();window.cti.store.preferences={},n.when().then(function(){return a()}).then(function(){return r()}).then(function(){return i()}).then(function(){return s()}).then(function(){return c()}).then(function(){if("device"===k.getType()){var e=z.getSource("StatusBar");e&&e.backgroundColorByHexString(window.cti.store.preferences.statusBarColor||"#000000")}l.resolve()});var d=z.getSource("EmmAppConfig"),p=function(e,t){var n;return function(){var a=this,o=arguments,i=function(){n=null,e.apply(a,o)};clearTimeout(n),n=setTimeout(i,t||200)}},m=p(function(){s().then(function(){var e=S.getSchemaConfigItemsByItemType("onappconfigchange");e&&e.length>0&&y.triggerEvent("onappconfigchange",e[0].actions,d._appConfig)})},400);return d&&d.registerChangedListener(m),l.promise}function ee(){var e=n.defer();return a.appName=pe.name,a.cancelable=pe.cancelable===!0,a.basedir=void 0==pe.basedir?"":pe.basedir,a.assetDir=void 0!==pe.assetDir?pe.assetDir:"user-assets/",a.componentDir=void 0!==pe.componentDir?pe.componentDir:"components/",b.set("id",a.appName),o.debug("Initializing store..."),s.init(a.appName,pe).then(function(){k.init(),o.debug("Store initialized."),Z().then(function(){if(s.save(),o.debug("Preferences initialized."),q.init(a.appName),void 0!==pe.settings){if(void 0!==pe.settings.theme&&""!=pe.settings.theme){var t=angular.element(document.querySelector("head")),n=angular.element('<link rel="stylesheet" href="'+a.basedir+"assets/css/themes/"+pe.settings.theme+'.css" />');t.append(n)}void 0!==pe.settings.router&&(void 0!==pe.settings.router.mode&&b.set("mode",pe.settings.router.mode),void 0!==pe.settings.router.animation&&b.set("animation",pe.settings.router.animation)),void 0!==pe.settings["push-notifications"]&&C.init(pe),void 0!==pe.settings["message-queue"]&&T.init(pe),D.disabled=pe.settings["loading-message"]===!1}void 0!==pe.dataflows&&pe.dataflows.length>0&&pe.dataflows.forEach(function(e){F.init(e.name,e.content)}),void 0!==pe.actionflows&&pe.actionflows.length>0&&pe.actionflows.forEach(function(e){P.init(e.name,e.content)}),d.init(a.appName),Q(pe).then(function(){if(void 0!=pe.config){var t=[];angular.forEach(pe.config,function(e){if(void 0!=e.name)switch(e["item-type"]){case"onappload":t.push(e);break;case"api":void 0!==e.url&&p.init(e);break;case"offline-api":void 0!==e.url&&(L.init(),L.registerOfflineApi(e));break;case"xmpp":void 0!==e.endpoint&&E.init(e);break;case"chatlayer":B.load().then(function(){B.init(e,pe)});break;case"broadcastincidentlayer":case"responderincidentlayer":V.load().then(function(){V.init(e)});break;case"broadcastpagerlayer":case"responderpagerlayer":G.load().then(function(){G.init(e)});break;case"usermanagementlayer":H.load().then(function(){H.init(e)});break;case"plugin":c.init(e);break;case"css":f.add(e.content);break;case"variable":v.init(e);break;case"function":s.setFunction(e);break;case"js-asset":_.injectJsAsset(e.fileName);break;case"css-asset":_.injectCssAsset(e.fileName);break;case"url":m.init(e);break;case"beacon":$.init(),$.addBeacon(e);break;case"geofence":if(x.isValidGeofenceObject(e)){var n="com.commontime.infinity."+pe.name;x.init(pe.name,n),x.register(e)}break;case"timer":void 0==window.cti.__timers&&(window.cti.__timers={}),window.cti.__timers[e.name]=new g(e.name,e["timer-type"],e.time,e.actions);break;case"azure-app-services":I.init(e)}}),t.length>0&&t.forEach(function(e){y.triggerEvent("onappload",e.actions)})}pe.components&&pe.components.length&&(pe.components.forEach(function(e){switch(e.type){case"web-component":var t=document.createElement("script"),n=window.___supportsNativeWebComponents?e.files.original:e.files.transpiled,o=a.componentDir+n;t.setAttribute("src",o),document.getElementsByTagName("body")[0].appendChild(t)}}),N.registerComponentInstances(pe)),a.$emit("ConfigComplete");var n={};a.$on("onPageContentLoaded",function(e,t){void 0!==n[t.id]&&y.triggerEvent(null,n[t.id])});var o=angular.copy(pe);angular.forEach(o.pages,function(e){var t=angular.element("<div></div>"),a=[];void 0!==e.config&&e.config.length>0&&e.config.forEach(function(t){"onpageload"==t["item-type"]&&void 0!==t.actions&&t.actions.length>0&&t.actions.forEach(function(e){a.push(e)}),"onpageloaded"==t["item-type"]&&void 0!==t.actions&&t.actions.length>0&&(void 0===n[e.name]&&(n[e.name]=[]),n[e.name]=n[e.name].concat(t.actions))});var o=oe(t,e.content),i=S.search("type","go-to-page",e.content,!0),r=[];i.length>0&&angular.forEach(i,function(e){e.data&&e.data.name&&r.push(e.data.name)});var s=e.settings&&e.settings.auth===!0;w.addRoute("/"+e.name,{template:o[0].innerHTML,possibilities:r,actions:a,start:e.start,auth:s})}),Y(),e.resolve(!0)})["catch"](function(t){o.error(t),a.errorMessage=t.message||t,Y(),r.path("/error"),e.resolve(t)})})})["catch"](function(e){o.error(e)}),e.promise}function te(e){var t=n.defer(),a=function(e){pe=S.schema=e,ee().then(function(){t.resolve()})};if(e)X(e).then(a)["catch"](t.reject);else{var o=u.get("appName"),i=u.get("studioDbName");O.init(i).then(function(){var e=O.getData(o);"object"!=typeof e&&(e=angular.fromJson(e)),null!==e&&a(e)})["catch"](t.reject)}return t.promise}function ne(t){var n=!1,o=t.content;switch("string"==typeof o&&(o=_.rewriteAssetPaths(o)),t.originalName=t.name,t.name=t.name+"{{ $data.$index !== undefined ? '_' + $data.$index : '' }}",t.type){case"area":var i=!1;switch(t["item-type"]){case"static":n=angular.element('<section class="static-item panel panel-default" id="'+t.name+'"></section>'),i=!0;break;case"scrollable":n=angular.element('<section class="scrollable-item" id="'+t.name+'" scrollable-item></section>'),i=!0;break;case"row":n=angular.element('<section class="row-item navbar navbar-default" id="'+t.name+'"></section>'),i=!0;break;case"group":n=t.repeat?angular.element('<md-group ng-form name="'+t.name+'" isolate-form id="'+t.name+'"></md-group>'):angular.element('<md-group id="'+t.name+'"></md-group>')}n!==!1&&i&&t.classes&&(n[0].className=n[0].className+" "+t.classes);break;case"content":switch(t["item-type"]){case"html":case"markdown":n=angular.element('<md-content id="'+t.name+'">'+o+"</md-content>");break;case"title":n=angular.element('<md-title id="'+t.name+'">'+o+"</md-title>");break;case"list":n=angular.element('<md-list id="'+t.name+'"></md-list>'),t.listItemClasses&&n.attr("list-item-classes",t.listItemClasses.replace(/\{/g,"\\{"));break;case"data-grid":!function(){var a=e.get("ctDataGrid");n=a.buildDom("grid",t)}();break;case"data-grid-column":!function(){var a=e.get("ctDataGrid");n=a.buildDom("column",t)}();break;case"edit-actions-column":!function(){var a=e.get("ctDataGrid");n=a.buildDom("edit-actions-column",t)}()}break;case"user-input":case"choice":case"capture":switch(t["item-type"]){case"record-audio":n=angular.element('<record-audio id="'+t.name+'"></record-audio>');break;default:void 0!==t["extends"]&&["user-input","choice","capture"].indexOf(t["extends"].type)===-1||(n=angular.element('<md-question id="'+t.name+'"></md-question>'))}break;case"button":switch(t["item-type"]){case"button":n=angular.element('<md-button id="'+t.name+'">'+o+"</md-button>"),t["left-icon"]&&n.attr("left-icon",t["left-icon"]),t["right-icon"]&&n.attr("right-icon",t["right-icon"])}break;case"chart":n=angular.element('<md-chart id="'+t.name+'"></md-chart>');break;case"media":var r="";switch(t.fileName&&(r=_.rewriteAssetPaths(a.assetDir+t.fileName)),t["item-type"]){case"image-viewer":void 0===t.fileName&&void 0===t.model||(n=angular.element("<image-viewer></image-viewer>"),r&&n.attr("src",r),void 0===t.scaleImage&&(t.scaleImage=!0,t.maxWidth=200,t.maxHeight=200),void 0===t.openExternallyOnClick&&(t.openExternallyOnClick=!1),n.attr("scale-image",t.scaleImage),n.attr("max-width",t.maxWidth),n.attr("max-height",t.maxHeight),n.attr("open-externally-on-click",t.openExternallyOnClick));break;case"audio":case"video":void 0===t.model&&void 0===t.fileName||(n=angular.element("<media-player></media-player>"),r&&n.attr("src",r));break;case"gallery":void 0!==t.sources&&t.sources.length>0&&(n=angular.element("<media-gallery></media-gallery>"));break;case"pdf":case"worddocument":void 0===t.model&&void 0===t.fileName||(n=angular.element("<open-document></open-document>"),r&&n.attr("path",r))}break;case"mapping":switch(t["item-type"]){case"google-map":n=angular.element("<md-google-map></md-google-map>")}break;case"component":n=angular.element('<md-component instance-id="'+t[de]+'"></md-component>'),n=angular.element('<md-component instance-id="'+t[de]+'"></md-component>');break;case"messaging-common":switch(t["item-type"]){case"common-login-form":!function(){var a=e.get("ctCommonLoginFormFactory");n=a.buildDom(t)}();break;case"common-online-indicator":!function(){var a=e.get("ctCommonOnlineIndicatorFactory");n=a.buildDom(t)}();break;case"common-user-display":!function(){var a=e.get("ctCommonUserDisplayFactory");n=a.buildDom(t)}();break;case"common-slide-panel":!function(){var a=e.get("ctCommonSlidePanelFactory");n=a.buildDom(t)}();break;case"common-debugger":!function(){var a=e.get("ctCommonDebuggerFactory");n=a.buildDom(t)}()}break;case"chat":switch(t["item-type"]){case"cl-conversation-list":!function(){var a=e.get("ctCLConversationListFactory");n=a.buildDom(t)}();break;case"cl-new-conversation":!function(){var a=e.get("ctCLNewConversationFactory");n=a.buildDom(t)}();break;case"cl-chat-message-list":!function(){var a=e.get("ctCLChatMessageListFactory");n=a.buildDom(t)}();break;case"cl-conversation-info":!function(){var a=e.get("ctCLConversationInfoFactory");n=a.buildDom(t)}();break;case"cl-add-conversation-contacts":!function(){var a=e.get("ctCLAddConversationContactsFactory");n=a.buildDom(t)}()}break;case"incident":switch(t["item-type"]){case"il-role-selection":!function(){var a=e.get("ctILRoleSelectionFactory");n=a.buildDom(t)}();break;case"il-incident-list":!function(){var a=e.get("ctILIncidentListFactory");n=a.buildDom(t)}();break;case"il-last-incident-display":!function(){var a=e.get("ctILLastIncidentDisplayFactory");n=a.buildDom(t)}();break;case"il-new-incident-button":!function(){var a=e.get("ctILNewIncidentButtonFactory");n=a.buildDom(t)}();break;case"il-user-list":!function(){var a=e.get("ctILUserListFactory");n=a.buildDom(t)}();break;case"il-report-list":!function(){var a=e.get("ctILReportListFactory");n=a.buildDom(t)}()}break;case"pager":switch(t["item-type"]){case"pg-list":!function(){var a=e.get("ctPGListFactory");n=a.buildDom(t)}()}break;case"user-management":switch(t["item-type"]){case"um-list":!function(){var a=e.get("ctUMListFactory");n=a.buildDom(t)}()}break;default:n=ae(t)}return n||(n=ae(t)),n}function ae(e){var t=!1;return void 0!=e["extends"]&&(e.type=e["extends"].type,e["item-type"]=e["extends"]["item-type"],t=ne(e)),t}function oe(e,t){for(var n=0;n<t.length;n++){var a=t[n],o=ne(a);o!==!1&&("component"!==a.type&&o[0].$$attrsHandled!==!0&&angular.forEach(a,function(e,t){var n=angular.copy(e);if(0!==t.indexOf("$")){if("expressions"===t&&angular.isObject(n))return void o[0].setAttribute("md-expressions",JSON.stringify(n));var a=["_auto_id_","content","filename","attributes"];a.indexOf(t)===-1&&("validators"===t&&angular.isArray(n)&&angular.forEach(n,function(e){e.name="custom_"+e.name}),(angular.isObject(n)||angular.isArray(n))&&(n=JSON.stringify(n)),o[0].setAttribute(t,n))}}),angular.isArray(a.content)&&(o=oe(o,a.content)),e.append(o))}return e}function ie(){return!re()&&!se()}function re(){return pe.hostContext===S.SCHEMA_CONTEXT_PREVIEW}function se(){return pe.hostContext===S.SCHEMA_CONTEXT_LIVE_PREVIEW}function ce(){var e={};return angular.forEach(pe,function(t,n){["pages","translation"].indexOf(n)===-1&&(e[n]=t)}),e}function le(e){var t="//*["+de+"='"+e+"']",n=JSON.search(pe,t);return 0===n.length?null:n[0]}function ue(e,t,n){return S.getItems(e,t,n)}var de=S.ITEM_AUTO_ID_PROPERTY,pe=null,me={};return{getPages:function(){return pe.pages},buildItems:oe,stop:te,getDom:J,buildDom:ee,getPageSchema:W,isBuiltApp:ie,isPreview:re,isLivePreview:se,getAppData:ce,getAnimationLevel:K,findItemById:le,getItems:ue,ITEM_AUTO_ID_PROPERTY:de,setUpPreferences:Z}}]),angular.module("app.core").factory("ComponentFactory",["$rootScope","$interpolate","$injector","$timeout","SchemaHelper","AssetFactory",function(e,t,n,a,o,i){function r(e){angular.forEach(e.pages,function(t){f(e,t,t.content)})}function s(e){return c(function(t){return t.id===e})}function c(e){if("function"!=typeof e)return null;var t=h.filter(e)[0];return t||null}function l(e){if(e.indexOf("$component")===-1)return e;var t=new RegExp("\\$component\\.pages\\.\\w+\\.\\w+\\.\\$\\w+\\.[\\w-]+","g");return t.test(e)?e.replace(t,function(t){var n=new RegExp("\\$component\\.pages\\.(\\w+)\\.(\\w+)\\.\\$(\\w+)\\.([\\w-]+)"),a=t.match(n),o=a[1],i=a[2],r=a[3],s=a[4],l=c(function(e){return e.page===o&&e.name===i});if(!l)return e;var u="";switch(r){case"attribute":var d=l.element.getAttribute(s);"string"==typeof d&&(d=JSON.stringify(d)),u=d;break;case"property":var p=l.modelProperties.filter(function(e){return e.name===s})[0];if(p&&p.getter===!0)u="$store.pages."+o+"."+i+"."+s;else{var m=l.element[s];"string"==typeof m&&(m=JSON.stringify(m)),u=m}}return u}):e}function u(t,n,a){t.explicitlySetAttributes||(t.explicitlySetAttributes=[]),t.explicitlySetAttributes.push(n),t.element.setAttribute(n,a),e.$broadcast("StoreChanged")}function d(t,n,a,o){t.element[a]=g(n,o),e.$broadcast("StoreChanged")}function p(e,n,a,o){e.attributes&&angular.forEach(e.attributes,function(i,r){if(!e.explicitlySetAttributes||e.explicitlySetAttributes.indexOf(r)===-1){var s=(e.component.annotations.attributes||[]).filter(function(e){return e.name===r})[0];if(s){var c=!1;if(angular.isObject(i)&&(i=JSON.stringify(i)),angular.isString(i)&&i.indexOf("{{")!==-1){var l={$store:window.cti.store};a&&angular.extend(l,a),c=!0,i=t(i)(l)}(o||c)&&n.setAttribute(r,i)}}})}function m(e,t){var o=n.get("StoreFactory");angular.forEach(e.modelProperties,function(n){n.storeKey="pages."+e.page+"."+e.name+"."+n.name;var i=o.get(n.storeKey);void 0===i&&o.set(n.storeKey,void 0),n.updateStore=function(){var t=e.element[n.name],a=o.get(n.storeKey);t!==a&&o.set(n.storeKey,t)},n.updateElement=function(){if(n.getter){var t=e.element[n.name],a=o.get(n.storeKey);t!==a&&(e.element[n.name]=a)}else e.element[n.name]=o.get(n.storeKey)},n.setter===!0&&(t.$watch(function(){return o.get(n.storeKey)},function(){a(function(){n.updateElement()})}),n.updateElement()),n.getter===!0&&angular.forEach(n.changeEvents,function(t){e.element.addEventListener(t,function(){a(function(){n.updateStore()})})})})}function g(e,t){if(null===t||void 0===t)return t;switch((e||"").toLowerCase()){case"bool":case"boolean":return"true"===(t||"").toLowerCase();case"number":return parseFloat(t||"0");case"integer":return parseInt(t||"0",10);default:return t.toString()}}function f(t,a,r){angular.forEach(r,function(r){function s(){var e=n.get("StoreFactory").evaluate(c.expressions.show);e===!0?u[0].classList.remove("ng-hide"):u[0].classList.add("ng-hide")}if("component"===r.type){var c=r,l=t.components.filter(function(e){return e[o.ITEM_AUTO_ID_PROPERTY]===c.componentId})[0],u=null,d=[];if(l&&l.valid){u=angular.element("<"+l.tagName+' id="'+c.name+'"></'+l.tagName+">");var p=c.content;if(angular.isString(p)&&(p=i.rewriteAssetPaths(p),u.append(p)),c.expressions&&Object.keys(c.expressions).length>0&&c.expressions&&c.expressions.show&&(s(),e.$on("StoreChanged",function(){s()})),l.annotations.events&&c.actions){var m=c.actions.filter(function(e){var t=l.annotations.events.filter(function(t){return t.name===e.event})[0];return!!t});angular.forEach(l.annotations.events,function(e){u.bind(e.name,function(t){var a={type:t.type,target:t.target,detail:t.detail};n.get("ActionFactory").triggerEvent(e.name,m,a,t)})})}d=v(l)}else u=angular.element('<div style="color: red; border: 1px solid red; padding: 10px; margin: 10px 0;">Invalid component "'+l.name+'". Please edit this component for further details.</div>');var g=c[o.ITEM_AUTO_ID_PROPERTY],y={page:a.name,name:c.name,id:g,component:l,element:u[0],attributes:c.attributes,modelProperties:d};h.push(y),angular.isArray(r.content)&&f(t,a,r.content)}else angular.isArray(r.content)&&f(t,a,r.content)})}function v(e){var t=[];if(e.annotations&&angular.isArray(e.annotations.properties)&&(t=t.concat(e.annotations.properties.map(function(e){return{property:e,config:e.modelConfig}}))),e.userConfig&&e.userConfig.properties){var n=e.userConfig.properties;for(var a in n)if(n.hasOwnProperty(a)&&n[a].modelConfig){var o=e.annotations.properties.filter(function(e){return e.name===a})[0];o&&t.push({property:o,config:n[a].modelConfig})}}var i=[],r=t.filter(function(e){return e.config.store===!0});return angular.forEach(r,function(e){i.push({name:e.property.name,getter:e.property.getter,setter:e.property.setter,changeEvents:e.config.changeEvents})}),i}var h=[];return{registerComponentInstances:r,getComponentById:s,getComponentByPredicate:c,replaceComponentExpressions:l,setAttributeValueFromAction:u,setPropertyValueFromAction:d,
setUpComponentAttributes:p,setUpComponentBindings:m,getTypedValue:g,___getComponentRegistrations:function(){return h},___setComponentRegistrations:function(e){h=e}}}]),angular.module("app.core").factory("ValidationFactory",["$log","StoreFactory",function(e,t){return{isValid:function(n,a,o,i){var r=!0;switch(a.type){case"regex":if(n){var s=new RegExp(a.content);r=s.test(n)}break;case"expression":if(!n)return!0;var c=angular.copy(a.content);"string"==typeof n&&(n=JSON.stringify(n));var l="$store.pages."+o+"."+i;if(c.indexOf(l)!==-1){var u=l.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");c=c.replace(new RegExp(u,"g"),n)}var d=c.match(/(\$store\.pages\.\w*\.\w*)/g);angular.forEach(d,function(e){var n=t.evaluate(e);"string"==typeof n&&(n=JSON.stringify(n)),c=c.replace(e,n)}),r=t.evaluate(c);break;default:e.error("Invalid validation type specified.")}return r}}}]),angular.module("app.core").factory("TranslationService",["$rootScope","$q","$timeout","$window","$filter","$locale","$log","Plugin","Platform","SchemaHelper","StoreFactory","tmhDynamicLocale","gettextCatalog","nyaBsConfig",function(e,t,n,a,o,i,r,s,c,l,u,d,p,m){function g(){var n=sessionStorage.getItem("debug");if(n){var a=n.split("|");E=a.indexOf("*")!==-1||a.indexOf("translations")!==-1}var o=t.defer(),i=l.getLanguageSettings(),r=i.initialLanguage,s=i.defaultLocale,c=i.useDeviceLocale;p.debug=E,p.baseLanguage=s,d.setLocaleLocationPattern(e.basedir+"assets/i18n/angular-locale_{{ locale }}.js");var m=!1,g=sessionStorage.getItem(x);if(null===g){var f=u.get($);void 0!==f&&null!==f||(m=!0),g=f||r}else sessionStorage.removeItem(x);return y(c,m,g,r,s).then(function(t){u.set($,t),b(t,s).then(function(e){return w(e,s)}).then(function(e){return A(e)}).then(function(t){e.currentLanguage=t,o.resolve()})}),o.promise}function f(e){void 0===e&&(e="");var t=u.get($);t!==e&&(sessionStorage.setItem(x,e),a.location.reload())}function v(e){return p.hasTranslation(e)}function h(e){return e instanceof Array?e.map(function(e){return o("translate")(e)}):"string"==typeof e?o("translate")(e):e}function y(e,n,a,o,i){function r(e){return e.replace(/-/g,"_").toLowerCase()}function u(e,t){var n=(e||"").toLowerCase();if(!n||n===i.toLowerCase())return t;var a=l.getSchemaConfigItemsByItemType("language"),o=[];if(angular.forEach(a,function(e){e.localeId&&o.push(e.localeId.toLowerCase())}),o.sort(),S("Available localeIds:",o),o.indexOf(n)!==-1)return e;n.indexOf("_")!==-1&&(n=n.substring(0,n.indexOf("_")));for(var r="",s=0;s<o.length&&!r;s++)0===o[s].indexOf(n)&&(r=o[s]);return r||t}var d=t.defer();if(e)if(n)if("desktop"===c.getType()){S('Obtained desktop language: "'+navigator.language+'"');var p=r(navigator.language),m=u(p,o);S('Resolved desktop language to: "'+m+'"'),d.resolve(m)}else{var g=s.getSource("globalization");g&&"function"==typeof g.getPreferredLanguage?g.getPreferredLanguage(function(e){S('Obtained device language: "'+e.value+'"');var t=r(e.value),n=u(t,o);S('Resolved device language to: "'+n+'"'),d.resolve(n)},function(){d.resolve(a)}):d.resolve(a)}else S('Language code already established: "'+a+'"'),d.resolve(a);else S('Bypassing device locale; returning stored language: "'+a+'"'),d.resolve(a);return d.promise}function b(n,a){var o=t.defer();if(n)if(n.toLowerCase()===a.toLowerCase())S("Language code matches default locale; skipping translation"),p.setCurrentLanguage(a),o.resolve("");else{for(var i=l.getSchemaConfigItemsByItemType("language"),s=null,c=0;c<i.length&&null===s;c++)i[c].localeId&&i[c].localeId.toLowerCase()===n.toLowerCase()&&(s=i[c]);if(null===s)r.error('Could not find language matching locale id "'+n+'"; skipping translation'),p.setCurrentLanguage(a),o.resolve("");else{var u=e.assetDir+s.fileName;S('loading translation file "'+u+'"'),p.loadRemote(u).then(function(){S('setting language to "'+n+'"'),p.setCurrentLanguage(n),o.resolve(n)})["catch"](function(){r.error('Could not load translation file "'+u+'"; skipping translation'),p.setCurrentLanguage(a),o.resolve("")})}}else S("Default language; skipping translation"),p.setCurrentLanguage(a),o.resolve("");return o.promise}function w(e,n){var a=t.defer();e||(e=n);var o=e.replace(/_/g,"-").toLowerCase();return S('loading locale "'+o+'"'),d.set(o).then(function(){a.resolve(e)})["catch"](function(){var e=p.baseLanguage.replace(/_/g,"-").toLowerCase();r.error('Could not load locale file for locale "'+o+'"; Reverting to "'+e+'"'),d.set(e).then(function(){a.resolve(p.baseLanguage)})}),a.promise}function A(e){var n=t.defer();m.defaultNoneSelection=h(m.defaultNoneSelection),m.noSearchResult=h(m.noSearchResult);var a=angular.element.prototype.pickadate;a.defaults.monthsFull=i.DATETIME_FORMATS.STANDALONEMONTH,a.defaults.monthsShort=i.DATETIME_FORMATS.SHORTMONTH,a.defaults.weekdaysFull=i.DATETIME_FORMATS.DAY,a.defaults.weekdaysShort=i.DATETIME_FORMATS.SHORTDAY,a.defaults.today=h(a.defaults.today),a.defaults.clear=h(a.defaults.clear),a.defaults.close=h(a.defaults.close);var o=angular.element.prototype.pickatime;return o.defaults.amSmall=i.DATETIME_FORMATS.AMPMS[0],o.defaults.amLarge=i.DATETIME_FORMATS.AMPMS[0],o.defaults.pmSmall=i.DATETIME_FORMATS.AMPMS[1],o.defaults.pmLarge=i.DATETIME_FORMATS.AMPMS[1],o.defaults.clear=h(o.defaults.clear),n.resolve(e),n.promise}function S(){if(E===!0&&void 0!==arguments){var e=Array.prototype.slice.call(arguments);e.length>0&&"string"==typeof e[0]&&(e[0]="[translation.fct.js] "+e[0]),r.log.apply(r,e)}}var $="currentLanguageCode",x="newLanguageCode",E=!1;return{init:g,setLanguage:f,hasTranslation:v,translate:h}}]),angular.module("app.core").factory("StoreFactory",["$rootScope","$parse","$interval","$interpolate","$log","$q","localStorageService","StoreProvider","$timeout","$injector","AssetFactory","ComponentFactory","Utilities",function(e,t,n,a,o,i,r,s,c,l,u,d,p){function m(e,n){return 0===e.indexOf("$store.")&&(e=e.replace(/\$store./g,"")),t(e)(window.cti.store,n)}function g(e,t){var n=t.controller("mdContextProvider"),a=n?n.getContextItemData("$data"):null;return m(e,a)}function f(e,n,a,o){0===e.indexOf("$store.")&&(e=e.replace("$store.",""));var i=t(e),r=i.assign;r(a||window.cti.store,n);var s=o?0:null;return L(s)}function v(e,t,n,a){var o=n.controller("mdContextProvider"),i=o?o.getContextItemData("$data"):null;return f(e,t,i,a)}function h(e,n){var a=t(e)(window.cti.store);return void 0==a&&(a=[]),a.push(n),f(e,a),L(),t(e)(window.cti.store)}function y(e,n){var a=t(e)(window.cti.store);void 0!=a&&void 0!=a[n]&&a.splice(n,1),f(e,a),L()}function b(){var e=i.defer();return R.get(O+"_data").then(function(t){U=t._rev,window.cti.store=_(angular.copy(M),t.data),void 0!==s.options.initialData&&(window.cti.store=_(window.cti.store,s.options.initialData)),e.resolve()})["catch"](function(){R.put({_id:O+"_data",data:angular.copy(M)}).then(function(t){void 0!==s.options.initialData&&(window.cti.store=_(window.cti.store,s.options.initialData)),U=t.rev,e.resolve()})["catch"](function(t){o.error(t),e.reject(t)})}),e.promise}function w(){null!==O&&r.remove(O+"_stack"),null!==R&&R.destroy().then(function(){window.location.reload()})["catch"](function(){o.error("Could not remove database.")})}function A(e){void 0!==e?f("pages."+e,{}):f("pages",{})}function S(e,t){var n=i.defer();return O=e,R=new PouchDB(O,{revs_limit:10}),void 0!==t.settings&&t.settings.encryption===!0?N(e).then(function(e){return R.crypto({key:e}),i.resolve()}).then(function(){return b()}).then(function(){f("schema",angular.copy(t)),n.resolve()})["catch"](function(e){n.reject(e)}):b().then(function(){f("schema",angular.copy(t)),n.resolve()})["catch"](function(e){n.reject(e)}),n.promise}function $(){var e=i.defer();return q=new PouchDB(j,{revs_limit:10}),N(j).then(function(t){return q.crypto({key:t}),i.resolve().then(function(){q.allDocs({include_docs:!0}).then(function(t){if(0===t.total_rows){var n=p.uuid();q.put({_id:"instance_id",data:n}).then(function(){e.resolve()})["catch"](function(t){o.error(t),e.reject(t)})}else e.resolve()})["catch"](function(t){o.error(t),e.reject(t)})})})["catch"](function(t){e.reject(t)}),e.promise}function x(e,t){if(!e)throw new Error("key cannot be empty");var n=i.defer();return q.get(e).then(function(e){e.data===JSON.stringify(t)?n.resolve():(e.data=t,q.put(e).then(function(){n.resolve()})["catch"](function(e){o.error(e),n.reject(e)}))})["catch"](function(a){return 404===a.status?void q.put({_id:e,data:t}).then(function(){n.resolve()})["catch"](function(e){o.error(e),n.reject(e)}):(o.error(a),void n.reject(a))}),n.promise}function E(e){if(!e)throw new Error("key cannot be empty");var t=i.defer();return q.get(e).then(function(e){t.resolve(e.data)})["catch"](t.reject),t.promise}function T(t,n){function a(t){return t.indexOf("$component")!==-1&&(t=d.replaceComponentExpressions(t)),e.$eval(t,o)}var o={$store:window.cti.store};return n&&angular.isObject(n)&&(o=angular.extend(o,n)),"object"==typeof t?angular.forEach(t,function(e,n){void 0!=e&&"string"==typeof e&&"*"!=e&&(t[n]=a(t[n]))}):void 0!=t&&"*"!=t&&(t=a(t)),t}function C(e,t){var n=t.controller("mdContextProvider"),a=n?n.getContextItemData("$data"):null;return T(e,a)}function k(e,t,n){if(void 0===t&&(t={}),void 0===t.$store&&(t.$store=window.cti.store),"object"==typeof e?angular.forEach(e,function(a,o){"string"==typeof a&&a.indexOf("{{")>-1?e[o]=k(e[o],t,n):"object"==typeof a&&angular.toJson(a).indexOf("{{")>-1&&(e[o]=k(e[o],t,n))}):e&&"*"!==e&&(e.indexOf("$component")!==-1&&(e=d.replaceComponentExpressions(e)),e=a(e)(t)),n===!1)return e;try{return angular.fromJson(e)}catch(o){return e}}function F(e,t){if(e.indexOf("{{")>-1&&(e=k(e)),void 0!=t&&0!==Object.getOwnPropertyNames(t).length){var n="?";angular.forEach(t,function(e,t){"?"!=n&&(n+="&"),e.indexOf("{{")>-1&&(e=k(e)),n+=t+"="+encodeURI(e)}),e+=n}return e}function I(){var e=angular.copy(window.cti.store);return e.schema=void 0,e}function L(e){if(void 0!==e&&null!==e||(e=250),null!==O&&null!==R&&null!==U){null===G&&(G=i.defer()),null!==V&&c.cancel(V);var t=function(){o.debug("SAVING AT REVISION:",U),R.put({_id:O+"_data",_rev:U,data:I()}).then(function(e){U=e.rev,null!==G&&(G.resolve(),G=null)})["catch"](function(n){void 0!==n.status&&409==n.status?(o.debug("Caught document update conflict",n),c(t,e)):(o.error(n),null!==G&&(G.reject(n),G=null))})};return V=c(function(){t()},e),G.promise}}function P(e){if(void 0!=e.name&&void 0!=e.content)try{var t=[];void 0!=e.params&&e.params.length>0&&angular.forEach(e.params,function(e){t.push(e.name)}),t.push("$success"),t.push("$fail"),t.push("$store");var n=u.rewriteAssetPaths(e.content);window.cti[e.name]=new Function(t,n),window.cti[e.name].prototype.sync=e.sync===!0}catch(a){o.info("Couldn not successfully eval function code (store.fct.js:148): "),o.error(a)}}function _(e,t){return angular.forEach(t,function(n,a){"$event"===a?e.$event=n:"object"!=typeof n||null===n?e[a]=n:(void 0==e[a]&&("[object Array]"===Object.prototype.toString.call(t[a])?e[a]=[]:e[a]={}),e[a]=_(e[a],n))}),e}function D(e){window.cti.store=_(window.cti.store,e),L()}function N(e){var t=i.defer(),n=l.get("Plugin"),a=n.getSource("securesettings");if(a)a.getOrCreateCryptographicKey(function(e){function n(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t}var a=window.Buffer.from(n(e));t.resolve(a)},t.reject,e,256);else{var o,r=localStorage.getItem(e+"_key");if(null!==r)o=window.Buffer.from(JSON.parse(r)),t.resolve(o);else{var s,c=[];if(window.crypto&&window.crypto.getRandomValues){var u=new Uint8Array(32);for(window.crypto.getRandomValues(u),s=0;s<32;s++)c[s]=u[s]}else for(s=0;s<32;s++)c[s]=Math.floor(256*Math.random());localStorage.setItem(e+"_key",JSON.stringify(c)),o=window.Buffer.from(c),t.resolve(o)}}return t.promise}var O=null;window.cti.store={env:{},language:"en_GB",state:{},api:{},offlineApi:{},azureAppServices:{},xmpp:{},messageQueues:{listeningTo:[]},geofences:{},plugin:{},repeater:{},schema:{},media:{},notification:{},xcallback:{success:"",error:"",cancel:"",source:""},variables:{today:new Date},pages:{}};var M=angular.copy(window.cti.store),R=null,U=null,j="infinity_app_settings_v3",q=null,B={init:S,evaluate:T,evaluateForElement:C,parse:k,get:m,getForElement:g,set:f,setForElement:v,push:h,remove:y,setFunction:P,parseUrl:F,save:L,destroyAllData:w,destroyPageData:A,merge:_,mergeInitialData:D,getId:function(){return O},initSettingsDb:$,setSetting:x,getSetting:E,getEncryptionKey:N},V=null,G=null;e.$watch(function(){return window.cti.store},function(t,n){t!=n&&(L(),e.$broadcast("StoreChanged"),document.dispatchEvent(new CustomEvent("StoreChanged")))},!0);var H=function(){e.$$phase||e.$apply()};return document.addEventListener("StoreHasChanged",H),e.$on("StoreHasChanged",H),document.addEventListener("SaveToStore",function(e){var t=e.detail.key,n=e.detail.data;void 0!==t&&f(t,n)}),B}]).filter("store",["StoreFactory","$filter",function(e,t){var n=function(n,a){if(void 0!=n){var o=e.evaluate(n);return angular.isArray(o)&&void 0!=a&&(o=t("filter")(o,a)),o}};return n.$stateful=!0,n}]).filter("trust",["$sce",function(e){var t=function(t){return e.trustAsHtml(t)};return t.$stateful=!0,t}]),angular.module("app.core").provider("StoreProvider",function(){this.options={},this.set=function(e,t){switch(e){case"initialData":this.options.initialData=t}};var e=this;this.$get=function(){return{options:e.options,set:e.set}}}),angular.module("app.core").factory("Plugin",["$http","$log","$q","StoreFactory","$interval","electron",function(e,t,n,a,o,i){function r(e,t,n,i){if(this.name=e,this.events=[],this.polls=[],this.operations=i,void 0!=t&&(this.events=t,this.events.length>0)){var r=this;angular.forEach(this.events,function(e){window.addEventListener(e.name,function(t){a.set("plugin."+r.name+"."+e.name,t)})})}if(void 0!=n&&(this.polls=n,this.polls.length>0)){var s=this;angular.forEach(this.polls,function(e){o(function(){s.callAction(e.action,e.params,e.options)},e.interval)})}}return r.prototype={callAction:function(e,o){var i=this,s=n.defer(),c=[];angular.forEach(this.operations,function(t){t.name==e&&void 0!=t.params&&(c=angular.copy(t.params))});var l=function(t){a.set("plugin."+i.name+"."+e,t),s.resolve(t)},u=function(e){t.error(e),s.reject(e)},d=[];angular.forEach(c,function(e){var t=null;switch(e.name){case"$successCallback":t=l;break;case"$errorCallback":t=u;break;default:t=void 0!=o[e.name]?o[e.name]:e["default"]}null!==t&&d.push(t)});var p=r.getSource(this.name);if(p!==!1&&void 0!=p[e])try{p[e].apply(null,d)}catch(m){s.reject(m),t.error(m)}else s.reject("Could not call action");return s.promise}},r.getSource=function(e){if(void 0!==window[e])return window[e];if(void 0!==window.cordova&&void 0!==cordova[e])return cordova[e];if(void 0!==window.cordova&&void 0!==cordova.plugins&&void 0!==cordova.plugins[e])return cordova.plugins[e];if(void 0!==window.plugins&&void 0!==window.plugins[e])return window.plugins[e];if(void 0!==navigator&&void 0!==navigator[e])return navigator[e];if(void 0===i.app)return t.info("Plugin '"+e+"' is not available."),!1;var n=!1;try{return n=require(e)}catch(a){if(n===!1||void 0===n){var o=e.replace(/\-/g,"").toLowerCase();try{return n=require("@commontimeltd/com.commontime."+o)}catch(a){return!1}}return!1}},r}]),angular.module("app.core").factory("OptionFactory",["$rootScope","$parse","localStorageService",function(e,t,n){function a(e){return t(e)(r)}function o(e){i=e;var t=n.get(e+"_options");null!==t&&(r=t)}var i=null,r={},s={init:o,get:a};return s}]),angular.module("app.core").factory("Api",["$http","$log","$q","$timeout","$injector","$httpParamSerializer","StoreFactory","Utilities","FileSystem","MimeTypes",function(e,t,n,a,o,i,r,s,c,l){function u(e,t,n,a,o){this.name=e,this.url=t,this.params=n,this.headers=a,this.operations=o}return u.prototype={buildRequestObject:function(e,t,a){var o=n.defer(),s=this,c=s.url;"string"==typeof c&&c.indexOf("{{")>-1&&(c=r.parse(c));var l={url:c+e.path,method:e.method||"GET",params:{},headers:{}},u=["POST","PUT","CONNECT","PATCH"];u.indexOf(l.method)!==-1&&e["content-type"]&&(l.headers["Content-Type"]=e["content-type"]);var d=["POST","PUT","CONNECT","PATCH"];d.indexOf(l.method)!==-1&&(l.data={}),"JSONP"==l.method&&(l.params.callback="JSON_CALLBACK");var p=n.when(),m=[p];return angular.forEach(s.params,function(e){m.push(s.constructParameter(e,t,l,a))}),n.all(m).then(function(){return m=[p],angular.forEach(e.params,function(e){m.push(s.constructParameter(e,t,l,a))}),n.all(m)}).then(function(){"application/x-www-form-urlencoded"==l.headers["Content-Type"]&&(l.data=i(l.data)),e.downloadAsFile===!0&&(l.responseType="arraybuffer"),o.resolve(l)})["catch"](function(e){o.reject(e)}),o.promise},constructParameter:function(e,a,o,i){var s=n.defer(),l=void 0;if(a&&void 0!==a[e.name]&&""!==a[e.name]?l=a[e.name]:void 0!==e["default"]?l=e["default"]:e.required===!0&&s.reject("Parameter '"+e.name+"' must be provided."),e.typeConfig=e.typeConfig||{},void 0!==l){"string"==typeof l&&l.indexOf("{{")>-1&&(l=r.parse(l));var u="function"==typeof i?i(o,e,l):n.when(!1);u.then(function(n){if(n)s.resolve();else switch(e["in"]){case"path":o.url=o.url.replace("{{"+e.name+"}}",l),s.resolve();break;case"query":o.params[e.name]=l,s.resolve();break;case"header":o.headers[e.name]=l,s.resolve();break;case"body":if(!o.data){s.reject("Unable to add parameter '"+e.name+"' to body of "+o.method.toUpperCase()+" request");break}o.data[e.name]=l,s.resolve();break;case"formData":if(!o.data){s.reject("Unable to add parameter '"+e.name+"' to form data of "+o.method.toUpperCase()+" request");break}if(o.data instanceof FormData||(o.data=new FormData),o.headers["Content-Type"]=void 0,"file"===e.type)try{var a=c.getFileNameFromPath(l);c.getFileBlob(a).then(function(t){if(e.typeConfig.fileNameParameterName&&o.data.append(e.typeConfig.fileNameParameterName,a),e.typeConfig.base64encode===!0){var n=new FileReader;n.onloadend=function(t){var n=t.target.result;o.data.append(e.name,n),s.resolve()},n.readAsDataURL(t)}else o.data.append(e.name,t,a),s.resolve()})["catch"](function(e){t.error(e),s.reject(e)})}catch(i){t.error(i),s.reject(i)}else o.data.append(e.name,l),s.resolve();break;default:s.reject("Unknown parameter location")}})}else s.resolve();return s.promise},makeRequest:function(t,a,i){function r(e){if(void 0!==i){var t=o.get("ActionFactory");t.triggerEvent("success",i,{$response:e})}}function s(e){if(void 0!==i){var t=o.get("ActionFactory");t.triggerEvent("fail",i,{$response:e})}}var c=n.defer(),l=this,u=l.operations.filter(function(e){return e.name===t});if(u.length>0){var d=u[0];l.buildRequestObject(d,a).then(function(t){return e(t)}).then(function(e){d.downloadAsFile===!0?l.handleFileDownload(e,d).then(function(e){c.resolve(e),c.promise.then(function(e){r(e)})})["catch"](function(e){s(),c.reject(e)}):(c.resolve(e.data),c.promise.then(function(e){r(e)}))})["catch"](function(e){s(e),c.reject(e)})}else c.reject("Requested operation could not be found.");return c.promise},handleFileDownload:function(e,t){var a=n.defer(),o=e.headers("Content-Type").split(";")[0].trim(),i="";if((t.downloadFileName||"").trim().length>0)i=t.downloadFileName;else{i=s.uuid();var r=l.extensionFromMimeType(o);null!==r&&(i+="."+r)}return c.saveFile(i,e.data).then(function(e){a.resolve(e)})["catch"](function(e){a.reject(e)}),a.promise}},u.merge=function(e,t){var n={};return void 0!=e&&(n=e),void 0!=t&&angular.forEach(t,function(e,t){"object"!=typeof e?n[t]=e:(void 0==n[t]&&(n[t]={}),n[t]=u.merge(n[t],e))}),n},u}]),angular.module("app.core").factory("ApiFactory",["$http","$log","StoreFactory","$timeout","$q","Api","LoadingStatus",function(e,t,n,a,o,i,r){function s(e){l[e.name]=new i(e.name,e.url,e.params,e.headers,e.operations,e.actions)}function c(e,i){var s=o.defer(),c=e.name;return void 0!=l[c]&&(r.disabled!==!0&&(r.loading=!0,r.message=u.message),n.set("state.loading",!0),l[c].makeRequest(e.operation,e.params,i).then(function(t){n.set("api."+c+"."+e.operation,t).then(function(){a(function(){r.disabled!==!0&&(r.loading=!1),n.set("state.loading",!1)},1e3),s.resolve(t)})["catch"](function(e){s.reject(e)})})["catch"](function(e){t.error(e),n.set("state.loading",!1),s.reject(e),r.disabled!==!0&&(r.loading=!1,r.error="There was an error retrieving data")})),s.promise}var l={},u={loading:!1,error:!1,message:"Loading data..."};return{init:s,makeRequest:c}}]),angular.module("app.core").service("AssetFactory",["$rootScope","$injector","$http","angularLoad",function(e,t,n,a){function o(o){var i=e.assetDir+o,s=t.get("SchemaService");s.isPreview()||s.isLivePreview()?n.get(i).then(function(e){var t=document.createElement("script");t.textContent=r(e.data),document.body.appendChild(t)}):a.loadScript(i)}function i(t){var a=e.assetDir+t;n.get(a).then(function(e){var t=document.createElement("style");t.textContent=r(e.data),document.head.appendChild(t)})}function r(t){if(e.assetDir){var n=e.assetDir.replace(/\\/g,"/");return t.replace(/user-assets\//g,n)}return t}return{injectJsAsset:o,injectCssAsset:i,rewriteAssetPaths:r}}]),angular.module("app.core").factory("AudioRecordingFactory",["$q","Plugin","FileSystem",function(e,t,n){function a(){var t=e.defer();return null!==s&&c==r.MEDIA_RUNNING?i().then(function(){s=null,t.resolve()})["catch"](function(){s=null,t.resolve()}):t.resolve(),t.promise}function o(){var t=e.defer();return a().then(function(){n.generateFileName().then(function(e){s=new r(e,function(){},function(e){t.reject(e)},function(e){c=e,"function"==typeof l&&l()});var n={SampleRate:44100,NumberOfChannels:1};s.startRecordWithCompression(n),t.resolve()})}),t.promise}function i(){var t=e.defer();if(null===s||c!=r.MEDIA_RUNNING)t.reject("Audio not currently recording.");else{s.stopRecord();var n=s.src;s.release(),l=function(){c==r.MEDIA_STOPPED&&(l=null,t.resolve(n))}}return t.promise}var r=t.getSource("Media"),s=null,c=r.MEDIA_STOPPED,l=null;return document.addEventListener("stop-all-recording",i),{startRecordingWithCompression:o,stopRecording:i}}]),angular.module("app.core").factory("PluginFactory",["Plugin","$timeout","StoreFactory","LoadingStatus","$q",function(e,t,n,a,o){function i(t){s[t.name]=new e(t.name,t.events,t.polls,t.operations)}function r(e,i,r){var l=o.defer();a.loading=!0,a.message=c.message;var u=n.parse(angular.copy(r));return s[e].callAction(i,u).then(function(){t(function(){a.loading=!1},1e3),l.resolve()})["catch"](function(){a.loading=!1,a.error="There was an error calling the plugin",l.reject()}),l.promise}var s={},c={loading:!1,error:!1,message:"Calling plugin..."},l={init:i,callAction:r};return l}]),angular.module("app.core").value("LoadingStatus",{loading:!1,error:!1,message:"Loading data...",disabled:!1}),angular.module("app.core").factory("ActionFactory",["$injector","$q","$timeout","StoreFactory","ApiFactory","PluginFactory","$rootScope","$location","$log","UrlFactory","toastr","VariableFactory","Router","Camera","AudioRecordingFactory","Notification","$parse","IBeaconFactory","GeofenceFactory","XmppFactory","MessageQueueFactory","SchemaHelper","FileSystem","MimeTypes","TranslationService","ActionflowFactory","DataflowFactory","AzureAppServicesFactory","RestFactory","AudioPlayer","ComponentFactory","GoogleMapService","DirectiveBridge","ListFactory","LoggingFactory","VibrateFactory","Plugin","Platform","AssetFactory",function($injector,$q,$timeout,StoreFactory,ApiFactory,PluginFactory,$rootScope,$location,$log,UrlFactory,toastr,VariableFactory,Router,Camera,AudioRecordingFactory,Notification,$parse,IBeaconFactory,GeofenceFactory,XmppFactory,MessageQueueFactory,SchemaHelper,FileSystem,MimeTypes,TranslationService,ActionflowFactory,DataflowFactory,AzureAppServicesFactory,RestFactory,AudioPlayer,ComponentFactory,GoogleMapService,DirectiveBridge,ListFactory,LoggingFactory,VibrateFactory,Plugin,Platform,AssetFactory){function evalOperation(e){var t=null;switch(e.type){case"value":if(angular.isNumber(e.content)||parseInt(e.content)||parseFloat(e.content))t=" "+e.content;else{var n=angular.isString(e.content)?e.content.replace(/"/g,'\\"'):e.content;t=' "'+n+'"'}break;case"operator":case"connector":t=" "+e.content}return t}function evalOperations(e,t){var n=!1;if(void 0!==e&&e.length>0){e=void 0===t?StoreFactory.parse(e):StoreFactory.parse(e,{$data:t},!1);var a="";angular.forEach(e,function(e){a+=evalOperation(e)});try{n=$parse(a)({})}catch(o){$log.error("Could not evaluate the logic expression")}}return n}function triggerEvent(e,t,n,a){var o=$q.when(),i=0,r={},s={},c=0;void 0!==n&&null!==n||void 0===a||null===a||(n={keyCode:a.keyCode,ctrlKey:a.ctrlKey,shiftKey:a.shiftKey},a.target&&a.target.hasOwnProperty("value")&&(n.value=a.target.value));var l=function(e){return!(e>0)||r[e-1]!==!1&&l(e-1)};return angular.forEach(t,function(t){if(null===e||!t.event||t.event===e)switch(t.type){case"if":o=o.then(function(e){var a=void 0===e&&0===c?n:e;return i++,void 0!==t.operations&&t.operations.length>0&&(r[i]=evalOperations(angular.copy(t.operations),a),r[i-1]!==!1&&s[i]!==!0&&r[i]===!0&&(s[i]=!0)),$q.when(a)});break;case"end-if":o=o.then(function(e){var t=void 0===e&&0===c?n:e;return delete s[i],delete r[i],i--,$q.when(t)});break;case"otherwise":o=o.then(function(e){var t=void 0===e&&0===c?n:e;return r[i]=s[i]!==!0,$q.when(t)});break;case"otherwise-if":o=o.then(function(e){var a=void 0===e&&0===c?n:e;return s[i]===!0?r[i]=!1:(void 0!==t.operations&&t.operations.length>0&&(r[i]=evalOperations(angular.copy(t.operations),a)),r[i]===!0&&(s[i]=!0)),$q.when(a)});break;default:o=o.then(function(e){var a=void 0===e&&0===c?n:e;return r[i]!==!1&&l(i)?(c++,call(t,a)()):$q.when(a)})}}),i=0,r={},s={},o}function evalExpressions(e,t){return angular.forEach(e,function(e,n){"expressions"!=n&&("object"==typeof e?t[n]=evalExpressions(e,t[n]):t[n]=StoreFactory.evaluate(e))}),t}function call(originalAction,$data){var parsedAction=angular.copy(originalAction);"loop"!==parsedAction.type&&(parsedAction=StoreFactory.parse(parsedAction,{$data:$data}));var $store=window.cti.store;return function(){function success(e){_success(100*e)}function fail(e){_error("Could not get device volume: "+e)}var deferred=$q.defer(),_success=function(e){deferred.resolve(e)},_error=function(e,t,n){$log.error('Error in action "'+originalAction.type+'"\n\n',e,"\n\nAction schema:",originalAction,"\n\nParsed action schema:",parsedAction),void 0!==t&&null!==t&&$log.error(t),n===!0?deferred.reject():deferred.resolve(e)};void 0!==parsedAction.expressions&&(parsedAction=evalExpressions(parsedAction.expressions,parsedAction));var SchemaService=$injector.get("SchemaService");switch(parsedAction.type){case"set-layers":!function(){var e=DirectiveBridge.getItemApi(parsedAction.data.page,parsedAction.data.map),t=parsedAction.data.layer;e?t&&e.setMapLayers(t,parsedAction.data.show)?_success($data):_error("Could not find layer: "+t):_error("Could not find map: "+parsedAction.data.map+" on "+parsedAction.data.page+".")}();break;case"set-map-type":!function(){var e=DirectiveBridge.getItemApi(parsedAction.data.page,parsedAction.data.map),t=parsedAction.data.maptype;e&&t?(e.setMapTypeId(t),_success($data)):_error("Could not find map: "+parsedAction.data.map+" on "+parsedAction.data.page+".")}();break;case"set-controls":!function(){var e=DirectiveBridge.getItemApi(parsedAction.data.page,parsedAction.data.map),t=parsedAction.data.control,n=parsedAction.data.show;e?t&&e.setControls(t,n)?_success($data):_error("Could not find control: "+t):_error("Could not find map: "+parsedAction.data.map+" on "+parsedAction.data.page+".")}();break;case"set-location":var lat=parseFloat(parsedAction.data.lat),lng=parseFloat(parsedAction.data.lng),zoom=parseInt(parsedAction.data.zoom),pan=parsedAction.data.pan;if(isNaN(lat)||isNaN(lng)){_error($data,"No lat/lng provided");break}var api=DirectiveBridge.getItemApi(parsedAction.data.page,parsedAction.data.map);api?(api.setLocation(lat,lng,zoom,pan),_success($data)):_error("Could not find map: "+parsedAction.data.map+" on "+parsedAction.data.page+".");break;case"set-model":try{var key=parsedAction.data.location,valueOrEmpty=parsedAction.data.value||"",value="string"==typeof valueOrEmpty?valueOrEmpty:JSON.stringify(valueOrEmpty),trimmedValue=value.trim(),dataType=parsedAction.data.dataType;if(void 0!==key){var alternativeModel=null;0!==key.indexOf("$store")&&(alternativeModel={$data:$data}),""===dataType&&(dataType=0===trimmedValue.length?"empty":["true","false"].indexOf(trimmedValue.toLowerCase())!==-1?"boolean":/^[0-9]*\.?[0-9]+$/.test(trimmedValue)?"number":"["===trimmedValue[0]?"array":"{"===trimmedValue[0]?"object":"string");var typedValue;switch(dataType){default:case"string":typedValue=value;break;case"number":typedValue=parseFloat(value)||0;break;case"boolean":typedValue=["","false","0"].indexOf(trimmedValue.toLowerCase())===-1;break;case"array":try{typedValue=JSON.parse(trimmedValue),angular.isArray(typedValue)||(typedValue=[])}catch(e){typedValue=[]}break;case"object":try{typedValue=JSON.parse(trimmedValue),angular.isObject(typedValue)||(typedValue={})}catch(e){typedValue={}}break;case"empty":typedValue=void 0}StoreFactory.set(key,typedValue,alternativeModel,!0).then(function(){alternativeModel&&$rootScope.$broadcast("StoreChanged")}),_success($data)}else _error("Model location has not been specified.")}catch(e){_error(e)}break;case"set-preference":localStorage.setItem(parsedAction.data.key,parsedAction.data.value),SchemaService.setUpPreferences();break;case"reset-preference":localStorage.removeItem(parsedAction.data.key),SchemaService.setUpPreferences();break;case"change-language":TranslationService.setLanguage(parsedAction.data.language);break;case"upload-file":!function(){var e=parsedAction.data.filePath,t=FileSystem.getFileNameFromPath(e),n=parsedAction.data.uploadUrl,a=parsedAction.data.saveResponseInModel,o=parsedAction.data.modelLocation,i={httpMethod:parsedAction.data.uploadMethod||"POST",fileName:t,fileKey:parsedAction.data.fileParameterName||"source"};FileSystem.upload(e,n,i).then(function(e){return a&&StoreFactory.set(o,e.response),_success(e)})["catch"](_error)}();break;case"download-file":!function(){var e=parsedAction.data.downloadUrl,t=parsedAction.data.saveAsFileName,n=parsedAction.data.modelLocation;FileSystem.download(e,t).then(function(e){return StoreFactory.set(n,e.filePath),_success(e)})["catch"](_error)}();break;case"call-actionflow":ActionflowFactory.execute(parsedAction.data.name,$data).then(_success)["catch"](_error);break;case"call-dataflow":DataflowFactory.execute(parsedAction.data.name,$data).then(_success)["catch"](_error);break;case"call-api":parsedAction.data.sync===!0?ApiFactory.makeRequest(parsedAction.data,originalAction.actions).then(_success)["catch"](_error):(ApiFactory.makeRequest(parsedAction.data,originalAction.actions),_success($data));break;case"call-offline-api":RestFactory.makeRequest(parsedAction).then(_success)["catch"](_error);break;case"call-azure-app-service":AzureAppServicesFactory.makeRequest(parsedAction).then(_success)["catch"](_error);break;case"logout-azure-app-service":AzureAppServicesFactory.logout().then(_success)["catch"](_error);break;case"send-xmpp-message":case"resend-xmpp-message":XmppFactory.send(parsedAction.data).then(_success)["catch"](_error);break;case"send-xmpp-group-message":XmppFactory.sendToGroup(parsedAction.data).then(_success)["catch"](_error);break;case"xmpp-login":XmppFactory.login(parsedAction.data).then(_success)["catch"](_error);break;case"xmpp-logout":XmppFactory.logout(parsedAction.data).then(_success)["catch"](_error);break;case"xmpp-mark-read":XmppFactory.markRead(parsedAction.data).then(_success)["catch"](_error);break;case"xmpp-mark-acknowledged":XmppFactory.markAcknowledged(parsedAction.data).then(_success)["catch"](_error);break;case"xmpp-set-status":XmppFactory.setStatus(parsedAction.data).then(_success)["catch"](_error);break;case"start-message-queue-listening":MessageQueueFactory.startListening(parsedAction.data.name).then(_success)["catch"](_error);break;case"stop-message-queue-listening":MessageQueueFactory.stopListening(parsedAction.data.name).then(_success)["catch"](_error);break;case"send-message-queue-message":
MessageQueueFactory.sendMessage(parsedAction.data.name,parsedAction.data.message).then(_success)["catch"](_error);break;case"call-plugin":PluginFactory.callAction(parsedAction.data.name,parsedAction.data.operation,parsedAction.data.params).then(_success)["catch"](_error);break;case"call-url":UrlFactory.makeRequest(parsedAction.data).then(_success)["catch"](_error);break;case"call-x-callback-url":var url=null;switch(parsedAction.data.type){case"x-source":url=StoreFactory.get("xcallback.source");break;case"x-success":url=StoreFactory.get("xcallback.success");break;case"x-error":url=StoreFactory.get("xcallback.error");break;case"x-cancel":url=StoreFactory.get("xcallback.cancel")}url=StoreFactory.parseUrl(url,parsedAction.data.params),window.open(url,"_system"),_success(url);break;case"go-back":Router.goPrevious(),_success($data);break;case"go-to-page":var location=null;parsedAction.data.isConditional!==!0?void 0!==parsedAction.data.name&&parsedAction.data.name.length>0&&(location="/"+parsedAction.data.name):void 0!==parsedAction.data.expressions&&angular.forEach(parsedAction.data.expressions,function(e,t){null===location&&StoreFactory.evaluate(e)&&(location="/"+t)}),null!==location?Router.isInitialized?(Router.go(location),_success(location)):(Router.setFirstPage(location),_success(location)):_error($data);break;case"set-variable":VariableFactory.setVariable(parsedAction.data.name,parsedAction.data.value).then(function(){_success($data)})["catch"](_error);break;case"call-function":var functionItem=SchemaHelper.getSchemaConfigItemByName(parsedAction.data.name);if(parsedAction.data.name&&"function"==typeof window.cti[parsedAction.data.name]&&functionItem){void 0==parsedAction.data.params&&(parsedAction.data.params={});try{var paramsArr=[];angular.forEach(functionItem.params,function(e){var t=e.name,n=parsedAction.data.params[t];paramsArr.push(n)});var $success=function(e){void 0!==functionItem.actions&&functionItem.actions.length>0&&triggerEvent("success",functionItem.actions,e),_success(e)},$fail=function(e){void 0!==functionItem.actions&&functionItem.actions.length>0&&triggerEvent("fail",functionItem.actions,e),_error(e)};paramsArr.push($success),paramsArr.push($fail),paramsArr.push(window.cti.store),window.cti[parsedAction.data.name].apply({$success:$success,$fail:$fail},Array.prototype.slice.call(paramsArr,0)),window.cti[parsedAction.data.name].prototype.sync!==!0&&_success($data)}catch(e){_error("Couldn't successfully call function:",e)}}else _error("Specified function doesn't exist");break;case"inline-function":if(void 0!==parsedAction.data.code)try{var func=null;if(eval("func = function(){"+parsedAction.data.code+"}"),null!==func){var $success=function(e){void 0!==parsedAction.actions&&parsedAction.actions.length>0&&triggerEvent("success",originalAction.actions,e),_success(e)},$fail=function(e){void 0!==parsedAction.actions&&parsedAction.actions.length>0&&triggerEvent("fail",originalAction.actions,e),_error(e)};func.apply({$success:$success,$fail:$fail,$store:window.cti.store})}parsedAction.data.sync!==!0&&_success($data)}catch(error){_error(error)}else _error("Function code not specified.");break;case"call-component-function":!function(){var e=parsedAction.data.componentInstanceId,t=parsedAction.data["function"],n=ComponentFactory.getComponentById(e);if(!n)return void _error("Component not available");var a=(n.component.annotations.functions||[]).filter(function(e){return e.name===t})[0];if(!a)return void _error('Function "'+t+'" not available on component "'+n.name+'"');var o=n.element[t];if("function"!=typeof o)return void _error('Function "'+t+'" on component "'+n.name+'" is not a function');void 0==parsedAction.data.params&&(parsedAction.data.params={});var i=[];angular.forEach(a.params,function(e){var t=e.name,n=parsedAction.data.params[t],a=ComponentFactory.getTypedValue(e.type,n);i.push(a)});try{var r=o.apply(n.element,Array.prototype.slice.call(i,0));$q.all([r]).then(function(e){$rootScope.$broadcast("StoreChanged"),_success(e[0])})}catch(s){_error("Couldn't successfully call function \""+t+'" on component "'+n.name+'":',s)}}();break;case"set-component-variable":!function(){var e=parsedAction.data.componentInstanceId,t=parsedAction.data.variableName||"",n=(parsedAction.data.variableType||"").toLowerCase(),a=parsedAction.data.value,o=ComponentFactory.getComponentById(e);if(!o)return void _error("Component not available");var i=[];switch(n){case"attribute":i=o.component.annotations.attributes||[];break;case"property":i=o.component.annotations.properties||[]}var r=i.filter(function(e){return e.name===t})[0];if(!r)return void _error('Variable "'+r+'" not available on component "'+o.name+'"');try{if("attribute"===n)ComponentFactory.setAttributeValueFromAction(o,t,a),_success($data);else if("property"===n)if(r.setter===!0){var s=r.valueType;ComponentFactory.setPropertyValueFromAction(o,s,t,a),_success($data)}else _error('Cannot set property "'+t+'" on component "'+o.name+'": property does not have setter')}catch(c){_error("Couldn't successfully set variable \""+t+'" on component "'+o.name+'":',c)}}();break;case"add-to-collection":!function(){var e=parsedAction.data.model;if(!e)return void _error("Model location was not specified.");var t=StoreFactory.get(e);if(void 0===t)return void _error('Model location "'+parsedAction.data.model+'" does not exist.');if(!angular.isArray(t))return void _error('Model location "'+parsedAction.data.model+'" is not an array.');try{var n=void 0;if("model"===parsedAction.data.source){if(!parsedAction.data.itemModel)return void _error("Item data model location not specified");n=angular.copy(StoreFactory.get(parsedAction.data.itemModel))}else if("json"===parsedAction.data.source){if(!parsedAction.data.itemJson)return void _error("Item JSON not specified");n=parsedAction.data.itemJson}if(void 0!==n){switch(parsedAction.data.where){case"end":t.push(n);break;case"start":t.unshift(n);break;case"idx":var a=parseInt(parsedAction.data.index);if(isNaN(a))return void _error('Index "'+parsedAction.data.index+'" is not a valid index.');a>=t.length?t.push(n):t.splice(a,0,n)}StoreFactory.set(e,t),_success($data)}}catch(o){_error("Unable to process item JSON",o)}}();break;case"remove-from-collection":!function(){var e=parsedAction.data.model;if(!e)return void _error("Model location was not specified.");var t=StoreFactory.get(e);if(void 0===t)return void _error('Model location "'+parsedAction.data.model+'" does not exist.');if(!angular.isArray(t))return void _error('Model location "'+parsedAction.data.model+'" is not an array.');var n=parseInt(parsedAction.data.index);return isNaN(n)?void _error('Index "'+parsedAction.data.index+'" is not a valid index.'):n>=t.length?void _error("Index "+n+' is out of bounds of model "'+parsedAction.data.model+'" which has size: '+t.length+"."):(t.splice(n,1),StoreFactory.set(e,t),void _success($data))}();break;case"start-timer":void 0!=parsedAction.data.name&&void 0!=window.cti.__timers&&void 0!=window.cti.__timers[parsedAction.data.name]?(window.cti.__timers[parsedAction.data.name].start(),_success($data)):_error(!0);break;case"stop-timer":void 0!=parsedAction.data.name&&void 0!=window.cti.__timers&&void 0!=window.cti.__timers[parsedAction.data.name]?(window.cti.__timers[parsedAction.data.name].stop(),_success($data)):_error($data);break;case"show-notification":Notification.call(parsedAction.data).then(function(){_success($data)})["catch"](_error);break;case"take-photo":var quality=null;isNaN(parseInt(parsedAction.data.quality))||(quality=parseInt(parsedAction.data.quality));var direction=null,encoding=null;("fromDataModel"===parsedAction.data.direction&&"back"===parsedAction.data.directionFromDataModel||"back"===parsedAction.data.direction)&&(direction=0),("fromDataModel"===parsedAction.data.direction&&"front"===parsedAction.data.directionFromDataModel||"front"===parsedAction.data.direction)&&(direction=1),("fromDataModel"===parsedAction.data.encoding&&"jpeg"===parsedAction.data.encodingFromDataModel||"jpeg"===parsedAction.data.encoding)&&(encoding=0),("fromDataModel"===parsedAction.data.encoding&&"png"===parsedAction.data.encodingFromDataModel||"png"===parsedAction.data.encoding)&&(encoding=1);var processedWidth=0,processedHeight=0;parsedAction.data.width&&!isNaN(parseInt(parsedAction.data.width))&&parsedAction.data.width>0&&(processedWidth=parseInt(parsedAction.data.width)),parsedAction.data.height&&!isNaN(parseInt(parsedAction.data.height))&&parsedAction.data.height>0&&(processedHeight=parseInt(parsedAction.data.height)),Camera.takePhoto(quality,direction,processedWidth,processedHeight,encoding,parsedAction.data.allowEdit,parsedAction.data.saveToPhotoAlbum).then(function(e){if(void 0!==parsedAction.data.mediaId){var t="$store.media."+parsedAction.data.mediaId+".images",n=StoreFactory.get(t);void 0===n&&(n=[]),void 0!==parsedAction.data.index&&void 0!==n[parsedAction.data.index]?n[parsedAction.data.index]=e:parsedAction.data.multiple===!0?n.push(e):n[0]=e,StoreFactory.set(t,n),_success(n)}else _error("Could not save photo response.")})["catch"](function(e){_error("Could not take photo:",e)});break;case"select-photo":Camera.selectPhoto().then(function(e){if(void 0!==parsedAction.data.mediaId){var t="$store.media."+parsedAction.data.mediaId+".images",n=StoreFactory.get(t);void 0===n&&(n=[]),void 0!==parsedAction.data.index&&void 0!==n[parsedAction.data.index]?n[parsedAction.data.index]=e:parsedAction.data.multiple===!0?n.push(e):n[0]=e,StoreFactory.set(t,n),_success(n)}else _error("Could not save gallery response.")})["catch"](function(e){_error("Could not select photo:",e)});break;case"record-audio":AudioRecordingFactory.startRecordingWithCompression().then(_success)["catch"](_error);break;case"stop-record-audio":AudioRecordingFactory.stopRecording().then(function(e){if(void 0!==parsedAction.data.mediaId){var t="$store.media."+parsedAction.data.mediaId+".audio",n=StoreFactory.get(t);void 0===n&&(n=[]),void 0!==parsedAction.data.index&&void 0!==n[parsedAction.data.index]?n[parsedAction.data.index]=e:parsedAction.data.multiple===!0?n.push(e):n[0]=e,StoreFactory.set(t,n),_success(n)}else _error("Could not save audio response.")})["catch"](function(e){_error("Could not stop recording:",e)});break;case"get-media-volume":var volumeControl=Plugin.getSource("volumecontrol");volumeControl&&volumeControl.getDeviceVolume?volumeControl.getDeviceVolume(success,fail,parsedAction.data.streamId):_success(0);break;case"change-media-volume":!function(){function e(){_success(parsedAction.data.volumeLevel)}function t(e){_error("Could not set device volume: "+e)}if(void 0!==parsedAction.data.volumeLevel&&parsedAction.data.volumeLevel<=100&&parsedAction.data.volumeLevel>=0){var n=Plugin.getSource("volumecontrol");n&&n.setDeviceVolume?n.setDeviceVolume(e,t,parsedAction.data.volumeLevel/100,parsedAction.data.streamId):_success(parsedAction.data.volumeLevel)}else _error("Could not set device volume: Invalid volume.")}();break;case"play-audio":!function(){function e(e){0===e.indexOf("user-assets/")&&(e=AssetFactory.rewriteAssetPaths(e)),AudioPlayer.play(e,{loop:parsedAction.data.loop,loopInterval:parsedAction.data.loopInterval,loopCount:parsedAction.data.loopCount,vibrate:parsedAction.data.vibrate,vibratePattern:parsedAction.data.vibratePattern,vibrateCustomPattern:parsedAction.data.vibrateCustomPattern,forceVibrate:parsedAction.data.forceVibrate,streamId:parsedAction.data.streamId},function(){_success(e)})}if(void 0!==parsedAction.data.model){var t=StoreFactory.get(parsedAction.data.model),n="";angular.isArray(t)&&t.length>0?n=t[t.length-1]:angular.isString(t)&&(n=t),angular.isString(n)&&(n.search(/\.m4a$/gim)>-1||n.search(/\.m4a.encrypted$/gim)>-1)?e(n):_error("Play Audio action failed, model location was not a playable file.")}else void 0!==parsedAction.data.fileName?angular.isString(parsedAction.data.fileName)&&parsedAction.data.fileName.search(/\.m4a$/gim)>-1?e($rootScope.assetDir+parsedAction.data.fileName):_error("Play Audio action failed, file location was not a playable file."):_error("Play Audio action failed, no valid location specified.")}();break;case"stop-audio":AudioPlayer.stop(),_success($data);break;case"record-video":var limitRecording=parsedAction.data.limitRecording,maxDuration=-1;limitRecording&&!isNaN(parseInt(parsedAction.data.maxDuration))&&(maxDuration=parseInt(parsedAction.data.maxDuration));var lowQuality=parsedAction.data.lowQuality;Camera.recordVideo(maxDuration,lowQuality===!0?0:1).then(function(e){if(void 0!==parsedAction.data.mediaId){var t="$store.media."+parsedAction.data.mediaId+".videos",n=StoreFactory.get(t);void 0===n&&(n=[]),void 0!==parsedAction.data.index&&void 0!==n[parsedAction.data.index]?n[parsedAction.data.index]=e:n[0]=e,StoreFactory.set(t,n),_success(n)}else _error("Could not save video response.")})["catch"](function(e){_error("Could not select video:",e)});break;case"delete-media":if(void 0===parsedAction.data.model)_error("Model location missing.");else{var mediaLocation=StoreFactory.get(parsedAction.data.model);if(void 0===mediaLocation||null===mediaLocation)_error('Model location "'+parsedAction.data.model+'" does not exist.');else if(angular.isArray(mediaLocation))_error("Cannot delete all media from a collection, you must specify a collection index.");else{var arrayRegex=/^(.*?)\[(.*?)]/,representsCollectionValue=arrayRegex.test(parsedAction.data.model);FileSystem.deleteMediaItem(mediaLocation).then(function(){var e=new CustomEvent("media-deleted",{detail:{location:mediaLocation}});if(document.dispatchEvent(e),representsCollectionValue){var t=arrayRegex.exec(parsedAction.data.model)[1],n=arrayRegex.exec(parsedAction.data.model)[2],a=StoreFactory.get(t);a&&n<a.length&&(a.splice(n,1),StoreFactory.set(t,a,!1))}else StoreFactory.set(parsedAction.data.model,void 0,!1);_success($data)})["catch"](function(e){_error(e)})}}break;case"start-beacon-listening":try{IBeaconFactory.startListening(),_success($data)}catch(err){_error(err)}break;case"stop-beacon-listening":try{IBeaconFactory.stopListening(),_success($data)}catch(err){_error(err)}break;case"loop":if(void 0!==parsedAction.data&&void 0!==parsedAction.data.model){var modelLocation=parsedAction.data.model.replace("{{","").replace("}}",""),items=null;if(items="$data"!==modelLocation?StoreFactory.get(modelLocation):$data,null!==items&&items.length>0){var subChain=$q.when();items.every(function(e){return subChain=subChain.then(function(){return triggerEvent(null,originalAction.actions,{$item:e})}),!0}),deferred.resolve(subChain)}}break;case"set-value":void 0!==parsedAction.data&&void 0!==parsedAction.data.key?StoreFactory.set(parsedAction.data.key,parsedAction.data.value,$data).then(function(){_success(parsedAction.data.value)})["catch"](function(e){_error(e)}):_error("Missing data.");break;case"enable-geofence":try{GeofenceFactory.start(parsedAction.data.name).then(function(){_success($data)},function(e){_error(e)})}catch(err){_error(err)}break;case"disable-geofence":try{GeofenceFactory.stop(parsedAction.data.name).then(function(){_success($data)},function(e){_error(e)})}catch(err){_error("Could not stop the geofence:",err)}break;case"debounce":null!==debounce&&clearTimeout(debounce),debounce=setTimeout(function(){debounce=null,_success($data)},parsedAction.data.duration);break;case"search-list":!function(){var e=parsedAction.data.page,t=parsedAction.data.list,n=parsedAction.data.searchWithin;try{if("custom"===n){var a=parsedAction.data.criteria||{};ListFactory.setListSearchState(e,t,"advanced",a)}else{var o=null!==parsedAction.data.term||void 0!==parsedAction.data.term?parsedAction.data.term.toString():"";ListFactory.setListSearchState(e,t,"simple",o)}_success($data)}catch(i){_error(i)}}();break;case"sort-list":!function(){var e=parsedAction.data.page,t=parsedAction.data.list,n=parsedAction.data.property,a=parsedAction.data.direction;try{ListFactory.setListOrderState(e,t,n,a),_success($data)}catch(o){_error(o)}}();break;case"set-list-page":!function(){var e=parsedAction.data.page,t=parsedAction.data.list,n="number"===parsedAction.data.goToPage?parseInt(parsedAction.data.number)||1:parsedAction.data.goToPage;try{ListFactory.setListPaginationState(e,t,n),_success($data)}catch(a){_error(a)}}();break;case"reset-list":!function(){var e=parsedAction.data.page,t=parsedAction.data.list,n=parsedAction.data.resetSearch,a=parsedAction.data.resetOrder,o=parsedAction.data.resetPagination;try{ListFactory.resetListState(e,t,n,a,o),_success($data)}catch(i){_error(i)}}();break;case"log":switch(parsedAction.data.level){case"error":console.error(parsedAction.data.message);break;case"warn":console.warn(parsedAction.data.message);break;case"info":console.info(parsedAction.data.message);break;case"debug":console.debug(parsedAction.data.message)}_success($data);break;case"email-logs":LoggingFactory.emailLogs(parsedAction.data.to,parsedAction.data.subject,parsedAction.data.body,parsedAction.data.includeArchivedLogs),_success($data);break;case"set-log-level":var level=parsedAction.data.level;"fromDataModel"===level&&(level=parsedAction.data.levelFromDataModel),parsedAction.data.applyToApp&&LoggingFactory.setRootLogLevel(level,"app"),parsedAction.data.applyToClient&&LoggingFactory.setRootLogLevel(level,"client"),parsedAction.data.applyToNative&&LoggingFactory.setRootLogLevel(level,"native"),_success($data);break;case"set-buffer-size":isNaN(parseInt(parsedAction.data.bufferFrequency))?_success($data):(LoggingFactory.setBufferFrequency(parseInt(parsedAction.data.bufferFrequency)),_success($data));break;case"configure-logs":var maxFileSize=parsedAction.data.maxFileSizeKilobyte,numberOfFiles=parsedAction.data.numberOfFiles,settingsJsonObject={},hasProperty=!1;void 0!==maxFileSize&&(isNaN(parseInt(maxFileSize))||(settingsJsonObject.maxFileSize=1e3*parseInt(maxFileSize),hasProperty=!0)),void 0!==numberOfFiles&&(isNaN(parseInt(numberOfFiles))||(settingsJsonObject.maxNumberOfFiles=parseInt(numberOfFiles),hasProperty=!0)),hasProperty&&(parsedAction.data.applyToApp&&LoggingFactory.configure(settingsJsonObject,"app"),parsedAction.data.applyToClient&&LoggingFactory.configure(settingsJsonObject,"client"),parsedAction.data.applyToNative&&LoggingFactory.configure(settingsJsonObject,"native")),_success($data);break;case"search-data-grid":!function(){var e=parsedAction.data.page,t=parsedAction.data.dataGrid,n=null!==parsedAction.data.term||void 0!==parsedAction.data.term?parsedAction.data.term.toString():"";try{var a=$injector.get("ctDataGrid");a.setDataGridSearchState(e,t,n),_success($data)}catch(o){_error(o)}}();break;case"sort-data-grid":!function(){var e=parsedAction.data.page,t=parsedAction.data.dataGrid,n=parsedAction.data.column,a=parsedAction.data.direction;try{var o=$injector.get("ctDataGrid");o.setDataGridOrderState(e,t,n,a),_success($data)}catch(i){_error(i)}}();break;case"set-data-grid-page":!function(){var e=parsedAction.data.page,t=parsedAction.data.dataGrid,n="number"===parsedAction.data.goToPage?parseInt(parsedAction.data.number)||1:parsedAction.data.goToPage;try{var a=$injector.get("ctDataGrid");a.setDataGridPaginationState(e,t,n),_success($data)}catch(o){_error(o)}}();break;case"reset-data-grid":!function(){var e=parsedAction.data.page,t=parsedAction.data.dataGrid,n=parsedAction.data.resetSearch,a=parsedAction.data.resetOrder,o=parsedAction.data.resetPagination;try{var i=$injector.get("ctDataGrid");i.resetDataGridState(e,t,n,a,o),_success($data)}catch(r){_error(r)}}();break;case"start-data-grid-edits":!function(){var e=parsedAction.data.page,t=parsedAction.data.dataGrid,n=parsedAction.data.items,a=parsedAction.data.indexes;try{var o=$injector.get("ctDataGrid");o.startEditMode(e,t,n,a),_success($data)}catch(i){_error(i)}}();break;case"finish-data-grid-edits":!function(){var e=parsedAction.data.page,t=parsedAction.data.dataGrid;try{var n=$injector.get("ctDataGrid"),a=n.finishEditMode(e,t);_success(a)}catch(o){_error(o)}}();break;case"enable-logging":LoggingFactory.enableDisableLogging(!0),_success($data);break;case"disable-logging":LoggingFactory.enableDisableLogging(!1),_success($data);break;case"enable-destination":parsedAction.data.applyToApp&&LoggingFactory.enableDisableDestination(!0,"app"),parsedAction.data.applyToClient&&LoggingFactory.enableDisableDestination(!0,"client"),parsedAction.data.applyToNative&&LoggingFactory.enableDisableDestination(!0,"native"),_success($data);break;case"disable-destination":parsedAction.data.applyToApp&&LoggingFactory.enableDisableDestination(!1,"app"),parsedAction.data.applyToClient&&LoggingFactory.enableDisableDestination(!1,"client"),parsedAction.data.applyToNative&&LoggingFactory.enableDisableDestination(!1,"native"),_success($data);break;case"zip-logs":LoggingFactory.zipLogs(parsedAction.data.includeArchivedLogs).then(function(e){$data.zipFileInfo={zipPath:e},_success($data)});break;case"start-vibration":if("none"!==parsedAction.data.pattern){var patternArray;"custom"===parsedAction.data.pattern?""!==parsedAction.data.customPattern&&(patternArray=parsedAction.data.customPattern.split(",")):patternArray=parsedAction.data.pattern.split(","),patternArray&&(parsedAction.data.continuous!==!0&&""===parsedAction.data.patternIterations||VibrateFactory.vibratePattern(patternArray,parseInt(parsedAction.data.patternIterations),parsedAction.data.continuous,parsedAction.data.force))}else parsedAction.data.continuous!==!0&&""===parsedAction.data.duration||VibrateFactory.vibrate(parseInt(parsedAction.data.duration),parsedAction.data.continuous,parsedAction.data.force);_success($data);break;case"stop-vibration":VibrateFactory.stopVibration(),_success($data);break;case"common-log-in":!function(){var e=$injector.get("BaseLayerFactory"),t=parsedAction.data.layer;if(!t)return void _error("No instance selected");var n=e.getByName(t);if(!n)return void _error("Instance '"+t+"' not found");var a=function(e,t){void 0!==parsedAction.actions&&parsedAction.actions.length>0&&triggerEvent("login-success",parsedAction.actions,e),_success(t)},o=function(e,t){void 0!==parsedAction.actions&&parsedAction.actions.length>0&&triggerEvent("login-failure",parsedAction.actions,e),_success(t)};if(n.on("login-result",function(e){e.success?a(e,$data):o(e,$data)},!0),parsedAction.data.adlogin&&"desktop"!==Platform.getType())return void _error("Active Directory login only available on Windows Desktop",null,!0);var i=Plugin.getSource("sspiclient");return!parsedAction.data.adlogin||i&&void 0!==i.Helper?void(parsedAction.data.adlogin?i.Helper.getUserPrincipalName(function(e){n.login(e,parsedAction.data.adTokenPlaceholder)},_error):n.login(parsedAction.data.username,parsedAction.data.password)):void _error("Active Directory login only available on Windows Desktop",null,!0)}();break;case"common-log-out":!function(){var e=$injector.get("BaseLayerFactory"),t=parsedAction.data.layer;if(!t)return void _error("No instance selected");var n=e.getByName(t);return n?(n.on("logout-result",function(e){e.success?_success($data):_error(e.exception)},!0),void n.emit("request-logout")):void _error("Instance '"+t+"' not found")}();break;case"common-change-theme":!function(){var e=$injector.get("BaseLayerFactory"),t=parsedAction.data.layer;if(!t)return void _error("No instance selected");var n=e.getByName(t);return n?void n.emit("request-theme-change",parsedAction.data.themeName):void _error("Instance '"+t+"' not found")}();break;case"common-launch-alert":!function(){var e=$injector.get("BaseLayerFactory"),t=parsedAction.data.layer;if(!t)return void _error("No instance selected");var n=e.getByName(t);if(!n)return void _error("Instance '"+t+"' not found");var a=parsedAction.data.suspendActionflow===!0,o=function(e,t){t&&triggerEvent("acknowledged",parsedAction.actions,e),a&&_success(e)},i=[];i="question"===parsedAction.data.alertType?[{text:parsedAction.data.noButtonLabel||"No",action:function(){o($data,!1)},type:"primary"},{text:parsedAction.data.yesButtonLabel||"Yes",action:function(){o($data,!0)},type:"primary"}]:[{text:parsedAction.data.buttonLabel||"Okay",action:function(){o($data,!0)},type:"primary"}];var r=parsedAction.data.alertId||parsedAction._auto_id_,s=parsedAction.data.alertPrioirty||3;parsedAction.data.alertId&&n.emit("request-close-alert",parsedAction.data.alertId);var c={id:r,raisedOn:(new Date).getTime(),priority:s,type:parsedAction.data.alertType,title:parsedAction.data.alertTitle,body:parsedAction.data.alertMessage,buttons:i};n.emit("request-raise-alert",c),a||_success($data)}();break;case"il-generate-report":!function(){var e=$injector.get("IncidentLayerFactory"),t=parsedAction.data.layer;if(!t)return void _error("No Incident instance selected");var n=e.getByName(t);if(!n)return void _error("Incident instance '"+t+"' not found");if(!n.config.reporting||!n.config.reporting.enabled)return void _error("The selected Incident instance does not have reporting enabled");var a=parsedAction.data.reportType||"",o=new Date(parsedAction.data.startDate||""),i=new Date(parsedAction.data.endDate||""),r=parsedAction.data.notify||!1,s=(n.config.reporting.reportTypes||[]).find(function(e){return a===e.id});if(!s)return void _error("The specified report type '"+a+"' does not exist in the selected Incident instance configuration");if(isNaN(o.getTime()))return void _error("The specified start date '"+o+"' is not a valid date string");if(isNaN(i.getTime()))return void _error("The specified start date '"+i+"' is not a valid date string");o.setHours(0,0,0,0),i.setHours(23,59,59,999);var c={type:s.id,startDate:o.getTime(),endDate:i.getTime(),notify:r};n.emit("request-generate-report",c),_success($data)}();break;case"pg-create-new-page":!function(){var e=$injector.get("PagerLayerFactory"),t=parsedAction.data.layer;if(!t)return void _error("No pager instance selected");var n=e.getByName(t);return n?void n.createNewPage():void _error("pager instance '"+t+"' not found")}();break;case"um-fetch-users":!function(){var e=$injector.get("UserManagementLayerFactory"),t=parsedAction.data.layer;if(!t)return void _error("No user management instance selected");var n=e.getByName(t);return n?void n.fetchAllUsers().then(_success()):void _error("User Management instance '"+n+"' not found")}();break;case"um-fetch-groups":!function(){var e=$injector.get("UserManagementLayerFactory"),t=parsedAction.data.layer;if(!t)return void _error("No user management instance selected");var n=e.getByName(t);return n?void n.fetchAllGroups().then(_success()):void _error("User Management instance '"+n+"' not found")}();break;case"um-open-import-modal":!function(){var e=$injector.get("UserManagementLayerFactory"),t=parsedAction.data.layer;if(!t)return void _error("No user management instance selected");var n=e.getByName(t);return n?void n.openImportModal():void _error("User Management instance '"+n+"' not found")}();break;case"um-open-users-modal":!function(){var e=$injector.get("UserManagementLayerFactory"),t=parsedAction.data.layer;if(!t)return void _error("No user management instance selected");var n=e.getByName(t);return n?void n.openUsersModal():void _error("User Management instance '"+n+"' not found")}();break;case"um-open-groups-modal":!function(){var e=$injector.get("UserManagementLayerFactory"),t=parsedAction.data.layer;if(!t)return void _error("No user management instance selected");var n=e.getByName(t);return n?void n.openGroupsModal():void _error("User Management instance '"+n+"' not found")}();break;case"um-open-menu":!function(){var e=$injector.get("UserManagementLayerFactory"),t=parsedAction.data.layer;if(!t)return void _error("No user management instance selected");var n=e.getByName(t);return n?void($data&&$data.target?n.openContainerMenu($data.target):n.openContainerMenu()):void _error("User Management instance '"+n+"' not found")}();break;case"move-task-to-back":window.mayflower&&window.mayflower.moveTaskToBack();break;default:_error("Invalid action type specified.")}return deferred.promise}}var service={triggerEvent:triggerEvent,evalOperations:evalOperations,evalOperation:evalOperation},debounce=null;return void 0===window.cti.utils&&(window.cti.utils={}),window.cti.utils.callAction=function(e,t,n,a){call({type:e,data:t,expressions:n})().then(function(e){void 0!==a&&a(e)})},window.cti.utils.callActionflow=function(e,t){return call({type:"call-actionflow",data:{name:e}},t)()},window.cti.utils.updatePage=function(){$rootScope.$$phase||$rootScope.$apply()},window.cti.utils.triggerStoreChanged=function(){$rootScope.$broadcast("StoreChanged")},window.cti.utils.getPreferencesItem=function(e){if(void 0!==SchemaHelper.schema.metadata){var t=SchemaHelper.schema.metadata;if(void 0!==t[e])return t[e]}},window.cti.utils.destroyAllData=function(){StoreFactory.destroyAllData()},window.cti.utils.destroyPageData=function(e){StoreFactory.destroyPageData(e)},window.cti.utils.stopAllRecording=function(){document.dispatchEvent(new CustomEvent("stop-all-recording"))},void 0===window.cti.utils.logging&&(window.cti.utils.logging={}),window.cti.utils.logging.enableLogging=function(){LoggingFactory.enableDisableLogging(!0)},window.cti.utils.logging.disableLogging=function(){LoggingFactory.enableDisableLogging(!1)},window.cti.utils.logging.enableDestination=function(e){LoggingFactory.enableDisableDestination(!0,e)},window.cti.utils.logging.disableDestination=function(e){LoggingFactory.enableDisableDestination(!1,e)},window.cti.utils.logging.setRootLogLevel=function(e,t){LoggingFactory.setRootLogLevel(e,t)},window.cti.utils.logging.getRootLogLevel=function(e,t){LoggingFactory.getRootLogLevel(e).then(function(e){t(null,e)})["catch"](function(e){t(e)})},window.cti.utils.logging.configure=function(e,t){LoggingFactory.configure(e,t)},window.cti.utils.logging.zipLogFiles=function(e,t){LoggingFactory.zipLogs(e).then(function(e){t(null,e)})["catch"](function(e){t(e)})},window.cti.utils.logging.emailLogs=function(e,t,n,a){LoggingFactory.emailLogs(e,t,n,a)},window.cti.utils.logging.makeFilesPublic=function(e,t){LoggingFactory.makeFilesPublic(e).then(function(e){t(null,e)})["catch"](function(e){t(e)})},window.cti.utils.logging.removePublicFiles=function(){LoggingFactory.removePublicFiles()},window.cti.utils.logging.getLogFilePaths=function(e){LoggingFactory.getLogFilePaths().then(function(t){e(null,t)})["catch"](function(t){e(t)})},window.cti.utils.logging.getArchivedLogFilePaths=function(e){LoggingFactory.getArchivedLogFilePaths().then(function(t){e(null,t)})["catch"](function(t){e(t)})},window.cti.utils.logging.isLoggingEnabled=function(e){LoggingFactory.isLoggingEnabled().then(function(t){e(null,t)})["catch"](function(t){e(t)})},window.cti.utils.logging.isDestinationEnabled=function(e){LoggingFactory.isDestinationEnabled().then(function(t){e(null,t)})["catch"](function(t){e(t)})},service}]),angular.module("app.core").factory("Url",["$http","$log","$q","StoreFactory",function(e,t,n,a){function o(e,t,n,a){this.name=e,this.url=t,this.target=n,this.params=a}return o.prototype={makeRequest:function(e,t){var i=n.defer(),r=this.url,s={url:r};return s.target=void 0!=e?e:this.target,t=o.merge(this.params,t),void 0!=t&&(s.params=a.parse(t)),s.url=a.parseUrl(s.url,s.params),"popup"!==s.target?window.open(s.url,s.target):window.open(s.url,"popup","location=no,height=800,width=600"),i.promise}},o.merge=function(e,t){var n={};return void 0!=e&&(n=e),void 0!=t&&angular.forEach(t,function(e,t){"object"!=typeof e?n[t]=e:(void 0==n[t]&&(n[t]={}),n[t]=o.merge(n[t],e))}),n},o}]),angular.module("app.core").factory("UrlFactory",["$http","$log","StoreFactory","$timeout","$q","Url",function(e,t,n,a,o,i){function r(e){c[e.name]=new i(e.name,e.url,e.target,e.params)}function s(e){var t=o.defer(),n=e.name;return void 0!=c[n]&&c[n].makeRequest(e.target,e.params).then(function(){t.resolve()})["catch"](function(){t.reject()}),t.promise}var c={},l={init:r,makeRequest:s};return l}]),angular.module("app.core").factory("Timer",["$timeout","$interval","ActionFactory",function(e,t,n){function a(e,t,n,a){this.timerFunction=null,this.name=e,this.type=t,this.time=parseInt(n),this.actions=a}return a.prototype={
start:function(){var a=this.actions;"delay"==this.type?e(function(){n.triggerEvent(null,a)},this.time):"interval"==this.type&&(this.timerFunction=t(function(){n.triggerEvent(null,a)},this.time))},stop:function(){"interval"==this.type&&null!=this.timerFunction&&t.cancel(this.timerFunction)}},a}]),angular.module("app.core").factory("Variable",["$q","StoreFactory",function(e,t){function n(e,t,n){this.name=e,this.type=t,this.set(n)}return n.prototype={set:function(n){var a=e.defer();if(void 0!=n)if("string"==typeof n&&n.indexOf("{{")>-1&&(n=t.parse(n)),void 0!=this.name){var o=null;switch(this.type){case"date":o=Date.parse(n);break;case"string":o=n;break;case"int":o=parseInt(n);break;case"boolean":o="true"==n||"1"==n}this.value=window.cti.store.variables[this.name]=o,a.resolve(o)}else a.reject("Variable must have a name");else a.resolve();return a.promise}},n}]),angular.module("app.core").factory("VariableFactory",["Variable","$q",function(e,t){function n(t){i[t.name]=new e(t.name,t["variable-type"],t.value)}function a(e,n){var a=t.defer();if(void 0!==i[e]){var r=i[e];r.set(n||o(r)).then(function(e){a.resolve(e)})["catch"](function(e){a.reject(e)})}else a.reject('Cannot find variable "'+e+'"');return a.promise}function o(e){switch(e.type){case"date":return"1970";case"string":return"";case"int":return"0";case"boolean":return"false"}return""}var i={};return{init:n,setVariable:a}}]),angular.module("app.core").factory("Camera",["StoreFactory","$log","$q","Plugin","FileSystem","Platform",function(e,t,n,a,o,i){function r(e,t,a,r,s,c,u,d,p){return l(1,e,t,a,r,s,c,u,d).then(function(e){var t=n.defer(),a=function(e){t.reject(e)};return 0==e.length&&a("image path returned empty"),window.resolveLocalFileSystemURL(e,function(e){var n=new Date,r=n.getTime(),s="android"===i.getName(),c=d&&s?".jpg.encrypted":".jpg",l=r+c;o.getStorage(p).then(function(n){e.moveTo(n,l,function(e){e.file(function(e){t.resolve(e.localURL)},a)},a)})["catch"](a)},a),t.promise})}function s(){return l(0)}function c(e,a){var r=n.defer(),s=function(e){void 0!==e&&t.error(e),r.reject(e)},c="desktop"===i.getType();if(c)o.selectFile(["video/mp4"]).then(function(e){r.resolve(e)})["catch"](function(){s()});else{var l=function(e){e.length>0&&r.resolve(e[0].fullPath)},u=function(e){r.reject(e)},d={};d.limit=1,d.quality=a,e>0&&(d.duration=e),navigator.device.capture.captureVideo(l,u,d)}return r.promise}function l(e,r,s,c,l,u,d,p,m){var g=n.defer(),f=function(e){void 0!==e&&t.error(e),g.reject(e)},v="desktop"===i.getType();if(v)o.selectFile(["image/jpeg","image/png","image/gif"]).then(function(e){g.resolve(e)})["catch"](function(){f()});else if(1==e){var h=a.getSource("camera"),y={quality:r||50,cameraDirection:s||0,destinationType:1,sourceType:e,allowEdit:d||!1,encodingType:u||0,saveToPhotoAlbum:p||!1,correctOrientation:!0,saveEncrypted:m||!1};c>0&&l>0&&(y.targetWidth=c,y.targetHeight=l),h.getPicture(function(e){g.resolve(e)},f,y)}else{var b=a.getSource("fileimporter");b!==!1?b.importPicture(function(e){g.resolve(e)}):f()}return g.promise}var u={takePhoto:r,selectPhoto:s,recordVideo:c};return u}]),angular.module("app.core").factory("Auth",["$q","Plugin",function(e,t){function n(){var n=e.defer();return i=t.getSource("authentication"),i!==!1?n.resolve():n.reject("No authentication method available."),n.promise}function a(t){var a=e.defer();if(r)return void(r=!1);var o=void 0!==t?t:"Authentication Required";return n().then(function(){i.authenticate(o,"infinity","7OHHxYvRuG1PBlGJi2LXULqMrOKcS64S",function(){a.resolve()},function(){a.reject("Authentication failed")}),r=!0})["catch"](function(){a.resolve()}),a.promise}var o={authenticate:a},i=!1,r=!1;return o}]),angular.module("app.core").factory("Notification",serviceFunc),angular.module("app.core").factory("IBeaconFactory",["$injector","Plugin","$log",function(e,t,n){function a(){if(!$){if(h=t.getSource("locationManager"),h!==!1){try{y=e.get("ActionFactory"),h.requestAlwaysAuthorization(),h.isBluetoothEnabled().then(function(e){e||h.enableBluetooth()}).fail(n.error).done()}catch(a){n.error("Error loading iBeacon plugin",a)}var o=new h.Delegate;o.didExitRegion=function(e){s(e)},o.didRangeBeaconsInRegion=function(e){r(e)},h.setDelegate(o)}else n.error("Beacon plugin has not successfully initialised.");$=!0}}function o(e){return Math.round((255-Math.abs(e))/255*100)}function i(e,t){return e.signalStrength<t.signalStrength?1:e.signalStrength>t.signalStrength?-1:0}function r(e){var t=e.beacons[0];if(void 0!==t){var n=!1;for(var a in S){var r=S[a];if(r.uuid.toLowerCase()==t.uuid.toLowerCase()){var s=t.proximity.toLowerCase().replace("proximity","");r.proximity!=t.proximity&&b.forEach(function(e){void 0!==e.uuid&&void 0!==r.uuid&&e.uuid.toLowerCase()===r.uuid.toLowerCase()&&y.triggerEvent(s,e.actions)}),r.proximity=t.proximity,r.accuracy=t.accuracy,r.signalStrength=o(t.rssi),n=!0}}if(!n)for(var c in b){var l=b[c];l.uuid.toLowerCase()==t.uuid.toLowerCase()&&(S.push({title:l.name,major:l.major,minor:l.minor,uuid:l.uuid,accuracy:t.accuracy,proximity:t.proximity,signalStrength:o(t.rssi)}),y.triggerEvent("in-range",l.actions))}var u=S[0].uuid;S.sort(i);var d=S[0].uuid;if(u.toLowerCase()!=d.toLowerCase()){var p=S[0];for(var m in b){var g=b[m];g.uuid.toLowerCase()==p.uuid.toLowerCase()&&y.triggerEvent("closest",g.actions)}}}}function s(e){var t=e.region.uuid;for(var n in S){var a=S[n];if(a.uuid.toLowerCase()==t.toLowerCase()){S.splice(n,1);for(var o in b){var i=b[o];i.uuid.toLowerCase()==t.toLowerCase()&&y.triggerEvent("out-of-range",i.actions)}}}}function c(e){if(b.push(e),void 0!==window.cordova){var t=f(e);e.rangingEnabled&&(w.push(e),h.startRangingBeaconsInRegion(t).fail(n.error).done(),e.ranging=!0),h.startMonitoringForRegion(t).fail(n.error).done(),e.monitoring=!0}}function l(){angular.forEach(b,function(e){if(e.monitoring){var t=f(e);h.stopMonitoringForRegion(t).fail(n.error).done(),e.monitoring=!1}})}function u(){angular.forEach(w,function(e){if(e.ranging){var t=f(e);h.stopRangingBeaconsInRegion(t).fail(n.error).done()}e.ranging=!1})}function d(){l(),u()}function p(){m(),g()}function m(){angular.forEach(b,function(e){if(!e.monitoring){var t=f(e);h.startMonitoringForRegion(t).fail(n.error).done(),e.monitoring=!0}})}function g(){angular.forEach(w,function(e){if(!e.ranging){var t=f(e);h.startRangingBeaconsInRegion(t).fail(n.error).done()}e.ranging=!0})}function f(e){var t=null;return angular.forEach(A,function(n){if(n.uuid.toLowerCase()==e.uuid.toLowerCase())return void(t=n)}),null===t&&(t=new h.BeaconRegion(e.name,e.uuid,e.major,e.minor),A.push(t)),t}var v={init:a,addBeacon:c,stopMonitoring:l,stopRanging:u,startMonitoring:m,startRanging:g,startListening:p,stopListening:d},h=!1,y=null,b=[],w=[],A=[],S=[],$=!1;return v}]),angular.module("app.core").factory("GeofenceFactory",["$rootScope","$q","$injector","Plugin","StoreFactory","$log",function(e,t,n,a,o,i){function r(e){return e.hasOwnProperty("name")&&e.hasOwnProperty("lat")&&e.hasOwnProperty("lng")&&e.hasOwnProperty("radius")}function s(i,r){if(B)return t.when();U=i,j=r,R=D===!0?P():a.getSource("geofence");var s=t.defer();return R===!1?s.reject("Unable to initialise 'geofence' plugin"):(V=n.get("ActionFactory"),I("Retrieving saved geofence state:",o.get(N)),I("Initializing 'geofence' plugin..."),R.initialize().then(function(){p(s)})["catch"](function(e){m(e)})),e.$on("StoreChanged",w),B=!0,s.promise}function c(e){if(!G){H.push(e);var n="Plugin not ready, adding geofence to queue:";return I(n,e),t.reject(n)}var a=t.defer();if(b(e),e.fullyQualifiedName=A(e.name),void 0===e.listening){var o=F(e.name);e.listening=void 0===o||o.listening}if(e.listening===!1)I("Skipping geofence '"+e.name+"', was previously stopped"),C(e),a.resolve();else{var i=$(e);"string"==typeof i?a.reject(i):R.addOrUpdate(i).then(function(){I("Registered geofence '"+i.id+"' ("+i.latitude+", "+i.longitude+" @ "+i.radius+"m)"),C(e),k(),a.resolve()})["catch"](function(t){var n="Unable to register geofence '"+e.name+"'";L(n,t),a.reject(n)})}return a.promise}function l(e){if(!G)return t.reject("Geofence plugin not initialised");var n=t.defer(),a=A(e.name),o=T(a);if(null!==o){var i=angular.extend({},o,e),r=$(i);i.listening===!1?(C(i),k(),n.resolve()):R.remove(a).then(function(){return R.addOrUpdate(r)}).then(function(){I("Updated geofence '"+r.id+"' ("+r.latitude+", "+r.longitude+" @ "+r.radius+"m)"),C(i),k(),n.resolve()})["catch"](function(e){var t="Unable to update geofence '"+i.name+"'";L(t,e),n.reject(t)})}else I("Unable to find and update geofence '"+e.name+"'"),n.resolve();return n.promise}function u(e){if(!G)return t.reject("Geofence plugin not initialised");if("|all|"===e)return h();var n=t.defer(),a=A(e),o=T(a);return null!==o?o.listening===!1?(o.listening=!0,c(o).then(function(){n.resolve()})):(I("Geofence '"+e+"' already registered"),n.resolve()):n.reject("Unable to find and start geofence '"+e+"'"),n.promise}function d(e){if(!G)return t.reject("Geofence plugin not initialised");if("|all|"===e)return y();var n=t.defer(),a=A(e),o=T(a);return null!==o?R.remove(o.fullyQualifiedName).then(function(){I("Geofence '"+e+"' stopped"),o.listening=!1,C(o),k(),n.resolve()})["catch"](function(t){var a="Unable to stop geofence '"+e+"'";t(a,t),n.reject(a)}):n.reject("Unable to find and stop geofence '"+e+"'"),n.promise}function p(e){G=!0,R.onTransitionReceived=g,I("Initialized 'geofence' plugin"),R.removeAll().then(function(){I("Existing geofence registrations purged"),H.length>0&&(I("Registering "+H.length+" queued geofences..."),angular.forEach(H,function(e){c(e)}),H=[]),e.resolve()})}function m(e){e("Geofence plugin not initialised",e)}function g(e){angular.forEach(e,function(e){var t=T(e.id);if(null!==t&&t.listening===!0)switch(e.transitionType){case O:f(t);break;case M:v(t)}})}function f(e){null!==e&&e.listening===!0&&e.actions.length&&(I("Triggering 'enter' event for '"+e.name+"'"),V.triggerEvent("enter",e.actions))}function v(e){null!==e&&e.listening===!0&&e.actions.length&&(I("Triggering 'exit' event for '"+e.name+"'"),V.triggerEvent("exit",e.actions))}function h(){var e=t.defer(),n=[];return angular.forEach(z,function(e){e.listening=!0,n.push(c(e))}),t.all(n).then(function(){I("All geofences registered"),e.resolve()}),e.promise}function y(){var e=t.defer();return R.removeAll().then(function(){I("All geofences stopped"),angular.forEach(z,function(e){e.listening=!1,C(e)}),k(),e.resolve()})["catch"](function(t){var n="Unable to stop all geofences";t(n,t),e.reject(n)}),e.promise}function b(e){var t=[];angular.forEach(["lat","lng","radius","notificationText"],function(n){0===(""+e[n]).trim().indexOf("{{")&&t.push(n)}),t.length>0&&W.indexOf(e.name)===-1&&W.push(e.name)}function w(){clearTimeout(q),q=setTimeout(function(){angular.forEach(W,function(e){var t=F(e),n=A(e),a=T(n);if(t&&a){var o=t.lat,i=t.lng,r=t.radius,s=t.notificationText,c=S(a.lat,!0),u=S(a.lng,!0),d=S(a.radius,!0),p=S(a.notificationText,!1);c===o&&u===i&&d===r&&p===s||l(a)}})},100)}function A(e){return j+"__"+e}function S(e,t){if(void 0===e||null===e)return null;if(angular.isString(e)&&0===e.trim().indexOf("{{")){var n=o.parse(e);return n?t?parseFloat(n):n:null}return t?parseFloat(e):e}function $(e){var t=x(e,"enter")?O:0,n=x(e,"exit")?M:0,a=t|n,o=[O,M,O|M];if(o.indexOf(a)===-1){var i="Geofence '"+e.name+"' being ignored - has no transition actions defined";return I(i),i}var r=S(e.lat,!0)||0,s=S(e.lng,!0)||0,c=S(e.radius,!0)||0,l=S(e.notificationText,!1)||"You have passed a geofence boundary";return{id:e.fullyQualifiedName,latitude:r,longitude:s,radius:c,transitionType:a,notification:{id:1,title:U,text:l,openAppOnClick:!0}}}function x(e,t){return!(!e.actions||!e.actions.length)&&e.actions.some(function(e){return(e.event||"").toLowerCase()===t.toLowerCase()})}function E(e){for(var t=0;t<z.length;t++){var n=z[t];if(n.fullyQualifiedName===e)return t}return-1}function T(e){var t=E(e);return t!==-1?z[t]:null}function C(e){var t=E(e.fullyQualifiedName);t===-1?z.push(e):z[t]=e}function k(){var e={};angular.forEach(z,function(t){e[t.name]={listening:t.listening,lat:S(t.lat),lng:S(t.lng),radius:S(t.radius),notificationText:S(t.notificationText)}}),o.set(N,e),I("Geofence state saved:",e)}function F(e){return angular.copy(o.get(N+"."+e))}function I(){if(_===!0){var e=Array.prototype.slice.call(arguments);e.length>0&&"string"==typeof e[0]&&(e[0]="[geofence.fct.js] "+e[0]),i.log.apply(i,e)}}function L(){var e=Array.prototype.slice.call(arguments);e.length>0&&"string"==typeof e[0]&&(e[0]="[geofence.fct.js] "+e[0]),i.error.apply(i,e)}function P(){function e(){var e=t.defer();return setTimeout(function(){e.resolve()},n),e.promise}i.info("*** USING MOCK GEOFENCE PLUGIN: Turn this off in geofence.fct.js if you expect to use the real plugin ***");var n=500;return{initialize:function(){return e()},addOrUpdate:function(){return e()},remove:function(){return e()},removeAll:function(){return e()},onTransitionReceived:function(){}}}var _=!1,D=!1,N="geofences",O=1,M=2,R=null,U="",j="",q=null,B=!1,V=null,G=!1,H=[],z=[],W=[];return{isValidGeofenceObject:r,init:s,register:c,start:u,stop:d}}]),angular.module("app.core").factory("Xmpp",["LoadingStatus","$log","StoreFactory","$injector","$rootScope","$q","Camera","Plugin","FileSystem","$sce","MimeTypes","$filter","SchemaHelper",function(e,t,n,a,o,i,r,s,c,l,u,d,p){function m(e,r,s,l,u,d,m,g,f,v,h,y){var b=a.get("ActionFactory"),w=this;if(w.id=e,w.endpoint=r,w.uploadJid=l,w.readReceipts=u,w.stayConnected=d,w.multicastJid=m,w.pingTime=g,w.pingTo=f,w.sendtimeout=v,w.enableOutbox=h,w.reconnectTime=y,w.stayConnected===!0&&w.reconnect(),w.actions=s,void 0!==w.id&&void 0!==w.endpoint){if(void 0===window.cti.store.xmpp[this.id]&&(window.cti.store.xmpp[this.id]={connection_status:null,user_status:null,history:{},contacts:[],groups:[]}),w.cleanQueue(),window.cti.api.xmpp_connection=new window.Strophe.Connection(w.endpoint),window.cti.api.xmpp_connection.reset(),w.sendtimeout&&(window.cti.api.xmpp_connection.outbox.sendTimeoutDuration=w.sendtimeout),w.enableOutbox===!0){window.cti.api.xmpp_connection.outbox.addEventListener(window.cti.api.xmpp_connection.outbox.eventTypes.MESSAGE_QUEUED,function(e){b.triggerEvent("message-queued",w.actions,{$message:e})}),window.cti.api.xmpp_connection.outbox.addEventListener(window.cti.api.xmpp_connection.outbox.eventTypes.MESSAGE_RESEND_SUCCESS,function(e){b.triggerEvent("message-resend-success",w.actions,{$message:e})}),window.cti.api.xmpp_connection.outbox.addEventListener(window.cti.api.xmpp_connection.outbox.eventTypes.MESSAGE_RESEND_FAILED,function(e){b.triggerEvent("message-resend-failed",w.actions,{$message:e})}),window.cti.api.xmpp_connection.outbox.addEventListener(window.cti.api.xmpp_connection.outbox.eventTypes.QUEUE_CLEANED,function(e){b.triggerEvent("queue-cleaned",w.actions,{$result:e})}),window.cti.api.xmpp_connection.outbox.addEventListener(window.cti.api.xmpp_connection.outbox.eventTypes.QUEUE_PROCESSED,function(e){b.triggerEvent("queue-processed",w.actions,{$result:e})});var A=p.getSchemaSettingByName("encryption");A===!0?(t.debug("[xmpp.fct.js] ("+w.id+") GETTING KEY TO SECURE OUTBOX DB..."),n.getEncryptionKey(p.getAppName()).then(function(e){t.debug("[xmpp.fct.js] ("+w.id+") ENABLING XMPP OUTBOX..."),window.cti.api.xmpp_connection.outbox.enable(w.id,e)})):(t.debug("[xmpp.fct.js] ("+w.id+") ENABLING XMPP OUTBOX..."),window.cti.api.xmpp_connection.outbox.enable(w.id))}w.setConnectionStatus(null),w.onMessage=function(e){t.debug("[xmpp.fct.js] ("+w.id+") MESSAGE RECEIVED:",e);try{w.enablePing();var a=e.getAttribute("type"),i=e.getAttribute("id"),r=w.getBareJid(e.getAttribute("to")),s=w.getBareJid(e.getAttribute("from"));switch(a){case"chat":var l=e.getElementsByTagName("body")[0],u=e.getElementsByTagName("url")[0];if(void 0!==l)var d=window.Strophe.getText(l);var p=e.getElementsByTagName("metadata")[0];if(void 0!==p){var m={},g=p.childNodes;if(void 0!==g&&g.length>0)for(var f=0;f<g.length;f++){var v=g[f];m[v.tagName]=window.Strophe.getText(v)}}if(void 0!==l||void 0!==u){var h=w.createMessageObject(r,s,d,null,i,null,m),y=e.getElementsByTagName("markable")[0];if(void 0!==y&&w.readReceipts!==!1&&w.sendMarker(h.id,w.MESSAGE_STATUS.RECEIVED),void 0!==u){h.media.remote=encodeURI(window.Strophe.getText(u)),h.media.status=w.MEDIA_STATUS.DOWNLOADING,w.saveAndUpdate();var A=c.getFileNameFromPath(h.media.remote);c.download(h.media.remote,A).then(function(e){h.media.local=e.filePath,h.media.type=e.mimeType,h.media.status=w.MEDIA_STATUS.DOWNLOADED,w.saveAndUpdate()})["catch"](function(e){t.error(e)})}void 0!==w.actions&&w.actions.length>0&&b.triggerEvent("message-received",w.actions,{$message:h}),w.saveAndUpdate()}break;case"error":t.error("XMPP ERROR!",e);var S=e.getAttribute("id");if(void 0!==S){var $=w.getMessageFromHistory(s,S);null!==$&&($.sent=!1,b.triggerEvent("error",w.actions,{$message:$}),n.save().then(function(){o.$emit("StoreHasChanged")}))}break;default:var x=e.getElementsByTagName("received")[0];if(void 0!==x&&w.readReceipts!==!1){var E=x.getAttribute("id");if(null!==E){var T=w.getMessageFromHistory(s,E);null!==T&&(T.status=w.MESSAGE_STATUS.RECEIVED,w.saveAndUpdate())}}var C=e.getElementsByTagName("displayed")[0];if(void 0!==C&&w.readReceipts!==!1){var k=C.getAttribute("id");if(null!==k){var F=w.getMessageFromHistory(s,k);null!==F&&(F.status=w.MESSAGE_STATUS.DISPLAYED,w.saveAndUpdate())}}var I=e.getElementsByTagName("acknowledged")[0];if(void 0!==I&&w.readReceipts!==!1){var L=I.getAttribute("id");if(null!==L){var P=w.getMessageFromHistory(s,L);null!==P&&(P.status=w.MESSAGE_STATUS.ACKNOWLEDGED,w.saveAndUpdate())}}}}catch(_){t.error("XMPP Error:",_)}return!0},w.updateMessageStatus=function(e){var t=!1;w.queue.forEach(function(n){if(n===e){var a=w.getMessageFromAllHistory(e);null!==a&&(a.status=w.MESSAGE_STATUS.FAILED,b.triggerEvent("send-failed",w.actions,{$message:a}),t=!0)}}),t===!0&&w.saveAndUpdate()},w.send=function(e,n){var a=i.defer();if(window.cti.api.xmpp_connection.connected===!0||window.cti.api.xmpp_connection.outbox.enabled===!0){w.enablePing();var o=null;if(o=void 0!==e.id?w.getMessageFromAllHistory(e.id):w.createMessageObject(e.to,window.cti.api.xmpp_connection.authzid,e.message,null,null,e.ttl,e.metadata,n),null!==o){var r=function(){var e=w.createMessageXml(o.id);window.cti.api.xmpp_connection.sendMessage(e,function(e){null===e&&[w.MESSAGE_STATUS.RECEIVED,w.MESSAGE_STATUS.ACKNOWLEDGED,w.MESSAGE_STATUS.DISPLAYED].indexOf(o.status)===-1&&(o.sent=!0,o.status=w.MESSAGE_STATUS.SENT),w.saveAndUpdate(),a.resolve()},function(e){o.sent=!1,o.status=w.MESSAGE_STATUS.FAILED,b.triggerEvent("send-failed",w.actions,{$message:o,$error:e}),w.saveAndUpdate(),a.reject(e)})},s=e["file-path"];if(void 0!==s&&angular.isString(s)&&s.length>0)if(void 0!==w.uploadJid){var l=c.getFileNameFromPath(s);c.getFile(l).then(function(e){o.media.local=e.filePath,o.media.type=e.mimeType,o.media.status=w.MEDIA_STATUS.UPLOADING,w.saveAndUpdate(),window.cti.api.xmpp_connection.httpFileUpload.slot(w.uploadJid,e.name,e.size,o.media.type,function(n){if(null!==n.put){var i=s,l=encodeURI(n.put),u={httpMethod:"PUT",fileName:e.name,headers:{"Content-Type":o.media.type}};t.debug("[xmpp.fct.js] uploading file '"+i+"' to '"+l+"' with options",u),c.upload(i,l,u).then(function(){o.media.remote=n.get,o.media.status=w.MEDIA_STATUS.UPLOADED,r()})["catch"](function(e){a.reject(e)})}else a.reject("No upload slot was provided.")},function(e){a.reject(e)})})["catch"](function(e){a.reject(e)})}else a.reject("Upload jid has not been configured.");else r()}else a.reject("Unable to send message.")}else a.reject("No connection available.");return a.promise},w.sendToGroup=function(e){var t=i.defer();if(e.groups)if(void 0===w.multicastJid)t.reject('Multicast JID is required for group messages, please configure this on the "'+w.id+'" XMPP instance.');else{e.to=w.multicastJid;var a=void 0!==e.statuses?e.statuses:[],o=void 0!==e.groups?e.groups:[],r=n.get("xmpp."+w.id+".contacts"),s=r.filter(function(e){return void 0!==e.groups&&e.groups.filter(function(e){return o.indexOf(e)>-1}).length>0&&a.indexOf(e.status)===-1}),c=s.map(function(e){return e.username});w.send(e,c).then(function(){t.resolve()})["catch"](function(e){t.reject(e)})}else t.reject("No group(s) specified for group message.");return t.promise},w.markRead=function(e){var n=i.defer();if(window.cti.api.xmpp_connection.connected===!0)if(void 0!==e.id)t.debug('Marking message with ID "'+e.id+'" as displayed.'),w.sendMarker(e.id,"displayed"),n.resolve(!0);else if(void 0!==e.recipient)if(void 0!==window.cti.store.xmpp[w.id].history&&void 0!==window.cti.store.xmpp[w.id].history[e.recipient]){var a=angular.copy(window.cti.store.xmpp[w.id].history[e.recipient].messages);void 0!==a&&a.length>0?(a=a.reverse(),a.every(function(e){return e.status!==w.MESSAGE_STATUS.DISPLAYED&&e.status!==w.MESSAGE_STATUS.ACKNOWLEDGED&&(e.from!==window.cti.api.xmpp_connection.authzid&&void 0!==e.id&&w.sendMarker(e.id,w.MESSAGE_STATUS.DISPLAYED),!0)}),n.resolve(!0)):n.resolve(!0)}else n.resolve(!0);else n.reject("No message ID provided.");else n.resolve();return n.promise},w.onIq=function(e){t.debug("[xmpp.fct.js] ("+w.id+") IQ RECEIVED:",e);var n=e.getAttribute("type");switch(n){case"set":var a=e.getElementsByTagName("query")[0];if(void 0!==a){var o=a.getAttribute("xmlns");switch(o){case"jabber:iq:roster":w.processContacts(a.childNodes),b.triggerEvent("contacts-update",w.actions)}}}return!0},w.onPresence=function(e){t.debug("[xmpp.fct.js] ("+w.id+") PRESENCE RECEIVED:",e),w.enablePing();var a=e.getAttribute("type"),o="unavailable"===a?"offline":"chat",i="unavailable"===a?"Offline":"Available",r=e.getElementsByTagName("show")[0];void 0!==r&&(o=window.Strophe.getText(r));var s=e.getElementsByTagName("status")[0];void 0!==s&&(i=window.Strophe.getText(s));var c=w.getBareJid(e.getAttribute("from")),l=n.get("xmpp."+w.id+".contacts"),u=!1;if(l.length>0){var d=l.filter(function(e){return e.username===c})[0];void 0!==d&&d.status!==o&&(d.status=o,d.friendly_status=i,b.triggerEvent("status-update",w.actions,{$contact:d}),u=!0)}return u&&w.saveAndUpdate(),!0},w.login=function(e,a){if(window.cti.api.xmpp_connection.connected===!0)return i.when();var o=i.defer();return window.cti.api.xmpp_connection.reset(),w.setLastAuthStatus("pending"),void 0!==e&&void 0!==a?(angular.isNumber(a)&&(a=a.toString()),window.cti.api.xmpp_connection.connect(e,a,function(i){var r=w.statusCodeToTxt(i);if(w.finished!==!0||r===w.CONNECTION_STATUS.CONNECTING)switch(w.finished=!1,w.setConnectionStatus(r),b.triggerEvent(r,w.actions),t.debug("[xmpp.fct.js] ("+w.id+") STATUS CHANGE:",r),r){case w.CONNECTION_STATUS.CONNFAIL:case w.CONNECTION_STATUS.ERROR:w.stayConnected===!0&&w.loggedOut!==!0?w.startReconnection():(window.cti.api.xmpp_connection.disconnect(),w.disablePing());break;case w.CONNECTION_STATUS.AUTHFAIL:w.setLastAuthStatus("failed"),window.cti.api.xmpp_connection.disconnect(),w.disablePing();break;case w.CONNECTION_STATUS.DISCONNECTED:w.stayConnected===!0&&w.loggedOut!==!0&&w.startReconnection(),w.finished=!0,w.disablePing(),o.reject("disconnected");break;case w.CONNECTION_STATUS.CONNECTED:w.loggedOut=!1,w.setLastAuthStatus("success"),window.cti.api.xmpp_connection.addHandler(w.onMessage,null,"message",null,null,null),window.cti.api.xmpp_connection.addHandler(w.onIq,null,"iq",null,null,null),window.cti.api.xmpp_connection.addHandler(w.onPresence,null,"presence",null,null,null),window.cti.api.xmpp_connection.streamManagement.requestResponseInterval=0,window.cti.api.xmpp_connection.streamManagement.enable(function(){var i=window.$iq({from:window.cti.api.xmpp_connection.jid,id:window.cti.api.xmpp_connection.getUniqueId(),type:"get"});i.c("query",{xmlns:"jabber:iq:roster"}),n.set("xmpp."+w.id+".contacts",[]),window.cti.api.xmpp_connection.sendIQ(i,function(i){t.debug("[xmpp.fct.js] ("+w.id+") GOT CONTACTS:",i),w.processContacts(i.querySelector("query").childNodes);var r=n.get("xmpp."+w.id+".user_status")||w.USER_STATUS.CHAT,s=function(){b.triggerEvent("connected",w.actions),w.enablePing(),w.enableOutbox===!0&&window.cti.api.xmpp_connection.outbox.processQueue(function(e){t.debug("[xmpp.fct.js] ("+w.id+") PROCESSED OUTBOX QUEUE:",e)},function(e){t.error("[xmpp.fct.js] ("+w.id+") ERROR PROCESSING OUTBOX QUEUE:",e)}),o.resolve()};w.setStatus(r).then(function(){w.stayConnected===!0?w.getSecureDb().then(function(n){t.debug("[xmpp.fct.js] ("+w.id+") Storing credentials for auto-login."),n.put({_id:w.DB.ID+"_data",_rev:w.DB.REVISION,data:e+":"+a}).then(function(e){w.DB.REVISION=e.rev,s()})["catch"](function(e){t.error(e),o.reject(e)})})["catch"](function(e){t.error(e),o.reject(e)}):s()})["catch"](function(e){o.reject(e)})})},function(e){o.reject(e)})}})):(w.setLastAuthStatus("failed"),window.cti.api.xmpp_connection.disconnect()),o.promise},w.logout=function(){var e=i.defer();return w.loggedOut=!0,w.stayConnected===!0?w.getSecureDb().then(function(t){t.destroy().then(function(){w.DB.REVISION=null,window.cti.api.xmpp_connection.disconnect(),e.resolve()})["catch"](function(t){e.reject(t)})})["catch"](function(t){e.reject(t)}):(window.cti.api.xmpp_connection.disconnect(),e.resolve()),e.promise},w.pingTimeout=null,w.disablePing=function(){null!==w.pingTimeout&&(clearTimeout(w.pingTimeout),w.pingTimeout=null)},w.enablePing=function(){w.disablePing(),null!==window.cti.api.xmpp_connection&&window.cti.api.xmpp_connection.connected===!0&&(w.pingTimeout=setTimeout(function(){w.ping()},w.pingTime||5e3))},w.ping=function(){var e=window.$iq({from:window.cti.api.xmpp_connection.jid,id:window.cti.api.xmpp_connection.getUniqueId(),type:"get"});e.c("ping",{xmlns:"urn:xmpp:ping"}),window.cti.api.xmpp_connection.sendIQ(e,function(){w.enablePing()},function(){w.disablePing(),t.debug("[xmpp.fct.js] ("+w.id+") Ping failed..."),t.debug("[xmpp.fct.js] ("+w.id+") No response from ping, disconnecting."),window.cti.api.xmpp_connection.disconnect(),w.stayConnected===!0&&(t.debug("[xmpp.fct.js] ("+w.id+") Stay connected enabled, reconnecting..."),w.startReconnection())},w.pingTo||5e3)}}else t.error("Missing data for XMPP instance.");o.$on("device-resume",function(){w.stayConnected!==!0||null!==window.cti.api.xmpp_connection&&window.cti.api.xmpp_connection.connected!==!1||w.reconnect()})}return m.prototype.calcGroups=function(){var e=n.get("xmpp."+this.id+".contacts"),t=[];e.forEach(function(e){void 0!==e.groups&&e.groups.forEach(function(e){var n=d("filter")(t,{name:e},!0);0===n.length?t.push({name:e,count:1}):t=t.map(function(e){return e.count++,e})})}),n.set("xmpp."+this.id+".groups",t)},m.prototype.processContacts=function(e){if(void 0!==e&&e.length>0){for(var t=n.get("xmpp."+this.id+".contacts")||[],a=0;a<e.length;a++){var o=e[a],i=o.getAttribute("jid");if("remove"===o.getAttribute("subscription"))t=t.filter(function(e){return e.username!==i});else{var r=[],s=o.querySelectorAll("group");if(s.length>0)for(var c=0;c<s.length;c++){var l=s[c];r.push(window.Strophe.getText(l))}var u={name:o.getAttribute("name"),username:i,groups:r,status:null,friendly_status:null},d=t.filter(function(e){return e.username===i})[0];void 0===d?t.push(u):d=u}}n.set("xmpp."+this.id+".contacts",t),this.calcGroups()}},m.prototype.getSecureDb=function(){var e=i.defer();this.DB.ID=n.getId()+"_"+this.id+"_xmpp_db";var t=new PouchDB(this.DB.ID,{revs_limit:10});return n.getEncryptionKey(this.DB.ID).then(function(n){return t.crypto({key:n}),e.resolve(t)})["catch"](function(t){e.reject(t)}),e.promise},m.prototype.reconnectInterval=null,m.prototype.startReconnection=function(){var e=this;null===e.reconnectInterval&&(e.reconnectInterval=setInterval(function(){window.cti.api.xmpp_connection.connected===!1?(t.debug("[xmpp.fct.js] ("+e.id+") Trying to reconnect..."),e.reconnect().then(function(){t.debug("[xmpp.fct.js] ("+e.id+") Successfully reconnected!"),clearInterval(e.reconnectInterval),e.reconnectInterval=null})):null!==e.reconnectInterval&&(clearInterval(e.reconnectInterval),e.reconnectInterval=null)},e.reconnectTime||5e3))},m.prototype.reconnect=function(){var e=i.defer(),n=this;return this.getSecureDb().then(function(o){o.get(n.DB.ID+"_data").then(function(o){n.DB.REVISION=o._rev;var i=o.data.split(":");if(void 0!==i[0]&&void 0!==i[1]){var r=i[0],s=i[1];t.debug("[xmpp.fct.js] ("+n.id+') Auto-Logging in as "'+r+'".'),n.login(r,s).then(function(){var t=a.get("ActionFactory");t.triggerEvent("reconnected",n.actions),e.resolve()})["catch"](function(t){e.reject(t)})}else e.reject("Could not extract the saved credentials from the encrypted database.")})["catch"](function(){t.debug("[xmpp.fct.js] ("+n.id+") Stored credentials could not be found to auto-login."),e.resolve()})})["catch"](function(t){e.reject(t)}),e.promise},m.prototype.DB={ID:null,KEY:"2%^%123$^#_##}{P21$@#Dd}23fs#!@|#213@™4",REVISION:null},m.prototype.USER_STATUS={AWAY:"away",CHAT:"chat",DO_NOT_DISTURB:"dnd",EXTENDED_AWAY:"xa"},m.prototype.MESSAGE_STATUS={SENDING:"sending",SENT:"sent",FAILED:"failed",RECEIVED:"received",DISPLAYED:"displayed",ACKNOWLEDGED:"acknowledged"},m.prototype.MEDIA_STATUS={DOWNLOADING:"downloading",DOWNLOADED:"downloaded",FAILED:"failed",UPLOADING:"uploading",UPLOADED:"uploaded"},m.prototype.CONNECTION_STATUS={ERROR:"error",CONNECTING:"connecting",CONNFAIL:"connection-failed",AUTHENTICATING:"authenticating",AUTHFAIL:"authentication-failed",CONNECTED:"connected",DISCONNECTED:"disconnected",DISCONNECTING:"disconnecting",ATTACHED:"attached"},m.prototype.setStatus=function(e){var t=i.defer(),a=null;switch(e){case this.USER_STATUS.AWAY:a="Away";break;case this.USER_STATUS.CHAT:a="Available";break;case this.USER_STATUS.DO_NOT_DISTURB:a="Do Not Disturb";break;case this.USER_STATUS.EXTENDED_AWAY:a="Extended Away"}if(null!==a){var o=window.$pres({from:window.cti.api.xmpp_connection.jid}).c("show",null,e).c("status",null,a);n.set("xmpp."+this.id+".user_status",e),window.cti.api.xmpp_connection.send(o.tree()),t.resolve()}else t.reject("Invalid status provided.");return t.promise},m.prototype.setConnectionStatus=function(e){n.set("xmpp."+this.id+".connection_status",e)},m.prototype.setLastAuthStatus=function(e){n.set("xmpp."+this.id+".last_auth_status",e)},m.prototype.statusCodeToTxt=function(e){var t=null;switch(e){case window.Strophe.Status.ERROR:t=this.CONNECTION_STATUS.ERROR;break;case window.Strophe.Status.CONNECTING:t=this.CONNECTION_STATUS.CONNECTING;break;case window.Strophe.Status.CONNFAIL:t=this.CONNECTION_STATUS.CONNFAIL;break;case window.Strophe.Status.AUTHENTICATING:t=this.CONNECTION_STATUS.AUTHENTICATING;break;case window.Strophe.Status.AUTHFAIL:t=this.CONNECTION_STATUS.AUTHFAIL;break;case window.Strophe.Status.CONNECTED:t=this.CONNECTION_STATUS.CONNECTED;break;case window.Strophe.Status.DISCONNECTED:t=this.CONNECTION_STATUS.DISCONNECTED;break;case window.Strophe.Status.DISCONNECTING:t=this.CONNECTION_STATUS.DISCONNECTING;break;case window.Strophe.Status.ATTACHED:t=this.CONNECTION_STATUS.ATTACHED}return t},m.prototype.createMessageXml=function(e){var t=this.getMessageFromAllHistory(e),n=window.$msg({to:t.to,from:t.from,id:e,type:"chat"}).tree();if(null!==t.addresses){var a=new window.Strophe.Builder("addresses",{xmlns:"http://jabber.org/protocol/address"}).tree();t.addresses.forEach(function(e){var t=new window.Strophe.Builder("address",{type:"to",jid:e}).tree();a.appendChild(t)}),n.appendChild(a)}if(void 0!==t.body){var o=new window.Strophe.Builder("body").t(t.body).tree();n.appendChild(o)}if(null!==t.media.remote){var i=new window.Strophe.Builder("x",{xmlns:"jabber:x:oob"}).tree(),r=new window.Strophe.Builder("url").t(t.media.remote).tree();i.appendChild(r),n.appendChild(i)}if(this.readReceipts!==!1){var s=new window.Strophe.Builder("markable",{xmlns:"urn:xmpp:chat-markers:0"}).tree();n.appendChild(s)}if(null!==t.ttl){var c=new window.Strophe.Builder("x",{xmlns:"jabber:x:expire",seconds:t.ttl}).tree();n.appendChild(c)}if(null!==t.metadata&&Object.keys(t.metadata).length>0){var l=new window.Strophe.Builder("metadata",{xmlns:"urn:commontime:mdesign:metadata"}).tree();for(var u in t.metadata)if(void 0!==t.metadata[u]){
var d=new window.Strophe.Builder(u).t(t.metadata[u]).tree();l.appendChild(d)}n.appendChild(l)}return n},m.prototype.sendMarker=function(e,t){var n=this.getMessageFromAllHistory(e),a=window.$msg({to:n.from,from:n.to,id:window.cti.api.xmpp_connection.getUniqueId(),type:"marker"});a.c(t,{xmlns:"urn:xmpp:chat-markers:0",id:e}),n.status=t,this.calcReadCount(n.from),window.cti.api.xmpp_connection.send(a.tree())},m.prototype.calcReadCount=function(e){if(void 0!==window.cti.store.xmpp[this.id]&&void 0!==window.cti.store.xmpp[this.id].history&&void 0!==window.cti.store.xmpp[this.id].history[e]){var t=window.cti.store.xmpp[this.id].history[e].messages,n=0,a=0,o=this;t.forEach(function(t){t.from==e&&(t.status===o.MESSAGE_STATUS.DISPLAYED||t.status===o.MESSAGE_STATUS.ACKNOWLEDGED?n+=1:a+=1)}),window.cti.store.xmpp[this.id].history[e].read=n,window.cti.store.xmpp[this.id].history[e].unread=a,this.saveAndUpdate()}},m.prototype.createMessageObject=function(e,n,a,o,i,r,s,c){var l=n===window.cti.api.xmpp_connection.authzid?e:n;if(void 0!==l){var u={id:void 0!==i&&null!==i?i:window.cti.api.xmpp_connection.getUniqueId(),from:n,ttl:void 0!==r?r:null,to:e,body:a,sent:!1,status:n===window.cti.api.xmpp_connection.authzid?this.MESSAGE_STATUS.SENDING:null,ts:(new Date).getTime(),media:{local:null,remote:null,status:null},metadata:void 0!==s&&null!==s?s:null,addresses:void 0!==c?c:null};return void 0!==o&&null!==o&&(void 0!==o.local&&(u.media.local=o.local),void 0!==o.remote&&(u.media.remote=o.remote),void 0!==o.status&&(u.media.status=o.status)),this.addHistory(l,u),this.getMessageFromHistory(l,u.id)}return t.error("Recipient required for a message."),null},m.prototype.getMessageFromHistory=function(e,t){var n=null;if(void 0!==window.cti.store.xmpp[this.id].history[e]){var a=window.cti.store.xmpp[this.id].history[e].messages;void 0!==a&&a.length>0&&a.forEach(function(e){e.id==t&&(n=e)})}return n},m.prototype.getMessageFromAllHistory=function(e){var t=window.cti.store.xmpp[this.id].history,n=null;if(void 0!==t)for(var a in t)null===n&&(n=this.getMessageFromHistory(a,e));return n},m.prototype.addHistory=function(e,t){void 0===window.cti.store.xmpp[this.id].history[e]&&(window.cti.store.xmpp[this.id].history[e]={messages:[],read:0,unread:0}),t.ts=(new Date).getTime(),window.cti.store.xmpp[this.id].history[e].messages.push(t)},m.prototype.saveAndUpdate=function(){n.save().then(function(){o.$emit("StoreHasChanged")})},m.prototype.cleanQueue=function(){if(void 0!==window.cti.store.xmpp[this.id]){var e=window.cti.store.xmpp[this.id].history,t=!1;if(void 0!==e){var n=this;for(var a in e){var o=e[a].messages;void 0!==o&&o.forEach(function(e){e.status===n.MESSAGE_STATUS.SENDING&&(e.status=n.MESSAGE_STATUS.FAILED,t=!0)})}}t===!0&&this.saveAndUpdate()}},m.prototype.getBareJid=function(e){return window.Strophe.getBareJidFromJid(e)},m}]),angular.module("app.core").factory("XmppFactory",["Xmpp","$q",function(e,t){function n(t){u[t.name]=new e(t.name,t.endpoint,t.actions,t["upload-jid"],t["read-receipts"],t["stay-connected"],t["multicast-jid"],t["ping-time"],t["ping-timeout"],t["send-timeout"],t.outbox,t["reconnect-time"])}function a(e){var n=t.defer(),a=e.name;return void 0!==a?void 0!==u[a]?u[a].send(e).then(function(){n.resolve(!0)})["catch"](function(e){n.reject(e)}):n.reject('XMPP instance with name "'+a+'" does not exist.'):n.reject("XMPP instance name not specified."),n.promise}function o(e){var n=t.defer(),a=e.name;return void 0!==a?void 0!==u[a]?u[a].sendToGroup(e).then(function(){n.resolve(!0)})["catch"](function(e){n.reject(e)}):n.reject('XMPP instance with name "'+a+'" does not exist.'):n.reject("XMPP instance name not specified."),n.promise}function i(e){var n=t.defer(),a=e.name;return void 0!==a?void 0!==u[a]?u[a].markRead(e).then(function(){n.resolve(!0)})["catch"](function(e){n.reject(e)}):n.reject('XMPP instance with name "'+a+'" does not exist.'):n.reject("XMPP instance name not specified."),n.promise}function r(e){var n=t.defer(),a=e.name;return void 0!==a?void 0!==u[a]?void 0!==e.id?(u[a].sendMarker(e.id,"acknowledged"),n.resolve()):n.reject("Message ID must be provided."):n.reject('XMPP instance with name "'+a+'" does not exist.'):n.reject("XMPP instance name not specified."),n.promise}function s(e){var n=t.defer(),a=e.name,o=e.custom||e.status;return void 0!==a&&void 0!==o?void 0!==u[a]?u[a].setStatus(o).then(function(){n.resolve(!0)})["catch"](function(e){n.reject(e)}):n.reject('XMPP instance with name "'+a+'" does not exist.'):n.reject("XMPP instance name not specified."),n.promise}function c(e){var n=t.defer(),a=e.name;return void 0!==a?void 0!==u[a]?u[a].login(e.username,e.password).then(function(){n.resolve()})["catch"](function(e){n.reject(e)}):n.reject('XMPP instance with name "'+a+'" does not exist.'):n.reject("XMPP instance name not specified."),n.promise}function l(e){var n=t.defer(),a=e.name;return void 0!==a?void 0!==u[a]?u[a].logout().then(function(){n.resolve()})["catch"](function(e){n.reject(e)}):n.reject('XMPP instance with name "'+a+'" does not exist.'):n.reject("XMPP instance name not specified."),n.promise}var u={},d={init:n,send:a,login:c,logout:l,markRead:i,setStatus:s,sendToGroup:o,markAcknowledged:r};return d}]),angular.module("app.core").factory("FileSystem",["Plugin","$q","Platform","electron","MimeTypes","$log",function(e,t,n,a,o,i){function r(){return void 0!==a.app}function s(){return void 0!==window.resolveLocalFileSystemURL}function c(o){if(r()){var i=a.path.sep,s=a.app.getPath("userData"),c=s+i;return t.when(c)}if("winphone"==n.getName())return t.resolve("");var l=e.getSource("file");if(!l)return t.reject("File System unavailable on this platform: "+navigator.userAgent);var u=t.defer();switch(n.getName()){case"ios":u.resolve(l.documentsDirectory);break;case"android":o?u.resolve(l.dataDirectory):u.resolve(l.externalDataDirectory);break;default:u.resolve(l.dataDirectory)}return u.promise}function l(e){var a=t.defer();return c(e).then(function(e){s()?("winphone"==n.getName()&&""===e&&(e+=".\\"),window.resolveLocalFileSystemURL(e,function(e){a.resolve(e)},function(e){a.reject(e)})):a.reject("Local file system unavailable on this platform.")})["catch"](function(e){a.reject(e)}),a.promise}function u(e,n){var i=t.defer();return c(n).then(function(t){r()?a.fsplus.stat(t+e,function(n,a){n?i.reject({message:"Error obtaining file '"+e+"'",innerError:n}):i.resolve({name:e,filePath:t+e,mimeType:o.mimeTypeFromExtension(e),size:a.size})}):s()?window.resolveLocalFileSystemURL(t+e,function(e){e.file(function(e){i.resolve({name:e.name||e.localURL,filePath:e.localURL,mimeType:o.mimeTypeFromExtension(e.name||e.localURL),size:e.size})})},function(t){i.reject({message:"Error obtaining file '"+e+"'",innerError:t})}):i.reject("Local file system unavailable on this platform: "+navigator.userAgent)})["catch"](function(t){i.reject({message:"Error obtaining file '"+e+"'",innerError:t})}),i.promise}function d(e){var n=t.defer();return c().then(function(t){r()?a.fsplus.readFile(t+e,function(t,a){if(t)n.reject({message:"Error obtaining file blob for file '"+e+"'",innerError:t});else{var i=new Blob([a],{type:o.mimeTypeFromExtension(e)});n.resolve(i)}}):s()?window.resolveLocalFileSystemURL(t+e,function(t){t.file(function(t){var a=new FileReader;a.onloadend=function(t){var a=new Blob([t.target.result],{type:o.mimeTypeFromExtension(e)});n.resolve(a)},a.readAsArrayBuffer(t)})},function(t){n.reject({message:"Error obtaining file blob for file '"+e+"'",innerError:t})}):n.reject("Unable to read file on this platform: "+navigator.userAgent)})["catch"](function(t){n.reject({message:"Error obtaining file blob for file '"+e+"'",innerError:t})}),n.promise}function p(e){return e.replace(/\\/g,"/").split("/").pop()}function m(e){return e.indexOf("/")==-1?e.substring(0,e.lastIndexOf("\\")+1):e.substring(0,e.lastIndexOf("/")+1)}function g(e,n){var i=t.defer();return c().then(function(t){var c=t+e,u=o.mimeTypeFromExtension(e);if(r()){var d=new Uint8Array(n),p=new window.Buffer(d);a.fsplus.writeFile(c,p,function(t){t?i.reject({message:"Error saving file '"+e+"'",innerError:t}):i.resolve(c)})}else s()?l().then(function(t){t.getFile(e,{create:!0,exclusive:!1},function(t){t.createWriter(function(a){a.onwriteend=function(){t.file(function(e){i.resolve(e.localURL)})},a.onerror=function(t){i.reject({message:"Error saving file '"+e+"'",innerError:t})};var o=new Blob([n],{type:u});a.write(o)})})}):i.reject("Unable to save file on this platform: "+navigator.userAgent)})["catch"](function(t){i.reject({message:"Error saving file '"+e+"'",innerError:t})}),i.promise}function f(e,n){var o=t.defer();return c().then(function(t){if(r()){var i=t+e,c=t+n;a.fsplus.rename(i,c,function(t){t?o.reject({message:"Error renaming file '"+e+"'",innerError:t}):o.resolve(c)})}else s()?l().then(function(t){t.getFile(e,{create:!1,exclusive:!0},function(a){a.moveTo(t,n,function(e){e.file(function(e){o.resolve(e.localURL)})},function(t){o.reject({message:"Error renaming file '"+e+"'",innerError:t})})},function(t){o.reject({message:"Error renaming file '"+e+"'",innerError:t})})}):o.reject("Unable to rename file on this platform: "+navigator.userAgent)})["catch"](function(t){o.reject({message:"Error renaming file '"+e+"'",innerError:t})}),o.promise}function v(e,o){var i=t.defer();return c().then(function(t){if(r()){var c=t+o;a.fsplus.rename(e,c,function(t){t?i.reject({message:"Error moving file at '"+e+"'",innerError:t}):i.resolve(c)})}else if(s()){"ios"!==n.getName()&&"android"!==n.getName()||e.indexOf("file://")==-1&&(e="file://"+e);var l=m(e),u=p(e);window.resolveLocalFileSystemURL(l,function(t){t.getFile(u,{create:!1,exclusive:!0},function(n){n.moveTo(t,o,function(e){e.file(function(e){i.resolve(e.localURL)})},function(t){i.reject({message:"Error moving file '"+e+"'",innerError:t})})},function(t){i.reject({message:"Error moving file '"+e+"'",innerError:t})})})}else i.reject("Unable to move file on this platform: "+navigator.userAgent)})["catch"](function(t){i.reject({message:"Error moving file '"+e+"'",innerError:t})}),i.promise}function h(n,a,o){var i=r()?e.getSource("@commontimeltd/com.commontime.filetransfer"):e.getSource("FileTransfer");if(!i)return t.reject("File transfer plugin not available");var s=t.defer(),c={httpMethod:o.httpMethod,fileName:o.fileName||p(n),fileKey:o.fileKey,headers:o.headers},l=new i;return l.upload(n,a,function(e){s.resolve({source:n,target:a,response:e.response})},function(e){s.reject({message:"Error uploading file '"+n+"' to '"+a+"'",innerError:e})},c),s.promise}function y(n,a){function i(e){var t=e+a,i=new s;i.download(n,t,function(e){r()?u.resolve({filePath:e.filePath,mimeType:o.mimeTypeFromExtension(e.filePath)}):e.file(function(e){u.resolve({filePath:e.localURL,mimeType:o.mimeTypeFromExtension(e.localURL)})},function(e){u.reject({message:"Error download file from '"+n+"' to '"+t+"'",innerError:e})})},function(e){u.reject({message:"Error download file from '"+n+"' to '"+t+"'",innerError:e})})}var s=r()?e.getSource("@commontimeltd/com.commontime.filetransfer"):e.getSource("FileTransfer");if(!s)return t.reject("File transfer plugin not available");r()?c().then(function(e){i(e)}):l().then(function(e){i(e.nativeURL)});var u=t.defer();return u.promise}function b(){var e=t.defer(),n=new Date,a=n.getTime(),o=a+".m4a";return c().then(function(t){0===t.indexOf("file://")&&(t=t.replace("file://",""));var n=t+o;e.resolve(n)})["catch"](function(e){i.error(e)}),e.promise}function w(e){var o=t.defer(),c=function(){i.error(arguments),o.reject(arguments)};if(void 0===e||null===e)c("Could not delete media item - no uri specified");else if(r()||s())if(r())try{a.fsplus.existsSync(e)===!1?c("Error deleting file - file does not exist"):a.fsplus.isFileSync(e)===!1?c("Error deleting file - path was not a file"):(a.fsplus.removeSync(e),o.resolve())}catch(l){c("Error deleting file",l)}else try{var u=e.indexOf("file://")==-1;"winphone"!=n.getName()&&u&&(e="file://"+e),window.resolveLocalFileSystemURL(e,function(t){t.isDirectory?c("Error getting file to delete - file uri resolved to a directory: ",e):t.remove(function(){o.resolve()},function(e){c("Error deleting the file: ",e)})},function(e){c("Error getting file entry",e)})}catch(l){c("Error deleting file: ",l)}else c("resolveLocalFileSystemURL is not available - platform could not be detected");return o.promise}function A(e){var n=t.defer(),r=[];if(void 0!==e&&e.length>0){var s=[];e.forEach(function(e){var t=o.extensionFromMimeType(e);null!==t&&s.push(t)}),s.length>0&&r.push({name:"Mimes",extensions:s})}return a.dialog.showOpenDialog({properties:["openFile","singleSelection"],filters:r},function(e){void 0==e||void 0!=e&&0==e.length||c().then(function(t){var o=e[0],r=p(o),s=t+r;a.fsplus.copy(e[0],s,function(e){return e?i.error(e):void n.resolve(s)})})}),n.promise}function S(e){return e.replace(/\\/g,a.path.sep).replace(/\//g,a.path.sep)}function $(n,a){var o=t.defer();if(r()){var i=S(n),c=e.getSource("fs");if(!c)return t.reject("FileSystem not supported on this platform: "+navigator.userAgent);var l=a===!0?"base64":"utf8";c.readFile(i,l,function(e,t){e?o.reject(e):o.resolve(t)})}else s()?window.resolveLocalFileSystemURL(n,function(e){e.file(function(e){var t=new FileReader;t.onloadend=function(e){o.resolve(e.target.result)},a===!0?t.readAsDataURL(e):t.readAsText(e)})},o.reject):o.reject("Unable to read file on this platform: "+navigator.userAgent);return o.promise}function x(e){if(!s())return t.when(e);if(0!==e.indexOf("cdvfile://"))return t.when(e);var n=t.defer();return window.resolveLocalFileSystemURL(e,function(e){var t=e.toURL();n.resolve(t)},n.reject),n.promise}return{getStorageLocation:c,getStorage:l,getFile:u,getFileBlob:d,getFileNameFromPath:p,saveFile:g,renameFile:f,moveFileToStorage:v,upload:h,download:y,generateFileName:b,deleteMediaItem:w,selectFile:A,readFile:$,resolveCdvFilePath:x}}]),angular.module("app.core").factory("Platform",["StoreFactory",function(e){function t(){e.set("env.platform.type",n()),e.set("env.platform.name",a())}function n(){return window.cordova!==!1&&/iPhone|iPad|iPod|IEMobile|Android/i.test(navigator.userAgent)?"device":/Electron/i.test(navigator.userAgent)?"desktop":/Chrome/i.test(navigator.userAgent)||/Firefox/i.test(navigator.userAgent)||i.test(navigator.userAgent)?"browser":null}function a(){return/IEMobile/i.test(navigator.userAgent)||/Windows Phone 8\.1/i.test(navigator.userAgent)?"winphone":/Android/i.test(navigator.userAgent)?"android":/iPhone|iPad|iPod/i.test(navigator.userAgent)?"ios":/Electron/i.test(navigator.userAgent)?"electron":/Chrome/i.test(navigator.userAgent)?"chrome":/Firefox/i.test(navigator.userAgent)?"firefox":i.test(navigator.userAgent)?"internet_explorer":null}var o={init:t,getType:n,getName:a},i=navigator.userAgent.indexOf("MSIE")!=-1?/MSIE (\d+\.\d+);/:/Trident.*rv[ :]*(\d+\.\d+)/;return o}]),angular.module("app.core").factory("InboxOutboxFactory",["$q","$log","$injector","Plugin","Utilities","electron",function(e,t,n,a,o,i){function r(){var t=sessionStorage.getItem("debug");if(t){var a=t.split("|");M=a.indexOf("*")!==-1||a.indexOf("inboxoutbox")!==-1}if(k('Ensuring "InboxOutbox" factory is initialised...'),U)return e.when();var o=e.defer();return V=n.get("SchemaService"),G=n.get("ActionFactory"),x().then(function(){B===!1?o.reject('Unable to initialise "notify" plugin'):setTimeout(function(){k("Registering global outbox and inbox change handlers"),B.receiveInboxChanges(P,$),B.receiveOutboxChanges(P,S),j=!0,o.resolve()},0)})["catch"](function(e){F(e)}),U=!0,o.promise}function s(t){if(!j)return e.reject("Notfiy plugin not initialised");var n=e.defer();return k('Setting "notify" options:',t),B.setOptions(function(){n.resolve()},function(){n.reject("Error setting message queue options")},t),n.promise}function c(e){return R?a.getSource("@commontimeltd/com.commontime."+e):a.getSource(e)}function l(t){return k("Registering provider with InboxOutboxFactory:",t),q[t.name]={outboxChangeCallback:t.outboxChangeCallback,inboxChangeCallback:t.inboxChangeCallback},e.when(q[t.name])}function u(){return V.isPreview()||V.isLivePreview()}function d(e){return"REQUEST_"+e.toUpperCase()+"_"+o.uuid()}function p(t){return j?E("addChannel",[t]):e.reject("Notfiy plugin not initialised")}function m(t){return j?E("removeChannel",[t]):e.reject("Notfiy plugin not initialised")}function g(t){return j?(k("Sending message...",t),E("sendMessage",[t])):e.reject("Notfiy plugin not initialised")}function f(t,n){return j?(k('Acknowledging message id "'+n+'" for receiver "'+t+'"'),E("messageReceivedAck",[t,n])):e.reject("Notfiy plugin not initialised")}function v(t){return j?(k('Deleting message "'+t+'"'),E("deleteMessage",[t])):e.reject("Notfiy plugin not initialised")}function h(e){if(e.hasOwnProperty(V.ITEM_AUTO_ID_PROPERTY)){var t=e[V.ITEM_AUTO_ID_PROPERTY];return H[t]=e,t}return null}function y(e){if(H.hasOwnProperty(e))return k("Found invoking action in action cache:",H[e]),H[e];k("Invoking action not found in action cache, searching in app schema...");var t=V.findItemById(e);return t?k("Found in app schema:",t):k("No action found with action id:",e),t}function b(e,t,n){return k('Calling "'+t+'" actions from',e,"with model",n),G.triggerEvent(t,e,n)}function w(t,n,a){return k("Looking for child actions of:",t),null===t||!t.actions instanceof Array?e.when():b(t.actions,n,a)}function A(){return M===!0}function S(e,t){setTimeout(function(){k("Outbox change received:",t);var n=T(t),a=C(n);null!==a&&"function"==typeof a.outboxChangeCallback&&(k('Routing outbox change to provider "'+n+'"'),a.outboxChangeCallback(e,t))},0)}function $(e,t){setTimeout(function(){k("Inbox change received:",t);var n=T(t),a=C(n);null!==a&&"function"==typeof a.inboxChangeCallback&&(k('Routing inbox change to provider "'+n+'"'),a.inboxChangeCallback(e,t))},100)}function x(){var t=e.defer();return k('Obtaining "nofity" plugin...'),B=L===!0?I():R?a.getSource("@commontimeltd/com.commontime.notify"):a.getSource("notify"),t.resolve(B),t.promise}function E(t,n){var a=e.defer();return n.push(function(e,t){e?a.reject(e):a.resolve(t)}),B[t].apply(B,n),a.promise}function T(e){var t=e.message.provider;return t||(t=_),t}function C(e){return q.hasOwnProperty(e)?q[e]:null}function k(){if(M===!0&&void 0!==arguments){var e=Array.prototype.slice.call(arguments);e.length>0&&"string"==typeof e[0]&&(e[0]="[inboxOutbox.fct.js] "+e[0]),t.log.apply(t,e)}}function F(){if(void 0!==arguments){var e=Array.prototype.slice.call(arguments);e.length>0&&"string"==typeof e[0]&&(e[0]="[inboxOutbox.fct.js] "+e[0]),t.error.apply(t,e)}}function I(){function e(e,t){setTimeout(function(){e(void 0,t)},n)}t.info("*** USING MOCK NOTIFY PLUGIN: Turn this off in inboxOutbox.fct.js if you expect to use the real plugin ***");var n=500;return{___queues:{},___localChannels:[],___onInboxChange:null,___onOutboxChange:null,addChannel:function(t,n){k("addChannel called with arguments:",arguments),this.___localChannels.indexOf(t)===-1&&this.___localChannels.push(t),e(n,t)},removeChannel:function(t,n){k("removeChannel called with arguments:",arguments);var a=this.___localChannels.indexOf(t);a!==-1&&this.___localChannels.splice(a,1),e(n,t)},sendMessage:function(t,n){k("sendMessage called with arguments:",arguments),this.___queues[t.channel]||(this.___queues[t.channel]=[]);var a="Message_"+o.uuid();if(t.id=a,t.date=(new Date).getTime(),this.___queues[t.channel].push(t),this.___localChannels.indexOf(t.channel)!==-1){if("function"==typeof this.___onOutboxChange){var i={action:"SENDING",message:t},r={action:"SENT",message:t};this.___onOutboxChange(void 0,i),this.___onOutboxChange(void 0,r)}if("function"==typeof this.___onInboxChange){var s={action:"create",message:t};this.___onInboxChange(void 0,s)}}e(n,a)},deleteMessage:function(t,n){k("deleteMessage called with arguments:",arguments);for(var a in this.___queues)if(this.___queues.hasOwnProperty(a))for(var o=this.___queues[a].length-1;o>=0;o--)this.___queues[a][o].id===t&&this.___queues[a].splice(o,1);e(n,t)},messageReceivedAck:function(t,n,a){k("messageReceivedAck called with arguments:",arguments),e(a,null)},receiveInboxChanges:function(e,t){k("receiveInboxChanges called with arguments:",arguments),this.___onInboxChange=t},receiveOutboxChanges:function(e,t){k("receiveOutboxChanges called with arguments:",arguments),this.___onOutboxChange=t}}}var L=!1,P="com.commontime.inboxOutbox",_="azure.servicebus",D="azure.appservices",N="rest",O=null,M=!1,R=void 0!==i.app,U=!1,j=!1,q={},B=null,V=null,G=null,H={};return{init:r,setOptions:s,getProviderPlugin:c,registerProvider:l,isFromStudio:u,generateRequestId:d,addChannel:p,removeChannel:m,sendMessage:g,acknowledgeMessage:f,deleteMessage:v,getActionId:h,getActionById:y,callActions:b,callChildActions:w,isDebugMode:A,USE_MOCK_PLUGIN:L,PROVIDER_AZURESERVICEBUS:_,PROVIDER_AZUREAPPSERVICES:D,PROVIDER_REST:N,PROVIDER_UNKNOWN:O}}]),angular.module("app.core").factory("MessageQueueFactory",["$q","$log","InboxOutboxFactory","StoreFactory",function(e,t,n,a){function o(t){if(T)return e.when();var a=e.defer();return n.init().then(function(){h("Initialising message queue providers with schema...",t);var e=t.settings["message-queue"],n=u(e);0===n.length&&(h("No message queue providers enabled"),a.resolve()),F=p(n),m().then(function(){return g(n)}).then(function(){return f(t)}).then(function(){return v()}).then(function(){C=!0,a.resolve()})["catch"](function(e){y(e),a.reject(e)})})["catch"](function(e){y(e),a.reject(e)}),T=!0,a.promise}function i(t){if(!C)return e.reject("Message Queue plugin not initialised");if(!t)return e.reject("Missing queue name");t=t.toLowerCase(),h('Listening to queue "'+t+'"...');var a=n.addChannel(t);return a.then(function(){h('Adding "'+t+'" to store'),w(t)}),a}function r(t){if(!C)return e.reject("Message Queue plugin not initialised");if(!t)return e.reject("Missing queue name");t=t.toLowerCase(),h('Stopped listening to queue "'+t+'"...');var a=n.removeChannel(t);return a.then(function(){h('Removing "'+t+'" from store'),A(t)}),a}function s(t,a){if(!C)return e.reject("Message Queue plugin not initialised");if(!t)return e.reject("Missing queue name");if(!a)return e.reject('Invalid message content "'+a+'"');t=t.toLowerCase();var o=new Date,i=o.getUTCFullYear()+1,r=Date.UTC(i,o.getUTCMonth(),o.getUTCDate(),o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds()),s={channel:t,subchannel:E,expiry:r,provider:F.name,notification:"",content:{data:a}};return n.sendMessage(s)}function c(e,t){return e?void y(e):void("sent"===t.action.toLowerCase()&&k.onSent.length&&(h('Triggering "message sent" event'),n.callActions(k.onSent,"click",{$messageId:t.message.id})))}function l(e,t){if(e)y(e);else if("create"===t.action.toLowerCase()&&k.onReceived.length){var a={$message:{id:t.message.id,queue:t.message.channel,body:t.message.content.data,sent:parseInt((t.message.date||0).toString()),received:parseInt((new Date).getTime().toString())}};h('Triggering "message received" event'),n.callActions(k.onReceived,"click",a).then(function(){n.acknowledgeMessage(x,t.message.id),n.deleteMessage(t.message.id)})}}function u(e){var t=[],a=e.asb||{};if(a.enabled===!0){h('Obtaining provider "'+n.PROVIDER_AZURESERVICEBUS+'"...');var o={sbHostName:a.hostName,serviceNamespace:a.serviceNamespace,sasKeyName:a.keyName,sasKey:a.key,brokerType:a.brokerType,brokerAutoCreate:a.autoCreate||!1};t.push({name:n.PROVIDER_AZURESERVICEBUS,loadProviderPromise:d("asb",o)})}return t}function d(t,a){var o=e.defer();h('Initialising "'+t+'" message queue provider...');var i=n.USE_MOCK_PLUGIN===!0?S(t):n.getProviderPlugin(t);return i===!1?o.reject('Unable to initialise "'+t+'" plugin'):n.isFromStudio()?(h('...running from Studio - injecting "'+t+'" message queue preferences:',a),i.start(o.resolve,o.reject,a)):(h('...using "'+t+'" message queue preferences from configuration file'),i.start(o.resolve,o.reject)),o.promise}function p(e){return e.length>0?e[0]:null}function m(){var t=e.defer();if(n.isFromStudio())if(null!==F){var a={defaultPushSystem:F.name};n.setOptions(a).then(function(){t.resolve()})["catch"](function(e){t.reject(e)})}else t.reject("No default push system was specified");else h("Options being obtained from config.xml / package.json"),t.resolve();return t.promise}function g(t){var a=[];return angular.forEach(t,function(t){var o=e.defer();t.loadProviderPromise.then(function(){h('Registering message queue provider "'+t.name+'"');var e={name:t.name,outboxChangeCallback:c,inboxChangeCallback:l};n.registerProvider(e).then(function(){o.resolve()})}),a.push(o)}),e.all(a)}function f(t){var n=e.defer();return t&&t.config&&t.config.length&&angular.forEach(t.config,function(e){if("message-queue-event"===e["item-type"])switch((e.eventType||"").toLowerCase()){case"ready":k.onReady=k.onReady.concat(e.actions);break;case"received":k.onReceived=k.onReceived.concat(e.actions);break;case"sent":k.onSent=k.onSent.concat(e.actions);break;default:y('Unknown message queue event type "'+e.eventType+'"')}}),h("Registered actions:",k),n.resolve(),n.promise}function v(){var t=e.defer();return setTimeout(function(){var e=b();e.length&&(h("Re-adding queues:",e),angular.forEach(e,function(e){n.addChannel(e.toLowerCase())})),h('Triggering "ready" event'),n.callActions(k.onReady,"click"),t.resolve()},0),t.promise}function h(){if(n.isDebugMode()&&void 0!==arguments){var e=Array.prototype.slice.call(arguments);e.length>0&&"string"==typeof e[0]&&(e[0]="[messageQueue.fct.js] "+e[0]),t.log.apply(t,e)}}function y(){if(void 0!==arguments){var e=Array.prototype.slice.call(arguments);e.length>0&&"string"==typeof e[0]&&(e[0]="[messageQueue.fct.js] "+e[0]),t.error.apply(t,e)}}function b(){var e=a.get($)||{};return e.listeningTo||[]}function w(e){var t=b();t.push(e),a.set($,{listeningTo:t})}function A(e){var t=b(),n=t.indexOf(e);n!==-1&&(t.splice(n,1),a.set($,{listeningTo:t}))}function S(e){function n(n,a){t.info("*** USING MOCK "+e.toUpperCase()+" PLUGIN: Set USE_MOCK_PLUGIN to false in inboxOutbox.fct.js if you expect to use the real plugin ***");var o=500;setTimeout(function(){n(void 0,a)},o)}return{start:function(e){h("start called with arguments:",arguments),n(e,"ok")}}}var $="messageQueues",x="com.commontime.infinity.messageQueue",E="default",T=!1,C=!1,k={onReady:[],onReceived:[],onSent:[]},F=null;return{init:o,startListening:i,stopListening:r,sendMessage:s}}]),angular.module("app.core").factory("RestFactory",["$q","$log","InboxOutboxFactory","Api","StoreFactory","Utilities","FileSystem","MimeTypes",function(e,t,n,a,o,i,r,s){function c(){if(x)return e.when();var t=e.defer();return n.init().then(function(){return m()}).then(function(){var e={name:n.PROVIDER_REST,outboxChangeCallback:d,inboxChangeCallback:p};return n.registerProvider(e)}).then(function(){E=!0,t.resolve()})["catch"](function(e){w(e),t.reject(e)}),x=!0,t.promise}function l(e){b("Registering Offline API item:",e),T.push(e)}function u(t){if(!E)return e.reject($+" plugin not initialised");b("Making request for action:",t);var o=n.getActionId(t),i=t.data.name,r=t.data.operation,s=g(i),c=f(s,r);if(null===c)return e.reject('Unknown operation "'+r+'"');b('Invoking operation "'+r+'" with config:',c);var l=new a(s.name,s.url,s.params,s.headers,s.operations);return l.buildRequestObject(c,t.data.params,v).then(function(e){c.downloadAsFile===!0&&(e.downloadAsFile=c.downloadAsFile,e.downloadFileName=c.downloadFileName),e.invokingActionId=o;var a=c.ttlMinutes;void 0===a&&(a=60);var i=0;if(0===a)i=0;else{var r=new Date;i=Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds()),i+=60*a*1e3}var s=n.generateRequestId(n.PROVIDER_REST),l={channel:S,subchannel:s,provider:n.PROVIDER_REST,expiry:i,content:e};n.sendMessage(l)["catch"](function(e){w(e),n.callChildActions(t,"fail",{$response:e})})})["catch"](function(e){w(e)}),e.when(!0)}function d(e){void 0!==e&&w(e)}function p(e,t){if(void 0!==e)w(e);else if("create"===t.action.toLowerCase()){var a=h(t);if(null===a)b("Unable to handle inbox change - no message request data found in result:",t);else{var i=a.invokingActionId,r=n.getActionById(i);null!==r&&y(t).then(function(e){b("Parsed response for "+r.data.name+"."+r.data.operation+": ",e),e.isSuccess&&o.set("offlineApi."+r.data.name+"."+r.data.operation,e.responseData);var a=e.isSuccess?"success":"fail";b('Calling child "'+a+'" actions of action id "'+i+'" with model:',e.responseData),n.callChildActions(r,a,{$response:e.responseData}),n.deleteMessage(t.message.id)})}}}function m(){var t=e.defer();b('Initialising "'+$+'" plugin...');var a=n.USE_MOCK_PLUGIN===!0?A():n.getProviderPlugin($);return a===!1?t.reject('Unable to initialise "'+$+'" plugin'):a.start(t.resolve,t.reject),t.resolve(),t.promise}function g(e){var t=T.filter(function(t){return t.name===e});return t.length?t[0]:null}function f(e,t){if(!e||!e.operations||!e.operations.length)return null;var n=e.operations.filter(function(e){return e.name===t});return n.length?n[0]:null}function v(n,a,o){var i=e.defer();if("formData"===a["in"]&&"file"===a.type){var c=o,l=r.getFileNameFromPath(c),u=a.typeConfig.base64encode;u?r.getFileBlob(l).then(function(e){var t=new FileReader;t.onloadend=function(e){n.headers["Content-Type"]="application/json",n.data[a.name]=e.target.result,a.typeConfig.fileNameParameterName&&(n.data[a.typeConfig.fileNameParameterName]=l),i.resolve(!0)},t.readAsDataURL(e)})["catch"](function(e){t.error(e),i.resolve(!1)}):(n.headers["Content-Type"]=s.mimeTypeFromExtension(c),n.data=o,n.uploadAsFile=!0,n.uploadAsMultipartForm=!0,n.formPartName=a.name,n.formPartFilename=l,i.resolve(!0))}else i.resolve(!1);return i.promise}function h(e){return e.message&&e.message.content?e.message.content.config:null}function y(t){if(!t.message||!t.message.content)return e.when({isSuccess:!1,responseData:"Invalid response message"});var n=parseInt(t.message.content.status||-1),a=n<=0||n>=400;if(a)return e.when({isSuccess:!1,responseData:{status:t.message.content.status,statusText:t.message.content.statusText,message:t.message.content.data}});var o=e.defer(),c=h(t),l=t.message.content.data,u=t.message.content.headers;if(c&&c.downloadAsFile===!0&&u){b("Response is downloaded file; file path:",l);var d=l,p="";if((c.downloadFileName||"").trim().length>0)p=c.downloadFileName;else{p=i.uuid();var m=(u["Content-Type"]||"").split(";")[0].trim(),g=s.extensionFromMimeType(m);null!==g&&(p+="."+g)}r.moveFileToStorage(d,p).then(function(e){o.resolve({isSuccess:!0,responseData:e})})["catch"](function(e){o.resolve({isSuccess:!1,responseData:e})})}else o.resolve({isSuccess:!0,responseData:l});return o.promise}function b(){if(n.isDebugMode()&&void 0!==arguments){var e=Array.prototype.slice.call(arguments);e.length>0&&"string"==typeof e[0]&&(e[0]="[rest.fct.js] "+e[0]),t.log.apply(t,e)}}function w(){if(void 0!==arguments){var e=Array.prototype.slice.call(arguments);e.length>0&&"string"==typeof e[0]&&(e[0]="[rest.fct.js] "+e[0]),t.error.apply(t,e)}}function A(){function e(e,n){t.info("*** USING MOCK "+$.toUpperCase()+" PLUGIN: Set USE_MOCK_PLUGIN to false in inboxOutbox.fct.js if you expect to use the real plugin ***");var a=500;setTimeout(function(){e(void 0,n)},a)}return{start:function(t){b("start called with arguments:",arguments),e(t,"ok")}}}var S="inboxoutbox."+n.PROVIDER_REST,$="rest",x=!1,E=!1,T=[];return{init:c,registerOfflineApi:l,makeRequest:u}}]),angular.module("app.core").factory("AzureAppServicesFactory",["$q","$log","InboxOutboxFactory","StoreFactory",function(e,t,n,a){function o(t){if(b)return e.when();var a=e.defer();return A=t,n.init().then(function(){return l(t)}).then(function(){var e={name:n.PROVIDER_AZUREAPPSERVICES,outboxChangeCallback:s,inboxChangeCallback:c};return n.registerProvider(e)}).then(function(){w=!0,a.resolve()})["catch"](function(e){f(e),a.reject(e)}),b=!0,a.promise}function i(t){if(!w)return e.reject(y+" plugin not initialised");g("Making request for action:",t);var a=n.getActionId(t),o=t.data.operation,i=u(o);if(null===i)return e.reject("Unknown operation '"+o+"'");var r=i.path;
g("Invoking operation '"+r+"' with config:",i);var s={transport:{type:"zumoDirect",httpMethod:i.method,api:r},invokingActionId:a};if(t.data.params){s.data={};for(var c in t.data.params)if(t.data.params.hasOwnProperty(c)){var l=d(i,c);if(null!==l)switch(l.type){case"fileref":s.data[c]="#fileref:"+t.data.params[c];break;default:s.data[c]=t.data.params[c]}}}var p=i.ttlMinutes;void 0===p&&(p=60);var m=0;if(0===p)m=0;else{var v=new Date;m=Date.UTC(v.getUTCFullYear(),v.getUTCMonth(),v.getUTCDate(),v.getUTCHours(),v.getUTCMinutes(),v.getUTCSeconds()),m+=60*p*1e3}var b=n.generateRequestId(n.PROVIDER_AZUREAPPSERVICES),A={channel:h,subchannel:b,provider:n.PROVIDER_AZUREAPPSERVICES,expiry:m,content:s};return n.sendMessage(A)["catch"](function(e){f(e),n.callChildActions(t,"fail",{$response:e})}),e.when(!0)}function r(){if(!w)return e.reject(y+" plugin not initialised");var t=e.defer();g("Attempting logout");var a=n.USE_MOCK_PLUGIN===!0?v():n.getProviderPlugin(y);return a===!1?t.reject("Unable to initialise '"+y+"' plugin"):a.logout(t.resolve,t.reject),t.promise}function s(e){void 0!==e&&f(e)}function c(e,t){if(void 0!==e)f(e);else if("create"===t.action.toLowerCase()){var o=p(t);if(null===o)g("Unable to handle inbox change - no message request data found in result:",t);else{var i=o.invokingActionId,r=n.getActionById(i);null!==r&&m(t).then(function(e){g("Parsed response:",e),e.isSuccess&&a.set("azureAppServices."+r.data.name+"."+r.data.operation,e.responseData);var o=e.isSuccess?"success":"fail";g("Calling child '"+o+"' actions of action id '"+i+"' with model:",e.responseData),n.callChildActions(r,o,{$response:e.responseData}),n.deleteMessage(t.message.id)})}}}function l(t){var a=e.defer();g("Initialising '"+y+"' plugin...");var o=n.USE_MOCK_PLUGIN===!0?v():n.getProviderPlugin(y);if(o===!1)a.reject("Unable to initialise '"+y+"' plugin");else if(n.isFromStudio()){var i={url:t.aasUrl,authenticationMethod:t.aasAuthenticationMethod,useBlobStorage:t.aasUseBlobStorage};g("...running from Studio - injecting '"+y+"' preferences:",i),o.start(a.resolve,a.reject,i)}else g("...using '"+y+"' preferences from configuration file"),o.start(a.resolve,a.reject);return a.resolve(),a.promise}function u(e){if(!A.operations||!A.operations.length)return null;var t=A.operations.filter(function(t){return t.name===e});return t.length?t[0]:null}function d(e,t){if(!e||!e.params.length)return null;var n=e.params.filter(function(e){return e.name===t});return n.length?n[0]:null}function p(e){return e.message&&e.message.content?e.message.content.config:null}function m(t){if(!t.message||!t.message.content)return e.when({isSuccess:!1,responseData:"Invalid response message"});var n=e.defer(),a=t.message.content.errorType&&t.message.content.errorMessage;return a?n.resolve({isSuccess:!1,responseData:t.message.content.errorMessage}):n.resolve({isSuccess:!0,responseData:t.message.content.response}),n.promise}function g(){if(n.isDebugMode()&&void 0!==arguments){var e=Array.prototype.slice.call(arguments);e.length>0&&"string"==typeof e[0]&&(e[0]="[azureAppServices.fct.js] "+e[0]),t.log.apply(t,e)}}function f(){if(void 0!==arguments){var e=Array.prototype.slice.call(arguments);e.length>0&&"string"==typeof e[0]&&(e[0]="[azureAppServices.fct.js] "+e[0]),t.error.apply(t,e)}}function v(){function e(e,n){t.info("*** USING MOCK "+y.toUpperCase()+" PLUGIN: Set USE_MOCK_PLUGIN to false in inboxOutbox.fct.js if you expect to use the real plugin ***");var a=500;setTimeout(function(){e(void 0,n)},a)}return{start:function(t){g("start called with arguments:",arguments),e(t,"ok")},logout:function(t){g("logout called with arguments:",arguments),e(t,"ok")}}}var h="inboxoutbox."+n.PROVIDER_AZUREAPPSERVICES,y="zumo",b=!1,w=!1,A=null;return{init:o,makeRequest:i,logout:r}}]),angular.module("app.core").factory("DataflowFactory",["Dataflow","$q",function(e,t){function n(t,n){o[t]=new e(n)}function a(e,n){var a=t.defer();return void 0!=o[e]&&o[e].execute(n).then(function(e){a.resolve(e)})["catch"](function(e){a.reject(e)}),a.promise}var o={},i={init:n,execute:a};return i}]),angular.module("app.core").factory("Dataflow",["$log","$q","$injector","StoreFactory","localStorageService",function($log,$q,$injector,StoreFactory,localStorageService){function Dataflow(e){this.steps=e,this.debug="true"==localStorageService.get("debug")}function __copy(e){return JSON.parse(JSON.stringify(e))}return Dataflow.prototype={execute:function(data){var deferred=$q.defer(),$scope=this;if(void 0!==$scope.steps){var result=[],_data=data;angular.isObject(data)&&!angular.isArray(data)&&(_data=[data]);var source=window.Rx.Observable.from(_data),$store=window.cti.store,ActionFactory=$injector.get("ActionFactory");$scope.debug&&$log.log("========== WORKFLOW =========="),this.steps.forEach(function(step){switch(step["item-type"]){case"map":step=StoreFactory.parse(angular.copy(step),{$data:_data}),void 0!==step.content&&step.content.length>0?(eval("var stepFunction = function($data){ "+step.content+" }"),source=source.map(stepFunction)):void 0!==step.xpath&&step.xpath.length>0?source=source.map(function(e){var t=JSON.search(e,step.xpath);return $scope.debug&&($log.log("[MAP] - XPATH RESULT:",t[0]),$log.log("============ ▼ ============")),1===t.length?t[0]:t}):$log.error("No xpath or code has been added for a 'map' step.");break;case"flat-map":step=StoreFactory.parse(angular.copy(step),{$data:_data}),void 0!==step.content&&step.content.length>0?(eval("var stepFunction = function($data, $index){ "+step.content+" }"),source=source.flatMap(stepFunction)):void 0!==step.xpath&&step.xpath.length>0?source=source.flatMap(function(e){var t=JSON.search(e,step.xpath);return $scope.debug&&($log.log("[FLAT MAP] - XPATH RESULT:",t[0]),$log.log("============ ▼ ============")),1===t.length?t[0]:t}):$log.error("No xpath or code has been added for a 'flat-map' step.");break;case"reduce":step=StoreFactory.parse(angular.copy(step),{$data:_data}),void 0!==step.content&&step.content.length>0?(eval("var stepFunction = function($acc, $current, $index, $source){ "+step.content+"; }"),source=source.reduce(stepFunction)):void 0!==step.xpath&&step.xpath.length>0?source=source.reduce(function(e){var t=JSON.search(e,step.xpath);return $scope.debug&&($log.log("[REDUCE] - XPATH RESULT:",t[0]),$log.log("============ ▼ ============")),1===t.length?t[0]:t}):$log.error("No xpath or code has been added for a 'reduce' step.");break;case"some":step=StoreFactory.parse(angular.copy(step),{$data:_data}),void 0!==step.content&&step.content.length>0?(eval("var stepFunction = function($data){ "+step.content+"; }"),source=source.some(stepFunction)):void 0!==step.xpath&&step.xpath.length>0?source=source.some(function(e){var t=JSON.search(e,step.xpath);return $scope.debug&&($log.log("[SOME] - XPATH RESULT:",t[0]),$log.log("============ ▼ ============")),1===t.length?t[0]:t}):$log.error("No xpath or code has been added for a 'some' step.");break;case"convert":step=StoreFactory.parse(angular.copy(step),{$data:_data},!1),void 0!==step.content?source=source.map(function(stepData){var template=null;try{eval("template = "+step.content)}catch(e){$log.error(e)}if(null!==template){var res=window.jsonapter.instance().run(template,stepData);return $scope.debug&&($log.log("[CONVERT] - TEMPLATE:",template),$log.log("[CONVERT] - JSONAPTER RESULT:",res),$log.log("============ ▼ ============")),res}}):$log.error("No template has been added for a 'convert' step.");break;case"take":step=StoreFactory.parse(angular.copy(step),{$data:_data}),void 0!==step.content?source=source.take(step.content):$log.error("No value has been added for a 'take' step.");break;case"every":void 0!==step.content&&step.content.length>0?(step=StoreFactory.parse(angular.copy(step),{$data:_data}),eval("var stepFunction = function($data){ "+step.content+"; }"),source=source.every(stepFunction)):void 0!==step.operations&&step.operations.length>0?source=source.every(function(e){return ActionFactory.evalOperations(__copy(step.operations),{$data:e,$store:$store})}):$log.error("No expression or code has been added for an 'every' step.");break;case"filter":void 0!==step.content&&step.content.length>0?(step=StoreFactory.parse(angular.copy(step),{$data:_data}),eval("var stepFunction = function($current, $index, $source){ "+step.content+" }"),source=source.filter(stepFunction)):void 0!==step.operations&&step.operations.length>0?source=source.filter(function(e,t,n){return ActionFactory.evalOperations(__copy(step.operations),{$current:e,$index:t,$source:n,$store:$store})}):$log.error("No expression or code has been added for a 'filter' step.");break;case"find":void 0!==step.content&&step.content.length>0?(step=StoreFactory.parse(angular.copy(step),{$data:_data}),eval("var stepFunction = function($current, $index, $source){ "+step.content+"; }"),source=source.find(stepFunction)):void 0!==step.operations&&step.operations.length>0?source=source.find(function(e,t,n){return ActionFactory.evalOperations(__copy(step.operations),{$current:e,$index:t,$source:n,$store:$store})}):$log.error("No expression or code has been added for a 'find' step.");break;case"to-array":source=source.toArray();break;case"max":void 0!==step.content?(step=StoreFactory.parse(angular.copy(step),{$data:_data}),eval("var stepFunction = function($current, $next){ "+step.content+"; }"),source=source.average(stepFunction)):source=source.max();break;case"min":void 0!==step.content?(step=StoreFactory.parse(angular.copy(step),{$data:_data}),eval("var stepFunction = function($current, $next){ "+step.content+"; }"),source=source.average(stepFunction)):source=source.min();break;case"sum":void 0!==step.content?(step=StoreFactory.parse(angular.copy(step),{$data:_data}),eval("var stepFunction = function($current, $index, $source){ "+step.content+"; }"),source=source.average(stepFunction)):source=source.sum();break;case"count":void 0!==step.content?(step=StoreFactory.parse(angular.copy(step),{$data:_data}),eval("var stepFunction = function($current){ "+step.content+"; }"),source=source.average(stepFunction)):source=source.count();break;case"average":void 0!==step.content?(step=StoreFactory.parse(angular.copy(step),{$data:_data}),eval("var stepFunction = function($data){ "+step.content+"; }"),source=source.average(stepFunction)):source=source.average()}}),source.subscribe(function(e){$scope.debug&&($log.log("ON NEXT:",e),$log.log("============ ▼ ============")),result.push(e)},function(e){$log.error(e),deferred.reject(e)},function(){var e=1===result.length?result[0]:result;$scope.debug&&($log.log("COMPLETED:",e),$log.log("===========================")),deferred.resolve(e)})}return deferred.promise}},Dataflow}]),angular.module("app.core").factory("ActionflowFactory",["Actionflow","$q",function(e,t){function n(t,n){o[t]=new e(n)}function a(e,n){var a=t.defer();return void 0!=o[e]&&o[e].execute(n).then(function(e){a.resolve(e)})["catch"](function(e){a.reject(e)}),a.promise}var o={},i={init:n,execute:a};return i}]),angular.module("app.core").factory("Actionflow",["$log","$q","$injector","localStorageService",function(e,t,n,a){function o(e){this.actions=e,this.debug="true"==a.get("debug")}return o.prototype={execute:function(e){var t=n.get("ActionFactory");return t.triggerEvent(null,this.actions,e)}},o}]),angular.module("app.core").factory("LoggingFactory",["$injector","electron","SchemaHelper",function(e,t,n){function a(e){return{log:function(){u(arguments,!0),e.log.apply(null,arguments)},debug:function(){d(arguments,!0),e.debug.apply(null,arguments)},info:function(){p(arguments,!0),e.info.apply(null,arguments)},error:function(){m(arguments,!0),e.error.apply(null,arguments)},warn:function(){g(arguments,!0),e.warn.apply(null,arguments)}}}function o(t){var a=e.get("StoreFactory");U=t,0!=n.schema.hostContext?(y(n.schema.settings.logging.enabled||!1),w(n.schema.settings.logging.appEnabled||!1,J),w(n.schema.settings.logging.clientEnabled||!1,W),w(n.schema.settings.logging.nativeEnabled||!1,K),S(n.schema.settings.logging.appUseDefault?n.schema.settings.logging.defaultRootLogLevel:n.schema.settings.logging.appRootLogLevel,J),S(n.schema.settings.logging.clientUseDefault?n.schema.settings.logging.defaultRootLogLevel:n.schema.settings.logging.clientRootLogLevel,W),S(n.schema.settings.logging.nativeUseDefault?n.schema.settings.logging.defaultRootLogLevel:n.schema.settings.logging.nativeRootLogLevel,K),x(n.schema.settings.logging.bufferFrequency)):(b().then(function(e){me=e,a.set(Y,e)}),A(J).then(function(e){ge=e,a.set(Z,e)}),A(W).then(function(e){fe=e,a.set(ee,e)}),A(K).then(function(e){a.set(te,e)}),$(J).then(function(e){ve=e,a.set(ne,e)}),$(W).then(function(e){he=e,a.set(ae,e)}),$(K).then(function(e){a.set(oe,e)}));var o=a.get(ie);void 0===o?x(n.schema.settings.logging.bufferFrequency):de=o;var r=a.get(le);void 0===r?i():i(r);var s=a.get(ue);void 0!==s&&(pe=s)}function i(t){var n=e.get("StoreFactory");void 0===t&&(R&&(pe.unshift(R),n.set(ue,pe)),t=U+"_logs_"+(new Date).getTime().toString()),M=new PouchDB(t,{revs_limit:1}),M.changes({since:"now",live:!0,include_docs:!0}).on("change",function(){c(!0)}),R=t,n.set(le,t)}function r(e){return new PouchDB(e,{revs_limit:1})}function s(t){var n=e.get("$q"),a=n.defer();return t.destroy().then(function(){a.resolve()})["catch"](function(e){a.reject(e)}),a.promise}function c(t){var n=e.get("$q"),a=n.defer(),o=arguments;return M.info().then(function(n){var r=0==o.length&&n.doc_count>0||t===!1&&n.doc_count>0||t&&n.doc_count>=de;!r||void 0!==t&&t&&n.db_name==ye?a.resolve():(ye=n.db_name,i(),l().then(function(t){var n=e.get("StoreFactory");t.forEach(function(e){var t=pe.indexOf(e);pe.splice(t,1)}),n.set(ue,pe),I().then(function(e){null!=e[W]&&n.set(se,e[W]),null!=e[J]&&n.set(re,e[J]),null!=e[K]&&n.set(ce,e[K])}),a.resolve()}))}),a.promise}function l(){var t=e.get("$q"),n=t.defer(),a=[],o=pe.length;return pe.forEach(function(t){var i=r(t);i.allDocs({include_docs:!0},function(r,c){if(!r){for(var l=[],u=0;u<c.rows.length;u++){var d=c.rows[u].doc;l.push(d.data)}var p=e.get("Plugin"),m=e.get("Platform"),g=p.getSource("logging");if(g){var f="desktop"===m.getType();f?(g.logMessages(l),s(i).then(function(){a.push(t),o--,0==o&&n.resolve(a)})["catch"](function(){o--,0==o&&n.resolve(a)})):g.logMessages(function(){s(i).then(function(){a.push(t),o--,0==o&&n.resolve(a)})["catch"](function(){o--,0==o&&n.resolve(a)})},function(){o--,0==o&&n.resolve(a)},l)}}})}),n.promise}function u(arguments,e){f(e,arguments)?fe&&C(B,he)&&(arguments=v(arguments),h("["+D()+"] [DEBUG] "+arguments,q,W)):ge&&C(B,ve)&&(arguments=v(arguments),h("["+D()+"] [DEBUG] "+arguments,q,J))}function d(arguments,e){f(e,arguments)?fe&&C(q,he)&&(arguments=v(arguments),h("["+D()+"] [DEBUG] "+arguments,q,W)):ge&&C(q,ve)&&(arguments=v(arguments),h("["+D()+"] [DEBUG] "+arguments,q,J))}function p(arguments,e){f(e,arguments)?fe&&C(B,he)&&(arguments=v(arguments),h("["+D()+"] [INFO] "+arguments,B,W)):ge&&C(B,ve)&&(arguments=v(arguments),h("["+D()+"] [INFO] "+arguments,B,J))}function m(arguments,e){f(e,arguments)?fe&&C(G,he)&&(arguments=v(arguments),h("["+D()+"] [ERROR] "+arguments,G,W)):ge&&C(G,ve)&&(arguments=v(arguments),h("["+D()+"] [ERROR] "+arguments,G,J))}function g(arguments,e){f(e,arguments)?fe&&C(V,he)&&(arguments=v(arguments),h("["+D()+"] [WARN] "+arguments,V,W)):ge&&C(V,ve)&&(arguments=v(arguments),h("["+D()+"] [WARN] "+arguments,V,J))}function f(e,arguments){return e===!0||arguments.length>=2&&arguments[0]===z}function v(arguments){var e=[],t=Array.prototype.slice.call(arguments);arguments.length>=2&&arguments[0]===z&&t.shift();for(var n=0;n<t.length;n++){var a=t[n];if(angular.isObject(a)||angular.isArray(a))try{e.push(JSON.stringify(a))}catch(o){e.push(a)}else"function"==typeof a?e.push(a.toString()):e.push(a)}return t.length>0&&(e=O.apply(null,e)),e}function h(e,t,n){if(null!=M){var a={logLevel:t,message:e,destination:n};M.put({_id:(new Date).getTime().toString()+window.performance.now(),data:a},function(){})}}function y(t){me=t;var n=e.get("StoreFactory"),a=e.get("Plugin"),o=e.get("Platform"),i=a.getSource("logging");if(i){var r="desktop"===o.getType();r?(t?i.enableLogging():t||i.disableLogging(),n.set(Y,t)):t?i.enableLogging(function(){n.set(Y,t)},function(){}):t||i.disableLogging(function(){n.set(Y,t)},function(){})}}function b(){var t=e.get("$q"),n=t.defer(),a=e.get("Plugin"),o=e.get("Platform"),i=a.getSource("logging");if(i){var r="desktop"===o.getType();r?n.resolve(i.isLoggingEnabled()):i.isLoggingEnabled(function(e){n.resolve(e)},function(e){n.reject(e)})}return n.promise}function w(t,n){var a=e.get("StoreFactory"),o=e.get("Plugin"),i=e.get("Platform"),r=o.getSource("logging");if(r){var s="desktop"===i.getType();s?(t?r.enableDestination(n):t||r.disableDestination(n),n===J?(ge=t,a.set(Z,t)):n===W?(fe=t,a.set(ee,t)):n===K&&a.set(te,t)):t?r.enableDestination(function(){n===J?(ge=t,a.set(Z,t)):n===W?(fe=t,a.set(ee,t)):n===K&&a.set(te,t)},function(){},n):t||r.disableDestination(function(){n===J?(ge=!1,a.set(Z,!1)):n===W?(fe=!1,a.set(ee,!1)):n===K&&a.set(te,!1)},function(){},n)}}function A(t){var n=e.get("$q"),a=n.defer(),o=e.get("Plugin"),i=e.get("Platform"),r=o.getSource("logging");if(r){var s="desktop"===i.getType();s?a.resolve(r.isDestinationEnabled(t)):r.isDestinationEnabled(function(e){a.resolve(e)},function(e){a.reject(e)},t)}return a.promise}function S(t,n){if(void 0!==t&&(t=t.toLowerCase(),t===B||t===q||t===V||t===G)){var a=e.get("StoreFactory"),o=e.get("Plugin"),i=e.get("Platform"),r=o.getSource("logging");if(r){var s="desktop"===i.getType();n?(s?r.setRootLogLevel(t,n):r.setRootLogLevel(function(){},function(){},t,n),n===J?(ve=t,a.set(ne,t)):n===W?(he=t,a.set(ae,t)):n===K&&a.set(oe,t)):(s?(r.setRootLogLevel(t,W),r.setRootLogLevel(t,J),r.setRootLogLevel(t,K)):(r.setRootLogLevel(function(){},function(){},t,W),r.setRootLogLevel(function(){},function(){},t,J),r.setRootLogLevel(function(){},function(){},t,K)),a.set(ne,t),a.set(ae,t),a.set(oe,t))}}}function $(t){var n=e.get("$q"),a=n.defer(),o=e.get("Plugin"),i=e.get("Platform"),r=o.getSource("logging");if(r){var s="desktop"===i.getType();s?a.resolve(r.getRootLogLevel(t)):r.getRootLogLevel(function(e){a.resolve(e)},function(e){a.reject(e)},t)}return a.promise}function x(t){void 0===t?t=X:t<X?t=X:t>Q&&(t=Q),de=t;var n=e.get("StoreFactory");n.set(ie,t)}function E(t,n){var a=e.get("Plugin"),o=e.get("Platform"),i=a.getSource("logging");if(i){var r="desktop"===o.getType();n?r?i.configure(t,n):i.configure(function(){},function(){},t,n):r?(i.configure(t,W),i.configure(t,J),i.configure(t,K)):(i.configure(function(){},function(){},t,W),i.configure(function(){},function(){},t,J),i.configure(function(){},function(){},t,K))}}function T(t){var n=e.get("$q"),a=n.defer(),o=e.get("Plugin"),i=e.get("Platform"),r=o.getSource("logging");return r?c().then(function(){var e="desktop"===i.getType();e?r.zipLogFiles(t,function(e){a.resolve(e)}):r.zipLogFiles(function(e){a.resolve(e)},function(){a.reject()},t)}):a.reject(),a.promise}function C(e,t){return!!me&&(t!==H&&(t===q?e===q||e===B||e===V||e===G:t===B?e===B||e===V||e===G:t===V?e===V||e===G:t!==G||e===G))}function k(n,a,o,i){var r=e.get("Plugin"),s=e.get("Platform"),c=r.getSource("logging");c&&T(i).then(function(e){var i="desktop"===s.getType();i?(location.href="mailto:"+n+"?subject="+a+"&body="+o,c.getRootLogFolder(function(e){t.shell.openItem(e)})):c.makeFilesPublic(function(e){F(n,a,o,e,function(){})},function(){},e)})}function F(t,n,a,o,i){var r=e.get("Plugin"),s=r.getSource("email");s.open({to:t,subject:n,body:a,attachments:o},function(){i()})}function I(){var t=e.get("$q"),n=t.defer(),a=e.get("Plugin"),o=e.get("Platform"),i=a.getSource("logging");if(i){var r="desktop"===o.getType();r?i.getLogFilePaths(function(e){n.resolve(e)}):i.getLogFilePaths(function(e){n.resolve(e)},function(e){n.reject(e)})}return n.promise}function L(){var t=e.get("$q"),n=t.defer(),a=e.get("Plugin"),o=e.get("Platform"),i=a.getSource("logging");if(i){var r="desktop"===o.getType();r?i.getArchivedLogFilePaths(function(e){n.resolve(e)}):i.getArchivedLogFilePaths(function(e){n.resolve(e)},function(e){n.reject(e)})}return n.promise}function P(t){var n=e.get("$q"),a=n.defer(),o=e.get("Plugin"),i=e.get("Platform"),r=o.getSource("logging");if(r){var s="desktop"===i.getType();s?a.resolve(t):r.makeFilesPublic(function(e){a.resolve(e)},function(e){a.reject(e)},t)}return a.promise}function _(){var t=e.get("Plugin"),n=e.get("Platform"),a=t.getSource("logging");if(a){var o="desktop"===n.getType();o?a.removePublicFiles():a.removePublicFiles(function(){},function(){})}}function D(){return be.format(new Date)}function N(e){this.formatString=e;var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],a=function(e){return("0"+e).substr(-2,2)},o=function(e){return("00"+e).substr(-3,3)},i={d:["getDate",function(e){return a(e)}],m:["getMonth",function(e){return a(e+1)}],n:["getMonth",function(e){return t[e]}],w:["getDay",function(e){return n[e]}],y:["getFullYear"],H:["getHours",function(e){return a(e)}],M:["getMinutes",function(e){return a(e)}],S:["getSeconds",function(e){return a(e)}],s:["getMilliseconds",function(e){return o(e)}],i:["toISOString"]};this.format=function(e){var t=this.formatString.replace(/%(.)/g,function(t,n){var a=e[i[n][0]]();return null!=i[n][1]&&(a=i[n][1](a)),a});return t}}function O(){var e=function(e,t){return(parseInt(e,10)||0).toString(t)},t={s:function(e){return e.toString()},d:function(t){return e(t,10)},i:function(e){return this.d(e)},b:function(t){return e(t,2)},o:function(t){return e(t,8)},x:function(t){return e(t,16)},X:function(t){return e(t,16).toUpperCase()},e:function(e){return(parseFloat(e,10)||0).toExponential()},E:function(e){return this.e(e,10).toUpperCase()},f:function(e){return(parseFloat(e,10)||"0.0").toString()}},n="";for(var a in t)n+=a;for(var o=Array.prototype.slice.call(arguments).slice(),i=o.shift().toString().replace(new RegExp("%(["+n+"])","g"),function(e,n){if(!o.length)throw new Error("Too few elements");return t[n](o.shift())}),r=0;r<o.length;r++){var s=o[r];i+=" "+s}return i}var M,R,U,j={init:o,emailLogs:k,setRootLogLevel:S,flushBuffer:c,setBufferFrequency:x,configure:E,zipLogs:T,enableDisableLogging:y,enableDisableDestination:w,getLogFilePaths:I,getArchivedLogFilePaths:L,isLoggingEnabled:b,isDestinationEnabled:A,getRootLogLevel:$,makeFilesPublic:P,removePublicFiles:_,process$log:a},q="debug",B="info",V="warn",G="error",H="off",z="_cti_log_",W="client",J="app",K="native",X=1,Q=500,Y="env.logging.enabled",Z="env.logging.appDestinationEnabled",ee="env.logging.clientDestinationEnabled",te="env.logging.nativeDestinationEnabled",ne="env.logging.currentAppLogRootLevel",ae="env.logging.currentClientLogRootLevel",oe="env.logging.currentNativeLogRootLevel",ie="env.logging.currentBufferSize",re="env.logging.appLogFilePath",se="env.logging.clientLogFilePath",ce="env.logging.nativeLogFilePath",le="activeDbName",ue="requiresFlushDbNames",de=1,pe=[],me=!1,ge=!1,fe=!1,ve=G,he=G,ye="x",be=new N("%y-%m-%d %H:%M:%S:%s");if(window.console&&console.log){var we=console.log;console.log=function(){u(arguments),we.apply(this,arguments)}}if(window.console&&console.info){var Ae=console.info;console.info=function(){p(arguments),Ae.apply(this,arguments)}}if(window.console&&console.debug){var Se=console.debug;console.debug=function(){d(arguments),Se.apply(this,arguments)}}if(window.console&&console.error){var $e=console.error;console.error=function(){m(arguments),$e.apply(this,arguments)}}if(window.console&&console.warn){var xe=console.warn;console.warn=function(){g(arguments),xe.apply(this,arguments)}}return j}]),angular.module("app.core").factory("AudioPlayer",["$q","Plugin","electron","$interval","$log","$timeout","VibrateFactory",function(e,t,n,a,o,i,r){function s(e){var t=0,n=0;return e>0&&(t=Math.floor(e%60),n=Math.floor(e/60)),""+n+":"+(t<10?"0":"")+t}function c(e,t){return null===h?void o.error("Audio has not been initialised yet, cannot continue."):void h.getCurrentPosition(function(n){e({state:t,position:n>-1?n:0,currentTime:s(n)})})}function l(e,t,s){function b(e){if(e&&e.vibrate)if("none"!==e.vibratePattern){var t;"custom"===e.vibratePattern?""!==e.vibrateCustomPattern&&(t=e.vibrateCustomPattern.split(",")):t=e.vibratePattern.split(","),t&&r.vibratePattern(t,0,!0,e.forceVibrate)}else r.vibrate(0,!0,e.forceVibrate)}function w(){g&&g.vibrate&&r.stopVibration()}function A(e){switch(e){case d.MEDIA_NONE:a.cancel(v),i(function(){c(s,"released")},60);break;case d.MEDIA_STARTING:i(function(){c(s,"starting")},50);break;case d.MEDIA_RUNNING:i(function(){c(s,"playing")},50),v=a(function(){c(s,"running")},50),b(m);break;case d.MEDIA_PAUSED:a.cancel(v),i(function(){c(s,"paused")},60),w();break;case d.MEDIA_STOPPED:a.cancel(v),i(function(){c(s,"stopped")},60),w()}}function S(){function t(){m&&l(e,m,p[e])}if(m&&m.loop&&(m.loopCount>0||m.loopCount<=u)){var n=m.loopInterval;f=setTimeout(t,1e3*n),m.loopCount!=u&&m.loopCount--}else m=void 0}if(g={},g.vibrate=t.vibrate,g.vibratePattern=t.vibratePattern,g.vibrateCustomPattern=t.vibrateCustomPattern,g.forceVibrate=t.forceVibrate,null!==h){h.release();for(var $ in p)void 0!==p[$]&&(a.cancel(v),c(p[$],"stopped"),p[$]=void 0)}p[e]=s,void 0!==n.app?(h={change:function(e){A(e)},play:function(){y.play(),h.change(d.MEDIA_RUNNING)},pause:function(){y.pause(),h.change(d.MEDIA_PAUSED)},stop:function(){y.pause(),y.currentTime=0,h.change(d.MEDIA_STOPPED)},getCurrentPosition:function(e){y.ended===!0&&h.stop(),e(y.currentTime)},getDuration:function(){return y.duration},release:function(){y.currentTime=0,h.change(d.MEDIA_NONE)}},y.onloadeddata=function(){h.play()},y.onended=function(){S(m)},y.setAttribute("src",e)):(h=new d(e,function(){S(m)},function(e){e&&0===e.code?o.info("No media player active"):o.error("Audio Error:",e)},function(e){A(e)}),h.setStreamId(function(){h.play()},t.streamId))}var u=-999999,d=t.getSource("Media"),p={},m=void 0,g=void 0,f=void 0,v=null,h=null,y=document.createElement("audio");return y.setAttribute("preload","auto"),{getDuration:function(e,a){if(void 0!==e&&0!==e.length)if(void 0!==n.app){var i=document.createElement("audio");i.setAttribute("preload","auto"),i.onloadeddata=function(e){a(e.currentTarget.duration,s(e.currentTarget.duration))},i.setAttribute("src",e)}else{var r=t.getSource("mediaproperties");if(r===!1)return;r.getProperties(function(e){a(e.duration,s(e.duration))},function(e){o.error("Audio Error, could not get media properties:",e)},e)}},play:function(e,t,n){t.loop&&(0==t.loopCount&&(t.loopCount=u),m=t),l(e,t,n)},stop:function(){m=void 0,clearTimeout(f),null!==h&&h.stop()},pause:function(){null!==h&&h.pause()},unpause:function(){null!==h&&h.play()}}}]),angular.module("app.core").factory("GoogleMapService",["$q","$rootScope",function(e,t){function n(n){if(!r){r=e.defer();var o=document.createElement("script");o.onload=function(){r.resolve()},o.onerror=function(e){r.resolve(e),r=void 0};var i=a(t.currentLanguage);n&&n.length>0?o.src="https://maps.googleapis.com/maps/api/js?key="+n+"&libraries=visualization&language="+i:o.src="https://maps.googleapis.com/maps/api/js?libraries=visualization&language="+i,document.head.appendChild(o)}return r.promise}function a(e){var t={ar:"ARABIC",eu:"BASQUE",bg:"BULGARIAN",bn:"BENGALI",ca:"CATALAN",cs:"CZECH",da:"DANISH",de:"GERMAN",el:"GREEK",en:"ENGLISH","en-AU":"ENGLISH (AUSTRALIAN)","en-GB":"ENGLISH (GREAT BRITAIN)",es:"SPANISH",fa:"FARSI",fi:"FINNISH",fil:"FILIPINO",fr:"FRENCH",gl:"GALICIAN",gu:"GUJARATI",hi:"HINDI",hr:"CROATIAN",hu:"HUNGARIAN",id:"INDONESIAN",it:"ITALIAN",iw:"HEBREW",ja:"JAPANESE",kn:"KANNADA",ko:"KOREAN",lt:"LITHUANIAN",lv:"LATVIAN",ml:"MALAYALAM",mr:"MARATHI",nl:"DUTCH",no:"NORWEGIAN",pl:"POLISH",pt:"PORTUGUESE","pt-BR":"PORTUGUESE (BRAZIL)","pt-PT":"PORTUGUESE (PORTUGAL)",ro:"ROMANIAN",ru:"RUSSIAN",sk:"SLOVAK",sl:"SLOVENIAN",sr:"SERBIAN",sv:"SWEDISH",tl:"TAGALOG",ta:"TAMIL",te:"TELUGU",th:"THAI",tr:"TURKISH",uk:"UKRAINIAN",vi:"VIETNAMESE","zh-CN":"CHINESE (SIMPLIFIED)","zh-TW":"CHINESE (TRADITIONAL)"},n=e.replace("_","-");return t[n]?n:(n=e.substr(0,2),t[n]?n:"en-GB")}function o(e){s.push(e)}function i(e){s.splice(s.indexOf(e),1)}var r,s=[];return window.addEventListener("resize",function(){for(var e=s.length;e--;)s[e]?google.maps.event.trigger(s[e],"resize"):s.splice(e,1)},!0),{requestGoogleMapsScript:n,registerResize:o,unregisterResize:i}}]),angular.module("app.core").factory("ListFactory",["$rootScope","SchemaHelper","StoreFactory",function(e,t,n){function a(e){var n=e.pages;n.forEach(function(e){var n=e.name,a=t.getItems(e.content,"content","list");a.forEach(function(e){var t=e.name;d(n,t,!0,!0,!0)})})}function o(e,t){return Math.ceil(e/(t||1))}function i(e,t,n){var a=[],o=1,i=t;if(n&&n>0){var r=Math.min(n,t),s=Math.floor(r/2);r%2===0&&(s-=1);var c=r-s-1;if(o=e-s,i=e+c,o<1){var l=1-o;o=1,i+=l}if(i>t){var u=i-t;i=t,o-=u}}for(var d=o;d<=i;d++)a.push(d);return a}function r(e,t){var a="$store.pages."+e+"."+t;return n.get(a)}function s(e,t,n){var a={numberOfItems:n.listData.length};if(n.search&&n.search.enabled){var o="";n.search.internal?o="internal":n.search.allowExternal&&n.search.external&&(o=n.search.external.simple?"simple":"advanced");var i=n.search.internal?n.search.term:n.search.external&&n.search.external.criteria||null,r=o,s=i,c=n.filteredListData.length;g(a,r,s,c)}var l=n.order.property,u=n.order.reverse?"desc":"asc";if(f(a,l,u),n.pagination&&n.pagination.enabled){var d=n.pagination.currentPage,p=n.pagination.totalPages,m=n.pagination.limit,y=n.pagination.currentPage>1,b=n.pagination.currentPage<n.pagination.totalPages;v(a,d,p,m,y,b)}return h(e,t,a)}function c(e,t,n,a,o){var i=m(e,t);if(!i)throw'Could not obtain list "'+t+'" on page "'+e+'"';if(o!==!0&&"external"!==i.search)throw'Search actions not allowed for list "'+t+'" on page "'+e+'"';var s=r(e,t);g(s,n,a,void 0),p(e,t,s)}function l(e,t,n,a){var o=m(e,t);if(!o)throw'Could not obtain list "'+t+'" on page "'+e+'"';var i=r(e,t);"switch"===a&&(a=i&&i.order&&i.order.property===n&&"asc"===i.order.direction?"desc":"asc"),f(i,n,a),p(e,t,i)}function u(e,t,n){var a=m(e,t);if(!a)throw'Could not obtain list "'+t+'" on page "'+e+'"';if(!a.pagination)throw'Pagination not enabled for list "'+t+'" on page "'+e+'"';var o=r(e,t),i=1,s=1,c=void 0;if(o&&o.pagination&&(s=o.pagination.totalPages||1,c=o.pagination.pageSize||void 0),isNaN(n)){if(o&&o.pagination){var l=o.pagination.currentPage||1;switch(n){case"first":i=1;break;case"prev":i=l-1;break;case"next":i=l+1;break;case"last":i=s}}}else i=n;i<1&&(i=1),i>s&&(i=s);var u=i>1,d=i<s;v(o,i,s,c,u,d),p(e,t,o)}function d(e,t,n,a,o){var i=m(e,t);if(!i)throw'Could not obtain list "'+t+'" on page "'+e+'"';var s=r(e,t);s&&(n&&delete s.search,a&&delete s.order,o&&delete s.pagination,p(e,t,s))}function p(t,n,a){h(t,n,a),e.$emit("UpdateList_"+t+"_"+n)}function m(e,n){if(!e||!n)return null;var a=t.schema,o=a.pages.filter(function(t){return t.name===e})[0];if(!o)return null;var i='//content//*[name="'+n+'"]';return JSON.search(o,i,!0)[0]}function g(e,t,n,a){e=e||{},angular.extend(e,{search:{mode:t,criteria:n,totalSearchResults:a}})}function f(e,t,n){e=e||{},angular.extend(e,{order:{property:t,direction:n}})}function v(e,t,n,a,o,i){e=e||{},angular.extend(e,{pagination:{currentPage:t,totalPages:n,pageSize:a,hasPreviousPage:o,hasNextPage:i}})}function h(e,t,a){var o="$store.pages."+e+"."+t;return n.set(o,a)}return{initializeListsForApp:a,calculateNumberOfPages:o,calculateVisiblePages:i,getListState:r,setListStateFromListScope:s,setListSearchState:c,setListOrderState:l,setListPaginationState:u,resetListState:d,triggerListRefresh:p}}]),angular.module("app.core").factory("VibrateFactory",["Platform","$timeout",function(e,t){function n(a,o,r){if(u=!1,o===!1)a<100&&(a=100),i(a,r);else{var s="android"===e.getName(),c="ios"===e.getName();c?(i(1,r),t(function(){u===!1&&n(1,o,r)},400)):s&&i(864e5,r)}}function a(e,t,n,a){if(n===!1){if(t<0&&(t=0),0===t)return;r(e,0,t,n,a),u=!1}else r(e,0,0,n,a),u=!1}function o(){navigator.vibrate(0),u=!0;
}function i(e,t){navigator.vibrate(e,t)}function r(n,a,o,l,d){var p="android"===e.getName(),m="ios"===e.getName();if(m){var g=s(n);c(g,function(){a++,t(function(){(l===!0&&u===!1||l===!1&&a<o&&u===!1)&&r(n,a,o,l,d)},1e3)})}else if(p){var f=0;n.forEach(function(e){f+=parseInt(e)}),i(n,d),t(function(){a++,t(function(){(l===!0&&u===!1||l===!1&&a<o&&u===!1)&&r(n,a,o,l,d)},1e3)},f)}}function s(e){var t=0;return{next:function(){if(t<e.length){var n=t;return t++,{value:e[n],done:!1,index:n}}return{done:!0}}}}function c(n,a){var o=n.next();if(o.done===!1){var r=(o.index+1)%2===0;if(r===!0)t(function(){c(n,a)},parseInt(o.value));else{i(parseInt(o.value));var s="ios"===e.getName();s?t(function(){c(n,a)},590):c(n,a)}}else a()}var l={vibrate:n,vibratePattern:a,stopVibration:o},u=!1;return l}]),angular.module("mobile-router",["LocalStorageModule"]),angular.module("mobile-router").provider("RouterConfig",function(){this.options={},this.set=function(e,t){switch(e){case"id":this.options.id=t;break;case"startPage":this.options.startPage=t;break;case"mode":switch(t){case"allin":case"intelligent":case"single":this.options[e]=t;break;default:console.log("Invalid Value: An invalid value for option 'mode' was specified.")}break;case"animation":switch(t){case"off":case"slide-in":case"slide-out":case"flip-in":case"fade-in":case"rotate-in-left":this.options[e]=t;break;default:console.log("Invalid Value: An invalid value for option 'animation' was specified.")}break;default:console.log("Invalid Option: An invalid option was specified.")}};var e=this;this.$get=function(){return{options:e.options,set:e.set}}}),angular.module("mobile-router").factory("RouteStack",["localStorageService",function(e){function t(t){l=t;var n=e.get(l+"_stack");u=angular.fromJson(n)||[]}function n(e){var t=i();e&&e!==t&&(e&&(u.length>=c&&u.shift(),u.push(e)),s())}function a(e){for(var t=-1,n=u.length-1;n>=0&&t===-1;n++)u[n]===e&&(t=n);t>-1&&(u.splice(t,1),s())}function o(){l&&(u=[],e.remove(l+"_stack"))}function i(){return u[u.length-1]}function r(){return u[u.length-2]}function s(){l&&e.set(l+"_stack",u)}var c=25,l=null,u=[];return{init:t,add:n,remove:a,clear:o,getCurrent:i,getPrevious:r}}]),angular.module("mobile-router").factory("Router",["RouterConfig","$templateCache","$log","$filter","RouteStack","$rootScope","$timeout","$q","$injector","$location","Auth",function(e,t,n,a,o,i,r,s,c,l,u){function d(e){return e.toString().replace(/\/$/,"").replace(/^\//,"")}function p(){return o.getPrevious()}function m(){var e=o.getCurrent(),t=o.getPrevious();e&&t&&(o.remove(e),S(t))}function g(e){for(var t=0;t<k.routes.length;t++)if(k.routes[t].path==e)return!0;return!1}function f(){return a("filter")(k.routes,{path:k.currentPath},!0)[0]}function v(e){F=e}function h(){var t=null;if(void 0!==e.options.id){o.init(e.options.id);var a=o.getCurrent();if(void 0!==e.options.startPage)t=e.options.startPage,w(x(t).actions);else if(null!==F)t=F,w(x(t).actions);else if(void 0!==x(a)){t=a;var i=x(a);w(i.actions)}else{var r=k.routes[0];angular.forEach(k.routes,function(e){e.start===!0&&(r=e)}),void 0!=r?(t=r.path,w(r.actions)):n.error("No first page available")}null!==t&&(window.location.hash="#"+t,window.cti.store.state.currentPage=t.replace("/",""),window.dispatchEvent(new CustomEvent("hashchange")))}k.isInitialized=!0}function y(e,a){if(void 0!=e)if(g(e)===!1){var o=d(e),i=a.templateUrl?a.templateUrl:o+".tpl.html";void 0!=a.template&&t.put(i,a.template),k.routes.push({path:e,id:o,templateUrl:i,possibilities:a.possibilities,actions:a.actions,start:a.start,auth:a.auth})}else n.error("Duplicate route names are not allowed.")}function b(){var e=window.location.href.match(/#(.*)$/);if(null!==e)return e[1]}function w(e){if(void 0!==e&&e.length>0){var t=c.get("ActionFactory");return t.triggerEvent("onpageload",e)}var n=s.defer();return n.resolve(),n.promise}function A(e){var t=s.defer();return e.auth===!0?u.authenticate().then(function(){t.resolve()})["catch"](function(e){t.reject(e)}):t.resolve(),t.promise}function S(e){function t(){e=e||"";var t=x(e);void 0!==t&&A(t).then(function(){w(t.actions).then(function(){window.cti.store.state.currentPage=e.replace("/",""),l.path(e)})})["catch"](function(e){i.errorMessage=e.message||e,l.path("/error")})}i.$$phase?t():i.$apply(t)}function $(e){var t=void 0;return angular.forEach(k.routes,function(n){void 0===t&&n.id==e&&(t=n)}),t}function x(e){var t=void 0;return angular.forEach(k.routes,function(n){void 0===t&&n.path==e&&(t=n)}),t}function E(e){var t=!1;return angular.forEach(k.views,function(n){n.path==e&&(t=!0)}),t}function T(){var t=f();if(void 0!=t)switch(e.options.mode){case"allin":angular.forEach(k.routes,function(e){E(e.path)===!1&&k.views.push(e)}),r(function(){k.animate=!0},1500);break;case"single":k.views=[t],r(function(){k.animate=!0},1500);break;case"intelligent":default:E(t.path)===!1&&k.views.push(t),r(function(){angular.forEach(t.possibilities,function(e){var t=$(e);void 0!=t&&E(t.path)===!1&&k.views.push(t)})},500),r(function(){k.animate=!0},1500)}}function C(e){k.currentPath!=e&&(k.currentPath=e,"/error"!=e&&o.add(e),T())}var k={routes:[],views:[],isInitialized:!1,animate:!1,currentPath:null,getCurrent:f,init:h,addRoute:y,go:S,lastRoute:p,goPrevious:m,setFirstPage:v},F=null;return window.onhashchange=function(e){if(e.newURL!=e.oldURL||void 0===e.newURL&&void 0===e.oldURL){var t=b();void 0!=t&&""!=t&&(i.$$phase?C(t):i.$apply(function(){C(t)}))}},k}]),angular.module("mobile-router").directive("mobileView",["Router","RouterConfig","StoreFactory","localStorageService","$rootScope","LoadingStatus","$timeout","Platform",function(e,t,n,a,o,i,r,s){return{restrict:"A",template:['<div class="grace-warning" ng-if="$root.grace">',"   This app will expire on <strong>{{$root.grace | date:'short'}}</strong></strong>","</div>",'<div class="preview-bar" ng-if="::$root.cancelable">','   <a href="javascript:void(0)" ng-click="view.exit()">','       <span class="fa fa-arrow-circle-left"></span> BACK',"   </a>",'   <a href="javascript:void(0)" ng-click="view.toggle()" class="drop-menu">','       <span class="fa fa-ellipsis-h"></span>',"   </a>","</div>",'<nav class="drop-menu-nav" ng-class="{\'open\': (view.open && $root.cancelable)}">','   <a href="javascript:void(0)" ng-click="view.reset()">','       <span class="fa fa-trash"></span> Reset',"   </a>","</nav>","<div class=\"app-container\" ng-class=\"{'loading': (view.load.loading), 'cancelable': ($root.cancelable), 'grace': ($root.grace)}\">",'   <div class="loader-container alert alert-primary">','       <span ng-if="view.load.loading" class="fa fa-spinner fa-spin"></span> {{view.load.message | translate}}',"   </div>",'   <div ng-repeat="route in view.router.views" id="{{::route.id}}" page-info ng-controller="PageController as page" class="page-container {{::view.config.options.animation}}" ng-class="{\'current\': (view.router.currentPath == route.path), \'animate\': (view.router.animate == true)}">','       <div class="flexbox-container" ng-form name="pageForm" md-form ng-include="route.templateUrl"></div>','       <div md-dom-ready="view.onDomReady(route)" ng-if="view.router.currentPath == route.path"></div>',"   </div>","</div>"].join(""),controller:function(){var c=this;c.router=e,c.config=t,c.load=i,c.exit=function(){if(o.cancelable){var e=null!==a.get("cancelUrl")?a.get("cancelUrl"):a.get("backUrl");null!==e&&(a.remove("backUrl"),a.remove("appName"),n.set("env.exit","cancel"),window.location.href=e)}},c.open=!1,c.toggle=function(){c.open=!c.open},c.reset=function(){o.cancelable&&(n.destroyAllData(),window.location.reload())},c.onDomReady=function(e){r(function(){if(o.$emit("onPageContentLoaded",e),"ios"===s.getName()){var t=document.querySelector("#"+e.id),n=Array.prototype.slice.call(t.querySelectorAll(".scrollable-item"),0);n.forEach(function(e){e.classList.remove("scrollable-item-ios"),setTimeout(function(){e.classList.add("scrollable-item-ios")},100)})}},0)}},controllerAs:"view"}}]),angular.module("mobile-router").directive("endOfRender",["Router","$log",function(e,t){return{restrict:"E",link:function(n){t.log("END OF RENDER: ",n.route.id),e.rendered=!0}}}]),angular.module("app.core").factory("BaseLayerFactory",function(){function e(e){return window.CtLayerRegistration?window.CtLayerRegistration.getInstance(e)||null:null}return{getByName:e}}),angular.module("app.core").factory("ChatLayerFactory",["$q","$rootScope","$parse","SchemaHelper","StoreFactory","ActionFactory","TranslationService","Plugin","FileSystem","Camera","Platform",function(e,t,n,a,o,i,r,s,c,l,u){function d(){if(!A){A=e.defer();var n=document.createElement("script");n.onload=function(){A.resolve()},n.onerror=function(e){A.resolve(e),A=void 0},window.___supportsNativeWebComponents?(n.src=t.basedir+"web_components/collections/chat.es6.js",document.head.appendChild(n)):A.reject("Chat layer not supported on older platforms (for now)")}return A.promise}function p(e,t){var n=e.name,a=e.actions,i=e.clConfig,r=angular.extend({},i);r=o.parse(r),r=m(r),r=g(r),r=f(r),r=v(r,t);var s=new window.CtChatLayer(n,r);a&&a.length&&w(n,s,a)}function m(e){var t=["xmpp.pingInterval","xmpp.pingTimeout","xmpp.loginTimeout","xmpp.maxMessageAge","behaviour.maxSubjectLength","behaviour.maxDescriptionLength","behaviour.maxConversationParticipants","behaviour.chatEntriesFetchBatchSize","behaviour.photoQuality","behaviour.defaultPriorityConversationExpiryTTL","behaviour.defaultPriorityConversationActivityTTL"];return t.forEach(function(t){var a=n(t),o=a.assign,i=a(e);if(i&&"number"!=typeof i){var r=~~parseInt(i.toString(),10);o(e,r)}}),e}function g(e){var t=a.getSchemaConfigItemsByItemType("language")||[],n=t.length>0;if(n){var o=window.cti.store.currentLanguageCode.replace("_","-"),i=o.split("-").shift();e.i18n={enabled:!0,language:i,locale:o,translateFn:function(e){return r.hasTranslation(e)===!1?null:r.translate(e)}}}else e.i18n={enabled:!1};return e}function f(e){return e.externalFunctions={captureOrSelectMedia:function(){return new Promise(function(t){var n=s.getSource("camera");if(n){var a=e.behaviour&&e.behaviour.photoQuality||80;l.takePhoto(a,0,0,0,0,!1,!1,!0,!0).then(function(e){return y(e,!0)}).then(function(e){t(e)})}else l.selectPhoto().then(function(e){return y(e)}).then(function(e){t(e)})})},cancelMediaSeletion:function(e){return c.deleteMediaItem(e)},showMediaFullscreen:function(e){return new Promise(function(t,n){var a=u.getType();if("desktop"===a){var o=require("electron").shell.openItem(e);o?t():n("Could not open media: "+e)}else if("device"===a){var i=e.toLowerCase().endsWith(".encrypted");if(i){var r=s.getSource("fileEncryption");r&&r.viewEncryptedImage(t,n,e)}else{var c=s.getSource("fileopener");c&&c.openFile(t,n,e)}}else n("Full screen images unsuported on this platform")})}},e}function v(e,t){if(!t.settings)return h(e);var n=t.settings["push-notifications"];if(!n)return h(e);var a=n.android&&n.android.enabled===!0||n.ios&&n.ios.enabled===!0;return a?(e.xmpp.push={androidEnabled:n.android&&n.android.enabled===!0,iosEnabled:n.ios&&n.ios.enabled===!0,voip:n.ios&&n.ios.voipEnabled===!0,packageId:t.packageId,senderId:n.android&&n.android.id||""},e):h(e)}function h(e){return e.xmpp.push={enabled:!1,voip:!1,packageId:"",senderId:""},e}function y(e,t){return new Promise(function(n){Promise.resolve(e).then(function(e){return Promise.all([c.resolveCdvFilePath(e),c.getFileNameFromPath(e)])}).then(function(e){return Promise.all([e[0],c.getFile(e[1],t)])}).then(function(e){n({path:e[0],mimeType:e[1].mimeType,base64:null})})})}function b(e){return window.CtChatLayer.getInstance(e)||null}function w(e,t,n){document.addEventListener("base-layer-ready:"+e,function(e){i.triggerEvent("chat-layer-ready",n,e.detail.layer)}),t.on("login-result",function(e){if(e.success){var a=t.getCurrentUser();i.triggerEvent("login",n,{user:a&&a.jid||null})}}),t.on("logout-result",function(e){e.success&&i.triggerEvent("logout",n)}),t.on("connection-status-change",function(e){i.triggerEvent("connection-status-change",n,{status:e.status})}),t.on("chat-notification",function(e){i.triggerEvent("chat-notification",n,{chatEntry:e.chatEntry,conversationTitle:e.conversationTitle,messagePreview:e.messagePreview,isForCurrentConversation:e.isForCurrentConversation})}),t.on("priority-conversation-notification",function(e){i.triggerEvent("priority-conversation-notification",n,{conversation:e.conversation,alert:e.alert,autoAlert:e.autoAlert,mustAcknowledge:e.mustAcknowledge})}),t.on("priority-conversation-acknowledged",function(e){i.triggerEvent("priority-conversation-acknowledged",n,{conversation:e.conversation,pendingCount:e.pendingCount})}),t.on("force-quit-conversation",function(e){i.triggerEvent("force-quit-conversation",n,{conversation:e.conversation})}),t.on("mute",function(){i.triggerEvent("chat-mute",n,{})}),t.on("auto-reconnected",function(){i.triggerEvent("auto-reconnected",n,{})}),t.on("post-login-complete",function(){i.triggerEvent("post-login-complete",n,{})}),t.on("move-task-to-back",function(){i.triggerEvent("move-task-to-back",n,{})})}var A;return{load:d,init:p,getByName:b}}]),angular.module("app.core").factory("IncidentLayerFactory",["$q","$rootScope","$parse","StoreFactory","ActionFactory",function(e,t,n,a,o){function i(){if(!u){u=e.defer();var n=document.createElement("script");n.onload=function(){u.resolve()},n.onerror=function(e){u.resolve(e),u=void 0},window.___supportsNativeWebComponents?(n.src=t.basedir+"web_components/collections/incident.es6.js",document.head.appendChild(n)):u.reject("Incident layer not supported on older platforms (for now)")}return u.promise}function r(e){var t=e.name,n=e.actions,o=e.ilConfig,i=angular.extend({},o);i=a.parse(i),i=s(i);var r=new window.CtIncidentLayer(t,i);n&&n.length&&l(t,r,n)}function s(e){var t=["xmpp.bot.timeout","xmpp.pingInterval","xmpp.pingTimeout","xmpp.initTimeout","xmpp.loginTimeout","xmpp.maxMessageAge","behaviour.incidentExpiration"];return t.forEach(function(t){var a=n(t),o=a.assign,i=a(e);if(i&&"number"!=typeof i){var r=~~parseInt(i.toString(),10);o(e,r)}}),e}function c(e){return window.CtIncidentLayer.getInstance(e)||null}function l(e,t,n){document.addEventListener("base-layer-ready:"+e,function(){o.triggerEvent("incident-layer-ready",n,{})}),t.on("login-result",function(e){if(e.success){var a=t.getCurrentUser(),i=a&&a.role;o.triggerEvent("login",n,{user:a&&a.jid||null,role:i&&i.id||null})}}),t.on("logout-result",function(e){e.success&&o.triggerEvent("logout",n)}),t.on("connection-status-change",function(e){o.triggerEvent("connection-status-change",n,{status:e.status})}),t.on("new-incident",function(e){o.triggerEvent("new-incident",n,{incident:e.incident})}),t.on("incident-updated",function(e){o.triggerEvent("incident-updated",n,{incident:e.incident})}),t.on("incident-response",function(e){o.triggerEvent("incident-response",n,{incident:e.incident,response:e.response})}),t.on("incident-severity-change",function(e){o.triggerEvent("incident-severity-change",n,{oldIncident:e.oldIncident,newIncident:e.newIncident})}),t.on("incident-closed",function(e){o.triggerEvent("incident-closed",n,{incident:e.incident})}),t.on("incident-alert",function(e){o.triggerEvent("incident-alert",n,{incident:e.incident,response:e.response})},!1,!0),t.on("incident-alert-dismissed",function(){o.triggerEvent("incident-alert-dismissed",n)},!1,!0),t.on("report-downloaded",function(e){o.triggerEvent("report-downloaded",n,{filePath:e.filePath,report:e.report})})}var u;return{load:i,init:r,getByName:c}}]),angular.module("app.core").factory("PagerLayerFactory",["$q","$rootScope","ActionFactory",function(e,t,n){function a(){if(!s){s=e.defer();var n=document.createElement("script");n.onload=function(){s.resolve()},n.onerror=function(e){s.resolve(e),s=void 0},window.___supportsNativeWebComponents?(n.src=t.basedir+"web_components/collections/pager.es6.js",document.head.appendChild(n)):s.reject("Pager layer not supported on older platforms (for now)")}return s.promise}function o(e){var t=angular.extend({},e),n=t.name,a=t.actions;delete t._auto_id_,delete t["item-type"],delete t.name,delete t.type,delete t.str,delete t.actions;var o=new window.CtPagerLayer(n,t);a&&a.length&&r(n,o,a)}function i(e){return window.CtPagerLayer.getInstance(e)||null}function r(e,t,a){document.addEventListener("base-layer-ready:"+e,function(){n.triggerEvent("pager-layer-ready",a,{})}),t.on("connection-status-change",function(e){n.triggerEvent("connection-status-change",a,{status:e})}),t.on("new-page-received",function(e){n.triggerEvent("new-page-received",a,{$message:e})}),t.on("responded-to-page",function(e){n.triggerEvent("responded-to-page",a,{id:e})}),t.on("responded-to-all-pages",function(){n.triggerEvent("responded-to-all-pages",a)}),t.on("logout-request-confirmed",function(){n.triggerEvent("pager-logout-request-confirmed",a,{})}),t.on("mute",function(){n.triggerEvent("pager-mute",a,{})}),t.on("login-result",function(e){e.success?n.triggerEvent("login-success",a,e):n.triggerEvent("login-fail",a,e)}),t.on("databases-auto-destroyed",function(){n.triggerEvent("databases-auto-destroyed",a,{})})}var s;return{load:a,init:o,getByName:i}}]),angular.module("app.core").factory("UserManagementLayerFactory",["$q","$rootScope","ActionFactory",function(e,t,n){function a(){if(!s){s=e.defer();var n=document.createElement("script");n.onload=function(){s.resolve()},n.onerror=function(e){s.resolve(e),s=void 0},window.___supportsNativeWebComponents?(n.src=t.basedir+"web_components/collections/user-management.es6.js",document.head.appendChild(n)):s.reject("User Management layer not supported on older platforms (for now)")}return s.promise}function o(e){var t=angular.extend({},e),n=t.name,a=t.actions;delete t._auto_id_,delete t["item-type"],delete t.name,delete t.type,delete t.str,delete t.actions;var o=new window.CtUMLayer(n,t);a&&a.length&&r(n,o,a)}function i(e){return window.CtUMLayer.getInstance(e)||null}function r(e,t,a){document.addEventListener("base-layer-ready:"+e,function(){n.triggerEvent("user-management-layer-ready",a,{})}),t.on("connection-status-change",function(e){n.triggerEvent("connection-status-change",a,{status:e})}),t.on("user-authorised",function(){n.triggerEvent("user-management-user-authorised",a,{})}),t.on("logout-request-confirmed",function(){n.triggerEvent("user-management-logout-request-confirmed",a,{})})}var s;return{load:a,init:o,getByName:i}}]),angular.module("app.core").factory("ForegroundBackground",["$log","SchemaHelper","ActionFactory","StoreFactory","LoggingFactory",function(e,t,n,a,o){function i(){function i(){o.isLoggingEnabled().then(function(t){t===!0&&e.info("App has gone foreground")}),window.cti.store.state.foreground=!0,a.save();var i=t.getSchemaConfigItemsByItemType("onforeground");i&&i.length>0&&n.triggerEvent("onforeground",i[0].actions)}function r(){o.isLoggingEnabled().then(function(t){t===!0&&e.info("App has gone background")}),window.cti.store.state.foreground=!1,a.save();var i=t.getSchemaConfigItemsByItemType("onbackground");i&&i.length>0&&n.triggerEvent("onbackground",i[0].actions)}a.set("state.foreground",!1),document.addEventListener("deviceready",function(){document.addEventListener("pause",r,!1),document.addEventListener("resume",i,!1),window.removeEventListener("blur",r,!1),window.removeEventListener("focus",i,!1),a.set("state.foreground",!0)}),window.addEventListener("blur",r,!1),window.addEventListener("focus",i,!1)}return{init:i}}]),angular.module("app.core").factory("ScreenOrientation",["Plugin","electron",function(e,t){function n(){return void 0!==t.app}function a(){if(n())return"";var t=e.getSource("screen");if(t){var a=t.orientation||"";return"object"==typeof a&&"type"in a&&(a=a.type),a.indexOf("landscape")!==-1?r.LANDSCAPE:r.PORTRAIT}return""}function o(t){if(!n()){var a=e.getSource("screen");a&&a.lockOrientation(t)}}function i(){if(!n()){var t=e.getSource("screen");t&&t.unlockOrientation()}}var r={PORTRAIT:"portrait",LANDSCAPE:"landscape"};return{ORIENTATION:r,getOrientation:a,lockOrientation:o,unlockOrientation:i}}]),angular.module("app.core").factory("WcUtils",["StoreFactory",function(e){function t(t,n,a){if(t&&t[0]){if(angular.isObject(n)&&Object.keys(n).length>0)for(var o in n)if(n.hasOwnProperty(o)&&0!==o.indexOf("$")){var i=n[o],r=!1;null===i&&(r=!0),"string"==typeof i&&i.indexOf("{{")!==-1&&(r=!0,i=e.parse(i)),!r&&a||(""!==i&&void 0!==i&&null!==i?t[0].setAttribute(o,i):t[0].removeAttribute(o))}t[0].$$attrsHandled=!0}}function n(e,t){e&&e[0]&&angular.isObject(t)&&Object.keys(t).length>0&&e[0].setAttribute("md-expressions",JSON.stringify(t))}function a(e,t){e&&e[0]&&(e[0].setAttribute("md-actions","from-schema"),t&&e[0].setAttribute("md-actions-event-detail-only","true"))}function o(e,t){e&&e[0]&&(e[0].setAttribute("md-actions","from-callback"),e[0].setAttribute("md-actions-callback-factory",t))}return{applyAttributes:t,applyExpressions:n,applyActionsFromSchema:a,applyActionsFromCallback:o}}]),angular.module("app.core").factory("ctCommonLoginFormFactory",["$rootScope","WcUtils","ActionFactory",function(e,t,n){function a(e){var n=angular.element("<"+r+">");return n.attr("id",e.name),n.attr("schema-source",e._auto_id_),t.applyAttributes(n,o(e)),t.applyExpressions(n,e.expressions),t.applyActionsFromCallback(n,"ctCommonLoginFormFactory#applyActions"),n}function o(e){function t(e,t){""!==t&&void 0!==t&&(n[e]=t)}var n={};return t("class",e.classes),t("owner",e.layer),t("theme",e.theme),t("auto-append-domain-name",e.autoAppendDomainName),t("username",e.username),t("hide-username",e.hideUsername),t("disable-username",e.disableUsername),t("log-in-label",e.logInLabel),n}function i(e,t){e[0].addEventListener("login-form-result",function(e){var a=e.detail;a.success?n.triggerEvent("login-success",t,{}):n.triggerEvent("login-failure",t,{exception:a.exception})})}var r="ct-login-form";return{buildDom:a,getAttributes:o,applyActions:i}}]),angular.module("app.core").factory("ctCommonOnlineIndicatorFactory",["$rootScope","WcUtils",function(e,t){function n(e){var n=angular.element("<"+o+">");return n.attr("id",e.name),n.attr("schema-source",e._auto_id_),t.applyAttributes(n,a(e)),t.applyExpressions(n,e.expressions),n}function a(e){function t(e,t){""!==t&&void 0!==t&&(n[e]=t)}var n={};return t("class",e.classes),t("owner",e.layer),t("show-icon",e.showIcon),t("show-text",e.showText),n}var o="ct-online-indicator";return{buildDom:n,getAttributes:a}}]),angular.module("app.core").factory("ctCommonUserDisplayFactory",["$rootScope","WcUtils",function(e,t){function n(e){var n=angular.element("<"+o+">");if(t.applyAttributes(n,a(e)),t.applyExpressions(n,e.expressions),e.label){var i=angular.element('<div style="display: flex;">'),r=angular.element('<div class="user-display-label"></div>');return r.text(e.label),i.append(r),i.append("&nbsp;"),i.append(n),i.attr("id",e.name),i.attr("schema-source",e._auto_id_),i}return n.attr("id",e.name),n.attr("schema-source",e._auto_id_),n}function a(e){function t(e,t){""!==t&&void 0!==t&&(n[e]=t)}var n={};return t("class",e.classes),t("owner",e.layer),t("type",e.displayType),t("show-icon",e.showIcon),n}var o="ct-user-display";return{buildDom:n,getAttributes:a}}]),angular.module("app.core").factory("ctCommonSlidePanelFactory",["$rootScope","WcUtils",function(e,t){function n(e){var n=angular.element("<"+o+">");return n.attr("id",e.name),t.applyAttributes(n,a(e)),t.applyExpressions(n,e.expressions),n}function a(e){function t(e,t){""!==t&&void 0!==t&&(n[e]=t)}var n={};return t("class",e.classes),t("owner",e.layer),t("menu-width",e.menuWidth),n}var o="ct-slide-panel";return{buildDom:n,getAttributes:a}}]),angular.module("app.core").factory("ctCommonDebuggerFactory",["$rootScope","WcUtils",function(e,t){function n(e){var n=angular.element("<"+o+">");return n.attr("id",e.name),t.applyAttributes(n,a(e)),t.applyExpressions(n,e.expressions),n}function a(e){function t(e,t){""!==t&&void 0!==t&&(n[e]=t)}var n={};return t("class",e.classes),t("owner",e.layer),n}var o="ct-debugger";return{buildDom:n,getAttributes:a}}]),angular.module("app.core").factory("ctCLConversationListFactory",["$rootScope","WcUtils","ActionFactory",function(e,t,n){function a(e){var n=angular.element("<"+r+">");return n.attr("id",e.name),n.attr("schema-source",e._auto_id_),t.applyAttributes(n,o(e)),t.applyExpressions(n,e.expressions),t.applyActionsFromCallback(n,"ctCLConversationListFactory#applyActions"),n}function o(e){function t(e,t){""!==t&&void 0!==t&&(n[e]=t)}var n={};return t("class",e.classes),t("owner",e.layer),n}function i(e,t){e[0].addEventListener("go-new-conversation",function(){n.triggerEvent("go-new-conversation",t,{})}),e[0].addEventListener("go-chat",function(){n.triggerEvent("go-chat",t,{})})}var r="ct-cl-conversation-list";return{buildDom:a,getAttributes:o,applyActions:i}}]),angular.module("app.core").factory("ctCLNewConversationFactory",["$rootScope","WcUtils","StoreFactory","ActionFactory",function(e,t,n,a){function o(e){var n=angular.element("<"+s+">");return n.attr("id",e.name),n.attr("schema-source",e._auto_id_),t.applyAttributes(n,i(e)),t.applyExpressions(n,e.expressions),t.applyActionsFromCallback(n,"ctCLNewConversationFactory#applyActions"),n}function i(e){function t(e,t){""!==t&&void 0!==t&&(a[e]=t)}var a={};t("class",e.classes),t("owner",e.layer),t("allow-search",e.allowSearch),t("require-search",e.requireSearch);var o=e.showCountFrom.indexOf("{{")!==-1?n.parse(e.showCountFrom):e.showCountFrom,i=parseInt(o,10);return(i||0)>0&&t("show-count-from",i.toString()),a}function r(e,t){e[0].addEventListener("go-back",function(){a.triggerEvent("go-back",t,{})}),e[0].addEventListener("go-chat",function(){a.triggerEvent("go-chat",t,{})})}var s="ct-cl-new-conversation";return{buildDom:o,getAttributes:i,applyActions:r}}]),angular.module("app.core").factory("ctCLChatMessageListFactory",["$rootScope","WcUtils","ActionFactory",function(e,t,n){function a(e){var n=angular.element("<"+r+">");return n.attr("id",e.name),n.attr("schema-source",e._auto_id_),t.applyAttributes(n,o(e)),t.applyExpressions(n,e.expressions),t.applyActionsFromCallback(n,"ctCLChatMessageListFactory#applyActions"),n}function o(e){function t(e,t){""!==t&&void 0!==t&&(n[e]=t)}var n={};return t("class",e.classes),t("owner",e.layer),n}function i(e,t){e[0].addEventListener("go-back",function(){n.triggerEvent("go-back",t,{})}),e[0].addEventListener("go-info",function(){n.triggerEvent("go-info",t,{})}),e[0].addEventListener("go-leave",function(){n.triggerEvent("go-leave",t,{})}),e[0].addEventListener("go-end",function(){n.triggerEvent("go-end",t,{})})}var r="ct-cl-chat-message-list";return{buildDom:a,getAttributes:o,applyActions:i}}]),angular.module("app.core").factory("ctCLConversationInfoFactory",["$rootScope","WcUtils","ActionFactory",function(e,t,n){function a(e){var n=angular.element("<"+r+">");return n.attr("id",e.name),n.attr("schema-source",e._auto_id_),t.applyAttributes(n,o(e)),t.applyExpressions(n,e.expressions),t.applyActionsFromCallback(n,"ctCLConversationInfoFactory#applyActions"),n}function o(e){function t(e,t){""!==t&&void 0!==t&&(n[e]=t)}var n={};return t("class",e.classes),t("owner",e.layer),n}function i(e,t){e[0].addEventListener("go-back",function(){n.triggerEvent("go-back",t,{})}),e[0].addEventListener("go-add-contacts",function(){n.triggerEvent("go-add-contacts",t,{})}),e[0].addEventListener("go-chat",function(){n.triggerEvent("go-chat",t,{})})}var r="ct-cl-conversation-info";return{buildDom:a,getAttributes:o,applyActions:i}}]),angular.module("app.core").factory("ctCLAddConversationContactsFactory",["$rootScope","WcUtils","StoreFactory","ActionFactory",function(e,t,n,a){function o(e){var n=angular.element("<"+s+">");return n.attr("id",e.name),n.attr("schema-source",e._auto_id_),t.applyAttributes(n,i(e)),t.applyExpressions(n,e.expressions),t.applyActionsFromCallback(n,"ctCLAddConversationContactsFactory#applyActions"),n}function i(e){function t(e,t){""!==t&&void 0!==t&&(a[e]=t)}var a={};t("class",e.classes),t("owner",e.layer),t("allow-search",e.allowSearch),t("require-search",e.requireSearch);var o=e.showCountFrom.indexOf("{{")!==-1?n.parse(e.showCountFrom):e.showCountFrom,i=parseInt(o,10);return(i||0)>0&&t("show-count-from",i.toString()),a}function r(e,t){e[0].addEventListener("go-back",function(){a.triggerEvent("go-back",t,{})})}var s="ct-cl-add-conversation-contacts";return{buildDom:o,getAttributes:i,applyActions:r}}]),function(){function e(){"true"===document.head.getAttribute("data-is-client")&&document.URL.indexOf("file://")!==-1&&(h="./client/");var e=localStorage.getItem("appName");p=void 0!==e&&null!==e,m?(document.addEventListener("deviceready",t,!1),setTimeout(function(){g||(console.error("deviceready was not fired"),o())},u)):o()}function t(){g=!0,p||void 0===window.plugins||null===window.plugins||void 0===window.plugins.provisioning||null===window.plugins.provisioning?o():(d=window.plugins.provisioning,document.addEventListener("updateavailable",n,!1),o())}function n(e){function t(){d.installVersion(function(){d.restartApplication(function(){},function(){console.error("Provisioning failed to restart and install new version")})},function(){console.error("Provisioning failed to update")},{version:e.detail.version})}function n(){console.info("Update postponed.")}a(e,t,n)}function a(e,t,n){if(!f){f=!0,document.querySelectorAll("#version-modal .version-number")[0].innerText=e.detail.version;var a=document.getElementById("version-modal");a.style.display="block",document.querySelectorAll("#version-modal .confirm-button")[0].addEventListener("click",function(){f=!1,a.style.display="none",void 0!==t&&t()}),document.querySelectorAll("#version-modal .dismiss-button")[0].addEventListener("click",function(){f=!1,a.style.display="none",void 0!==n&&n()})}}function o(){v.when().then(function(){return i()}).then(function(){return r()}).then(function(){s()})}function i(){var e=v.defer();return v.when().then(function(){return c("assets/js/polyfills/custom-events.js")}).then(function(){e.resolve()}),e.promise}function r(){window.___supportsNativeWebComponents=!!window.customElements&&!!HTMLElement.prototype.attachShadow;var e=v.defer();return v.when().then(function(){return l(window.___supportsNativeWebComponents,"assets/js/skatejs/skate.es6.js")}).then(function(){e.resolve()}),e.promise}function s(){var e=document.body.getAttribute("data-schema"),t=window.document.querySelectorAll("body div.view-frame")[0];t.setAttribute("md-app",""+(p?"":e?e:"config.json")),angular.element(document).ready(function(){angular.bootstrap(document,["app"])})}function c(e){var t=v.defer(),n=document.createElement("script");return n.onload=function(){t.resolve()},n.src=h+e,document.head.appendChild(n),t.promise}function l(e,t){return e?c(t):v.when()}var u=5e3,d=null,p=!1,m=window.cordova!==!1,g=!1,f=!1,v=angular.injector(["ng"]).get("$q"),h="./";document.addEventListener("DOMContentLoaded",e,!1)}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/area/mdList/mdList.tpl.html",'<div id="{{:: name }}"\n     class="md-list {{:: classes }}">\n\n    <div ng-if="::(search.internal || pagination.showAbove)"\n         class="top">\n\n        <div ng-if="::search.internal" class="search-area">\n\n            <div class="search-box" ng-class="::{ \'input-group\': search.showButton }">\n                <input type="text" class="form-control" ng-model="search.inputValue" ng-model-options="::{ debounce: { default: search.debounce, blur: 0 } }" md-on-enter="performSearch()" placeholder="{{ \'Search...\' | translate }}"/>\n                <span ng-if="::search.showButton" class="input-group-btn">\n                    <button class="btn btn-default" ng-click="performSearch()">\n                        {{:: search.buttonLabel }}\n                        <span ng-if="::search.buttonIcon" class="fa {{:: search.buttonIcon }}"></span>\n                    </button>\n                </span>\n            </div>\n\n        </div>\n\n        <div ng-if="::pagination.showAbove"\n             ng-show="pagination.visible"\n             class="pagination-container"\n             ng-include="\'components/area/mdList/mdListPagination.tpl.html\'">\n        </div>\n\n    </div>\n\n    <div class="main scrollable">\n        <ul class="md-list-items">\n            <li md-list-item\n                ng-repeat="$item in (filteredListData = (listData | filter:filter | orderBy:listOrder:order.reverse)) | limitTo:pagination.limit:pagination.start track by itemTrackFn($item, $index)"\n                md-context-provider="::$item"\n                md-context-item-collection="::listData"\n                ng-class="itemCssClass($item, $index)">\n            </li>\n        </ul>\n    </div>\n\n    <div ng-if="::pagination.showBelow"\n         class="bottom">\n\n        <div ng-show="pagination.visible"\n             class="pagination-container"\n             ng-include="\'components/area/mdList/mdListPagination.tpl.html\'">\n        </div>\n\n    </div>\n\n</div>');
}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/area/mdList/mdListPagination.tpl.html",'<nav>\n    <ul class="pagination pagination-sm">\n        <li ng-if="::pagination.showFirstLast"\n            class="page-first"\n            ng-class="{ \'disabled\': pagination.currentPage === 1 }">\n            <a ng-click="goToPage(\'first\')">\n                <span ng-if="::pagination.firstPageIcon" class="fa {{:: pagination.firstPageIcon }}"></span>\n                {{ pagination.firstPageLabel | translate }}\n            </a>\n        </li>\n        <li ng-if="::pagination.showPrevNext"\n            class="page-prev"\n            ng-class="{ \'disabled\': pagination.currentPage === 1 }">\n            <a ng-click="goToPage(\'prev\')">\n                <span ng-if="::pagination.prevPageIcon" class="fa {{:: pagination.prevPageIcon }}"></span>\n                {{ pagination.prevPageLabel | translate }}\n            </a>\n        </li>\n        <li ng-repeat="pageNumber in pagination.visiblePages"\n            class="numbered-page"\n            ng-class="{ \'active\': pageNumber === pagination.currentPage }">\n            <a ng-click="goToPage(pageNumber)">\n                {{ pageNumber }}\n            </a>\n        </li>\n        <li ng-if="::pagination.showPrevNext"\n            class="page-next"\n            ng-class="{ \'disabled\': pagination.currentPage === pagination.totalPages }">\n            <a ng-click="goToPage(\'next\')">\n                {{ pagination.nextPageLabel | translate }}\n                <span ng-if="::pagination.nextPageIcon" class="fa {{:: pagination.nextPageIcon }}"></span>\n            </a>\n        </li>\n        <li ng-if="::pagination.showFirstLast"\n            class="page-last"\n            ng-class="{ \'disabled\': pagination.currentPage === pagination.totalPages }">\n            <a ng-click="goToPage(\'last\')">\n                {{ pagination.lastPageLabel | translate }}\n                <span ng-if="::pagination.lastPageIcon" class="fa {{:: pagination.lastPageIcon }}"></span>\n            </a>\n        </li>\n    </ul>\n</nav>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/imageViewer/imageViewer.tpl.html",'<div class="image-viewer-container {{classes}}" ng-class="{\'dynamic\': (multiple || (image === undefined))}">\n    <div class="image-frame" ng-if="multiple" ng-repeat="fileURI in files track by $index" ng-switch="getFileType(fileURI)">\n        <img ng-switch-when="image" md-thumbnail="{{fileURI}}" md-thumbnail-maxwidth="200" md-thumbnail-maxheight="200" ng-click="open($index)"/>\n        <div ng-switch-when="audio" class="media-player text-center" ng-click="open($index)"><span class="fa fa-file-audio-o fa-3x"></span><br><br><span>{{getViewableFilePath(fileURI)}}</span></div>\n    </div>\n    <div class="image-frame no-data" ng-if="(multiple && files.length === 0) || (!multiple && image === undefined)">\n        <span class="fa fa-picture-o"></span>\n        {{ \'No sources have been added.\' | translate }}\n    </div>\n    <img md-thumbnail="{{image | trusted}}" md-thumbnail-maxwidth="{{maxWidth}}" md-thumbnail-maxheight="{{maxHeight}}" ng-if="!multiple && image !== undefined && scaleImage" ng-click="open($index)"/>\n    <img ng-src="{{image | trusted}}" ng-if="!multiple && image !== undefined && !scaleImage"/>\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/imageViewer/imageViewerDisplay.tpl.html",'<div class="image-viewer-display-container"><div class="image-frame"><img ng-src="{{src}}" /></div><div class="image-footer"><a href="javascript:void(0)" class="danger" ng-click="delete()"><span class="fa fa-trash"></span> Delete</a><a href="javascript:void(0)" class="warning"><span class="fa fa-camera"></span> Retake</a><a href="javascript:void(0)" ng-click="close()" class="primary"><span class="fa fa-close"></span> Close</a></div></div>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/md-barcode.tpl.html",'<div class="barcode-group" md-actions="{{actions}}">\n\n    <div class="code-display" ng-if="displayValue !== false" ng-class="{\'placeholder\': (!inputModel)}">{{inputModel || \'--\'}}</div>\n\n    <button class="btn btn-primary btn-lg" type="button">\n        <span ng-if="codeType === \'bar\'">\n            <span class="fa fa-barcode"></span> {{ \'Capture Barcode\' | translate }}\n        </span>\n        <span ng-if="codeType === \'qr\'">\n            <span class="fa fa-qrcode"></span> {{ \'Capture QR Code\' | translate }}\n        </span>\n    </button>\n\n    <input type="hidden" validation="{{validators}}" name="{{::name}}" id="{{::name}}" ng-model="inputModel" ng-required="required" class="form-control" />\n</div>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/md-checkbox.tpl.html",'<div class="container md-checkbox-container">\n    <div class="checkbox-element" ng-repeat="option in options track by $index" ng-class="{\'vertical\': ($parent.$parent.vertical == true)}">\n        <div class="md-checkbox" ng-class="{ \'no-label\': !option.label, selected: (model[option.id] == true), \'md-checkbox-disabled\': disabled }"\n             md-actions="{{ actions }}"\n             ng-click="makeSelection(option.id)">\n            <span class="fa" ng-class="getClasses(option)"></span>\n            <span>{{option.label | translate}}</span>\n        </div>\n    </div>\n    <input type="hidden" name="{{name}}" validation="{{validators}}" ng-required="{{required}}" ng-model="model" />\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/md-radio.tpl.html",'<div class="container md-checkbox-container">\n    <div class="checkbox-element" ng-repeat="option in options track by $index">\n        <div class="md-checkbox" ng-class="{ \'no-label\': !option.label, selected: (model == option.value), \'md-radio-disabled\': (disabled) }"\n             md-actions="{{ actions }}"\n             ng-click="makeSelection(option.value)">\n            <span class="fa" ng-class="getClasses(option)"></span>\n            <span>{{option.label | translate}}</span>\n        </div>\n    </div>\n    <input type="hidden" name="{{name}}" validation="{{validators}}" ng-required="{{required}}" ng-model="model" />\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/record-audio.tpl.html",'<div class="{{classes}}" ng-class="{ \'audio-recorder-small\': smallrecorder, \'audio-recorder\': !smallrecorder }">\n    <a class="record-button" ng-click="recordButton()" ng-class="{ \'record-active\': state == 2, \'record-populated\': (isPopulated && !multiple) }">\n        <span class="fa fa-stack fa-2x">\n            <i id="mic-background" class="fa fa-stack-2x" ng-class="multiple ? (state == 2 ? \'fa-circle\' : \'fa-circle-thin\') : (state == 2 || isPopulated ? \'fa-circle\' : \'fa-circle-thin\')"></i>\n            <i id="mic-foreground" class="fa fa-microphone fa-stack-1x"></i>\n        </span>\n    </a>\n    <div ng-if="!smallrecorder" class="current-time">\n        {{currentTime}}\n    </div>\n</div>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/mediaPlayer/audioPlayer.tpl.html","<div class=\"audio-player\" ng-class=\"{'play-active': (ap.info.state === 'running'), 'play-idle': (ap.info.state !== 'running'), 'disabled': (ap.info.state === null)}\">\n"+'    <a class="play-button" ng-click="ap.button()" ng-disabled="ap.info.state === null">\n        <span class="fa fa-stack fa-2x">\n            <i id="play-background" class="fa fa-stack-2x" ng-class="{\'fa-square\': (ap.info.state === \'running\'), \'fa-circle\': (ap.info.state !== \'running\')}"></i>\n            <i id="play-foreground" class="fa fa-stack-1x" ng-class="{\'fa-pause\': (ap.info.state === \'running\'), \'fa-play\': (ap.info.state !== \'running\')}"></i>\n        </span>\n    </a>\n    <span class="current-time">{{ap.info.currentTime}}</span>\n    <div class="timeline">\n        <div class="filler"></div>\n    </div>\n    <span class="total-time">{{ap.info.totalTime}}</span>\n    <!--<div class="loader" ng-if="ap.load === true">Loading...</div>-->\n</div>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/mediaPlayer/mediaPlayer.tpl.html",'<div class="media-player-container {{classes}}" ng-class="{\'dynamic\': (model)}">\n    <div ng-if="itemType == \'audio\'">\n        <audio-player name="{{name}}_player" src="{{src | trusted}}" actions="actions"></audio-player>\n    </div>\n    <div ng-if="itemType == \'video\'">\n        <video type="video/mp4" ng-src="{{src | trusted}}" width="100%" controls></video>\n    </div>\n</div>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/barcode.tpl.html",'<take-barcode code-type="bar" ng-model="$parent.$parent.inputModel"></take-barcode>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/checkbox.tpl.html",'<md-checkbox model="$parent.$parent.inputModel"\n             name="name"\n             required="required"\n             options="options"\n             disabled="disabled"\n             icon-selected="{{iconSelected}}"\n             validators="{{validators}}"\n             actions="{{actions}}"\n             icon-unselected="{{iconUnselected}}">\n</md-checkbox>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/date.tpl.html",'<div ng-class="{\'input-group\': (leftIcon || rightIcon)}" >\n    <div class="input-group-addon" ng-if="leftIcon"><span class="fa {{::leftIcon}}"></span></div>\n    <input type="text" pick-a-date="$parent.$parent.inputModel" pick-a-date-options="options" md-actions="{{actions}}" placeholder="{{::placeholder || \'--\' | translate}}" class="form-control" ng-disabled="disabled" />\n    <div class="input-group-addon" ng-if="rightIcon"><span class="fa {{::rightIcon}}"></span></div>\n</div>\n<input type="hidden" name="{{::name}}" validation="{{validators}}" ng-required="{{required}}" ng-model="$parent.$parent.inputModel" />\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/datetime.tpl.html",'\n<div class="row datetime-container">\n    <div class="col-xs-6">\n        <div class="input-group">\n            <div class="input-group-addon">\n                <span class="fa fa-calendar"></span>\n            </div>\n            <input type="text" validation="{{validators}}" pick-a-date date-value="$parent.$parent.inputModel" min="min" max="max" ng-model="dateModel" class="form-control" name="{{::name}}" id="{{::name}}" placeholder="{{::placeholder}}" ng-required="{{required}}" ng-disabled="disabled">\n        </div>\n    </div>\n    <div class="col-xs-6">\n        <div class="input-group">\n            <div class="input-group-addon">\n                <span class="fa fa-calendar"></span>\n            </div>\n            <input type="text" validation="{{validators}}" pick-a-time date-value="$parent.$parent.inputModel" tmin="tmin" tmax="tmax" ng-model="dateModel" class="form-control" name="{{::name}}" id="{{::name}}" placeholder="{{::placeholder}}" ng-required="{{required}}" ng-disabled="disabled">\n        </div>\n    </div>\n</div>\n\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/email.tpl.html",'<div ng-class="{\'input-group\': (leftIcon || rightIcon)}">\n    <div class="input-group-addon" ng-if="leftIcon"><span class="fa {{::leftIcon}}"></span></div>\n    <input type="email" md-actions="{{actions}}" valid-email validation="{{validators}}" class="form-control" id="{{::name}}" name="{{::name}}" placeholder="{{::placeholder | translate}}" ng-required="{{required}}" ng-disabled="disabled" ng-model="$parent.$parent.inputModel" ng-model-options="{debounce: { \'default\': 500, \'blur\': 0 }}">\n    <div class="input-group-addon" ng-if="rightIcon"><span class="fa {{::rightIcon}}"></span></div>\n</div>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/number.tpl.html",'<div ng-class="{\'input-group\': (leftIcon || rightIcon)}">\n    <div class="input-group-addon" ng-if="leftIcon"><span class="fa {{::leftIcon}}"></span></div>\n    <input type="number" validation="{{validators}}" md-actions="{{actions}}" min="{{min}}" max="{{max}}" class="form-control" id="{{::name}}" name="{{::name}}" placeholder="{{::placeholder | translate}}" ng-required="{{required}}" ng-disabled="disabled" ng-model="$parent.$parent.inputModel" ng-model-options="{debounce: { \'default\': 500, \'blur\': 0 }}" number-format decimal-places="{{::decimals}}" />\n    <div class="input-group-addon" ng-if="rightIcon"><span class="fa {{::rightIcon}}"></span></div>\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/password.tpl.html",'<div ng-class="{\'input-group\': (leftIcon || rightIcon)}">\n    <div class="input-group-addon" ng-if="leftIcon"><span class="fa {{::leftIcon}}"></span></div>\n    <input type="password" validation="{{validators}}" md-actions="{{actions}}" class="form-control" id="{{::name}}" name="{{::name}}" placeholder="{{::placeholder | translate}}" ng-required="{{required}}" ng-disabled="disabled" ng-model="$parent.$parent.inputModel" ng-model-options="{debounce: { \'default\': 500, \'blur\': 0 }}" />\n    <div class="input-group-addon" ng-if="rightIcon"><span class="fa {{::rightIcon}}"></span></div>\n</div>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/photo.tpl.html",'<take-photo ng-model="$parent.$parent.inputModel" image-url="$parent.$parent.inputModel" quality="quality" source="source" disabled="disabled" destination="destination"></take-photo>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/qrcode.tpl.html",'<take-barcode code-type="qr" ng-model="$parent.$parent.inputModel"></take-barcode>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/radio.tpl.html",'<md-radio model="$parent.$parent.inputModel"\n          name="name"\n          required="required"\n          options="options"\n          disabled="disabled"\n          icon-selected="{{iconSelected}}"\n          validators="{{validators}}"\n          actions="{{actions}}"\n          icon-unselected="{{iconUnselected}}">\n</md-radio>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/range-slider.tpl.html",'<md-range-slider name="name"\n                 model="$parent.$parent.inputModel"\n                 required="required"\n                 disabled="disabled"\n                 validators="{{validators}}"\n                 min="{{min}}"\n                 max="{{max}}"\n                 step="{{step}}"\n                 actions="actions">\n</md-range-slider>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/rating.tpl.html",'<div star-rating\n     class="star-rating"\n     rating-value="$parent.$parent.inputModel"\n     max="max || 5"\n     on-rating-selected="inputModel = rating; updateInputValue(rating);"\n     actions="actions"\n     disabled="disabled">\n</div>\n<input type="hidden" md-actions="{{actions}}" validation="{{validators}}" ng-model="$parent.$parent.inputModel" name="{{::name}}" ng-required="{{required}}" />\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/recordAudio.tpl.html",'<record-audio name="{{name}}" model="{{key}}" label="{{label}}" small-player="smallplayer" actions="actions"></record-audio>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/select.tpl.html",'<select ng-if="!searchable"\n        md-select\n        id="{{:: name }}"\n        name="{{:: name }}"\n        ng-model="$parent.$parent.$parent.inputModel"\n        ng-options="option.label group by option.group for option in $parent.options track by option.value"\n        ng-change="$parent.$parent.$parent.userInput()"\n        ng-required="{{ required }}"\n        ng-disabled="disabled"\n        ng-class="{ disabled: disabled }"\n        md-actions="{{ actions }}"\n        validation="{{ validators }}"\n        class="form-control">\n    <option value="">{{ \'Please select...\' | translate }}</option>\n</select>\n\n<div ng-if="searchable">\n    <ol class="nya-bs-select"\n        data-live-search="true"\n        data-size="5"\n        ng-model="$parent.$parent.$parent.inputModel"\n        ng-disabled="disabled"\n        md-actions="{{ actions }}">\n        <li nya-bs-option="option in $parent.options group by option.group track by option.value">\n            <span class="dropdown-header" ng-if="$group">{{ $group | translate }}</span>\n            <a>{{ option.label | translate }}</a>\n        </li>\n    </ol>\n    <input type="hidden" ng-model="$parent.$parent.inputModel" validation="{{validators}}" name="{{::name}}" ng-required="{{required}}"/>\n</div>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/signature.tpl.html",'<input type="hidden" validation="{{validators}}" name="{{::name}}" ng-model="$parent.$parent.inputModel" ng-required="{{required}}" />\n<div class="signature-frame">\n    <div class="canvas-frame">\n        <canvas md-signature ng-model="$parent.$parent.inputModel" disabled="disabled" md-actions="{{actions}}"></canvas>\n        <div class="sign-line"></div>\n    </div>\n    <div class="controls">\n        <button class="btn btn-default" ng-click="$parent.$parent.inputModel = undefined;" ng-disabled="disabled">{{ \'Clear signature\' | translate }}</button>\n    </div>\n</div>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/slider.tpl.html",'<md-slider name="name"\n           model="$parent.$parent.inputModel"\n           required="required"\n           disabled="disabled"\n           validators="{{validators}}"\n           min="{{min}}"\n           max="{{max}}"\n           step="{{step}}"\n           actions="actions">\n</md-slider>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/smiley.tpl.html",'\n<div class="smiley-container">\n    <a href="javascript:void(0)" class="smile" ng-class="{\'active\': ($parent.$parent.inputModel == true)}" ng-click="$parent.$parent.inputModel = true; $parent.$parent.updateStore(true)"><span class="icon icon-smile"></span></a>\n    <a href="javascript:void(0)" class="frown" ng-class="{\'active\': ($parent.$parent.inputModel == false)}" ng-click="$parent.$parent.inputModel = false; $parent.$parent.updateStore(false)"><span class="icon icon-sad"></span></a>\n</div>\n<input type="hidden" validation="{{validators}}" name="{{::name}}" ng-model="$parent.$parent.inputModel" ng-required="{{required}}" />\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/switch.tpl.html",'<div class="switch-container">\n\n    <span class="switch-text on">\n        <span ng-show="$parent.$parent.inputModel === true">{{ onText | translate }}</span>\n    </span>\n\n    <span class="switch"\n          ng-class="{ checked: $parent.$parent.inputModel, disabled: disabled }"\n          id="{{::name}}"\n          name="{{::name}}">\n\n        <small></small>\n\n        <input type="checkbox"\n               name="{{::name}}"\n               ng-disabled="disabled"\n               ng-model="$parent.$parent.inputModel"\n               md-actions="{{actions}}"\n               validation="{{validators}}"\n               ng-required="{{required}}"\n               style="width: 100%; height: 100%; margin: 0; opacity: 0; cursor: pointer;"\n               class="ng-pristine ng-untouched ng-valid"\n               ng-hide="disabled"\n               ng-model-options="{ debounce: 0, allowInvalid: true }" />\n\n    </span>\n\n    <span class="switch-text off">\n        <span ng-show="$parent.$parent.inputModel !== true">{{ offText | translate }}</span>\n    </span>\n\n</div>')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/text.tpl.html",'<div ng-switch="multi">\n    <div ng-switch-when="false" ng-class="{\'input-group\': (leftIcon || rightIcon)}">\n        <div class="input-group-addon" ng-if="leftIcon"><span class="fa {{::leftIcon}}"></span></div>\n        <input type="text" validation="{{validators}}" md-actions="{{actions}}" class="form-control" id="{{::name}}" name="{{::name}}" maxlength="{{::maxlength || undefined}}" placeholder="{{::placeholder | translate}}" ng-required="{{required}}" ng-disabled="disabled" ng-model="$parent.$parent.$parent.inputModel" ng-model-options="{debounce: { \'default\': debounce, \'blur\': 0 }}" />\n        <div class="input-group-addon" ng-if="rightIcon"><span class="fa {{::rightIcon}}"></span></div>\n    </div>\n    <textarea ng-switch-when="true" class="form-control" validation="{{validators}}" md-actions="{{actions}}" id="{{::name}}" name="{{::name}}" maxlength="{{::maxlength || undefined}}" ng-attr-placeholder="{{::placeholder | translate}}" ng-required="{{required}}" ng-disabled="disabled" ng-model="$parent.$parent.$parent.inputModel" rows="3" ng-model-options="{debounce: { \'default\': debounce, \'blur\': 0 }}"></textarea>\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("components/mdDynamicForm/fields/templates/time.tpl.html",'<div ng-class="{\'input-group\': (leftIcon || rightIcon)}" id="{{::name}}">\n    <div class="input-group-addon" ng-if="leftIcon"><span class="fa {{::leftIcon}}"></span></div>\n    <input type="text" pick-a-time="$parent.$parent.inputModel" pick-a-time-options="options" md-actions="{{actions}}" placeholder="{{::placeholder || \'--\' | translate}}" class="form-control" ng-disabled="disabled" />\n    <div class="input-group-addon" ng-if="rightIcon"><span class="fa {{::rightIcon}}"></span></div>\n</div>\n<input type="hidden" name="{{::name}}" validation="{{validators}}" ng-required="{{required}}" ng-model="$parent.$parent.inputModel" />\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("bower_components/angular-strap/src/aside/aside.tpl.html",'<div class="aside" tabindex="-1" role="dialog">\n  <div class="aside-dialog">\n    <div class="aside-content">\n      <div class="aside-header" ng-show="title">\n        <button type="button" class="close" ng-click="$hide()">&times;</button>\n        <h4 class="aside-title" ng-bind="title"></h4>\n      </div>\n      <div class="aside-body" ng-bind="content"></div>\n      <div class="aside-footer">\n        <button type="button" class="btn btn-default" ng-click="$hide()">Close</button>\n      </div>\n    </div>\n  </div>\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("bower_components/angular-strap/src/alert/alert.tpl.html",'<div class="alert" ng-class="[type ? \'alert-\' + type : null]">\n  <button type="button" class="close" ng-if="dismissable" ng-click="$hide()">&times;</button>\n  <strong ng-bind="title"></strong>&nbsp;<span ng-bind-html="content"></span>\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("bower_components/angular-strap/src/datepicker/datepicker.tpl.html",'<div class="dropdown-menu datepicker" ng-class="\'datepicker-mode-\' + $mode" style="max-width: 320px;">\n<table style="table-layout: fixed; height: 100%; width: 100%;">\n  <thead>\n    <tr class="text-center">\n      <th>\n        <button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$selectPane(-1)">\n          <i class="{{$iconLeft}}"></i>\n        </button>\n      </th>\n      <th colspan="{{ rows[0].length - 2 }}">\n        <button tabindex="-1" type="button" class="btn btn-default btn-block text-strong"  ng-click="$toggleMode()">\n          <strong style="text-transform: capitalize;" ng-bind="title"></strong>\n        </button>\n      </th>\n      <th>\n        <button tabindex="-1" type="button" class="btn btn-default pull-right" ng-click="$selectPane(+1)">\n          <i class="{{$iconRight}}"></i>\n        </button>\n      </th>\n    </tr>\n    <tr ng-show="showLabels" ng-bind-html="labels"></tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="(i, row) in rows" height="{{ 100 / rows.length }}%">\n      <td class="text-center" ng-repeat="(j, el) in row">\n        <button tabindex="-1" type="button" class="btn btn-default" style="width: 100%" ng-class="{\'btn-primary\': el.selected, \'btn-info btn-today\': el.isToday && !el.selected}" ng-click="$select(el.date)" ng-disabled="el.disabled">\n          <span ng-class="{\'text-muted\': el.muted}" ng-bind="el.label"></span>\n        </button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("bower_components/angular-strap/src/dropdown/dropdown.tpl.html",'<ul tabindex="-1" class="dropdown-menu" role="menu">\n  <li role="presentation" ng-class="{divider: item.divider}" ng-repeat="item in content" >\n    <a role="menuitem" tabindex="-1" ng-href="{{item.href}}" ng-if="!item.divider && item.href" target="{{item.target || \'\'}}" ng-bind="item.text"></a>\n    <a role="menuitem" tabindex="-1" href="javascript:void(0)" ng-if="!item.divider && item.click" ng-click="$eval(item.click);$hide()" ng-bind="item.text"></a>\n  </li>\n</ul>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("bower_components/angular-strap/src/modal/modal.tpl.html",'<div class="modal" tabindex="-1" role="dialog">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header" ng-show="title">\n        <button type="button" class="close" ng-click="$hide()">&times;</button>\n        <h4 class="modal-title" ng-bind="title"></h4>\n      </div>\n      <div class="modal-body" ng-bind="content"></div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-default" ng-click="$hide()">Close</button>\n      </div>\n    </div>\n  </div>\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("bower_components/angular-strap/src/popover/popover.tpl.html",'<div class="popover">\n  <div class="arrow"></div>\n  <h3 class="popover-title" ng-bind="title" ng-show="title"></h3>\n  <div class="popover-content" ng-bind="content"></div>\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("bower_components/angular-strap/src/select/select.tpl.html",'<ul tabindex="-1" class="select dropdown-menu" ng-show="$isVisible()" role="select">\n  <li ng-if="$showAllNoneButtons">\n    <div class="btn-group" style="margin-bottom: 5px; margin-left: 5px">\n      <button class="btn btn-default btn-xs" ng-click="$selectAll()">All</button>\n      <button class="btn btn-default btn-xs" ng-click="$selectNone()">None</button>\n    </div>\n  </li>\n  <li role="presentation" ng-repeat="match in $matches" ng-class="{active: $isActive($index)}">\n    <a style="cursor: default;" role="menuitem" tabindex="-1" ng-click="$select($index, $event)">\n      <i class="{{$iconCheckmark}} pull-right" ng-if="$isMultiple && $isActive($index)"></i>\n      <span ng-bind="match.label"></span>\n    </a>\n  </li>\n</ul>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("bower_components/angular-strap/src/tab/tab.tpl.html",'<ul class="nav" ng-class="$navClass" role="tablist">\n  <li ng-repeat="$pane in $panes track by $index" ng-class="$index == $panes.$active ? $activeClass : \'\'">\n    <a role="tab" data-toggle="tab" ng-click="$setActive($index)" data-index="{{ $index }}" ng-bind-html="$pane.title"></a>\n  </li>\n</ul>\n<div ng-transclude class="tab-content">\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("bower_components/angular-strap/src/timepicker/timepicker.tpl.html",'<div class="dropdown-menu timepicker" style="min-width: 0px;width: auto;">\n<table height="100%">\n  <thead>\n    <tr class="text-center">\n      <th>\n        <button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(-1, 0)">\n          <i class="{{ $iconUp }}"></i>\n        </button>\n      </th>\n      <th>\n        &nbsp;\n      </th>\n      <th>\n        <button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(-1, 1)">\n          <i class="{{ $iconUp }}"></i>\n        </button>\n      </th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="(i, row) in rows">\n      <td class="text-center">\n        <button tabindex="-1" style="width: 100%" type="button" class="btn btn-default" ng-class="{\'btn-primary\': row[0].selected}" ng-click="$select(row[0].date, 0)" ng-disabled="row[0].disabled">\n          <span ng-class="{\'text-muted\': row[0].muted}" ng-bind="row[0].label"></span>\n        </button>\n      </td>\n      <td>\n        <span ng-bind="i == midIndex ? timeSeparator : \' \'"></span>\n      </td>\n      <td class="text-center">\n        <button tabindex="-1" ng-if="row[1].date" style="width: 100%" type="button" class="btn btn-default" ng-class="{\'btn-primary\': row[1].selected}" ng-click="$select(row[1].date, 1)" ng-disabled="row[1].disabled">\n          <span ng-class="{\'text-muted\': row[1].muted}" ng-bind="row[1].label"></span>\n        </button>\n      </td>\n      <td ng-if="showAM">\n        &nbsp;\n      </td>\n      <td ng-if="showAM">\n        <button tabindex="-1" ng-show="i == midIndex - !isAM * 1" style="width: 100%" type="button" ng-class="{\'btn-primary\': !!isAM}" class="btn btn-default" ng-click="$switchMeridian()" ng-disabled="el.disabled">AM</button>\n        <button tabindex="-1" ng-show="i == midIndex + 1 - !isAM * 1" style="width: 100%" type="button" ng-class="{\'btn-primary\': !isAM}" class="btn btn-default" ng-click="$switchMeridian()" ng-disabled="el.disabled">PM</button>\n      </td>\n    </tr>\n  </tbody>\n  <tfoot>\n    <tr class="text-center">\n      <th>\n        <button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(1, 0)">\n          <i class="{{ $iconDown }}"></i>\n        </button>\n      </th>\n      <th>\n        &nbsp;\n      </th>\n      <th>\n        <button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(1, 1)">\n          <i class="{{ $iconDown }}"></i>\n        </button>\n      </th>\n    </tr>\n  </tfoot>\n</table>\n</div>\n');
}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("bower_components/angular-strap/src/tooltip/tooltip.tpl.html",'<div class="tooltip in" ng-show="title">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" ng-bind="title"></div>\n</div>\n')}])}(),function(e){try{e=angular.module("app.templates")}catch(t){e=angular.module("app.templates",[])}e.run(["$templateCache",function(e){e.put("bower_components/angular-strap/src/typeahead/typeahead.tpl.html",'<ul tabindex="-1" class="typeahead dropdown-menu" ng-show="$isVisible()" role="select">\n  <li role="presentation" ng-repeat="match in $matches" ng-class="{active: $index == $activeIndex}">\n    <a role="menuitem" tabindex="-1" ng-click="$select($index, $event)" ng-bind="match.label"></a>\n  </li>\n</ul>\n')}])}();