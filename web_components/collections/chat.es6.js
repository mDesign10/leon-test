!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=105)}([function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});var i=n(118);t.AppMode=i.AppMode;var o=n(59);t.Alert=o.Alert,t.DefaultAlerts=o.DefaultAlerts;var s=n(122);t.ButtonType=s.ButtonType;var r=n(123);t.ChatEntry=r.ChatEntry;var a=n(124);t.ChatEntryType=a.ChatEntryType;var l=n(125);t.ChatMessage=l.ChatMessage;var c=n(126);t.ChatMessageMarker=c.ChatMessageMarker;var d=n(127);t.ChatMessageAttachment=d.ChatMessageAttachment;var h=n(128);t.ChatMetaActivity=h.ChatMetaActivity;var u=n(129);t.ChatRole=u.ChatRole;var p=n(130);t.ConnectionStatus=p.ConnectionStatus;var g=n(131);t.DisconnectionStatus=g.DisconnectionStatus;var m=n(60);t.Icons=m.Icons,t.IconCollection=m.IconCollection,t.IconDefinition=m.IconDefinition;var f=n(132);t.RoomRole=f.RoomRole;var _=n(133);t.BaseUser=_.BaseUser;var v=n(134);t.XmppContact=v.XmppContact;var y=n(135);t.UserAdditionalDetailsType=y.UserAdditionalDetailsType;var C=n(136);t.BotResponse=C.BotResponse;var w=n(137);t.IQRequest=w.IQRequest;var b=n(138);t.IQResponse=b.IQResponse;var E=n(139);t.PushNotificationRegistrationDetails=E.PushNotificationRegistrationDetails},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});var i=n(107);t.BaseLayer=i.BaseLayer,t.BaseLayerComponentInterface=i.BaseLayerComponentInterface;var o=n(38);t.CTBaseComponent=o.CTBaseComponent;var s=n(152);t.CTLayerComponent=s.CTLayerComponent;var r=n(153);t.NullableNumber=r.NullableNumber,t.Stroolean=r.Stroolean;var a=n(42);t.prop=a.prop;var l=n(19);t.Logger=l.Logger;var c=n(154);t.JSXElement=c.JSXElement},function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n=function(e,t){var n=e[1]||"",i=e[3];if(!i)return n;if(t&&"function"==typeof btoa){var o=function(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}(i),s=i.sources.map(function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"});return[n].concat(s).concat([o]).join("\n")}return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var i={},o=0;o<this.length;o++){var s=this[o][0];"number"==typeof s&&(i[s]=!0)}for(o=0;o<e.length;o++){var r=e[o];"number"==typeof r[0]&&i[r[0]]||(n&&!r[2]?r[2]=n:n&&(r[2]="("+r[2]+") and ("+n+")"),t.push(r))}},t}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(41),s=n(5);class r extends o.BaseHandler{constructor(e){super(e)}callHandleMessage(e){return i(this,void 0,void 0,function*(){this._ensureValidVersion(e),yield this.handleMessage(e),yield this.layer.updateLatestIdentifier(e)})}callHandleMessageUpdate(e){return i(this,void 0,void 0,function*(){this._ensureValidVersion(e),yield this.handleMessageUpdate(e),yield this.layer.updateLatestIdentifier(e)})}handleConversationNotFound(e,t){}isMamMessage(e){return!0===e.fromMam}isInjectedMessage(e){return!0===e.injected}isPlaceholderMessage(e){return!0===e.placeholder}_ensureValidVersion(e){const t=s.getMessageType(e);if(t===o.BaseMessageType.XmppChat)return;const n=e.data[t];if((n&&n.version||1)>r.VERSION){const i=`Invalid message version ${n.version} for message "${t}" - expected ${r.VERSION}`;throw this.layer.logger.error(i,e),new Error(i)}}}r.VERSION=1,t.BaseChatHandler=r},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(181),o=n(182),s=n(183),r=n(185),a=n(186),l=n(187),c=n(188),d=n(189),h=n(190),u=n(70),p=n(71),g=n(72),m=n(191),f=n(201),_=n(73),v=n(74),y=n(75),C=n(76),w=n(77),b=n(202),E=n(203),T=n(204),R=n(205),I=n(206),A=n(207),S=n(208),x=n(209),O=n(210),M=n(211),L=n(212),N=n(213),D=n(214),P=n(215),k=n(216),U=n(222),j=n(223),F=n(224),B=n(225),G=n(226),H=n(227),q=n(228),$=n(229),z=n(230),V=n(231),W=n(232),J=n(233),K=n(234),Y=n(235);var X=n(237);t.ChatMessageToChatEntryConverter=X.ChatMessageToChatEntryConverter;var Q=n(69);t.ChatMessageType=Q.ChatMessageType;var Z=n(70);t.AddParticipantsData=Z.AddParticipantsData;var ee=n(71);t.ChangeParticipantRoleData=ee.ChangeParticipantRoleData;var te=n(72);t.CreateConversationData=te.CreateConversationData;var ne=n(73);t.EndConversationData=ne.EndConversationData;var ie=n(74);t.FetchConversationsData=ie.FetchConversationsData;var oe=n(75);t.LeaveConversationData=oe.LeaveConversationData;var se=n(76);t.RemoveParticipantsData=se.RemoveParticipantsData;var re=n(77);t.UpdateConversationData=re.UpdateConversationData,t.get=function(e){return[new o.AutoReconnectedHandler(e),new l.CommsConnectionHandler(e),new i.AttachmentDownloadedHandler(e),new s.RaiseDeviceNotificationHandler(e),new v.FetchConversationsHandler(e),new g.CreateConversationHandler(e),new w.UpdateConversationHandler(e),new u.AddParticipantsHandler(e),new C.RemoveParticipantsHandler(e),new p.ChangeParticipantRoleHandler(e),new m.GetDelegateAccountListHandler(e),new m.AcquireDelegationHandler(e),new m.GiveDelegationHandler(e),new m.RelinquishDelegationHandler(e),new m.TakeDelegationHandler(e),new m.AssignDelegationHandler(e),new m.ReleaseDelegationHandler(e),new m.TransferDelegationHandler(e),new y.LeaveConversationHandler(e),new _.EndConversationHandler(e),new r.ReceivedConversationHandler(e),new h.AcknowledgeConversationHandler(e),new f.DeleteDirectConversationHandler(e),new k.CreateRoleHandler(e),new k.DeleteRoleHandler(e),new k.ModifyRoleHandler(e),new k.ModifyRoleAclHandler(e),new U.QueryRolesHandler(e),new B.GetGroupHandler(e),new G.QueryGroupsHandler(e),new H.CreateGroupHandler(e),new q.DeleteGroupHandler(e),new $.UpdateGroupHandler(e),new z.QueryGroupMembersHandler(e),new V.AddGroupMembersHandler(e),new W.RemoveGroupMembersHandler(e),new J.AddGroupChildHandler(e),new K.RemoveGroupChildHandler(e),new $.UpdateGroupHandler(e),new j.GetRoleHandler(e),new F.SetRolePermissionHandler(e),new Y.SetUsersInactiveHandler(e),new b.ChatMessageHandler(e),new T.ConversationStartedHandler(e),new R.ConversationUpdatedHandler(e),new A.ParticipantAddedHandler(e),new x.ParticipantRemovedHandler(e),new O.ParticipantRoleChangedHandler(e),new S.ParticipantLeftHandler(e),new E.ConversationEndedHandler(e),new a.ParticipantReceivedHandler(e),new I.ParticipantAcknowledgedHandler(e),new M.UserAddedHandler(e),new P.UserRemovedHandler(e),new D.UserLeftHandler(e),new L.UserConversationEndedHandler(e),new N.UserDeleteDirectConversationHandler(e),new d.ChatEntryEventHandler(e),new c.DelegationUpdateHandler(e)]}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(115),s=n(116),r=n(41),a=n(20);var l;function c(e){const n=(new t.safeMoment).startOf("day");return new t.safeMoment(e).startOf("day").diff(n,"days")}function d(e,n=null){const i=c(e);if(0===i||-1===i){const e=0===i?a.CommonI18nKeys.TODAY:a.CommonI18nKeys.YESTERDAY;return n&&n.translateI18nItem(a.CommonMetadata.getI18nItem(e))||e.toString()}return t.safeMoment(e).format("L")}function h(e,n=!1){const i=n?"LTS":"LT";return t.safeMoment(e).format(i)}function u(e){return e.map(e=>e instanceof Array?u(e):"object"==typeof e?Object.assign({},e):e)}function p(e){return null===e?null:void 0!==e?"object"!=typeof e?e:JSON.parse(JSON.stringify(e)):void 0}function g(e){return e&&"object"==typeof e&&!Array.isArray(e)}function m(e){if("data"in e&&"object"==typeof e.data){const t=Object.keys(e.data).filter(e=>"$attributes"!==e);if(t.length>0)return t[0]}return r.BaseMessageType.XmppChat}function f(e,t){const n=p(e);return n.data&&"string"==typeof n.data[t.toString()]&&(n.data[t.toString()]=JSON.parse(n.data[t.toString()])),n}!function(e){e[e.PREFIX_INITIAL_LAST=0]="PREFIX_INITIAL_LAST",e[e.PREFIX_FIRST_LAST=1]="PREFIX_FIRST_LAST"}(l=t.NameFormat||(t.NameFormat={})),t.safeMoment=o,t.setLocale=function(e){t.safeMoment.locale(e)},t.isDesktop=function(){return void 0===window.orientation},t.isMobile=function(){return void 0!==window.orientation},t.isAndroid=function(){const e=window;return e.device&&e.device.platform?"android"===e.device.platform.toLowerCase():!!e.cti&&"android"===e.cti.store.env.platform.name},t.isIos=function(){const e=window;return e.device&&e.device.platform?"ios"===e.device.platform.toLowerCase():!!e.cti&&"ios"===e.cti.store.env.platform.name},t.normalizeLocalFilePaths=function(e){return window.Ionic&&window.Ionic.normalizeURL?window.Ionic.normalizeURL(e):e},t.padLeft=function(e,t,n=" "){let i=e;const o=t-e.length;return o>0&&(i=Array(o+1).join(n)+i),i},t.generateRandomSixString=function(){let e=46656*Math.random()|0,t=46656*Math.random()|0;return(e=("000"+e.toString(36)).slice(-3))+(t=("000"+t.toString(36)).slice(-3))},t.tokenReplace=function(e,t){return e?void 0===t||null===t?e:-1===e.indexOf("${")?e:e.replace(/\${([^{}]*)}/g,(e,n)=>{const i=((e,t)=>{const n=t.split(".");do{}while(n.length&&(e=e[n.shift()]));return e})(t,n);return"string"==typeof i||"number"==typeof i?i:e}):""},t.jidsMatch=function(e,t,n=!1){return n||(e=(e||"").toLowerCase(),t=(t||"").toLowerCase()),e===t},t.formatDate=function(e,t){return null===e||void 0===e?"":o(e).format(t)},t.formatDateForTimeOrDate=function(e,t=!1,n=!1,i=null){if(null===e||void 0===e)return"";if(0===c(e)){let o="";if(t){const e=a.CommonI18nKeys.TODAY;o=i&&i.translateI18nItem(a.CommonMetadata.getI18nItem(e))||e.toString()}return(t&&`${o}, `||"")+h(e,n)}return`${d(e,i)} ${h(e,n)}`},t.daysFromNow=c,t.getFriendlyDate=d,t.getFriendlyTime=h,t.getTwentyFourHoursTime=function(e){return t.safeMoment(e).format("HH:mm")},t.prettyDuration=function(e){if(e<1e3)return"< 1s";const t=Math.trunc(e/1e3);if(t<60)return`${t}s`;const n=Math.trunc(e/1e3/60),i=Math.trunc((e-60*n*1e3)/1e3);if(n<60)return`${n}m`+(i&&` ${i}s`||"");const o=Math.trunc(e/1e3/60/60),s=Math.trunc((e-60*o*60*1e3)/1e3/60);return o<24?`${o}h`+(s&&` ${s}m`||""):`${Math.trunc(e/1e3/60/60/24)} days`},t.formatUserName=function(e,t){if(!e)return"";switch(t){case l.PREFIX_INITIAL_LAST:return`${e.prefix||""} ${(e.firstName||"").substr(0,1)} ${e.lastName||""}`.trim()||e.username||e.jid||"";case l.PREFIX_FIRST_LAST:return`${e.prefix||""} ${e.firstName||""} ${e.lastName||""}`.trim()||e.username||e.jid||""}},t.sortUsersByName=function(e){return u(e).sort((e,t)=>{const n=e.lastName||"",i=t.lastName||"",o=n.localeCompare(i);if(0!==o)return o;const s=e.firstName||"",r=t.firstName||"";return s.localeCompare(r)})},t.sortUserListItems=function(e){let t=u(e);return t=(t=t.sort((e,t)=>{if(e.isGroup||t.isGroup)return 1;const n=e.userLastName||"",i=t.userLastName||"",o=n.localeCompare(i);if(0!==o)return o;const s=e.userFirstName||"",r=t.userFirstName||"";return s.localeCompare(r)})).sort((e,t)=>{const n=e.displayName,i=t.displayName;return n.localeCompare(i)}),e},t.enumFromString=function(e){return e||null},t.deepCloneArray=u,t.uniqueArrayItems=function(e,t=(e=>e)){const n=[],i=[];return e.forEach(e=>{const o=t(e);n.includes(o)||(n.push(o),i.push(e))}),i},t.groupArrayItemsByKey=function(e,t=(e=>e)){return e.reduce((e,n)=>{const i=t(n);let o=null;return e[i]?o=e[i]:(o=[],e[i]=o),o.push(n),e},{})},t.deepCloneObject=p,t.isObject=g,t.mergeDeep=function e(t,...n){if(!n.length)return t;const i=n.shift();if(g(t)&&g(i))for(const o in i)g(i[o])?(t[o]||Object.assign(t,{[o]:{}}),e(t[o],i[o])):Object.assign(t,{[o]:i[o]});return e(t,...n)},t.getMessageType=m,t.parseMessagePayload=f,t.getMessageContentForDebug=function(e){const t=m(e);if(null===t)return"";if(t===r.BaseMessageType.XmppChat)return{[t]:{body:e.body,attachments:e.attachments}};if(e.data&&t in e.data)return{[t]:f(e,t).data[t]};return""},t.getUsernameFromJid=function(e){return e.indexOf("@")>-1?e.substring(0,e.indexOf("@")):e},t.findRoomJidInMessage=function(e,t){const n=["recipient_id","sender_id","jid"];for(let i=0;i<n.length;i++){const o=n[i];if(e[o]){const n=(e[o]||"").toString().toLowerCase().split("/")[0];if(n.endsWith(t.toLowerCase()))return n}}return null},t.validateVCardObject=function(e){return e&&Object.keys(e).length>0},t.randomNumberBetween=function(e,t){return Math.floor(Math.random()*t)+e},t.sleep=function(e){return i(this,void 0,void 0,function*(){return new Promise(t=>{setTimeout(t,e)})})},t.getDiffs=function(e,t){return void 0===e||void 0===t?[]:s.default(e,t).map(e=>{const t=e.path.reduce((e,t)=>"number"==typeof t?`${e}[${t}]`:`${e}.${t}`,"").replace(".","");if("_id"===t||"_rev"===t)return null;let n="",i=!1,o=!1,s=null,r=null;return"A"===e.kind&&"N"===e.item.kind?(n=`ADDED [${e.index}]`,i=!0,r=e.item.rhs):"A"===e.kind&&"D"===e.item.kind?(n=`DELETED [${e.index}]`,o=!0,r=e.item.lhs):"N"===e.kind?(n="ADDED",i=!0,r=e.rhs):"D"===e.kind?(n="DELETED",o=!0,r=e.lhs):(n="EDITED",s=e.lhs,r=e.rhs),{type:n,added:i,deleted:o,path:t,lhs:s,rhs:r}}).filter(e=>null!==e)},t.getCSSVariable=function(e){const t=getComputedStyle(document.body).getPropertyValue(e);return t?t.trim():t}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(14);var o=n(141);t.AttachmentDownloadComplete=o.AttachmentDownloadComplete;var s=n(142);t.AudioAttachmentDownloadComplete=s.AudioAttachmentDownloadComplete;var r=n(61);t.ChatEntryEventArgs=r.ChatEntryEventArgs;var a=n(143);t.ChatNotificationEventArgs=a.ChatNotificationEventArgs;var l=n(63);t.ConversationEventArgs=l.ConversationEventArgs;var c=n(144);t.ConversationParticiantRoleEventArgs=c.ConversationParticiantRoleEventArgs;var d=n(145);t.ConversationParticiantsEventArgs=d.ConversationParticiantsEventArgs;var h=n(146);t.DelegateManagementEventArgs=h.DelegateManagementEventArgs;var u=n(147);t.ForceQuitConversationEventArgs=u.ForceQuitConversationEventArgs;class p extends i.BaseEvents{}p.ConversationAdded="conversation-added",p.ConversationUpdated="conversation-updated",p.ConversationClosed="conversation-closed",p.ConversationRemoved="conversation-removed",p.ConversationDeleted="conversation-deleted",p.ConversationPurged="conversation-purged",p.ConversationEnded="conversation-ended",p.ConversationParticipantsChanged="conversation-participants-changed",p.ForceQuitConversation="force-quit-conversation",p.ForceCloseConversation="force-close-conversation",p.CurrentConversationChanged="current-conversation-changed",p.ChatEntryReceived="chat-entry-received",p.ChatEntryReceivedInWorkspace="chat-entry-received-in-workspace",p.ChatEntryUpdated="chat-entry-updated",p.ChatEntriesFetched="chat-entries-fetched",p.ThumbnailLoaded="thumbnail-loaded",p.ChatNotification="chat-notification",p.PriorityConversationNotification="priority-conversation-notification",p.PriorityConversationAcknowledged="priority-conversation-acknowledged",p.PriorityConversationAcknowledgedOnAnotherDevice="priority-conversation-acknowledged-on-another-device",p.MuteAlertToPlayOtherAudio="mute-alert-to-play-other-audio",p.ResumeAlertAfterPlayingAudio="resume-alert-after-playing-audio",p.AudioAttachmentDownloadComplete="audio-attachment-download-complete",p.RemotelyStartAudioPlayer="remotely-start-audio-player",p.RemotelyStopAudioPlayer="remotely-stop-audio-player",p.AudioRecordingStarted="audio-recording-started",p.AudioRecordingStopped="audio-recording-stopped",p.AttachmentDownloadComplete="attachment-download-complete",p.AttachmentDownloadFailed="attachment-download-failed",p.AttachmentPlayed="attachment-played",p.AutoReconnected="auto-reconnected",p.PostLoginComplete="post-login-complete",p.Mute="mute",p.MessageProcessorQueueEmpty="message-processor-queue-empty",p.OpenAccountsMenu="open-accounts-menu",p.CloseAccountsMenu="close-accounts-menu",p.OpenDelegateAccountList="open-delegate-account-menu",p.CloseDelegateAccountList="close-delegate-account-menu",p.OpenDelegateManagement="open-delegate-management",p.CloseDelegateManagement="close-delegate-management",p.RefreshDelegateAccountsList="refresh-delegate-accounts-list",p.WorkspaceUserChanged="workspace-user-changed",p.DelegationRemoved="delegation-removed",p.DelegatationRelinquish="delegation-relinquish",p.UnableToAcquireRole="unable-to-acquire-role",p.UnableToTakeRole="unable-to-take-role",p.FetchedDelegateAccounts="fetched-delegate-accounts",p.ActionSheetToggle="action-sheet-toggle",p.OpenRoleAdmin="open-role-admin",p.OpenUserAdmin="open-user-admin",p.CloseRoleAdmin="close-role-admin",p.CloseUserAdmin="close-user-admin",p.OpenAddRole="open-add-role",p.CloseAddRole="close-add-role",p.RefreshRoleAdminList="refresh-role-admin-list",p.RefreshRole="refresh-role",p.CloseRoleDetail="close-role-detail",p.OpenGroupAdmin="open-group-admin",p.CloseGroupAdmin="close-group-admin",p.OpenAddGroup="open-add-group",p.CloseAddGroup="close-add-group",p.RefreshGroupAdminList="refresh-group-admin-list",p.RefreshGroup="refresh-group",p.CloseGroupDetail="close-group-detail",t.ChatEvents=p},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(17);var o;!function(e){e[e.FETCHING_OWN_DATA="Fetching personal data..."]="FETCHING_OWN_DATA",e[e.UPDATING_CONTACTS="Updating contacts..."]="UPDATING_CONTACTS",e[e.FETCHING_CONVERSATIONS="Fetching conversations..."]="FETCHING_CONVERSATIONS",e[e.REMOVED_TITLE="Removed from conversation"]="REMOVED_TITLE",e[e.REMOVED_MESSAGE='You were removed from the conversation "{{subject}}"']="REMOVED_MESSAGE",e[e.ENDED_TITLE="Conversation closed"]="ENDED_TITLE",e[e.ENDED_MESSAGE='The conversation "{{subject}}" has been closed']="ENDED_MESSAGE",e[e.ERROR_GENERIC_MESSAGE="Unable to perform action"]="ERROR_GENERIC_MESSAGE",e[e.ERROR_SAVING_CHANGES_TITLE="Error saving changes"]="ERROR_SAVING_CHANGES_TITLE",e[e.ERROR_SAVING_CHANGES_MESSAGE="There was an error saving changes"]="ERROR_SAVING_CHANGES_MESSAGE",e[e.ERROR_CREATING_CONVERSATION_TITLE="Unable to create conversation"]="ERROR_CREATING_CONVERSATION_TITLE",e[e.ERROR_UPDATING_CONVERSATION_TITLE="Unable to update details"]="ERROR_UPDATING_CONVERSATION_TITLE",e[e.ERROR_ADDING_PARTICIPANTS_TITLE="Unable to add participants"]="ERROR_ADDING_PARTICIPANTS_TITLE",e[e.ERROR_REMOVING_PARTICIPANTS_TITLE="Unable to remove participants"]="ERROR_REMOVING_PARTICIPANTS_TITLE",e[e.ERROR_CHANGING_PARTICIPANT_ROLE_TITLE="Unable to change role"]="ERROR_CHANGING_PARTICIPANT_ROLE_TITLE",e[e.ERROR_LEAVING_CONVERSATION_TITLE="Unable to leave conversation"]="ERROR_LEAVING_CONVERSATION_TITLE",e[e.ERROR_ENDING_CONVERSATION_TITLE="Unable to end conversation"]="ERROR_ENDING_CONVERSATION_TITLE",e[e.ERROR_RECEIVING_CONVERSATION="Unable to mark conversation as received"]="ERROR_RECEIVING_CONVERSATION",e[e.ERROR_ACKNOWLEDGING_CONVERSATION="Unable to acknowledge conversation"]="ERROR_ACKNOWLEDGING_CONVERSATION",e[e.ERROR_DELETING_DIRECT_CONVERSATION="Unable to delete this conversation"]="ERROR_DELETING_DIRECT_CONVERSATION",e[e.ERROR_FETCHING_DELEGATE_ACCOUNTS="Unable to get delegate accounts"]="ERROR_FETCHING_DELEGATE_ACCOUNTS",e[e.ERROR_ACQUIRING_DELEGATE_ACCOUNT="Unable to acquire delegate account"]="ERROR_ACQUIRING_DELEGATE_ACCOUNT",e[e.ERROR_GIVING_DELEGATE_ACCOUNT="Unable to give delegate account"]="ERROR_GIVING_DELEGATE_ACCOUNT",e[e.ERROR_TAKING_DELEGATE_ACCOUNT="Unable to take delegate account"]="ERROR_TAKING_DELEGATE_ACCOUNT",e[e.ERROR_RELINQUISHING_DELEGATE_ACCOUNT="Unable to relinquish delegate account"]="ERROR_RELINQUISHING_DELEGATE_ACCOUNT",e[e.ERROR_ASSIGNING_DELEGATE_ACCOUNT="Unable to assign delegate account"]="ERROR_ASSIGNING_DELEGATE_ACCOUNT",e[e.ERROR_RELEASING_DELEGATE_ACCOUNT="Unable to release delegate account"]="ERROR_RELEASING_DELEGATE_ACCOUNT",e[e.ERROR_TRANSFERING_DELEGATE_ACCOUNT="Unable to transfer delegate account"]="ERROR_TRANSFERING_DELEGATE_ACCOUNT",e[e.ERROR_MODIFYING_ROLE_ACL="Unable to modify role acl"]="ERROR_MODIFYING_ROLE_ACL",e[e.ERROR_CREATING_ROLE="Unable to create role"]="ERROR_CREATING_ROLE",e[e.ERROR_QUERYING_ROLE="Unable to query role information"]="ERROR_QUERYING_ROLE",e[e.ERROR_MODIFYING_ROLE="Unable to modify role"]="ERROR_MODIFYING_ROLE",e[e.ERROR_QUERYING_GROUP="Unable to query group information"]="ERROR_QUERYING_GROUP",e[e.ERROR_CREATING_GROUP="Unable to create group"]="ERROR_CREATING_GROUP",e[e.ERROR_DELEATING_GROUP="Unable to delete group"]="ERROR_DELEATING_GROUP",e[e.ERROR_UPDATING_GROUP="Unable to update group"]="ERROR_UPDATING_GROUP",e[e.ERROR_QUERYING_GROUP_MEMBERS="Unable to query group members"]="ERROR_QUERYING_GROUP_MEMBERS",e[e.ERROR_ADDING_GROUP_MEMBERS="Unable to add members to group"]="ERROR_ADDING_GROUP_MEMBERS",e[e.ERROR_REMOVING_GROUP_MEMBERS="Unable to remove members from group"]="ERROR_REMOVING_GROUP_MEMBERS",e[e.ERROR_GETTING_GROUP="Unable to get group"]="ERROR_GETTING_GROUP",e[e.ERROR_ADDING_GROUP_CHILD="Unable to add group child"]="ERROR_ADDING_GROUP_CHILD",e[e.ERROR_REMOVING_GROUP_CHILD="Unable to remove group child"]="ERROR_REMOVING_GROUP_CHILD",e[e.ERROR_SETTING_PERMISSIONS_ROLE="Unable to set permission."]="ERROR_SETTING_PERMISSIONS_ROLE",e[e.ERROR_DISABLING_USER="Unable to disable user."]="ERROR_DISABLING_USER",e[e.ERROR_GETTING_ROLE="Unable to retrieve role"]="ERROR_GETTING_ROLE",e[e.ERROR_DELEATING_ROLE="Unable to delete role"]="ERROR_DELEATING_ROLE",e[e.ERROR_SETTING_USERS_INACTIVE="Unable to set users inactive"]="ERROR_SETTING_USERS_INACTIVE",e[e.DELEGATE_ACCOUNT_GIVEN_TITLE="Delegation Received"]="DELEGATE_ACCOUNT_GIVEN_TITLE",e[e.DELEGATE_ACCOUNT_GIVEN_MESSAGE="The {{name}} delegated account has been given to you."]="DELEGATE_ACCOUNT_GIVEN_MESSAGE",e[e.DELEGATE_ACCOUNT_TAKEN_TITLE="Delegation Taken"]="DELEGATE_ACCOUNT_TAKEN_TITLE",e[e.DELEGATE_ACCOUNT_TAKEN_MESSAGE="The {{name}} delegated account has been taken from you."]="DELEGATE_ACCOUNT_TAKEN_MESSAGE",e[e.YOU_HAVE_NEW_NOTIFICATIONS="You have new notifications"]="YOU_HAVE_NEW_NOTIFICATIONS",e[e.ATTATCHMENT_RECEIVED="Image"]="ATTATCHMENT_RECEIVED",e[e.START="Started *{{date}}* at *{{time}}* by *{{instigator}}*"]="START",e[e.START_BY_YOU="Started *{{date}}* at *{{time}}* by *you*"]="START_BY_YOU",e[e.UPDATE="*{{instigator}}* updated the conversation details"]="UPDATE",e[e.UPDATE_BY_YOU="*You* updated the conversation details"]="UPDATE_BY_YOU",e[e.ADD="*{{subject}}* was added by *{{instigator}}*"]="ADD",e[e.ADD_YOU="*You* were added by *{{instigator}}*"]="ADD_YOU",e[e.ADD_BY_YOU="*{{subject}}* was added by *you*"]="ADD_BY_YOU",e[e.ACK="*{{instigator}}* responded with: *{{value}}* *{{date}}* at *{{time}}*"]="ACK",e[e.ACK_BY_YOU="You responded with: *{{value}}* *{{date}}* at *{{time}}*"]="ACK_BY_YOU",e[e.CHANGE_ROLE="*{{subject}}* was made *{{data}}* by *{{instigator}}*"]="CHANGE_ROLE",e[e.CHANGE_ROLE_YOU="*You* were made *{{data}}* by *{{instigator}}*"]="CHANGE_ROLE_YOU",e[e.CHANGE_ROLE_BY_YOU="*{{subject}}* was made *{{data}}* by *you*"]="CHANGE_ROLE_BY_YOU",e[e.KICK="*{{subject}}* was removed by *{{instigator}}*"]="KICK",e[e.KICK_YOU="*You* were removed by *{{instigator}}*"]="KICK_YOU",e[e.KICK_BY_YOU="*{{subject}}* was removed by *you*"]="KICK_BY_YOU",e[e.LEFT="*{{instigator}}* left the conversation"]="LEFT",e[e.LEFT_YOU="*You* left the conversation"]="LEFT_YOU",e[e.END="*{{instigator}}* ended the conversation"]="END",e[e.END_YOU="*You* ended the conversation"]="END_YOU",e[e.RECEIVED="*{{instigator}}* received an alert: *{{date}}* at *{{time}}*"]="RECEIVED",e[e.RECEIVED_YOU="You received the alert: *{{date}}* at *{{time}}*"]="RECEIVED_YOU",e[e.PARTICIPANT="participant"]="PARTICIPANT",e[e.ADMINISTRATOR="administrator"]="ADMINISTRATOR",e[e.OWNER="owner"]="OWNER",e[e.CONVERSATION_NO_RESPONSE="No Response"]="CONVERSATION_NO_RESPONSE",e[e.CONVERSATION_UNDELIVERED="Undelivered"]="CONVERSATION_UNDELIVERED",e[e.CONVERSATION_WAITING_FOR_RESPONSE="Waiting for response"]="CONVERSATION_WAITING_FOR_RESPONSE",e[e.CONVERSATION_DELIVERING="Delivering"]="CONVERSATION_DELIVERING"}(o=t.ChatCommonI18nKeys||(t.ChatCommonI18nKeys={})),t.ChatCommonMetadata=new i.Metadata("ChatCommon",o)},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});var i=n(45);t.CTActionSheet=i.CTActionSheet;var o=n(250);t.CTAlertModalManager=o.CTAlertModalManager;var s=n(253);t.CTAlertModal=s.CTAlertModal;var r=n(256);t.CTAvatarTile=r.CTAvatarTile;var a=n(83);t.CTButton=a.CTButton;var l=n(261);t.CTDebugger=l.CTDebugger;var c=n(264);t.CTFilePicker=c.CTFilePicker;var d=n(265);t.CTGrowingTextbox=d.CTGrowingTextbox;var h=n(268);t.CTIcon=h.CTIcon;var u=n(271);t.CTLoginForm=u.CTLoginForm,t.CTLoginFormMetadata=u.CTLoginFormMetadata;var p=n(274);t.CTMenu=p.CTMenu,t.MenuItem=p.MenuItem;var g=n(277);t.CTOnlineIndicator=g.CTOnlineIndicator,t.CTOnlineIndicatorMetadata=g.CTOnlineIndicatorMetadata;var m=n(280);t.CTSelectionList=m.CTSelectionList,t.CTSelectionListItem=m.CTSelectionListItem;var f=n(47);t.CTSelectionTextFilter=f.CTSelectionTextFilter;var _=n(285);t.CTSlidePanel=_.CTSlidePanel;var v=n(288);t.CTTextbox=v.CTTextbox;var y=n(291);t.CTUserAvatar=y.CTUserAvatar;var C=n(294);t.CTUserDisplay=C.CTUserDisplay;var w=n(84);t.CTUserTile=w.CTUserTile;var b=n(301);t.CTRolePermissionsUserTile=b.CTRolePermissionsUserTile;var E=n(304);t.CTTagInput=E.CTTagInput,window.onerror=function(e,t,n,i,o){return console.error(`Unhandled Error: ${e}, (${t}) (${n}:${i})`),console.error(o.stack),!1}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(17);var o;!function(e){e[e.E_IQ_TYPE_INVALID="Unknown request"]="E_IQ_TYPE_INVALID",e[e.E_IQ_SUB_EL_MISSING="Request has missing data"]="E_IQ_SUB_EL_MISSING",e[e.E_IQ_SUB_EL_UNKNOWN="Request has unknown data"]="E_IQ_SUB_EL_UNKNOWN",e[e.E_CONV_NOT_FOUND="The conversation could not be found"]="E_CONV_NOT_FOUND",e[e.E_CONV_TYPE="Unable to perform operation on this type of conversation"]="E_CONV_TYPE",e[e.E_CONV_ROLE="You are not permitted to perform that operation"]="E_CONV_ROLE",e[e.E_CREATION_FAILED="Could not create conversation"]="E_CREATION_FAILED",e[e.E_CREATOR_NOT_PARTICIPANT="Could not create conversation - the creator was not included as a participant"]="E_CREATOR_NOT_PARTICIPANT",e[e.E_PARTICIPANTS_NOT_MEMBERS="Could not create conversation - all participants must be in the participant role"]="E_PARTICIPANTS_NOT_MEMBERS",e[e.E_CONV_SELF="You are not permitted to change your own role"]="E_CONV_SELF",e[e.E_CONV_NO_OWNER="You cannot leave this conversation as you are the only owner"]="E_CONV_NO_OWNER",e[e.E_NO_CONNECTION_DELETING_DIRECT="You cannot delete a direct conversation when you are offline."]="E_NO_CONNECTION_DELETING_DIRECT",e[e.E_ACQUIRE_ERROR="Unable to acquire the delegate account at this time."]="E_ACQUIRE_ERROR",e[e.E_ASSIGN_ERROR="Unable to assign the delegate account at this time."]="E_ASSIGN_ERROR",e[e.E_GIVE_ERROR="Unable to give the delegate account at this time."]="E_GIVE_ERROR",e[e.E_RELEASE_ERROR="Unable to release the delegate account at this time."]="E_RELEASE_ERROR",e[e.E_RELINQUISH_ERROR="Unable to relinquish the delegate account at this time."]="E_RELINQUISH_ERROR",e[e.E_TAKE_ERROR="Unable to take the delegate account at this time."]="E_TAKE_ERROR",e[e.E_TRANSFER_ERROR="Unable to transfer the delegate account at this time."]="E_TRANSFER_ERROR",e[e.E_CHANGING_PARTICIPANT_ROLE_ERROR="Unable to change role at this time."]="E_CHANGING_PARTICIPANT_ROLE_ERROR",e[e.E_CREATING_CONVERSATION_ERROR="Unable to create conversation at this time."]="E_CREATING_CONVERSATION_ERROR",e[e.E_DELETING_DIRECT_CONVERSATION_ERROR="Unable to delete conversation at this time."]="E_DELETING_DIRECT_CONVERSATION_ERROR",e[e.E_ADDING_PARICIPANTS_ERROR="Unable to add participants at this time."]="E_ADDING_PARICIPANTS_ERROR",e[e.E_LEAVING_CONVERSATION_ERROR="Unable to leave conversation at this time."]="E_LEAVING_CONVERSATION_ERROR",e[e.E_ENDING_CONVERSATION_ERROR="Unable to end conversation at this time."]="E_ENDING_CONVERSATION_ERROR",e[e.E_DIRECT_CONVERSATION_EXISTS="A direct conversation between these participants already exists."]="E_DIRECT_CONVERSATION_EXISTS",e[e.E_SET_USERS_INACTIVE_ERROR="Failed setting users inactive"]="E_SET_USERS_INACTIVE_ERROR",e[e.E_UNKNOWN="An unknown error occurred"]="E_UNKNOWN"}(o=t.ChatErrorsI18nKeys||(t.ChatErrorsI18nKeys={})),t.ChatErrorsMetadata=new i.Metadata("ChatErrors",o),t.getErrorMessage=function(e,n){const i=o[e]||o.E_UNKNOWN;return n.translateI18nItem(t.ChatErrorsMetadata.getI18nItem(i))}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */function i(e,t=null){const n={};return e&&(n.$attributes=e),Object.assign({},n,t||{})}Object.defineProperty(t,"__esModule",{value:!0}),t.createIq=function(e,t="urn:commontime:infinity:muc",n){return{[e]:i({xmlns:t},n)}},t.createIqNode=i},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(155));var o=n(156);t.ChatMetaActivityType=o.ChatMetaActivityType;var s=n(157);t.Conversation=s.Conversation,t.ConversationHash=s.ConversationHash,i(n(158));var r=n(159);t.ConversationParticipant=r.ConversationParticipant;var a=n(160);t.ConversationType=a.ConversationType;var l=n(161);t.ConversationUpdateOptions=l.ConversationUpdateOptions,i(n(162));var c=n(163);t.Draft=c.Draft;var d=n(164);t.DraftAttachmentData=d.DraftAttachmentData;var h=n(165);t.Icons=h.Icons,i(n(166));var u=n(169);t.User=u.User,i(n(65))},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});var i=n(240);t.CTCLComponent=i.CTCLComponent},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(241),o=n(66);document.createElement("div");let s=!1;function r(e,t,n){return e?t:n}function a(e){if(!e)return;e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,n,i){return t+t+n+n+i+i});const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function l(e){let t=i(e);return(t=(t=t.replace(/<a[\s]+[^>]*?href[\s]?=[\s\"\']*(.*?)[\"\']*.*?>([^<]+|.*?)?<\/a>/g,"[]($2)")).replace(/(^|\s)(\(*\+*[1-9]{0,3}\)*-*[0-9]{0,3}[-. /]*\(*[1-9]\d{2}\)*[-. /]*\d{3}[-. /]*\d{4})/gm," <a href='javascript:void(0)' onClick=\"window.open('tel:$2', '&#95;system')\">$2</a>")).replace(/&amp;/g,"&")}t.debouncedRequestAnimationFrame=function(e){s||(s=!0,requestAnimationFrame(()=>{s=!1,e()}))},t.renderIf=function(e,t){return r(e,t,null)},t.renderIfElse=r,t.buildStyles=function(e={}){return e},t.hexToRgbaString=function(e){if(!e)return;const t=a(e);return`rgba(${t.r}, ${t.g}, ${t.b}, 1)`},t.decideTextColorFromBgColor=function(e){if(!e)return;const t=a(e);return.299*t.r+.587*t.g+.114*t.b>186?"#000000":"#ffffff"},t.linkifyText=l,t.formatText=function(e){return o.default(l(e),null,{links:!0,images:!1,headings:!1,quotesAndLists:!1})},t.filterUserGroup=function(e){const t=[];for(const n of e.split(","))"_"!==n.trim().charAt(0)&&"#"!==n.trim().charAt(0)&&t.push(n);return t.join(", ")}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});var i=n(31);t.BaseEventArgs=i.BaseEventArgs;var o=n(110);t.CommsEventArgs=o.CommsEventArgs;var s=n(111);t.UserActivityEventArgs=s.UserActivityEventArgs;var r=n(112);t.UserConnectionStatusEventArgs=r.UserConnectionStatusEventArgs;var a=n(113);t.RoomParticipantUpdateEventArgs=a.RoomParticipantUpdateEventArgs;var l=n(114);t.ConnectionStatusEventArgs=l.ConnectionStatusEventArgs;class c{}c._Request_RaiseAlert="request-raise-alert",c._Request_CloseAlert="request-close-alert",c._Request_UpdateUISuppression="request-update-ui-suppression",c._Request_RedrawAllUIs="_request-redraw-all-uis",c._Request_Logout="request-logout",c._Request_Component_Clear_Data="request-component-clear-data",c._Request_ThemeChange="request-theme-change",c.ConnectionStatusChange="connection-status-change",c.OtherUserConnectionStatusChange="other-user-connection-status-change",c.CurrentUserVCardUpdate="current-user-vcard-update",c.AuthenticationCredentialsReset="authentication_credentials-reset",c.RoomParticipantUpdate="room-participant-update",c.UserActivity="user-activity",c.LoginResult="login-result",c.LogoutResult="logout-result",c.LoginFormResult="login-form-result",c.MoveTaskToBack="move-task-to-back",c.AudioLoopingEnd="audio-looping-end",t.BaseEvents=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(17);t.component=function(e){return t=>(customElements.get(e.tag)||customElements.define(e.tag,t),t.prototype.styles=e.styles,e.i18nKeys&&(t.prototype._metadata=new i.Metadata(t.name,e.i18nKeys),function(e,t){window.translationData||(window.translationData=new Map),window.translationData.set(e,t)}(t.name,t.prototype._metadata)),class extends t{static get is(){return e.tag}static set styles(e){this.styles=e}static set _metadata(e){this._metadata=e}})}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(0),s=n(21),r=n(7),a=n(11),l=n(5),c=n(66);function d(e,t,n,i,o,s,r,l,c,d,h,u,p,g,m,f=[]){const _={id:e,roomJid:n,type:t,participants:i,hasUnread:!1,preview:null,createdTime:parseInt(r),instigator:p,hideBefore:g,config:m?JSON.parse(m):null};return t===a.ConversationType.Named&&(_.subject=o,_.description=s,_.priority=l,_.expiryTTL=c,_.activityTTL=d,_.receivedList=h||[],_.acknowledgements=u||[],_.attachments=f.map(e=>JSON.parse(e))),_}function h(e,t,n,i="",o="",r){let c=l.deepCloneArray(t);return""!==i&&"all"!==i.toLowerCase()&&(c=c.filter(e=>(e.config?e.config.name:e.type).toLowerCase()===i.toLowerCase())),o&&(c=c.filter(t=>{const i=[],s=[];t.participants.forEach(t=>{if(l.jidsMatch(t.jid,n))return;const o=e.get(t.jid)||null;o&&(o.firstName&&i.push(o.firstName.toLowerCase()),o.lastName&&i.push(o.lastName.toLowerCase()))}),t.type===a.ConversationType.Named&&s.push(t.subject.toLowerCase());const r=o.toLowerCase();return i.some(e=>e.startsWith(r))||s.some(e=>e.includes(r))})),c.sort((e,t)=>{const n=new s.ConversationConfigReader(r,e),i=new s.ConversationConfigReader(r,t);if(u(e)&&!u(t))return 1;if(u(t)&&!u(e))return-1;if(n.alert&&!i.alert)return-1;if(i.alert&&!n.alert)return 1;if(n.alert&&i.alert){const e=n.sortOrder,t=i.sortOrder;if(e!==t)return t-e}const o=e.preview&&e.preview.date||0,a=t.preview&&t.preview.date||0;return Math.sign(a-o)}),c}function u(e){const t=!!(e.config&&e.config.behaviour&&e.config.behaviour.alert);if(!e||!t)return!1;if(!e.expiryTTL||0===e.expiryTTL)return!1;const n=e.createdTime+1e3*e.expiryTTL;return(new Date).getTime()>n}function p(e,t,n,i=0){const o=t.map(t=>e.get(t.jid));let s=l.sortUsersByName(o).map(e=>l.formatUserName(e,l.NameFormat.PREFIX_INITIAL_LAST)).join(", ");return i>0&&(s=s.substr(0,i)),s}function g(e){if(!e)return e;const t=c.default(e.replace(/</g,"&lt;").replace(/>/g,"&gt;"),null,{links:!0,images:!1,headings:!1,quotesAndLists:!1}).replace(/(\r\n|\n|\r|<br \/>)/gm," "),n=t.length>97?"...":"";return t.substr(0,100)+n}t.buildConversationParticipants=function(e,t,n){return[...e&&e.map(e=>({jid:e,role:o.ChatRole.Owner}))||[],...t&&t.map(e=>({jid:e,role:o.ChatRole.Administrator}))||[],...n&&n.map(e=>({jid:e,role:o.ChatRole.Participant}))||[]]},t.createConversation=d,t.createProvisionalDirectConversation=function(e,t){return Object.assign({},d("provisional",a.ConversationType.Direct,null,e),{isProvisional:!0,config:t})},t.getParticipantHash=function(e){return e.map(e=>e.jid.toLowerCase()).sort().reduce((e,t)=>e.concat(t),"")},t.prepareConversationsForList=h,t.sortConversationsIntoHash=function(e,t,n,i="",o="",s){const r={};return h(e,t,n,i,o,s).forEach(e=>{let t=(e.config?e.config.name:e.type).toLowerCase();u(e)&&(t=`${t} (expired)`),r[t]?r[t].push(e):r[t]=[e]}),r},t.isExpiredConversation=u,t.getConversationExpiryTime=function(e){const t=e.createdTime+1e3*e.expiryTTL;return l.getTwentyFourHoursTime(t)},t.getConversationTitle=function(e,t,n,i){const o=e.type===a.ConversationType.Named,s=e.participants.filter(e=>!l.jidsMatch(e.jid,n));return o?e.subject:0===s.length?i:p(t,s,n,this._contentLimit)},t.generateConversationTitleFromParticipants=p,t.createChatMessage=function(e,t,n,i,s,r,a,c=null,d=null,h=null,u=null,p=null){"string"==typeof t&&(t=parseInt(t,10));const g={id:e,type:o.ChatEntryType.Chat,date:t,mine:l.jidsMatch(i,n),from:i,to:s,body:r};return null!==p&&(g.mine=p),a&&a.length&&(g.attachments=a),c&&c.length&&(g.receivedBy=c),d&&d.length&&(g.readBy=d),h&&(g.placeholder=h),u&&(g.actingDelegate=u),g},t.createMetaEntry=function(e,t,n,i,s,r,a){return"string"==typeof t&&(t=parseInt(t,10)),{id:e,type:o.ChatEntryType.Meta,date:t,to:n,instigator:s,subject:r,action:i.toString(),data:a}},t.convertToChatEntry=function(e,t){return i(this,void 0,void 0,function*(){const n=l.getMessageType(e),i=l.parseMessagePayload(e,n);let o=t.getHandlerForMessage(i);if("convert"in o){o=o;const t=i.data&&i.data[o.messageKey]||null;return yield o.convert(e,t)}return null})},t.formatMessageBodyForPreview=g,t.getChatMessageTextForPreview=function(e,t){return e.body&&e.body.length>0?g(e.body):e.attachments&&e.attachments.length>0?t.translateI18nItem(r.ChatCommonMetadata.getI18nItem(r.ChatCommonI18nKeys.ATTATCHMENT_RECEIVED)):""},t.getChatMetaActivitySummaryText=function(e,t,n,i,s=!1){let c=null;switch(l.enumFromString(e.action)){case a.ChatMetaActivityType.START:c=l.jidsMatch(e.instigator,n)?r.ChatCommonI18nKeys.START_BY_YOU:r.ChatCommonI18nKeys.START;break;case a.ChatMetaActivityType.UPDATE:c=l.jidsMatch(e.instigator,n)?r.ChatCommonI18nKeys.UPDATE_BY_YOU:r.ChatCommonI18nKeys.UPDATE;break;case a.ChatMetaActivityType.ADD:c=l.jidsMatch(e.instigator,n)?r.ChatCommonI18nKeys.ADD_BY_YOU:l.jidsMatch(e.subject,n)?r.ChatCommonI18nKeys.ADD_YOU:r.ChatCommonI18nKeys.ADD;break;case a.ChatMetaActivityType.REMOVE:c=l.jidsMatch(e.instigator,n)?r.ChatCommonI18nKeys.KICK_BY_YOU:l.jidsMatch(e.subject,n)?r.ChatCommonI18nKeys.KICK_YOU:r.ChatCommonI18nKeys.KICK;break;case a.ChatMetaActivityType.CHANGEROLE:c=l.jidsMatch(e.instigator,n)?r.ChatCommonI18nKeys.CHANGE_ROLE_BY_YOU:l.jidsMatch(e.subject,n)?r.ChatCommonI18nKeys.CHANGE_ROLE_YOU:r.ChatCommonI18nKeys.CHANGE_ROLE;break;case a.ChatMetaActivityType.LEFT:c=l.jidsMatch(e.instigator,n)?r.ChatCommonI18nKeys.LEFT_YOU:r.ChatCommonI18nKeys.LEFT;break;case a.ChatMetaActivityType.END:c=l.jidsMatch(e.instigator,n)?r.ChatCommonI18nKeys.END_YOU:r.ChatCommonI18nKeys.END;break;case a.ChatMetaActivityType.ACK:c=l.jidsMatch(e.instigator,n)?r.ChatCommonI18nKeys.ACK_BY_YOU:r.ChatCommonI18nKeys.ACK;break;case a.ChatMetaActivityType.RECEIVED:c=l.jidsMatch(e.instigator,n)?r.ChatCommonI18nKeys.RECEIVED_YOU:r.ChatCommonI18nKeys.RECEIVED}if(!c)return null;const d=e=>{const n=t.get(e);return n&&l.formatUserName(n,l.NameFormat.PREFIX_INITIAL_LAST)||e},h={date:l.getFriendlyDate(e.date,i),time:l.getFriendlyTime(e.date),instigator:d(e.instigator),subject:d(e.subject),data:e.data,value:e.subject||"acknowledge"};if("change_role"===e.action)switch(e.data){case o.ChatRole.Participant.toString():h.data=i.translateI18nItem(r.ChatCommonMetadata.getI18nItem(r.ChatCommonI18nKeys.PARTICIPANT));break;case o.ChatRole.Administrator.toString():h.data=i.translateI18nItem(r.ChatCommonMetadata.getI18nItem(r.ChatCommonI18nKeys.ADMINISTRATOR));break;case o.ChatRole.Owner.toString():h.data=i.translateI18nItem(r.ChatCommonMetadata.getI18nItem(r.ChatCommonI18nKeys.OWNER))}let u=i.translateI18nItem(r.ChatCommonMetadata.getI18nItem(c));return Object.keys(h).forEach(e=>{u=u.replace(`{{${e}}}`,h[e])}),s?u.replace(/\*(.*?)\*/g,"<span class='b'>$1</span>"):u.replace(/\*(.*?)\*/g,"$1")},t.insertAtCaret=function(e,t){const n=e.scrollTop;let i=e.selectionStart;const o=e.value.substring(0,i),s=e.value.substring(e.selectionEnd,e.value.length);e.value=o+t+s,i+=t.length,e.selectionStart=i,e.selectionEnd=i,e.focus(),e.scrollTop=n}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});var i=n(119);t.Metadata=i.Metadata;var o=n(120);t.I18nItem=o.I18nItem;var s=n(121);t.TranslationProvider=s.TranslationProvider},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(17),r=n(0),a=n(12),l=n(11),c=n(8),d=n(1),h=n(13);var u;!function(e){e[e.ONLINE="Online"]="ONLINE",e[e.OFFLINE="Offline"]="OFFLINE",e[e.RECONNECTING="Reconnecting"]="RECONNECTING"}(u||(u={}));class p{static _create(){return new s.Metadata(g,u)}static get instance(){return this._instance||(this._instance=this._create())}}p._instance=null,t.CTCLHeaderMetadata=p;class g extends a.CTCLComponent{constructor(){super(),this.setMetadata(p.instance)}static get is(){return"ct-cl-header"}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){this.setupConnectionStatusListener(()=>{clearTimeout(this._reconnectTimeout)})}get generateComponentStyles(){return n(308)}generateComponentMarkup(){const e=["header",...this._getConnectionStatusCssClasses()],t=h.buildStyles({backgroundColor:this.backgroundColor});return window.__CTRender("div",{class:e.join(" "),style:t},window.__CTRender("div",{class:"left-action"},window.__CTRender("slot",{name:"left-action"})),window.__CTRender("div",{class:"details"},window.__CTRender("div",{class:"heading"},window.__CTRender("slot",{name:"heading"})),window.__CTRender("slot",{name:"alert-status"}),window.__CTRender("div",{class:"sub-heading"},window.__CTRender("slot",{name:"sub-heading"})),window.__CTRender("div",{class:"status",onClick:this._onClickReconnectNow.bind(this)},window.__CTRender("div",{class:"label"},this._getConnectionStatusLabel()),window.__CTRender(c.CTIcon,{class:"icon",width:"10",height:"10",icon:l.Icons.UI.Reconnect,spin:this.connectionStatus===r.ConnectionStatus.Connecting}))),window.__CTRender("div",{class:"right-action"},window.__CTRender("slot",{name:"right-action"})))}_onClickReconnectNow(){this.connectionStatus===r.ConnectionStatus.Disconnected&&(this.connectionStatus=r.ConnectionStatus.Connecting,clearTimeout(this._reconnectTimeout),this._reconnectTimeout=setTimeout(()=>{this.layer.attemptReconnect()},500))}_getConnectionStatusCssClasses(){switch(this.connectionStatus){case r.ConnectionStatus.Disconnected:return["offline disconnected"];case r.ConnectionStatus.Disconnecting:return["offline disconnecting"];case r.ConnectionStatus.Connecting:return["offline connecting"];case r.ConnectionStatus.Connected:return["online connected"]}}_getConnectionStatusLabel(){switch(this.connectionStatus){case r.ConnectionStatus.Connected:return this.translateI18nItem(u.ONLINE);case r.ConnectionStatus.Connecting:case r.ConnectionStatus.Disconnecting:case r.ConnectionStatus.Disconnected:return this.translateI18nItem(u.OFFLINE)}}}i([d.prop({type:String,attribute:!0,default:null})],g.prototype,"backgroundColor",void 0),i([d.prop({type:Object,attribute:!0,default:null})],g.prototype,"expiredAlertConfig",void 0),t.CTCLHeader=g,g.register()},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(5);!function(e){e[e.Connectivity="connectivity"]="Connectivity",e[e.MessageSent="message-sent"]="MessageSent",e[e.MessageReceived="message-received"]="MessageReceived",e[e.MessageUpdated="message-updated"]="MessageUpdated",e[e.MessageChatMarker="message-chat-marker"]="MessageChatMarker",e[e.ProcessingReceived="processing-received"]="ProcessingReceived",e[e.ProcessingUpdated="processing-updated"]="ProcessingUpdated",e[e.ProcessingChatMarker="processing-chat-marker"]="ProcessingChatMarker",e[e.Status="status"]="Status",e[e.Presence="presence"]="Presence",e[e.Participation="participation"]="Participation",e[e.Mam="mam"]="Mam",e[e.CleanUp="clean-up"]="CleanUp",e[e.XmppClient="xmpp-client"]="XmppClient",e[e.Events="events"]="Events",e[e.DataStorage="data-storage"]="DataStorage",e[e.Other="other"]="Other"}(t.LoggerTypes||(t.LoggerTypes={}));t.Logger=class{constructor(e=null){this._types=e||[],this._initialTypes=e}log(e,...t){this.shouldLog(e)&&console.log.call(null,...t)}info(e,...t){this.shouldLog(e)&&console.info.call(null,...t)}debug(e,...t){this.shouldLog(e)&&console.debug.call(null,...t)}error(...e){console.error.call(null,...e)}group(e,t=!1,n="",...i){this.shouldLog(e)&&(t?console.group.call(null,n,...i):console.groupCollapsed.call(null,n,...i))}groupEnd(e){this.shouldLog(e)&&console.groupEnd.call(null)}getTypes(){return this._types}hasInitialTypes(){return this._initialTypes&&this._initialTypes.length>0}getTypesAsEnumValues(){return this._types.map(e=>i.enumFromString(e))}setTypes(e){this._types=e||[]}resetTypes(){this._types=this._initialTypes}shouldLog(e){return!(!this._types||!this._types.length)&&(!!this._types.includes("_all_")||this._types.includes(e.toString()))}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(17);var o;!function(e){e[e.TODAY="Today"]="TODAY",e[e.YESTERDAY="Yesterday"]="YESTERDAY",e[e.ARE_YOU_SURE="Are you sure?"]="ARE_YOU_SURE",e[e.PLEASE_WAIT="Please wait..."]="PLEASE_WAIT",e[e.AUTHENTICATING="Authenticating..."]="AUTHENTICATING",e[e.SYNCING="Syncing with server..."]="SYNCING",e[e.LOGIN_ERROR_TITLE="Error logging in"]="LOGIN_ERROR_TITLE",e[e.LOGIN_ERROR_GENERIC="Check your connectivity and credentials and try again."]="LOGIN_ERROR_GENERIC",e[e.USER_NOT_FOUND="User {{username}} was not found."]="USER_NOT_FOUND",e[e.FETCH_ERROR="Error fetching data"]="FETCH_ERROR",e[e.LOGIN_TIMEOUT="Logging in took longer than expected. Please check your connectivity and log in again."]="LOGIN_TIMEOUT",e[e.LOGOUT_ERROR_TITLE="Error logging out"]="LOGOUT_ERROR_TITLE",e[e.UPLOAD_ERROR_TITLE="Upload Error"]="UPLOAD_ERROR_TITLE",e[e.UPLOAD_ERROR_DESCRIPTION="Uploading your file failed. Please try again or try a different file."]="UPLOAD_ERROR_DESCRIPTION",e[e.ERROR="Error"]="ERROR",e[e.LOGOUT_MESSAGE="Are you sure you wish to logout?"]="LOGOUT_MESSAGE"}(o=t.CommonI18nKeys||(t.CommonI18nKeys={})),t.CommonMetadata=new i.Metadata("Common",o)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(11),o=n(5);t.ConversationConfigReader=class{constructor(e,t,n){this._layer=e,this._conversation=t,this._config=n||this._loadConfiguration()}_loadConfiguration(){let e="";if(this._conversation&&this._conversation.config)return this._conversation.config;if(this._conversation){e=this._conversation.type;const t=this._layer.config.conversationTypes.find(e=>e.id===this._conversation.type);if(t)return t}switch(e){case"named":return i.namedConversationConfig;case"direct":default:return i.directConversationConfig}}_ensureConfigSet(){if(!this._config)throw new Error("Configuration has not been set.")}constructConfigurationToSend(e,t=!0){const n=o.deepCloneObject(this._config);return e&&n.behaviour.alert&&(n.behaviour.alert.alertResponseOptions=[e]),n.behaviour.chatAvailable=t,n}get id(){return this._config.id||null}get sortOrder(){return this._config.sortOrder||999}get name(){return this._config.name||"Direct"}get shortDescription(){return this._config.shortDescription||null}get longDescription(){return this._config.longDescription||null}get descriptionAtTop(){return this._config.descriptionAtTop||null}get colorCode(){return this._config.colorCode||null}get displayGroup(){return this._config.displayGroup||null}get defaultConversationExpiryTTL(){return void 0===this._config.defaultConversationExpiryTTL?this._layer.config.behaviour.defaultConversationExpiryTTL||3600:this._config.defaultConversationExpiryTTL}get defaultConversationActivityTTL(){return void 0===this._config.defaultConversationActivityTTL?this._layer.config.behaviour.defaultConversationActivityTTL||604800:this._config.defaultConversationActivityTTL}get maxConversationParticipants(){return this._config.maxConversationParticipants||this._layer.config.behaviour.maxConversationParticipants||20}get warnWhenNoContacts(){return void 0!==this._config.behaviour.warnWhenNoContacts&&this._config.behaviour.warnWhenNoContacts}get errorWhenNoContacts(){return void 0!==this._config.behaviour.errorWhenNoContacts&&this._config.behaviour.errorWhenNoContacts}get chatAvailable(){return void 0===this._config.behaviour.chatAvailable||this._config.behaviour.chatAvailable}get namedSettings(){return!!(this._config.behaviour.namedSettings&&Object.keys(this._config.behaviour.namedSettings).length>0)||null}get usePagerUI(){return this._config.behaviour.usePagerUI||!1}get subjectRequired(){return this._config.behaviour.namedSettings?void 0===this._config.behaviour.namedSettings.subjectRequired||this._config.behaviour.namedSettings.subjectRequired:null}get subjectFieldLabel(){return this._config.behaviour.namedSettings&&this._config.behaviour.namedSettings.subjectFieldLabel||"Subject"}get maxSubjectLength(){return this._config.behaviour.namedSettings&&this._config.behaviour.namedSettings.maxSubjectLength||this._layer.config.behaviour.maxSubjectLength}get descriptionRequired(){return this._config.behaviour.namedSettings&&this._config.behaviour.namedSettings.descriptionRequired||!1}get descriptionFieldLabel(){return this._config.behaviour.namedSettings?this._config.behaviour.namedSettings.descriptionFieldLabel||`Description${this.descriptionRequired?"":" (optional)"}`:"Description (optional)"}get maxDescriptionLength(){return this._config.behaviour.namedSettings&&this._config.behaviour.namedSettings.maxDescriptionLength||this._layer.config.behaviour.maxDescriptionLength}get participantCanLeave(){return void 0===this._config.behaviour.participantCanLeave||this._config.behaviour.participantCanLeave}get participantCanDelete(){return void 0===this._config.behaviour.participantCanDelete||this._config.behaviour.participantCanDelete}get ownerCanEditAfterSend(){return void 0===this._config.behaviour.ownerCanEditAfterSend||this._config.behaviour.ownerCanEditAfterSend}get ownerCanAddAdditionalContacts(){return void 0===this._config.behaviour.ownerCanAddAdditionalContacts||this._config.behaviour.ownerCanAddAdditionalContacts}get ownerCanCloseEarly(){return void 0===this._config.behaviour.ownerCanCloseEarly||this._config.behaviour.ownerCanCloseEarly}get canSendAttachmentsWithinConversation(){return void 0===this._config.behaviour.canSendAttachmentsWithinConversation||this._config.behaviour.canSendAttachmentsWithinConversation}get autoRemoveOnClose(){return void 0===this._config.behaviour.autoRemoveOnClose||this._config.behaviour.autoRemoveOnClose}get priorityPush(){return this._config.behaviour.priorityPush?this._config.behaviour.priorityPush:null}get alert(){return!!(this._config.behaviour.alert&&Object.keys(this._config.behaviour.alert).length>0)||null}get suppressAlertModalWarning(){return this._config.behaviour.alert&&this._config.behaviour.alert.suppressAlertModalWarning||!1}get alertVolume(){return this._config.behaviour.alert?void 0===this._config.behaviour.alert.alertVolume?100:this._config.behaviour.alert.alertVolume:100}get alertSoundFilename(){return this._config.behaviour.alert&&void 0!==this._config.behaviour.alert.alertSoundFilename?this._config.behaviour.alert.alertSoundFilename:"Clinical_Messaging_Notification.m4a"}get alertSoundLoops(){return this._config.behaviour.alert&&void 0!==this._config.behaviour.alert.alertSoundLoops?this._config.behaviour.alert.alertSoundLoops:1}get alertAudioStream(){return this._config.behaviour.alert&&void 0!==this._config.behaviour.alert.alertAudioStream?this._config.behaviour.alert.alertAudioStream:"notification"}get vibrate(){return!this._config.behaviour.alert||void 0===this._config.behaviour.alert.vibrate||this._config.behaviour.alert.vibrate}get forceVibrate(){return!this._config.behaviour.alert||void 0===this._config.behaviour.alert.forceVibrate||this._config.behaviour.alert.forceVibrate}get vibrateDuration(){return this._config.behaviour.alert&&void 0!==this._config.behaviour.alert.vibrateDuration?this._config.behaviour.alert.vibrateDuration:300}get vibrateIterations(){return this._config.behaviour.alert&&void 0!==this._config.behaviour.alert.vibrateIterations?this._config.behaviour.alert.vibrateIterations:1}get disableRePush(){return!(!this._config.behaviour||void 0===this._config.behaviour.disableRePush)&&this._config.behaviour.disableRePush}get automaticallyPlayAudioOnDownload(){return!(!this._config.behaviour.alert||void 0===this._config.behaviour.alert.automaticallyPlayAudioOnDownload)&&this._config.behaviour.alert.automaticallyPlayAudioOnDownload}get allowMute(){return this._config.behaviour.alert?this._config.behaviour.alert.allowMute||!1:null}get snoozeDuration(){return this._config.behaviour.alert?this._config.behaviour.alert.snoozeDuration||60:null}get alertResponseOptions(){return this.alert&&this._config.behaviour.alert.alertResponseOptions?this._config.behaviour.alert.alertResponseOptions:[]}get alertResponseOptionTemplates(){return this.alert&&this.alertResponseOptions.length?this.alertResponseOptions.reduce((e,t)=>e=[...e,...t.options],[]):[]}get attachments(){return!!(this._config.behaviour&&this._config.behaviour.attachments&&Object.keys(this._config.behaviour.attachments).length>0)||null}get image(){return this.attachments?this._config.behaviour.attachments.image:null}get allowOpenInFullScreen(){return!(this.attachments&&this.image&&Object.keys(this._config.behaviour.attachments.image).length>0)||void 0===this._config.behaviour.attachments.image.allowOpenInFullScreen||this._config.behaviour.attachments.image.allowOpenInFullScreen}get audio(){if(this.attachments){if(this._config.behaviour.attachments.audio&&"object"==typeof this._config.behaviour.attachments.audio){const e=Object.keys(this._config.behaviour.attachments.audio);for(let t=0;t<e.length;t++)if(!0===this._config.behaviour.attachments.audio[e[t]])return this._config.behaviour.attachments.audio;return!1}return this._config.behaviour.attachments.audio}return null}get attachPreRecordedFile(){return this.attachments?!this.audio||void 0===this.audio.attachPreRecordedFile||this.audio.attachPreRecordedFile:null}get attachLiveRecordedAudio(){return this.attachments?!this.audio||void 0===this.audio.attachLiveRecordedAudio||this.audio.attachLiveRecordedAudio:null}get video(){return this.attachments?this._config.behaviour.attachments.video:null}get autoPlay(){return this.attachments&&this.audio?this.audio.autoPlay||!1:null}get limitPlaybackToEarpiece(){return this.attachments&&this.audio?this.audio.limitPlaybackToEarpiece||!1:null}get shouldOpenConversationAfterResponded(){return!this._config.behaviour.alert||void 0===this._config.behaviour.alert.shouldOpenConversationAfterResponded||this._config.behaviour.alert.shouldOpenConversationAfterResponded}get participantAlertResponsesVisible(){return!this._config.behaviour.alert||void 0===this._config.behaviour.alert.participantAlertResponsesVisible||this._config.behaviour.alert.participantAlertResponsesVisible}get autoIncludeMembersInRoles(){return this._config.behaviour.alert&&this._config.behaviour.alert.autoIncludeMembersInRoles||[]}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(13),o=n(5),s="vl-l";t.VirtualList=class{constructor(e,t,n){this.EMPTY_STYLES=i.buildStyles(),this._isAtBottom=!1,this._scrollerStyles=i.buildStyles({"overflow-y":"auto",overflowScrolling:"touch",WebkitOverflowScrolling:"touch","will-change":"transform"}),this._host=e,this._items=t,this._config=n,this._initialized=!1,this._id=`vl_${o.generateRandomSixString()}`,this._scroller=null,this._useBlocks=n.blockSize&&n.blockSize>0,e.onRenderComplete(()=>{this._scroller=e.shadowRoot.querySelector(`#${this._id}`),this._scroller?this._initialized||(i.debouncedRequestAnimationFrame(()=>this._calculateVirtualListData(!0)),this._scroller.addEventListener("scroll",()=>i.debouncedRequestAnimationFrame(()=>this._calculateVirtualListData())),this._initialized=!0):this._initialized=!1}),window.addEventListener("resize",()=>{this._useBlocks||this._calculateVirtualListData()})}get items(){return this._items}setItems(e){this._items=e,this._calculateVirtualListData(!0),this._updateHost(),e.length>0&&(this._isAtBottom=!1)}addItems(e){this._items=this._items.concat(e),this._calculateVirtualListData(!0),this._updateHost(),e.length>0&&(this._isAtBottom=!1)}addScrollNearBottomListener(e){this._scroller.addEventListener("scroll",()=>{const t=this._scroller.scrollHeight-this._scroller.clientHeight;this._scroller.scrollTop>=t-this._scroller.clientHeight&&e.apply(this._scroller)})}addScrollAtBottomListener(e){this._scroller.addEventListener("scroll",()=>{const t=this._scroller.scrollHeight-this._scroller.clientHeight;this._scroller.scrollTop>=t-this._scroller.clientHeight/2?(this._isAtBottom=!0,e.apply(this._scroller)):this._isAtBottom=!1})}isCurrentlyAtBottom(){return this._isAtBottom}render(e,t="",n=""){const i=this._data&&this._data.scrollerProps||{id:this._id,key:this._id},o=this._data&&this._data.containerProps||{},s=this._data&&!!this._data.viewportItems;return window.__CTRender("div",Object.assign({class:`virtual-list-scroller ${t}`},i),s&&window.__CTRender("div",Object.assign({class:`virtual-list-content ${n}`},o),this._data.viewportItems.map((t,n)=>e(t.item,t.itemProps,n))))}_calculateVirtualListData(e=!1){if(!this._scroller)return;const t=Math.floor(this._scroller.scrollTop/this._config.itemHeight),n=parseInt(this._scroller.getAttribute(s))||null,i=this._useBlocks?Math.floor(t/this._config.blockSize):t;if(!e&&n===i)return;const o=this._items.length;if(this._useBlocks){const e=this._config.itemHeight*this._config.blockSize,t=Math.floor(o/this._config.blockSize)+1,n=Math.max(0,i-1),s=(Math.min(t,i+1)-n+1)*this._config.blockSize,r=n*this._config.blockSize,a=Math.max(0,r+s-1),l=n*e,c=this._items.slice(r,a+1);this._data=this._generateVirtualListData(c,i,l)}else{const e=Math.ceil(this._scroller.scrollHeight/this._config.itemHeight),n=3*e,o=Math.max(t-n,0),s=t+e,r=o*this._config.itemHeight,a=this._items.slice(o,s+1);this._data=this._generateVirtualListData(a,i,r)}this._updateHost(),"function"==typeof this._config.onUpdate&&this._config.onUpdate(this._data)}_generateVirtualListData(e,t,n){const i=this._items.length*this._config.itemHeight;return{viewportItems:this._mapToVirtualListItems(e,n),scrollerProps:{id:this._id,key:this._id,[s]:t.toString(),style:this._scrollerStyles},containerProps:{style:this._setStyles({position:"relative",height:`${i}px`})}}}_mapToVirtualListItems(e,t){return e.map((e,n)=>{const i=t+n*this._config.itemHeight;return{item:e,itemProps:{key:this._config.itemKeyGetter(e),style:this._setStyles({position:"absolute",top:0,left:0,width:"100%",height:`${this._config.itemHeight}px`,transform:`translateY(${i}px)`})}}})}_setStyles(e={}){return Object.assign({},this.EMPTY_STYLES,e)}_updateHost(){this._host.forceRedraw()}forceRecalc(){this._calculateVirtualListData(!0)}}},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(106)),i(n(28))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=window,o=document;function s(){const e=window.navigator.userAgent;return/Android/i.test(e)?"android":/iPhone|iPad|iPod/i.test(e)?"ios":/Electron/i.test(e)?"electron":/Chrome/i.test(e)?"chrome":/Safari/i.test(e)?"safari":/Edge/i.test(e)?"edge":i.MSInputMethodContext&&o.documentMode?"ie":null}t.getPlatformName=s,t.isElectron=function(){return"electron"===s()},t.isWindows=function(){return-1!==navigator.userAgent.toUpperCase().indexOf("WINDOWS")},t.isDevice=function(){const e=s();return"android"===e||"ios"===e},t.isBrowser=function(){const e=s();return"chrome"===e||"safari"===e||"ie"===e||"edge"===e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=window,o=window;t.getSource=function(e){if(void 0!==i[e])return i[e];if(void 0!==i.cordova&&void 0!==i.cordova[e])return i.cordova[e];if(void 0!==i.cordova&&void 0!==i.cordova.plugins&&void 0!==i.cordova.plugins[e])return i.cordova.plugins[e];if(void 0!==i.plugins&&void 0!==i.plugins[e])return i.plugins[e];if(void 0!==navigator&&void 0!==navigator[e])return navigator[e];if(void 0===o.require)return console.warn(`Plugin '${e}' is not available.`),!1;{let t=!1;try{return t=o.require(e)}catch(n){if(!1===t||void 0===t){const t=e.replace(/\-/g,"").toLowerCase();try{return o.require("@commontimeltd/com.commontime."+t)}catch(e){return!1}}return!1}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rolesLabel="Role",t.groupsLabel="Group",t.uberAdminGroup="_uber_admin",t.superAdminGroup="_super_admin",t.groupAdminGroup="_group_admin",t.roleAdminGroup="_role_admin",t.roleAssignmentGroup="_role_assignment",t.rolePermissionManagementGroup="_role_permission_management",t.userAdminGroup="_user_admin"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(80);t.CTCLAddConversationContacts=i.CTCLAddConversationContacts,t.CTCLAddConversationContactsMetadata=i.CTCLAddConversationContactsMetadata,t.CTCLAddConversationContactsModel=i.CTCLAddConversationContactsModel;var o=n(90);t.CTCLAudioAttachment=o.CTCLAudioAttachment;var s=n(85);t.CTCLChatMessageList=s.CTCLChatMessageList,t.CTCLChatMessageListMetadata=s.CTCLChatMessageListMetadata,t.CTCLChatMessageListModel=s.CTCLChatMessageListModel;var r=n(87);t.CTCLContactInfo=r.CTCLContactInfo,t.CTCLContactInfoMetadata=r.CTCLContactInfoMetadata,t.CTCLContactInfoModel=r.CTCLContactInfoModel;var a=n(91);t.CTCLConversationAlert=a.CTCLConversationAlert,t.CTCLConversationAlertMetadata=a.CTCLConversationAlertMetadata,t.CTCLConversationAlertModel=a.CTCLConversationAlertModel;var l=n(88);t.CTCLConversationInfo=l.CTCLConversationInfo,t.CTCLConversationInfoMetadata=l.CTCLConversationInfoMetadata,t.CTCLConversationInfoModel=l.CTCLConversationInfoModel;var c=n(89);t.CTCLConversationList=c.CTCLConversationList,t.CTCLConversationListMetadata=c.CTCLConversationListMetadata,t.CTCLConversationListModel=c.CTCLConversationListModel;var d=n(18);t.CTCLHeader=d.CTCLHeader,t.CTCLHeaderMetadata=d.CTCLHeaderMetadata;var h=n(92);t.CTCLImageAttachment=h.CTCLImageAttachment;var u=n(93);t.CTCLNewConversation=u.CTCLNewConversation,t.CTCLNewConversationMetadata=u.CTCLNewConversationMetadata,t.CTCLNewConversationModel=u.CTCLNewConversationModel;var p=n(362);t.CTCLRoleUsersModal=p.CTCLRoleUsersModal;var g=n(86);t.CTCLThumbnail=g.CTCLThumbnail,t.CTCLThumbnailMetadata=g.CTCLThumbnailMetadata;var m=n(365);t.CTCLAccountMenu=m.CTCLAccountMenu;var f=n(50);t.CTCLAttachmentHandler=f.CTCLAttachmentHandler;var _=n(51);t.CTCLAudioRecorderPlayer=_.CTCLAudioRecorderPlayer;var v=n(368);t.CTCLDelegateAccountList=v.CTCLDelegateAccountList;var y=n(371);t.CTCLDelegateAccountRow=y.CTCLDelegateAccountRow;var C=n(374);t.CTCLDelegateManagement=C.CTCLDelegateManagement;var w=n(53);t.CTCLResponseView=w.CTCLResponseView;var b=n(377);t.CTCLResponsesModal=b.CTCLResponsesModal;var E=n(94);t.CTCLVideoAttachment=E.CTCLVideoAttachment;var T=n(52);t.CTCLVideoRecorderPlayer=T.CTCLVideoRecorderPlayer;var R=n(95);t.CTCLRoleAdmin=R.CTCLRoleAdmin;var I=n(384);t.CTCLGroupAdmin=I.CTCLGroupAdmin;var A=n(98);t.CTCLUserAdmin=A.CTCLUserAdmin;var S=n(96);t.CTCLAddRole=S.CTCLAddRole;var x=n(97);t.CTCLAddGroup=x.CTCLAddGroup;var O=n(391);t.CTCLRoleDetailModal=O.CTCLRoleDetailModal;var M=n(393);t.CTCLGroupDetailModal=M.CTCLGroupDetailModal;var L=n(395);t.CTCLAddRoleUsersModal=L.CTCLAddRoleUsersModal;var N=n(397);t.CTCLAddGroupMembersModal=N.CTCLAddGroupMembersModal;var D=n(48);t.CTGroupAvatar=D.CTGroupAvatar;var P=n(49);t.CTGroupTile=P.CTGroupTile;var k=n(399);t.CTSearchbox=k.CTSearchbox;var U=n(37);t.CTUserList=U.CTUserList;var j=n(402);t.CTCLToast=j.CTCLToast;var F=n(54);t.CTCLPill=F.CTCLPill;var B=n(55);t.CTCLAlertStatus=B.CTCLAlertStatus;var G=n(405);t.CTCLDynamicActionSheet=G.CTCLDynamicActionSheet},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(8))},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(67),s=n(103),r=n(24),a=n(43),l=n(25),c=n(175),d=n(176),h=n(44),u=n(179),p=n(64);if(!window.Promise)throw new Error("ct-xmpp-client.js has a dependency on Promise, did you forget to include the polyfill?");if(!window.PouchDB)throw new Error("ct-xmpp-client.js has a dependency on PouchDB, please ensure PouchDB is included before ct-xmpp-client.js");class g{constructor(e,t,n){if(this._userDirectory=null,this._updateHelper=null,this._enableSmResponseHandler=null,this._includeStanzaFilters=[],this._excludeStanzaFilters=[],this._pushNodeName=null,this._delegatedIQListenerAdded=!1,this._currentlyDeleting=[],this._push=null,this._voip=null,this._sso=!1,this._forceExitTimeout=null,this._updateUserDirectoryTimeout=null,this._debouncers={},this._lastStatusId=null,this._pingInterval=null,this._pingTimeout=null,this._alreadyReLoggingIn=!1,this._reLoginTimeout=null,this._reLoginBackOff=3e3,this._forcedLogout=!1,this._sendTimeouts={},this._sendStanzaPromises={},this._destroyingDbs=!1,this._joinedRooms={},this._saveDebounce={},this._botCommandTimeouts={},this._botCommandPromises={},this._initialised=!1,!e)throw new Error("An instance ID must be provided.");this._instanceId=e;let i=localStorage.getItem(`${this._instanceId}_last_archive_id`);if(null===i&&(i="0"),this._lastArchiveId=i,!t)throw new Error("XMPP server hostname must be provided.");this._serverTimeDiff=null,this._eventListeners={},this._options=g._merge({sendTimeout:3e5,debug:!1,perfLogging:!1,mucHost:null,uploadHost:null,echoHost:null,authAttachments:!1,mam:{auto:!0,defaultTimeLimit:2628e6,pageSize:250},push:{androidEnabled:!1,packageId:"",senderId:"",iosEnabled:!1,reLoginOnPushiOS:!0,reLoginOnPushAndroid:!1},enablePing:!0,pingInterval:5e3,pingTimeout:1e4,connectTimeout:7e3,autoLogin:!1,autoReconnect:!0,autoMarkMessages:!0,encryption:!1,fileEncryption:!1,autoDownloadAttachmentTime:-1,autoPurgeOldMessagesAge:-1,autoPurgeOldMessagesCount:-1,streamResumption:!0,useEncodedJidAsResource:!1,adSpn:null,adSecurityPackage:null,adTokenPlaceholder:"[[AD_PASSWORD_TOKEN]]",updateUserDirectoryOnLogin:!1,enableMessageCarbons:!1,maxReconnectBackoff:3e5,stropheLogging:!1,forceIndexedDb:!1,bringToForegroundOnVoipPush:!0,updateUserDirectoryInterval:18e5,useConnectionEvents:!0,autoResumeTimers:!0,maxStreamResumptionTime:3e5,alwaysSendPresence:!1,updateRosterOnLogin:!0,silentAudioVolume:0,silentAudioDuration:3e4},n),document.addEventListener("pause",()=>{this.killApp()},!1),document.addEventListener("resume",()=>{this.cancelKillApp()},!1),this._endpoint=t,this._connection=null,this.connected=!1,this.loggedIn=!1,this._reLoggingIn=!1,this._loggingOut=!1,this._jid=null,this.resource=null,this._bareJid=null,this.username=null,this._userDirectory=new d.UsersDirectory(this._instanceId,this._options.debug);let a="",c="";if(r.isDevice()){const e=l.getSource("device");e&&(a=e.platform.toLowerCase(),c=e.version)}else a=r.isWindows()?"windows":"macos";this._updateHelper=new p.UpdateHelper(a,c,this._options.customerVersion),!0===this._options.stropheLogging&&(s.default.Strophe.log=((e,t)=>{this._log(`[${e}]: ${t}`)})),o.Promise.all([this._getInstallId(),this._initDbs()]).then(()=>{this._initialised=!0,this._log("XMPP client successfully initialised.");const e=[this._getCacheItem("user_jid"),this._getCacheItem("user_password"),this._getCacheItem("sso")];o.Promise.all(e).then(e=>{const t=e[0],n=e[1];if(this._sso="true"==e[2],t){const e=s.default.Strophe.getBareJidFromJid(t);this.getUserByJid(e).then(n=>{this._dispatchEvent(g.EVENT_TYPES.INITIALISED,{jid:t,bareJid:e,user:n})}).catch(e=>{this._onError("Couldn't get user object for current user during initialise:"+e)})}else this._dispatchEvent(g.EVENT_TYPES.INITIALISED,null);return o.Promise.resolve().then(()=>{if(this._options.sso&&this._options.sso.enabled)return this.discoverOAuth(this._options.sso.discovery,this._options.sso.clientId,this._options.sso.scopes,this._options.sso.port)}).then(()=>{if(!0===this._options.autoLogin&&void 0!==t&&void 0!==n)return this._reLogin()})}).catch(e=>{this._onError("Unable to get jid/pw: "+e)})}).catch(e=>{throw new Error(e)}),this._options.useConnectionEvents&&(document.addEventListener("offline",()=>{this._onOffline()},!1),document.addEventListener("online",()=>{this._onOnline()},!1))}killApp(){if("ios"!==r.getPlatformName())return;const e=l.getSource("VoIPPushNotification");e&&(this._log("Calling exit app...."),e.exitApp(()=>{this._log("Successfully called exit app.")},e=>{this._onError("Unable to call exitApp",e)}))}cancelKillApp(){if("ios"!==r.getPlatformName())return;this._log("Cancelling app exit...");const e=l.getSource("VoIPPushNotification");e&&e.cancelExitApp(()=>{this._log("Successfully cancelled app exit.")},e=>{this._onError("Unable to call cancelExitApp",e)})}set sendTimeout(e){e!==this._options.sendTimeout&&(this._options.sendTimeout=e)}get status(){return this._isMethodReady(!0),this._getCacheItem("connection_status")}get bareJid(){return this._bareJid}get mucHost(){return this._options.mucHost}addIncludeStanzaFilter(e){this._includeStanzaFilters.push(e)}addExcludeStanzaFilter(e){this._excludeStanzaFilters.push(e)}_onOffline(){this._connection._doDisconnect()}_onOnline(){this.connected||this.reLoginNow()}_getInstallId(){return new o.Promise((e,t)=>{const n=localStorage.getItem(`${this._instanceId}_install_id`);if(null!==n)return this._installId=n,e();{let n=this;if("ios"===r.getPlatformName()){const i=l.getSource("securesettings");i.get(o=>{if("string"==typeof o)n._installId=o,localStorage.setItem(`${n._instanceId}_install_id`,n._installId),e();else{const o=h.generateGuid();i.set(()=>{n._installId=o,localStorage.setItem(`${n._instanceId}_install_id`,n._installId),e()},e=>{t(e)},"install_id",o)}},e=>{n._log("Secure settings error:",e),t(e)},"install_id")}else if("android"===r.getPlatformName()){const t=l.getSource("device");this._installId=t.uuid,localStorage.setItem(`${this._instanceId}_install_id`,this._installId),e()}else{const t=h.generateGuid();n._installId=t,localStorage.setItem(`${this._instanceId}_install_id`,this._installId),e()}}})}_initDbs(){return new o.Promise((e,t)=>{const n={auto_compaction:!1,revs_limit:1};this._msgDb=new window.PouchDB(`${this._instanceId}_messages`,n),this._contactDb=new window.PouchDB(`${this._instanceId}_contacts`,n),this._cacheDb=new window.PouchDB(`${this._instanceId}_cache`,n),this._cache={},this._roomDb=new window.PouchDB(`${this._instanceId}_rooms`,n),this._participantDb=new window.PouchDB(`${this._instanceId}_participants`,n),!0===this._options.encryption?h.getEncryptionKey(this._instanceId).then(t=>{this._cacheDb.crypto({key:t}),this._msgDb.crypto({key:t}),this._contactDb.crypto({key:t}),this._roomDb.crypto({key:t}),this._participantDb.crypto({key:t}),e()}).catch(t):(console.warn("Encryption has not been enabled! If you have auto-reconnect, auto-login or authenticated attachments enabled your password will be stored unencrypted! "),e())})}_setStatus(e,t=!0,n=null){return new o.Promise((i,o)=>{if(this._lastStatusId===e)i();else{const r={id:e,label:null,reason:n};switch(e){case s.default.Strophe.Status.CONNECTING:r.label="Connecting";break;case s.default.Strophe.Status.CONNFAIL:r.label="Connection failed";break;case s.default.Strophe.Status.DISCONNECTING:r.label="Disconnecting";break;case s.default.Strophe.Status.DISCONNECTED:r.label="Disconnected";break;case s.default.Strophe.Status.CONNECTED:r.label="Connected";break;case s.default.Strophe.Status.AUTHFAIL:r.label="Authentication failed.";break;case s.default.Strophe.Status.ERROR:r.label=n||"An unknown error occurred."}this._lastStatusId!==r.id&&!1!==t&&this._dispatchEvent(g.EVENT_TYPES.STATUS,r),this._lastStatusId=r.id,this._setCacheItem("connection_status",r).then(i).catch(o)}})}static _isReasonToReconnect(e){if(!e||"string"!=typeof e)return!0;let t=!0;switch(e.toLowerCase()){case"kicked by administrator":case"replaced by new connection":case"conflict":t=!1}return t}static _translateCondition(e){if(!e)return null;switch(e.toLowerCase()){case"conflict":return"You already have an active session. Please log out of any previous sessions or wait for the previous login attempt to timeout.";case"system-shutdown":return"Remote server was shut down.";case"connection-timeout":return"The connection to the server timed out.";case"socket closed, probably due to no network connectivity.":case"invalid username or password":case"kicked by administrator":return e;default:return"Connection closed unexpectedly."}}_connect(e,t){return new o.Promise((n,i)=>{this._connection&&this._connection.connected&&this._connection._doDisconnect(),this._connection=new s.default.Strophe.Connection(this._endpoint,{instance_id:this._instanceId}),this._connection.addHandler(this._onStanza.bind(this),null,"message"),this._connection.addHandler(e=>this._onPresence(g.xmlToJson(e)),null,"presence"),this._connection.addHandler(e=>this._onIq(g.xmlToJson(e)),null,"iq");const r=setTimeout(()=>{this._connection._doDisconnect(),i("Connection took more than 5 seconds to be established, connection closed.")},this._options.connectTimeout);(!0===this._options.streamResumption?this._getCacheItem("stream_management_id"):o.Promise.resolve()).then(o=>{this._connection.streamManagement.prevId=o;let a=!1;this._forcedLogout&&(!0===this._options.useEncodedJidAsResource&&(this._connection.override=!0),this._forcedLogout=!1),this._connection.connect(e,t,(e,t)=>{if(!0!==this._reLoggingIn&&this._setStatus(e,!0,t),!0===a)return!1;switch(e){case s.default.Strophe.Status.ERROR:case s.default.Strophe.Status.AUTHFAIL:case s.default.Strophe.Status.CONNFAIL:case s.default.Strophe.Status.DISCONNECTED:const o=g._translateCondition(t);let l="Connection Disconnected";e===s.default.Strophe.Status.ERROR&&(l="Connection Error",this._onError(l,o)),e===s.default.Strophe.Status.AUTHFAIL&&(l="Authentication Failed"),e===s.default.Strophe.Status.CONNFAIL&&(l="Connection Failed"),null!==o&&(l+=": "+o);const c=(e,t)=>{const n=t[e];n.pauseable?n.paused||(this._log(`Pausing timer for request with ID '${e}'...`),n.pause()):(this._log(`Ending timer for request with ID '${e}'...`),n.end())};Object.keys(this._sendTimeouts).length>0&&Object.keys(this._sendTimeouts).forEach(e=>c(e,this._sendTimeouts)),Object.keys(this._botCommandTimeouts).length>0&&Object.keys(this._botCommandTimeouts).forEach(e=>c(e,this._botCommandTimeouts)),clearTimeout(r),this.connected=!1,this._stopPing(),this._log("Disconnected:",t),this._alreadyReLoggingIn=!1,!1===this._loggingOut&&!0===this._options.autoReconnect&&e!==s.default.Strophe.Status.AUTHFAIL&&!0===g._isReasonToReconnect(t)&&(this._log("Attempting to re-login..."),this._reLogin()),a=!0,i({msg:l,status:e,condition:t});break;case s.default.Strophe.Status.CONNECTED:clearTimeout(r),this.connected=!0,n(t)}})})})}enableStreamManagement(){return new o.Promise((e,t)=>{const n=e=>{e.id===s.default.Strophe.Status.DISCONNECTED&&(this._connection&&this._enableSmResponseHandler&&this._connection.deleteHandler(this._enableSmResponseHandler),this.removeEventListener(g.EVENT_TYPES.STATUS,n),t("Disconnected during stream management enabling."))};if(this.addEventListener(g.EVENT_TYPES.STATUS,n),!1===this.connected||null===this._connection)t("You must have an active connection to enable stream management");else{if(!this._connection.streamManagement)throw new Error("Stream management is required.");try{this._enableSmResponseHandler=this._connection.addHandler(t=>(this._log("Stream resumption enabled!"),this._setCacheItem("stream_management_id",t.getAttribute("id")).then(()=>{this._connection&&this._enableSmResponseHandler&&this._connection.deleteHandler(this._enableSmResponseHandler),this.removeEventListener(g.EVENT_TYPES.STATUS,n),e()}),!1),"urn:xmpp:sm:3","enabled"),this._connection.streamManagement.enable(this._options.maxStreamResumptionTime)}catch(e){console.error(e),t()}}})}_enableMessageCarbons(){return this.sendIq(null,"set",{enable:{$attributes:{xmlns:g.NAMESPACES.CARBONS},$value:""}})}_initialisePing(){return new o.Promise(e=>{!0===this._options.enablePing&&(null!==this._pingInterval&&clearTimeout(this._pingInterval),this._pingInterval=setTimeout(()=>{this._sendPing().then(()=>{this._initialisePing()}).catch(()=>{this._log("Ping failed."),!0===this._options.autoReconnect&&(this._log("Auto-reconnect enabled, so let's try and reconnect!"),this._connection&&this._connection._doDisconnect(),this._reLogin())})},this._options.pingInterval)),e()})}sendOneOffPing(){this._sendPing().then(()=>{this._initialisePing()}).catch(()=>{this._log("[sendOneOffPing] Ping failed."),!0===this._options.autoReconnect&&(this._log("[sendOneOffPing] Auto-reconnect enabled, so let's try and reconnect!"),this._connection&&this._connection._doDisconnect(),this._reLogin())})}forceDisconnect(){this._connection._doDisconnect()}_sendPing(){return new o.Promise((e,t)=>{this._pingTimeout=setTimeout(()=>{this.connected?(this.connected=!1,this._setStatus(s.default.Strophe.Status.DISCONNECTED),!0===this._options.autoReconnect&&this._setStatus(s.default.Strophe.Status.CONNECTING),t()):e()},this._options.pingTimeout),this.sendIq(this._domain,"get",{ping:{$attributes:{xmlns:g.NAMESPACES.PING}}}).then(()=>{clearTimeout(this._pingTimeout),e()}).catch(t)})}_makeParticipantsOffline(){return new o.Promise((e,t)=>{this._participantDb.allDocs({include_docs:!0}).then(n=>{const i=n.rows.filter(e=>!e.doc.language).map(e=>(e.doc.online=!1,e.doc));this._participantDb.bulkDocs(i).then(e).catch(e=>{this._onError("Unable to bulk update participants to offline status.",e),t(e)})}).catch(e=>{this._onError("Unable to get participants from database.",e),t(e)})})}_makeContactsOffline(){return new o.Promise((e,t)=>{this.getContacts().then(n=>{n.forEach(e=>{e.online=!1}),this._contactDb.bulkDocs(n).then(function(){e()}).catch(e=>{this._onError("Unable to bulk update contacts to offline status.",e),t(e)})}).catch(e=>{this._onError("Unable to get contacts from database.",e),t(e)})})}resumeTimers(){Object.keys(this._sendTimeouts).length>0&&Object.keys(this._sendTimeouts).forEach(e=>{const t=this._sendTimeouts[e];t.paused&&(this._log(`Resuming send timer for request with ID '${t.id}'...`),t.resume())}),Object.keys(this._botCommandTimeouts).length>0&&Object.keys(this._botCommandTimeouts).forEach(e=>{const t=this._botCommandTimeouts[e];t.paused&&(this._log(`Resuming bot command timer for request with ID '${t.id}'...`),t.resume())})}reLoginNow(){clearTimeout(this._forceExitTimeout),this._forceExitTimeout=null,this._alreadyReLoggingIn?this._log("Not executing reLoginNow() because _alreadyReLoggingIn is currently 'true'."):(this._alreadyReLoggingIn=!0,this._clearReLoginTimeout(),this._getCacheItem("sso").then(e=>{this._sso=e;const t=[this._getCacheItem("user_jid"),this._getCacheItem("user_password")];o.Promise.all(t).then(e=>{const t=e[0],n=e[1];void 0!==t&&void 0!==n&&(this._log(`Auto-logging in with JID '${t}'.`),this._setStatus(s.default.Strophe.Status.CONNECTING),this._login(t,n,!0).then(e=>{this._reLoginBackOff=3e3,this._log("Auto-login success."),this._reLoggingIn=!1,this.connected=!0;const t=[];for(let n in this._joinedRooms)t.push(this.joinRoom(n));o.Promise.all(t).then(()=>{this._setStatus(s.default.Strophe.Status.CONNECTED).then(()=>{!1!==this._options.autoResumeTimers&&this.resumeTimers(),this._dispatchEvent(g.EVENT_TYPES.AUTO_RECONNECTED,{resumed:e}),this._alreadyReLoggingIn=!1}).catch(e=>{this._alreadyReLoggingIn=!1,console.error("Couldn't set connection status:",e)})}).catch(e=>{this._onError("Couldn't join all rooms on re-login, logging out.",e),this.logout(),this._alreadyReLoggingIn=!1})}).catch(e=>{if(this._alreadyReLoggingIn=!1,e.status==s.default.Strophe.Status.AUTHFAIL)if(this._sso)this.refreshOAuthAndSave().then(()=>{this._reLogin()}).catch(e=>{const t={id:s.default.Strophe.Status.DISCONNECTED,label:"SSO Authentication Failed.",wontReconnect:!0,reason:e.condition};this._dispatchEvent(g.EVENT_TYPES.STATUS,t),this._dispatchEvent(g.EVENT_TYPES.FORCE_LOGGED_OUT,{error:e})});else{const t={id:s.default.Strophe.Status.DISCONNECTED,label:"Authentication Failed.",wontReconnect:!0,reason:e.condition};this._dispatchEvent(g.EVENT_TYPES.STATUS,t)}else this._reLoginBackOff+=3e3,this._reLoginBackOff>this._options.maxReconnectBackoff&&(this._reLoginBackOff=this._options.maxReconnectBackoff),this._log(`Couldn't re-login, trying again in ${this._reLoginBackOff/1e3} seconds...`),this.killApp(),this._reLogin()}))}).catch(e=>{this._onError("Couldn't get user JID or user password for re-login!",e)})}))}_reLogin(){if(!0!==this._loggingOut)if(!0!==this.connected){if(this._reLoggingIn=!0,this._clearReLoginTimeout(),this._log("Re-login back off time is:",this._reLoginBackOff),this._reLoginBackOff>0){const e={id:s.default.Strophe.Status.DISCONNECTED,label:"Disconnected",reconnectTime:this._reLoginBackOff};this._debounce("relogin",()=>{this._dispatchEvent(g.EVENT_TYPES.STATUS,e)},200)}this._reLoginTimeout=setTimeout(()=>{this._log("Calling reLoginNow()..."),this.reLoginNow()},this._reLoginBackOff)}else this._log("Not executing _reLogin because connected is currently 'true'.");else this._log("Not executing _reLogin because _loggingOut is currently 'true'.")}_debounce(e,t,n=100){window.clearTimeout(this._debouncers[e]),this._debouncers[e]=window.setTimeout(()=>{t(),delete this._debouncers[e]},n)}_cancelDebounce(e){window.clearTimeout(this._debouncers[e])}_clearReLoginTimeout(){null!==this._reLoginTimeout&&(clearTimeout(this._reLoginTimeout),this._reLoginTimeout=null)}_stopPing(){null!==this._pingTimeout&&clearTimeout(this._pingTimeout),null!==this._pingInterval&&clearInterval(this._pingInterval)}_createPresenceObject(){return new o.Promise((e,t)=>{const n={$attributes:{from:this._jid,xmlns:g.NAMESPACES.JABBER_CLIENT},show:"chat",status:"Available"};this._getCacheItem("chat_status").then(t=>{void 0!==t&&(t.status&&(n.show=t.status),t.label&&(n.status=t.label),t.metadata&&(n.metadata=g._merge({$attributes:{xmlns:g.NAMESPACES.CT_METADATA}},t.metadata))),e(n)}).catch(e=>{this._onError("Couldn't get chat status to construct presence object!",e),t(e)})})}sendPresence(){return this._sendPresence()}uploadAttachment(e){if(!this._options.uploadHost)throw new Error("Cannot send attachments without a upload host configured.");let t=o.Promise.resolve(),n=null;return this._sso&&(t=t.then(()=>this.refreshOAuthAndSave())),t=t.then(()=>new o.Promise((t,i)=>{a.getFileInfo(e).then(e=>{n=e,t()}).catch(i)})).then(()=>new o.Promise((e,t)=>{a.getFileSize(n).then(i=>{const o={$attributes:{id:this.getUniqueId(),to:this._options.uploadHost,from:this._jid,type:"get",xmlns:g.NAMESPACES.JABBER_CLIENT},request:{$attributes:{xmlns:g.NAMESPACES.HTTP_UPLOAD},filename:n.name.replace(".encrypted",""),size:""+i,"content-type":n.type}};this.sendIq(this._options.uploadHost,"get",o).then(e).catch(t)}).catch(e=>{console.error(`Couldn't get file size for file with name '${n.name}'.`,e),t(e)})})).then(e=>new o.Promise(t=>{!0===this._options.authAttachments?this._getCacheItem("user_password").then(e=>this._embellishPasswordWithAdToken(e)).then(i=>{t([e,{Authorization:"Basic "+btoa(this._bareJid+":"+i),"Content-Type":n.type}])}):t([e,{"Content-Type":n.type}])})).then(e=>{const t=e[0],i=e[1];return new o.Promise((e,o)=>{const s=t.iq.slot.put,r=t.iq.slot.get;a.upload(n.path,s,r,i).then(()=>{this._dispatchEvent(g.EVENT_TYPES.UPLOAD_SUCCESS,n.path),e(r)}).catch(e=>{this._dispatchEvent(g.EVENT_TYPES.UPLOAD_FAILED,n.path);const t=`Couldn't successfully upload file '${n.path}' to the server:`;this._onError(t,e),o({error:t})})})}),new o.Promise((e,n)=>t.then(()=>{e()}).catch(n))}_sendPresence(){return this._log("Sending presence..."),new o.Promise((e,t)=>{this._log("Creating presence object..."),this._createPresenceObject().then(n=>{this._log("Presence object created:",n),this.sendStanza(n,!1,"presence",!1,!1).then(()=>{this._log("Presence sent!"),this._log("Sending presence for all rooms...");const i=[];for(let e in this._joinedRooms)n.$attributes.to=`${e}@${this._options.mucHost}`,n.x={$attributes:{xmlns:g.NAMESPACES.MUC}},i.push(this.sendStanza(n,!1,"presence",!1,!1));o.Promise.all(i).then(()=>{this._log("Finished sending presence(s)."),e()}).catch(e=>{this._onError("Couldn't send all presence objects:",e),t(e)})}).catch(e=>{this._onError("Couldn't send initial presence object:",e),t(e)})}).catch(e=>{this._onError("Couldn't create presence object:",e),t(e)})})}getAppConfig(){return new o.Promise((e,t)=>{this.sendIq(this._domain,"get",{query:{$attributes:{xmlns:"urn:commontime:infinity:appcfg"}}}).then(n=>{try{e(JSON.parse(h.minifyJson(n.iq.json.$value)))}catch(e){this._onError("Couldn't convert app config to JSON:",e),t(e)}}).catch(e=>{this._onError("Error while fetching app config:",e),t(e)})})}getServerTime(){return this._isMethodReady(!0,!0),new o.Promise((e,t)=>{this.sendIq(this._domain,"get",{time:{$attributes:{xmlns:g.NAMESPACES.TIME}}}).then(t=>{if(void 0!==t.iq.time&&t.iq.time.utc){const e=new Date(t.iq.time.utc).valueOf(),n=Date.now();this._serverTimeDiff=e-n}e(this._serverTimeDiff)}).catch(t)})}getSyncedTimestamp(e){if(null===this._serverTimeDiff)return e;const t=Math.abs(this._serverTimeDiff);return this._serverTimeDiff>=0?e+t:e-t}refreshOAuthAndSave(){return new o.Promise((e,t)=>{this._sso?this.refreshOAuth().then(t=>{this._setCacheItem("user_password",t,!0).then(e)}).catch(e=>{e.logout&&this._dispatchEvent(g.EVENT_TYPES.FORCE_LOGGED_OUT,{error:e}),t(e)}):e()})}refreshOAuth(){return i(this,void 0,void 0,function*(){return new o.Promise((e,t)=>{if(!0===r.isElectron()){const n="REFRESH_CLIENT",i=window.require("electron").ipcRenderer;i.once(n,function(n,i){"oauth-refresh"===i.action?i.data.error?t(i.data.error):e(i.data):this._log("Incorrect reply from electron (refresh)")}),i.send(n,{action:"oauth-refresh"})}else{this._log("Refreshing OAuth Token."),l.getSource("CTOAuth").refresh(t=>{this._log("Token Refresh Complete"),e(t)},e=>{this._log("Token Refresh Failed: ",e),t(e)})}})})}clearOAuth(){return i(this,void 0,void 0,function*(){return this._sso?new o.Promise((e,t)=>{if(!0===r.isElectron()){const t="LOGOUT_CLIENT",n=window.require("electron").ipcRenderer;n.once(t,function(t,n){"oauth-logout"===n.action?e():this._log("Incorrect reply from electron (logout)")}),n.send(t,{action:"oauth-logout"})}else{const n=l.getSource("CTOAuth");n?n.logout(()=>{e()},e=>{t(e)}):t("No means to oauth")}}):o.Promise.resolve()})}discoverOAuth(e,t,n,s){return i(this,void 0,void 0,function*(){return new o.Promise((i,o)=>{if(!0===r.isElectron()){const o="CONFIGURE_CLIENT",r=window.require("electron").ipcRenderer;r.once(o,function(e,t){"oauth-configure"===t.action?i():this._log("Incorrect reply from electron (configure)")}),r.send(o,{action:"oauth-configure",data:{clientId:t,discovery:e,scopes:n,port:s}})}else{l.getSource("CTOAuth").configure({discovery:e,clientId:t,scopes:n},()=>{i()},e=>{o(e)})}})})}configureOAuth(e,t,n){return i(this,void 0,void 0,function*(){return new o.Promise((i,o)=>{l.getSource("CTOAuth").configure({authorize:e,token:t,clientId:n},()=>{i()},e=>{o(e)})})})}getOAauthIdToken(){return i(this,void 0,void 0,function*(){return new o.Promise((e,t)=>{if(!0===r.isElectron()){const n="GET_TOKEN_CLIENT",i=window.require("electron").ipcRenderer;i.once(n,function(n,i){"oauth-getIdToken"===i.action?i.data.error?t(i.data.error):e(i.data.idToken):this._log("Incorrect reply from electron (getIdToken)")}),i.send(n,{action:"oauth-getIdToken"})}else{l.getSource("CTOAuth").getIdToken(t=>{e(t)},e=>{t(e)})}})})}getOAuthJid(){return i(this,void 0,void 0,function*(){return new o.Promise((e,t)=>{if(!0===r.isElectron()){const t="GET_JID_CLIENT",n=window.require("electron").ipcRenderer;n.once(t,function(t,n){"oauth-getJid"===n.action?e(n.data):this._log("Incorrect reply from electron (getJid)")}),n.send(t,{action:"oauth-getJid"})}else{l.getSource("CTOAuth").getJid(t=>{e(t)},e=>{t(e)})}})})}sso(){return i(this,void 0,void 0,function*(){this._sso=!0,yield this._setCacheItem("sso",this._sso);const e=yield this.getOAauthIdToken(),t=yield this.getOAuthJid();return yield this._login(t,e,!1)})}login(e,t){return this._sso=!1,this._setCacheItem("sso",this._sso).then(()=>this._login(e,t,!1))}_login(e,t,n=!1){if(this._isMethodReady(!0),!e)throw new Error("Parameter 'jid' must be provided.");if(!t)throw new Error("Parameter 'password' must be provided.");return!0===this._reLoggingIn&&!1===n&&(this._clearReLoginTimeout(),this._reLoggingIn=!1),this._loggingOut=!1,new o.Promise((n,i)=>{this._getInstallId().then(()=>{this._getCacheItem("user_jid").then(a=>{if(!0===this.connected&&!0===this.loggedIn&&a===s.default.Strophe.getBareJidFromJid(e))n(!1);else{const l=s.default.Strophe.getResourceFromJid(e);if(null!==l)this.resource=l,this._jid=e,this._bareJid=s.default.getBareJidFromJid(this._jid);else{if(this._bareJid=e,!0===this._options.useEncodedJidAsResource)this.resource=btoa(this._bareJid);else{const e=localStorage.getItem(`${this._instanceId}_resource`);null===e?(this.resource=this._installId,localStorage.setItem(`${this._instanceId}_resource`,this.resource)):this.resource=e}this._jid=this._bareJid+"/"+this.resource}const c=()=>{this.loggedIn=!0,localStorage.removeItem(`${this._instanceId}_logging_in`)};this.username=s.default.Strophe.getNodeFromJid(this._jid),this._domain=this._bareJid.split("@")[1];const d=()=>{let s=!1;const a=null!==localStorage.getItem(`${this._instanceId}_logging_in`);a&&this._log("Previous login attempt failed, calling a force logout to clean-up."),this.logout(a,!0).then(()=>this._embellishPasswordWithAdToken(t)).then(e=>this._connect(this._jid,e).then(e=>{s="resumed"===e,localStorage.setItem(`${this._instanceId}_logging_in`,"true")})).then(()=>new o.Promise((e,t)=>{this.checkForUpdate().then(({available:n,required:i})=>{n&&i?t({msg:p.UpdateHelper.UPDATE_REQUIRED_ERROR}):e()})})).then(()=>!1===s&&!0===this._options.enableMessageCarbons?this._enableMessageCarbons():o.Promise.resolve()).then(()=>this.getServerTime()).then(()=>{if("android"===r.getPlatformName()){if(!window.PushNotification||!window.PushNotification.syncTime)return o.Promise.resolve();window.PushNotification.syncTime(()=>o.Promise.resolve(),()=>o.Promise.reject("Unable to send synced time to push plugin"),this._serverTimeDiff)}else{if(!window.appgroup||!window.appgroup.add)return o.Promise.resolve();window.appgroup.add(e=>o.Promise.resolve(),e=>o.Promise.reject(`Could not add synced time to app group storage. ${e}`),"serverTimeDiff",this._serverTimeDiff)}}).then(()=>!1===s?this._setCacheItem("user_jid",this._bareJid):o.Promise.resolve()).then(()=>new o.Promise((e,n)=>{!1!==s||!0!==this._options.autoReconnect&&!0!==this._options.autoLogin&&!0!==this._options.authAttachments?e():this._setCacheItem("user_password",t,!0).then(e).catch(n)})).then(()=>s?void 0:o.Promise.all([this._makeContactsOffline(),this._makeParticipantsOffline()])).then(()=>new o.Promise((e,t)=>{!s&&this.isPushEnabled()?this._getPushTokens().then(e=>this.registerForPush(e)).then(()=>{e()}).catch(t=>{this._log("Failed to register for push: "+t),e()}):e()})).then(()=>this._initialisePing()).then(()=>!0===this._options.updateUserDirectoryOnLogin?this.updateUserDirectory():o.Promise.resolve()).then(()=>!1===s&&!1!==this._options.updateRosterOnLogin?this._getCacheItem("roster_version").then(e=>this.sendIq(this._bareJid,"get",{query:{$attributes:{xmlns:"jabber:iq:roster",ver:e||""}}})):o.Promise.resolve()).then(e=>this._processRoster(e)).then(()=>new o.Promise((e,t)=>{if(!1===s&&!1!==this._options.mam.auto){const n=this.getLastArchiveId();this.listSubscriptions().then(i=>{const s=[];i.forEach(e=>{s.push(this.queryMamByRoomName(e.name,!0,n))}),o.Promise.all(s).then(()=>{this.queryMam(null,n).then(e).catch(e=>{this._onError("Unable to query the MAM for missed messages.",e),t(e)})}).catch(e=>{this._onError("Unable to query the MAM for missed messages in a subscribed room.",e),t(e)})}).catch(e=>{this._onError("Unable to get a list of subscriptions.",e),t(e)})}else e()})).then(()=>{"ios"===r.getPlatformName()&&window.VoIPPushNotification.suppressProcessing(!1,function(){}),"android"===r.getPlatformName()&&window.PushNotification&&window.PushNotification.suppressProcessing&&window.PushNotification.suppressProcessing(()=>{this._log("Suppress push notifications: false")},()=>{this._log("Failed to suppress push notifications: false")},!1),c(),n(s)}).catch(t=>{null!==this._connection&&!0===this._connection.connected&&(this._connection._doDisconnect(),this._connection=null),this._onError(`Unable to complete login process with JID '${e}'.`,t.msg),i(t)})};void 0!==a&&a!==this._bareJid?this._clearDbsForNewUser().then(()=>{d()}):d()}}).catch(i)}).catch(i)})}isPushEnabled(){return!(!this._options.push.androidEnabled||"android"!==r.getPlatformName())||!(!this._options.push.iosEnabled||"ios"!==r.getPlatformName())}logout(e=!1,t=!1){return new o.Promise((n,i)=>{const s=()=>{this._joinedRooms={},this._reLoggingIn=!1,this.connected=!1,this.loggedIn=!1,this._push=null,this._stopPing(),this._clearReLoginTimeout(),!0!==t&&("ios"===r.getPlatformName()&&window.VoIPPushNotification.suppressProcessing(!0,function(){}),"android"===r.getPlatformName()&&window.PushNotification&&window.PushNotification.suppressProcessing&&window.PushNotification.suppressProcessing(()=>{this._log("Suppress push notifications: true")},()=>{this._log("Failed to suppress push notifications: true")},!0)),localStorage.removeItem(`${this._instanceId}_logging_in`);const e=[this._deleteCacheItem("stream_management_id"),this.clearOAuth()];!0!==t&&e.push(this._deleteCacheItem("user_password")),o.Promise.all(e).then(()=>{this._loggingOut=!1,n()}).catch(i)};if(!0===e||!1!==this.connected&&!0!==this._loggingOut)if(null!==this._connection&&!0===this._connection.connected&&!1===this._loggingOut){this._loggingOut=!0;const e=()=>{this._stopPing(),this._clearReLoginTimeout(),this._connection.disconnect("user_logout"),this._connection=null,s()};this.isPushEnabled()?this.disablePush().then(()=>{e()}).catch(t=>{this._log(`Unable to disable push notifications: ${t}`),e()}):e()}else s();else n()})}forceLogout(){return new o.Promise((e,t)=>{this._forcedLogout=!0,this._loggingOut=!0,this._joinedRooms={},this._reLoggingIn=!1,this.connected=!1,this.loggedIn=!1,this._stopPing(),this._clearReLoginTimeout(),localStorage.removeItem(`${this._instanceId}_logging_in`),this._connection&&(this._connection.disconnect("user_logout"),this._connection=null),o.Promise.all([this._deleteCacheItem("stream_management_id"),this._deleteCacheItem("user_password")]).then(()=>{this._loggingOut=!1,e()}).catch(t)})}resendMessage(e,t=null){return this._isMethodReady(!0,!0),new o.Promise((n,i)=>{this.getMessageById(e).then(o=>{this._log(`Resending message with ID '${e}':`,o);const s={$attributes:{id:o._id,to:o.recipient_id,from:o.sender_id,type:o.type,xmlns:g.NAMESPACES.JABBER_CLIENT},markable:{$attributes:{xmlns:g.NAMESPACES.CHAT_MARKERS}},body:o.body,data:o.data,attachments:[]};void 0!==o.addresses&&(s.addresses={$attributes:{xmlns:g.NAMESPACES.ADDRESS},address:o.addresses}),o.attachments.forEach(e=>{s.attachments.push({name:e.name,type:e.type,size:""+e.size,get:e.get})}),t&&t!==this._bareJid&&(s.actingDelegate=this._bareJid),this.sendStanza(s,!0,"message",!0,!0,t).then(()=>{n(o)}).catch(i)}).catch(i)})}_stanzaResponseHandler(e,t){this._sendTimeouts[e]&&(this._log(`Clearing send timeout for message with ID '${e}'.`),this._sendTimeouts[e].cancel(),delete this._sendTimeouts[e]),t?this._rejectSendStanzaPromise(e,t):this._resolveSendStanzaPromise(e)}_resolveSendStanzaPromise(e,t){this._sendStanzaPromises[e]&&(this._log(`Resolving send stanza promise for message with ID '${e}'.`),this._sendStanzaPromises[e].resolve(t),delete this._sendStanzaPromises[e],this._sendTimeouts[e]&&delete this._sendTimeouts[e])}_rejectSendStanzaPromise(e,t){this._sendStanzaPromises[e]&&(this._log(`Rejecting send stanza promise for message with ID '${e}'.`),this._sendStanzaPromises[e].reject({message:{_id:e}}),delete this._sendStanzaPromises[e],this._sendTimeouts[e]&&delete this._sendTimeouts[e])}sendStanza(e,t=!0,n="message",i=!0,s=!0,r=null){return this._isMethodReady(!0,!0),new o.Promise((o,a)=>{e.$attributes||(e.$attributes={}),void 0===e.$attributes.id&&(e.$attributes.id=this.getUniqueId());let l=e.$attributes.id;if(!0===this.connected&&null!==this._connection){this._sendStanzaPromises[l]={resolve:o,reject:a},this._sendTimeouts[l]=new c.default(l,()=>{const t=`${n.replace(/^\w/,e=>e.toUpperCase())} with ID '${l}' was not received by the server within ${this._options.sendTimeout}ms.`;this._log(t,e),this._rejectSendStanzaPromise(l,t)},this._options.sendTimeout,s);try{void 0===e.$attributes&&(e.$attributes={}),void 0===e.$attributes.from&&(e.$attributes.from=this._jid),!0===t&&(e.store={$attributes:{xmlns:g.NAMESPACES.HINTS},$value:""}),!0===i&&(e.timestamp={$attributes:{xmlns:g.NAMESPACES.CT_CLIENT_TIMESTAMP},$value:Date.now()});let o=null;if("message"===n&&r&&this._bareJid!==r){delete e.$attributes.from;let t={$attributes:{to:this.getFullDelegateJid(r)},send:{$attributes:{xmlns:g.NAMESPACES.DELEGATE}}};t.send[n]=e,o=g.jsonToXml("message",t)}else o=g.jsonToXml(n,e);this._connection.send(o)}catch(e){const t=`Unable to send XMPP ${n}`;this._onError(t,e),this._rejectSendStanzaPromise(l,t)}}else{const e="You're not currently connected, please connect and try again.";this._onError(e),this._rejectSendStanzaPromise(l,e)}})}_sendMessageWithAttachments(e,t,n=null){if(!this._options.uploadHost)throw new Error("Cannot send attachments without a upload host configured.");this._log(`Sending message with ID ${e._id} with attachments:`,t);let i=o.Promise.resolve({});return t.forEach((t,n)=>{i=i.then(()=>new o.Promise((e,n)=>{a.getFileSize(t).then(i=>{const o={$attributes:{id:this.getUniqueId(),to:this._options.uploadHost,from:this._jid,type:"get",xmlns:g.NAMESPACES.JABBER_CLIENT},request:{$attributes:{xmlns:g.NAMESPACES.HTTP_UPLOAD},filename:t.name.replace(".encrypted",""),size:""+i,"content-type":t.type}};this.sendIq(this._options.uploadHost,"get",o).then(e).catch(n)}).catch(e=>{console.error(`Couldn't get file size for file with name '${t.name}'.`,e),n(e)})})).then(e=>new o.Promise(n=>{!0===this._options.authAttachments?this._getCacheItem("user_password").then(e=>this._embellishPasswordWithAdToken(e)).then(i=>{n([e,{Authorization:"Basic "+btoa(this._bareJid+":"+i),"Content-Type":t.type}])}):n([e,{"Content-Type":t.type}])})).then(e=>new o.Promise((t,n)=>{this._sso?this.refreshOAuthAndSave().then(()=>{t(e)}).catch(n):t(e)})).then(n=>{const i=n[0],s=n[1];return new o.Promise((n,o)=>{const r=i.iq.slot.put,l=i.iq.slot.get;a.upload(t.path,r,l,s).then(()=>{this._dispatchEvent(g.EVENT_TYPES.UPLOAD_SUCCESS,e),n(["transferred",l,r])}).catch(n=>{this._dispatchEvent(g.EVENT_TYPES.UPLOAD_FAILED,e);const i=`Couldn't successfully upload file '${t.path}' to the server:`;this._onError(i,n),o({error:i,message:e})})})}).then(t=>{const i=t[0],s=t[1],a=t[2];return new o.Promise((t,o)=>{this.saveMessage(e._id,e=>(e.attachments[n].state=i,e.attachments[n].get=s,e.attachments[n].put=a,r.isBrowser()&&(e.attachments[n].path=s),e)).then(t).catch(o)})})}),i.then(()=>this.resendMessage(e._id,n))}_prepareMessageAttachmentsForSend(e,t,n=null){return this._log("Preparing to send the following attachments:",t),new o.Promise((i,s)=>{const r=[];t.forEach(e=>{r.push(new o.Promise((t,n)=>{this._log("Getting file information for file:",e),a.getFileInfo(e).then(e=>{this._log("Got file info for file:",e),t(Object.assign({get:"",put:"",state:"transferring"},e))}).catch(n)}))}),o.Promise.all(r).then(t=>{this._messageStanzaToDbObject({message:e},{mine:!0,attachments:t},n).then(e=>{this._dispatchEvent(g.EVENT_TYPES.UPLOAD_STARTED,e),this._sendMessageWithAttachments(e,t,n).then(i).catch(s)}).catch(s)})})}sendChatMessage(e,t,n,i=[],s=!0,r=null){if(this._isMethodReady(!0,!0),!e)throw new Error("Parameter 'to' is required.");if(this._options.mucHost&&e.indexOf(this._options.mucHost)>-1)throw new Error("You are trying to send a peer-to-peer chat message to a room, please use the 'sendGroupChatMessage' method instead.");return new o.Promise((o,r)=>{const a={$attributes:{id:this.getUniqueId(),from:this._jid,to:e,type:"chat",xmlns:g.NAMESPACES.JABBER_CLIENT}};!0===s&&(a.markable={$attributes:{xmlns:g.NAMESPACES.CHAT_MARKERS}}),null!==t&&(a.body=t),null!==n&&(a.data=n),!i||i.length<1?this.sendMessage(a).then(o).catch(r):this._prepareMessageAttachmentsForSend(a,i).then(o).catch(r)})}sendMulticastMessage(e,t,n,i=[],s=!0){return this._isMethodReady(!0,!0),new o.Promise((o,r)=>{const a={$attributes:{id:this.getUniqueId(),from:this._jid,to:`${this._options.multicastHost}`,type:"chat",xmlns:g.NAMESPACES.JABBER_CLIENT},addresses:{$attributes:{xmlns:g.NAMESPACES.ADDRESS},address:e.map(e=>({$attributes:e}))}};!0===s&&(a.markable={$attributes:{xmlns:g.NAMESPACES.CHAT_MARKERS}}),null!==t&&(a.body=t),null!==n&&(a.data=n),!i||i.length<1?this.sendMessage(a).then(o).catch(r):this._prepareMessageAttachmentsForSend(a,i).then(o).catch(r)})}sendGroupChatMessage(e,t,n,i=[],s=!0,r=!1,a=null){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error("'mucHost' must be provided as an option.");if(!e)throw new Error("Parameter 'roomName' is required.");return new o.Promise((o,l)=>{const c={$attributes:{id:this.getUniqueId(),from:this._jid,to:`${e}@${this._options.mucHost}`,type:"groupchat",xmlns:g.NAMESPACES.JABBER_CLIENT}};!0===s&&(c.markable={$attributes:{xmlns:g.NAMESPACES.CHAT_MARKERS}}),null!==t&&(c.body=t),null!==n&&(c.data=n),!0!==r&&(c.exclude={$attributes:{xmlns:g.NAMESPACES.INFINITY_MAM,archive:"user"}}),a&&a!==this._bareJid&&(c.actingDelegate=this._bareJid),!i||i.length<1?this.sendMessage(c,a).then(o).catch(l):this._prepareMessageAttachmentsForSend(c,i,a).then(o).catch(l)})}sendMessage(e,t=null){return new o.Promise((n,i)=>{this._messageStanzaToDbObject({message:e},{state:{sent:!1},mine:!0},t).then(o=>{this.sendStanza(e,!0,"message",!0,!0,t).then(()=>{this.saveMessage(o._id,e=>(e.state.sent=!0,e)).then(n).catch(i)}).catch(i)}).catch(i)})}sendIq(e,t,n,i=this._options.sendTimeout||25e3,r,a=null){const l=void 0===r?this.getUniqueId():r;return new o.Promise((o,r)=>{try{this._isMethodReady(!0,!0)}catch(e){return void r(e)}const c=e=>{e.id===s.default.Strophe.Status.DISCONNECTED&&(this.removeEventListener(g.EVENT_TYPES.STATUS,c),this._initialisePing(),r("Disconnected during IQ request."))};this.addEventListener(g.EVENT_TYPES.STATUS,c);let d=null,h=null;try{h={$attributes:{id:l,type:t,from:this._connection.jid}},e&&(h.$attributes.to=e);for(let e in n)h[e]=n[e];a&&this._bareJid!==a?(delete h.$attributes.from,h={$attributes:{to:this.getFullDelegateJid(a)},send:{$attributes:{xmlns:g.NAMESPACES.DELEGATE},iq:h}},d=g.jsonToXml("message",h)):d=g.jsonToXml("iq",h)}catch(e){this._onError("Couldn't construct IQ message:",e),r(e)}if(null!==h&&null!==d)if(a&&this._bareJid!==a){const e=e=>{e.recv&&e.recv.iq?(e.recv.iq.data&&(e.recv.iq.data.delegate=a),o(e.recv)):o(e)};this._delegatedIQListenerAdded||this.addEventListener(g.EVENT_TYPES.DELEGATEIQ,e),this._connection.send(d)}else this._connection.sendIQ(d,e=>{try{this.removeEventListener(g.EVENT_TYPES.STATUS,c),o(g.xmlToJson(e))}catch(e){this._onError("Couldn't convert IQ response to JSON.",e),r(e)}},e=>{null===e?(this._onError(`IQ Send timed out (${i})`),r("IQ Send timed out")):r(e)},i)})}getFullDelegateJid(e){return`relay@delegate.${this._domain}/${e}`}destructDelegateJid(e){const t=e.split("/");return{userJid:t[2],delegateJid:t[0],resource:t[3]}}getPrivateData(){this._isMethodReady(!0,!0),this._log("Fetching Private XML Data for:",this._bareJid);const e={privatexmldata:{$attributes:{xmlns:g.NAMESPACES.CT_PRIVATE_XML_STORAGE}}};return new o.Promise((t,n)=>this._getPrivateXMLStorage(e).then(e=>{void 0!==e&&void 0!==e.privatexmldata&&void 0!==e.privatexmldata.json?t(JSON.parse(e.privatexmldata.json)):n("No private data found, or unable to fetch")}))}_getPrivateXMLStorage(e){return this._log("Fetching Private XML Storage Data for: ",this._bareJid),new o.Promise((t,n)=>{this.sendIq(this._bareJid,"get",{query:Object.assign({$attributes:{xmlns:g.NAMESPACES.PRIVATE_XML_STORAGE}},e)}).then(e=>{this._log("Fetched Private XML Storage Data for:",this._bareJid),t(e.iq.query)}).catch(e=>{n("Unable to send IQ for Private XML Storage")})})}setPrivateData(e){this._isMethodReady(!0,!0),this._log("Setting Private XML data for:",this._bareJid);const t=JSON.stringify(e),n={privatexmldata:{$attributes:{xmlns:g.NAMESPACES.CT_PRIVATE_XML_STORAGE},json:t}};return this._setPrivateXMLStorage(n)}_setPrivateXMLStorage(e){const t={query:Object.assign({$attributes:{xmlns:g.NAMESPACES.PRIVATE_XML_STORAGE}},e)};return new o.Promise((e,n)=>{this.sendIq(null,"set",t).then(t=>{e(),this._log("Set Private XML Storage for:",this._bareJid)}).catch(n)})}_getvCard(e){return this._log(" Fetching vCard for:",e),new o.Promise((t,n)=>{this.sendIq(e,"get",{vCard:{$attributes:{xmlns:"vcard-temp"}}}).then(n=>{this._log("Fetched vCard for:",e),t(n.iq.vCard)}).catch(e=>{n("Unable to send IQ for vCard")})})}_setvCard(e,t){this._log(" Setting vCard for:",e);const n=(new DOMParser).parseFromString(t,"text/xml"),i=g.xmlToJson(n);return new o.Promise((t,n)=>{this.sendIq(null,"set",i["#document"]).then(n=>{t(),this._log(" Set vCard for:",e)}).catch(n)})}addEventListener(e,t){if(!g._validateEventType(e))throw new Error("Invalid event type provided.");e===g.EVENT_TYPES.INITIALISED&&!0===this._initialised?t(null):(void 0===this._eventListeners[e]&&(this._eventListeners[e]=[]),this._eventListeners[e].push(t))}removeEventListener(e,t){if(!g._validateEventType(e))throw new Error("Invalid event type provided.");void 0!==this._eventListeners[e]&&this._eventListeners[e].forEach((n,i)=>{n===t&&this._eventListeners[e].splice(i,1)})}_searchDb(e,t,n,i,s,r){return new o.Promise((o,a)=>{const l=[];for(let e in t)0!==e.indexOf("$")?l.push(e):["$or","$and","$not","$nor","$all"].indexOf(e)>-1&&Array.isArray(t[e])&&t[e].length>0&&t[e].forEach(e=>{for(let t in e)l.push(t)});l.length>0&&e.createIndex({index:{fields:l}}).then(()=>{let l={selector:t};Array.isArray(n)&&n.length>0&&(l.sort=n),Array.isArray(i)&&i.length>0&&(l.fields=i),r&&(l.skip=r),s&&(l.limit=s),e.find(l).then(e=>{o(e.docs)}).catch(a)}).catch(a)})}findMessages(e,t,n,i,o){return this._isMethodReady(!0),this._searchDb(this._msgDb,e,t,n,i,o)}getAllMessageIds(){return this._isMethodReady(!0),new o.Promise((e,t)=>{this._msgDb.allDocs().then(t=>{let n=[];t.rows&&t.rows.length>0&&(n=t.rows.map(e=>e.id)),e(n)}).catch(t)})}getAllMessages(){return this._isMethodReady(!0),new o.Promise((e,t)=>{this._msgDb.allDocs({include_docs:!0}).then(t=>{const n=t.rows.map(e=>e.doc);e(n)}).catch(t)})}getChatHistory(e,t,n,i,s){this._isMethodReady(!0);let r={$or:[{sender_id:e},{recipient_id:e}]};return!0===n&&(r["state.read"]=!0),new o.Promise((e,n)=>{this.findMessages(r,t,null,i,s).then(t=>{const n=t.sort((e,t)=>e.ts-t.ts);e(n)}).catch(n)})}getMessagesById(e){return this._msgDb.allDocs({include_docs:!0}).then(t=>t.rows.filter(t=>e.includes(t.id)))}getMessageById(e){if(this._isMethodReady(!0),!e)throw new Error("A message ID must be provided.");return this._msgDb.get(e)}deleteMessage(e,t=!0){return this._isMethodReady(!0),new o.Promise((n,i)=>{if(this._currentlyDeleting.indexOf(e._id)>-1)return n();if(this._currentlyDeleting.push(e._id),e){const s=[];t&&void 0!==e.attachments&&e.attachments.forEach(e=>{void 0!==e.path&&s.push(new o.Promise(t=>("ios"!==r.getPlatformName()||e.path.includes("file://")||(e.path=`file://${e.path}`),a.deleteFile(e.path).then(t).catch(n=>{this._onError(`Couldn't delete attachment: '${e.name}':`,n),t()}))))}),o.Promise.all(s).then(()=>{this._msgDb.remove(e).then(()=>{if(this._log("Message successfully deleted with ID:",e._id),"android"===r.getPlatformName()&&window.PushNotification&&window.PushNotification.removeFromIgnoreList&&e.data&&e.data.conversationstarted){const t=JSON.parse(e.data.conversationstarted).started;window.PushNotification.removeFromIgnoreList(()=>{},()=>{},t)}if("ios"===r.getPlatformName()&&window.VoIPPushNotification&&window.VoIPPushNotification.removeFromIgnoreList&&e.data&&e.data.conversationstarted){const t=JSON.parse(e.data.conversationstarted).started;window.VoIPPushNotification.removeFromIgnoreList(t,()=>{},()=>{})}n()}).catch(t=>{this._onError(`Couldn't delete message with ID '${e._id}'.`,t),i(t)})}).catch(t=>{this._onError(`Couldn't delete attachment(s) for message with ID '${e._id}':`,t),i(t)})}else n()}).then(()=>{const t=this._currentlyDeleting.indexOf(e._id);t>-1&&this._currentlyDeleting.splice(t,1)}).catch(()=>{const t=this._currentlyDeleting.indexOf(e._id);t>-1&&this._currentlyDeleting.splice(t,1)})}deleteMessageById(e,t=!0){return this._isMethodReady(!0),this._log("Deleting message with ID:",e),new o.Promise((n,i)=>{this.getMessageById(e).then(e=>{this.deleteMessage(e,t).then(n).catch(i)}).catch(t=>{this._onError(`Couldn't get message with ID '${e}' to delete it.`,t),i(t)})})}deleteMessages(e){return this._isMethodReady(!0),new o.Promise((t,n)=>{this._searchDb(this._msgDb,e).then(e=>{const i=Array.isArray(e)?e.length:0;this._log(" There are "+i+" messages to delete");const s=[];e.forEach(e=>{s.push(this.deleteMessage(e))}),o.Promise.all(s).then(t).catch(e=>{this._onError("Couldn't delete messages from database.",e),n(e)})})})}deleteMessagesByRoom(e){return console.warn("This method is going to be DEPRECATED, please use 'deleteMessagesByRoomName' instead."),this.deleteMessages({$or:[{sender_id:e},{recipient_id:e}]})}deleteMessagesByRoomName(e){if(!this._options.mucHost)throw new Error("mucHost must be provided as an option.");return this.deleteMessages({$or:[{sender_id:`${e}@${this._options.mucHost}`},{recipient_id:`${e}@${this._options.mucHost}`}]})}saveMessage(e,t){return this._isMethodReady(!0),new o.Promise((n,i)=>{this._saveObject(g.OBJECT_TYPES.MESSAGE,e,t,e=>{n(e)},e=>{i(e)})})}_clearDbsForNewUser(){return new o.Promise((e,t)=>{this.destroyDbs(!1).then(()=>{this._setCacheItem("sso",this._sso).then(()=>{this._dispatchEvent(g.EVENT_TYPES.AUTO_DBS_DESTROYED,null),e()})}).catch(t)})}destroyDbs(e=!0,t=!1){return new o.Promise((n,i)=>{if(this._destroyingDbs)return void n();this._log(" Destroying all databases and data..."),this._destroyingDbs=!0,this._lastArchiveId=null,localStorage.removeItem(`${this._instanceId}_last_archive_id`),this.resource=null,this._voip=null,localStorage.removeItem(`${this._instanceId}_resource`),localStorage.removeItem(`${this._instanceId}_counters`),!0!==t&&localStorage.removeItem(`${this._instanceId}_key`),localStorage.removeItem(`${this._instanceId}_logging_in`),localStorage.removeItem(`${this._instanceId}_presence_needed`);const s=[this._msgDb.destroy(),this._contactDb.destroy(),this._roomDb.destroy(),this._participantDb.destroy()];!1!==l.getSource("file")&&s.push(a.deleteAttachments()),!0!==t&&s.push(this._cacheDb.destroy()),s.push(new o.Promise((e,t)=>{this._userDirectory.initialised?(localStorage.removeItem(`${this._instanceId}_ud_iv`),this._userDirectory.destroy().then(()=>{e()}).catch(t)):e()})),o.Promise.all(s).then(()=>{this._initDbs().then(()=>{!0===e&&this._dispatchEvent(g.EVENT_TYPES.DBS_DESTROYED,null),this._log(" Successfully destroyed all data."),this._destroyingDbs=!1,n()}).catch(e=>{this._destroyingDbs=!1,i(e)})}).catch(e=>{this._destroyingDbs=!1,i(e)})})}deleteAttachments(){return a.deleteAttachments()}deleteFile(e){return new o.Promise((t,n)=>{if(void 0!==e)return"ios"!==r.getPlatformName()||e.includes("file://")||(e=`file://${e}`),a.deleteFile(e).then(t).catch(n=>{this._onError(`Couldn't delete attachment at: '${e}':`,n),t()});t()})}setChatStatus(e,t,n,i){return this._isMethodReady(!0),new o.Promise((o,s)=>{if(g._validateChatStatus(e)){const r={status:e,label:t,metadata:i};if(!r.label)switch(e){case g.CHAT_STATUSES.CHAT:r.label="Available";break;case g.CHAT_STATUSES.AWAY:r.label="Away";break;case g.CHAT_STATUSES.XA:r.label="Extended Away";break;case g.CHAT_STATUSES.DND:r.label="Do Not Disturb"}this._setCacheItem("chat_status",r).then(()=>{!0===n?this._sendPresence().then(()=>o(r)).catch(s):o(r)}).catch(s)}else s("Invalid chat status provided, one of 'away', 'chat', 'dnd' or 'xa' should be specified.")})}getChatStatus(){return this._isMethodReady(!0),this._getCacheItem("chat_status")}setClientState(e){if(this._isMethodReady(!0,!0),!g._validateConstants(g.CLIENT_STATES,e))throw new Error("Invalid client state specified.");const t=g.jsonToXml(e,{$attributes:{xmlns:g.NAMESPACES.CLIENT_STATE_INDICATION}});return this._connection.send(t)}findContacts(e,t,n,i,o){return this._isMethodReady(!0),this._searchDb(this._contactDb,e,t,n,i,o)}getContacts(){return this._isMethodReady(!0),new o.Promise((e,t)=>{this._contactDb.allDocs({include_docs:!0}).then(t=>{const n=t.rows.filter(e=>!e.doc.language).map(e=>e.doc);e(n)}).catch(e=>{this._onError("Unable to get contacts from database.",e),t(e)})})}_embellishPasswordWithAdToken(e){if(!e)throw new Error("Password must be provided.");return new o.Promise((t,n)=>{if(!0===r.isElectron()&&!0===r.isWindows()&&this._options.adTokenPlaceholder&&this._options.adSecurityPackage&&this._options.adSpn&&e.indexOf(this._options.adTokenPlaceholder)>-1){const i=l.getSource("sspiclient");!1!==i?i.Helper.getUserToken(n=>{t(e.replace(this._options.adTokenPlaceholder,n))},n,this._options.adSpn,this._options.adSecurityPackage):n("Couldn't access sspiclient plugin.")}else t(e)})}_shouldMarkMessage(e,t){let n=!0;return!1!==e.markable&&(e.state.markers.every(i=>{if(i.type===t){if("groupchat"===e.type&&i.sender_resource===this.username)return n=!1,!1;if(i.sender_id===this._jid)return n=!1,!1}return!0}),n)}_markMessage(e,t,n=!0){return new o.Promise((i,o)=>{if(!0===e.mine||!1===this._shouldMarkMessage(e,t))i(e);else{const r={$attributes:{id:this.getUniqueId(),to:s.default.Strophe.getBareJidFromJid(e.stanza.message.$attributes.from),from:this._connection.jid},timestamp:{$attributes:{xmlns:g.NAMESPACES.CT_CLIENT_TIMESTAMP},$value:Date.now()}};r[t]={$attributes:{xmlns:g.NAMESPACES.CHAT_MARKERS,id:e._id}},"groupchat"===e.type&&(r.$attributes.type="groupchat"),this.sendStanza(r).then(()=>{this.saveMessage(e._id,e=>(e.state[t]=!0,e)).then(e=>{!1!==n&&this._dispatchEvent(g.EVENT_TYPES.MESSAGE_UPDATED,e),i(e)}).catch(o)}).catch(o)}})}markMessageRead(e){if(this._isMethodReady(!0,!0),!r.isDevice()||!h.isInBackground())return this._markMessage(e,g.MARKER_TYPES.READ)}markMessageReadById(e){return this._isMethodReady(!0,!0),this.getMessageById(e).then(e=>this.markMessageRead(e))}markMessageAcknowleged(e){return this._isMethodReady(!0,!0),this._markMessage(e,g.MARKER_TYPES.ACKNOWLEDGED)}markMessageAcknowledgedById(e){return this._isMethodReady(!0,!0),this.getMessageById(e).then(e=>this.markMessageAcknowleged(e))}_dispatchEvent(e,t){if(!g._validateEventType(e))throw new Error("Invalid event type provided.");void 0!==this._eventListeners[e]&&this._eventListeners[e].forEach(e=>{e(t)})}createRoom(e){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error("mucHost must be provided as an option.");return new o.Promise((t,n)=>{const i=`${e}@${this._options.mucHost}`;let o={$attributes:{to:`${i}/${this.username}`,xmlns:g.NAMESPACES.JABBER_CLIENT},x:{$attributes:{xmlns:g.NAMESPACES.MUC}}};this._connection.addHandler(o=>{const s=g.xmlToJson(o);if(void 0!==s.$attributes&&"error"===s.$attributes.type){const t=new Error(`Failed to create room '${e}'.`);this._onError(`Unable to create room with name '${e}'.`,t),n(t)}else this.sendIq(i,"get",{query:{$attributes:{xmlns:g.NAMESPACES.MUC_OWNER}}}).then(()=>{this.sendIq(i,"set",{query:{$attributes:{xmlns:g.NAMESPACES.MUC_OWNER},x:{$attributes:{xmlns:g.NAMESPACES.X_DATA,type:"submit"},field:[{$attributes:{var:"muc#roomconfig_whois"},value:"anyone"}]}}}).then(()=>{this._log(`Room '${e}' successfully created.`),t()}).catch(e=>n)}).catch(e=>n);return!1},g.NAMESPACES.MUC,"presence",null,null,`${i}/${this.username}`,{ignoreNamespaceFragment:!0}),this._connection.send(g.jsonToXml("presence",o))})}destroyRoom(e){if(this._isMethodReady(!0,!0),!e)throw new Error("Parameter 'roomName' must be provided.");if(!this._options.mucHost)throw new Error("mucHost must be provided as an option.");return new o.Promise((t,n)=>{this.sendIq(`${e}@${this._options.mucHost}`,"set",{query:{$attributes:{xmlns:g.NAMESPACES.MUC_OWNER},destroy:{}}}).then(()=>{t()}).catch(e=>n)})}listRooms(e){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error("mucHost must be provided as an option.");return new o.Promise((t,n)=>{const i=()=>{this._roomDb.allDocs({include_docs:!0}).then(e=>{const n=e.rows.map(e=>e.doc);t(n)}).catch(e=>{this._onError("Couldn't fetch list of rooms from database.",e),n(e)})};!0===this.connected&&!1!==e?this.sendIq(this._options.mucHost,"get",{query:{$attributes:{xmlns:"http://jabber.org/protocol/disco#items"}}}).then(e=>{if(e.iq&&e.iq.query&&e.iq.query.item){let r=[];r=Array.isArray(e.iq.query.item)?e.iq.query.item.map(e=>({_id:e.$attributes.jid,name:s.default.Strophe.getNodeFromJid(e.$attributes.jid)})):[{_id:e.iq.query.item.$attributes.jid,name:s.default.Strophe.getNodeFromJid(e.iq.query.item.$attributes.jid)}],this._roomDb.allDocs({include_docs:!0}).then(e=>{const t=[];e.rows.forEach(e=>{let n=e.doc,i=null;r.every(e=>e._id!==n._id||(i=e,!1)),null===i&&t.push(this._roomDb.remove(n))}),r.forEach(e=>{const n=new o.Promise((t,n)=>{this.saveRoom(e._id,t=>(void 0!==t._id?(t.name!==e.name&&(t.name=e.name),t.updated_at=this.getSyncedTimestamp(Date.now())):t={_id:e._id,name:e.name,ts:this.getSyncedTimestamp(Date.now()),updated_at:null},t)).then(t).catch(n)});t.push(n)}),o.Promise.all(t).then(()=>{i()}).catch(e=>{this._onError("Couldn't merge list of rooms from server with locally stored list of rooms.",e),n(e)})}),t(r)}else t([])}).catch(n):i()})}listSubscriptions(){return this._isMethodReady(!0,!0),new o.Promise((e,t)=>{this._options.mucHost?this.sendIq(this._options.mucHost,"get",{subscriptions:{$attributes:{xmlns:g.NAMESPACES.MUC_SUB}}}).then(t=>{let n=[];t.iq&&t.iq.subscriptions&&t.iq.subscriptions.subscription&&(Array.isArray(t.iq.subscriptions.subscription)?n=t.iq.subscriptions.subscription.map(e=>{if(e.$attributes&&e.$attributes.jid)return{name:s.default.Strophe.getNodeFromJid(e.$attributes.jid),jid:e.$attributes.jid}}):t.iq.subscriptions.subscription.$attributes&&t.iq.subscriptions.subscription.$attributes.jid&&(n=[{name:s.default.Strophe.getNodeFromJid(t.iq.subscriptions.subscription.$attributes.jid),jid:t.iq.subscriptions.subscription.$attributes.jid}])),e(n)}).catch(t):e([])})}joinRoom(e){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error("'mucHost' must be provided as an option.");if(!e)throw new Error("Parameter 'roomName' must be provided.");return new o.Promise((t,n)=>{const i=`${e}@${this._options.mucHost}`;this._createPresenceObject().then(o=>{o.$attributes.to=`${i}/${this.username}`,o.x={$attributes:{xmlns:g.NAMESPACES.MUC},history:{$attributes:{maxchars:0}}},this._connection.addHandler(o=>{try{const s=g.xmlToJson(o);s.presence&&void 0===s.presence.error?this.saveRoom(i,t=>(void 0!==t._id?t.name!==e&&(t.name=e,t.updated_at=this.getSyncedTimestamp(Date.now())):t={_id:i,name:e,ts:this.getSyncedTimestamp(Date.now()),updated_at:null},t)).then(i=>{this._joinedRooms[e]=Date.now(),!1!==this._options.mam.auto?this.queryMamByRoomName(e).then(()=>{t(i)}).catch(n):t(i)}).catch(n):(this._onError(`Couldn't join room '${e}' with nick '${this.username}'.`,o),n(o))}catch(e){this._onError("Couldn't convert stanza XML to JSON",e),n(e)}return!1},g.NAMESPACES.JABBER_CLIENT,"presence",null,null,`${e}@${this._options.mucHost}/${this.username}`,{ignoreNamespaceFragment:!0}),this._connection.send(g.jsonToXml("presence",o))})})}leaveRoom(e){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error("'mucHost' must be provided as an option.");if(!e)throw new Error("Parameter 'roomName' must be provided.");return new o.Promise(t=>{const n={$attributes:{from:this._jid,xmlns:g.NAMESPACES.JABBER_CLIENT,to:`${e}@${this._options.mucHost}/${this.username}`,type:"unavailable"}};this._connection.send(g.jsonToXml("presence",n)),delete this._joinedRooms[e],t()})}subscribeToRoom(e,t){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error("mucHost must be provided as an option.");if(!e)throw new Error("Parameter 'roomName' must be provided.");return new o.Promise((n,i)=>{const o={subscribe:{$attributes:{xmlns:g.NAMESPACES.MUC_SUB,nick:this.username}}};if(!t){t=[];for(let e in g.MUC_NODES)t.push(g.MUC_NODES[e])}t.length>0&&(o.subscribe.event=[],t.forEach(e=>{o.subscribe.event.push({$attributes:{node:e}})})),this.sendIq(`${e}@${this._options.mucHost}`,"set",o).then(t=>{t.iq&&t.iq.subscribe?n(t):this._onError(`Couldn't subscribe to room '${e}.'`,t)}).catch(i)})}listSubscribedUsersForRoom(e){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error("mucHost must be provided as an option.");return new o.Promise((t,n)=>{this.sendIq(`${e}@${this._options.mucHost}`,"get",{subscriptions:{$attributes:{xmlns:g.NAMESPACES.MUC_SUB}}}).then(e=>{let n=[];if(e.iq&&void 0!==e.iq.subscriptions)if(Array.isArray(e.iq.subscriptions.subscription))n=e.iq.subscriptions.subscription.map(e=>{if(e.$attributes&&void 0!==e.$attributes.jid)return e.$attributes.jid});else if(void 0!==e.iq.subscriptions.subscription){const t=e.iq.subscriptions.subscription;t.$attributes&&void 0!==t.$attributes.jid&&(n=[t.$attributes.jid])}t(n)}).catch(n)})}unsubscribeFromRoom(e){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error("mucHost must be provided as an option.");return new o.Promise((t,n)=>{this.sendIq(`${e}@${this._options.mucHost}`,"set",{unsubscribe:{$attributes:{xmlns:g.NAMESPACES.MUC_SUB}}}).then(t).catch(n)})}getRoomById(e){if(this._isMethodReady(!0),!e)throw new Error("A room ID must be provided.");return this._log("Getting room with ID:",e),this._roomDb.get(e)}findRooms(e,t,n,i,o){return this._isMethodReady(!0),this._searchDb(this._roomDb,e,t,n,i,o)}saveRoom(e,t){return this._isMethodReady(!0),new o.Promise((n,i)=>{this._saveObject(g.OBJECT_TYPES.ROOM,e,t,e=>{n(e)},e=>{i(e)})})}saveParticipant(e,t){return this._isMethodReady(!0),new o.Promise((n,i)=>{this._saveObject(g.OBJECT_TYPES.PARTICIPANT,e,t,e=>{n(e)},e=>{i(e)})})}listParticipantsByRoom(e){return this._isMethodReady(!0),this._searchDb(this._participantDb,{room_name:e})}getParticipantByRoomAndJid(e,t){return this._isMethodReady(!0),new o.Promise((n,i)=>this._searchDb(this._participantDb,{room_name:e,jid:t}).then(e=>{e&&e.length>0?n(e[0]):n(null)}).catch(i))}purgeParticipantsByUpdatedAt(e){return this._isMethodReady(!0),new o.Promise((t,n)=>{this._searchDb(this._participantDb,{updated_at:{$lt:e}}).then(e=>{const i=e.map(e=>this._participantDb.remove(e));o.Promise.all(i).then(t).catch(n)}).catch(e=>{console.error(e)})})}getServerVersion(){return this._isMethodReady(!0),new o.Promise((e,t)=>{this.sendIq(`${this._domain}`,"get",{query:{$attributes:{xmlns:g.NAMESPACES.SOFTWARE_VERSION}}}).then(t=>{t.iq&&t.iq.query&&e({name:t.iq.query.name||"",os:t.iq.query.os||"",version:t.iq.query.version})}).catch(t)})}_requestMessagesFromMam(e,t=null,n=!1,i=null,r,a=this._options.mam.pageSize,l=null){const c=(t,o,r,d,h,u=[],p=null)=>{let m=e;l&&l!==this._bareJid&&(m=l.includes("/")?l.split("/")[1]:l);const f={query:{$attributes:{xmlns:g.NAMESPACES.MAM,queryid:r},x:{$attributes:{xmlns:"jabber:x:data",type:"submit"},field:[{$attributes:{var:"FORM_TYPE",type:"hidden"},value:g.NAMESPACES.MAM}]},set:{$attributes:{xmlns:g.NAMESPACES.RESULT_SET_MANAGEMENT},max:""+a}}};if(this._log(`Querying the message archive for start date '${d}' and end date '${h}'.`),null!==d||!0===n){let e="";!0===n&&(e+="inf_conv_mode"),null!==d&&(e+=d.toISOString()),f.query.x.field.push({$attributes:{var:"start"},value:e})}null!==h&&f.query.x.field.push({$attributes:{var:"end"},value:h.toISOString()}),null!==p&&(f.query.set[!0===n?"before":"after"]=p),null!==i&&f.query.x.field.push({$attributes:{var:"with"},value:i}),this._connection.addHandler(e=>{const i=g.xmlToJson(e);try{if(l&&i.message.recv.message){i.message=i.message.recv.message||{};try{i.message.result.forwarded.message.delegateJid=i.message.result.forwarded.message.$attributes.to}catch(e){}}if(void 0!==i.message.result&&void 0!==i.message.result.forwarded&&void 0!==i.message.result.forwarded.message){const e=i.message.result.forwarded;void 0===i.message.result.forwarded.message.archived&&void 0!==i.message.result&&void 0!==i.message.result.$attributes&&void 0!==i.message.result.$attributes.id&&(e.message.archived={$attributes:{by:s.default.Strophe.getBareJidFromJid(e.message.$attributes.from),id:i.message.result.$attributes.id,xmlns:g.NAMESPACES.MAM_TMP}}),u.push(e)}}catch(e){return o(e),!1}const a=void 0!==i.message.fin&&void 0!==i.message.fin.$attributes&&i.message.fin.$attributes.xmlns===g.NAMESPACES.MAM;if(!0===a){const e=Array.isArray(u)?u.length:0;"true"==i.message.fin.$attributes.complete||!0===n?(this._log(`Finished paging through result set, got a total of '${e}' items.`),t(u)):(this._log(`Paging through result set to get a total of '${i.message.fin.set.count}' items.`),this._log(`Got '${e}' items so far...`),c(t,o,r,d,h,u,i.message.fin.set.last))}return!a},g.NAMESPACES.JABBER_CLIENT,"message",null,null,m),this.sendIq(e,"set",f,null,null,l).catch(e=>{this._onError("Couldn't query the MAM:",e),o(e)})};let d=null,h=null;return new o.Promise((e,n)=>{null!==r?this.getServerTime().then(()=>{const i=this.getSyncedTimestamp(Date.now()+6e4);r>=i?n(`The start timestamp (${r}) cannot be equal to or larger than the end timestamp (${i}).`):(d=new Date(r),h=new Date(i),c(e,n,this.getUniqueId(),d,h,[],t))}):c(e,n,this.getUniqueId(),d,h,[],t)})}queryMam(e,t=null,n=null,i,s=!0,r=null){return this._isMethodReady(!0,!0),new o.Promise((o,a)=>{const l=i||this._options.mam.defaultTimeLimit,c=Date.now()-l,d=-1===i?null:this.getSyncedTimestamp(c-6e4);this._log("Starting the MAM query process..."),this._perfStart("requestMessagesFromMam","Starting the first request for MAM messages","color: blue;"),this._requestMessagesFromMam(e,t,!1,n,d,this._options.mam.pageSize,r).then(e=>{this._perfEnd("requestMessagesFromMam","Finished getting all messages from the MAM","color: blue;"),this._processMamStanzas(e,s,!1).then(o).catch(a)}).then(()=>{if(this._options.autoPurgeOldMessagesAge>0)return this.purgeMessagesOlderThan(this._options.autoPurgeOldMessagesAge)}).then(()=>{if(this._options.autoPurgeOldRetainMessageCount>0)return this.purgeOldestMessagesLeavingCount(this._options.autoPurgeOldRetainMessageCount)}).catch(a)})}_processMamStanzas(e,t=!0,n=!1,i=!1){return new o.Promise((s,r)=>{const a=[],l=[];if(e&&0!==e.length){this._perfStart("processMamMessages","Starting to process all messages received from the MAM","color: yellow; background: black;"),this._perfStart("preProcessMamMessages","Starting to pre-process all messages received from the MAM","color: darkgreen; background: grey;");let c="0";e.forEach(e=>{const t={state:{sent:!0},fromMam:!1===n,injected:!0===n};let i=!1;try{i=void 0!==e.message.timestamp}catch(e){}if(!1===i&&e.delay&&e.delay.$attributes.stamp){let n=null;try{n=new Date(e.delay.$attributes.stamp).getTime()}catch(e){console.error("Couldn't parse stanza timestamp to integer.")}null!==n&&(t.ts=n)}const o=this._getArchiveIdFromStanza(e);o>c&&(c=o),g._isMarkerMessage(e)?(this._stanzaResponseHandler(e.message.$attributes.id),l.push(e)):e.message.$attributes&&"chat"===e.message.$attributes.type?a.push(this._messageDelta(e,{},t)):e.message.$attributes&&"groupchat"===e.message.$attributes.type?(this._stanzaResponseHandler(e.message.$attributes.id),a.push(this._messageDelta(e,{},t))):e.message.active&&e.message.active.$attributes.xmlns===g.NAMESPACES.DELEGATE?(e.message.data={"delegation-update":Object.assign({},e.message.active,{change:"active"})},a.push(this._messageDelta(e,{},t))):e.message.inactive&&e.message.inactive.$attributes.xmlns===g.NAMESPACES.DELEGATE?(e.message.data={"delegation-update":Object.assign({},e.message.inactive,{change:"inactive"})},a.push(this._messageDelta(e,{},t))):e.message.call&&e.message.call.$attributes&&e.message.call.$attributes.xmlns===g.NAMESPACES.INFINITY_BOT?(this._log(`Processing bot command response from the MAM with request ID '${e.message.call.$attributes["request-id"]}':`,e),this._botCommandResponseHandler(e.message.call.$attributes["request-id"],e)):e.message.error&&e.message.error.$attributes&&e.message.error.$attributes.xmlns===g.NAMESPACES.INFINITY_BOT?this._botCommandResponseHandler(e.message.error.$attributes["request-id"],e):e.message.ack&&e.message.ack.$attributes&&e.message.ack.$attributes.xmlns===g.NAMESPACES.INFINITY_ACK&&this._stanzaResponseHandler(e.message.ack.$attributes["original-id"])}),this._perfEnd("preProcessMamMessages","Finished pre-processing messages from the MAM.","color: darkgreen; background: grey;"),this._perfStart("postProcessMamMessages","Start post-processing messages received from the MAM","color: lightgreen; background: grey;"),this._perfStart("addMarkersToMamMessages","Adding markers to messages","color: brown; background: #E1E1E1;");const d=[];let h={};const u={};l.forEach(e=>{const t=g._getMarkerType(e),n=g._getMarkerMessageId(e,t);u[n]||(u[n]=[]),u[n].push(e)});for(let e in u){const t=u[e];let n=null;a.every(t=>t._id!==e||(n=t,!1)),null!==n?t.forEach(e=>{const t=g._getMarkerType(e),i=(g._getMarkerMessageId(e,t),this._updateMessageMarkers(e,t,n));!1!==i&&(h[n._id]=!0,n=i)}):d.push(new o.Promise(n=>{this.getMessageById(e).then(e=>{t.forEach(t=>{const n=g._getMarkerType(t),i=(g._getMarkerMessageId(t,n),this._updateMessageMarkers(t,n,e));!1!==i?a.push(i):this._setLastArchiveId(this._getArchiveIdFromStanza(t))}),n()}).catch(()=>{this._log(`Not found message with id '${e}', creating message placeholder...`);let i=Object.assign({},g._messageSkeleton(),{_id:e,placeholder:!0,markable:!0,type:null});t.forEach(e=>{const t=g._getMarkerType(e),n=(g._getMarkerMessageId(e,t),this._updateMessageMarkers(e,t,i));!1!==n&&(i=n)}),a.push(i),n()})}))}o.Promise.all(d).then(()=>{if(this._log("Messages to save from the MAM:",a),a&&0!==a.length){this._perfEnd("addMarkersToMamMessages","Finished adding markers to messages","color: brown; background: #E1E1E1;");const e=[];!0===i&&a.forEach((t,n,i)=>e.push(this.saveMessage(t._id,e=>{if(e._id)return i.splice(n,1),delete t.state,Object.assign({},e,t)}))),o.Promise.all(e).then(e=>{const n=a.filter(t=>0===e.filter(e=>!!e&&e._id===t._id).length);this._msgDb.bulkDocs(n).then(n=>{this._setLastArchiveId(c);const i=function(t){s([...t,...e].filter(e=>null!==e))};n&&n.length>0?this._msgDb.bulkGet({docs:n}).then(e=>{let n=e.results.map(e=>{const n=e.docs[0].ok;return void 0===n?null:(!1!==t&&(null===n.updated_at||!0===h[n._id]?this._dispatchEvent(g.EVENT_TYPES.NEW_MESSAGE,n):this._dispatchEvent(g.EVENT_TYPES.MESSAGE_UPDATED,n)),!0===this._options.autoMarkMessages&&this._markMessage(n,g.MARKER_TYPES.RECEIVED,t),n)});h={},this._perfEnd("postProcessMamMessages","Finished post-processing messages received from the MAM","color: lightgreen; background: grey;"),this._perfEnd("processMamMessages","Finished processing messages received from the MAM","color: yellow; background: black;"),i(n)}):i([])}).catch(e=>{console.error(e),r(e)})})}else s([])})}else s([])})}processXmlStanzaStringsFromMam(e,t=!0,n=null){const i=new DOMParser,s=e.map(e=>i.parseFromString(e,"text/xml").childNodes[0]).map(e=>g.xmlToJson(e)),r={};return s.forEach(e=>{try{const t=e.message.$attributes.id,n=e.message.$attributes.to.split("@")[0];void 0===r[n]&&(r[n]=[]),r[n].push(t)}catch(e){console.error("The stanza wasn't in the expected format:",e)}}),this.getAllMessages().then(e=>{let n=[];return e&&e.length>0&&(n=Object.keys(r).map(t=>{const n=e.filter(e=>e.recipient_id===`${t}@${this.mucHost}`||e.sender_id===`${t}@${this.mucHost}`);if(!n||0===n.length)return;const i=r[t].filter(e=>n.filter(t=>t._id===e).length>0);return!i||i.length>0?void 0:this.deleteMessagesByRoomName(t)})),o.Promise.all(n).then(()=>this._processMamStanzas(s,t,!0))})}purgeOldMessages(){return this._isMethodReady(!0),this.purgeMessagesOlderThan(this._options.autoPurgeOldMessagesAge)}purgeMessagesOlderThan(e){return this._isMethodReady(!0),this._log(" Removing messages older than: "+e),this.purgeMessagesFromBefore(this.getSyncedTimestamp(Date.now())-e)}purgeMessagesFromBefore(e){return this._isMethodReady(!0),this._log(" Removing messages with timestamp before: "+new Date(e).toISOString()),this.deleteMessages({ts:{$lt:e}})}purgeOldestMessagesLeavingCount(e){return this._isMethodReady(!0),this._log(" Want to restrict to: "+e+" messages in DB"),this._msgDb.info().then(t=>{this._log(" There are: "+t.doc_count+" messages in DB");const n=t.doc_count-e;if(n>0)return this._log(" Going to delete: "+n+" messages from DB"),this.purgeOldestMessagesCount(n)})}purgeOldestMessagesCount(e){return this._isMethodReady(!0),this._msgDb.createIndex({index:{fields:["ts"]}}).then(()=>{this._msgDb.find({selector:{},sort:["ts"],limit:e,fields:["_id"]}).then(e=>{let t=o.Promise.resolve();return e.docs.forEach(e=>{t=t.then(()=>(this._log(" Deleting message: "+e._id),this.deleteMessageById(e._id).then(()=>{this._log(" Deleted message: "+e._id)})))}),t})})}_setLastArchiveId(e){e>this._lastArchiveId&&(this._lastArchiveId=e,localStorage.setItem(`${this._instanceId}_last_archive_id`,e))}getLastArchiveId(){return this._lastArchiveId}getLastArchiveIdForRoom(e){if(this._isMethodReady(!0),!this._options.mucHost)throw new Error("'mucHost' must be provided as an option.");return new o.Promise((t,n)=>{const i=`${e}@${this._options.mucHost}`;let o="0";this.getChatHistory(i).then(e=>{if(e&&e.length>0){const t=e.sort((e,t)=>{const n=t.updated_at-e.updated_at;return 0===n?t.ts-e.ts:n})[0];o=t.archive_id}t(o)}).catch(n)})}getFirstArchiveIdForRoom(e){if(this._isMethodReady(!0),!this._options.mucHost)throw new Error("'mucHost' must be provided as an option.");return new o.Promise((t,n)=>{const i=`${e}@${this._options.mucHost}`;let o="0";this.getChatHistory(i).then(e=>{if(e&&e.length>0){const t=e.sort((e,t)=>e.ts-t.ts)[0];o=t.archive_id}t(o)}).catch(n)})}queryMamByRoomName(e,t=!0,n=null){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error("'mucHost' must be provided as an option.");return this._perfStart("queryMamByRoomName",`- Querying the MAM for room '${e}'`,"color: green;"),new o.Promise((i,o)=>{const s=`${e}@${this._options.mucHost}`,r=n=>{this.queryMam(s,n,null,null,t).then(t=>{this._perfEnd("queryMamByRoomName",`- Finished querying the MAM for message in room '${e}'.`,"color: green;"),i(t)}).catch(o)};null===n?this.getLastArchiveIdForRoom(e).then(e=>{r(e)}).catch(i):r(n)})}queryMamRoomHistoryByName(e,t=null,n=5,i=!0,s=null,r=null){if(this._isMethodReady(!0,!0),!this._options.mucHost)throw new Error("'mucHost' must be provided as an option.");return this._perfStart("queryMamRoomHistoryByName",`Querying MAM history for room '${e}'`,"color: purple;"),new o.Promise((o,a)=>{const l=`${e}@${this._options.mucHost}`;this._requestMessagesFromMam(l,t,!0,null,s,n,r).then(t=>{this._perfEnd("queryMamRoomHistoryByName",`Finished querying the MAM history for '${n}' messages in the '${e}' room.`,"color: purple;"),this._processMamStanzas(t,i,!1,!0).then(o).catch(a)}).then(()=>{if(this._options.autoPurgeOldMessagesAge>0)return this.purgeMessagesOlderThan(this._options.autoPurgeOldMessagesAge)}).then(()=>{if(this._options.autoPurgeOldRetainMessageCount>0)return this.purgeOldestMessagesLeavingCount(this._options.autoPurgeOldRetainMessageCount)}).catch(a)})}queryMamByRecipient(e,t=!0){return this._isMethodReady(!0,!0),new o.Promise((n,i)=>{this.getChatHistory(e).then(o=>{let s=null;if(o&&o.length>0){s=o.sort((e,t)=>{const n=t.updated_at-e.updated_at;return 0===n?t.ts-e.ts:n})[0].archive_id}this.queryMam(null,s,e,null,t).then(n).catch(i)}).catch(e=>console.error)})}_saveObject(e,t,n,i,o){if(this._destroyingDbs)return this._log(`Couldn't save '${e}' because the databases are being destroyed.`),void(o&&o(g.ERROR_CODES.DESTROYING_DBS));let s=null;switch(e){case g.OBJECT_TYPES.MESSAGE:s=this._msgDb;break;case g.OBJECT_TYPES.CONTACT:s=this._contactDb;break;case g.OBJECT_TYPES.ROOM:s=this._roomDb;break;case g.OBJECT_TYPES.PARTICIPANT:s=this._participantDb;break;case g.OBJECT_TYPES.CACHE_ITEM:s=this._cacheDb}if(null===s)throw new Error(`The object type provided (${e}) is not valid.`);void 0===this._saveDebounce[e]&&(this._saveDebounce[e]={}),this._saveDebounce[e][t]?setTimeout(()=>{this._saveObject(e,t,n,i,o)},250):(this._saveDebounce[e][t]=!0,s.upsert(t,n).then(n=>{void 0!==n.rev?s.get(t).then(n=>{delete this._saveDebounce[e][t],i&&i(n)}).catch(n=>{this._onError(`Couldn't get ${e} with ID '${t}' after performing an update.`,n),delete this._saveDebounce[e][t],o&&o(n)}):(delete this._saveDebounce[e][t],i&&i(null))}).catch(n=>{this._log(`Couldn't update ${e} with ID '${t}'.`,n),delete this._saveDebounce[e][t],o&&o(n)}))}doDownload(e,t){return new o.Promise((n,i)=>{const o=o=>{a.download(e,o,t).then(e=>{var t=l.getSource("fileEncryption");r.isDevice()&&this._options.fileEncryption&&t?t.encrypt(function(t){e.source=t,n(e)},function(e){i(e)},e.source):n(e)}).catch(i)};!0===this._options.authAttachments?this._getCacheItem("user_password").then(e=>this._embellishPasswordWithAdToken(e)).then(e=>{o({Authorization:"Basic "+btoa(this._bareJid+":"+e)})}):o(null)})}downloadAttachment(e,t,n=!0){return this._isMethodReady(!0,!0),new o.Promise((i,o)=>{if(!Array.isArray(e.attachments))return o("No attachments");if(t>e.attachments.length-1)return o("No such attachment: "+t);const s=e.attachments[t];void 0===s.path?this.doDownload(s.get).then(o=>{s.path=o.source,s.state="transferred",this.saveMessage(e._id,e=>(e.attachments[t]=s,e)).then(e=>{!1!==n&&this._dispatchEvent(g.EVENT_TYPES.MESSAGE_UPDATED,e),i()})}).catch(o):i()})}initUserDirectory(){return new o.Promise((e,t)=>{!0===this._userDirectory.initialised?e():!0===this._userDirectory.initialising?this.addEventListener(g.EVENT_TYPES.UD_INITIALISED,()=>{e()}):this._userDirectory.initialise(this._options.userDirectoryEncryptionBlockSize||2e3).then(()=>{this._dispatchEvent(g.EVENT_TYPES.UD_INITIALISED,null),e()}).catch(t)})}_updateUserDirectoryTimer(){this._log("-> _updateUserDirectoryTimer: "+this._options.updateUserDirectoryInterval),this._updateUserDirectoryTimeout&&window.clearTimeout(this._updateUserDirectoryTimeout),this._updateUserDirectoryTimeout=window.setTimeout(()=>{this.updateUserDirectory().then(e=>{this._log(` Updated user directory: ${e}`)}).catch(e=>{this._log(` Couldn't update user directory: ${e.message}`)})},this._options.updateUserDirectoryInterval)}updateUserDirectory(){return this._log("-> updateUserDirectory"),o.Promise.all([this.initUserDirectory(),this.refreshOAuthAndSave()]).then(()=>(this._log(" Updating user directory..."),o.Promise.all([this._getCacheItem("user_directory_hash"),this._getCacheItem("updates_timestamp")]).then(e=>{const t=e[0],n=e[1],s={query:{$attributes:{xmlns:g.NAMESPACES.DIRECTORY}}};return t&&(s.query.$attributes.hash=t),t&&(s.query.$attributes["updates-ts"]=n),this.sendIq(this._domain,"get",s).then(e=>i(this,void 0,void 0,function*(){try{const t=e.iq.query.$attributes.url,n=e.iq.query.updates&&e.iq.query.updates.$attributes?e.iq.query.updates.$attributes.ts:null;let i=[];try{i=e.iq.query.updates&&e.iq.query.updates.$value&&JSON.parse(e.iq.query.updates.$value)||[]}catch(e){return console.error(e),o.Promise.reject("Unable to parse updates JSON.")}let s=!1;if(t){s=!0;const e=yield this._getCacheItem("user_password"),n=yield this._embellishPasswordWithAdToken(e),i=yield this._userDirectory.update(this._bareJid,n,t);yield this._setCacheItem("user_directory_hash",i.hash),this._log(" User directory successfully updated.")}i.length&&(s=!0,yield o.Promise.all(i.map(e=>(this._log(`Apply update for account '${e.jid}':`,e),this._userDirectory.updateAccount(e.jid,e)))),yield this._userDirectory.saveIndex(),this._log(" Augmented updated applied successfully.")),yield this._setCacheItem("updates_timestamp",n),this._updateUserDirectoryTimer(),s&&this._dispatchEvent(g.EVENT_TYPES.UD_UPDATED,null)}catch(e){return this._updateUserDirectoryTimer(),o.Promise.reject("Couldn't obtain directory URL from server.")}}))}))).catch(e=>(this._log("catch on initUserDir:"+e),this._getCacheItem("user_directory_hash").then(t=>void 0!==t?this._deleteCacheItem("user_directory_hash").then(()=>this.updateUserDirectory().then(e=>o.Promise.resolve(e)).catch(e=>o.Promise.reject(e))):o.Promise.reject(e))))}searchUsers(e,t,n=!1,i=!0){return this.initUserDirectory().then(()=>this._userDirectory.search(e,t,n,i))}getUsersByJid(e){return this.initUserDirectory().then(()=>this._userDirectory.getUsersByJid(e))}getAllUsers(e=!1,t=!1){return this.initUserDirectory().then(()=>this._userDirectory.getAllUsers(e,t))}getAllUsersInGroup(e,t=!1,n=!1,i=!0){return this.initUserDirectory().then(()=>this._userDirectory.getAllUsersInGroup(e,t,n,i))}getAllJids(e=!0,t=!1){return this.initUserDirectory().then(()=>this._userDirectory.getAllJids(e,t))}searchRoles(e,t){return this.initUserDirectory().then(()=>this._userDirectory.searchRoles(e,t))}getAllRoles(e=!1){return this.initUserDirectory().then(()=>this._userDirectory.getAllRoles(e))}searchGroups(e){return this.initUserDirectory().then(()=>this._userDirectory.searchGroups(e))}getAllGroups(){return this.initUserDirectory().then(()=>this._userDirectory.getAllGroups())}getUserByJid(e){return this.initUserDirectory().then(()=>this._userDirectory.getUserByJid(e))}updateAccount(e,t,n=!0){return this.initUserDirectory().then(()=>this._userDirectory.updateAccount(e,t).then(()=>n?this.saveUserIndex():o.Promise.resolve()))}saveUserIndex(){return this.initUserDirectory().then(()=>this._userDirectory.saveIndex())}generateUniqueJid(){return`${h.generateGuid()}@${this._domain}`}downloadAttachments(e,t=!0){return new o.Promise((n,i)=>{if(Array.isArray(e.attachments)&&e.attachments.length>0){let s=o.Promise.resolve();e.attachments.forEach((t,n)=>{this._sso&&(s=s.then(()=>this.refreshOAuthAndSave())),s=s.then(()=>new o.Promise((i,o)=>{void 0===t.path?this.doDownload(t.get).then(t=>{e.attachments[n].path=t.source,e.attachments[n].mediaType=a.getMediaTypeFromExtension(t.source),e.attachments[n].state="transferred",i()}).catch(o):i()}))}),s.then(()=>{this.saveMessage(e._id,()=>e).then(e=>{!1!==t&&this._dispatchEvent(g.EVENT_TYPES.MESSAGE_UPDATED,e),this._log(`Successfully updated message '${e._id}' with attachments.`,e),n(e)}).catch(t=>{this._onError(`Unable to update message '${e._id}' with attachments:`,t),i(t)})}).catch(e=>{this._onError("Unable to download all message attachments:",e),i(e)})}else n(e)})}_processNewMessage(e,t,n=!0,i=!0){return this._perfStart(`processNewMessage (${e.message.$attributes.id.split("-")[0]})`,"Starting to process a new message","color: purple;"),new o.Promise((o,s)=>{this._setLastArchiveId(this._getArchiveIdFromStanza(e)),this._messageStanzaToDbObject(e,t).then(e=>{return!1!==i&&(null===e.updated_at?this._dispatchEvent(g.EVENT_TYPES.NEW_MESSAGE,e):this._dispatchEvent(g.EVENT_TYPES.MESSAGE_UPDATED,e)),this.getSyncedTimestamp((new Date).getTime())-e.ts<this._options.autoDownloadAttachmentTime||-1==this._options.autoDownloadAttachmentTime?this.downloadAttachments(e,i):e}).then(t=>{e.message.markable&&!0===n&&!0===this._options.autoMarkMessages?this._markMessage(t,g.MARKER_TYPES.RECEIVED,i).then(t=>{this._perfEnd(`processNewMessage (${e.message.$attributes.id.split("-")[0]})`,"Finished processing a new message","color: purple;"),o(t)}).catch(s):(this._perfEnd(`processNewMessage (${e.message.$attributes.id.split("-")[0]})`,"Finished processing a new message","color: purple;"),o(t))}).catch(s)})}_processGroupMessage(e,t,n=!0,i=!0){const o=g._merge({type:"groupchat",mine:s.default.Strophe.getBareJidFromJid(e.message.$attributes.from)===this._bareJid||s.default.Strophe.getResourceFromJid(e.message.$attributes.from)===this.username},t);e.message.actingDelegate&&this._bareJid.includes(e.message.actingDelegate)&&(o.mine=!0);try{this._stanzaResponseHandler(e.message.$attributes.id)}catch(t){this._onError("Couldn't process stanza response handler for stanza:",e)}return this._processNewMessage(e,o,n,i)}_updateMessageMarkers(e,t,n){if(!n._id)return!1;if(!n.markable)return!1;const i=s.default.Strophe.getBareJidFromJid(e.message.$attributes.from),o=s.default.Strophe.getResourceFromJid(e.message.$attributes.from);if(!0===n.state.markers.some(e=>{if(e.type===t&&(e.sender_id===i&&e.sender_resource===o||e.sender_resource===this.bareJid))return!0}))return!1;const r={type:t,sender_id:i,sender_resource:o,recipient_id:e.message.$attributes.to,ts:this._getTimestampFromStanza(e),priority:g.MARKER_PRIORITIES[t]};return n.state.markers.push(r),n.state.markers=n.state.markers.sort(function(e,t){return e.priority!==t.priority?e.priority-t.priority:null!==t.ts&&null!==e.ts?t.ts-e.ts:void 0}),n.state[t]=!0,!0!==n.state.sent&&(n.state.sent=!0),n.updated_at=this.getSyncedTimestamp(Date.now()),n}static _getMarkerType(e){let t=null;return e.message.received?t=g.MARKER_TYPES.RECEIVED:e.message.read?t=g.MARKER_TYPES.READ:e.message.acknowledged&&(t=g.MARKER_TYPES.ACKNOWLEDGED),t}static _getMarkerMessageId(e,t){return void 0!==e.message[t].$attributes&&void 0!==e.message[t].$attributes.id?e.message[t].$attributes.id:null}_processMarkerMessage(e,t=!0){return new o.Promise((n,i)=>{this._setLastArchiveId(this._getArchiveIdFromStanza(e));const o=g._getMarkerType(e);if(null!==o){const r=g._getMarkerMessageId(e,o);if(null!==r){this._log(`Processing marker of type '${o}' for message with ID '${r}':`,e),this._stanzaResponseHandler(e.message.$attributes.id);const a=s.default.Strophe.getBareJidFromJid(e.message.$attributes.from),l=s.default.Strophe.getResourceFromJid(e.message.$attributes.from);this.saveMessage(r,t=>this._updateMessageMarkers(e,o,t)).then(e=>{if(null!==e){const i={message_id:e._id,message:e,type:o,sender_id:a,sender_resource:l};!1!==t&&this._dispatchEvent(g.EVENT_TYPES.RECEIPT_RECEIVED,i),!1!==t&&this._dispatchEvent(g.EVENT_TYPES.MESSAGE_UPDATED,e),n(i)}else n(null)}).catch(i)}}})}_processErrorMessage(e){return new o.Promise((t,n)=>{const i=e.message.$attributes&&e.message.$attributes.id?e.message.$attributes.id:null;if(null!==i){const o=e.message.error&&e.message.error.text&&e.message.error.text.$value?e.message.error.text.$value:`The server returned an error for stanza with ID '${i}'.`;this._onError(o,Object.assign({},e.message.error,{messageId:i})),this._stanzaResponseHandler(i,o),this.saveMessage(i,e=>void 0!==e._id&&(!0!==e.state.read&&!0!==e.state.received&&!0!==e.state.acknowledged?e.state.sent=!1:!0!==e.state.sent&&(e.state.sent=!0),e)).then(()=>{t({id:i,msg:o})}).catch(n)}else t()})}_processAckMessage(e){return new o.Promise((t,n)=>{if(e.message.ack&&e.message.ack.$attributes&&e.message.ack.$attributes["original-id"]){const i=e.message.ack.$attributes["original-id"];this._stanzaResponseHandler(i),this._dispatchEvent(g.EVENT_TYPES.ACK_RECEIVED,i),this.saveMessage(i,e=>void 0!==e._id&&(!0!==e.state.sent&&(e.state.sent=!0),e)).then(t).catch(n)}else t()})}_onIq(e){return e&&e.iq&&e.iq.ping&&e.iq.$attributes&&e.iq.$attributes.from&&e.iq.$attributes.id&&setTimeout(()=>{this.sendIq(e.iq.$attributes.from,"result",{},null,e.iq.$attributes.id)},0),!0}_onStanza(e,t=!1){this.connected=!0,this._setStatus(s.default.Strophe.Status.CONNECTED);try{let n=null;if(n=t?e:g.xmlToJson(e),this._isFilteredOut(n))return!0;if(this._log(`[1] - Processing stanza with ID '${n.message.$attributes.id}':`,n),this._updateHelper.onStanza(n),n.message.$attributes&&"chat"===n.message.$attributes.type&&void 0!==n.message.sent&&void 0!==n.message.sent.$attributes&&n.message.sent.$attributes.xmlns===g.NAMESPACES.CARBONS&&void 0!==n.message.sent.forwarded)this._processNewMessage(n.message.sent.forwarded,{state:{sent:!0}});else if(n.message.$attributes&&"chat"===n.message.$attributes.type)this._processNewMessage(n);else if(n.message.data&&n.message.data["delegation-update"])this._processNewMessage(n);else if(n.message.event&&n.message.event.items){const e=e=>{g._isMarkerMessage(e)?(this._log(`[2] - Processing stanza with ID '${n.message.$attributes.id}':`,n),this._processMarkerMessage(e)):this._processGroupMessage(e)};Array.isArray(n.message.event.items.item)?n.message.event.items.forEach(t=>{t.message&&t.message.$attributes&&"groupchat"===t.message.$attributes.type?e(t):t.presence&&this._onPresence(t)}):"object"==typeof n.message.event.items.item&&n.message.event.items.item.message&&n.message.event.items.item.message.$attributes&&"groupchat"===n.message.event.items.item.message.$attributes.type?(n.$attributes&&n.$attributes.xmlns===g.NAMESPACES.DELEGATE&&this._log("Delegate group chat message found:",n.message.event.items.item),e(n.message.event.items.item)):"object"==typeof n.message.event.items.item&&n.message.event.items.item.presence&&(n.$attributes&&n.$attributes.xmlns===g.NAMESPACES.DELEGATE&&this._log("Delegate group chat message found:",n.message.event.items.item),this._onPresence(n.message.event.items.item))}else if(g._isMarkerMessage(n))this._log(`[3] - Processing stanza with ID '${n.message.$attributes.id}':`,n),this._processMarkerMessage(n);else if(n.message.$attributes&&"groupchat"===n.message.$attributes.type&&n.message.$attributes.id)this._processGroupMessage(n);else if(n.message.$attributes&&"error"===n.message.$attributes.type)this._processErrorMessage(n);else if(void 0!==n.message.ack)this._processAckMessage(n);else if(n.message.call&&n.message.call.$attributes&&n.message.call.$attributes.xmlns===g.NAMESPACES.INFINITY_BOT)this._log(`Processing bot command response with request ID '${n.message.call.$attributes["request-id"]}':`,n),this._botCommandResponseHandler(n.message.call.$attributes["request-id"],n);else if(n.message.error&&n.message.error.$attributes&&n.message.error.$attributes.xmlns===g.NAMESPACES.INFINITY_BOT)this._botCommandResponseHandler(n.message.error.$attributes["request-id"],n);else if(n.message.recv&&n.message.recv.iq){if(n.message.recv.iq.ping)return!0;this._log("[4] - Received delegate message:",n),this._dispatchEvent(g.EVENT_TYPES.DELEGATEIQ,n.message)}else if(n.message.recv&&n.message.recv.presence)this._log("[5] - Received delegate presence message:",n);else if(n.message.recv&&n.message.recv.message){this._log("[6] - Received delegate conversation message:",n);const e=n.message.recv.message;if(e.event&&e.event.items&&"object"==typeof e.event.items.item&&e.event.items.item.message&&e.event.items.item.message.$attributes&&"groupchat"===e.event.items.item.message.$attributes.type){const t=this.destructDelegateJid(e.$attributes.to),n=s.default.Strophe.getResourceFromJid(e.event.items.item.message.$attributes.from);this._bareJid.includes(t.userJid)&&t.delegateJid.includes(n)&&(e.event.items.item.message.actingDelegate=t.userJid)}this._onStanza(n.message.recv,!0)}else n.message&&n.message.inactive?(this._log("[7] - Received delegate inactive message:",n),n.message.data={"delegation-update":Object.assign({},n.message.inactive,{change:"inactive"})},this._onStanza(n,!0)):n.message&&n.message.active&&(this._log("[8] - Received delegate active message:",n),n.message.data={"delegation-update":Object.assign({},n.message.active,{change:"active"})},this._onStanza(n,!0))}catch(e){this._onError("An error occurred when processing an incoming message stanza:",e)}return!0}_isFilteredOut(e){let t=!0;return this._includeStanzaFilters&&this._includeStanzaFilters.length>0&&(t=!1,this._includeStanzaFilters.some(t=>{try{return t(e)}catch(e){return this._log("Include filter function failed: "+e),this._onError("Include filter function failed: "+e),!1}})&&(t=!0)),this._excludeStanzaFilters.some(t=>{try{return t(e)}catch(e){return this._log("Exclude filter function failed: "+e),this._onError("Exclude filter function failed: "+e),!1}})&&(t=!1),!t}_messageIsGroupChat(e){return this._options.mucHost&&e.$attributes&&"string"==typeof e.$attributes.from&&e.$attributes.from.indexOf(this._options.mucHost)>-1}_onPresence(e){if(void 0!==e.presence){const t=e.presence;if(void 0!==t.$attributes&&void 0!==t.$attributes.from){if("error"===t.$attributes.type)return this._onError("An error from the server was received in a presence stanza:",t),!0;const e=s.default.Strophe.getBareJidFromJid(t.$attributes.from);if(!e)return!0;if(e===this._bareJid)this.setChatStatus(t.show,t.status,!1,t.metadata);else{const n=g.getDomainFromJid(e);this._options.mucHost===n?this.saveParticipant(t.$attributes.from,e=>{if(void 0!==e._id)try{if(e.show=t.show,e.status=t.status,e.online="unavailable"!==t.$attributes.type,e.affiliation=t.x.item.$attributes.affiliation,e.room_role=t.x.item.$attributes.role,e.last_stanza=t,void 0!==t.metadata){const n=t.metadata;delete n.$attributes,e.metadata=n}e.updated_at=this.getSyncedTimestamp(Date.now())}catch(t){this._onError(`Presence stanza wasn't in the expected format when trying to update participant with ID '${e._id}' and JID '${e.jid}'.`,t)}else try{if(e._id=t.$attributes.from,e.jid=s.default.Strophe.getBareJidFromJid(t.x.item.$attributes.jid),e.is_current_user=e.jid===this._jid,e.username=s.default.Strophe.getNodeFromJid(e.jid),e.room_name=s.default.Strophe.getNodeFromJid(t.$attributes.from),e.affiliation=t.x.item.$attributes.affiliation,e.room_role=t.x.item.$attributes.role,e.online="unavailable"!==t.$attributes.type,e.show=t.show,e.status=t.status,e.ts=this.getSyncedTimestamp(Date.now()),void 0!==t.metadata){const n=t.metadata;delete n.$attributes,e.metadata=n}e.updated_at=null,e.last_stanza=t}catch(t){this._onError(`Presence stanza wasn't in the expected format when trying to create a new participant with ID '${e._id}' and JID '${e.jid}'.`,t)}return e}).then(e=>{null===e.updated_at?this._dispatchEvent(g.EVENT_TYPES.NEW_PARTICIPANT,e):this._dispatchEvent(g.EVENT_TYPES.PARTICIPANT_UPDATED,e)}).catch(e=>{this._onError("Couldn't upsert participant database.",e)}):this._saveObject(g.OBJECT_TYPES.CONTACT,e,e=>{if(void 0!==e&&(e.online="unavailable"!==t.$attributes.type,void 0!==t.show&&(e.show=t.show),void 0!==t.status&&(e.status=t.status),void 0!==t.metadata)){const n=t.metadata;delete n.$attributes,e.metadata=n}return e},n=>{let i=!1;t.x&&t.x.$attributes&&t.x.$attributes.xmlns&&t.x.$attributes.xmlns===g.NAMESPACES.VCARD_UPDATE&&void 0!==t.x.photo&&"string"==typeof t.x.photo&&(void 0!==n.avatarHash&&n.avatarHash===t.x.photo||(i=!0,this._log(" Avatar update for:",e),this._log(" New avatar hash:",t.x.photo),this.updatevCardForContact(e).then(()=>{this._saveObject(g.OBJECT_TYPES.CONTACT,e,e=>(e.avatarHash=t.x.photo,e),e=>{this._dispatchEvent(g.EVENT_TYPES.PRESENCE_UPDATE,e)},e=>{this._onError("Couldn't update contact with vCard: ",e)})}).catch(e=>{this._onError("Couldn't get updated vCard for contact: ",e)}))),!1===i&&this._dispatchEvent(g.EVENT_TYPES.PRESENCE_UPDATE,n)},e=>{this._onError("Couldn't upsert contacts database.",e)})}}}return!0}getContactByJid(e){return this._isMethodReady(!0),new o.Promise((t,n)=>{this.findContacts({id:e}).then(i=>{let o=i[0];void 0!==o?t(o):n("No contact found: "+e)}).catch(n)})}updatevCardForContact(e){return this._isMethodReady(!0,!0),this._log(" Updating vCard for Contact:",e),new o.Promise((t,n)=>{this.findContacts({id:e}).then(t=>{let i=t[0];if(void 0!==i)return i;this._log(" No contact:",e),n("No contact found: "+e)}).then(i=>{this._getvCard(e).then(i=>{if(void 0!==i){const o=u.VCardSimple.fromXml(i);void 0!==o?this._saveObject(g.OBJECT_TYPES.CONTACT,e,e=>(e.vCard=o.toJSON(),e),n=>{this._log(" vCard Updated:",e),t(n)},t=>{this._log(" Couldn't save contact:",e),n("Couldn't save contact: "+t)}):(this._log(" Bad vCard:",e),n("Bad vCard"))}else this._log(" No vCard:",e),t(null)}).catch(n)}).catch(n)})}_processRoster(e){return new o.Promise((t,n)=>{if(void 0!==e&&void 0!==e.iq&&void 0!==e.iq.query)if(void 0!==e.iq.query.$attributes&&void 0!==e.iq.query.$attributes.ver&&this._setCacheItem("roster_version",e.iq.query.$attributes.ver).catch(n),void 0!==e.iq.query.item){const i=[];(Array.isArray(e.iq.query.item)?e.iq.query.item:[e.iq.query.item]).forEach(e=>{if(void 0!==e.$attributes.jid){const t={id:e.$attributes.jid,subscription:e.$attributes.subscription,online:!1};void 0!==e.group&&("string"==typeof e.group?t.groups=[e.group]:Array.isArray(e.group)&&(t.groups=e.group)),i.push(t)}}),this._contactDb.allDocs({include_docs:!0}).then(e=>{const s=[];e.rows.forEach(e=>{let t=e.doc,n=null;i.every((e,o)=>e.id!==t.id||(n=e,delete i[o],!1)),null===n?s.push(this._contactDb.remove(t)):t.subscription===n.subscription&&g._arraysEqual(t.groups,n.groups)||(t=g._merge(t,n),this._log("MERGED CONTACT:",t),s.push(this._contactDb.post(t)))}),i.forEach(e=>{this._log("ADDING NEW CONTACT:",e),s.push(new o.Promise((t,n)=>{this._saveObject(g.OBJECT_TYPES.CONTACT,e.id,t=>e,n=>{this._log("CONTACT ADDED:",e.id),t(n)},t=>{this._log("CONTACT ADD FAILED:"+e.id+": "+t),n(t)})}))}),o.Promise.all(s).then(t).catch(e=>{this._onError("Couldn't merge contacts from server with locally sorted contacts.",e),n(e)})})}else t();else t()})}getvCardsForAllContacts(){return this._isMethodReady(!0,!0),this._log(" Fetching all vCards..."),new o.Promise((e,t)=>{this.getContacts().then(n=>{const i=[];n.forEach((e,t)=>{this._log(" Fetching vCard for:",e.id),i.push(new o.Promise((t,n)=>{this.updatevCardForContact(e.id).then(()=>{this._log(" Fetched vCard for:",e.id),t()}).catch(e=>{t()})}))}),o.Promise.all(i).then(e).catch(t)})})}getOurvCard(){return this._isMethodReady(!0,!0),this._log(" Fetching vCard for:",this._bareJid),new o.Promise((e,t)=>{this._getvCard(this._bareJid).then(n=>{if(void 0===n||n.length<1)return t("No vCard");const i=u.VCardSimple.fromXml(n);void 0!==i?(this._log(" Fetched vCard: ",i.toJSON()),e(i.toJSON())):(this._log(" Bad vCard: ",this._bareJid),t("Bad vCard"))}).catch(t)})}saveOurvCard(e){return this._isMethodReady(!0,!0),this._log(" Saving vCard for:",this._bareJid),new o.Promise((t,n)=>{const i=u.VCardSimple.fromJSON(e);this._setvCard(this._bareJid,i.toXML(!0)).then(()=>{this._log(" Saved vCard for:",this._bareJid),t()}).catch(n)})}_onError(e,t){console.error(e,t||""),this._dispatchEvent(g.EVENT_TYPES.ERROR,t)}_setCacheItem(e,t,n=!1){return new o.Promise((i,o)=>{const s=()=>{this._saveObject(g.OBJECT_TYPES.CACHE_ITEM,e,e=>e.value!==t&&(e.value=t,e.secret=!0===n,e),t=>{const n=t.value;!1===t.secret&&(this._cache[e]=n),i(t.value)},n=>{n===g.ERROR_CODES.DESTROYING_DBS?i():(this._onError(`Couldn't set cache item '${e}' with value '${t}'.`),o(n))})};this._getCacheItem(e).then(e=>{e===t?i(e):s()}).catch(s)})}_getCacheItem(e,t=0){return new o.Promise(n=>{void 0!==this._cache[e]?n(this._cache[e]):this._cacheDb.get(e).then(i=>{if(this._options.encryption&&!i.hasOwnProperty("value"))5===(t+=1)?n():setTimeout(()=>{this._getCacheItem(e,t).then(n)},100);else{const t=i.value;!1===i.secret&&(this._cache[e]=t),n(t)}}).catch(()=>{n()})})}_deleteCacheItem(e){return new o.Promise((t,n)=>{this._cacheDb.get(e).then(i=>{this._cacheDb.remove(i).then(()=>{delete this._cache[e],t()}).catch(n)}).catch(()=>{t()})})}deleteStreamManagementId(){return this._deleteCacheItem("stream_management_id")}_messageDelta(e,t,n,i=null){const o=e.message.$attributes.from;let r=s.default.Strophe.getBareJidFromJid(o);const a=s.default.Strophe.getResourceFromJid(o);if(i&&(r=`${i}/${r}`),void 0!==t._id)e!==t.stanza&&(t.stanza=e),void 0!==e.message.body&&e.message.body!==t.body&&(t.body=e.message.body),null===t.type&&(t.type=e.message.$attributes.type),"groupchat"===t.type&&(t.state.sent=!0),null===t.jid&&(t.jid=o),null===t.sender_id&&(t.sender_id=r),null===t.sender_resource&&(t.sender_resource=a),null===t.recipient_id&&(t.recipient_id=e.message.$attributes.to),void 0!==e.message.data&&e.message.data!==t.data&&(t.data=e.message.data),(null===t.ts||e.message.timestamp&&e.message.timestamp.length>1)&&(t.ts=this._getTimestampFromStanza(e)),null===t.mine&&(t.mine=r===this._bareJid),e.message.actingDelegate&&(t.actingDelegate=e.message.actingDelegate),e.message.delegateJid&&(t.delegateJid=e.message.delegateJid),t.placeholder=!1,t.archive_id=this._getArchiveIdFromStanza(e),t.updated_at=this.getSyncedTimestamp(Date.now()),t=g._merge(t,n);else{let n=[];void 0!==e.message.attachments&&(Array.isArray(e.message.attachments)?n=e.message.attachments:n.push(e.message.attachments));e.message.$attributes.id,this._getArchiveIdFromStanza(e),e.message.$attributes.to,e.message.body,this._getTimestampFromStanza(e),e.message.data,e.message.$attributes.type,this._bareJid,e.message.markable;let i=[];void 0!==e.message.addresses&&(Array.isArray(e.message.addresses.address)?i=e.message.addresses.address:i.push(e.message.addresses.address)),t=Object.assign({},g._messageSkeleton(),{_id:e.message.$attributes.id,stanza:e,archive_id:this._getArchiveIdFromStanza(e),jid:o,sender_id:r,sender_resource:a,recipient_id:e.message.$attributes.to,body:e.message.body,ts:this._getTimestampFromStanza(e),data:e.message.data,attachments:n,type:e.message.$attributes.type,mine:r===this._bareJid,markable:void 0!==e.message.markable,addresses:i,delegateJid:e.message.delegateJid,actingDelegate:e.message.actingDelegate})}return e.message.$attributes&&"groupchat"===e.message.$attributes.type&&(t.type="groupchat",t.mine=s.default.Strophe.getBareJidFromJid(e.message.$attributes.from)===this._bareJid||s.default.Strophe.getResourceFromJid(e.message.$attributes.from)===this.username,t.mine=t.jid.includes(this._bareJid)),g._merge(t,n)}static _messageSkeleton(){return{_id:null,stanza:null,archive_id:null,jid:null,sender_id:null,sender_resource:null,recipient_id:null,body:null,updated_at:null,ts:null,state:{sent:null,markers:[],received:null,read:null,acknowledged:null},data:{},attachments:[],type:"chat",mine:null,markable:!1,fromMam:!1,placeholder:!1,injected:!1}}_messageStanzaToDbObject(e,t,n=null){return new o.Promise((i,o)=>{if(void 0!==e.message&&void 0!==e.message.$attributes)this.saveMessage(e.message.$attributes.id,i=>this._messageDelta(e,i,t,n)).then(i).catch(e=>{this._onError("Unable to convert message stanza to DB object.",e),o(e)});else{const e="No message part present in the stanza.";this._onError(e),o(e)}})}_getTimestampFromStanza(e){let t=null;if(void 0!==e.message&&void 0!==e.message.timestamp)if(Array.isArray(e.message.timestamp)){const n=e.message.timestamp.filter(e=>void 0!==e.$attributes&&e.$attributes.xmlns===g.NAMESPACES.CT_SERVER_TIMESTAMP);void 0!==n[0]&&(t=parseInt(n[0].$value))}else void 0!==e.message.timestamp.$value&&(t=parseInt(e.message.timestamp.$value));return null===t&&(t=this.getSyncedTimestamp(Date.now())),t}_getArchiveIdFromStanza(e){let t=null;if(void 0!==e.message.archived){const n=Array.isArray(e.message.archived)?e.message.archived[0]:e.message.archived;void 0!==n.$attributes&&void 0!==n.$attributes.id&&(t=n.$attributes.id)}return t}_log(e,t){!0===this._options.debug&&console.debug("["+(new Date).toString()+"] ",e,t||"")}getUniqueId(){return this._isMethodReady(!0,!0),this._connection.getUniqueId(`${this._instanceId}-${performance.now()}`)}_clearBotTimeout(e){this._botCommandTimeouts[e]&&(this._log(`Bot command response verified, removing bot timeout for request '${e}'.`),this._botCommandTimeouts[e].cancel(),delete this._botCommandTimeouts[e])}_clearBotPromise(e){this._botCommandPromises[e]&&(this._log(`Clearing bot command promise for request '${e}'.`),delete this._botCommandPromises[e])}_botCommandResponseHandler(e,t){if(!this._botCommandPromises[e])return!1;if(void 0!==t.message&&void 0!==t.message.$attributes&&"error"===t.message.$attributes.type){const n=void 0!==t.message.error&&void 0!==t.message.error.$attributes&&t.message.error.$attributes["request-id"]?t.message.error.$attributes["request-id"]:null;if(n===e){this._clearBotTimeout(n);const i=void 0!==t.message.error&&void 0!==t.message.error.text?t.message.error.text.$value:"An unexpected error occurred";this._botCommandPromises[e].reject(i),this._clearBotPromise(e)}}else if(void 0!==t.message&&void 0!==t.message.call&&void 0!==t.message.call.$attributes&&"result"===t.message.call.$attributes.type&&t.message.call.$attributes["request-id"]===e){if(this._clearBotTimeout(e),void 0!==t.message.call.json&&void 0!==t.message.call.json.$value){let n=null;try{n=JSON.parse(t.message.call.json.$value)}catch(t){this._onError("Couldn't parse JSON from bot command response:",t),this._botCommandPromises[e].reject(t),this._clearBotPromise(e)}null!==n&&(this._botCommandPromises[e].resolve(n),this._clearBotPromise(e))}return!1}return!0}sendBotCommand(e,t,n,i=5e3){return this._isMethodReady(!0,!0),new o.Promise((o,s)=>{const r=this.getUniqueId(),a={$attributes:{to:e,type:"normal"},call:{$attributes:{xmlns:g.NAMESPACES.INFINITY_BOT,"request-id":r,type:"get",name:t}}};let l=null;try{l=JSON.stringify(n)}catch(e){this._onError("Couldn't stringify JSON:",e)}null!==l&&(a.call.json={$attributes:{xmlns:"urn:xmpp:json:0"},$value:l}),this._botCommandPromises[r]={resolve:o,reject:s},this.sendStanza(a,!1).then(()=>{this._log(`Creating bot command timer for request '${r}'...`),this._botCommandTimeouts[r]=new c.default(r,()=>{this._log(`Bot command timer finished for request '${r}'.`),this._onError(`Didn't get a response from the bot within ${i}ms.`,{operationName:t}),this._botCommandPromises[r].reject("Your request took longer then expected, please try again.")},i)}).catch(e=>{this._onError("Couldn't send bot command:",e),s(e)})})}_pushHandler(e){this._log("Push Received: ",e)}_getPushTokens(){return new o.Promise((e,t)=>{const n=(n=null)=>{const i=l.getSource("PushNotification");if(!1!==i){const o={android:{},ios:{badge:"true",sound:"true",alert:"true"}};this._log("Registering for push notifications..."),null===this._push?(this._push=i.init(o),this._push.on("registration",t=>{const i=t.registrationId;this._log("Registered for push:",i),this._setCacheItem("push_token",i).then(()=>{e({voipToken:n,standardToken:i})})}),this._push.on("notification",e=>{this._pushHandler(e),this._options.push.reLoginOnPushAndroid&&(this.connected||this.reLoginNow())}),this._push.on("error",e=>{this._log("Error registering for push:",e),t(e)})):this._getCacheItem("push_token").then(t=>{e({voipToken:n,standardToken:t})})}else this._log("Could not find Push plugin"),t("Could not find Push plugin")};if(this._options.push.voip&&"ios"===r.getPlatformName()){const e=l.getSource("VoIPPushNotification");!1!==e?null===this._voip?(this._voip=e.init(),this._voip.on("registration",e=>{this._log("Registered for VOIP push: ",e.deviceToken),this._setCacheItem("voip_push_token",e.deviceToken).then(()=>{n(e.deviceToken)})}),this._voip.on("notification",e=>{this._pushHandler(e),this._options.push.reLoginOnPushiOS&&(this.connected||this.reLoginNow())}),this._voip.on("error",e=>{this._log("VOIP Push Error: "+e)})):this._getCacheItem("voip_push_token").then(e=>{n(e)}):(this._log("Could not find VOIP Push plugin"),t("Could not find VOIP Push plugin"))}else n()})}registerForPush(e){if(!r.isDevice())throw new Error("This platform does not support push notifications.");return new o.Promise((t,n)=>{const i={package:this._options.push.packageId,type:"ios"===r.getPlatformName()?"apns":"gcm",token:e.standardToken};!0!==this._options.useEncodedJidAsResource&&(i.installation_id=this._installId),e.voipToken&&(i.voip_token=e.voipToken),this.sendIq(null,"set",{push:{$attributes:{xmlns:g.NAMESPACES.CT_PUSH},notification:i}}).then(e=>{let i=null;try{i=e.iq.push.notification.$attributes.jid,this._pushNodeName=e.iq.push.notification.$attributes.node}catch(e){this._onError("Couldn't enable push notifications.",e),n(e)}null!==i&&this._setCacheItem("push_jid",i).then(()=>{this.storeSMSSecret(e.iq.push.notification.$attributes.secret).then(()=>{this.enablePush().then(t).catch(n)})})}).catch(e=>{this._onError("Couldn't register for push notifications:",e),n(e)})})}storeSMSSecret(e){return new o.Promise((t,n)=>{if("android"===r.getPlatformName()){const i=l.getSource("PushNotification");!1!==i?i.storeSMSSecret(function(){t()},function(){n()},e):n("Couldn't find push plugin to store SMS secret")}if("ios"===r.getPlatformName()){const i=l.getSource("appgroup");i||n("Could not add the value to app group storage. App Group plugin not found."),i.add(e=>{t(e)},e=>{n(`Could not add the value to app group storage. ${e}`)},"smsKey",e)}})}enablePush(){return new o.Promise((e,t)=>{this._getCacheItem("push_jid").then(n=>{void 0!==n?this.sendIq(null,"set",{enable:{$attributes:{xmlns:g.NAMESPACES.PUSH,jid:n,node:this._pushNodeName}}}).then(e).catch(e=>{this._onError("Unable to enable push notifications:",e),t(e)}):(this._onError("'registerForPush' must be called before 'enablePush'."),t())})})}disablePush(){return new o.Promise((e,t)=>{this._getCacheItem("push_jid").then(n=>{void 0!==n?this.sendIq(null,"set",{disable:{$attributes:{xmlns:g.NAMESPACES.PUSH,jid:n,node:this._pushNodeName}}}).then(e).catch(e=>{this._onError("Unable to disable push notifications:",e),t(e)}):e()})})}_perfStart(e,t,n){!0===this._options.perfLogging&&(console.log(`%c[START: ${e}] ${t}`,n),console.time(e))}_perfEnd(e,t,n){!0===this._options.perfLogging&&(console.log(`%c[END: ${e}] ${t}`,n),console.timeEnd(e))}static jsonToXml(e,t){return g._parseJsonNode(t,g._createElement(e,t.$attributes))}static _parseJsonNode(e,t){for(let n in e){let i=e[n];if(0!==n.indexOf("$"))if(Array.isArray(i)&&i.length>0)i.forEach(e=>{let i;"string"==typeof e?(i=g._createElement(n,{})).textContent=e:(i=g._createElement(n,e.$attributes),i=g._parseJsonNode(e,i)),t.appendChild(i)});else{const e="object"==typeof i&&null!==i?i.$attributes:void 0;let o=g._createElement(n,e);if("object"==typeof i&&null!==i&&Object.keys(i).length>0)o=g._parseJsonNode(i,o);else if("string"==typeof i){const e=g.doc.createTextNode(i);o.appendChild(e)}t.appendChild(o)}else if("$value"===n){const e=g.doc.createTextNode(i);t.appendChild(e)}else if("$cdata"===n){const e=g.doc.createCDATASection(i);t.appendChild(e)}}return t}static xmlToJson(e){return g._parseXmlNode(e,{})}static _parseXmlNode(e,t){let n={};if(void 0!==e.attributes&&e.attributes.length>0){n.$attributes={};for(let t=0;t<e.attributes.length;t++){const i=e.attributes[t];n.$attributes[i.nodeName]=i.value}}if(e.childNodes&&e.childNodes.length>0)for(let i=0;i<e.childNodes.length;i++){const t=e.childNodes[i];if(3===t.nodeType)void 0!==n.$attributes?n.$value=t.textContent:n=t.textContent;else if(4===t.nodeType)n.$cdata=t.textContent;else{if("\n"===n)continue;g._parseXmlNode(t,n)}}return void 0!==t[e.nodeName]&&!1===Array.isArray(t[e.nodeName])&&(t[e.nodeName]=[t[e.nodeName]]),Array.isArray(t[e.nodeName])?t[e.nodeName].push(n):t[e.nodeName]=n,t}static _createElement(e,t){null===g.doc&&(g.doc=document.implementation.createDocument("ct:xmpp:client","infinity",null));const n=g.doc.createElement(e);if(void 0!==t&&Object.keys(t).length>0)for(let i in t)n.setAttribute(i,t[i]);return n}static _getContactFromRosterByJid(e,t){let n=null;return void 0!==t&&void 0!==t.contacts&&t.contacts.length>0&&t.contacts.forEach(t=>{t.jid===e&&(n=t)}),n}static _isObject(e){return e&&"object"==typeof e&&!Array.isArray(e)}static _merge(e,...t){if(!t||!t.length)return e;const n=t.shift();if(g._isObject(e)&&g._isObject(n))for(const i in n)g._isObject(n[i])?(e[i]||Object.assign(e,{[i]:{}}),g._merge(e[i],n[i])):Object.assign(e,{[i]:n[i]});return g._merge(e,...t)}static _arraysEqual(e,t){if(!Array.isArray(e)||!Array.isArray(t))return e===t;if(e.length!==t.length)return!1;for(let n=e.length;n--;)if(e[n]!==t[n])return!1;return!0}static _validateEventType(e){return g._validateConstants(g.EVENT_TYPES,e)}static _validateChatStatus(e){return g._validateConstants(g.CHAT_STATUSES,e)}static _validateConstants(e,t){for(let n in e)if(e[n]===t)return!0;return!1}static getDomainFromJid(e){return s.default.Strophe.getBareJidFromJid(e).split("@")[1]}static _isMarkerMessage(e){return e.message.received&&e.message.received.$attributes&&e.message.received.$attributes.xmlns===g.NAMESPACES.CHAT_MARKERS||e.message.read&&e.message.read.$attributes&&e.message.read.$attributes.xmlns===g.NAMESPACES.CHAT_MARKERS||e.message.acknowledged&&e.message.acknowledged.$attributes&&e.message.acknowledged.$attributes.xmlns===g.NAMESPACES.CHAT_MARKERS}static getNodeFromJid(e){return s.default.Strophe.getNodeFromJid(e)}static pickFile(e={}){return a.pickFile(e)}_isMethodReady(e=!0,t=!1){if(!0===e&&!0!==this._initialised)throw new Error("XMPP client has not yet been fully initialised.");if(!0===t&&!1===this.connected)throw new Error("An active connection is required to perform this action.")}static isInBackground(){return h.isInBackground()}hasBeenLoggedIn(){return new o.Promise((e,t)=>{this._getCacheItem("user_password").then(t=>{e(!!t)})})}getUpdateHelper(){return this._updateHelper}openUpdateSite(){this._updateHelper.openUpdateSite()}addNewVersionEventListener(e){this._updateHelper.addNewVersionEventListener(e)}checkForUpdate(){return new o.Promise((e,t)=>{this.sendIq(this._domain,"set",this._updateHelper.getUpdateQueryPayload()).then(t=>{t.iq&&(t.iq.update?(this._updateHelper.updateInfo(!0,t.iq.update["client-version"],t.iq.update.url,"true"===t.iq.update.required,t.iq.update.info),this._updateHelper.isUpdateRequired()?e({available:!0,required:!0}):e({available:!0,required:!1})):(t.iq["no-update"],this._updateHelper.updateInfo(!1,null,null,!1),e({available:!1,required:!1})))})})}}g.doc=null,g.MARKER_TYPES={RECEIVED:"received",READ:"read",ACKNOWLEDGED:"acknowledged"},g.EVENT_TYPES={INITIALISED:"initialised",STATUS:"status",NEW_MESSAGE:"newmessage",ERROR:"error",MESSAGE_UPDATED:"messageupdated",PRESENCE_UPDATE:"presenceupdate",NEW_PARTICIPANT:"newparticipant",PARTICIPANT_UPDATED:"participantupdated",RECEIPT_RECEIVED:"receiptreceived",AUTO_RECONNECTED:"autoreconnected",DBS_DESTROYED:"dbsdestroyed",AUTO_DBS_DESTROYED:"autodbsdestroyed",ACK_RECEIVED:"ackreceived",UPLOAD_STARTED:"uploadstarted",UPLOAD_SUCCESS:"uploadsuccess",UPLOAD_FAILED:"uploadfailed",DELEGATEIQ:"delegateiq",UD_INITIALISED:"udinitialised",UD_UPDATED:"udupdated",FORCE_LOGGED_OUT:"forceloggedout"},g.CHAT_STATUSES={AWAY:"away",CHAT:"chat",DND:"dnd",XA:"xa"},g.NAMESPACES={MUC:"http://jabber.org/protocol/muc",MUC_SUB:"urn:xmpp:mucsub:0",MUC_OWNER:"http://jabber.org/protocol/muc#owner",X_DATA:"jabber:x:data",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",JABBER_CLIENT:"jabber:client",MAM:"urn:xmpp:mam:0",MAM_TMP:"urn:xmpp:mam:tmp",RESULT_SET_MANAGEMENT:"http://jabber.org/protocol/rsm",CHAT_MARKERS:"urn:xmpp:chat-markers:0",CT_METADATA:"ct:metadata:0",HINTS:"urn:xmpp:hints",CT_CLIENT_TIMESTAMP:"ct:client-timestamp:0",CT_SERVER_TIMESTAMP:"urn:commontime:infinity:timestamps",HTTP_UPLOAD:"urn:xmpp:http:upload",PING:"urn:xmpp:ping",CLIENT_STATE_INDICATION:"urn:xmpp:csi:0",ADDRESS:"http://jabber.org/protocol/address",VCARD_UPDATE:"vcard-temp:x:update",TIME:"urn:xmpp:time",INFINITY_BOT:"urn:commontime:infinity:api",PRIVATE_XML_STORAGE:"jabber:iq:private",CT_PRIVATE_XML_STORAGE:"ct:private-xml-data",CT_PUSH:"urn:commontime:infinity:push",PUSH:"urn:xmpp:push:0",DIRECTORY:"urn:commontime:infinity:directory",CARBONS:"urn:xmpp:carbons:2",INFINITY_MAM:"urn:commontime:infinity:mam",INFINITY_ACK:"urn:commontime:infinity:ack",SOFTWARE_VERSION:"jabber:iq:version",DELEGATE:"urn:commontime:infinity:delegate"},g.MUC_NODES={PRESENCE:"urn:xmpp:mucsub:nodes:presence",MESSAGES:"urn:xmpp:mucsub:nodes:messages",AFFILIATIONS:"urn:xmpp:mucsub:nodes:affiliations",CONFIG:"urn:xmpp:mucsub:nodes:config",SUBJECT:"urn:xmpp:mucsub:nodes:subject",SYSTEM:"urn:xmpp:mucsub:nodes:system"},g.MARKER_PRIORITIES={received:3,read:2,acknowledged:1},g.OBJECT_TYPES={MESSAGE:"message",CONTACT:"contact",ROOM:"room",PARTICIPANT:"participant",CACHE_ITEM:"cache_item",OBJECT_URL:"object_url"},g.CLIENT_STATES={ACTIVE:"active",INACTIVE:"inactive"},g.ERROR_CODES={DESTROYING_DBS:"destroying_dbs"},t.CtXmppClient=g,window.CtXmppClient=g},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(25),s=n(24),r=n(5);t.getThumbnail=function(e,t,n,s){return i(this,void 0,void 0,function*(){return new Promise((i,r)=>{const a=o.getSource("thumbnail");a||r("Could not create thumbnail of image. Thumbnail plugin not found."),a.makeThumbnail(e=>{i(e)},e=>{r(`Could not create thumbnail of image. ${e}`)},e,t,n,s)})})},t.setApplicationIconBadgeNumber=function(e){return i(this,void 0,void 0,function*(){return new Promise((t,n)=>{const i=o.getSource("notification"),s=o.getSource("appgroup");i||n("Could not set application icon badge number. Notification plugin not found."),s||n("Could not set application icon badge number. AppGroup plugin not found."),i.setApplicationIconBadgeNumber(()=>{s.setApplicationBadgeNumber(()=>{t()},e=>{n(`Could not set application icon badge number. ${e}`)},e)},e=>{n(`Could not set application icon badge number. ${e}`)},e)})})},t.isAppInForeground=function(){return i(this,void 0,void 0,function*(){return new Promise((e,t)=>{if(s.isDevice()){const n=o.getSource("appstate");n||t("Could not obtain foreground sate of app. App State plugin not found."),n.isAppInForeground(t=>{e(t)},e=>{t(`Could not obtain foreground sate of app. ${e}`)})}else e(document.hasFocus())})})},t.addConversationToAppGroupStorage=function(e){return i(this,void 0,void 0,function*(){return new Promise((t,n)=>{if(r.isIos()){const i=o.getSource("appgroup");i||n("Could not add the conversation to app group storage. App Group plugin not found."),i.addConversation(e=>{t(e)},e=>{n(`Could not add the conversation to app group storage. ${e}`)},e)}else t()})})},t.removeConversationFromAppGroupStorage=function(e){return i(this,void 0,void 0,function*(){return new Promise((t,n)=>{if(r.isIos()){const i=o.getSource("appgroup");i||n("Could not remove the conversation from app group storage. App Group plugin not found."),i.removeConversation(e=>{t(e)},e=>{n(`Could not remove the conversation from app group storage. ${e}`)},e)}else t()})})}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});t.BaseEventArgs=class{constructor(){this.eventDate=(new Date).getTime()}}},function(e,t){e.exports=skate},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});var i=n(108);t.IQError=i.IQError;var o=n(109);t.NotConnectedError=o.NotConnectedError},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(4),s=n(11),r=n(0);const a=new class{constructor(){this._data={adminAccounts:[],myAccounts:[],possibleAccounts:[],names:{}}}getDelegateState(){return this._data}getDelegateName(e){return this._data.names[e]}getDelegatedAccounts(){return this._data.myAccounts.map(e=>e.jid)||[]}setDelegateState(e){return this._data.adminAccounts=e.adminAccounts,this._data.myAccounts=e.myAccounts,this._data.possibleAccounts=e.possibleAccounts,this._data.names=e.names,this._data}setMyDelegateAccounts(e){this._data.myAccounts=e}addToDelegatedAccounts(e,t){return i(this,void 0,void 0,function*(){const n=this._data.possibleAccounts.findIndex(e=>e.jid.toLowerCase()===t.toLowerCase());if(n>-1){const e=this._data.possibleAccounts.splice(n,1)[0];e.mine=!0,this._data.myAccounts.push(e),this._data.myAccounts.sort((e,t)=>e.displayName<t.displayName?-1:1)}return yield e.store.setMyDelegates(this._data.myAccounts),this._data})}removeFromDelegatedAccounts(e,t){return i(this,void 0,void 0,function*(){t=t.toLowerCase();const n=this._data.myAccounts.findIndex(e=>e.jid.toLowerCase()===t);if(n>-1){const i=this._data.myAccounts.splice(n,1)[0];i.mine=!1,i.activeUsers[0]&&i.activeUsers[0].jid===e.getCurrentUserJid()&&i.activeUsers.splice(0,1),this._data.possibleAccounts.push(i),this._data.possibleAccounts.sort((e,t)=>e.displayName<t.displayName?-1:1);for(const n of e.store.getDelegateConversations()[t].conversations)e.isLastConversationInDelegateAccounts(n)&&(yield e.comms.clearStoredConversationAttachments(n));yield e.store.deleteDelegateConversations(t)}return e.store.getWorkspaceAccount()===t&&e.store.setWorkspaceAccount(e.getCurrentUser().jid),yield e.store.setMyDelegates(this._data.myAccounts),this._data})}getCurrentlyDelegatedAccounts(e){return i(this,void 0,void 0,function*(){const t={adminAccounts:[],myAccounts:[],possibleAccounts:[],names:{}};yield e.updateUserDirectory();const n=yield e.fetchDelegateAccounts(),i=e.store.getDelegateConversations();if(Object.keys(n).reduce((e,t)=>{const i=Object.keys(n[t])[0],o=n[t][i],s=new Set([...e,t,...o.active,...o.proxies]);return Array.from(s)},[]).map(e=>e.toLowerCase()).length){const o=(yield e.getAllUsers()).map(e=>Object.assign({delegable:!0,badge:0,mine:!1},e)).reduce((e,t)=>(e[t.jid.toLowerCase()]=Object.assign({delegable:!0,badge:0,mine:!1},t),e),{});o["*"]={jid:"*",username:"*",badge:0,mine:!1,connectionStatus:r.ConnectionStatus.Disconnected,delegable:!1,id:"*"};for(const a in n){const l=Object.keys(n[a])[0],c=n[a][l],d=a.toLowerCase();if(c.active=c.active.map(e=>e.toLowerCase()),c.proxies=c.proxies.map(e=>e.toLowerCase()),o[d])if(o[d].permissions=c.perms,o[d].proxies=c.proxies.map(e=>o[e]),o[d].delegateName=l,t.names[d]=o[d].delegateName,c.active.includes(e.getCurrentUserJid()))o[d].mine=!0,o[d].activeUsers=[e.getCurrentUser()],t.myAccounts.push(o[d]),i[d]||(i[d]={latestIdentifier:0,conversations:[]});else{if(c.active.length>0){o[d].activeUsers=c.active.map(e=>o[e]?o[e]:{id:""+(new Date).getTime(),jid:e,displayName:"Unknown User",username:"",connectionStatus:r.ConnectionStatus.Disconnected});for(const e of o[d].activeUsers){if(!e)continue;const t=o[d].proxies.findIndex(t=>!t||t.jid===e.jid);t>-1&&o[d].proxies.splice(t,1)}}else o[d].activeUsers=[];o[d].mine=!1,c.perms.includes(s.DelegatePermissions.ASSIGN||s.DelegatePermissions.REMOVE||s.DelegatePermissions.TRANSFER)&&t.adminAccounts.push(o[d]),c.perms.includes(s.DelegatePermissions.ACQUIRE||s.DelegatePermissions.GIVE||s.DelegatePermissions.RELINQUISH||s.DelegatePermissions.TAKE)&&t.possibleAccounts.push(o[d])}}}const o=[...t.myAccounts.map(e=>e.jid),...[e.getCurrentUserJid()]];for(const s in i)o.includes(s)||(yield this.removeFromDelegatedAccounts(e,s),delete i[s]);return yield e.store.setDelegateConversations(i),t.adminAccounts.sort((e,t)=>e.displayName<t.displayName?-1:1),t.myAccounts.sort((e,t)=>e.displayName<t.displayName?-1:1),t.possibleAccounts.sort((e,t)=>e.displayName<t.displayName?-1:1),this.setDelegateState(t)})}takeAccount(e,t){return i(this,void 0,void 0,function*(){if(yield e.performDelegateAction(o.ChatMessageType.TakeDelegation,{name:t.delegateName,role:t.jid,from:t.activeUsers[0].jid})){const n=yield this.addToDelegatedAccounts(e,t.jid);return yield e.loadAllConversations(t.jid),yield e.displayNewestAlert(),yield this.getCurrentlyDelegatedAccounts(e),n}return this._data})}acquireAccount(e,t){return i(this,void 0,void 0,function*(){if(yield e.performDelegateAction(o.ChatMessageType.AcquireDelegation,{name:t.delegateName,role:t.jid})){const n=yield this.addToDelegatedAccounts(e,t.jid);return yield e.loadAllConversations(t.jid),yield e.displayNewestAlert(),n}return this._data})}relinquishAccount(e,t){return i(this,void 0,void 0,function*(){return(yield e.performDelegateAction(o.ChatMessageType.RelinquishDelegation,{name:t.delegateName,role:t.jid}))?yield this.removeFromDelegatedAccounts(e,t.jid):this._data})}giveAccount(e,t,n){return i(this,void 0,void 0,function*(){return(yield e.performDelegateAction(o.ChatMessageType.GiveDelegation,{name:t.delegateName,role:t.jid,to:n}))?yield this.getCurrentlyDelegatedAccounts(e):this._data})}assignAccount(e,t,n){return i(this,void 0,void 0,function*(){return yield e.performDelegateAction(o.ChatMessageType.AssignDelegation,{name:t.delegateName,role:t.jid,to:n}),yield this.getCurrentlyDelegatedAccounts(e)})}releaseAccount(e,t){return i(this,void 0,void 0,function*(){return yield e.performDelegateAction(o.ChatMessageType.ReleaseDelegation,{name:t.delegateName,role:t.jid,from:t.activeUsers[0].jid}),yield this.getCurrentlyDelegatedAccounts(e)})}transferAccount(e,t,n){return i(this,void 0,void 0,function*(){return yield e.performDelegateAction(o.ChatMessageType.TransferDelegation,{name:t.delegateName,role:t.jid,from:t.activeUsers[0].jid,to:n}),yield this.getCurrentlyDelegatedAccounts(e)})}};Object.freeze(a),t.default=a},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(0);t.UserLookup=class{constructor(e){if(!e)throw new Error("Chat Layer Component Interface not supplied");this._layer=e,this._users=new Map}populate(e=[],t=[]){return i(this,void 0,void 0,function*(){const n=new Set;e&&e.forEach(e=>this._addFromConversation(e,n)),t&&t.forEach(e=>i(this,void 0,void 0,function*(){return this._addFromChatEntry(e,n)}));const o=Array.from(n.keys()).map(e=>this._processJid(e));return yield Promise.all(o),n.size>0})}getJids(){return[...this._users.keys()]}hasJid(e){return this._users.has(e)}get(e){if(!e)return null;const t=e.toLowerCase();return this._users.get(t)||null}_addFromConversation(e,t){return i(this,void 0,void 0,function*(){e.participants&&e.participants.length&&e.participants.forEach(e=>this._addIfNew(e.jid,t)),e.preview&&this._addFromChatEntry(e.preview,t),e.instigator&&this._addIfNew(e.instigator,t)})}_addFromChatEntry(e,t){return i(this,void 0,void 0,function*(){switch(e.type){case o.ChatEntryType.Chat:const n=e;this._addIfNew(n.from,t),n.actingDelegate&&this._addIfNew(n.actingDelegate,t);break;case o.ChatEntryType.Meta:const i=e;this._addIfNew(i.instigator,t),this._addIfNew(i.subject,t)}})}_processJid(e){return i(this,void 0,void 0,function*(){if(!e)return;const t=e.toLowerCase();if(this._users.has(t))return;const n=yield this._layer.getUserByJid(t);this._users.set(t,n||function(e){return{id:e,jid:e,username:e.split("@")[0],connectionStatus:o.ConnectionStatus.Disconnected,displayName:e}}(t))})}_addIfNew(e,t){if(!e)return;const n=e.toLowerCase();this.hasJid(n)||t.add(n)}}},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(8),a=n(13),l=n(0);class c extends s.CTLayerComponent{static get is(){return"ct-role-avatar"}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return n(297)}generateComponentMarkup(){const e=a.buildStyles({width:`${this.size}px`,height:`${this.size}px`}),t={};this.badge&&!this.indicator&&(t["data-badge"]=this.badge.toString());const n=Math.floor(this.size/2);return window.__CTRender("div",Object.assign({class:"bg",style:e},t),window.__CTRender(r.CTIcon,{icon:l.Icons.COMMON.Role,width:n,height:n}))}}i([s.prop({type:Number,attribute:!1,default:40})],c.prototype,"size",void 0),i([s.prop({type:Number,attribute:!1,default:0})],c.prototype,"badge",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],c.prototype,"indicator",void 0),t.CTRoleAvatar=c,c.register()},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(17),a=n(0),l=n(8),c=n(47),d=n(22),h=n(13),u=n(5),p=n(12),g=n(48),m=n(49),f=n(26),_=n(36);var v;!function(e){e[e.SEARCH_PLACEHOLDER="Find Users"]="SEARCH_PLACEHOLDER",e[e.INITIAL_MESSAGE="Find users by searching for first name or last name"]="INITIAL_MESSAGE",e[e.NO_MATCHES="No results for your search"]="NO_MATCHES",e[e.SEARCH_BY="Search By:"]="SEARCH_BY",e[e.SEARCH_USER="User"]="SEARCH_USER",e[e.CURRENT_GROUP="CURRENT GROUP"]="CURRENT_GROUP",e[e.ERROR_UNABLE_TO_ADD_GROUP_TITLE="Unable to add group"]="ERROR_UNABLE_TO_ADD_GROUP_TITLE",e[e.ERROR_UNABLE_TO_ADD_GROUP_DESCRIPTION="It is not possible to add this group as it would exceed the maximum number of users allowed."]="ERROR_UNABLE_TO_ADD_GROUP_DESCRIPTION"}(v||(v={}));class y{static _create(){return new r.Metadata(w,v)}static get instance(){return this._instance||(this._instance=this._create())}}y._instance=null,t.CTUserListMetadata=y;class C{constructor(e,t){"BaseUser"===t?(this.id=e.jid,this.displayName=e.displayName,this.userFirstName=e.firstName,this.userLastName=e.lastName,this.userGroups=e.group,this.jobTitle=e.jobTitle,e.is_role?this.isRole=!0:this.isUser=!0):"Role"===t?(this.id=e.jid,this.displayName=e.displayName,this.userGroups=e.group,this.isRole=!0):"Group"===t?(this.id=e.id,this.displayName=e.name,this.description=e.description,this.groupParents=e.parents,this.isGroup=!0):"ChatGroup"===t&&(this.id=e.name,this.displayName=e.name,this.description="",this.groupUsers=e.users,this.isGroup=!0)}transformToBaseUser(){if(this.isGroup)return;return{id:"",username:this.displayName,firstName:this.userFirstName,lastName:this.userLastName,jid:this.id,connectionStatus:null,group:this.userGroups,is_role:this.isRole,jobTitle:this.jobTitle?this.jobTitle:""}}transformToChatGroup(){if(!this.isGroup)return;return{name:this.displayName,users:this.groupUsers}}transformToGroup(){if(!this.isGroup)return;return{id:this.id,name:this.displayName,description:this.description}}}t.UserListItem=C;class w extends p.CTCLComponent{constructor(){super(),this.TILE_HEIGHT=95,this._listItems=[],this._paginationEnabled=!1,this._isFetchingMore=!1,this.PAGE_SIZE=30,this._canPrev=!1,this._canNext=!0,this._currentApiSource="",this._textFilter=null,this._usersFilter=`${v.SEARCH_USER.toString()}s`,this._rolesFilter=`${f.rolesLabel}s`,this._groupsFilter=`${f.groupsLabel}s`,this._currentSelectionCount=0,this._onSearchChange=((e,t,n)=>{const i=!t||0===t.trim().length;this.isFetching=!i,this._searchContacts((e||"").toLowerCase(),t,n)}),this._nearBottom=(()=>o(this,void 0,void 0,function*(){this._paginationEnabled&&(yield this._getNextPage(!1,this.searchTerm),setTimeout(()=>{this._isFetchingMore=!1,this.forceRedraw()},1e3),this._alreadyFetching=!1)})),this._atBottom=(()=>o(this,void 0,void 0,function*(){this._paginationEnabled&&this._canNext&&(this._isFetchingMore=!0,this.forceRedraw())})),this.setMetadata(y.instance),this._onWindowResize=this._onWindowResize.bind(this),window.addEventListener("resize",this._onWindowResize,!0)}static get is(){return"ct-user-list"}initialize(){return o(this,void 0,void 0,function*(){this._virtualList=new d.VirtualList(this,[],{itemHeight:this.TILE_HEIGHT,itemKeyGetter:e=>e&&e.isGroup?e.displayName:e.id,blockSize:10}),this.allowSearch&&this.requireSearch?(this.isFetching=!1,this.searchTerm="",this.defer(()=>o(this,void 0,void 0,function*(){this._textFilter&&this._textFilter.focusInput()}))):(this.isFetching=!0,this.defer(()=>o(this,void 0,void 0,function*(){yield this._searchContacts("","")})))})}setupListeners(){}disconnectedCallback(){window.removeEventListener("resize",this._onWindowResize)}get generateComponentStyles(){return n(314)}generateComponentMarkup(){const e=[];return this.inGroupAdminUI||e.push(this._usersFilter),this.noRoles||e.push(this._rolesFilter),this.noGroups||e.push(this._groupsFilter),window.__CTRender("div",{class:"user-list"},this.allowSearch&&window.__CTRender("div",{class:"search"},this.inGroupAdminUI&&window.__CTRender(c.CTSelectionTextFilter,{id:"user-list-search",placeholder:this.searchPlaceholder||this.translateI18nItem(v.SEARCH_PLACEHOLDER),selectionItems:e,defaultSelectionValue:this._usersFilter,onSearch:this._onSearchChange,ref:e=>this._textFilter=e,enableSelection:!this.disableFilterDropdown})||window.__CTRender(c.CTSelectionTextFilter,{id:"user-list-search",placeholder:this.searchPlaceholder||this.translateI18nItem(v.SEARCH_PLACEHOLDER),selectionItems:e,onSearch:this._onSearchChange,ref:e=>this._textFilter=e,enableSelection:!this.disableFilterDropdown})),this.allowSelection&&this._renderSelections(),this.isFetching&&window.__CTRender("div",{class:"fetching"},window.__CTRender(l.CTIcon,{width:"16",height:"16",icon:a.Icons.COMMON.LoadingSpinner,spin:!0})),!this.isFetching&&window.__CTRender("div",{class:"user-list-items"},this._listItems&&this._listItems.length>1&&window.__CTRender("div",{class:"fetching users-loading-bg"},window.__CTRender(l.CTIcon,{width:"16",height:"16",icon:a.Icons.COMMON.LoadingSpinner,spin:!0})),this._renderUsers()))}_renderSelections(){const e=["selected-users"];return this.selections.size>0?(e.push("has-selections"),this.classList.add("has-selections")):this.classList.remove("has-selections"),window.__CTRender("div",{class:e.join(" ")},this.selections.size>0&&window.__CTRender("div",{class:"scroller"},[...this.selections.values()].map(e=>window.__CTRender("div",{class:"selected-user"},h.renderIf(e.isUser||e.isRole,window.__CTRender("div",{class:"avatar"},e.isUser&&window.__CTRender(l.CTUserAvatar,{user:e.transformToBaseUser(),size:32})||window.__CTRender(_.CTRoleAvatar,{user:e.transformToBaseUser(),size:32}),window.__CTRender("div",{class:"remove",onClick:t=>this._removeUserSelection(e,t)},window.__CTRender(l.CTIcon,{class:"icon",width:"6",height:"6",icon:a.Icons.COMMON.Cross})))),h.renderIf(e.isGroup,window.__CTRender("div",{class:"avatar"},window.__CTRender(g.CTGroupAvatar,{size:32}),window.__CTRender("div",{class:"remove",onClick:t=>this._removeUserSelection(e,t)},window.__CTRender(l.CTIcon,{class:"icon",width:"6",height:"6",icon:a.Icons.COMMON.Cross})))),h.renderIf(e.isUser||e.isRole,window.__CTRender("div",{class:"name"},u.formatUserName(e.transformToBaseUser(),this.selectedUsersNameFormat))),h.renderIf(e.isGroup,window.__CTRender("div",{class:"name"},e.displayName))))))}_renderUsers(){const e=!this.searchTerm||0===this.searchTerm.trim().length;return this.allowSearch&&this.requireSearch&&e?window.__CTRender("div",{class:"initial-message"},this.initialMessage||this.translateI18nItem(v.INITIAL_MESSAGE)):0===(this._listItems?this._listItems.length:0)?window.__CTRender("div",{class:"initial-message"},this.noMatchesMessage||this.translateI18nItem(v.NO_MATCHES)):this._virtualList.render(this._renderItem.bind(this),"users","users-content")}_disableSelectionForExistingConversation(e){return this.disableSelection||this._currentSelectionCount===e||this._currentSelectionCount>e}_renderItem(e,t){const n=this._userSelected(e),i=["user"],o=this.disableSelection||this._maxUsersReached(),s=this.currentGroup&&e.isGroup&&e.id===this.currentGroup;this.allowSelection&&(n||e.disabled)&&i.push("selected"),!n&&o&&i.push("selection-disabled"),"function"!=typeof this.onClickUser||e.disabled||s||i.push("clickable"),"function"!=typeof this.onClickGroup||e.disabled||s||i.push("clickable"),(e.disabled||s)&&i.push("item-disabled");const r=t=>{t.stopPropagation(),this.allowSelection&&(!n&&o||this._toggleUserSelection(e,t))},c=h.buildStyles({paddingRight:"36px",opacity:e.disabled||s?.5:1}),d=h.buildStyles({opacity:e.disabled||s?.5:1});return e.isGroup?window.__CTRender("div",Object.assign({class:i.join(" ")},t,{onClick:e.disabled||s?"":r.bind(this)}),window.__CTRender(m.CTGroupTile,{group:e.transformToChatGroup(),height:`${this.TILE_HEIGHT}px`,detailStyle:c,avatarStyle:d,avatarClickedCallback:t=>this._onClickItem(e,t),hideMemberCount:!!this.inGroupAdminUI},this.allowSelection&&window.__CTRender("div",{slot:"additional",class:"selection"},!s&&window.__CTRender("div",{class:"checkbox"},(e.disabled||n)&&window.__CTRender(l.CTIcon,{width:"12",height:"12",icon:a.Icons.COMMON.Tick}))||window.__CTRender("div",{class:"current"},this.translateI18nItem(v.CURRENT_GROUP))))):window.__CTRender("div",Object.assign({class:i.join(" ")},t,{onClick:e.disabled||s?"":r.bind(this)}),window.__CTRender(l.CTUserTile,{user:e.transformToBaseUser(),nameFormat:this.nameFormat,height:`${this.TILE_HEIGHT}px`,detailStyle:c,avatarStyle:d,avatarClickedCallback:t=>this._onClickItem(e,t)},this.allowSelection&&window.__CTRender("div",{slot:"additional",class:"selection"},window.__CTRender("div",{class:"checkbox"},(e.disabled||n)&&window.__CTRender(l.CTIcon,{width:"12",height:"12",icon:a.Icons.COMMON.Tick})))))}_onWindowResize(){this.debounce("resize",()=>{this.forceRecalcList()})}forceRecalcList(){this._virtualList.forceRecalc()}_onClickItem(e,t){t.stopPropagation(),e.isGroup?"function"==typeof this.onClickGroup&&this.onClickGroup(e.transformToChatGroup()):"function"==typeof this.onClickUser&&this.onClickUser(e.transformToBaseUser())}_toggleUserSelection(e,t){return o(this,void 0,void 0,function*(){t.stopPropagation(),this.allowSelection&&(this._userSelected(e)?yield this._removeUserSelection(e,t):yield this._addUserSelection(e,t))})}_addUserSelection(e,t){return o(this,void 0,void 0,function*(){this.layer.config.behaviour.maxConversationParticipantsExisting;if(t.stopPropagation(),e.isGroup){if(this.blockGroupSelection&&this.blockGroupSelection.length>0&&this.blockGroupSelection.filter(t=>t===e.id).length>0)return void this.layer.error(this.blockGroupSelectionTitle,this.blockGroupSelectionReason);if(this._maxUsersWillBeReached(this.inGroupAdminUI?1:e.groupUsers.length))return void this.layer.error(this.translateI18nItem(v.ERROR_UNABLE_TO_ADD_GROUP_TITLE),this.translateI18nItem(v.ERROR_UNABLE_TO_ADD_GROUP_DESCRIPTION));if(this._currentSelectionCount+=e.groupUsers?e.groupUsers.length:1,this.onGroupSelectionShowError&&this.onGroupSelectionShowError instanceof Function){if(this.onGroupSelectionShowError(this._currentSelectionCount))return this._currentSelectionCount-=e.groupUsers.length,void this.layer.error(this.translateI18nItem(v.ERROR_UNABLE_TO_ADD_GROUP_TITLE),this.translateI18nItem(v.ERROR_UNABLE_TO_ADD_GROUP_DESCRIPTION))}}else this._currentSelectionCount+=1;this.selections.set(e.id,e),this.onRenderComplete(()=>{const e=this.shadowRoot.querySelector(".selected-users");e.scrollLeft=e.firstChild.clientWidth},!0),"function"==typeof this.onChangeSelection&&this.onChangeSelection(yield this.getSelections(),this._currentSelectionCount),this.forceRedraw()})}_removeUserSelection(e,t){return o(this,void 0,void 0,function*(){t.stopPropagation(),e.isGroup?this._currentSelectionCount-=e.groupUsers?e.groupUsers.length:1:this._currentSelectionCount-=1,this.selections.delete(e.id),"function"==typeof this.onChangeSelection&&this.onChangeSelection(yield this.getSelections(),this._currentSelectionCount),this.forceRedraw()})}getSelections(){return o(this,void 0,void 0,function*(){return this.allowSelection?[...this.selections.values()]:[]})}clearSelections(){return o(this,void 0,void 0,function*(){this.allowSelection&&(this.selections.clear(),"function"==typeof this.onChangeSelection&&this.onChangeSelection(yield this.getSelections()),this.forceRedraw(),yield u.sleep(0))})}clearFilter(){return o(this,void 0,void 0,function*(){if(!this.allowSearch)return;const e=this.shadowRoot.querySelector("#user-list-search");e&&e.clear()})}reset(){return o(this,void 0,void 0,function*(){yield this.clearSelections()})}_searchContacts(e,t,n){return o(this,void 0,void 0,function*(){if((!t||0===t.trim().length)&&this.requireSearch)this.searchTerm="",this._virtualList.setItems([]),this.isFetching=!1;else{switch(this.isFetching=!0,e){case this._usersFilter.toLowerCase():this._disablePagination(),this._listItems=yield this._searchUsers(t);break;case this._rolesFilter.toLowerCase():this._enablePagination(),this._canPrev=!1,this._canNext=!0,this._listItems=yield this._searchRoles(t);break;case this._groupsFilter.toLowerCase():this._enablePagination(),this._canPrev=!1,this._canNext=!0,this._listItems=yield this._searchGroups(t);break;default:const n=yield this._searchUsers(t);let i=[],o=[];this.noRoles||(i=yield this._searchRoles(t)),this.noGroups||(o=yield this._searchGroups(t));let s=[...new Set([...n,...i,...o])];s=u.sortUserListItems(s),this._listItems=s}this.isFetching=!1,this._virtualList.setItems(this._listItems),this.searchTerm=t,n&&!n.value&&(this.searchTerm="",this._listItems=[]),this._listItems&&this._listItems.length>0&&(this._virtualList.addScrollAtBottomListener(yield this._atBottom),this._virtualList.addScrollNearBottomListener(yield this._nearBottom))}})}_searchUsers(e){return o(this,void 0,void 0,function*(){const t=[];t.push("firstName"),t.push("lastName"),t.push("jobTitle");const n=[],i=!this.inGroupAdminUI&&!this.inRoleAdminUI,o=yield this.layer.searchUsers(e,t,!0,i);for(const e of o){const t=new C(e,"BaseUser");this.excludeUsers&&this.excludeUsers.includes(e.jid.toLowerCase())&&(t.disabled=!0),n.push(t)}return n})}_searchRoles(e){return o(this,void 0,void 0,function*(){if(this.inGroupAdminUI){const t=yield this._getNextPage(!0,e,"role");for(const e of t)this.excludeUsers&&this.excludeUsers.includes(e.id)&&(e.disabled=!0);return t}{const t=[];t.push("lastName");const n=[],i=yield this.layer.searchRoles(e,t);for(const e of i){const t=new C(e,"BaseUser");this.excludeUsers&&this.excludeUsers.includes(e.jid)&&(t.disabled=!0),n.push(t)}return n}})}_searchGroups(e){return o(this,void 0,void 0,function*(){if(this.inGroupAdminUI){const t=yield this._getNextPage(!0,e,"group");for(const e of t)this.excludeGroups&&this.excludeGroups.includes(e.displayName)&&(e.disabled=!0);return t}{const t=[],n=yield this.layer.searchGroups(e);for(const e of n){if("_"===e.trim().charAt(0))continue;if(this.excludeGroupsWithHash&&"#"===e.trim().charAt(0))continue;const n=!this.inGroupAdminUI,i=yield this._setUsersInGroups(e,n);if(i.length){const n=new C({name:e,users:i},"ChatGroup");this.excludeGroups&&this.excludeGroups.includes(e)&&(n.disabled=!0),t.push(n)}}return t}})}_userSelected(e){return this.selections.has(e.id)}_maxUsersWillBeReached(e){return!(!this.maxSelections&&0!==this.maxSelections)&&this._totalSelectedUserCount()+e>this.maxSelections}_totalSelectedUserCount(){const e=new Map;for(const t of this.selections.values())e.set(t.id,t);return e.size}_maxUsersReached(){return!(!this.maxSelections&&0!==this.maxSelections)&&(this._totalSelectedUserCount()>=this.maxSelections||this.disableSelection)}_enablePagination(){this._paginationEnabled=!0}_disablePagination(){this._paginationEnabled=!1}_getNextPage(e,t,n=this._currentApiSource){return o(this,void 0,void 0,function*(){if(this._canNext&&!this._alreadyFetching){this._alreadyFetching=!0;const i=[];if("role"===n){const n={direction:"forwards",pagesize:""+(this.PAGE_SIZE+1),filter:t};e||(n.offset=this._listItems[this._listItems.length-1].displayName);const o=yield this.layer.queryRoles(n);for(const e of o)i.push(new C(e,"Role"));this._currentApiSource="role"}else if("group"===n){const n={direction:"forward",page_size:""+(this.PAGE_SIZE+1),filter:t};e||(n.offset=this._listItems[this._listItems.length-1].displayName);const o=yield this.layer.queryGroups(n);for(const e of o)i.push(new C(e,"Group"));this._currentApiSource="group"}return i.length===this.PAGE_SIZE+1?(this._canNext=!0,i.pop()):this._canNext=!1,this._listItems=this._listItems.concat(i),this._virtualList.addItems(i),this._alreadyFetching=!1,i}})}_setUsersInGroups(e,t=!0){return o(this,void 0,void 0,function*(){const n=yield this.layer.getAllUsersInGroup(e,t);return 1===n.length?n.filter(e=>!this.excludeUsers.includes(e.jid)):n})}}i([s.prop({type:Object,attribute:!1,default:u.NameFormat.PREFIX_FIRST_LAST})],w.prototype,"nameFormat",void 0),i([s.prop({type:Array,attribute:!1,default:null})],w.prototype,"excludeUsers",void 0),i([s.prop({type:Array,attribute:!1,default:null})],w.prototype,"excludeGroups",void 0),i([s.prop({type:String,attribute:!1,default:null})],w.prototype,"currentRole",void 0),i([s.prop({type:String,attribute:!1,default:null})],w.prototype,"currentGroup",void 0),i([s.prop({type:s.Stroolean,attribute:!1,default:!1})],w.prototype,"allowSearch",void 0),i([s.prop({type:s.Stroolean,attribute:!1,default:!1})],w.prototype,"requireSearch",void 0),i([s.prop({type:String,attribute:!1,default:null})],w.prototype,"searchPlaceholder",void 0),i([s.prop({type:String,attribute:!1,default:null})],w.prototype,"initialMessage",void 0),i([s.prop({type:String,attribute:!1,default:null})],w.prototype,"noMatchesMessage",void 0),i([s.prop({type:s.Stroolean,attribute:!1,default:!1})],w.prototype,"allowSelection",void 0),i([s.prop({type:s.Stroolean,attribute:!1,default:!1})],w.prototype,"noRoles",void 0),i([s.prop({type:s.Stroolean,attribute:!1,default:!1})],w.prototype,"noGroups",void 0),i([s.prop({type:s.Stroolean,attribute:!1,default:!1})],w.prototype,"disableFilterDropdown",void 0),i([s.prop({type:Object,attribute:!1,default:u.NameFormat.PREFIX_INITIAL_LAST})],w.prototype,"selectedUsersNameFormat",void 0),i([s.prop({type:s.NullableNumber,attribute:!1,default:null})],w.prototype,"maxSelections",void 0),i([s.prop({type:Function,attribute:!1,default:null})],w.prototype,"onClickUser",void 0),i([s.prop({type:Function,attribute:!1,default:null})],w.prototype,"onClickGroup",void 0),i([s.prop({type:Function,attribute:!1,default:null})],w.prototype,"onChangeSelection",void 0),i([s.prop({type:Function,attribute:!1,default:null})],w.prototype,"onGroupSelectionShowError",void 0),i([s.prop({type:Object,attribute:!1,default:new Map})],w.prototype,"selections",void 0),i([s.prop({type:String,attribute:!1,default:""})],w.prototype,"searchTerm",void 0),i([s.prop({type:s.Stroolean,attribute:!1,default:!1})],w.prototype,"isFetching",void 0),i([s.prop({type:s.Stroolean,attribute:!1,default:!1})],w.prototype,"inGroupAdminUI",void 0),i([s.prop({type:s.Stroolean,attribute:!1,default:!1})],w.prototype,"inRoleAdminUI",void 0),i([s.prop({type:Array,attribute:!1,default:null})],w.prototype,"blockGroupSelection",void 0),i([s.prop({type:String,attribute:!1,default:null})],w.prototype,"blockGroupSelectionTitle",void 0),i([s.prop({type:String,attribute:!1,default:null})],w.prototype,"blockGroupSelectionReason",void 0),i([s.prop({type:s.Stroolean,attribute:!1,default:!1})],w.prototype,"excludeGroupsWithHash",void 0),i([s.prop({type:s.Stroolean,attribute:!1,default:!1})],w.prototype,"disableSelection",void 0),t.CTUserList=w,w.register()},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};Object.defineProperty(t,"__esModule",{value:!0});const o=n(42),s=n(148),r=n(32);window.__CTRender=window.skate.h;const a=[s.OverridingStylesMixin,s.ComponentStylesMixin,s.RenderMixin].reduce((e,t)=>t(e),r.Component);class l extends a{renderHtml(e,t){if(void 0!==e&&null!==e||(e=""),!(-1!==e.indexOf("<")||-1!==e.indexOf(">")||-1!==e.indexOf("&lt;")||-1!==e.indexOf("&gt;")))return e;const n=`html_${t||performance.now().toString().replace(".","")}`,i=r.h("span",{id:n,class:"user-html",style:{display:"inline-block"}});return this.onRenderComplete(()=>{if(!this.shadowRoot)return;const t=this.shadowRoot.querySelector(`#${n}`);t&&(t.innerHTML=e)},!0),i}onRenderComplete(e,t=!1){this.addEventListener("render-complete",function n(){e(),t&&this.removeEventListener("render-complete",n)})}renderedCallback(){super.renderedCallback(),this.dispatchEvent(new CustomEvent("render-complete"))}forceRedraw(){this._renderTrigger=(new Date).getTime()}static register(){if(null===this.is)return void console.error("Could not register component, please ensure that it has a static is property");customElements.get(this.is)||customElements.define(this.is,this)}}l.is=null,i([o.prop({type:Number,attribute:!1,default:0})],l.prototype,"_renderTrigger",void 0),t.CTBaseComponent=l},function(e,t,n){"use strict";t.__esModule=!0,t.inherits=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=Object.create(e.prototype);for(var o in n)i[o]=n[o];return i.constructor=t,t.prototype=i,t}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});class i{}i.XmppChat="xmppchat",t.BaseMessageType=i;t.BaseBotCommand=class{};t.BaseIQ=class{},t.get=function(e){return[]};var o=n(117);t.BaseHandler=o.BaseHandler,t.BaseHandlerInterface=o.BaseHandlerInterface},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&(n[i[o]]=e[i[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0});const o=n(32),s=e=>e;t.prop=function(e){return function(t,n){const{type:r}=e,a=i(e,["type"]),l=function(e){if("function"!=typeof e)return;const t=e();return t instanceof Array?"array":"object"==typeof t?"object":typeof t}(r),c=o.prop[l]||s,d=t.constructor,h=d.props||{},u=Object.assign({},h,{[n]:c(a)});Object.defineProperty(d,"props",{configurable:!0,get:()=>u})}}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const i=n(67),o=n(24),s=n(25),r=window,a=window;let l=null;const c="attachments",d="image",h="audio",u="video",p={a:{mimeType:"application/octet-stream",mediaType:null},ai:{mimeType:"application/postscript",mediaType:null},aif:{mimeType:"audio/x-aiff",mediaType:h},aifc:{mimeType:"audio/x-aiff",mediaType:h},aiff:{mimeType:"audio/x-aiff",mediaType:h},au:{mimeType:"audio/basic",mediaType:h},avi:{mimeType:"video/x-msvideo",mediaType:null},bat:{mimeType:"text/plain",mediaType:null},bin:{mimeType:"application/octet-stream",mediaType:null},bmp:{mimeType:"image/x-ms-bmp",mediaType:d},c:{mimeType:"text/plain",mediaType:null},cdf:{mimeType:"application/x-cdf",mediaType:null},csh:{mimeType:"application/x-csh",mediaType:null},css:{mimeType:"text/css",mediaType:null},dll:{mimeType:"application/octet-stream",mediaType:null},doc:{mimeType:"application/msword",mediaType:null},docm:{mimeType:"application/vnd.ms-word.document.macroEnabled.12",mediaType:null},docx:{mimeType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",mediaType:null},dot:{mimeType:"application/msword",mediaType:null},dotx:{mimeType:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",mediaType:null},dvi:{mimeType:"application/x-dvi",mediaType:null},eml:{mimeType:"message/rfc822",mediaType:null},eps:{mimeType:"application/postscript",mediaType:null},etx:{mimeType:"text/x-setext",mediaType:null},exe:{mimeType:"application/octet-stream",mediaType:null},gif:{mimeType:"image/gif",mediaType:d},gtar:{mimeType:"application/x-gtar",mediaType:null},h:{mimeType:"text/plain",mediaType:null},hdf:{mimeType:"application/x-hdf",mediaType:null},htm:{mimeType:"text/html",mediaType:null},html:{mimeType:"text/html",mediaType:null},jpe:{mimeType:"image/jpe",mediaType:d},jpeg:{mimeType:"image/jpeg",mediaType:d},jpg:{mimeType:"image/jpeg",mediaType:d,preferred:!0},js:{mimeType:"application/javascript",mediaType:null},json:{mimeType:"application/json",mediaType:null},ksh:{mimeType:"text/plain",mediaType:null},latex:{mimeType:"application/x-latex",mediaType:null},m1v:{mimeType:"video/mpeg",mediaType:u},m4a:{mimeType:"audio/mpeg",mediaType:h,preferred:!0},man:{mimeType:"application/x-troff-man",mediaType:null},me:{mimeType:"application/x-troff-me",mediaType:null},mht:{mimeType:"message/rfc822",mediaType:null},mhtml:{mimeType:"message/rfc822",mediaType:null},mif:{mimeType:"application/x-mif",mediaType:null},mov:{mimeType:"video/quicktime",mediaType:u},movie:{mimeType:"video/x-sgi-movie",mediaType:u},mp2:{mimeType:"audio/mpeg",mediaType:h},mp3:{mimeType:"audio/mp3",mediaType:h},mp4:{mimeType:"video/mp4",mediaType:u},mpa:{mimeType:"video/mpeg",mediaType:u},mpe:{mimeType:"video/mpeg",mediaType:u},mpeg:{mimeType:"video/mpeg",mediaType:u},mpg:{mimeType:"video/mpeg",mediaType:u,preferred:!0},ms:{mimeType:"application/x-troff-ms",mediaType:null},nc:{mimeType:"application/x-netcdf",mediaType:null},nws:{mimeType:"message/rfc822",mediaType:null},o:{mimeType:"application/octet-stream",mediaType:null},obj:{mimeType:"application/octet-stream",mediaType:null},oda:{mimeType:"application/oda",mediaType:null},otf:{mimeType:"application/x-font-opentype",mediaType:null},pbm:{mimeType:"image/x-portable-bitmap",mediaType:d},pdf:{mimeType:"application/pdf",mediaType:null},pfx:{mimeType:"application/x-pkcs12",mediaType:null},pgm:{mimeType:"image/x-portable-graymap",mediaType:d},png:{mimeType:"image/png",mediaType:d},pnm:{mimeType:"image/x-portable-anymap",mediaType:d},po:{mimeType:"text/x-gettext-translation",mediaType:null},pot:{mimeType:"application/vnd.ms-powerpoint",mediaType:null},ppa:{mimeType:"application/vnd.ms-powerpoint",mediaType:null},ppm:{mimeType:"image/x-portable-pixmap",mediaType:d},pps:{mimeType:"application/vnd.ms-powerpoint",mediaType:null},ppt:{mimeType:"application/vnd.ms-powerpoint",mediaType:null},pptm:{mimeType:"application/vnd.ms-powerpoint.presentation.macroEnabled.12",mediaType:null},pptx:{mimeType:"application/vnd.openxmlformats-officedocument.presentationml.presentation",mediaType:null},ps:{mimeType:"application/postscript",mediaType:null},pwz:{mimeType:"application/vnd.ms-powerpoint",mediaType:null},py:{mimeType:"text/x-python",mediaType:null},pyc:{mimeType:"application/x-python-code",mediaType:null},pyo:{mimeType:"application/x-python-code",mediaType:null},qt:{mimeType:"video/quicktime",mediaType:u},ra:{mimeType:"audio/x-pn-realaudio",mediaType:h},ram:{mimeType:"application/x-pn-realaudio",mediaType:h},ras:{mimeType:"image/x-cmu-raster",mediaType:d},rdf:{mimeType:"application/xml",mediaType:null},rgb:{mimeType:"image/x-rgb",mediaType:d},roff:{mimeType:"application/x-troff",mediaType:null},rtx:{mimeType:"text/richtext",mediaType:null},sgm:{mimeType:"text/x-sgml",mediaType:null},sgml:{mimeType:"text/x-sgml",mediaType:null},sh:{mimeType:"application/x-sh",mediaType:null},shar:{mimeType:"application/x-shar",mediaType:null},snd:{mimeType:"audio/basic",mediaType:h},so:{mimeType:"application/octet-stream",mediaType:null},src:{mimeType:"application/x-wais-source",mediaType:null},svg:{mimeType:"image/svg+xml",mediaType:d},swf:{mimeType:"application/x-shockwave-flash",mediaType:null},t:{mimeType:"application/x-troff",mediaType:null},tar:{mimeType:"application/x-tar",mediaType:null},tcl:{mimeType:"application/x-tcl",mediaType:null},tex:{mimeType:"application/x-tex",mediaType:null},texi:{mimeType:"application/x-texinfo",mediaType:null},texinfo:{mimeType:"application/x-texinfo",mediaType:null},tif:{mimeType:"image/tiff",mediaType:d},tiff:{mimeType:"image/tiff",mediaType:d},tr:{mimeType:"application/x-troff",mediaType:null},tsv:{mimeType:"text/tab-separated-values",mediaType:null},ttf:{mimeType:"application/x-font-truetype",mediaType:null},txt:{mimeType:"text/plain",mediaType:null,preferred:!0},ustar:{mimeType:"application/x-ustar",mediaType:null},vcf:{mimeType:"text/x-vcard",mediaType:null},wav:{mimeType:"audio/x-wav",mediaType:h},woff:{mimeType:"application/font-woff",mediaType:null,preferred:!0},woff2:{mimeType:"application/font-woff",mediaType:null},wsdl:{mimeType:"application/xml",mediaType:null},xbm:{mimeType:"image/x-xbitmap",mediaType:d},xlb:{mimeType:"application/vnd.ms-excel",mediaType:null},xls:{mimeType:"application/vnd.ms-excel",mediaType:null},xlsm:{mimeType:"application/vnd.ms-excel.sheet.macroEnabled.12",mediaType:null},xlsx:{mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",mediaType:null},xml:{mimeType:"text/xml",mediaType:null},xpdl:{mimeType:"application/xml",mediaType:null},xpm:{mimeType:"image/x-xpixmap",mediaType:d},xsl:{mimeType:"application/xml",mediaType:null},xwd:{mimeType:"image/x-xwindowdump",mediaType:d},zip:{mimeType:"application/zip",mediaType:null}};function g(e){return-1!==e.indexOf(".")&&(e=e.split(".").pop().toLowerCase()),p.hasOwnProperty(e)?p[e].mimeType:null}function m(e){return-1!==e.indexOf(".")&&(e=e.split(".").pop().toLowerCase()),p.hasOwnProperty(e)?p[e].mediaType:null}function f(e){const t=Object.keys(p).filter(t=>p[t].mimeType===e)[0];return t?p[t].mediaType:null}function _(e){return e.replace(/\\/g,"/").split("/").pop()}function v(){return new i.Promise((e,t)=>{if(o.isElectron())try{const n=r.require("electron").remote.app,i=r.require("path").sep,o=n.getPath("userData")+i+c+i,s=r.require("fs");s.existsSync(o)||s.mkdirSync(o),e(o)}catch(e){t(e)}else{const n=o.getPlatformName(),i=s.getSource("file");if(!1!==i){let o="";if("ios"===n)o+=i.documentsDirectory;else{if("android"!==n)return t("Unsupported platform, expected Android or iOS.");o+=i.dataDirectory}a.resolveLocalFileSystemURL(o,function(n){n.getDirectory(c,{create:!0,exclusive:!1},function(t){e(t.nativeURL)},t)},t)}else t("No file plugin available.")}})}function y(e){return new i.Promise((t,n)=>{const i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onload=(()=>{200===i.status&&t(i.response)}),i.send()})}t.getMimeTypeFromExtension=g,t.getMediaTypeFromExtension=m,t.getMediaTypeFromMimeType=f,t.getFileNameFromPath=_,t.getStorageLocation=v,t.upload=function(e,t,n,r){return new i.Promise((i,a)=>{if(null===l&&(l=o.isElectron()?s.getSource("@commontimeltd/com.commontime.filetransfer"):s.getSource("FileTransfer")),!1!==l){const n={httpMethod:"PUT",fileName:_(e),fileKey:"file",headers:r,mimeType:g(e),chunkedMode:!1};(new l).upload(e,t,n=>{i({source:e,target:t,response:n.response})},a,n)}else console.warn("Falling back to using XHR for file uploads."),y(e).then(e=>{const o=new XMLHttpRequest;if(o.addEventListener("load",e=>{i({source:n,target:t,response:e})}),o.addEventListener("error",a),o.open("PUT",t,!0),r)for(let t in r)o.setRequestHeader(t,r[t]);o.send(e)})})},t.download=function(e,t=null,n=Date.now().toString()){return new i.Promise((i,c)=>{null===l&&(l=o.isElectron()?s.getSource("@commontimeltd/com.commontime.filetransfer"):s.getSource("FileTransfer")),!1!==l?v().then(s=>{const d=new l,h=s+n+"_"+_(e);o.isElectron()?r.require("fs").existsSync(h)&&i({source:h,target:e}):o.isDevice()&&a.resolveLocalFileSystemURL(0!==h.indexOf("file://")?`file://${h}`:h,function(t){t&&i({source:t.nativeURL,target:e})});const u=t=>{o.isElectron()?i({source:t.filePath,target:e}):o.isDevice()?i({source:t.nativeURL,target:e}):(console.warn("Attachments are not currently supported on this platform."),c())},p=t=>{console.error(`Unable to download file '${h}' from '${e}':`,t),c(t)};o.isDevice()?d.download(e,h,u,p,!1,{headers:t}):d.download(e,h,u,p,{headers:t})}).catch(c):i({source:e,target:e})})},t.getFileInfo=function(e){return new i.Promise((t,n)=>{if(o.isElectron())try{r.require("fs-plus").stat(e,(i,o)=>{i?n(i):t({name:_(e),path:e,size:o.size,type:g(e),mediaType:m(e)})})}catch(e){n("Couldn't require 'fs-plus' module.")}else if(o.isDevice()){const i=0!==e.indexOf("file://")?`file://${e}`:e;a.resolveLocalFileSystemURL(i,function(n){n.file(function(n){const o=n.type?n.type:g(e);t({name:n.name,path:i,size:n.size,type:o,mediaType:m(e)})})},n)}else y(e).then(n=>{t({name:e.split("/").pop(),path:e,size:n.size,type:n.type,mediaType:f(n.type)})})})},t.deleteFile=function(e){return new i.Promise((t,n)=>{if(o.isElectron())try{const i=r.require("fs-plus");i.existsSync(e)?(i.unlinkSync(e),t()):n(`File '${e}' doesn't exist and cannot be deleted.`)}catch(t){n(`Something went wrong while trying to delete the file '${e}': ${t}`)}else o.isDevice()?a.resolveLocalFileSystemURL(e,i=>{i.isDirectory?n(`File path '${e}' is a directory and cannot be deleted.`):i.remove(t,n)},e=>{n(e)}):t()})},t.urlToBlob=y,t.blobToObjectUrl=function(e){return new i.Promise(t=>{t(URL.createObjectURL(e))})},t.deleteAttachments=function(){return new i.Promise((e,t)=>{if(o.isElectron()){const n=r.require("path"),i=r.require("fs"),o=r.require("electron").remote.app.getPath("userData"),s=n.sep,a=o+s+c+s;if(!i.existsSync(a))return e();i.readdir(a,(o,s)=>{if(o)return t(o);for(const e of s)i.lstatSync(n.join(a,e)).isFile()&&i.unlinkSync(n.join(a,e));e()})}else if(o.isDevice()){const n=o.getPlatformName(),i=s.getSource("file");if(!1!==i){let o=null;"ios"===n?o=i.documentsDirectory:"android"===n&&(o=i.dataDirectory),null!==o?a.resolveLocalFileSystemURL(o,n=>{n.getDirectory(c,{create:!1,exclusive:!1},function(n){n.removeRecursively(e,t)},function(n){1===n.code?e():(console.error(`Couldn't get '${c}' to delete:`,n),t(n))})},function(e){t(e)}):t("Unsupported platform, expected Android or iOS.")}else t("No file plugin available.")}else e()})},t.pickFile=function(e){return new i.Promise((t,n)=>{let l=[],d=["*"],h="All Files";if(void 0!==e.mediaType?(d=Object.keys(p).filter(t=>p[t].mediaType===e.mediaType),l=d.map(e=>p[e].mimeType),h=e.mediaType):void 0!==e.mimeTypes&&(l=e.mimeTypes,d=Object.keys(p).filter(e=>l.indexOf(p[e].mimeType)>=0)),o.isElectron())r.require("electron").remote.dialog.showOpenDialog({properties:["openFile","multiSelections"],filters:[{name:h,extensions:d}]},e=>{const o=r.require("path"),s=r.require("fs"),a=r.require("electron").remote.app.getPath("userData"),l=o.sep,d=a+l+c+l;s.existsSync(d)||s.mkdirSync(d);const h=[];e.forEach(e=>{h.push(new i.Promise((t,n)=>{const i=o.join(d,Date.now()+"_"+o.basename(e)),r=t=>{console.error(`A problem occurred when trying to copy the file '${e}' to '${i}'.`,t),n(t)},a=s.createReadStream(e);a.on("error",r);const l=s.createWriteStream(i);l.on("error",r),l.on("close",()=>{t(i)}),a.pipe(l)}))}),i.Promise.all(h).then(t).catch(n)});else if(o.isDevice()){const i=o.getPlatformName(),r=s.getSource("file");if(!1!==r){let o=null;"ios"===i?o=r.documentsDirectory:"android"===i&&(o=r.dataDirectory),null!==o?a.resolveLocalFileSystemURL(o,i=>{i.getDirectory(c,{create:!0,exclusive:!1},i=>{const o=s.getSource("fileimporter");null!==o?o.importFile(i=>{if(e.encrypt){const e=s.getSource("fileEncryption");e||t([i]),e.encrypt(e=>{t([e])},e=>{n(`Could not encrypt image. ${e}`)},0!==i.indexOf("file://")?`file://${i}`:i)}else t([i])},n,void 0,l,c):n("File importer plugin not available.")},n)},n):n("Unsupported platform, expected Android or iOS.")}else n("No file plugin available.")}else{const e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("multiple","multiple"),e.addEventListener("change",()=>{const n=[];for(let t=0;t<e.files.length;t++)n.push(URL.createObjectURL(e.files[t]));t(n)}),e.click()}})},t.getFileSize=function(e){return new i.Promise((t,n)=>{if(e&&-1!==e.name.indexOf(".encrypted")){const i=s.getSource("fileEncryption");i?i.getFileSize(e=>{try{t(parseInt(e))}catch(e){console.error("Couldn't convert file size to an integer."),n(e)}},n,e.path):t(e.size)}else t(e.size)})},t.saveFileToDisk=function(t,n){return new i.Promise((i,o)=>{const s=r.require("path"),a=r.require("fs"),l=r.require("electron").remote.app.getPath("userData"),d=s.sep,h=l+d+c+d;a.existsSync(h)||a.mkdirSync(h);const u=s.join(h,Date.now()+"_"+s.basename(n)),p=e=>{console.error(`A problem occurred when trying to copy the file to '${u}'.`,e),o(e)},g=new FileReader;g.readAsArrayBuffer(t),g.onerror=p,g.onload=(()=>{try{a.writeFileSync(u,e(new Uint8Array(g.result))),i(u)}catch(e){p(e)}})})}}).call(this,n(68).Buffer)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(25),o=n(68),s=n(24);function r(e,t){return new Promise((n,i)=>{const o=window.require("electron").ipcRenderer;o.once(e,function(t,o){"keytar-set"===o.action&&o.code===e&&(o.data&&o.data.error?i(o.data.error):n())}),o.send("KEY_CLIENT",{action:"keytar-set",code:e,data:{service:null,account:e,key:t}})})}function a(){let e,t=[];if(window.crypto&&window.crypto.getRandomValues){var n=new Uint8Array(32);for(window.crypto.getRandomValues(n),e=0;e<32;e++)t[e]=n[e]}else for(let i=0;i<32;i++)t[i]=Math.floor(256*Math.random());return t}t.isNumber=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},t.generateGuid=function(){let e=Date.now();return window.performance&&"function"==typeof window.performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})},t.getEncryptionKey=function(e){return new Promise((t,n)=>{const l=i.getSource("securesettings");if(!1!==l)l.getOrCreateCryptographicKey(function(e){const n=o.Buffer.from(function(e){let t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t}(e));t(n)},n,e,256);else if(s.isElectron())(function(e){return new Promise((t,n)=>{const i=localStorage.getItem(e);if(i)return r(e,i).then(()=>(localStorage.removeItem(e),t(i)));const o=window.require("electron").ipcRenderer;o.once(e,function(n,i){"keytar-get"===i.action&&i.code===e&&(i&&i.data&&!i.data.error?t(i.data):t(null))}),o.send("KEY_CLIENT",{action:"keytar-get",code:e,data:{service:null,account:e}})})})(`${e}_key`).then(n=>{if(null!==n){const e=o.Buffer.from(JSON.parse(n));t(e)}else{let n=a();r(`${e}_key`,JSON.stringify(n)).then(()=>{const e=o.Buffer.from(n);t(e)})}});else{console.warn("Oh no!  Your databases are encrypted but the key couldn't be secured because this platform doesn't support secure settings.");const n=localStorage.getItem(`${e}_key`);if(null!==n){const e=o.Buffer.from(JSON.parse(n));t(e)}else{let n=a();localStorage.setItem(`${e}_key`,JSON.stringify(n));const i=o.Buffer.from(n);t(i)}}})};let l=!1;document.addEventListener("pause",()=>l=!0,!1),document.addEventListener("resume",()=>l=!1,!1),t.isInBackground=function(){return!0===l},t.minifyJson=function(e){const t=JSON.parse(e);return JSON.stringify(t,null,0)}},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(15),a=n(6),l=n(8),c=n(13);var d;!function(e){e[e.CANCEL="Cancel"]="CANCEL"}(d||(d={}));let h=class extends s.CTLayerComponent{constructor(){super(...arguments),this._toggle=((e="",t=[])=>{this.buttons=t,"string"!=typeof e||this.open||(this.heading=e),this.open=!this.open,this.open&&this.onOpen&&this.onOpen(),this.open||setTimeout(()=>{this.heading=""},250)}),this._action=(e=>{this._toggle(this.title,this.buttons),e&&e()}),this._renderActionSheetButton=((e,t=!1)=>window.__CTRender(l.CTButton,{type:"action-sheet",class:"button",disabled:e.disabled,onClick:()=>this._action(e.action)},window.__CTRender("p",{class:`${e.subtitleText?"hasSubtitle":""}`},e.primaryText),e.subtitleText&&window.__CTRender("span",{class:"subtitle"},e.subtitleText)))}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){this.addListener(a.ChatEvents.ActionSheetToggle,e=>{if(e.id){if(e.id===this.id)return void this._toggle(e.title,e.buttons)}else this._toggle(e.title,e.buttons)})}generateComponentMarkup(){return this.buttons&&this.buttons.length?1===this.buttons.length&&this.openSheetButtonText?window.__CTRender("div",{class:"container"},window.__CTRender(l.CTButton,{type:`${this.openSheetBackgroundColor?"none":"primary"}`,textColor:this.openSheetBackgroundColor?c.decideTextColorFromBgColor(this.openSheetBackgroundColor):null,style:c.buildStyles({backgroundColor:this.openSheetBackgroundColor}),class:"button",disabled:this.buttons[0].disabled,onClick:()=>this._action(this.buttons[0].action)},this.buttons[0].primaryText)):window.__CTRender("div",{class:"container"},this.openSheetButtonText&&window.__CTRender(l.CTButton,{type:`${this.openSheetBackgroundColor?"none":"primary"}`,textColor:this.openSheetBackgroundColor?c.decideTextColorFromBgColor(this.openSheetBackgroundColor):null,style:c.buildStyles({backgroundColor:this.openSheetBackgroundColor}),class:"button",onClick:()=>this._toggle(this.title,this.buttons)},this.openSheetButtonText),window.__CTRender("div",{class:`sheet-bg ${this.open?"":"hidden"}`},window.__CTRender("div",{class:"sheet-buttons"},window.__CTRender("div",{class:`inner-sheet-buttons ${this.open?"":"hidden"}`},window.__CTRender("div",{class:"inner-buttons"},this.heading&&window.__CTRender("div",{class:"title"},window.__CTRender("p",null,this.heading)),this.buttons.filter(e=>!0!==e.exclude).map(e=>this._renderActionSheetButton(e))),window.__CTRender("div",{class:"close"},window.__CTRender(l.CTButton,{type:"action-sheet",class:"button",onClick:()=>this._toggle(this.title,this.buttons)},this.translateI18nItem(d.CANCEL))))))):null}};i([s.prop({type:Boolean,attribute:!1,default:!1})],h.prototype,"open",void 0),i([s.prop({type:Function,attribute:!1,default:!1})],h.prototype,"onOpen",void 0),i([s.prop({type:String,attribute:!1,default:""})],h.prototype,"heading",void 0),i([s.prop({type:Array,attribute:!1,default:[{text:"Sample"}]})],h.prototype,"buttons",void 0),i([s.prop({type:String,attribute:!1,default:""})],h.prototype,"openSheetButtonText",void 0),i([s.prop({type:String,attribute:!1,default:""})],h.prototype,"openSheetBackgroundColor",void 0),h=i([r.component({tag:"ct-action-sheet",styles:[n(248)],i18nKeys:d})],h),t.CTActionSheet=h},function(e,t,n){"use strict";t.__esModule=!0,t.AMPERSAND=t.CLOSEPAREN=t.CLOSEANGLEBRACKET=t.CLOSEBRACKET=t.CLOSEBRACE=t.OPENPAREN=t.OPENANGLEBRACKET=t.OPENBRACKET=t.OPENBRACE=t.WS=t.TLD=t.SYM=t.UNDERSCORE=t.SLASH=t.MAILTO=t.PROTOCOL=t.QUERY=t.POUND=t.PLUS=t.NUM=t.NL=t.LOCALHOST=t.PUNCTUATION=t.DOT=t.COLON=t.AT=t.DOMAIN=t.Base=void 0;var i=n(82),o=n(39),s=(0,i.createTokenClass)();function r(e){var t=e?{v:e}:{};return(0,o.inherits)(s,(0,i.createTokenClass)(),t)}s.prototype={toString:function(){return this.v+""}};var a=r(),l=r("@"),c=r(":"),d=r("."),h=r(),u=r(),p=r("\n"),g=r(),m=r("+"),f=r("#"),_=r(),v=r("mailto:"),y=r("?"),C=r("/"),w=r("_"),b=r(),E=r(),T=r(),R=r("{"),I=r("["),A=r("<"),S=r("("),x=r("}"),O=r("]"),M=r(">"),L=r(")"),N=r("&");t.Base=s,t.DOMAIN=a,t.AT=l,t.COLON=c,t.DOT=d,t.PUNCTUATION=h,t.LOCALHOST=u,t.NL=p,t.NUM=g,t.PLUS=m,t.POUND=f,t.QUERY=y,t.PROTOCOL=_,t.MAILTO=v,t.SLASH=C,t.UNDERSCORE=w,t.SYM=b,t.TLD=E,t.WS=T,t.OPENBRACE=R,t.OPENBRACKET=I,t.OPENANGLEBRACKET=A,t.OPENPAREN=S,t.CLOSEBRACE=x,t.CLOSEBRACKET=O,t.CLOSEANGLEBRACKET=M,t.CLOSEPAREN=L,t.AMPERSAND=N},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(15),a=n(0),l=n(8),c=n(5);let d=class extends s.CTLayerComponent{constructor(){super(...arguments),this._delay=200,this._onSelectChange=(e=>{const t=e.currentTarget.value;this._selectValue=t,t!==this.defaultSelectionValue?this.highlightSelection=!0:this.highlightSelection=!1,this.onSearch&&this.onSearch(t,this._input.value)}),this._onSearch=(e=>{const t=e.currentTarget.value;0===t.length?(this.cancelDebounce("search"),this.showClear=!1,this._textValue="",this.onSearch&&this.onSearch(this._selectValue,"")):(this.showClear=!0,this.debounce("search",()=>{this.onSearch(this._selectValue,t,this._input)},500))}),this._clear=(()=>{this._input.value="",this._textValue="",this.showClear=!1,this.onSearch&&this.onSearch(this._selectValue,"")})}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){this._selectValue=this.defaultSelectionValue}clear(){this._clear()}focusInput(){this._input&&this._input.focus()}generateComponentMarkup(){return window.__CTRender("div",{class:"container"},this.enableSelection&&window.__CTRender("div",{class:`select ${this.highlightSelection?"highlight":""}`},window.__CTRender("select",{onChange:this._onSelectChange,ref:e=>this._select=e},window.__CTRender("option",null,this.defaultSelectionValue),this.selectionItems.map(e=>window.__CTRender("option",null,e))),window.__CTRender(l.CTIcon,{class:"select-icon",width:"12",height:"12",color:this.highlightSelection?c.getCSSVariable("--header-text"):"auto",icon:a.Icons.COMMON.ChevronDown})),window.__CTRender("input",{type:"text",placeholder:this.placeholder,oninput:this._onSearch,ref:e=>this._input=e}),this.showClear&&window.__CTRender(l.CTIcon,{class:"clear",width:"12",height:"12",icon:a.Icons.COMMON.CircleCross,onClick:this._clear}))}};i([s.prop({type:Boolean,attribute:!1,default:!0})],d.prototype,"enableSelection",void 0),i([s.prop({type:String,attribute:!1,default:"All"})],d.prototype,"defaultSelectionValue",void 0),i([s.prop({type:Array,attribute:!1,default:[]})],d.prototype,"selectionItems",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],d.prototype,"highlightSelection",void 0),i([s.prop({type:String,attribute:!1,default:""})],d.prototype,"placeholder",void 0),i([s.prop({type:Function,attribute:!1,defaul:null})],d.prototype,"onSearch",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],d.prototype,"showClear",void 0),d=i([r.component({tag:"ct-selection-text-filter",styles:[n(283)]})],d),t.CTSelectionTextFilter=d},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(8),a=n(13),l=n(0);class c extends s.CTLayerComponent{static get is(){return"ct-group-avatar"}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return n(310)}generateComponentMarkup(){const e=a.buildStyles({width:`${this.size}px`,height:`${this.size}px`}),t=Math.floor(this.size/2);return window.__CTRender("div",{class:"bg",style:e},window.__CTRender(r.CTIcon,{icon:l.Icons.COMMON.Group,width:t,height:t}))}}i([s.prop({type:Number,attribute:!1,default:40})],c.prototype,"size",void 0),t.CTGroupAvatar=c,c.register()},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(8),a=n(17),l=n(48);var c;!function(e){e[e.MEMBERS="Members: "]="MEMBERS"}(c||(c={}));class d{static _create(){return new a.Metadata(h,c)}static get instance(){return this._instance||(this._instance=this._create())}}d._instance=null,t.CTGroupTileMetadata=d;class h extends s.CTLayerComponent{constructor(){super(),this.setMetadata(d.instance)}static get is(){return"ct-group-tile"}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return n(312)}_onAvatarClick(e){"function"==typeof this.avatarClickedCallback&&this.avatarClickedCallback(e)}generateComponentMarkup(){if(this.group)return window.__CTRender(r.CTAvatarTile,{height:this.height,showAvatar:!1,detailStyle:this.detailStyle,avatarStyle:this.avatarStyle},this.showIcon&&window.__CTRender(l.CTGroupAvatar,{slot:"avatar",size:40,onClick:this._onAvatarClick.bind(this)}),window.__CTRender("div",{class:"name"},this.group.name),!this.hideMemberCount&&window.__CTRender("div",{class:"count"},this.translateI18nItem(c.MEMBERS),this.group.users.length),window.__CTRender("slot",{name:"additional"}))}}i([s.prop({type:s.Stroolean,attribute:!1,default:!0})],h.prototype,"showIcon",void 0),i([s.prop({type:Object,attribute:!1})],h.prototype,"group",void 0),i([s.prop({type:String,attribute:!1,default:null})],h.prototype,"height",void 0),i([s.prop({type:Object,attribute:!1,default:{}})],h.prototype,"detailStyle",void 0),i([s.prop({type:Object,attribute:!1,default:{}})],h.prototype,"avatarStyle",void 0),i([s.prop({type:Function,attribute:!1,default:!1})],h.prototype,"avatarClickedCallback",void 0),i([s.prop({type:s.Stroolean,attribute:!1,default:!1})],h.prototype,"hideMemberCount",void 0),t.CTGroupTile=h,h.register()},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(15),a=n(12),l=n(51),c=n(52),d=n(6),h=n(11),u=n(8),p=n(30),g=n(5),m=n(0);var f,_;!function(e){e[e.LOADING="loading"]="LOADING",e[e.IMAGE_FILE="image-file"]="IMAGE_FILE",e[e.AUDIO_FILE="audio-file"]="AUDIO_FILE",e[e.VIDEO_FILE="video-file"]="VIDEO_FILE",e[e.ERROR="error"]="ERROR"}(f||(f={})),function(e){e[e.ERROR_DEFAULT="There was an error loading the attachment."]="ERROR_DEFAULT",e[e.ERROR_NO_URI="No attachment URI provided"]="ERROR_NO_URI",e[e.ERROR_FAILED_DOWNLOAD="Attachment failed to download."]="ERROR_FAILED_DOWNLOAD",e[e.ERROR_CANNOT_LOAD_AUDIO="Unable to load audio file."]="ERROR_CANNOT_LOAD_AUDIO",e[e.ERROR_UNSUPPORTED_ATTACHMENT="Unsupported attachment type."]="ERROR_UNSUPPORTED_ATTACHMENT",e[e.ERROR_TAP_TO_RETRY="Tap to retry."]="ERROR_TAP_TO_RETRY"}(_||(_={}));let v=class extends a.CTCLComponent{constructor(){super(...arguments),this._allowRetry=!0,this._options={},this._defaultOptions={height:150,width:150,quality:100},this._processRemoteAttachment=(()=>o(this,void 0,void 0,function*(){try{this.state=f.LOADING;const e=this.type===h.SupportedAttachmentType.VIDEO,t=yield this.layer.downloadFileWithoutCatch(this.uri,e,this.conversationId);this._processAttachmentAfterDownload(t)}catch(e){this.emitEvent(d.ChatEvents.AttachmentDownloadFailed),this._errorMessage=this.translateI18nItem(_.ERROR_FAILED_DOWNLOAD),this._allowRetry=!0,this.state=f.ERROR}})),this._openImageFullScreen=(()=>o(this,void 0,void 0,function*(){!g.isDesktop()&&this.allowOpenImageInFullScreen&&(yield this.layer.showMediaFullscreen(this._fullImgFilepath))}))}initialize(){return o(this,void 0,void 0,function*(){this._options=Object.assign({},this._options,this._defaultOptions),this.uri&&this.uri.includes("http")?this._processRemoteAttachment():this.uri?this._processAttachmentAfterDownload(this.uri,!0):(this._errorMessage=this.translateI18nItem(_.ERROR_NO_URI),this._allowRetry=!1,this.state=f.ERROR)})}setupListeners(){}_processAttachmentAfterDownload(e,t=!1){return o(this,void 0,void 0,function*(){switch(t||this.emitEvent(d.ChatEvents.AttachmentDownloadComplete,new d.AttachmentDownloadComplete(e,this.conversationId,this.type)),this.type){case h.SupportedAttachmentType.AUDIO:setTimeout(()=>{this.file=e,this.state=f.AUDIO_FILE,t||(this.emitEvent(d.ChatEvents.AudioAttachmentDownloadComplete,new d.AudioAttachmentDownloadComplete(this.file)),this.downloadCompletedCallback&&this.downloadCompletedCallback(new d.AudioAttachmentDownloadComplete(this.file)))},1e3);break;case h.SupportedAttachmentType.IMAGE:this.uri.includes("data:image")?this.file=this.uri:this.file=yield p.getThumbnail(e,this._options.width,this._options.height,this._options.quality),this._fullImgFilepath=e,this.state=f.IMAGE_FILE;break;case h.SupportedAttachmentType.VIDEO:this.file=e,this.state=f.VIDEO_FILE;break;default:throw new Error(this.translateI18nItem(_.ERROR_UNSUPPORTED_ATTACHMENT))}})}generateComponentMarkup(){let e;switch(this.state){case f.AUDIO_FILE:e=this._renderAudio();break;case f.IMAGE_FILE:e=this._renderImage();break;case f.VIDEO_FILE:e=this._renderVideo();break;case f.ERROR:e=this._renderError();break;case f.LOADING:default:e=this._renderLoading()}return window.__CTRender("div",{class:`container ${this.isThumbnail?"container--isThumbnail":""}`},e)}_renderLoading(){return window.__CTRender(u.CTIcon,{width:"16",height:"16",icon:m.Icons.COMMON.LoadingSpinner,spin:!0})}_renderError(){return window.__CTRender("div",{class:"error",onClick:this._allowRetry?this._processRemoteAttachment:null},window.__CTRender(u.CTIcon,{width:"16",height:"16",icon:m.Icons.COMMON.AlertWarning}),window.__CTRender("p",null,this._errorMessage||this.translateI18nItem(_.ERROR_DEFAULT),this._allowRetry&&` ${this.translateI18nItem(_.ERROR_TAP_TO_RETRY)}`))}_renderImage(){return window.__CTRender("img",{class:"attached-image",src:this.file,onClick:this._openImageFullScreen})}_renderAudio(){return window.__CTRender(l.CTCLAudioRecorderPlayer,{showRecord:!1,source:this.file,stream:this.stream,volumeToPlayAt:this.volumeToPlayAt,disablePlay:this.disablePlay,preventRemoteStart:this.preventRemoteStart})}_renderVideo(){return window.__CTRender(c.CTCLVideoRecorderPlayer,{source:this.file,showRecord:!1,allowRemoval:!1,showControls:!0})}};i([s.prop({type:String,attribute:!1,default:""})],v.prototype,"uri",void 0),i([s.prop({type:String,attribute:!1,default:""})],v.prototype,"type",void 0),i([s.prop({type:String,attribute:!1,default:""})],v.prototype,"file",void 0),i([s.prop({type:String,attribute:!1,default:f.LOADING})],v.prototype,"state",void 0),i([s.prop({type:Boolean,attribute:!1,default:!0})],v.prototype,"allowOpenImageInFullScreen",void 0),i([s.prop({type:String,attribute:!1,default:""})],v.prototype,"conversationId",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],v.prototype,"disablePlay",void 0),i([s.prop({type:String,attribute:!1,default:h.VolumeStream.Music})],v.prototype,"stream",void 0),i([s.prop({type:Number,attribute:!1,default:-1})],v.prototype,"volumeToPlayAt",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],v.prototype,"preventRemoteStart",void 0),i([s.prop({type:Function,attribute:!1,default:!1})],v.prototype,"downloadCompletedCallback",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],v.prototype,"isThumbnail",void 0),v=i([r.component({tag:"ctcl-attachment-handler",styles:[n(327)],i18nKeys:_})],v),t.CTCLAttachmentHandler=v},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(15),a=n(0),l=n(12),c=n(6),d=n(79),h=n(320),u=n(11),p=n(8),g=n(20),m=n(13),f=n(321);var _;!function(e){e[e.NO_RECORDING_SOURCE="No microphone has been detected on your system."]="NO_RECORDING_SOURCE",e[e.GENERAL_ERROR="There was an error trying to record audio."]="GENERAL_ERROR"}(_||(_={}));let v=class extends l.CTCLComponent{constructor(){super(...arguments),this._player=new d.SimpleAudioPlayer(e=>this._statusCallback(e)),this._recorder=new h.SimpleAudioRecorder(e=>this._onRecordingFinished(e),e=>this._onRecordingError(e)),this._currentlyRecording=!1,this._removeAudio=(()=>o(this,void 0,void 0,function*(){this.source="",this.currentTime=0,this.duration=0,this.onAudioRemoved&&this.onAudioRemoved()})),this._play=((e=200,t=!1)=>this._buffer(()=>{this.emitEvent(c.ChatEvents.MuteAlertToPlayOtherAudio,new f.AttachmentInteractionEventArgs("play",t)),this._timer||(this._timer=setInterval(()=>this.currentTime+=200,200)),setTimeout(()=>{this.disablePlay=!1,this._player.play()},e)})),this._userInitiatedPlay=(()=>{this._play(0,!0)}),this._pause=((e=!1)=>this._buffer(()=>{this.disablePlay=!1,clearInterval(this._timer),delete this._timer,this._player.pause(),this.emitEvent(c.ChatEvents.ResumeAlertAfterPlayingAudio,new f.AttachmentInteractionEventArgs("pause",e))})),this._userInitiatedPause=(()=>{this._pause(!0)}),this._stop=(()=>this._buffer(()=>{clearInterval(this._timer),delete this._timer,this._player.stop(!0),this.currentTime=0,this.emitEvent(c.ChatEvents.ResumeAlertAfterPlayingAudio,new f.AttachmentInteractionEventArgs("stopped",!1))})),this._startRecording=(()=>this._buffer(()=>{this._currentlyRecording?(this._currentlyRecording=!1,this._recorder.stop(),this.emitEvent(c.ChatEvents.AudioRecordingStopped),this._stopRecordingIndicator()):(this._startRecordingIndicator(),this.emitEvent(c.ChatEvents.AudioRecordingStarted),this._currentlyRecording=!0,this._recorder.start())})),this._onRecordingFinished=(e=>{e?(this.source=e,this.initPlayer(this.source),this.onRecordingFinished&&this.onRecordingFinished(this.source)):this.source=""}),this._onRecordingError=(e=>{this._stopRecordingIndicator();let t=_.GENERAL_ERROR;switch(e){case h.AudioRecorderError.NoAudioDevicesFound:t=_.NO_RECORDING_SOURCE}const n=new a.DefaultAlerts(this).AlertErrorWithOkayButton(this.translateI18nItem(g.CommonMetadata.getI18nItem(g.CommonI18nKeys.ERROR)),this.translateI18nItem(t),1,{okay:()=>{}});this.emitEvent(c.ChatEvents._Request_RaiseAlert,n)}),this._startRecordingIndicator=(()=>{let e=!0;this._recordBtn&&(setTimeout(()=>this._recordBtn.classList.add("flash"),100),this._flashTimer=setInterval(()=>{e?this._recordBtn.classList.remove("flash"):this._recordBtn.classList.add("flash"),e=!e},500))}),this._stopRecordingIndicator=(()=>{clearInterval(this._flashTimer),this._recordBtn&&this._recordBtn.classList.remove("flash")})}initialize(){return o(this,void 0,void 0,function*(){this.source&&this.initPlayer(this.source)})}setupListeners(){!1===this.preventRemoteStart&&(this.addListener(c.ChatEvents.RemotelyStartAudioPlayer,()=>{this._play(1e3)}),this.addEventListener(c.ChatEvents.RemotelyStopAudioPlayer,()=>{this._stop()}))}_buffer(e,t=200){(!this._bufferTime||(new Date).valueOf()>this._bufferTime+t)&&(this._bufferTime=(new Date).valueOf(),e())}initPlayer(e){this._player.setAudio(e,1,this.volumeToPlayAt,this.stream,e=>this.duration=e,()=>this.isReady=!0)}_statusCallback(e){this.mediaStatus=e,this.mediaStatus===d.MediaStatus.MEDIA_STOPPED&&(this.disablePlay=!1,clearInterval(this._timer),delete this._timer,this.currentTime=0,this.emitEvent(c.ChatEvents.ResumeAlertAfterPlayingAudio,new f.AttachmentInteractionEventArgs("ended",!1)))}_millisToMinutesAndSeconds(e){if(0===e)return"0:00";const t=Math.floor(e/6e4),n=Math.round(e%6e4/1e3);return`${t}:${n<10?"0":""}${n}`}disconnectedCallback(){super.disconnectedCallback(),this._player.stop(!0),this._player.release()}generateComponentMarkup(){const e=!this.source,t=!this._currentlyRecording&&!this.disablePlay&&(!(!this.showRecord||!this.source)||!!this.source),n=!this._currentlyRecording&&(t&&(this.mediaStatus===d.MediaStatus.MEDIA_RUNNING||this.mediaStatus===d.MediaStatus.MEDIA_PAUSED)),i=this.allowRemoval&&this.source&&this.mediaStatus!==d.MediaStatus.MEDIA_RUNNING;return window.__CTRender("div",{class:"container"},window.__CTRender("div",{class:"controls"},this.showRecord&&window.__CTRender("div",{class:`action ${e?"":"disabled"}`,ref:e=>this._recordBtn=e},window.__CTRender(p.CTIcon,{color:"red",width:"16",height:"16",icon:u.Icons.UI.CircleFilled,onClick:this._startRecording})),window.__CTRender("div",{class:`action ${t?"":"disabled"}`},this.mediaStatus===d.MediaStatus.MEDIA_RUNNING?window.__CTRender(p.CTIcon,{width:"16",height:"16",icon:u.Icons.UI.Pause,onClick:t?this._userInitiatedPause:null}):window.__CTRender(p.CTIcon,{width:"16",height:"16",icon:u.Icons.UI.Play,onClick:t?this._userInitiatedPlay:null})),window.__CTRender("div",{class:`action ${n?"":"disabled"}`},window.__CTRender(p.CTIcon,{width:"16",height:"16",icon:u.Icons.UI.SquareFilled,onClick:n?this._stop:null})),this.allowRemoval&&this.source&&window.__CTRender("div",{class:`action ${i?"":"disabled"}`},window.__CTRender(p.CTIcon,{width:"16",height:"16",icon:u.Icons.UI.Cross,onClick:i?this._removeAudio:null}))),this.source&&window.__CTRender("div",{class:"progress"},window.__CTRender("div",{class:"length left"},window.__CTRender("span",null,this._millisToMinutesAndSeconds(this.currentTime))),window.__CTRender("div",{class:"bar"},window.__CTRender("span",{style:m.buildStyles({width:`${this.currentTime/this.duration*100}%`})})),window.__CTRender("div",{class:"length right"},window.__CTRender("span",null,this._millisToMinutesAndSeconds(this.duration)))))}};i([s.prop({type:Boolean,attribute:!1,default:!1})],v.prototype,"showRecord",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],v.prototype,"allowRemoval",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],v.prototype,"disablePlay",void 0),i([s.prop({type:String,attribute:!1,default:""})],v.prototype,"source",void 0),i([s.prop({type:Number,attribute:!1,default:0})],v.prototype,"mediaStatus",void 0),i([s.prop({type:Number,attribute:!1,default:0})],v.prototype,"currentTime",void 0),i([s.prop({type:Number,attribute:!1,default:0})],v.prototype,"duration",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],v.prototype,"isReady",void 0),i([s.prop({type:String,attribute:!1,default:u.VolumeStream.Music})],v.prototype,"stream",void 0),i([s.prop({type:Number,attribute:!1,default:-1})],v.prototype,"volumeToPlayAt",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],v.prototype,"preventRemoteStart",void 0),i([s.prop({type:Function,attribute:!1,default:null})],v.prototype,"onAudioRemoved",void 0),i([s.prop({type:Function,attribute:!1,default:null})],v.prototype,"onRecordingFinished",void 0),v=i([r.component({tag:"ctcl-audio-recorder-player",styles:[n(322)],i18nKeys:_})],v),t.CTCLAudioRecorderPlayer=v},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(15),a=n(12),l=n(6),c=n(324),d=n(11),h=n(8);let u=class extends a.CTCLComponent{constructor(){super(...arguments),this._initVideoElm=(e=>{this._videoElm=e,this._videoElm.onplay=this._onPlay,this._videoElm.onpause=this._onEndOrPause,this._videoElm.onended=this._onEndOrPause}),this._onPlay=(()=>{this.emitEvent(l.ChatEvents.MuteAlertToPlayOtherAudio)}),this._onEndOrPause=(()=>{this.emitEvent(l.ChatEvents.ResumeAlertAfterPlayingAudio)}),this._startRecording=(()=>{this.recording?(this.recording=!1,this._recorder.stop(),this._stopRecordingIndicator()):(this.recording=!0,this.showControls=!1,this._startRecordingIndicator(),this._recorder=new c.SimpleVideoRecorder(this._videoElm,this._onVideoRecordingFinished),this._recorder.start())}),this._onVideoRecordingFinished=(e=>{this.showControls=!0,this.source=e,this._videoElm.src=e,this._videoElm.muted=!1,this.onRecordingFinished&&this.onRecordingFinished(e)}),this._remove=(()=>{this.source="",this._videoElm.src="",this.showControls=!1,this.onVideoRemoved&&this.onVideoRemoved()}),this._startRecordingIndicator=(()=>{let e=!0;this._recordBtn&&(setTimeout(()=>this._recordBtn.classList.add("flash"),100),this._flashTimer=setInterval(()=>{e?this._recordBtn.classList.remove("flash"):this._recordBtn.classList.add("flash"),e=!e},500))}),this._stopRecordingIndicator=(()=>{clearInterval(this._flashTimer),this._recordBtn&&this._recordBtn.classList.remove("flash")})}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){}disconnectedCallback(){super.disconnectedCallback(),this._videoElm.pause()}generateComponentMarkup(){const e=this.showRecord,t=this.allowRemoval&&""!==this.source;return window.__CTRender("div",{class:"container"},window.__CTRender("div",{class:"controls"},this.showRecord&&window.__CTRender("div",{class:`action ${e?"":"disabled"}`,ref:e=>this._recordBtn=e},window.__CTRender(h.CTIcon,{color:"red",width:"16",height:"16",icon:d.Icons.UI.CircleFilled,onClick:this._startRecording})),this.allowRemoval&&window.__CTRender("div",{class:`action ${t?"":"disabled"}`},window.__CTRender(h.CTIcon,{width:"16",height:"16",icon:d.Icons.UI.Cross,onClick:t?this._remove:null}))),window.__CTRender("div",{class:"player"},window.__CTRender("video",{ref:this._initVideoElm,width:320,height:240,controls:this.showControls,autoplay:this.autoplay,src:this.source})))}};i([s.prop({type:Boolean,attribute:!1,default:!0})],u.prototype,"showRecord",void 0),i([s.prop({type:Boolean,attribute:!1,default:!0})],u.prototype,"allowRemoval",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],u.prototype,"recording",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],u.prototype,"showControls",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],u.prototype,"autoplay",void 0),i([s.prop({type:String,attribute:!1,default:""})],u.prototype,"source",void 0),i([s.prop({type:Function,attribute:!1,default:null})],u.prototype,"onVideoRemoved",void 0),i([s.prop({type:Function,attribute:!1,default:null})],u.prototype,"onRecordingFinished",void 0),u=i([r.component({tag:"ctcl-video-recorder-player",styles:[n(325)]})],u),t.CTCLVideoRecorderPlayer=u},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(15),a=n(0),l=n(12),c=n(21),d=n(35),h=n(8),u=n(13),p=n(5),g=n(54),m=n(7),f=n(16);let _=class extends l.CTCLComponent{constructor(){super(...arguments),this._renderUserLine=(e=>{const t=this._userLookup.get(e.jid),n=p.getTwentyFourHoursTime(this.conversation.createdTime),i=this.conversation.receivedList.find(t=>t.jid===e.jid),o=this.conversation.acknowledgements.find(t=>t.jid===e.jid),s=f.isExpiredConversation(this.conversation);let r="#aaa";if(o){const e=this._config.alertResponseOptionTemplates.find(e=>e.value===o.value);r=e&&e.color||"#aaa"}return window.__CTRender("div",{class:"user-row"},window.__CTRender("div",{class:"user"},window.__CTRender(h.CTUserAvatar,{class:"user-row-avatar",user:t}),window.__CTRender("span",{class:"participantName"},t.displayName)),n&&window.__CTRender("div",{class:"sent-time-container"},window.__CTRender("div",{class:"sent-time-mob-view"},window.__CTRender("span",null,"SENT")),window.__CTRender("div",{class:"sent-time-text-container"},window.__CTRender("span",{class:"sent-time"},n))),window.__CTRender("div",{class:"received"},window.__CTRender("div",{className:"received-mob-view"},window.__CTRender("span",null,"RECEIVED")),window.__CTRender(g.CTCLPill,{class:"received-pill",config:this._generateReceivedAlertPillConfig(i,s)})),window.__CTRender("div",{class:"response"},window.__CTRender("div",{className:"response-mob-view"},window.__CTRender("span",null,"RESPONSE")),window.__CTRender(g.CTCLPill,{class:"response-pill",config:this._generateResponseAlertPillConfig(o,r,s)})))})}initialize(){return o(this,void 0,void 0,function*(){this._userLookup=new d.UserLookup(this.layer),yield this._userLookup.populate([this.conversation]),this._config=new c.ConversationConfigReader(this.layer,this.conversation)})}setupListeners(){}generateComponentMarkup(){return this.conversation?window.__CTRender("div",{class:"container"},window.__CTRender("div",{class:"headings"},window.__CTRender("div",{class:"user"},window.__CTRender("span",{class:"participantHeading"},"Participant")),window.__CTRender("div",{class:"sentHeadingContainer"},window.__CTRender("span",{class:"sentHeading"},"Sent")),window.__CTRender("div",{class:"received"},window.__CTRender("span",{class:"receivedHeading"},"Received")),window.__CTRender("div",{class:"response"},window.__CTRender("span",{class:"respondedHeading"},"Responded"))),window.__CTRender("div",{class:"user-list"},this.conversation.participants.filter(e=>e.role!==a.ChatRole.Owner).map(this._renderUserLine))):null}_generateReceivedAlertPillConfig(e,t){const n=e&&e.ts?p.getTwentyFourHoursTime(Number(e.ts)):t?"Undelivered":this.layer.translateI18nItem(m.ChatCommonMetadata.getI18nItem(m.ChatCommonI18nKeys.CONVERSATION_DELIVERING)),i=this.conversation.createdTime+1e3*this.conversation.expiryTTL;return{text:n,style:{alert:{isAwaiting:!t&&!e,isReceived:!(!e||!e.ts),isReceivedAfterExpiry:t&&e&&e.ts>i,isUndelivered:t&&!e}}}}_generateResponseAlertPillConfig(e,t,n){return{text:e&&e.value?e.value:n?"No Response":this.layer.translateI18nItem(m.ChatCommonMetadata.getI18nItem(m.ChatCommonI18nKeys.CONVERSATION_WAITING_FOR_RESPONSE)),inlineText:e&&p.getTwentyFourHoursTime(Number(e.ts)),style:{alert:{isNoAction:!e,isAwaiting:!n&&!e,isResponded:!(!e||!e.ts)},attribute:{value:e?u.buildStyles({backgroundColor:t}):null}}}}_renderTime(e){let t=e;return"string"==typeof e&&(t=parseInt(e)),e&&(0===p.daysFromNow(t)?p.getFriendlyTime(t):p.getFriendlyDate(t,this))||null}};i([s.prop({type:Object,attribute:!1,default:null})],_.prototype,"conversation",void 0),_=i([r.component({tag:"ctcl-response-view",styles:[n(331)]})],_),t.CTCLResponseView=_},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};Object.defineProperty(t,"__esModule",{value:!0});const o=n(38),s=n(1);class r extends o.CTBaseComponent{constructor(e){super(),e&&(this.config=e)}static get is(){return"ct-cl-pill"}componentMarkup(){return this._generateComponentMarkup()}get componentStyles(){return n(329)}_generateComponentMarkup(){const e=!!this.config,t=e&&!!this.config.style,n=this._generateCssClasses(e,t);return e&&this.config.text&&window.__CTRender("div",{class:n,style:t&&this.config.style.attribute?this.config.style.attribute.value:null},window.__CTRender("div",{className:`CTCLPill-textContainer${this.config.inlineText?" isInline":""}`},window.__CTRender("span",{class:"CTCLPill-text"},this.config.text),this.config.inlineText&&window.__CTRender("span",{class:"CTCLPill-inlineText"},this.config.inlineText)))}_generateCssClasses(e,t){const n=t&&!!this.config.style.alert,i=e&&(!this.config.style||n&&this.config.style.alert.isDefault?"CTCLPill--default":"")||"",o=n&&(this.config.style.alert.isNoAction&&!this.config.style.alert.isAwaiting?"CTCLPill--noAction":"")||"",s=n&&(this.config.style.alert.isAwaiting?"CTCLPill--awaiting":"")||"",r=n&&(this.config.style.alert.isReceived?"CTCLPill--received":"")||"",a=n&&(this.config.style.alert.isResponded?"CTCLPill--responded":"")||"",l=n&&(this.config.style.alert.isExpired?"CTCLPill--isExpired":"")||"",c=n&&(this.config.style.alert.isReceivedAfterExpiry?"CTCLPill--isReceivedAfterExpiry":"")||"";let d="CTCLPill-pill ";return d+=`${n&&(this.config.style.alert.isUndelivered?"CTCLPill--isUndelivered":"")||""}`,d+=`${i}`,d+=`${s}`,d+=`${o}`,d+=`${r} ${c}`,d+=`${a}`,d+=`${l}`}}i([s.prop({type:Object,attribute:!0,default:null})],r.prototype,"config",void 0),t.CTCLPill=r,r.register()},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r};Object.defineProperty(t,"__esModule",{value:!0});const o=n(38),s=n(1),r=n(54);class a extends o.CTBaseComponent{constructor(){super(),this._isCountdownInitiated=!1,this._timerTextPlaceholder=""}static get is(){return"ct-cl-alert-status"}componentMarkup(){return this._generateComponentMarkup()}get componentStyles(){return n(55)}disconnectedCallback(){clearInterval(this._alertExpirationInterval)}_generateComponentMarkup(){this._isConversationExpired=this.config.isConversationExpired;const e=this._setExpiredAlertConfig();return this._isCountdownInitiated||setTimeout(()=>{!this.config.isConversationExpired&&this._initialiseAlertExpirationTimer()},0),window.__CTRender("div",{id:"ctclAlertStatusContainer",class:"CTCLAlertStatus-container"},this.config.isConversationExpired&&window.__CTRender(r.CTCLPill,{class:"pill-component",slot:"alert-expired-pill",config:e}),!this.config.isConversationExpired&&window.__CTRender("div",{id:"alertExpirationMessageContainer"},window.__CTRender("span",{id:"alertExpirationTimer"},this._timerTextPlaceholder)))}_setExpiredAlertConfig(){const e={text:`EXPIRED at ${this.config.expiredAt}`,style:{alert:{isExpired:this._isConversationExpired}}};return this.config&&this._isConversationExpired?e:null}_initialiseAlertExpirationTimer(){this._isCountdownInitiated=!0;const e=this.shadowRoot.getElementById("alertExpirationTimer"),t=this.config.createdTime+1e3*this.config.expiryTTL;let n=60,i=(new Date(t).getTime()-(new Date).getTime())/1e3;i/=60;let o=Math.abs(Math.round(i));i=o-1,e&&(this._alertExpirationInterval=setInterval(()=>{if(0===--n&&(i-=1,o-=1),-1===n&&(n=59),-1===i&&(i=0),0===n&&0===i&&0===o)return e.innerText="",clearInterval(this._alertExpirationInterval),this._isConversationExpired=!0,this._showAlertExpirationPill(),void(this.callback&&this.callback instanceof Function&&this.callback());const t=this._getPluralisedExpirationMessage(i,n);this._timerTextPlaceholder=t,e.innerText=t},1e3))}_getPluralisedExpirationMessage(e,t){return`Expires in ${e}:${t<=9?0:""}${t}`}_showAlertExpirationPill(){const e=this._setExpiredAlertConfig(),t=this.shadowRoot.getElementById("ctclAlertStatusContainer"),n=this.shadowRoot.getElementById("alertExpirationMessageContainer"),i=new(customElements.get("ct-cl-pill"))(e);n&&t.removeChild(n),i&&!this._isPillInstantiated&&(t.appendChild(i),this._isPillInstantiated=!0)}}i([s.prop({type:Object,attribute:!0,default:null})],a.prototype,"config",void 0),i([s.prop({type:Function,attribute:!1})],a.prototype,"callback",void 0),t.CTCLAlertStatus=a,a.register()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ROLE_404="role not found"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GROUP_404="group not found"},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});class i{static addInstance(e,t){i.ensureRegistrationsObject(),window.__CTLayers[e]={instance:t,isReady:!1}}static getInstance(e){i.ensureRegistrationsObject();const t=window.__CTLayers[e];return t?t.instance:null}static onReady(e,t){i.ensureRegistrationsObject();const n=window.__CTLayers[e];!!n&&n.isReady?setTimeout(()=>{t()},0):document.addEventListener(`base-layer-ready:${e}`,e=>{setTimeout(()=>{t()},0)})}static fireReady(e){i.ensureRegistrationsObject();const t=window.__CTLayers[e];t&&(t.isReady=!0),document.dispatchEvent(new CustomEvent(`base-layer-ready:${e}`,{detail:{layer:t.instance}}))}static ensureRegistrationsObject(){window.__CTLayers||(window.__CTLayers={})}}t.LayerRegistration=i,window.CtLayerRegistration=i},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(17);var o;!function(e){e[e.PLEASE_WAIT="Please wait..."]="PLEASE_WAIT",e[e.ERROR="Error"]="ERROR",e[e.ERROR_OCCURED="An error occurred"]="ERROR_OCCURED",e[e.YES="Yes"]="YES",e[e.NO="No"]="NO",e[e.OKAY="Okay"]="OKAY",e[e.CANCEL="Cancel"]="CANCEL"}(o||(o={}));class s{static _create(){return new i.Metadata(r,o)}static get instance(){return this._instance||(this._instance=this._create())}}s._instance=null,t.DefaultAlertsMetadata=s;class r{constructor(e){this._translationProvider=e,this._metadata=s.instance}AlertWaiting(e){return{id:this.generateId(),raisedOn:(new Date).getTime(),priority:1,type:"info",title:this._translate(o.PLEASE_WAIT),body:e,showLoadingAnimation:!0}}AlertWaitingCancellable(e,t={}){return{id:this.generateId(),raisedOn:(new Date).getTime(),priority:1,type:"info",title:this._translate(o.PLEASE_WAIT),body:e,showLoadingAnimation:!0,buttons:[{text:this._translate(o.CANCEL),action:t.cancel,type:"primary"}]}}AlertErrorWithOkayButton(e=this._translate(o.ERROR),t=this._translate(o.OKAY),n=1,i={}){return{id:this.generateId(),raisedOn:(new Date).getTime(),priority:n,type:"error",title:e,body:t,buttons:[{text:this._translate(o.OKAY),action:i.okay,type:"primary"}]}}AlertErrorWithCustomButton(e=this._translate(o.ERROR),t=this._translate(o.OKAY),n=1,i){return{id:this.generateId(),raisedOn:(new Date).getTime(),priority:n,type:"error",title:e,body:t,buttons:[{text:i.text||this._translate(o.OKAY),action:i.action,type:"primary",stopAutoDismiss:i.stopAutoDismiss}]}}AlertYesNoQuestion(e,t,n=0,i={},s,r,a="question"){return{id:this.generateId(),raisedOn:(new Date).getTime(),priority:n,type:a,title:e,body:t,buttons:[{text:this._translate(o.NO),action:i.no,type:"primary",disableWhenOffline:r},{text:this._translate(o.YES),action:i.yes,autoFocus:!0,type:"error"===a?"dangerous":"primary",disableWhenOffline:s}]}}AlertQuestion(e,t,n=0,i){return{id:this.generateId(),raisedOn:(new Date).getTime(),priority:n,type:"question",title:e,body:t,buttons:i}}AlertAcknowledge(e,t,n=0,i={},s=this._translate(o.OKAY)){return{id:this.generateId(),raisedOn:(new Date).getTime(),priority:n,type:"success",title:e,body:t,buttons:[{text:s,action:i.okay,type:"primary"}]}}SimpleAlertWithOkay(e,t,n=0,i={},s=this._translate(o.OKAY)){return{id:this.generateId(),raisedOn:(new Date).getTime(),priority:n,type:"info",title:e,body:t,buttons:[{text:s,action:i.okay,type:"primary"}]}}generateId(){return"alert_"+(new Date).getTime().toString()}_translate(e){return this._translationProvider.translateI18nItem(this._metadata.getI18nItem(e))}}t.DefaultAlerts=r},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.COMMON={StatusOnline:{viewBox:"0 0 1024 1024",paths:["M470.923457,555.52087 L517.156966,555.52087 L678.97425,987.033627 L309.106173,987.033627 L470.923457,555.52087 Z M581.144144,581.041767 L537.561355,537.458979 C548.780687,526.239647 555.684891,510.828477 555.684891,493.87619 C555.684891,459.848327 528.068075,432.231511 494.040212,432.231511 C459.950704,432.231511 432.395532,459.848327 432.395532,493.87619 C432.395532,510.828477 439.238091,526.239647 450.457423,537.458979 L406.874635,581.041767 C384.559261,558.726393 370.750852,527.904054 370.750852,493.87619 C370.750852,425.75882 425.922841,370.586831 494.040212,370.586831 C562.095938,370.586831 617.329571,425.75882 617.329571,493.87619 C617.329571,527.904054 603.459518,558.726393 581.144144,581.041767 Z M494.040212,185.652792 L493.916922,185.652792 C664.179527,185.652792 802.14032,323.67523 802.14032,493.87619 C802.14032,579.007493 767.680944,656.063343 711.892509,711.851778 L668.309721,668.268989 C712.940469,623.638241 740.495641,561.993561 740.495641,493.937835 C740.495641,357.764738 630.213309,247.359117 494.040212,247.359117 C357.80547,247.359117 247.461493,357.764738 247.461493,493.937835 C247.461493,561.993561 274.95502,623.638241 319.647413,668.268989 L276.064625,711.851778 C220.337834,656.063343 185.816814,579.007493 185.816814,493.87619 C185.816814,323.67523 323.777607,185.652792 494.040212,185.652792 Z M494.040212,0.718753674 C766.386406,0.718753674 987.197648,221.529996 987.197648,493.87619 C987.197648,630.049288 931.964016,753.338647 842.702519,842.600143 L799.119731,799.017354 C877.22354,720.97519 925.552969,613.097001 925.552969,493.87619 C925.552969,255.557859 732.296898,62.3634333 494.040212,62.3634333 C255.72188,62.3634333 62.5274544,255.557859 62.5274544,493.87619 C62.5274544,613.097001 110.733594,720.97519 188.899048,799.017354 L145.316259,842.600143 C56.0547631,753.338647 0.882774838,630.049288 0.882774838,493.87619 C0.882774838,221.529996 221.632372,0.718753674 494.040212,0.718753674 Z"]},StatusOffline:{viewBox:"0 0 1024 1024",paths:["M586.678306,210.286115 C562.139482,203.996961 536.419525,200.652792 509.916922,200.652792 L510.040212,200.652792 C339.777607,200.652792 201.816814,338.67523 201.816814,508.87619 C201.816814,535.342777 205.153389,561.028843 211.426433,585.537988 L264.560722,532.403699 C263.833299,524.67956 263.461493,516.852047 263.461493,508.937835 C263.461493,372.764738 373.80547,262.359117 510.040212,262.359117 C517.95418,262.359117 525.7807,262.732021 533.503206,263.461215 L586.678306,210.286115 Z M806.86787,425.990261 C814.213724,452.364232 818.14032,480.162284 818.14032,508.87619 C818.14032,594.007493 783.680944,671.063343 727.892509,726.851778 L684.309721,683.268989 C728.940469,638.638241 756.495641,576.993561 756.495641,508.937835 C756.495641,498.546495 755.853446,488.305204 754.606559,478.251572 L806.86787,425.990261 Z","M729.725748,67.238671 C663.573003,34.2656239 588.970927,15.7187537 510.040212,15.7187537 C237.632372,15.7187537 16.8827748,236.529996 16.8827748,508.87619 C16.8827748,587.810373 35.420918,662.415536 68.3909758,728.573445 L114.711707,682.252714 C91.4312107,629.204161 78.5274544,570.558265 78.5274544,508.87619 C78.5274544,270.557859 271.72188,77.3634333 510.040212,77.3634333 C571.684303,77.3634333 630.316005,90.2960769 683.367584,113.596835 L729.725747,67.2386739 L729.725748,67.238671 Z M948.986253,283.87188 C983.639793,351.333945 1003.19765,427.822772 1003.19765,508.87619 C1003.19765,645.049288 947.964016,768.338647 858.702519,857.600143 L815.119731,814.017354 C893.22354,735.97519 941.552969,628.097001 941.552969,508.87619 C941.552969,445.074231 927.701805,384.506419 902.844202,330.013931 L948.98625,283.871881 L948.986253,283.87188 Z","M568.387956,664.470175 L694.97425,1002.03363 L325.106173,1002.03363 L381.675174,851.182956 L568.387956,664.470175 Z M38.537334,1018.85532 L3.14468065,983.537334 L984.462666,0.144680652 L1019.85532,35.462666 L38.537334,1018.85532 Z"]},LoadingSpinner:{viewBox:"0 0 1024 1024",paths:["M1005.714 512c0 272.571-221.143 493.714-493.714 493.714s-493.714-221.143-493.714-493.714c0-248 182.857-453.143 420.571-488.571v130.286c-166.857 33.714-292.571 181.714-292.571 358.286 0 201.714 164 365.714 365.714 365.714s365.714-164 365.714-365.714c0-176.571-125.714-324.571-292.571-358.286v-130.286c237.714 35.429 420.571 240.571 420.571 488.571z"]},Menu:{viewBox:"0 0 1024 1024",paths:["M64 192h896v128h-896v-128z","M64 448h896v128h-896v-128z","M64 704h896v128h-896v-128z"]},ChevronDown:{viewBox:"0 0 1024 1024",paths:["M614.286 420.571q0 7.429-5.714 13.143l-266.286 266.286q-5.714 5.714-13.143 5.714t-13.143-5.714l-266.286-266.286q-5.714-5.714-5.714-13.143t5.714-13.143l28.571-28.571q5.714-5.714 13.143-5.714t13.143 5.714l224.571 224.571 224.571-224.571q5.714-5.714 13.143-5.714t13.143 5.714l28.571 28.571q5.714 5.714 5.714 13.143z"]},ChevronLeft:{viewBox:"0 0 1024 1024",paths:["M669.143 172l-303.429 303.429 303.429 303.429q10.857 10.857 10.857 25.714t-10.857 25.714l-94.857 94.857q-10.857 10.857-25.714 10.857t-25.714-10.857l-424-424q-10.857-10.857-10.857-25.714t10.857-25.714l424-424q10.857-10.857 25.714-10.857t25.714 10.857l94.857 94.857q10.857 10.857 10.857 25.714t-10.857 25.714z"]},ChevronRight:{viewBox:"0 0 1024 1024",paths:["M632.571 501.143l-424 424q-10.857 10.857-25.714 10.857t-25.714-10.857l-94.857-94.857q-10.857-10.857-10.857-25.714t10.857-25.714l303.429-303.429-303.429-303.429q-10.857-10.857-10.857-25.714t10.857-25.714l94.857-94.857q10.857-10.857 25.714-10.857t25.714 10.857l424 424q10.857 10.857 10.857 25.714t-10.857 25.714z"]},ChevronUp:{viewBox:"0 0 1024 1024",paths:["M614.286 676.571q0 7.429-5.714 13.143l-28.571 28.571q-5.714 5.714-13.143 5.714t-13.143-5.714l-224.571-224.571-224.571 224.571q-5.714 5.714-13.143 5.714t-13.143-5.714l-28.571-28.571q-5.714-5.714-5.714-13.143t5.714-13.143l266.286-266.286q5.714-5.714 13.143-5.714t13.143 5.714l266.286 266.286q5.714 5.714 5.714 13.143z"]},ClearTextbox:{viewBox:"0 0 1024 1024",paths:["M1014.662 822.66c-0.004-0.004-0.008-0.008-0.012-0.010l-310.644-310.65 310.644-310.65c0.004-0.004 0.008-0.006 0.012-0.010 3.344-3.346 5.762-7.254 7.312-11.416 4.246-11.376 1.824-24.682-7.324-33.83l-146.746-146.746c-9.148-9.146-22.45-11.566-33.828-7.32-4.16 1.55-8.070 3.968-11.418 7.31 0 0.004-0.004 0.006-0.008 0.010l-310.648 310.652-310.648-310.65c-0.004-0.004-0.006-0.006-0.010-0.010-3.346-3.342-7.254-5.76-11.414-7.31-11.38-4.248-24.682-1.826-33.83 7.32l-146.748 146.748c-9.148 9.148-11.568 22.452-7.322 33.828 1.552 4.16 3.97 8.072 7.312 11.416 0.004 0.002 0.006 0.006 0.010 0.010l310.65 310.648-310.65 310.652c-0.002 0.004-0.006 0.006-0.008 0.010-3.342 3.346-5.76 7.254-7.314 11.414-4.248 11.376-1.826 24.682 7.322 33.83l146.748 146.746c9.15 9.148 22.452 11.568 33.83 7.322 4.16-1.552 8.070-3.97 11.416-7.312 0.002-0.004 0.006-0.006 0.010-0.010l310.648-310.65 310.648 310.65c0.004 0.002 0.008 0.006 0.012 0.008 3.348 3.344 7.254 5.762 11.414 7.314 11.378 4.246 24.684 1.826 33.828-7.322l146.746-146.748c9.148-9.148 11.57-22.454 7.324-33.83-1.552-4.16-3.97-8.068-7.314-11.414z"]},CircleCross:{viewBox:"0 0 1024 1024",paths:["M512 0c-282.77 0-512 229.23-512 512s229.23 512 512 512 512-229.23 512-512-229.23-512-512-512zM512 928c-229.75 0-416-186.25-416-416s186.25-416 416-416 416 186.25 416 416-186.25 416-416 416z","M672 256l-160 160-160-160-96 96 160 160-160 160 96 96 160-160 160 160 96-96-160-160 160-160z"]},Info:{viewBox:"0 0 1024 1024",paths:["M448 304c0-26.4 21.6-48 48-48h32c26.4 0 48 21.6 48 48v32c0 26.4-21.6 48-48 48h-32c-26.4 0-48-21.6-48-48v-32z","M640 768h-256v-64h64v-192h-64v-64h192v256h64z","M512 0c-282.77 0-512 229.23-512 512s229.23 512 512 512 512-229.23 512-512-229.23-512-512-512zM512 928c-229.75 0-416-186.25-416-416s186.25-416 416-416 416 186.25 416 416-186.25 416-416 416z"]},RequiredField:{viewBox:"0 0 1024 1024",paths:["M1022.442 406.048c-4.274-13.2-16.566-22.142-30.442-22.142l-343.458-0.012-106.122-325.128c-4.296-13.164-16.572-22.072-30.42-22.072s-26.124 8.908-30.42 22.072l-106.12 325.128-343.46 0.012c-13.876 0-26.168 8.942-30.444 22.142-4.274 13.2 0.446 27.65 11.688 35.784l277.736 200.922-106.056 325.026c-4.298 13.174 0.37 27.618 11.568 35.784 11.198 8.162 26.378 8.194 37.606 0.070l277.902-201.006 277.9 201.004c5.598 4.048 12.176 6.072 18.754 6.072 6.62 0 13.236-2.048 18.854-6.142 11.198-8.166 15.868-22.61 11.568-35.784l-106.056-325.024 277.734-200.922c11.242-8.132 15.962-22.582 11.688-35.784z"]},ShowPassword:{viewBox:"0 0 1024 1024",paths:["M512 192c-223.318 0-416.882 130.042-512 320 95.118 189.958 288.682 320 512 320 223.312 0 416.876-130.042 512-320-95.116-189.958-288.688-320-512-320zM764.45 361.704c60.162 38.374 111.142 89.774 149.434 150.296-38.292 60.522-89.274 111.922-149.436 150.296-75.594 48.218-162.89 73.704-252.448 73.704-89.56 0-176.858-25.486-252.452-73.704-60.158-38.372-111.138-89.772-149.432-150.296 38.292-60.524 89.274-111.924 149.434-150.296 3.918-2.5 7.876-4.922 11.86-7.3-9.96 27.328-15.41 56.822-15.41 87.596 0 141.382 114.616 256 256 256 141.382 0 256-114.618 256-256 0-30.774-5.452-60.268-15.408-87.598 3.978 2.378 7.938 4.802 11.858 7.302v0zM512 416c0 53.020-42.98 96-96 96s-96-42.98-96-96 42.98-96 96-96 96 42.982 96 96z"]},AlertQuestion:{viewBox:"0 0 1024 1024",paths:["M512 786.286v-109.714q0-8-5.143-13.143t-13.143-5.143h-109.714q-8 0-13.143 5.143t-5.143 13.143v109.714q0 8 5.143 13.143t13.143 5.143h109.714q8 0 13.143-5.143t5.143-13.143zM658.286 402.286q0-50.286-31.714-93.143t-79.143-66.286-97.143-23.429q-138.857 0-212 121.714-8.571 13.714 4.571 24l75.429 57.143q4 3.429 10.857 3.429 9.143 0 14.286-6.857 30.286-38.857 49.143-52.571 19.429-13.714 49.143-13.714 27.429 0 48.857 14.857t21.429 33.714q0 21.714-11.429 34.857t-38.857 25.714q-36 16-66 49.429t-30 71.714v20.571q0 8 5.143 13.143t13.143 5.143h109.714q8 0 13.143-5.143t5.143-13.143q0-10.857 12.286-28.286t31.143-28.286q18.286-10.286 28-16.286t26.286-20 25.429-27.429 16-34.571 7.143-46.286zM877.714 512q0 119.429-58.857 220.286t-159.714 159.714-220.286 58.857-220.286-58.857-159.714-159.714-58.857-220.286 58.857-220.286 159.714-159.714 220.286-58.857 220.286 58.857 159.714 159.714 58.857 220.286z"]},AlertWarning:{viewBox:"0 0 1024 1024",paths:["M585.143 785.714v-108.571c0-10.286-8-18.857-18.286-18.857h-109.714c-10.286 0-18.286 8.571-18.286 18.857v108.571c0 10.286 8 18.857 18.286 18.857h109.714c10.286 0 18.286-8.571 18.286-18.857zM584 572l10.286-262.286c0-3.429-1.714-8-5.714-10.857-3.429-2.857-8.571-6.286-13.714-6.286h-125.714c-5.143 0-10.286 3.429-13.714 6.286-4 2.857-5.714 8.571-5.714 12l9.714 261.143c0 7.429 8.571 13.143 19.429 13.143h105.714c10.286 0 18.857-5.714 19.429-13.143zM576 38.286l438.857 804.571c12.571 22.286 12 49.714-1.143 72s-37.143 36-62.857 36h-877.714c-25.714 0-49.714-13.714-62.857-36s-13.714-49.714-1.143-72l438.857-804.571c12.571-23.429 37.143-38.286 64-38.286s51.429 14.857 64 38.286z"]},Search:{viewBox:"0 0 1024 1024",paths:["M658.286 475.429c0-141.143-114.857-256-256-256s-256 114.857-256 256 114.857 256 256 256 256-114.857 256-256zM950.857 950.857c0 40-33.143 73.143-73.143 73.143-19.429 0-38.286-8-51.429-21.714l-196-195.429c-66.857 46.286-146.857 70.857-228 70.857-222.286 0-402.286-180-402.286-402.286s180-402.286 402.286-402.286 402.286 180 402.286 402.286c0 81.143-24.571 161.143-70.857 228l196 196c13.143 13.143 21.143 32 21.143 51.429z"]},Filter:{viewBox:"0 0 1024 1024",paths:["M869.49 192l-293.49 293.49v296.542l-128 32v-328.542l-293.49-293.49h714.98zM1024 128h-1024l384 384v384l256-64v-320l384-384z"]},UserIconEmpty:{viewBox:"0 0 1024 1024",paths:["M686.286 448c80.571 23.429 191.429 102.857 191.429 362.857 0 117.714-87.429 213.143-194.857 213.143h-488c-107.429 0-194.857-95.429-194.857-213.143 0-260 110.857-339.429 191.429-362.857-28.571-45.143-45.143-98.286-45.143-155.429 0-161.143 131.429-292.571 292.571-292.571s292.571 131.429 292.571 292.571c0 57.143-16.571 110.286-45.143 155.429zM438.857 73.143c-121.143 0-219.429 98.286-219.429 219.429s98.286 219.429 219.429 219.429 219.429-98.286 219.429-219.429-98.286-219.429-219.429-219.429zM682.857 950.857c66.857 0 121.714-62.286 121.714-140 0-180-60.571-292.571-173.714-298.286-51.429 45.143-118.286 72.571-192 72.571s-140.571-27.429-192-72.571c-113.143 5.714-173.714 118.286-173.714 298.286 0 77.714 54.857 140 121.714 140h488z"]},PlusSign:{viewBox:"0 0 1024 1024",paths:["M804.571 420.571v109.714q0 22.857-16 38.857t-38.857 16h-237.714v237.714q0 22.857-16 38.857t-38.857 16h-109.714q-22.857 0-38.857-16t-16-38.857v-237.714h-237.714q-22.857 0-38.857-16t-16-38.857v-109.714q0-22.857 16-38.857t38.857-16h237.714v-237.714q0-22.857 16-38.857t38.857-16h109.714q22.857 0 38.857 16t16 38.857v237.714h237.714q22.857 0 38.857 16t16 38.857z"]},Tick:{viewBox:"0 0 1024 1024",paths:["M864 128l-480 480-224-224-160 160 384 384 640-640z"]},TickHollow:{viewBox:"0 0 1024 1024",paths:["M397.434 917.696l-397.868-391.6 197.378-194.27 200.49 197.332 429.62-422.852 197.378 194.27-626.998 617.12zM107.912 526.096l289.524 284.962 518.656-510.482-89.036-87.632-429.62 422.852-200.49-197.334-89.034 87.634z"]},Cross:{viewBox:"0 0 1024 1024",paths:["M1014.662 822.66c-0.004-0.004-0.008-0.008-0.012-0.010l-310.644-310.65 310.644-310.65c0.004-0.004 0.008-0.006 0.012-0.010 3.344-3.346 5.762-7.254 7.312-11.416 4.246-11.376 1.824-24.682-7.324-33.83l-146.746-146.746c-9.148-9.146-22.45-11.566-33.828-7.32-4.16 1.55-8.070 3.968-11.418 7.31 0 0.004-0.004 0.006-0.008 0.010l-310.648 310.652-310.648-310.65c-0.004-0.004-0.006-0.006-0.010-0.010-3.346-3.342-7.254-5.76-11.414-7.31-11.38-4.248-24.682-1.826-33.83 7.32l-146.748 146.748c-9.148 9.148-11.568 22.452-7.322 33.828 1.552 4.16 3.97 8.072 7.312 11.416 0.004 0.002 0.006 0.006 0.010 0.010l310.65 310.648-310.65 310.652c-0.002 0.004-0.006 0.006-0.008 0.010-3.342 3.346-5.76 7.254-7.314 11.414-4.248 11.376-1.826 24.682 7.322 33.83l146.748 146.746c9.15 9.148 22.452 11.568 33.83 7.322 4.16-1.552 8.070-3.97 11.416-7.312 0.002-0.004 0.006-0.006 0.010-0.010l310.648-310.65 310.648 310.65c0.004 0.002 0.008 0.006 0.012 0.008 3.348 3.344 7.254 5.762 11.414 7.314 11.378 4.246 24.684 1.826 33.828-7.322l146.746-146.748c9.148-9.148 11.57-22.454 7.324-33.83-1.552-4.16-3.97-8.068-7.314-11.414z"]},MenuDots:{viewBox:"0 0 1024 1024",paths:["M384 192c0-70.692 57.308-128 128-128s128 57.308 128 128c0 70.692-57.308 128-128 128s-128-57.308-128-128zM384 512c0-70.692 57.308-128 128-128s128 57.308 128 128c0 70.692-57.308 128-128 128s-128-57.308-128-128zM384 832c0-70.692 57.308-128 128-128s128 57.308 128 128c0 70.692-57.308 128-128 128s-128-57.308-128-128z"]},HorizontalMenuDots:{viewBox:"0 0 1024 1024",paths:["M832 448c70.692 0 128 57.308 128 128s-57.308 128-128 128c-70.692 0-128-57.308-128-128s57.308-128 128-128zM512 448c70.692 0 128 57.308 128 128s-57.308 128-128 128c-70.692 0-128-57.308-128-128s57.308-128 128-128zM192 448c70.692 0 128 57.308 128 128s-57.308 128-128 128c-70.692 0-128-57.308-128-128s57.308-128 128-128z"]},User:{viewBox:"0 0 21 19",paths:["M12,13.2137692 L12,12.008 C13.653,11.1003846 15,8.83938462 15,6.57692308 C15,2.945 15,0 10.5,0 C6,0 6,2.945 6,6.57692308 C6,8.83938462 7.3455,11.1003846 9,12.008 L9,13.2137692 C3.9105,13.6186154 0,16.055 0,19 L21,19 C21,16.055 17.088,13.6186154 12,13.2137692"]},Users:{viewBox:"0 0 1408 1024",paths:["M768 705.306v-13.256c92.524-35.408 160-145.59 160-276.050 0-159.058-100.29-288-224-288-123.712 0-224 128.942-224 288 0 130.46 67.476 240.642 160 276.050v13.256c-217.102 8.874-384 62.21-384 126.694v128h896v-128c0-64.484-166.898-117.82-384-126.694z","M1152 448.592v-5.078c73.032-20.754 128-111.146 128-219.514 0-123.712-71.634-224-160-224s-160 100.288-160 224c0 108.37 54.968 198.76 128 219.514v5.078c-31.81 1.172-62.054 4.074-89.878 8.412-6.28 68.208-28.092 131.24-61.738 182.996h471.616v-96c0-49.414-112.006-90.1-256-95.408z","M409.878 457.004c-27.824-4.338-58.070-7.24-89.878-8.412v-5.078c73.032-20.754 128-111.146 128-219.514 0-123.712-71.634-224-160-224s-160 100.288-160 224c0 108.37 54.968 198.76 128 219.514v5.078c-143.994 5.308-256 45.994-256 95.408v96h471.618c-33.646-51.756-55.458-114.788-61.74-182.996z"]},Mute:{viewBox:"0 0 1024 1024",paths:["M704 0l-320 320h-192v384l512-512zM954.176 69.824l-884.352 884.352 69.824 69.824 282.176-282.176 282.176 282.176v-564.354l320-320z"]},RadioEmpty:{viewBox:"0 0 1024 1024",paths:["M512 0c-282.77 0-512 229.23-512 512s229.23 512 512 512 512-229.23 512-512-229.23-512-512-512zM512 896c-212.078 0-384-171.922-384-384s171.922-384 384-384c212.078 0 384 171.922 384 384s-171.922 384-384 384z"]},RadioChecked:{viewBox:"0 0 1024 1024",paths:["M512 0c-282.77 0-512 229.23-512 512s229.23 512 512 512 512-229.23 512-512-229.23-512-512-512zM512 640c-70.692 0-128-57.306-128-128 0-70.692 57.308-128 128-128 70.694 0 128 57.308 128 128 0 70.694-57.306 128-128 128z"]},Refresh:{viewBox:"0 0 1024 1024",paths:["M889.68 166.32c-93.608-102.216-228.154-166.32-377.68-166.32-282.77 0-512 229.23-512 512h96c0-229.75 186.25-416 416-416 123.020 0 233.542 53.418 309.696 138.306l-149.696 149.694h352v-352l-134.32 134.32z","M928 512c0 229.75-186.25 416-416 416-123.020 0-233.542-53.418-309.694-138.306l149.694-149.694h-352v352l134.32-134.32c93.608 102.216 228.154 166.32 377.68 166.32 282.77 0 512-229.23 512-512h-96z"]},Bolt:{viewBox:"0 0 19 19",paths:["M 7.12,0.00 C 7.12,0.00 0.00,9.50 0.00,9.50 0.00,9.50 7.12,9.50 7.12,9.50 7.12,9.50 2.37,19.00 2.37,19.00 2.37,19.00 19.00,7.12 19.00,7.12 19.00,7.12 9.50,7.12 9.50,7.12 9.50,7.12 16.62,0.00 16.62,0.00 16.62,0.00 7.12,0.00 7.12,0.00 Z"]},Role:{viewBox:"0 0 18 25",paths:["M9,3 C8.44770083,3 8,2.5523131 8,2.00003111 C8,1.44774912 8.44770083,1 9,1 C9.55223695,1 10,1.44774912 10,2.00003111 C10,2.5523131 9.55223695,3 9,3 M9.58761702,0 L8.41238298,0 C7.63557447,0 7,0.741503546 7,1.64778014 L7,5.35221986 C7,6.25849645 7.63557447,7 8.41238298,7 L9.58761702,7 C10.3644255,7 11,6.25849645 11,5.35221986 L11,1.64778014 C11,0.741503546 10.3644255,0 9.58761702,0","M11.9125364,20.8107417 L8.86880466,20.8107417 L5.98250729,20.8107417 C5.19533528,20.8107417 4.7755102,20.2199488 4.7755102,19.5754476 C4.7755102,18.9309463 4.93294461,18.8235294 5.30029155,18.5012788 C5.66763848,18.1790281 6.97959184,17.6956522 7.45189504,17.5345269 C7.92419825,17.3734015 7.87172012,16.8363171 7.87172012,16.8363171 C7.03206997,16.2455243 6.7696793,15.0639386 6.7696793,15.0639386 C6.6122449,15.0102302 6.29737609,14.8491049 6.24489796,14.258312 C6.19241983,13.6675192 6.6122449,13.6138107 6.6122449,13.6138107 C6.55976676,13.1841432 6.6122449,12.5396419 6.7696793,12.0025575 C6.9271137,11.4654731 7.29446064,11.3043478 7.76676385,11.0358056 C8.23906706,10.7672634 8.86880466,10.713555 8.86880466,10.713555 L9.02623907,10.713555 C9.02623907,10.713555 9.65597668,10.7672634 10.1282799,11.0358056 C10.6005831,11.3043478 10.96793,11.4654731 11.1253644,12.0025575 C11.2827988,12.5396419 11.335277,13.1841432 11.2827988,13.6138107 C11.2827988,13.6138107 11.7026239,13.6675192 11.6501458,14.258312 C11.5976676,14.8491049 11.2827988,15.0102302 11.1253644,15.0639386 C11.1253644,15.0639386 10.8629738,16.2455243 10.0233236,16.8363171 C10.0233236,16.8363171 9.97084548,17.3734015 10.4431487,17.5345269 C10.9154519,17.6956522 12.2274052,18.1790281 12.5947522,18.5012788 C12.9620991,18.8235294 13.1195335,18.9309463 13.1195335,19.5754476 C13.1195335,20.2199488 12.6997085,20.8107417 11.9125364,20.8107417 M14.6413994,4 L12.2274052,4 L12.2274052,5.657711 C12.2274052,7.02050895 11.1379067,8.13554987 9.80632653,8.13554987 L8.0887172,8.13554987 C6.75713703,8.13554987 5.66763848,7.02050895 5.66763848,5.657711 L5.66763848,4 L3.35860058,4 C1.51137026,4 0,5.54680307 0,7.43734015 L0,21.5626598 C0,23.4531969 1.51137026,25 3.35860058,25 L14.6413994,25 C16.4886297,25 18,23.4531969 18,21.5626598 L18,7.43734015 C18,5.54680307 16.4886297,4 14.6413994,4"]},Group:{viewBox:"0 0 31 20",paths:["M25.325,9.20234909 L25.325,9.09964909 C26.7155938,8.67974909 27.7625,6.84284909 27.7625,4.64064909 C27.7625,2.12904909 26.3987188,0.0906490909 24.715625,0.0906490909 C23.0313125,0.0906490909 21.66875,2.12904909 21.66875,4.64064909 C21.66875,6.84284909 22.7144375,8.67974909 24.10625,9.09964909 L24.10625,9.20234909 C23.5005313,9.22704909 22.9228438,9.28554909 22.395125,9.37264909 C22.2744688,10.7584491 21.858875,12.0402491 21.2190313,13.0893491 L30.2,13.0893491 L30.2,11.1393491 C30.2,10.1357491 28.0671875,9.30894909 25.325,9.20104909 L25.325,9.20234909 Z","M16.4857143,14.1924476 L16.4857143,13.9389091 C18.3435714,13.2570629 19.7,11.1389091 19.7,8.62937063 C19.7,5.57090909 17.6852857,3.09090909 15.2,3.09090909 C12.7134286,3.09090909 10.7,5.57090909 10.7,8.62937063 C10.7,11.1389091 12.0551429,13.2570629 13.9142857,13.9389091 L13.9142857,14.1924476 C9.55185714,14.3647552 6.2,15.389986 6.2,16.6293706 L6.2,19.0909091 L24.2,19.0909091 L24.2,16.6293706 C24.2,15.389986 20.8468571,14.3647552 16.4857143,14.1924476","M8.02125407,9.37290909 C7.48990228,9.28580909 6.91335505,9.22730909 6.30749186,9.20260909 L6.30749186,9.09990909 C7.7,8.68000909 8.7504886,6.84310909 8.7504886,4.64090909 C8.7504886,2.12930909 7.38363192,0.0909090909 5.69674267,0.0909090909 C4.00863192,0.0909090909 2.64299674,2.12930909 2.64299674,4.64090909 C2.64299674,6.84310909 3.69104235,8.68000909 5.08599349,9.09990909 L5.08599349,9.20260909 C2.33762215,9.31050909 0.2,10.1373091 0.2,11.1409091 L0.2,13.0909091 L9.2,13.0909091 C8.55749186,12.0405091 8.14218241,10.7587091 8.02125407,9.37420909 L8.02125407,9.37290909 Z"]}}}(t.Icons||(t.Icons={}))},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(62);t.ChatEntryEventArgs=class extends i.BaseChatEventArgs{constructor(e){super(),this.chatEntry=e}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(14);t.BaseChatEventArgs=class extends i.BaseEventArgs{constructor(){super()}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(62);t.ConversationEventArgs=class extends i.BaseChatEventArgs{constructor(e){super(),this.conversation=e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t,n){this.VERSION_CHECK_XMLNS="urn:commontime:infinity:client-version",this._clientVersion=n,this._os=e,this._osVersion=t}updateInfo(e,t,n,i,o){this._updateAvailable=e,this._newVersion=t,this._updateUrl=n,this._required=i,this._info=o,this._updateAvailable&&this._callback.forEach((e,t)=>{e()})}openUpdateSite(){window.open(`${this._updateUrl}`,"_system")}isUpdateAvailable(){return this._updateAvailable}isUpdateRequired(){return this._required}getNewVersion(){return this._newVersion}getUpdateInfo(){return this._info}onStanza(e){e.message&&e.message.update&&this.updateInfo(!0,e.message.update["client-version"],e.message.update.url,"true"===e.message.update.required,e.message.update.info)}getUpdateAlertInfo(){return{type:"info",title:"Update Required",msg:"An update is required before you can use the app.",button:{text:"Update Now",action:()=>{this.openUpdateSite()},stopAutoDismiss:!0}}}getUpdateQueryPayload(){return{query:{$attributes:{xmlns:this.VERSION_CHECK_XMLNS},os:this._os,"os-version":this._osVersion,"client-version":this._clientVersion}}}addNewVersionEventListener(e){void 0===this._callback&&(this._callback=[]),this._callback.push(e)}removeNewVersionEventListene(e){this._callback.forEach((t,n)=>{t===e&&this._callback.splice(n,1)})}}i.UPDATE_REQUIRED_ERROR="Update Required",t.UpdateHelper=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Music="music"]="Music",e[e.Notification="notification"]="Notification",e[e.Ring="ring"]="Ring",e[e.Alarm="alarm"]="Alarm",e[e.Voice="voice"]="Voice",e[e.System="system"]="System",e[e.Dtmf="dtmf"]="Dtmf"}(t.VolumeStream||(t.VolumeStream={}))},function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return r});var i={"":["<em>","</em>"],_:["<strong>","</strong>"],"~":["<s>","</s>"],"\n":["<br />"]," ":["<br />"],"-":["<hr />"]};function o(e){return e.replace(RegExp("^"+(e.match(/^(\t| )+/)||"")[0],"gm"),"")}function s(e){return(e+"").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function r(e,t,n){var a,l,c,d,h,u=Object.assign({indentBlocks:!0,links:!0,images:!0,headings:!0,code:!0,replaceCodeWithEmoji:null,inline:!0},n),p=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:\!\[([^\]]*?)\]\(([^\)]+?)\))|(\[)|(\](?:\(([^\)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(\-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm,g=[],m="",f=t||{},_=0;function v(e){var t=i[e.replace(/\*/g,"_")[1]||""],n=g[g.length-1]==e;return t?t[1]?(g[n?"pop":"push"](e),t[0|n]):t[0]:e}function y(){for(var e="";g.length;)e+=v(g[g.length-1]);return e}for(e=e.replace(/^\[(.+?)\]:\s*(.+)$/gm,function(e,t,n){return f[t.toLowerCase()]=n,""}).replace(/^\n+|\n+$/g,"");c=p.exec(e);){if(l=e.substring(_,c.index),_=p.lastIndex,a=c[0],l.match(/[^\\](\\\\)*\\$/));else if(!1!==u.code&&(c[3]||c[4]))a=u.replaceCodeWithEmoji?""+u.replaceCodeWithEmoji:'<pre class="code '+(c[4]?"poetry":c[2].toLowerCase())+'">'+o(s(c[3]||c[4]).replace(/^\n+|\n+$/g,""))+"</pre>";else if(!1!==u.quotesAndLists&&c[6])(h=c[6]).match(/\./)&&(c[5]=c[5].replace(/^\d+/gm,"")),d=r(o(c[5].replace(/^\s*[>*+.-]/gm,"")),null,u),">"===h?h="blockquote":(h=h.match(/\./)?"ol":"ul",d=d.replace(/^(.*)(\n|$)/gm,"<li>$1</li>")),a="<"+h+">"+d+"</"+h+">";else if(!1!==u.images&&c[8])a='<img src="'+s(c[8])+'" alt="'+s(c[7])+'">';else if(!1!==u.links&&c[10]){var C=s(c[11]||f[l.toLowerCase()]);-1===C.search(/^http[s]?\:\/\//)&&(C="http://"+C),m=m.replace("<a>",'<a href="#" onclick="window.open(\''+C+"', '_system')\">"),a=(y()||c[11])+"</a>"}else!1!==u.links&&c[9]?a="<a>":!1!==u.headings&&(c[12]||c[14])?a="<"+(h="h"+(c[14]?c[14].length:"="===c[13][0]?1:2))+">"+r(c[12]||c[15],f,u)+"</"+h+">":!1!==u.code&&c[16]?a=u.replaceCodeWithEmoji?""+u.replaceCodeWithEmoji:"<code>"+s(c[16])+"</code>":!1!==u.inline&&(c[17]||c[1])&&(a=v(c[17]||"--"));m+=l,m+=a}return(m+e.substring(_)+y()).trim()}},function(e,t,n){(function(t,n){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */
!function(t,n){e.exports=n()}(0,function(){"use strict";function e(e){return"function"==typeof e}var i=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=0,s=void 0,r=void 0,a=function(e,t){g[o]=e,g[o+1]=t,2===(o+=2)&&(r?r(m):f())};var l="undefined"!=typeof window?window:void 0,c=l||{},d=c.MutationObserver||c.WebKitMutationObserver,h="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),u="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function p(){var e=setTimeout;return function(){return e(m,1)}}var g=new Array(1e3);function m(){for(var e=0;e<o;e+=2){(0,g[e])(g[e+1]),g[e]=void 0,g[e+1]=void 0}o=0}var f=void 0;function _(e,t){var n=this,i=new this.constructor(C);void 0===i[y]&&N(i);var o=n._state;if(o){var s=arguments[o-1];a(function(){return M(o,i,s,n._result)})}else x(n,i,e,t);return i}function v(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(C);return R(t,e),t}f=h?function(){return t.nextTick(m)}:d?function(){var e=0,t=new d(m),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}():u?function(){var e=new MessageChannel;return e.port1.onmessage=m,function(){return e.port2.postMessage(0)}}():void 0===l?function(){try{var e=Function("return this")().require("vertx");return void 0!==(s=e.runOnLoop||e.runOnContext)?function(){s(m)}:p()}catch(e){return p()}}():p();var y=Math.random().toString(36).substring(2);function C(){}var w=void 0,b=1,E=2;function T(t,n,i){n.constructor===t.constructor&&i===_&&n.constructor.resolve===v?function(e,t){t._state===b?A(e,t._result):t._state===E?S(e,t._result):x(t,void 0,function(t){return R(e,t)},function(t){return S(e,t)})}(t,n):void 0===i?A(t,n):e(i)?function(e,t,n){a(function(e){var i=!1,o=function(e,t,n,i){try{e.call(t,n,i)}catch(e){return e}}(n,t,function(n){i||(i=!0,t!==n?R(e,n):A(e,n))},function(t){i||(i=!0,S(e,t))},e._label);!i&&o&&(i=!0,S(e,o))},e)}(t,n,i):A(t,n)}function R(e,t){if(e===t)S(e,new TypeError("You cannot resolve a promise with itself"));else if(function(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}(t)){var n=void 0;try{n=t.then}catch(t){return void S(e,t)}T(e,t,n)}else A(e,t)}function I(e){e._onerror&&e._onerror(e._result),O(e)}function A(e,t){e._state===w&&(e._result=t,e._state=b,0!==e._subscribers.length&&a(O,e))}function S(e,t){e._state===w&&(e._state=E,e._result=t,a(I,e))}function x(e,t,n,i){var o=e._subscribers,s=o.length;e._onerror=null,o[s]=t,o[s+b]=n,o[s+E]=i,0===s&&e._state&&a(O,e)}function O(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var i=void 0,o=void 0,s=e._result,r=0;r<t.length;r+=3)i=t[r],o=t[r+n],i?M(n,i,o,s):o(s);e._subscribers.length=0}}function M(t,n,i,o){var s=e(i),r=void 0,a=void 0,l=!0;if(s){try{r=i(o)}catch(e){l=!1,a=e}if(n===r)return void S(n,new TypeError("A promises callback cannot return that same promise."))}else r=o;n._state!==w||(s&&l?R(n,r):!1===l?S(n,a):t===b?A(n,r):t===E&&S(n,r))}var L=0;function N(e){e[y]=L++,e._state=void 0,e._result=void 0,e._subscribers=[]}var D=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(C),this.promise[y]||N(this.promise),i(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?A(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&A(this.promise,this._result))):S(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===w&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===v){var o=void 0,s=void 0,r=!1;try{o=e.then}catch(e){r=!0,s=e}if(o===_&&e._state!==w)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===P){var a=new n(C);r?S(a,s):T(a,e,o),this._willSettleAt(a,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(i(e),t)},e.prototype._settledAt=function(e,t,n){var i=this.promise;i._state===w&&(this._remaining--,e===E?S(i,n):this._result[t]=n),0===this._remaining&&A(i,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;x(e,void 0,function(e){return n._settledAt(b,t,e)},function(e){return n._settledAt(E,t,e)})},e}();var P=function(){function t(e){this[y]=L++,this._result=this._state=void 0,this._subscribers=[],C!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t(function(t){R(e,t)},function(t){S(e,t)})}catch(t){S(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var n=this.constructor;return e(t)?this.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){throw e})}):this.then(t,t)},t}();return P.prototype.then=_,P.all=function(e){return new D(this,e).promise},P.race=function(e){var t=this;return i(e)?new t(function(n,i){for(var o=e.length,s=0;s<o;s++)t.resolve(e[s]).then(n,i)}):new t(function(e,t){return t(new TypeError("You must pass an array to race."))})},P.resolve=v,P.reject=function(e){var t=new this(C);return S(t,e),t},P._setScheduler=function(e){r=e},P._setAsap=function(e){a=e},P._asap=a,P.polyfill=function(){var e=void 0;if(void 0!==n)e=n;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var i=null;try{i=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===i&&!t.cast)return}e.Promise=P},P.Promise=P,P})}).call(this,n(171),n(40))},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var i=n(172),o=n(173),s=n(174);function r(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(r()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,n){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return c(this,e,t,n)}function c(e,t,n,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,i){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,n):new Uint8Array(t,n,i);l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=u(e,t);return e}(e,t,n,i):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!l.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|g(t,n),o=(e=a(e,i)).write(t,n);o!==i&&(e=e.slice(0,o));return e}(e,t,n):function(e,t){if(l.isBuffer(t)){var n=0|p(t.length);return 0===(e=a(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||function(e){return e!=e}(t.length)?a(e,0):u(e,t);if("Buffer"===t.type&&s(t.data))return u(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function d(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(d(t),e=a(e,t<0?0:0|p(t)),!l.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function u(e,t){var n=t.length<0?0:0|p(t.length);e=a(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function p(e){if(e>=r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r().toString(16)+" bytes");return 0|e}function g(e,t){if(l.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return G(e).length;default:if(i)return B(e).length;t=(""+t).toLowerCase(),i=!0}}function m(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function f(e,t,n,i,o){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=o?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(o)return-1;n=e.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof t&&(t=l.from(t,i)),l.isBuffer(t))return 0===t.length?-1:_(e,t,n,i,o);if("number"==typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):_(e,[t],n,i,o);throw new TypeError("val must be string, number or Buffer")}function _(e,t,n,i,o){var s,r=1,a=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;r=2,a/=2,l/=2,n/=2}function c(e,t){return 1===r?e[t]:e.readUInt16BE(t*r)}if(o){var d=-1;for(s=n;s<a;s++)if(c(e,s)===c(t,-1===d?0:s-d)){if(-1===d&&(d=s),s-d+1===l)return d*r}else-1!==d&&(s-=s-d),d=-1}else for(n+l>a&&(n=a-l),s=n;s>=0;s--){for(var h=!0,u=0;u<l;u++)if(c(e,s+u)!==c(t,u)){h=!1;break}if(h)return s}return-1}function v(e,t,n,i){n=Number(n)||0;var o=e.length-n;i?(i=Number(i))>o&&(i=o):i=o;var s=t.length;if(s%2!=0)throw new TypeError("Invalid hex string");i>s/2&&(i=s/2);for(var r=0;r<i;++r){var a=parseInt(t.substr(2*r,2),16);if(isNaN(a))return r;e[n+r]=a}return r}function y(e,t,n,i){return H(B(t,e.length-n),e,n,i)}function C(e,t,n,i){return H(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function w(e,t,n,i){return C(e,t,n,i)}function b(e,t,n,i){return H(G(t),e,n,i)}function E(e,t,n,i){return H(function(e,t){for(var n,i,o,s=[],r=0;r<e.length&&!((t-=2)<0);++r)n=e.charCodeAt(r),i=n>>8,o=n%256,s.push(o),s.push(i);return s}(t,e.length-n),e,n,i)}function T(e,t,n){return 0===t&&n===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,n))}function R(e,t,n){n=Math.min(e.length,n);for(var i=[],o=t;o<n;){var s,r,a,l,c=e[o],d=null,h=c>239?4:c>223?3:c>191?2:1;if(o+h<=n)switch(h){case 1:c<128&&(d=c);break;case 2:128==(192&(s=e[o+1]))&&(l=(31&c)<<6|63&s)>127&&(d=l);break;case 3:s=e[o+1],r=e[o+2],128==(192&s)&&128==(192&r)&&(l=(15&c)<<12|(63&s)<<6|63&r)>2047&&(l<55296||l>57343)&&(d=l);break;case 4:s=e[o+1],r=e[o+2],a=e[o+3],128==(192&s)&&128==(192&r)&&128==(192&a)&&(l=(15&c)<<18|(63&s)<<12|(63&r)<<6|63&a)>65535&&l<1114112&&(d=l)}null===d?(d=65533,h=1):d>65535&&(d-=65536,i.push(d>>>10&1023|55296),d=56320|1023&d),i.push(d),o+=h}return function(e){var t=e.length;if(t<=I)return String.fromCharCode.apply(String,e);var n="",i=0;for(;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=I));return n}(i)}t.Buffer=l,t.SlowBuffer=function(e){+e!=e&&(e=0);return l.alloc(+e)},t.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=r(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,n){return c(null,e,t,n)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,n){return function(e,t,n,i){return d(t),t<=0?a(e,t):void 0!==n?"string"==typeof i?a(e,t).fill(n,i):a(e,t).fill(n):a(e,t)}(null,e,t,n)},l.allocUnsafe=function(e){return h(null,e)},l.allocUnsafeSlow=function(e){return h(null,e)},l.isBuffer=function(e){return!(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,o=0,s=Math.min(n,i);o<s;++o)if(e[o]!==t[o]){n=e[o],i=t[o];break}return n<i?-1:i<n?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!s(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=l.allocUnsafe(t),o=0;for(n=0;n<e.length;++n){var r=e[n];if(!l.isBuffer(r))throw new TypeError('"list" argument must be an Array of Buffers');r.copy(i,o),o+=r.length}return i},l.byteLength=g,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?R(this,0,e):function(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return x(this,t,n);case"utf8":case"utf-8":return R(this,t,n);case"ascii":return A(this,t,n);case"latin1":case"binary":return S(this,t,n);case"base64":return T(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,n,i,o){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===o&&(o=this.length),t<0||n>e.length||i<0||o>this.length)throw new RangeError("out of range index");if(i>=o&&t>=n)return 0;if(i>=o)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,o>>>=0,this===e)return 0;for(var s=o-i,r=n-t,a=Math.min(s,r),c=this.slice(i,o),d=e.slice(t,n),h=0;h<a;++h)if(c[h]!==d[h]){s=c[h],r=d[h];break}return s<r?-1:r<s?1:0},l.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},l.prototype.indexOf=function(e,t,n){return f(this,e,t,n,!0)},l.prototype.lastIndexOf=function(e,t,n){return f(this,e,t,n,!1)},l.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var o=this.length-t;if((void 0===n||n>o)&&(n=o),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var s=!1;;)switch(i){case"hex":return v(this,e,t,n);case"utf8":case"utf-8":return y(this,e,t,n);case"ascii":return C(this,e,t,n);case"latin1":case"binary":return w(this,e,t,n);case"base64":return b(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,e,t,n);default:if(s)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),s=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var I=4096;function A(e,t,n){var i="";n=Math.min(e.length,n);for(var o=t;o<n;++o)i+=String.fromCharCode(127&e[o]);return i}function S(e,t,n){var i="";n=Math.min(e.length,n);for(var o=t;o<n;++o)i+=String.fromCharCode(e[o]);return i}function x(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var o="",s=t;s<n;++s)o+=F(e[s]);return o}function O(e,t,n){for(var i=e.slice(t,n),o="",s=0;s<i.length;s+=2)o+=String.fromCharCode(i[s]+256*i[s+1]);return o}function M(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function L(e,t,n,i,o,s){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<s)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function N(e,t,n,i){t<0&&(t=65535+t+1);for(var o=0,s=Math.min(e.length-n,2);o<s;++o)e[n+o]=(t&255<<8*(i?o:1-o))>>>8*(i?o:1-o)}function D(e,t,n,i){t<0&&(t=4294967295+t+1);for(var o=0,s=Math.min(e.length-n,4);o<s;++o)e[n+o]=t>>>8*(i?o:3-o)&255}function P(e,t,n,i,o,s){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function k(e,t,n,i,s){return s||P(e,0,n,4),o.write(e,t,n,i,23,4),n+4}function U(e,t,n,i,s){return s||P(e,0,n,8),o.write(e,t,n,i,52,8),n+8}l.prototype.slice=function(e,t){var n,i=this.length;if(e=~~e,t=void 0===t?i:~~t,e<0?(e+=i)<0&&(e=0):e>i&&(e=i),t<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=l.prototype;else{var o=t-e;n=new l(o,void 0);for(var s=0;s<o;++s)n[s]=this[s+e]}return n},l.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var i=this[e],o=1,s=0;++s<t&&(o*=256);)i+=this[e+s]*o;return i},l.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var i=this[e+--t],o=1;t>0&&(o*=256);)i+=this[e+--t]*o;return i},l.prototype.readUInt8=function(e,t){return t||M(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||M(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||M(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||M(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||M(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var i=this[e],o=1,s=0;++s<t&&(o*=256);)i+=this[e+s]*o;return i>=(o*=128)&&(i-=Math.pow(2,8*t)),i},l.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var i=t,o=1,s=this[e+--i];i>0&&(o*=256);)s+=this[e+--i]*o;return s>=(o*=128)&&(s-=Math.pow(2,8*t)),s},l.prototype.readInt8=function(e,t){return t||M(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||M(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(e,t){t||M(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(e,t){return t||M(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||M(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||M(e,4,this.length),o.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||M(e,4,this.length),o.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||M(e,8,this.length),o.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||M(e,8,this.length),o.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,n,i){(e=+e,t|=0,n|=0,i)||L(this,e,t,n,Math.pow(2,8*n)-1,0);var o=1,s=0;for(this[t]=255&e;++s<n&&(o*=256);)this[t+s]=e/o&255;return t+n},l.prototype.writeUIntBE=function(e,t,n,i){(e=+e,t|=0,n|=0,i)||L(this,e,t,n,Math.pow(2,8*n)-1,0);var o=n-1,s=1;for(this[t+o]=255&e;--o>=0&&(s*=256);)this[t+o]=e/s&255;return t+n},l.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):N(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):N(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):D(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t|=0,!i){var o=Math.pow(2,8*n-1);L(this,e,t,n,o-1,-o)}var s=0,r=1,a=0;for(this[t]=255&e;++s<n&&(r*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/r>>0)-a&255;return t+n},l.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t|=0,!i){var o=Math.pow(2,8*n-1);L(this,e,t,n,o-1,-o)}var s=n-1,r=1,a=0;for(this[t+s]=255&e;--s>=0&&(r*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/r>>0)-a&255;return t+n},l.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):N(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):N(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):D(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,n){return k(this,e,t,!0,n)},l.prototype.writeFloatBE=function(e,t,n){return k(this,e,t,!1,n)},l.prototype.writeDoubleLE=function(e,t,n){return U(this,e,t,!0,n)},l.prototype.writeDoubleBE=function(e,t,n){return U(this,e,t,!1,n)},l.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var o,s=i-n;if(this===e&&n<t&&t<i)for(o=s-1;o>=0;--o)e[o+t]=this[o+n];else if(s<1e3||!l.TYPED_ARRAY_SUPPORT)for(o=0;o<s;++o)e[o+t]=this[o+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+s),t);return s},l.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===e.length){var o=e.charCodeAt(0);o<256&&(e=o)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!l.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var s;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(s=t;s<n;++s)this[s]=e;else{var r=l.isBuffer(e)?e:B(new l(e,i).toString()),a=r.length;for(s=0;s<n-t;++s)this[s+t]=r[s%a]}return this};var j=/[^+\/0-9A-Za-z-_]/g;function F(e){return e<16?"0"+e.toString(16):e.toString(16)}function B(e,t){var n;t=t||1/0;for(var i=e.length,o=null,s=[],r=0;r<i;++r){if((n=e.charCodeAt(r))>55295&&n<57344){if(!o){if(n>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(r+1===i){(t-=3)>-1&&s.push(239,191,189);continue}o=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&(t-=3)>-1&&s.push(239,191,189);if(o=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function G(e){return i.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(j,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function H(e,t,n,i){for(var o=0;o<i&&!(o+n>=t.length||o>=e.length);++o)t[o+n]=e[o];return o}}).call(this,n(40))},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(41);class o extends i.BaseMessageType{}o.FetchConversations="fetch-conversations",o.CreateConversation="create-conversation",o.UpdateConversation="update-conversation",o.AddParticipants="add-participants",o.RemoveParticipants="remove-participants",o.ChangeParticipantRole="change-participant-role",o.LeaveConversation="leave-conversation",o.EndConversation="end-conversation",o.ReceivedConversation="received-conversation",o.AcknowledgeConversation="acknowledge-conversation",o.HideDirectConversation="hide-before",o.DelegateAccounts="delegate",o.AcquireDelegation="acquire-delegation",o.GiveDelegation="give-delegation",o.TakeDelegation="take-delegation",o.AssignDelegation="assign-delegation",o.TransferDelegation="transfer-delegation",o.RelinquishDelegation="relinquish-delegation",o.ReleaseDelegation="release-delegation",o.DelegationUpdate="delegation-update",o.CreateRole="create-role",o.DeleteRole="delete-role",o.ModifyRole="modify-role",o.QueryRoles="query-roles",o.GetGroup="get-group",o.QueryGroups="query-groups",o.CreateGroup="create-group",o.DeleteGroup="delete-group",o.UpdateGroup="update-group",o.QueryGroupMembers="query-group-members",o.AddGroupMembers="add-group-members",o.RemoveGroupMembers="remove-group-members",o.AddGroupChild="add-group-child",o.RemoveGroupChild="remove-group-child",o.ModifyRoleAcl="modify-role-acl",o.GetRole="get-role",o.SetPermission="set-permission",o.SetUsersInactive="disable",o.ConversationStarted="conversationstarted",o.ConversationUpdated="conversationupdated",o.ParticipantAdded="participantadded",o.ParticipantRemoved="participantremoved",o.ParticipantRoleChanged="participantrolechanged",o.ParticipantLeft="participantleft",o.ConversationEnded="conversationended",o.ParticipantReceived="participantreceipt",o.ParticipantAcknowledged="participantacked",o.User_ConversationStarted="user_conversationstarted",o.User_ConversationUpdated="user_conversationupdated",o.User_Added="user_added",o.User_Removed="user_removed",o.User_RoleChanged="user_rolechanged",o.User_Left="user_left",o.User_ConversationEnded="user_conversationended",o.User_DeleteDirectConversation="user_hid_conv",t.ChatMessageType=o},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),s=n(4),r=n(9),a=n(7),l=n(10);t.AddParticipantsHandler=class extends o.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.AddParticipants}createIq(e){return l.createIq("add",this.layer.config.xmpp.iq.namespace,{roomid:e.conversation.id,participants:{item:e.participants.map(e=>l.createIqNode({jid:e.jid,affiliation:e.role.toString()}))}})}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_ADDING_PARTICIPANTS_TITLE)),n=t.message||"E_ADDING_PARICIPANTS_ERROR",i=r.getErrorMessage(n,this.layer);return this.layer.error(e,i),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),s=n(4),r=n(9),a=n(7),l=n(10);t.ChangeParticipantRoleHandler=class extends o.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.ChangeParticipantRole}createIq(e){return l.createIq("changerole",this.layer.config.xmpp.iq.namespace,{roomid:e.conversation.id,participant:l.createIqNode({jid:e.participant.jid,affiliation:e.newRole.toString()})})}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_CHANGING_PARTICIPANT_ROLE_TITLE)),n=t.message||"E_CHANGING_PARTICIPANT_ROLE_ERROR",i=r.getErrorMessage(n,this.layer);return this.layer.error(e,i),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.CreateConversationHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.CreateConversation}createIq(e){const t=l.createIq("create",this.layer.config.xmpp.iq.namespace,{type:e.type.toString(),participants:{item:e.participants.map(e=>l.createIqNode({jid:e.jid,affiliation:e.role.toString()}))}});return e.config.behaviour.namedSettings&&(t.create.title=e.subject||"",t.create.description=e.description||""),e.priority&&(t.create.priority=e.priority),e.expiry_ttl&&(t.create.expiry_ttl=`${e.expiry_ttl}`),e.activity_ttl&&(t.create.activity_ttl=`${e.activity_ttl}`),e.config.behaviour.disableRePush&&(t.create.disable_repush=`${e.config.behaviour.disableRePush}`),t.create.reply_template=JSON.stringify(e.config),e.attachments&&e.attachments.length&&(t.create.attachments={attachment:e.attachments.map(e=>JSON.stringify(e))}),t}handleIqResponse(e,t){return i(this,void 0,void 0,function*(){if("created"in t){const e=t.created&&t.created.$attributes.id||null;return Object.assign({},t,{data:{newConversationId:e}})}if("exists"in t)return Object.assign({},t,{data:{exists:!0}})})}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_CREATING_CONVERSATION_TITLE)),n=t.message||"E_CREATING_CONVERSATION_ERROR",i=o.getErrorMessage(n,this.layer);return this.layer.error(e,i),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),s=n(4),r=n(9),a=n(7),l=n(10);t.EndConversationHandler=class extends o.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.EndConversation}createIq(e){return l.createIq("end",this.layer.config.xmpp.iq.namespace,{roomid:e.conversation.id})}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_ENDING_CONVERSATION_TITLE)),n=t.message||"E_ENDING_CONVERSATION_ERROR",i=r.getErrorMessage(n,this.layer);return this.layer.error(e,i),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(19),s=n(0),r=n(16),a=n(21),l=n(6),c=n(4),d=n(3),h=n(7),u=n(11),p=n(10),g=n(5);t.FetchConversationsHandler=class extends d.BaseChatHandler{constructor(){super(...arguments),this.messageKey=c.ChatMessageType.FetchConversations}createIq(e){const t=p.createIq("fetch",this.layer.config.xmpp.iq.namespace,{max:e.max.toString()});return e.timestamp&&(t.fetch.timestamp=e.timestamp.toString()),t}handleIqResponse(e,t){return i(this,void 0,void 0,function*(){this.layer.logger.log(o.LoggerTypes.Mam,`%c QUERYING SERVER FOR CONVERSATION UPDATES FOR USER: %c${this.layer.comms.username} (since ${e.timestamp})`,"color: #669; font-weight: bold;","color: #999; font-weight: normal;");const n=JSON.parse(t.data.fetch),i=(n.conversations||[]).map(e=>this._convertToConversation(e));if(i.length>0){this.layer.logger.log(o.LoggerTypes.Mam,`%c ${i.length} CONVERSATION(S) UPDATED`,"color: #669; font-weight: bold;",n.conversations);const c=(n.conversations||[]).reduce((e,t)=>(e.push(...t.messages.map(e=>e.xml)),e),[]),d=yield this.layer.processXmlStanzaStringsFromMam(c,!1),u=[],p={};for(const e of d){if(e.placeholder)continue;const t=yield r.convertToChatEntry(e,this.layer);p[t.id]=e.archive_id,null!==t&&u.push(t)}u.sort((e,t)=>t.date-e.date),this.layer.logger.log(o.LoggerTypes.Mam,`%c ${u.length} CHAT ENTRIES(S) RECEIVED`,"color: #669; font-weight: bold;",u);const g=new WeakMap;u.forEach(e=>{if(!e.to)return;const t=i.find(t=>t.roomJid===e.to);if(!t)return;const n=g.get(t)||[];n.push(e),g.set(t,n)});let m=!1;const f=t.data.delegate?t.data.delegate:this.layer.getCurrentUserJid(),_=!1;for(const t in i){const n=i[t],o=new a.ConversationConfigReader(this.layer,n),r=g.get(n);let l=!1;if(r&&r.length>0){const t=n.participants.find(e=>e.jid===f&&e.role===s.ChatRole.Participant);o.alert&&!1===o.participantAlertResponsesVisible&&t?n.preview=this._createBackupStartPreview(n):n.preview=r[0];const i=yield this.layer.getConversationById(n.id);i&&(n.hasUnread=i.hasUnread),r.forEach(t=>{p[t.id]>e.timestamp&&(l=!0,n.hasUnread=!0)})}else n.preview=this._createBackupStartPreview(n);o.alert?n.acknowledgements&&n.acknowledgements.find(e=>e.jid===f)||(yield this.layer.addToPendingAlerts(n),yield this.layer.priorityAlert(n,!0)):e.timestamp&&0!==e.timestamp&&l&&(m=!0)}if(m&&!1===_){const e=this.layer.translateI18nItem(h.ChatCommonMetadata.getI18nItem(h.ChatCommonI18nKeys.YOU_HAVE_NEW_NOTIFICATIONS));this.layer.emit(l.ChatEvents.ChatNotification,new l.ChatNotificationEventArgs(null,"",e,!1))}i.length>0&&this.layer.emit(l.ChatEvents.ConversationUpdated)}else this.layer.logger.log(o.LoggerTypes.Mam,"%c NO NEW UPDATES","color: #669; font-weight: bold;");return Object.assign({},t,{data:{conversations:i,delegate:t.data.delegate,lastIdentifier:parseInt(n.timestamp,10)}})})}_convertToConversation(e){const t=e.name,n=g.enumFromString(e.type),i=e.jid,o=e.participants,s=n===u.ConversationType.Named?e.title:null,a=n===u.ConversationType.Named?e.desc||"":null,l=e.started,c=e.receipts,d=e.responses,h=e.started_by,p=parseInt(e.hide_before)||0,m=e.reply_template,f=e.attachments,_=e.priority?this.layer.getConfiguredPriorityById(e.priority):null,v=e.expiry_ttl,y=e.activity_ttl;return r.createConversation(t,n,i,o,s,a,l,_?_.id:null,v,y,c,d,h,p,m,f)}_createBackupStartPreview(e){return{id:"fake",action:"start",type:s.ChatEntryType.Meta,instigator:e.instigator,date:e.createdTime,to:"fake"}}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),s=n(4),r=n(9),a=n(7),l=n(10);t.LeaveConversationHandler=class extends o.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.LeaveConversation}createIq(e){return l.createIq("leave",this.layer.config.xmpp.iq.namespace,{roomid:e.conversation.id})}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_LEAVING_CONVERSATION_TITLE)),n=t.message||"E_LEAVING_CONVERSATION_ERROR",i=r.getErrorMessage(n,this.layer);return this.layer.error(e,i),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),s=n(4),r=n(9),a=n(7),l=n(10);t.RemoveParticipantsHandler=class extends o.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.RemoveParticipants}createIq(e){return l.createIq("remove",this.layer.config.xmpp.iq.namespace,{roomid:e.conversation.id,participants:{item:e.participants.map(e=>l.createIqNode({jid:e.jid}))}})}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_REMOVING_PARTICIPANTS_TITLE)),n=t.message,i=r.getErrorMessage(n,this.layer);return this.layer.error(e,i),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),s=n(4),r=n(9),a=n(7),l=n(10);t.UpdateConversationHandler=class extends o.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.UpdateConversation}createIq(e){return l.createIq("update",this.layer.config.xmpp.iq.namespace,{roomid:e.conversation.id,title:e.newSubject,description:e.newDescription})}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_UPDATING_CONVERSATION_TITLE)),n=t.message,i=r.getErrorMessage(n,this.layer);return this.layer.error(e,i),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(14);t.PriorityConversationAcknowledgedEventArgs=class extends i.BaseEventArgs{constructor(e,t,n){super(),this.conversation=e,this.pendingCount=t,this.instigator=n}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(5),s=n(25),r=n(11),a=s.getSource("Media"),l=s.getSource("fileEncryption"),c=s.getSource("mediaproperties"),d=s.getSource("volumecontrol");var h;!function(e){e[e.MEDIA_NONE=0]="MEDIA_NONE",e[e.MEDIA_STARTING=1]="MEDIA_STARTING",e[e.MEDIA_RUNNING=2]="MEDIA_RUNNING",e[e.MEDIA_PAUSED=3]="MEDIA_PAUSED",e[e.MEDIA_STOPPED=4]="MEDIA_STOPPED",e[e.MEDIA_LOOPING_END=5]="MEDIA_LOOPING_END"}(h=t.MediaStatus||(t.MediaStatus={}));t.SimpleAudioPlayer=class{constructor(e){this._totalLoops=1,this._loopsRemaining=0,this._loopIndefinitely=!1,this._audioStream=r.VolumeStream.Notification,this._volumeToPlayAt=-1,this._notifiedReady=!1,this._failTimerWillRetry=!0,this.state=0,this._reportDuration=(()=>i(this,void 0,void 0,function*(){this._durationCallback&&this._durationCallback(yield this.duration())})),this._mediaStatusUpdate=(e=>{this._updateMediaState(e),e===h.MEDIA_STOPPED&&(!0!==this._forceStop?this._checkIfVolumeHasChanged(()=>this._loop()):(clearTimeout(this._delayTimer),this._resetVolume(()=>delete this._previousVolume)),clearTimeout(this._failTimer)),e===h.MEDIA_RUNNING&&clearTimeout(this._failTimer),e===h.MEDIA_STARTING&&(this._failTimer=setTimeout(()=>{this._failTimerWillRetry&&(this.play(),this._failTimerWillRetry=!1)},5e3))}),this._loop=(()=>{!this._forceStop&&this._loopIndefinitely?this._delayTimer=setTimeout(()=>{!this._forceStop&&this._media&&this.play()},2e3):(this._loopsRemaining--,this._loopsRemaining>0?this._delayTimer=setTimeout(()=>this._forceStop?null:this.play(),2e3):(this._resetVolume(()=>delete this._previousVolume),this._updateMediaState(h.MEDIA_LOOPING_END)))}),this._isMobile=o.isMobile(),this._volumeControl=d,e&&(this._callbackOnStateChange=e)}get src(){return this._bareSrc}_init(e){this._media&&(this._forceStop=!0,this.stop()),this._audioSrc=this._getAssetPath(e),this._isMobile?(this._notifiedReady=!1,this._media=new a(this._audioSrc,e=>{this._readyCallback&&!1===this._notifiedReady&&(this._notifiedReady=!0,this._readyCallback())},e=>{e.code&&1===e.code&&this._loadingFromAssets&&(this.setAudio("pager_responder_alert.m4a",this._totalLoops,this._volumeToPlayAt,this._audioStream),setTimeout(()=>this.play(),500))},this._mediaStatusUpdate),this._durationCallback&&(this._audioSrc.includes("encrypted")?l.getAudioFileDuration(e=>{this._duration=1e3*Math.ceil(e),this._reportDuration()},e=>{console.error("Media properties error:",e)},this._getAssetPath(this._audioSrc,!0)):c.getProperties(e=>{this._duration=1e3*Math.ceil(e.duration),this._reportDuration()},e=>{console.error("Media properties error:",e)},this._getAssetPath(this._audioSrc,!0)))):window.cti&&(this._audioElm=document.createElement("audio"),this._audioElm.setAttribute("preload","true"),this._audioElm.onloadeddata=(()=>i(this,void 0,void 0,function*(){yield this._reportDuration(),this._readyCallback&&!1===this._notifiedReady&&(this._notifiedReady=!0,this._readyCallback())})),this._audioElm.setAttribute("src",this._audioSrc),this._audioElm.onended=this._loop,this._audioElm.onplay=(()=>this._updateMediaState(h.MEDIA_RUNNING)),this._audioElm.onpause=(()=>this._updateMediaState(h.MEDIA_PAUSED)),this._audioElm.onended=(()=>this._updateMediaState(h.MEDIA_STOPPED)),this._media=this._audioElm)}_getAssetPath(e,t=!1){this._loadingFromAssets=!1;let n="";if(!0===t&&(n="file://"),e.includes("/")||e.includes("\\"))return e.includes("file://")?e:`${n}${e}`;{this._loadingFromAssets=!0;const t=window,n=t.cti?t.cti.store.schema.assetDir||"user-assets/":"";return t.cti?`${n}${e}`:e}}_updateMediaState(e){this.state=e,this._callbackOnStateChange&&this._callbackOnStateChange(this.state)}_getAndSetVolume(e){this._volumeControl.getDeviceVolume(t=>{void 0===this._previousVolume&&(this._previousVolume=parseFloat(t)),this._volumeControl.setDeviceVolume(()=>this._media.setStreamId(e,this._audioStream.toString()),()=>this.stop(),this._volumeToPlayAt/100,this._audioStream)},e=>this.stop(),this._audioStream)}_resetVolume(e=(()=>{})){-1!==this._volumeToPlayAt&&this._volumeControl&&this._previousVolume&&this._volumeControl.setDeviceVolume(e,()=>{},this._previousVolume,this._audioStream)}_checkIfVolumeHasChanged(e=(()=>{})){-1!==this._volumeToPlayAt&&this._volumeControl?this._volumeControl.getDeviceVolume(t=>{const n=parseFloat(t);Math.ceil(100*n)!==this._volumeToPlayAt?this._volumeControl.setDeviceVolume(e,()=>this.stop(),this._volumeToPlayAt/100,this._audioStream):e()},e,this._audioStream):e()}setAudio(e,t=1,n=-1,i=r.VolumeStream.Notification,o,s){this._bareSrc=e,this._durationCallback=o,this._readyCallback=s,this._init(e),this._totalLoops=t,this._loopsRemaining=this._totalLoops,this._loopIndefinitely=0===this._loopsRemaining,this._volumeToPlayAt=n,this._audioStream=i,this._updateMediaState(h.MEDIA_NONE)}play(){this._forceStop=!1,this._audioSrc&&this._media&&(-1!==this._volumeToPlayAt&&this._volumeControl?this._getAndSetVolume(()=>this._media.play()):this._media.setStreamId?this._media.setStreamId(()=>this._media.play(),this._audioStream.toString()):setTimeout(()=>this._media.play(),100))}stop(e=!1,t=!1){this._audioSrc&&this._media&&(this._forceStop=e,this._updateMediaState(h.MEDIA_STOPPED),this._media.stop?this._media.stop():(this._media.pause(),this._audioElm.currentTime=0),t||(this._loopsRemaining=this._totalLoops))}pause(){this._audioSrc&&this._media&&(this._updateMediaState(h.MEDIA_PAUSED),this._media.pause())}duration(){return i(this,void 0,void 0,function*(){if(this._audioSrc){if(o.isMobile())return this._duration;if(this._audioElm.duration===1/0){for(;this._audioElm.duration===1/0;)yield new Promise(e=>setTimeout(e,100)),this._audioElm.currentTime=1e7*Math.random();return 1e3*this._audioElm.duration}return 1e3*this._audioElm.duration}return 0})}release(){this._media&&this._media.release&&this._media.release()}reset(){clearTimeout(this._delayTimer),delete this._delayTimer,this._audioSrc="",this._audioElm=null,this._media=null,this._duration=0,this.state=h.MEDIA_NONE,this._totalLoops=1,this._loopsRemaining=0,this._loopIndefinitely=!1,this._audioStream=r.VolumeStream.Notification,this._previousVolume=null,this._volumeToPlayAt=-1,this._forceStop=null}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(14),a=n(17),l=n(0),c=n(12),d=n(18),h=n(6),u=n(8),p=n(37);var g;!function(e){e[e.ADD_CONTACTS="Add Contacts"]="ADD_CONTACTS",e[e.CHOOSE_CONTACT="Choose contacts to add to conversation"]="CHOOSE_CONTACT",e[e.TOTAL_CONTACTS="Total {{number}} Contacts in Conversation"]="TOTAL_CONTACTS",e[e.TOTAL_CONTACTS_MAX="Total {{number}} Contacts in Conversation (out of {{maximum}})"]="TOTAL_CONTACTS_MAX",e[e.SEARCH_PLACEHOLDER="Find Contacts"]="SEARCH_PLACEHOLDER",e[e.INITIAL_MESSAGE="Find your contacts using the search bar above"]="INITIAL_MESSAGE",e[e.ADD="Add"]="ADD",e[e.EXISTING_CONVERSATION_PARTICIPANTS_COUNT="Add up to {maxConvPartAddCount} at once. Currently {selectedParticipantCount} selected. Total of {totalSelectionCount} / {maximumAllowedCount}"]="EXISTING_CONVERSATION_PARTICIPANTS_COUNT"}(g||(g={}));class m{static _create(){return new a.Metadata(f,g)}static get instance(){return this._instance||(this._instance=this._create())}}m._instance=null,t.CTCLAddConversationContactsMetadata=m;class f extends c.CTCLComponent{constructor(){super(),this._currentSelectionIncludingGroupParticipants=0,this._maxParticipantsToAddAtOnce=0,this._isExistingConversation=!1,this.setMetadata(m.instance)}static get is(){return"ct-cl-add-conversation-contacts"}initialize(){return o(this,void 0,void 0,function*(){if(this.conversation=yield this.layer.getCurrentConversation(),!this.conversation)return this._back();this._isExistingConversation=!!this.conversation.participants.length,this._isExistingConversation&&(this._maxParticipantsToAddAtOnce=this.layer.getExisitingConversationMaxParticipantsCount()),this.usersAdditionOccuring=!1,this.layer.setBackHandler(()=>{this._back()})})}setupListeners(){this.setupConnectionStatusListener(),this.addListener(h.ChatEvents.ConversationParticipantsChanged,e=>{this.conversation&&this.conversation.id===e.conversation.id&&(this.conversation.participants=e.conversation.participants,this.forceRedraw())}),this.addListener(r.BaseEvents.ConnectionStatusChange,e=>{e.status===l.ConnectionStatus.Disconnected&&this.usersAdditionOccuring&&(this.dismissWaitingMessage(),this._back())},{dontSuppress:!0})}get generateComponentStyles(){return n(316)}generateComponentMarkup(){const e=this.conversation.participants.map(e=>e.jid.toLowerCase()),t=this.layer.config.behaviour.maxConversationParticipants,n={excludeUsers:e,excludeGroupsWithHash:!0,allowSearch:this.allowSearch,requireSearch:this.requireSearch,searchPlaceholder:this.translateI18nItem(g.SEARCH_PLACEHOLDER),initialMessage:this.translateI18nItem(g.INITIAL_MESSAGE),allowSelection:!0,maxSelections:t-e.length,disableSelection:this._disableContactSelection(),onChangeSelection:(e,t)=>{this._isExistingConversation&&(this._currentSelectionIncludingGroupParticipants=t),this.selectedParticipantCount=e.length},onClickUser:e=>{this.layer.showContactInfo(e,null,!1)},onClickGroup:e=>this.layer.showRoleUsersModal(e),onGroupSelectionShowError:e=>{const t=this.layer.config.behaviour.maxConversationParticipantsExisting,n=!!t,i=this.layer.config.behaviour.maxConversationParticipants;return e+(this.conversation.participants.length-1)>i-1||this._isExistingConversation&&n&&e>t||e>i}};return window.__CTRender("div",{class:"contact-list"},this._renderHeader(),window.__CTRender("div",{class:"user-list"},window.__CTRender(p.CTUserList,Object.assign({id:"user-list"},n))),this._renderFooter())}_generateHeaderParticipantsCount(){const e=this.conversation.participants.length-1+this._currentSelectionIncludingGroupParticipants||0,t=this.layer.config.behaviour.maxConversationParticipants-1;return this.translateI18nItem(g.EXISTING_CONVERSATION_PARTICIPANTS_COUNT).replace("{maxConvPartAddCount}",this._maxParticipantsToAddAtOnce.toString()).replace("{selectedParticipantCount}",this._currentSelectionIncludingGroupParticipants&&this._currentSelectionIncludingGroupParticipants.toString()).replace("{totalSelectionCount}",e.toString()).replace("{maximumAllowedCount}",t.toString())}_disableContactSelection(){const e=this.conversation.participants.length,t=this.layer.config.behaviour.maxConversationParticipants,n=this.layer.getExisitingConversationMaxParticipantsCount();return this._currentSelectionIncludingGroupParticipants>=n||e-1==t-1||e+this._currentSelectionIncludingGroupParticipants-1==t-1}_renderHeader(){const e=this.layer.config.behaviour.maxConversationParticipants||0,t=0===e?this.translateI18nItem(g.TOTAL_CONTACTS):this.translateI18nItem(g.TOTAL_CONTACTS_MAX),n=this.conversation.participants.length-1+this.selectedParticipantCount,i=null!==this.showCountFrom&&n>=this.showCountFrom?t.replace("{{number}}",n.toString()).replace("{{maximum}}",(e-1).toString()):this.translateI18nItem(g.CHOOSE_CONTACT),o=this._isExistingConversation?this._generateHeaderParticipantsCount():i;return window.__CTRender(d.CTCLHeader,{class:"header"},window.__CTRender("div",{slot:"left-action"},window.__CTRender(u.CTIcon,{class:"action",width:"20",height:"20",icon:l.Icons.COMMON.ChevronLeft,onClick:this._back.bind(this)})),window.__CTRender("div",{slot:"heading"},this.translateI18nItem(g.ADD_CONTACTS)),window.__CTRender("div",{slot:"sub-heading"},o))}_renderFooter(){return window.__CTRender("div",{class:"footer"},window.__CTRender(u.CTButton,{type:"primary",class:"button",disabled:!this.isOnline||0===this.selectedParticipantCount,onClick:this._add.bind(this)},this.translateI18nItem(g.ADD)))}_back(){return o(this,void 0,void 0,function*(){yield this._clearSelectedUsers(),this.emitComponentEvent("go-back"),this.layer.popBackHandler()})}_add(){return o(this,void 0,void 0,function*(){this.usersAdditionOccuring=!0;const e=yield this._getSelectedUsers(),t=new Map;for(const i of e)i.isGroup?i.groupUsers.map(e=>t.set(e.jid.toLowerCase(),i)):t.set(i.transformToBaseUser().jid.toLowerCase(),i);const n=Array.from(t.keys()).map(e=>({jid:e,role:l.ChatRole.Participant}));(yield this.layer.addParticipantsToConversation(this.conversation,n))&&this._back()})}_getSelectedUsers(){return o(this,void 0,void 0,function*(){const e=this.shadowRoot.querySelector("#user-list");return e?yield e.getSelections():[]})}_clearSelectedUsers(){return o(this,void 0,void 0,function*(){const e=this.shadowRoot.querySelector("#user-list");e&&(yield e.clearSelections())})}}i([s.prop({type:s.Stroolean,attribute:!0,default:!0})],f.prototype,"allowSearch",void 0),i([s.prop({type:s.Stroolean,attribute:!0,default:!1})],f.prototype,"requireSearch",void 0),i([s.prop({type:s.NullableNumber,attribute:!0,default:null})],f.prototype,"showCountFrom",void 0),i([s.prop({type:Object,attribute:!1,default:null})],f.prototype,"conversation",void 0),i([s.prop({type:Number,attribute:!1,default:0})],f.prototype,"selectedParticipantCount",void 0),i([s.prop({type:Object,attribute:!1,default:!1})],f.prototype,"usersAdditionOccuring",void 0),t.CTCLAddConversationContacts=f,f.register()},function(e,t,n){"use strict";t.__esModule=!0,t.stateify=t.TokenState=t.CharacterState=void 0;var i=n(39);var o=function(e){this.j=[],this.T=e||null};o.prototype={defaultTransition:!1,on:function(e,t){if(e instanceof Array){for(var n=0;n<e.length;n++)this.j.push([e[n],t]);return this}return this.j.push([e,t]),this},next:function(e){for(var t=0;t<this.j.length;t++){var n=this.j[t],i=n[0],o=n[1];if(this.test(e,i))return o}return this.defaultTransition},accepts:function(){return!!this.T},test:function(e,t){return e===t},emit:function(){return this.T}};var s=(0,i.inherits)(o,function(e){this.j=[],this.T=e||null},{test:function(e,t){return e===t||t instanceof RegExp&&t.test(e)}}),r=(0,i.inherits)(o,function(e){this.j=[],this.T=e||null},{jump:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.next(new e(""));return n===this.defaultTransition?(n=new this.constructor(t),this.on(e,n)):t&&(n.T=t),n},test:function(e,t){return e instanceof t}});t.CharacterState=s,t.TokenState=r,t.stateify=function(e,t,n,i){for(var o=0,r=e.length,a=t,l=[],c=void 0;o<r&&(c=a.next(e[o]));)a=c,o++;if(o>=r)return[];for(;o<r-1;)c=new s(i),l.push(c),a.on(e[o],c),a=c,o++;return c=new s(n),l.push(c),a.on(e[r-1],c),l}},function(e,t,n){"use strict";t.__esModule=!0,t.createTokenClass=function(){return function(e){e&&(this.v=e)}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(0),a=n(8),l=n(13);class c extends s.CTLayerComponent{constructor(){super(...arguments),this._rippleTimeout=null}static get is(){return"ct-button"}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return n(259)}generateComponentMarkup(){const e=[this.type];this.selected&&e.push("selected"),this.large&&e.push("large"),this.isWaiting&&e.push("waiting"),this.isTransparent&&e.push("transparent");const t=r.Icons.COMMON.LoadingSpinner,n=l.buildStyles();return this.width&&(n.width=this.width),this.textColor&&(n.color=this.textColor),this.autoFocus&&this._autoFocus(),window.__CTRender("button",{class:e.join(" "),style:n,disabled:this.isWaiting||this.disabled,onClick:e=>this.handleButtonClick(e)},window.__CTRender("div",{class:"button-content"},l.renderIf(!this.isWaiting&&!!this.icon&&!this.iconRight,window.__CTRender(a.CTIcon,{icon:this.icon,color:this.iconColor,width:this.iconWidth,height:this.iconHeight,margin:this.iconMargin,class:"icon"})),l.renderIfElse(this.isWaiting,window.__CTRender(a.CTIcon,{icon:t,color:this.iconColor,width:this.iconHeight,height:this.iconHeight,spin:!0,class:"icon"}),window.__CTRender("div",{class:"label"},window.__CTRender("slot",null))),l.renderIf(!this.isWaiting&&!!this.icon&&this.iconRight,window.__CTRender(a.CTIcon,{icon:this.icon,color:this.iconColor,width:this.iconWidth,height:this.iconHeight,margin:this.iconMargin,class:"icon righticon"}))))}handleButtonClick(e){if(!this.disabled&&(this._ripple(e.offsetX,e.offsetY,e.target),"function"==typeof this.onClick)){e.stopPropagation();const t=Object.create(e,{target:{value:this}});this.onClick(t)}}_ripple(e,t,n){const i=n.querySelector(".ripple");i&&i.remove();const o=n.clientWidth,s=n.clientHeight,r=Math.max(o,s),a=e-r/2,l=t-r/2;clearTimeout(this._rippleTimeout),this._rippleTimeout=setTimeout(()=>{const e=document.createElement("span");e.classList.add("ripple"),e.style.width=`${r}px`,e.style.height=`${r}px`,e.style.left=`${a}px`,e.style.top=`${l}px`,n.insertBefore(e,n.firstChild),e.addEventListener("animationend",()=>{e.remove()}),e.classList.add("animate")},0)}_autoFocus(){setTimeout(()=>{const e=this.shadowRoot.querySelector("button.primary");e&&e.focus()})}}i([s.prop({type:String,attribute:!0,default:"primary"})],c.prototype,"type",void 0),i([s.prop({type:s.Stroolean,attribute:!0,default:!1})],c.prototype,"selected",void 0),i([s.prop({type:s.Stroolean,attribute:!0,default:!1})],c.prototype,"disabled",void 0),i([s.prop({type:String,attribute:!0,default:null})],c.prototype,"width",void 0),i([s.prop({type:s.Stroolean,attribute:!0,default:!1})],c.prototype,"large",void 0),i([s.prop({type:String,attribute:!0})],c.prototype,"textColor",void 0),i([s.prop({type:String,attribute:!0,default:"auto"})],c.prototype,"iconColor",void 0),i([s.prop({type:String,attribute:!0,default:"18px"})],c.prototype,"iconWidth",void 0),i([s.prop({type:String,attribute:!0,default:"18px"})],c.prototype,"iconHeight",void 0),i([s.prop({type:String,attribute:!0,default:"0 0 0 0"})],c.prototype,"iconMargin",void 0),i([s.prop({type:s.Stroolean,attribute:!0,default:!1})],c.prototype,"iconRight",void 0),i([s.prop({type:Function,attribute:!0})],c.prototype,"onClick",void 0),i([s.prop({type:s.Stroolean,attribute:!0,default:!1})],c.prototype,"isTransparent",void 0),i([s.prop({type:Object,attribute:!1,default:null})],c.prototype,"icon",void 0),i([s.prop({type:s.Stroolean,attribute:!1,default:!1})],c.prototype,"isWaiting",void 0),i([s.prop({type:s.Stroolean,attribute:!1,default:!1})],c.prototype,"autoFocus",void 0),t.CTButton=c,c.register()},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(8),a=n(5),l=n(13),c=n(26),d=n(36);class h extends s.CTLayerComponent{static get is(){return"ct-user-tile"}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return n(299)}_onAvatarClick(e){"function"==typeof this.avatarClickedCallback&&this.avatarClickedCallback(e)}generateComponentMarkup(){if(!this.user)return;const e=["group"];this.user.group||e.push("empty");const t=["job-title"];this.user.jobTitle||t.push("empty");const n=["name"];return this.showGroups||this.showJobTitle||n.push("no-margin"),window.__CTRender(r.CTAvatarTile,{height:this.height,showAvatar:this.showAvatar,detailStyle:this.detailStyle,avatarStyle:this.avatarStyle,border:this.border},this.showAvatar&&this.user.is_role&&window.__CTRender(d.CTRoleAvatar,{slot:"avatar",size:40,user:this.user,onClick:this._onAvatarClick.bind(this)}),this.showAvatar&&!this.user.is_role&&window.__CTRender(r.CTUserAvatar,{slot:"avatar",size:40,user:this.user,onClick:this._onAvatarClick.bind(this)}),window.__CTRender("div",{class:n.join(" ")},a.formatUserName(this.user,this.nameFormat)),this.showJobTitle&&window.__CTRender("div",{class:t.join(" ")},this.user.jobTitle||this.user.is_role&&"Role"||"No Job Title"),this.showGroups&&window.__CTRender("div",{class:e.join(" ")},l.filterUserGroup(this.user.group)||`No ${c.groupsLabel}`),window.__CTRender("slot",{name:"additional"}))}}i([s.prop({type:s.Stroolean,attribute:!1,default:!0})],h.prototype,"showAvatar",void 0),i([s.prop({type:s.Stroolean,attribute:!1,default:!0})],h.prototype,"border",void 0),i([s.prop({type:Object,attribute:!1})],h.prototype,"user",void 0),i([s.prop({type:Object,attribute:!1,default:a.NameFormat.PREFIX_FIRST_LAST})],h.prototype,"nameFormat",void 0),i([s.prop({type:String,attribute:!1,default:null})],h.prototype,"height",void 0),i([s.prop({type:Object,attribute:!1,default:{}})],h.prototype,"detailStyle",void 0),i([s.prop({type:Object,attribute:!1,default:{}})],h.prototype,"avatarStyle",void 0),i([s.prop({type:Boolean,attribute:!0,default:!0})],h.prototype,"showJobTitle",void 0),i([s.prop({type:Boolean,attribute:!0,default:!0})],h.prototype,"showGroups",void 0),i([s.prop({type:Function,attribute:!1,default:!1})],h.prototype,"avatarClickedCallback",void 0),t.CTUserTile=h,h.register()},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(33),a=n(17),l=n(0),c=n(12),d=n(16),h=n(18),u=n(86),p=n(50),g=n(53),m=n(21),f=n(35),_=n(6),v=n(11),y=n(8),C=n(20),w=n(30),b=n(13),E=n(5),T=n(333),R=n(7),I=n(9),A=n(55),S=n(24),x=n(14),O=n(19),M={once:!0};var L;!function(e){e[e.DIRECT_CONVERSATION="Direct Conversation"]="DIRECT_CONVERSATION",e[e.NAMED_CONVERSATION="Named Conversation"]="NAMED_CONVERSATION",e[e.SELF_CONVERSATION="Conversation with self"]="SELF_CONVERSATION",e[e.CONTACTS_IN_CONVERSATION="{{number}} contact(s) in this conversation"]="CONTACTS_IN_CONVERSATION",e[e.INFO="Info"]="INFO",e[e.EDIT_INFO="Edit Info"]="EDIT_INFO",e[e.LEAVE="Leave"]="LEAVE",e[e.COMFIRM_LEAVE="Are you sure you wish to leave this conversation?"]="COMFIRM_LEAVE",e[e.END="End"]="END",e[e.COMFIRM_END="Are you sure you wish to end this conversation?"]="COMFIRM_END",e[e.DELETE="Delete"]="DELETE",e[e.DELETE_CONFIRM="Are you sure you wish to delete this conversation? This will remove all messages from your device."]="DELETE_CONFIRM",e[e.RESPONSES="View Responses"]="RESPONSES",e[e.PROVISIONAL_MESSAGE="This conversation will be created when you send your first message"]="PROVISIONAL_MESSAGE",e[e.SCROLL_TO_TOP_FOR_MORE="Scroll to top to fetch more"]="SCROLL_TO_TOP_FOR_MORE",e[e.AT_START="At start of conversation"]="AT_START",e[e.LOADING_IMAGE="loading image..."]="LOADING_IMAGE",e[e.IMAGE_REFETCH="Download image"]="IMAGE_REFETCH",e[e.IMAGE_ERROR="Image unable to download, press to retry"]="IMAGE_ERROR",e[e.MESSAGE_PLACEHOLDER="Message"]="MESSAGE_PLACEHOLDER",e[e.CONFIRM_REPLACE_IMAGE="You have already selected an image to attach. Do you want to replace this with a different image?"]="CONFIRM_REPLACE_IMAGE",e[e.SEND_ERROR="Unable to send message"]="SEND_ERROR",e[e.FETCH_ERROR_NOT_ONLINE="Unable to fetch messages whilst offline"]="FETCH_ERROR_NOT_ONLINE"}(L||(L={}));class N{static _create(){return new a.Metadata(D,L)}static get instance(){return this._instance||(this._instance=this._create())}}N._instance=null,t.CTCLChatMessageListMetadata=N;class D extends c.CTCLComponent{constructor(){super(),this._isInitialising=!1,this._chatListScrollable=null,this._chatListFetchMore=null,this._chatScrollToBottom=null,this._messageTextbox=null,this._isInitialFetch=!0,this._rawChatEntries=[],this._processedChatEntries=[],this._batchSize=null,this._visibleChatEntryBlockSize=null,this._startIdx=null,this._endIdx=null,this._supportsOverscroll=!1,this._suppressScrollHandler=!1,this._newNotificationsCount=0,this._draft=null,this._saveDraftTimeout=null,this._pendingConversationId=null,this._pendingDraft=null,this._maxMessageLength=null,this._description=null,this._priorityDescriptionExpanded=!0,this._deferredEvents=[],this._cameraClickCount=0,this._debounceChatEntryReceivedUpdateConversation=null,this._onForeground=(()=>{this.isOnline&&this.visibleChatEntries.forEach(e=>this.layer.markChatEntryRead(e)),document.removeEventListener("pause",this._onBackground),document.addEventListener("pause",this._onBackground,M),this.conversation.hasUnread=!1,this.layer.updateConversation(this.conversation),"ios"===S.getPlatformName()&&w.setApplicationIconBadgeNumber(this.layer.getTotalUnreadCount())}),this._onBackground=(()=>{document.removeEventListener("resume",this._onForeground),document.addEventListener("resume",this._onForeground,M)}),this._onScroll=(()=>{if(this._suppressScrollHandler)return;const e=this._chatListScrollable.scrollTop,t=this._chatListScrollable.scrollHeight-this._chatListScrollable.clientHeight;e<=0?(this._suppressScrollHandler=!0,this._stopScroll(0).then(()=>this._handleScrollAtTop())):Math.ceil(e)>=t&&(this._suppressScrollHandler=!0,this._stopScroll(t).then(()=>this._handleScrollAtBottom()))}),this._viewInfo=(()=>o(this,void 0,void 0,function*(){yield this._saveDraft();const e=this.conversation.type===v.ConversationType.Direct;if(e&&1===this.conversation.participants.length){const e=this.layer.getCurrentUser();this.layer.showContactInfo(e,this.conversation,!1)}else if(e&&2===this.conversation.participants.length){const e=this.layer.getWorkspaceJid(),t=this.conversation.participants.find(t=>!E.jidsMatch(t.jid,e)),n=this._userLookup.get(t.jid);this.layer.showContactInfo(n,this.conversation,!1)}else this.emitComponentEvent("go-info")})),this._deleteDirect=(()=>o(this,void 0,void 0,function*(){if(yield this.requestConfirmation(this.translateI18nItem(L.DELETE_CONFIRM))){const e=this._rawChatEntries[this._rawChatEntries.length-1];yield this.layer.markDirectConversationAsDeleted(this.conversation,e?e.date:0)}})),this._openResponses=(()=>o(this,void 0,void 0,function*(){yield this.layer.showResponsesModal(this.conversation)})),this.setMetadata(N.instance)}static get is(){return"ct-cl-chat-message-list"}initialize(e){const t=e=>super[e];return o(this,void 0,void 0,function*(){return yield t("initialize").call(this,e),this._isInitialising=!0,this._userLookup=new f.UserLookup(this.layer),this._batchSize=this.layer.config.behaviour&&this.layer.config.behaviour.chatEntriesFetchBatchSize||null,this._visibleChatEntryBlockSize=this._batchSize||10,this._maxMessageLength=this.layer.config.behaviour&&this.layer.config.behaviour.maxMessageLength||5e3,this._detectOverscrollSupport(),this.conversation=yield this.layer.getCurrentConversation(),this.conversation?this.conversation.isClosed?this._back():(this._config=new m.ConversationConfigReader(this.layer,this.conversation),this._draft=this.conversation.draft||null,this._updateSendButton(),this.onRenderComplete(()=>this._getDomNodes()),this.onRenderComplete(()=>this._multilineEllipsis(!1),!0),this.onRenderComplete(()=>this._setupScrollWatcher(),!0),this.onRenderComplete(()=>this._calcLongDescription(),!0),this.isFetchingMore=!0,this.defer(()=>o(this,void 0,void 0,function*(){yield this._refreshUserLookup(),this.forceRedraw(),this.defer(()=>o(this,void 0,void 0,function*(){this.layer.isConversationBeingPurged(this.conversation.id)||(yield this._fetchMoreChatEntries(!0)),this.defer(()=>{this._isInitialising=!1,this._deferredEvents.forEach(e=>this.emitEvent(e.eventType,e.data))})}))})),this._autoFocusMessageTextboxOnDesktop(),void this.layer.setBackHandler(()=>{this._back()})):this._back()})}setupListeners(){this.addListener(_.ChatEvents.ConversationPurged,e=>o(this,void 0,void 0,function*(){e.conversation.id===this.conversation.id&&this._fetchMoreChatEntries()})),this.addListener(_.ChatEvents.AutoReconnected,({resumed:e})=>o(this,void 0,void 0,function*(){if(this._isInitialising)return void this._deferredEvents.push({eventType:_.ChatEvents.AutoReconnected,data:{resumed:e}});this._isInitialising=!0,yield this._resetForConversationChange(),yield this._fetchMoreChatEntries(!0),this._suppressScrollHandler=!1;const t=yield this.layer.getCurrentConversation();t&&t.id===this.conversation.id&&(this.conversation.preview=this._processedChatEntries[this._processedChatEntries.length-1],this.conversation.hasUnread=!1,yield this.layer.updateConversation(this.conversation)),this.isOnline&&this.visibleChatEntries.forEach(e=>this.layer.markChatEntryRead(e)),this._removeDeferredEvent(_.ChatEvents.AutoReconnected),this.defer(()=>{this._isInitialising=!1,this._deferredEvents.forEach(e=>this.emitEvent(e.eventType,e.data))})}),{dontSuppress:!0}),this.setupConnectionStatusListener(),this.addListener(_.ChatEvents.ConversationAdded,e=>o(this,void 0,void 0,function*(){if(this._pendingConversationId&&this._pendingConversationId===e.conversation.id){const t=E.deepCloneObject(e.conversation);this._draft=this._pendingDraft,this._pendingDraft=null,yield this.layer.setCurrentConversation(t)}})),this.addListener(_.ChatEvents.ConversationParticipantsChanged,e=>o(this,void 0,void 0,function*(){this.conversation&&this.conversation.id===e.conversation.id&&(this.conversation.participants=e.participants,yield this._refreshUserLookup(),this.forceRedraw())})),this.addListener(_.ChatEvents.ChatEntryReceived,e=>o(this,void 0,void 0,function*(){if(this._isInitialising)this._deferredEvents.push({eventType:_.ChatEvents.ChatEntryReceived,data:e});else{if(yield this.layer.belongsToCurrentConversation(e.chatEntry)){yield this._appendChatEntry(e.chatEntry),this.conversation=yield this.layer.getCurrentConversation(),(yield w.isAppInForeground())&&(this.conversation.hasUnread=!1);const t={};e.chatEntry.date>this.conversation.preview.date&&(this.conversation.preview=e.chatEntry,t.preview=e.chatEntry),this._debounceChatEntryReceivedUpdateConversation&&(clearTimeout(this._debounceChatEntryReceivedUpdateConversation),this._debounceChatEntryReceivedUpdateConversation=null),this._debounceChatEntryReceivedUpdateConversation=setTimeout(()=>o(this,void 0,void 0,function*(){yield this.layer.updateConversation(this.conversation,t),"ios"===S.getPlatformName()&&w.setApplicationIconBadgeNumber(this.layer.getTotalUnreadCount())}),500),this.isOnline&&(yield this.layer.markChatEntryRead(e.chatEntry))}this._removeDeferredEvent(_.ChatEvents.ChatEntryReceived)}})),this.addListener(_.ChatEvents.ChatEntryUpdated,e=>o(this,void 0,void 0,function*(){this._isInitialising?this._deferredEvents.push({eventType:_.ChatEvents.ChatEntryUpdated,data:e}):(yield this.layer.belongsToCurrentConversation(e.chatEntry))&&e.chatEntry.type===l.ChatEntryType.Chat&&(setTimeout(()=>{this._updateChatEntry(e.chatEntry)},1e3),this._removeDeferredEvent(_.ChatEvents.ChatEntryUpdated))})),this.addListener(_.ChatEvents.CurrentConversationChanged,()=>o(this,void 0,void 0,function*(){this._resetForConversationChange(),this.conversation=yield this.layer.getCurrentConversation(),this.conversation&&(yield this._refreshUserLookup(),this.isFetchingMore=!0,this.defer(()=>o(this,void 0,void 0,function*(){yield this._fetchMoreChatEntries(),this._pendingConversationId&&this._pendingConversationId===this.conversation.id&&(this._pendingConversationId=null,(this._draft||this.media&&this.media.length)&&(this.sending=!1,this._sendMessage()))})))})),this.addListener(_.ChatEvents.ConversationDeleted,()=>{this._clearDraft(),this.emitComponentEvent("go-end")}),this.addListener(_.ChatEvents.ThumbnailLoaded,e=>{const t=this._processedChatEntries.findIndex(t=>t.id===e.id);t>-1&&this._processedChatEntries.length-t<5&&setTimeout(()=>this._scrollToBottom(!1),500)}),this.addListener(_.ChatEvents.ConversationClosed,()=>o(this,void 0,void 0,function*(){try{const e=yield this.layer.getCurrentConversation();setTimeout(()=>{!!(window&&window.location&&window.location.href.toLowerCase().endsWith("/chat"))&&e&&e.isClosed&&this.emitComponentEvent("go-leave")})}catch(e){this.layer.logger.log(O.LoggerTypes.Other," An error has occurred during ChatEvents.ConversationClosed listener",e.message)}}),{onceOnly:!0}),document.removeEventListener("pause",this._onBackground),document.addEventListener("pause",this._onBackground,M)}_removeDeferredEvent(e){const t=this._deferredEvents.findIndex(t=>t.eventType===e);t>-1&&this._deferredEvents.splice(t,1)}disconnectedCallback(){super.disconnectedCallback(),this._removeMedia(!0),document.removeEventListener("resume",this._onForeground),document.removeEventListener("pause",this._onBackground)}get generateComponentStyles(){return n(334)}generateComponentMarkup(){const e=this.conversation.participants.find(e=>E.jidsMatch(e.jid,this.layer.getWorkspaceJid()));return e?![l.ChatRole.Owner].includes(e.role)&&this._config.usePagerUI?window.__CTRender("div",{class:"chat-message-list"},this._renderHeader(),this._renderPagerUI()):window.__CTRender("div",{class:"chat-message-list"},this._renderHeader(),window.__CTRender("div",{class:"chat-message-list desktop"},(this.conversation.attachments&&this.conversation.attachments.length||this.conversation.description)&&this._renderPriorityDescription(),this._config.chatAvailable?this._renderChatEntries():window.__CTRender(g.CTCLResponseView,{conversation:this.conversation})),this._config.chatAvailable&&this._renderScrollToBottom(),this._renderFooter()):null}_isConversationAnAlert(){return this.layer.isConversationAnAlert(this.conversation)}_renderHeader(){let e="",t=this._config.descriptionAtTop;const n=this._isConversationAnAlert();if(this._config.namedSettings)e=this.conversation.subject,n||(t=this._config.name);else if(1===this.conversation.participants.length){const n=this.layer.getCurrentUser();e=E.formatUserName(n,E.NameFormat.PREFIX_FIRST_LAST),t=this.translateI18nItem(L.SELF_CONVERSATION)}else if(2===this.conversation.participants.length){const n=this.layer.getWorkspaceJid(),i=this.conversation.participants.find(e=>!E.jidsMatch(e.jid,n)),o=this._userLookup.get(i.jid);e=E.formatUserName(o,E.NameFormat.PREFIX_FIRST_LAST)||" ",t=this.translateI18nItem(L.DIRECT_CONVERSATION)}else this.conversation.participants.length>2&&(e=this.translateI18nItem(L.DIRECT_CONVERSATION),t=this.translateI18nItem(L.CONTACTS_IN_CONVERSATION).replace("{{number}}",(this.conversation.participants.length-1).toString()));const i=this.conversation.isProvisional||this.conversation.hideBefore?l.Icons.COMMON.CircleCross:l.Icons.COMMON.ChevronLeft,o={};this.isOnline&&n&&(o["background-color"]=this._config.colorCode);const{createdTime:s,expiryTTL:r,priority:a}=this.conversation,c={createdTime:s,expiryTTL:r,priority:a,expiredAt:d.getConversationExpiryTime(this.conversation),isConversationExpired:d.isExpiredConversation(this.conversation)};return window.__CTRender(h.CTCLHeader,Object.assign({class:"header"},o),window.__CTRender("div",{slot:"left-action"},window.__CTRender(y.CTIcon,{class:"action",width:"20",height:"20",icon:i,onClick:this._back.bind(this)})),window.__CTRender("div",{slot:"heading"},window.__CTRender("span",{class:"action"},window.__CTRender("span",{class:"title"},this.renderHtml(b.formatText(e),"message_list_heading")))),this.isOnline&&n&&window.__CTRender(A.CTCLAlertStatus,{class:"alert-status-component",slot:"alert-status",config:c,callback:()=>{this.layer.emit(x.BaseEvents._Request_RedrawAllUIs)}}),window.__CTRender("div",{slot:"sub-heading"},t),window.__CTRender("div",{slot:"right-action"},this._renderRightAction()))}_renderRightAction(){return this.conversation.type===v.ConversationType.Direct?this._renderInfo():this._renderMenu()}_renderInfo(){if(1===this.conversation.participants.length)return null;const e=[new y.MenuItem(this.translateI18nItem(L.INFO),this._viewInfo)];return this.conversation.hideBefore?window.__CTRender(y.CTMenu,{menuItems:e}):(this.conversation.isProvisional&&0!==this.conversation.hideBefore||!this._config.participantCanDelete||e.push(new y.MenuItem(this.translateI18nItem(L.DELETE),this._deleteDirect)),e.length>0?window.__CTRender(y.CTMenu,{menuItems:e}):null)}_renderMenu(){const e=this.layer.getWorkspaceJid(),t=this.conversation.participants.find(t=>E.jidsMatch(t.jid,e));if(!t)return null;const n=[l.ChatRole.Owner].includes(t.role)&&this._config.ownerCanEditAfterSend,i=this._config.participantCanLeave,o=[l.ChatRole.Owner].includes(t.role)&&this._config.ownerCanCloseEarly,s=[];return n?s.push(new y.MenuItem(this.translateI18nItem(L.EDIT_INFO),this._editInfo.bind(this))):s.push(new y.MenuItem(this.translateI18nItem(L.INFO),this._viewInfo)),this._config.alert&&[l.ChatRole.Owner].includes(t.role)&&this._config.chatAvailable&&s.push(new y.MenuItem(this.translateI18nItem(L.RESPONSES),this._openResponses,!1)),i&&s.push(new y.MenuItem(this.translateI18nItem(L.LEAVE),this._leave.bind(this),!this.isOnline)),o&&s.push(new y.MenuItem(this.translateI18nItem(L.END),this._end.bind(this),!this.isOnline)),s.length>0?window.__CTRender(y.CTMenu,{menuItems:s}):null}_renderChatEntries(){const e=this._processedChatEntries[this._processedChatEntries.length-1],t=e&&e.id||"";return window.__CTRender("div",{id:"chat-history",class:"chat-history"},this.conversation.isProvisional&&this._renderProvisionalMessage(),!this.conversation.isProvisional&&this.mightHaveMore&&this._renderFetchMore(),!this.conversation.isProvisional&&this.visibleChatEntries.map(e=>{const n=e.id===t;return this._renderEntry(e,n)}))}_renderFetchMore(){const e=["fetch-more"];return this.isFetchingMore&&e.push("fetching"),this.noMoreToFetch&&e.push("no-more"),window.__CTRender("div",{id:"fetch-more",key:"fetch-more",class:e.join(" ")},!!this.fetchError&&window.__CTRender("div",{class:"error"},window.__CTRender(y.CTIcon,{class:"icon",width:"16",height:"16",icon:l.Icons.COMMON.AlertWarning}),this.fetchError),!this.fetchError&&!this.noMoreToFetch&&!this.isFetchingMore&&this.translateI18nItem(L.SCROLL_TO_TOP_FOR_MORE),this.isFetchingMore&&window.__CTRender(y.CTIcon,{width:"16",height:"16",icon:l.Icons.COMMON.LoadingSpinner,spin:!0}),this.noMoreToFetch&&this.translateI18nItem(L.AT_START))}_renderProvisionalMessage(){return window.__CTRender("div",{class:"entry meta"},window.__CTRender("div",{class:"bubble"},this.translateI18nItem(L.PROVISIONAL_MESSAGE)))}_renderEntry(e,t){const n=["entry",e.type.toString()];e.type===l.ChatEntryType.Chat&&n.push(e.mine?"sent":"received");const i=this._generateDomIdFromEntryId(e.id);return window.__CTRender("div",{id:i,key:e.id,class:n.join(" ")},e.type===l.ChatEntryType.Meta&&this._renderMetaMessage(e),e.type===l.ChatEntryType.Chat&&this._renderChatMessage(e,t),e.type===l.ChatEntryType.Divider&&this._renderDivider(e))}_renderDivider(e){return window.__CTRender("span",null,E.getFriendlyDate(e.date,this))}_renderChatMessage(e,t){const n=["bubble"];let i;this._isOnlyEmojis(e.body)&&n.push("emojis-only");const o=this._userLookup.get(e.from);e.actingDelegate&&(i=this._userLookup.get(e.actingDelegate));const s=b.formatText(e.body.trim());return window.__CTRender("div",{class:"chat"},!1===e.mine&&window.__CTRender("div",{class:"from"},E.formatUserName(o,E.NameFormat.PREFIX_FIRST_LAST)||e.from,i&&window.__CTRender("span",null,E.formatUserName(i,E.NameFormat.PREFIX_FIRST_LAST))),window.__CTRender("div",null,window.__CTRender("div",{class:n.join(" ")},e.mine&&e.actingDelegate&&!e.actingDelegate.includes(this.layer.getCurrentUserJid().split("@")[0])&&E.formatUserName(i,E.NameFormat.PREFIX_FIRST_LAST),e.attachments&&e.attachments.length>0&&this._renderMedia(e,e.attachments[0],t),"string"==typeof e.body&&e.body.length>0&&window.__CTRender("div",{class:"content"},this.renderHtml(s,this._generateDomIdFromEntryId(e.id))))),window.__CTRender("div",{class:"meta"},window.__CTRender("div",{class:"chat-status"},this._renderChatMessageStatus(e)),window.__CTRender("div",{class:"chat-time"},window.__CTRender("span",{class:"hour-min"},E.getFriendlyTime(e.date)))))}_renderChatMessageStatus(e){if(!this._shouldUseChatMarkers())return null;if(!e.mine)return null;const t=e.receivedBy&&e.receivedBy.length>0;return e.readBy&&e.readBy.length>0?window.__CTRender(y.CTIcon,{width:"10",height:"10",icon:l.Icons.COMMON.Tick}):t?window.__CTRender(y.CTIcon,{width:"10",height:"10",icon:l.Icons.COMMON.TickHollow}):null}_renderMetaMessage(e){const t=this.layer.getWorkspaceJid(),n=this.conversation.participants.find(e=>E.jidsMatch(e.jid,t));if(!n)return null;if(![l.ChatRole.Owner].includes(n.role)&&!1===this._config.participantAlertResponsesVisible&&e.instigator!==t&&e.action===v.ChatMetaActivityType.ACK)return null;const i=d.getChatMetaActivitySummaryText(e,this._userLookup,t,this,!0);return window.__CTRender("div",{class:"bubble"},this.renderHtml(i,this._generateDomIdFromEntryId(e.id)))}_renderMedia(e,t,n){return window.__CTRender("div",null,window.__CTRender(u.CTCLThumbnail,{chatMessage:e,attachment:t,isLastEntry:n}))}_renderScrollToBottom(){return this.conversation?!0===this.conversation.isProvisional?null:0===this._rawChatEntries.length?null:(this.onRenderComplete(()=>{this._chatScrollToBottom&&this._chatScrollToBottom.classList.add("animate")},!0),window.__CTRender("div",{id:"chat-scroll-to-bottom",class:"chat-scroll-to-bottom",onClick:()=>this._scrollToBottom(!0)},window.__CTRender("div",{class:"icon"},window.__CTRender(y.CTIcon,{icon:v.Icons.UI.ScrollToBottom,width:16,height:16})),window.__CTRender("div",{class:"number"},this._newNotificationsCount))):null}_multilineEllipsis(e){this._description&&T.clamp(this._description,{clamp:e})}_calcLongDescription(){this._description&&(this._description.classList.remove("collapsed"),this.hasLongDescription=this._description.clientHeight>60,this.forceRedraw())}_renderPriorityDescription(){const e=this.conversation.attachments.find(e=>e.type===v.SupportedAttachmentType.AUDIO),t=this.conversation.attachments.find(e=>e.type===v.SupportedAttachmentType.IMAGE),n=b.formatText(this.conversation.description.trim());return window.__CTRender("div",{class:"description-container"},e&&window.__CTRender("div",{class:"audio-attachment"},window.__CTRender(p.CTCLAttachmentHandler,{uri:e.local||e.path,type:v.SupportedAttachmentType.AUDIO,conversationId:this.conversation.id,preventRemoteStart:!0})),window.__CTRender("div",{class:"priority-description"},t&&window.__CTRender("div",{class:"image-thumbnail"},window.__CTRender(p.CTCLAttachmentHandler,{class:"ct-cl-attachment-handler",uri:t.local||t.path,type:v.SupportedAttachmentType.IMAGE,allowOpenImageInFullScreen:this._config.allowOpenInFullScreen,conversationId:this.conversation.id,isThumbnail:!0})),window.__CTRender("div",{id:"description-text",class:"description-text"},this.renderHtml(n,"priority_description_text")),this.hasLongDescription&&window.__CTRender("div",{class:"expander"},window.__CTRender(y.CTIcon,{id:"priority-description-collapsed-icon",width:"16",height:"16",icon:l.Icons.COMMON.ChevronDown,onClick:e=>this._togglePriorityDescriptionExpansion()}),window.__CTRender(y.CTIcon,{id:"priority-description-expanded-icon",class:"hidden",width:"16",height:"16",icon:l.Icons.COMMON.ChevronUp,onClick:e=>this._togglePriorityDescriptionExpansion()}))))}_renderFooter(){if(this.conversation.disallowReply||!1===this._config.chatAvailable)return null;const e=this._draft&&this._draft.body||"",t=this._draft&&!0===this._draft.error,n=["action","attach"],i=["textbox"],o=["action","send"];!this.sendButtonDisabled&&this.isOnline||o.push("disabled"),this.sending&&(n.push("disabled"),i.push("disabled"));const s=t||this.sendError;return window.__CTRender("div",{class:"footer"},this._config.canSendAttachmentsWithinConversation&&window.__CTRender("div",{class:n.join(" "),onClick:this._attachMedia.bind(this)},window.__CTRender(y.CTIcon,{width:"16",height:"16",icon:v.Icons.UI.Attachment})),window.__CTRender("div",{class:i.join(" ")},this.media&&this.media.length>0&&window.__CTRender("div",{class:"media"},this.media.map(e=>this._renderDraftMedia(e))),window.__CTRender(y.CTGrowingTextbox,{id:"message",key:"message",value:e,placeholder:this.translateI18nItem(L.MESSAGE_PLACEHOLDER),maxHeight:200,maxLength:this._maxMessageLength,transparent:!0,disabled:this.sending,isChat:!0,onFocus:this._onFocusMessage.bind(this),onChange:this._onMessageChanged.bind(this),onSubmit:this._sendMessage.bind(this)}),s&&window.__CTRender("div",{class:"error"},window.__CTRender(y.CTIcon,{width:"16",height:"16",icon:v.Icons.UI.Error}))),window.__CTRender("div",{class:o.join(" "),onClick:this._sendMessage.bind(this)},!this.sending&&window.__CTRender(y.CTIcon,{width:"16",height:"16",icon:v.Icons.UI.SendMessage}),this.sending&&window.__CTRender(y.CTIcon,{width:"16",height:"16",icon:l.Icons.COMMON.LoadingSpinner,spin:!0})))}_renderDraftMedia(e){const t=this._getDraftAttachmentSrc(e);return window.__CTRender("div",{class:"media-item"},window.__CTRender("img",{class:"media-image",src:t}),!this.sending&&window.__CTRender("div",{class:"remove"},window.__CTRender(y.CTIcon,{width:"16",height:"16",icon:l.Icons.COMMON.CircleCross,onClick:e=>this._removeMediaItem(e)})))}_renderPagerUI(){const e=this.conversation.attachments.find(e=>e.type===v.SupportedAttachmentType.AUDIO),t=this.conversation.attachments.find(e=>e.type===v.SupportedAttachmentType.IMAGE),n=this.conversation.acknowledgements.find(e=>e.jid===this.layer.getWorkspaceJid()),i=b.formatText(this.conversation.description.trim());return window.__CTRender("div",{class:"pager-ui"},e&&window.__CTRender("div",{class:"audio-attachment"},window.__CTRender(p.CTCLAttachmentHandler,{uri:e.local||e.path,type:v.SupportedAttachmentType.AUDIO,conversationId:this.conversation.id,preventRemoteStart:!0})),t&&window.__CTRender("div",{class:"image-thumbnail"},window.__CTRender(p.CTCLAttachmentHandler,{uri:t.local||t.path||e&&e.path,type:v.SupportedAttachmentType.IMAGE,allowOpenImageInFullScreen:this._config.allowOpenInFullScreen,conversationId:this.conversation.id})),window.__CTRender("div",{id:"description-text",class:"description-text"},this.renderHtml(i,"pager_description_text")),n&&window.__CTRender("div",{class:"meta"},window.__CTRender("span",null,"You responded with: ",window.__CTRender("strong",null,n.value)," at"," ",window.__CTRender("strong",{class:"hour-min"},E.getFriendlyTime(parseInt(""+n.ts))))))}_onMessageChanged(){return o(this,void 0,void 0,function*(){this._updateDraft(),this._updateSendButton()})}_onFocusMessage(){return o(this,void 0,void 0,function*(){this.sendError=!1,E.isAndroid()&&this._chatListScrollable.scrollTop>this._chatListScrollable.scrollHeight/2&&setTimeout(()=>this._scrollToBottom(!0),500),this._updateDraft()})}_removeMediaItem(e){e.stopPropagation(),this._removeMedia(!0)}_sendMessage(){return o(this,void 0,void 0,function*(){if(this.isOnline&&!this.sending&&!this.sendButtonDisabled&&this._messageTextbox){this._messageTextbox.focus(),this.sendError=!1,this.sending=!0;try{this.conversation.isProvisional?(this._pendingConversationId=yield this.layer.createConversationFromProvisional(this.conversation),this._pendingDraft=this._draft,this._pendingConversationId&&this.layer.isConversationErrorAndExists&&(this._processUnProvisionalMessage(),this.layer.isConversationErrorAndExists=!1)):this._processUnProvisionalMessage()}catch(e){yield this._handleSendMessageException(e)}}})}_processUnProvisionalMessage(){return o(this,void 0,void 0,function*(){try{const e=this._draft&&this._draft.body?this._draft.body:this._messageTextbox.getValue(),t=this.media.length&&this.media[0].path||null,n=t&&[t]||[],i=this._shouldUseChatMarkers(),o=yield this.layer.sendConversationMessage(this.conversation,e,n,i);this._appendChatEntry(o,!0),this._messageTextbox.clear(),yield this._removeMedia(!1),this._clearDraft(),this._updateSendButton(),this.sending=!1,this._autoFocusMessageTextboxOnDesktop(),this._updateVisibleChatEntries()}catch(e){yield this._handleSendMessageException(e)}})}_handleSendMessageException(e){return o(this,void 0,void 0,function*(){const t=this.translateI18nItem(L.SEND_ERROR),n=this.translateI18nItem(L.SEND_ERROR);this.layer.error(t,n,e.message),e.message&&e.message._id&&(this.layer.deleteConversationMessageById(e.message._id,!1),yield this._updateVisibleChatEntries()),this.sendError=!0,this.sending=!1,this._updateDraft()})}_back(){return o(this,void 0,void 0,function*(){this.emitEvent(_.ChatEvents.RemotelyStopAudioPlayer),yield this._removeMedia(!0),yield this._saveDraft(),yield this.layer.clearCurrentConversation(),this.layer.purgeConversation(this.conversation),this.emitComponentEvent("go-back"),this.layer.popBackHandler()})}_editInfo(){return o(this,void 0,void 0,function*(){yield this._saveDraft(),this.emitComponentEvent("go-info")})}_leave(){return o(this,void 0,void 0,function*(){if(yield this.requestConfirmation(this.translateI18nItem(L.COMFIRM_LEAVE))){(yield this.layer.leaveConversation(this.conversation,this.layer.getWorkspaceJid()))&&(this.layer.shouldCloseConversation(this.conversation,this.layer.getWorkspaceJid())?(this.showWaitingMessage(this.translateI18nItem(C.CommonMetadata.getI18nItem(C.CommonI18nKeys.PLEASE_WAIT))),this.addListener(_.ChatEvents.ConversationClosed,()=>o(this,void 0,void 0,function*(){this.dismissWaitingMessage(),this._clearDraft(),yield this.layer.clearCurrentConversation(),this.emitComponentEvent("go-leave")}),{onceOnly:!0})):this.emitComponentEvent("go-leave"))}})}_end(){return o(this,void 0,void 0,function*(){if(yield this.requestConfirmation(this.translateI18nItem(L.COMFIRM_END))){(yield this.layer.endConversation(this.conversation,this.layer.getWorkspaceJid()))&&(this.showWaitingMessage(this.translateI18nItem(C.CommonMetadata.getI18nItem(C.CommonI18nKeys.PLEASE_WAIT))),this.addListener(_.ChatEvents.ConversationClosed,()=>o(this,void 0,void 0,function*(){this.dismissWaitingMessage(),this._clearDraft(),yield this.layer.clearCurrentConversation(),this.emitComponentEvent("go-end")}),{onceOnly:!0}))}})}_refreshUserLookup(){return o(this,void 0,void 0,function*(){return yield this._userLookup.populate([this.conversation],this._rawChatEntries)})}_detectOverscrollSupport(){const e=document.createElement("div");document.documentElement.appendChild(e),e.style.WebkitOverflowScrolling="touch",this._supportsOverscroll="getComputedStyle"in window&&"touch"===window.getComputedStyle(e)["-webkit-overflow-scrolling"],document.documentElement.removeChild(e)}_getDomNodes(){const e=this.shadowRoot;this._chatListScrollable=e.querySelector("#chat-history"),this._chatListFetchMore=e.querySelector("#fetch-more"),this._chatScrollToBottom=e.querySelector("#chat-scroll-to-bottom"),this._messageTextbox=e.querySelector("#message"),this._description=e.querySelector("#description-text")}_generateDomIdFromEntryId(e){return`entry_${(e||"").replace(/[:.]/g,"_")}`}_setupScrollWatcher(){this._chatListScrollable&&setTimeout(()=>{this._chatListScrollable.removeEventListener("scroll",this._onScroll),this._chatListScrollable.addEventListener("scroll",this._onScroll)},500)}_stopScroll(e){return o(this,void 0,void 0,function*(){return this._supportsOverscroll?new Promise(t=>{this._chatListScrollable.classList.add("stop-scroll"),this._chatListScrollable.scrollTop=e,setTimeout(()=>{this._chatListScrollable.classList.remove("stop-scroll"),t()},0)}):Promise.resolve()})}_scrollToBottom(e){return o(this,void 0,void 0,function*(){const t=this._processedChatEntries.length-1;if(this._endIdx<t)return t-this._endIdx==1?(this._endIdx+=1,this._calculateStartIdxBasedOnEndIdx(),void this._updateVisibleChatEntries().then(()=>this._scrollToBottom(e))):void this._setMostRecentChatEntriesVisible();if(!this._chatListScrollable)return;this._hideScrollToBottom();const n=this._chatListScrollable.scrollTop,i=this._chatListScrollable.scrollHeight-this._chatListScrollable.clientHeight;if(n>=i)return Promise.resolve();if(e){const e=300;return new Promise(t=>{const n=this._chatListScrollable.scrollTop,o=i-n;let s=0;const r=()=>{s+=20,this._chatListScrollable.scrollTop=((e,t,n,i)=>(e/=i/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t)(s,n,o,e),s<e?setTimeout(r,20):t()};r()})}return this._chatListScrollable.scrollTop=i,Promise.resolve()})}_handleScrollAtTop(){if(this.isFetchingMore)return;if(!this.visibleChatEntries||0===this.visibleChatEntries.length)return;const e=this.visibleChatEntries[0];0===this._processedChatEntries.findIndex(t=>t.id===e.id)&&!this.noMoreToFetch?this._fetchMoreChatEntries():(this._offsetVisibleIndexes(-this._visibleChatEntryBlockSize),this._processIndexChanges(e.id))}_handleScrollAtBottom(){if(!this.visibleChatEntries||0===this.visibleChatEntries.length)return;const e=this.visibleChatEntries[this.visibleChatEntries.length-1];if(this._processedChatEntries.findIndex(t=>t.id===e.id)===this._processedChatEntries.length-1)return this._hideScrollToBottom(),void(this._suppressScrollHandler=!1);this._offsetVisibleIndexes(this._visibleChatEntryBlockSize),this._processIndexChanges(e.id)}_offsetVisibleIndexes(e){this._startIdx=Math.max(0,this._startIdx+e),this._calculateEndIdxBasedOnStartIdx()}_calculateStartIdxBasedOnEndIdx(){this._startIdx=Math.max(0,this._endIdx-3*this._visibleChatEntryBlockSize)}_calculateEndIdxBasedOnStartIdx(){this._endIdx=Math.min(this._processedChatEntries.length-1,this._startIdx+3*this._visibleChatEntryBlockSize)}_processIndexChanges(e){if(!this._chatListScrollable)return;const t=this._getMessageBoundsTop(e);this._updateVisibleChatEntries().then(()=>{const n=this._getMessageTop(e);this._chatListScrollable.scrollTop=n-t,this._suppressScrollHandler=!1})}_getMessageTop(e){const t=this._generateDomIdFromEntryId(e),n=this.shadowRoot.querySelector(`#${t}`);return n&&n.offsetTop||0}_getMessageBoundsTop(e){const t=this._generateDomIdFromEntryId(e),n=this._chatListScrollable.getBoundingClientRect().top||0,i=this.shadowRoot.querySelector(`#${t}`);return(i&&i.getBoundingClientRect().top||0)-n}_resetForConversationChange(){return o(this,void 0,void 0,function*(){this._rawChatEntries=[],this._processedChatEntries=[],this.visibleChatEntries=[],this.fetchError=null,this.noMoreToFetch=!1,this.mightHaveMore=!0})}_fetchMoreChatEntries(e=!1){return o(this,void 0,void 0,function*(){if(this.noMoreToFetch)return;if(!this._config.usePagerUI&&!this._chatListScrollable)return;clearTimeout(this.layer.messageQueueProcessorDebounce),this.isFetchingMore=!0,this.fetchError=null;const t=this._rawChatEntries&&this._rawChatEntries[0]||null;this._isInitialFetch=!0===e||null===t;try{let e=yield this.layer.fetchConversationEntries(this.conversation,t,this._batchSize||10);if(e.length){if(e=e.filter(e=>!e.placeholder),this.isOnline&&e.forEach(e=>this.layer.markChatEntryRead(e)),yield this._updateChatEntries([...e,...this._rawChatEntries]),this._isInitialFetch?this._setMostRecentChatEntriesVisible():(this._startIdx=0,this._calculateEndIdxBasedOnStartIdx(),this._processIndexChanges(t.id)),this.isFetchingMore=!1,this._isInitialFetch&&this.conversation.hasUnread){const e=yield this.layer.getCurrentConversation();e&&(e.hasUnread=!1,yield this.layer.updateConversation(e))}}else this.isFetchingMore=!1,this.noMoreToFetch=!0,this._suppressScrollHandler=!1;this._isInitialFetch&&e.length<(this._batchSize||Number.MAX_VALUE)&&(this.mightHaveMore=!1)}catch(e){if(!(e instanceof r.NotConnectedError))throw e;this.fetchError=this.translateI18nItem(L.FETCH_ERROR_NOT_ONLINE),this.isFetchingMore=!1}})}_setMostRecentChatEntriesVisible(){this._endIdx=this._processedChatEntries.length-1,this._calculateStartIdxBasedOnEndIdx(),this._updateVisibleChatEntries().then(()=>this._scrollToBottom(!1))}_updateVisibleChatEntries(){return new Promise(e=>{this._startIdx=Math.max(this._startIdx,0),this._endIdx=Math.min(this._endIdx,this._processedChatEntries.length-1),this._startIdx>this._endIdx&&this._endIdx<this._visibleChatEntryBlockSize&&(this._startIdx=0),this.visibleChatEntries=this._processedChatEntries.slice(this._startIdx,this._endIdx+1),this.onRenderComplete(()=>e(),!0)})}_updateChatEntries(e){return o(this,void 0,void 0,function*(){this._rawChatEntries=e,this._processedChatEntries=yield this._generateProcessedChatEntries(e),yield this._refreshUserLookup()})}_updateChatEntry(e){return o(this,void 0,void 0,function*(){const t=this._rawChatEntries.findIndex(t=>t.id===e.id);if(-1===t)return;const n=this._rawChatEntries.map((n,i)=>i===t?e:n);yield this._updateChatEntries(n),yield this._updateVisibleChatEntries()})}_appendChatEntry(e,t=!1){return o(this,void 0,void 0,function*(){this._rawChatEntries.find(t=>t.id===e.id)||(yield this._updateChatEntries([...this._rawChatEntries,e]),this._isNearBottom()||t?yield this._scrollToBottom(!0):(this._newNotificationsCount+=1,this._showScrollToBottom()))})}_generateProcessedChatEntries(e){return o(this,void 0,void 0,function*(){const t=[];let n=null;for(let i=e.length-1;i>=0;i--){const o=e[i],s=new Date(o.date);null!==n&&n.toDateString()!==s.toDateString()&&this._addDivider(t,n),t.unshift(o),n=s}return t.sort((e,t)=>e.date-t.date)})}_addDivider(e,t){const n=t.setHours(0,0,0,0);e.unshift({id:`divider_${n}`,type:l.ChatEntryType.Divider,date:n,to:this.conversation.roomJid})}_shouldUseChatMarkers(){return!1}_isOnlyEmojis(e){if(!e)return!1;return 0===e.replace(new RegExp("(?:[-]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[#-9]?||||||\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]||\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|[\ud83c[\ude01-\ude02]|||[\ud83c[\ude32-\ude3a]|[\ud83c[\ude50-\ude51]|||[-]|||[-]||||||[-]||||||||||||[-]|[-]||||[-])","g"),"").length}_isNearBottom(){if(!this._chatListScrollable)return;return this._chatListScrollable.scrollHeight-this._chatListScrollable.clientHeight-this._chatListScrollable.scrollTop<=100}_showScrollToBottom(){this._chatScrollToBottom&&(this.onRenderComplete(()=>{this._newNotificationsCount&&this._newNotificationsCount>0?this._chatScrollToBottom.querySelector(".number").textContent=this._newNotificationsCount.toString():this._chatScrollToBottom.querySelector(".number").textContent=""},!0),this._chatScrollToBottom.classList.add("visible"))}_hideScrollToBottom(){this._chatScrollToBottom&&(this._chatScrollToBottom.classList.remove("visible"),this._newNotificationsCount=0,setTimeout(()=>{const e=this._chatScrollToBottom.querySelector(".number");e&&(e.textContent="")},300))}_attachMedia(){return o(this,void 0,void 0,function*(){this._cameraClickCount++,this.sending||(this.media.length>0?(yield this.requestConfirmation(this.translateI18nItem(L.CONFIRM_REPLACE_IMAGE)))&&this._doAttachMedia():this._doAttachMedia())})}_doAttachMedia(){return o(this,void 0,void 0,function*(){if(1===this._cameraClickCount)try{const e=yield this.layer.captureOrSelectMedia();e&&(e.base64=yield w.getThumbnail(e.path,75,75,100),yield this._removeMedia(!0),this.media=[e],this._updateDraft(),this._updateSendButton())}catch(e){const t=this.layer.translateI18nItem(R.ChatCommonMetadata.getI18nItem(R.ChatCommonI18nKeys.ERROR_GENERIC_MESSAGE)),n=I.getErrorMessage("E_UNKNOWN",this.layer);this.layer.error(t,n),this._cameraClickCount=0}else this._cameraClickCount=0})}_removeMedia(e){return o(this,void 0,void 0,function*(){this.media.length>0&&(e&&(yield this.layer.cancelMediaSeletion(this.media[0].path)),this.media=[],this._updateDraft(),this._updateSendButton())})}_getDraftAttachmentSrc(e){if(e.base64){if(e.base64.startsWith("data:")&&e.base64.includes("base64"))return e.base64;if(e.mimeType)return`data:${e.mimeType};base64,${e.base64}`}return e.path?E.normalizeLocalFilePaths(e.path):""}_updateDraft(){if(!this._messageTextbox)return;const e=this._messageTextbox.getValue();let t=null;e&&((t=t||{}).body=e,t.error=this.sendError),JSON.stringify(t)!==JSON.stringify(this._draft)&&(this._draft=null===t?null:t,this._saveDraft(!0),this.forceRedraw())}_clearDraft(){this._draft=null,this._saveDraft()}_saveDraft(e=!1){return o(this,void 0,void 0,function*(){clearTimeout(this._saveDraftTimeout),e?this._saveDraftTimeout=setTimeout(()=>{this.layer.saveConversationDraft(this.conversation,this._draft)},2e3):yield this.layer.saveConversationDraft(this.conversation,this._draft)})}_updateSendButton(){const e=this._draft&&"string"==typeof this._draft.body&&this._draft.body.length>0;this.sendButtonDisabled=!e&&0===this.media.length}_autoFocusMessageTextboxOnDesktop(){E.isDesktop()&&!0===this._config.chatAvailable&&this.onRenderComplete(()=>{this.defer(()=>{this._messageTextbox.focus()})},!0)}_togglePriorityDescriptionExpansion(){if(!this._description)return;const e=this.shadowRoot.querySelector("#priority-description-collapsed-icon");this.shadowRoot.querySelector("#priority-description-expanded-icon").classList.toggle("hidden"),e.classList.toggle("hidden"),this._description.classList.toggle("collapsed"),this._description.classList.contains("collapsed")?(this._description.scrollTop=0,this._multilineEllipsis(2)):this._multilineEllipsis(!1)}}i([s.prop({type:Object,attribute:!1,default:null})],D.prototype,"conversation",void 0),i([s.prop({type:Array,attribute:!1,default:[]})],D.prototype,"visibleChatEntries",void 0),i([s.prop({type:Boolean,attribute:!1,default:!0})],D.prototype,"isFetchingMore",void 0),i([s.prop({type:String,attribute:!1,default:null})],D.prototype,"fetchError",void 0),i([s.prop({type:Boolean,attribute:!1,default:!0})],D.prototype,"mightHaveMore",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],D.prototype,"noMoreToFetch",void 0),i([s.prop({type:Array,attribute:!1,default:[]})],D.prototype,"media",void 0),i([s.prop({type:Boolean,attribute:!1,default:!0})],D.prototype,"sendButtonDisabled",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],D.prototype,"sending",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],D.prototype,"sendError",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],D.prototype,"hasLongDescription",void 0),t.CTCLChatMessageList=D,D.register()},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(6),r=n(30),a=n(1),l=n(17),c=n(0),d=n(8),h=n(5),u=n(12),p=n(11),g=n(18);var m;!function(e){e[e.LOADING_IMAGE="Loading image..."]="LOADING_IMAGE",e[e.IMAGE_REFETCH="Download image"]="IMAGE_REFETCH",e[e.IMAGE_ERROR="Image unable to download, press to retry"]="IMAGE_ERROR"}(m||(m={}));class f{static _create(){return new l.Metadata(g.CTCLHeader,m)}static get instance(){return this._instance||(this._instance=this._create())}}f._instance=null,t.CTCLThumbnailMetadata=f;class _ extends u.CTCLComponent{constructor(){super(),this._onMediaError=(e=>{this._errorIcon=c.Icons.COMMON.AlertWarning,this._errorMessage=this.translateI18nItem(m.IMAGE_ERROR),this.hasError=!0}),this._onClickMedia=(e=>o(this,void 0,void 0,function*(){e.stopPropagation(),yield this.layer.showMediaFullscreen(this.attachment.local)})),this._errorOnClick=(()=>{h.isDesktop()?console.error("Attachments unavailable on desktop."):(this.isLoading=!0,this.hasError=!1,this._downloadRemoteImage())}),this.setMetadata(f.instance)}static get is(){return"ct-cl-thumbnail"}connectedCallback(){super.connectedCallback(),this.initialize()}initialize(){return o(this,void 0,void 0,function*(){this.attachment&&this.chatMessage&&(this.attachment&&!this.attachment.local&&this._downloadRemoteImage(),this.attachment&&this.attachment.local&&this._loadImageFromSource())})}setupListeners(){this.addListener(s.ChatEvents.ChatEntryUpdated,e=>o(this,void 0,void 0,function*(){(yield this.layer.belongsToCurrentConversation(e.chatEntry))&&e.chatEntry.id===this.chatMessage.id&&(this._finalImageSrc||this._isGettingBase64?this._finalImageSrc:(this.attachment=e.chatEntry.attachments[0],this._loadImageFromSource()))}))}get generateComponentStyles(){return n(318)}generateComponentMarkup(){if(!this.chatMessage||!this.attachment)return null;const e=this.layer.hasMediaFullscreenHandler();return window.__CTRender("div",{class:"attachment"},this.isLoading?window.__CTRender("div",{class:`loading ${this.chatMessage.mine?"mine":""}`},window.__CTRender(d.CTIcon,{class:"icon",width:"32",height:"32",icon:p.Icons.UI.Attachment}),window.__CTRender("div",{class:"message"},window.__CTRender(d.CTIcon,{class:"icon",width:"16",height:"16",icon:c.Icons.COMMON.LoadingSpinner,spin:!0}),this.translateI18nItem(m.LOADING_IMAGE))):null,this.hasError?window.__CTRender("div",{class:`error ${this.chatMessage.mine?"mine":""}`,onClick:this._errorOnClick},window.__CTRender(d.CTIcon,{class:"icon",width:"32",height:"32",icon:this._errorIcon}),window.__CTRender("div",{class:"message"},this._errorMessage)):null,this.isLoading||this.hasError?null:window.__CTRender("img",{class:`image ${e?"interactive":""}`,src:this._finalImageSrc,onError:this._onMediaError,onClick:this._onClickMedia}))}_downloadRemoteImage(){this.layer.downloadMessageAttachments(this.chatMessage).catch(()=>{this._errorIcon=c.Icons.COMMON.AlertWarning,this._errorMessage=this.translateI18nItem(m.IMAGE_ERROR),this.hasError=!0,this.isLoading=!1})}_loadImageFromSource(){this.attachment&&this.attachment.local?h.isDesktop()?(this._finalImageSrc=this.attachment.local,this.isLoading=!1,this.onRenderComplete(()=>this.emitEvent(s.ChatEvents.ThumbnailLoaded,this.chatMessage),!0)):this._getBase64():this.isLoading=!0}_getBase64(){return o(this,void 0,void 0,function*(){this._isGettingBase64=!0;try{this._finalImageSrc=yield r.getThumbnail(this.attachment.local,200,200,100),this.hasError=!1,this.onRenderComplete(()=>this.emitEvent(s.ChatEvents.ThumbnailLoaded,this.chatMessage),!0)}catch(e){this._errorIcon=c.Icons.COMMON.AlertWarning,this._errorMessage=this.translateI18nItem(m.IMAGE_ERROR),this.hasError=!0}finally{this.isLoading=!1,this._isGettingBase64=!1}})}}i([a.prop({type:Boolean,attribute:!1,default:!0})],_.prototype,"isLoading",void 0),i([a.prop({type:Boolean,attribute:!1,default:!1})],_.prototype,"hasError",void 0),i([a.prop({type:Object,attribute:!0,default:null})],_.prototype,"chatMessage",void 0),i([a.prop({type:Object,attribute:!0,default:null})],_.prototype,"attachment",void 0),i([a.prop({type:Boolean,attribute:!1,default:!1})],_.prototype,"isLastEntry",void 0),t.CTCLThumbnail=_,_.register()},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(14),a=n(17),l=n(0),c=n(12),d=n(16),h=n(18),u=n(21),p=n(6),g=n(8),m=n(5),f=n(13),_=n(36);var v;!function(e){e[e.CONTACT_INFORMATION="Contact Information"]="CONTACT_INFORMATION",e[e.ROLE_INFORMATION="Role Information"]="ROLE_INFORMATION",e[e.START_DIRECT_CONVERSATION="Direct Conversation"]="START_DIRECT_CONVERSATION",e[e.USER_TYPE="User Type"]="USER_TYPE",e[e.ACCESS_RIGHTS="Access Rights"]="ACCESS_RIGHTS",e[e.PARTICIPANT="Participant"]="PARTICIPANT",e[e.PARTICIPANT_RIGHTS="Read/Reply"]="PARTICIPANT_RIGHTS",e[e.ADMIN="Admin"]="ADMIN",e[e.ADMIN_RIGHTS="Add/Remove Participants"]="ADMIN_RIGHTS",e[e.OWNER="Owner"]="OWNER",e[e.OWNER_RIGHTS="Add/Remove/Promote/Demote Anybody"]="OWNER_RIGHTS",e[e.REMOVE_FROM_CONVERSATION="Remove From This Conversation"]="REMOVE_FROM_CONVERSATION",e[e.CONFIRM_DIRECT_CONVERSATION="Are you sure you wish to start or resume a direct conversation with this contact?"]="CONFIRM_DIRECT_CONVERSATION",e[e.CONFIRM_CHANGE_ROLE="Are you sure you wish to change the role of this contact?"]="CONFIRM_CHANGE_ROLE",e[e.CONFIRM_REMOVE="Are you sure you wish to remove this contact from the conversation?"]="CONFIRM_REMOVE"}(v||(v={}));class y{static _create(){return new a.Metadata(C,v)}static get instance(){return this._instance||(this._instance=this._create())}}y._instance=null,t.CTCLContactInfoMetadata=y;class C extends c.CTCLComponent{constructor(){super(),this._animationDuration=500,this._goChatFunction=null,this.setMetadata(y.instance)}static get is(){return"ct-cl-contact-info"}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){this.setupConnectionStatusListener(),this.addListener(p.ChatEvents.ConversationParticipantsChanged,e=>{this.conversation&&this.conversation.id===e.conversation.id&&(this.conversation.participants=e.conversation.participants,this.forceRedraw())}),this.addListener(r.BaseEvents.ConnectionStatusChange,e=>{e.status===l.ConnectionStatus.Disconnected&&this.dismissWaitingMessage()},{dontSuppress:!0}),this.addListener(p.ChatEvents.DelegationRemoved,e=>{e===this.layer.getWorkspaceJid()&&this._back()})}get generateComponentStyles(){return n(336)}generateComponentMarkup(){return this.contact?window.__CTRender("div",{class:"contact-info"},this._renderHeader(),this._renderContactInfo(),this.conversation&&this._renderConversationContext()):null}_renderHeader(){return window.__CTRender(h.CTCLHeader,{class:"header"},window.__CTRender("div",{slot:"left-action"},window.__CTRender(g.CTIcon,{class:"action",width:"20",height:"20",icon:l.Icons.COMMON.ChevronLeft,onClick:this._back.bind(this)})),window.__CTRender("div",{slot:"heading"},m.formatUserName(this.contact,m.NameFormat.PREFIX_INITIAL_LAST)),window.__CTRender("div",{slot:"sub-heading"},this.translateI18nItem(this.contact.is_role?v.ROLE_INFORMATION:v.CONTACT_INFORMATION)))}_renderContactInfo(){return window.__CTRender("div",{class:"user-info"},this.contact.is_role&&window.__CTRender(_.CTRoleAvatar,{class:"avatar",user:this.contact,size:90})||window.__CTRender(g.CTUserAvatar,{class:"avatar",user:this.contact,size:90}),window.__CTRender("div",{class:"name"},m.formatUserName(this.contact,m.NameFormat.PREFIX_FIRST_LAST)),this.contact.jobTitle&&window.__CTRender("div",{class:"job-title"},this.contact.jobTitle),this.contact.group&&window.__CTRender("div",{class:"group"},f.filterUserGroup(this.contact.group)),this.contact.telephone&&window.__CTRender("a",{class:"telephone",href:"#",onClick:()=>{window.open(`tel:${this.contact.telephone}`,"_system")}},this.contact.telephone),this.allowStartDirect&&window.__CTRender("div",{class:"actions"},window.__CTRender(g.CTButton,{type:"secondary",width:"auto",disabled:!this.isOnline,onClick:this._startDirectConversation.bind(this)},this.translateI18nItem(v.START_DIRECT_CONVERSATION))))}_renderConversationContext(){const e=this._getParticipant(this.contact.jid);if(!e)return null;const t=this._config.namedSettings&&this._config.ownerCanEditAfterSend,n=this.layer.getWorkspaceJid(),i=this._getParticipant(n).role,o=i===l.ChatRole.Owner,s=i===l.ChatRole.Owner||i===l.ChatRole.Administrator&&e.role===l.ChatRole.Participant;return window.__CTRender("div",{class:"conversation-context"},t&&window.__CTRender("div",{class:"roles"},window.__CTRender("div",{class:"row header"},window.__CTRender("div",{class:"l"},this.translateI18nItem(v.USER_TYPE)),window.__CTRender("div",{class:"r"},this.translateI18nItem(v.ACCESS_RIGHTS))),this._renderRoleType(e,l.ChatRole.Owner,v.OWNER,v.OWNER_RIGHTS,o),this._renderRoleType(e,l.ChatRole.Administrator,v.ADMIN,v.ADMIN_RIGHTS,o),this._renderRoleType(e,l.ChatRole.Participant,v.PARTICIPANT,v.PARTICIPANT_RIGHTS,o)),t&&s&&window.__CTRender("div",{class:"footer"},window.__CTRender(g.CTButton,{type:"dangerous",width:"auto",disabled:!this.isOnline,onClick:()=>this._removeFromConversation(e)},this.translateI18nItem(v.REMOVE_FROM_CONVERSATION))))}_renderRoleType(e,t,n,i,o){const s=e.role===t,r=["row","role"];return o&&this.isOnline||r.push("disabled"),s&&r.push("selected"),window.__CTRender("div",{class:r.join(" "),onClick:(()=>{o&&t!==e.role&&this._changeRole(e,t)}).bind(this)},window.__CTRender("div",{class:"l"},window.__CTRender("div",{class:"radio"}),this.translateI18nItem(n)),window.__CTRender("div",{class:"r"},this.translateI18nItem(i)))}_back(){this.dismiss()}_startDirectConversation(){return o(this,void 0,void 0,function*(){if(this.isOnline&&(yield this.requestConfirmation(this.translateI18nItem(v.CONFIRM_DIRECT_CONVERSATION)))){const e=this.layer.getWorkspaceJid(),t=d.buildConversationParticipants(null,null,[e,this.contact.jid]),n=yield this.layer.getDirectConversationByParticipants(t);if(n)yield this.layer.setCurrentConversation(n),yield this.dismiss(!1),this._callGoChatFunction();else{const e=d.createProvisionalDirectConversation(t,this.layer.doesDirectConversationExistInConfiguration());yield this.layer.setProvisionalConversation(e),yield this.dismiss(!1),this._callGoChatFunction()}}})}_changeRole(e,t){return o(this,void 0,void 0,function*(){this.isOnline&&(yield this.requestConfirmation(this.translateI18nItem(v.CONFIRM_CHANGE_ROLE)))&&(yield this.layer.changeParticipantRoleInConversation(this.conversation,e,t))})}_removeFromConversation(e){return o(this,void 0,void 0,function*(){if(this.isOnline&&(yield this.requestConfirmation(this.translateI18nItem(v.CONFIRM_REMOVE)))){(yield this.layer.removeParticipantsFromConversation(this.conversation,[e]))&&this.dismiss(!1)}})}show(e,t=null,n=!0,i=!0,s=null){return o(this,void 0,void 0,function*(){this.animateModal=i,this.contact=e,this.conversation=t,this._config=new u.ConversationConfigReader(this.layer,this.conversation),this.showing=!0,this._goChatFunction=s,this.allowStartDirect=!!n&&!!this.layer.doesDirectConversationExistInConfiguration(),this.layer.setBackHandler(()=>{this._back()}),yield m.sleep(i?this._animationDuration:0)})}dismiss(e=!0){return o(this,void 0,void 0,function*(){this.animateModal=e,this.showing=!1,this.layer.popBackHandler(),yield m.sleep(e?this._animationDuration:0),this.contact=null,this.conversation=null,this.allowStartDirect=!1})}_getParticipant(e){return this.conversation&&this.conversation.participants.find(t=>m.jidsMatch(t.jid,e))||null}_callGoChatFunction(){"function"==typeof this._goChatFunction&&this._goChatFunction(),this._goChatFunction=null}}i([s.prop({type:Boolean,attribute:!0,default:!0})],C.prototype,"animateModal",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],C.prototype,"showing",void 0),i([s.prop({type:Object,attribute:!1,default:null})],C.prototype,"contact",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],C.prototype,"allowStartDirect",void 0),i([s.prop({type:Object,attribute:!1,default:null})],C.prototype,"conversation",void 0),t.CTCLContactInfo=C,C.register()},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(17),a=n(0),l=n(12),c=n(18),d=n(21),h=n(35),u=n(6),p=n(8),g=n(13),m=n(5);var f;!function(e){e[e.INFORMATION="Information"]="INFORMATION",e[e.DIRECT_CONVERSATION="Direct Conversation"]="DIRECT_CONVERSATION",e[e.NAMED_CONVERSATION="Named Conversation"]="NAMED_CONVERSATION",e[e.CURRENT_ROLE_ADMINISTRATOR="You are an Admin of this conversation"]="CURRENT_ROLE_ADMINISTRATOR",e[e.CURRENT_ROLE_OWNER="You are an Owner of this conversation"]="CURRENT_ROLE_OWNER",e[e.ADMIN="Admin"]="ADMIN",e[e.OWNER="Owner"]="OWNER",e[e.CONTACT_LIST_HEADER="Contacts in this conversation"]="CONTACT_LIST_HEADER",e[e.ADD_MORE_CONTACTS="Add More Contacts"]="ADD_MORE_CONTACTS",e[e.SUBJECT="Subject"]="SUBJECT",e[e.DESCRIPTION_OPTIONAL="Description (optional)"]="DESCRIPTION_OPTIONAL",e[e.EDIT="Edit details"]="EDIT",e[e.SAVE="Save"]="SAVE",e[e.CANCEL="Cancel"]="CANCEL"}(f||(f={}));class _{static _create(){return new r.Metadata(v,f)}static get instance(){return this._instance||(this._instance=this._create())}}_._instance=null,t.CTCLConversationInfoMetadata=_;class v extends l.CTCLComponent{constructor(){super(),this._me=null,this._namedConversationSubject="",this._namedConversationDescription="",this.setMetadata(_.instance)}static get is(){return"ct-cl-conversation-info"}initialize(){return o(this,void 0,void 0,function*(){if(this.isLoading=!0,this.conversation=yield this.layer.getCurrentConversation(),this._config=new d.ConversationConfigReader(this.layer,this.conversation),!this.conversation)return yield this._back();this._getCurrentUserParticipant(),this._namedConversationSubject=this.conversation.subject,this._namedConversationDescription=this.conversation.description,this.defer(()=>o(this,void 0,void 0,function*(){this._userLookup=new h.UserLookup(this.layer),yield this._userLookup.populate([this.conversation]),this._createUserList(),this.isLoading=!1})),this.layer.setBackHandler(()=>{this._back()})})}setupListeners(){this.setupConnectionStatusListener(),this.addListener(u.ChatEvents.ConversationUpdated,e=>o(this,void 0,void 0,function*(){this.conversation&&this.conversation.id===e.conversation.id&&(this.conversation=e.conversation,yield this._userLookup.populate([this.conversation]),this._createUserList()),e&&e.conversation&&e.conversation.isClosed&&e.conversation.participants&&!e.conversation.participants.length&&this._back.bind(this)()})),this.addListener(u.ChatEvents.ConversationParticipantsChanged,e=>o(this,void 0,void 0,function*(){this.conversation&&this.conversation.id===e.conversation.id&&(this.isLoading=!0,this.conversation.participants=e.participants,this._getCurrentUserParticipant(),yield this._userLookup.populate([this.conversation]),this._createUserList(),this.isLoading=!1)}))}get generateComponentStyles(){return n(338)}generateComponentMarkup(){if(!this.conversation)return;if(!this._me)return;const e=this._config.namedSettings,t=e&&[a.ChatRole.Owner].includes(this._me.role)&&this._config.ownerCanEditAfterSend,n=e&&[a.ChatRole.Administrator,a.ChatRole.Owner].includes(this._me.role)&&this._config.ownerCanAddAdditionalContacts;return window.__CTRender("div",{class:"conversation-info"},this._renderHeader(),e&&this._renderMyRole(),window.__CTRender("div",{class:"scrollable"},e&&this._renderNamedConversationInfo(t),!this.editMode&&window.__CTRender("div",{class:"participants"},window.__CTRender("div",{class:"heading"},this.translateI18nItem(f.CONTACT_LIST_HEADER)),this.isLoading?window.__CTRender(p.CTIcon,{width:"16",height:"16",icon:a.Icons.COMMON.LoadingSpinner,spin:!0}):this._renderParticipants()),!this.editMode&&n&&this._renderFooter()))}_createUserList(){const e=this.conversation.participants.filter(e=>!m.jidsMatch(e.jid,this._me.jid)).map(e=>this._userLookup.get(e.jid)).filter(e=>null!==e),t=m.sortUsersByName(e);this.usersToDisplay=t}_getCurrentUserParticipant(){const e=this.layer.getWorkspaceJid();this._me=this.conversation.participants.find(t=>m.jidsMatch(t.jid,e))||null}_renderHeader(){const e=this._config.name;return window.__CTRender(c.CTCLHeader,{class:"header"},window.__CTRender("div",{slot:"left-action"},window.__CTRender(p.CTIcon,{class:"action",width:"20",height:"20",icon:a.Icons.COMMON.ChevronLeft,onClick:this._back.bind(this)})),window.__CTRender("div",{slot:"heading"},this.translateI18nItem(f.INFORMATION)),window.__CTRender("div",{slot:"sub-heading"},e))}_renderMyRole(){const e=this._getCurrentRoleString();return e&&window.__CTRender("div",{class:"role"},e)}_renderNamedConversationInfo(e){if(e&&this.editMode){const e=this._config.maxSubjectLength,t=this._config.maxDescriptionLength;return window.__CTRender("div",{class:"named-info"},window.__CTRender("div",{class:"form-item subject"},window.__CTRender(p.CTTextbox,{type:"text",name:"subject",max:e,required:!0,fullBorder:!0,defaultValue:this._namedConversationSubject,placeholder:this._config.subjectFieldLabel,callback:e=>this._onChangeNamedConversationDetail(e)})),window.__CTRender("div",{class:"form-item description"},window.__CTRender(p.CTTextbox,{type:"textarea",name:"description",max:t,fullBorder:!0,defaultValue:this._namedConversationDescription,placeholder:this.translateI18nItem(f.DESCRIPTION_OPTIONAL),callback:e=>this._onChangeNamedConversationDetail(e)})),window.__CTRender("div",{class:"buttons"},window.__CTRender(p.CTButton,{class:"button",type:"primary",width:"auto",disabled:this.saveDisabled||!this.isOnline,onClick:this._saveChanges.bind(this)},this.translateI18nItem(f.SAVE)),window.__CTRender(p.CTButton,{class:"button",type:"secondary",width:"auto",disabled:!this.isOnline,onClick:this._cancelChanges.bind(this)},this.translateI18nItem(f.CANCEL))))}return window.__CTRender("div",{class:"named-info"},window.__CTRender("div",{class:"subject"},this.renderHtml(g.formatText(this.conversation.subject),"named_info_title")),this.conversation.description&&window.__CTRender("div",{class:"description"},this.renderHtml(g.formatText(this.conversation.description),"named_info_description")),e&&window.__CTRender("div",{class:"buttons"},window.__CTRender(p.CTButton,{class:"button",type:"secondary",width:"auto",disabled:!this.isOnline,onClick:this._enterEditMode.bind(this)},this.translateI18nItem(f.EDIT))))}_renderParticipants(){return window.__CTRender("div",{class:"participant-list"},this.usersToDisplay.map(e=>this._renderContact(e)))}_renderContact(e){if(!e)return null;const t=this.conversation.participants.find(t=>m.jidsMatch(t.jid,e.jid))||null;if(!t)return null;const n=this._config.namedSettings,i=n&&this._getRoleString(t)||null,o=n&&this._getRoleClass(t)||null,s=g.buildStyles({});return i&&(s.paddingRight="60px"),window.__CTRender("div",{class:"participant",onClick:()=>this._showContactInfo(e)},window.__CTRender(p.CTUserTile,{user:e,detailStyle:s},i&&window.__CTRender("div",{class:"badges",slot:"additional"},window.__CTRender("div",{class:`badge ${o}`},i))))}_renderFooter(){return window.__CTRender("div",{class:"footer"},window.__CTRender(p.CTButton,{type:"secondary",width:"auto",disabled:!this.isOnline,onClick:this._addContacts.bind(this)},this.translateI18nItem(f.ADD_MORE_CONTACTS)))}_enterEditMode(){this.saveDisabled=!0,this.editMode=!0}_onChangeNamedConversationDetail(e){e&&"subject"===e.key&&(this._namedConversationSubject=e.value),e&&"description"===e.key&&(this._namedConversationDescription=e.value);const t=!this._config.subjectRequired||this._namedConversationSubject.trim().length>0,n=!this._config.descriptionRequired||this._namedConversationDescription.trim().length>0,i=this.conversation.subject!==this._namedConversationSubject||this.conversation.description!==this._namedConversationDescription;this.saveDisabled=!t||!n||!i}_saveChanges(){return o(this,void 0,void 0,function*(){this.saveDisabled||(yield this.layer.updateNamedConversation(this.conversation,this._namedConversationSubject.trim(),this._namedConversationDescription.trim()))&&(this.editMode=!1)})}_cancelChanges(){this._namedConversationSubject=this.conversation.subject,this._namedConversationDescription=this.conversation.description,this.editMode=!1}_back(){return o(this,void 0,void 0,function*(){this.conversation&&(yield this.layer.setCurrentConversation(this.conversation)),this.editMode?this._cancelChanges():this.emitComponentEvent("go-back"),this.layer.popBackHandler()})}_addContacts(){this.emitComponentEvent("go-add-contacts")}_goChat(){this.emitComponentEvent("go-chat")}_showContactInfo(e){this.layer.showContactInfo(e,this.conversation,!0,this._goChat.bind(this))}_getCurrentRoleString(){switch(this._me&&this._me.role){case a.ChatRole.Administrator:return this.translateI18nItem(f.CURRENT_ROLE_ADMINISTRATOR);case a.ChatRole.Owner:return this.translateI18nItem(f.CURRENT_ROLE_OWNER);default:return null}}_getRoleString(e){switch(e&&e.role){case a.ChatRole.Administrator:return this.translateI18nItem(f.ADMIN);case a.ChatRole.Owner:return this.translateI18nItem(f.OWNER);default:return null}}_getRoleClass(e){switch(e&&e.role){case a.ChatRole.Administrator:return"admin";case a.ChatRole.Owner:return"owner";default:return null}}}i([s.prop({type:Object,attribute:!1,default:null})],v.prototype,"conversation",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],v.prototype,"editMode",void 0),i([s.prop({type:Boolean,attribute:!1,default:!0})],v.prototype,"saveDisabled",void 0),i([s.prop({type:Array,attribute:!1,default:[]})],v.prototype,"usersToDisplay",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],v.prototype,"isLoading",void 0),t.CTCLConversationInfo=v,v.register()},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(17),a=n(0),l=n(12),c=n(16),d=n(18),h=n(21),u=n(35),p=n(6),g=n(11),m=n(8),f=n(47),_=n(22),v=n(5),y=n(13),C=n(24),w=n(30),b=n(340),E=n(27);var T;!function(e){e[e.NO_UNREAD="No Unread Conversations"]="NO_UNREAD",e[e.UNREAD_COUNT="{{number}} Unread Conversation(s)"]="UNREAD_COUNT",e[e.NO_CONVERSATIONS="You do not have any conversations"]="NO_CONVERSATIONS",e[e.NO_MATCH="No conversations match that filter"]="NO_MATCH",e[e.FILTER_PLACEHOLDER="Filter: Subject/Participant"]="FILTER_PLACEHOLDER",e[e.SUBJECT="Subject"]="SUBJECT",e[e.EXPIRED="Expired"]="EXPIRED",e[e.YOU="You"]="YOU",e[e.CLOSED="Closed"]="CLOSED"}(T||(T={}));class R{static _create(){return new r.Metadata(I,T)}static get instance(){return this._instance||(this._instance=this._create())}}R._instance=null,t.CTCLConversationListMetadata=R;class I extends l.CTCLComponent{constructor(){super(),this.TILE_HEIGHT=70,this._filterType="",this._filterTerm="",this._onFilterChange=((e,t)=>{this._filterType=e,this._filterTerm=t,this._updateVirtualList()}),this.setMetadata(R.instance),this._virtualList=new _.VirtualList(this,[],{itemHeight:this.TILE_HEIGHT,itemKeyGetter:e=>e.id,blockSize:10})}static get is(){return"ct-cl-conversation-list"}initialize(e){const t=e=>super[e];return o(this,void 0,void 0,function*(){yield t("initialize").call(this,e),this._userLookup=new u.UserLookup(this.layer),this.addListeners([p.ChatEvents.AutoReconnected,p.ChatEvents.PostLoginComplete],()=>{this.debounce("update-after-connect",()=>o(this,void 0,void 0,function*(){this._updateConversations()}))}),yield this._updateHeader(),this._updateUpdateBanner(),yield this.layer.comms.client.initUserDirectory(),this.isFetching=!0,yield this._updateConversations(),this.defer(()=>this._updateConversations()),this.layer.setBackHandler(()=>{this.layer.moveTaskToBack()})})}setupListeners(){this.addListeners([p.ChatEvents.ConversationAdded,p.ChatEvents.ConversationUpdated,p.ChatEvents.ConversationRemoved],()=>o(this,void 0,void 0,function*(){this.debounce("update",()=>o(this,void 0,void 0,function*(){this._updateHeader(),this._updateConversations()}))})),this.addListeners([p.ChatEvents.WorkspaceUserChanged,p.ChatEvents.FetchedDelegateAccounts],()=>o(this,void 0,void 0,function*(){this.debounce("update2",()=>{this._updateHeader(),this._updateConversations()})})),this.addListener(p.ChatEvents.ChatEntryReceivedInWorkspace,()=>o(this,void 0,void 0,function*(){this._updateHeader()})),this.addListener(p.ChatEvents.ConnectionStatusChange,e=>o(this,void 0,void 0,function*(){if(e.status===a.ConnectionStatus.Connected&&!this.title){const e=yield this.layer.getWorkspaceAccount();e&&(this.title=e.displayName)}})),this.layer.addNewVersionEventListener(()=>{this.layer.isUpdateRequired()||this._updateUpdateBanner()})}_generateFilterItems(){const e=this.layer.getConfiguredConversations().map(e=>e.name);return this._allConversations.forEach(t=>{t.config&&!e.includes(t.config.name)&&e.push(t.config.name)}),e.sort(),e}get generateComponentStyles(){return n(408)}generateComponentMarkup(){return window.__CTRender("div",{class:"conversation-list"},this._renderHeader(),window.__CTRender("div",{class:"filter"},window.__CTRender(f.CTSelectionTextFilter,{placeholder:this.translateI18nItem(T.FILTER_PLACEHOLDER),selectionItems:this.filterItems,onSearch:this._onFilterChange})),this._renderUpdateBanner(),window.__CTRender("div",{class:"column-headings"},window.__CTRender("div",{class:"type"},window.__CTRender("span",null,"Type")),window.__CTRender("div",{class:"from-to"},window.__CTRender("span",null,"From / To")),window.__CTRender("div",{class:"subject"},window.__CTRender("span",null,"Subject / Description")),window.__CTRender("div",{class:"last-response"},window.__CTRender("span",null,"Response / Time")),window.__CTRender("div",{class:"raised-at"},window.__CTRender("span",null,"Raised"))),this.isFetching&&window.__CTRender("div",{class:"fetching"},window.__CTRender(m.CTIcon,{width:"16",height:"16",icon:a.Icons.COMMON.LoadingSpinner,spin:!0})),!this.isFetching&&this._renderConversations(),this._renderActionSheet())}_renderHeader(){const e=0===this.unreadCount?this.translateI18nItem(T.NO_UNREAD):this.translateI18nItem(T.UNREAD_COUNT).replace("{{number}}",this.unreadCount.toString()),t=this.allUnreadCount>0;return window.__CTRender(d.CTCLHeader,{class:"header"},window.__CTRender("div",{slot:"left-action"},window.__CTRender(m.CTUserAvatar,{bgColor:"transparent",border:"1px solid white",blob:t,onclick:()=>this.emitEvent(p.ChatEvents.OpenAccountsMenu)})),window.__CTRender("div",{slot:"heading"},this.title),window.__CTRender("div",{slot:"sub-heading"},e),window.__CTRender("div",{slot:"right-action"},this._renderRightAction()))}_renderUpdateBanner(){return this.showUpdateBanner&&(void 0===this._filterTerm||0===this._filterTerm.length)&&window.__CTRender("div",{class:"update-banner"},window.__CTRender("div",{class:"icon"},window.__CTRender(m.CTIcon,{width:"16",height:"16",icon:a.Icons.COMMON.Bolt})),window.__CTRender("div",{class:"message"},"App Update Available"),window.__CTRender("div",null,window.__CTRender("button",{class:"button",onClick:()=>{this.layer.openUpdateSite()}},"Install v",this.updateNewVersion)))}_renderRightAction(){return 0===this.layer.getConfiguredConversations().length?null:this.updatingUserDirectory?window.__CTRender(m.CTIcon,{class:"action",width:"20",height:"20",icon:a.Icons.COMMON.LoadingSpinner,spin:!0}):window.__CTRender(m.CTIcon,{class:"action",width:"20",height:"20",icon:a.Icons.COMMON.PlusSign,onClick:this._startNew.bind(this)})}_renderConversations(){return this._allConversations&&0!==this._allConversations.length?0===this._virtualList.items.length?window.__CTRender("div",{class:"no-conversations"},this.translateI18nItem(T.NO_MATCH)):this._virtualList.render(this._renderConversation.bind(this),"conversations","conversations-content"):window.__CTRender("div",{class:"no-conversations"},this.translateI18nItem(T.NO_CONVERSATIONS))}_renderConversation(e,t){if(e.isProvisional)return;const n=this.layer.getWorkspaceJid(),i=new h.ConversationConfigReader(this.layer,e),o=["conversation",e.hasUnread&&(e.preview&&e.preview.from!==n||e.instigator!==n)?"unread":"read"];e.isClosed&&o.push("closed"),e.isClosed||"function"!=typeof this._onClickConversation||o.push("clickable");const s=c.getConversationTitle(e,this._userLookup,n,this.translateI18nItem(T.YOU)),r=e.description?e.description.substr(0,100):null,l=this._userLookup.get(e.instigator),d=l?l.displayName:"You",u=c.generateConversationTitleFromParticipants(this._userLookup,e.participants.filter(e=>e.jid!==n),n).substr(0,100)||"You",p=e.preview&&(0===v.daysFromNow(e.preview.date)?v.getFriendlyTime(e.preview.date):v.getFriendlyDate(e.preview.date,this))||null,g=0===v.daysFromNow(e.createdTime)?v.getFriendlyTime(e.createdTime):v.getFriendlyDate(e.createdTime,this);let f=i.name,_=i.colorCode;c.isExpiredConversation(e)?(f=i.name,_="#CCC"):i.alert&&(f=i.name,_=i.colorCode);const C=y.buildStyles({backgroundColor:_,color:_?y.decideTextColorFromBgColor(_):"#FFF"}),w=["badge"];if(i.alert){const t=this.layer.getWorkspaceJid(),n=e.participants.find(e=>v.jidsMatch(e.jid,this.layer.getWorkspaceJid())),o=this.layer.getCurrentUser()&&this.layer.getCurrentUser().group?this.layer.getCurrentUser().group.split(",").map(e=>e.trim()):[];(e.instigator!==this.layer.getWorkspaceJid()&&(!i.autoIncludeMembersInRoles.length||!i.autoIncludeMembersInRoles.some(e=>o.includes(e)))||n&&n.role===a.ChatRole.Participant)&&(c.isExpiredConversation(e)||e.acknowledgements&&e.acknowledgements.find(e=>e.jid===t)||w.push("blink"))}return window.__CTRender("div",Object.assign({class:o.join(" ")},t,{onClick:t=>this._onClickConversation(e,t,i)}),window.__CTRender(m.CTAvatarTile,{height:`${this.TILE_HEIGHT}px`,hatched:e.isClosed},this._renderAvatar(e,i),window.__CTRender("div",{class:"subject"},i.namedSettings&&!e.isClosed&&window.__CTRender("div",{class:w.join(" "),style:C},f),window.__CTRender("div",{class:"expanded"},window.__CTRender("div",{class:"from"},"From: ",d),window.__CTRender("div",{class:"to"},"To: ",u)),window.__CTRender("div",{class:"title"},s),this._renderSubjectLineIcon(e)),window.__CTRender("div",{class:"description"},window.__CTRender("div",{class:"subject-desc"},s),window.__CTRender("div",{class:"user-desc"},r)),e.preview&&window.__CTRender("div",{class:"preview"},window.__CTRender("div",{class:"mobile-preview"},this._renderPreviewLine(e.preview),window.__CTRender("div",{class:"when"},p),window.__CTRender("div",{class:"marker"})),window.__CTRender("div",{class:"desktop-preview"},this._renderPreviewLine(e.preview),window.__CTRender("div",{class:"when"},p))),window.__CTRender("div",{class:"raised-on"},window.__CTRender("span",null,g),window.__CTRender("div",{class:"marker"}))))}_renderAvatar(e,t){const n=this.layer.getWorkspaceJid(),i=e.participants.filter(e=>!v.jidsMatch(e.jid,n));if(e.isClosed)return window.__CTRender("div",{slot:"avatar",class:"avatar closed"},window.__CTRender("div",{class:"badge"},this.translateI18nItem(T.CLOSED)));if(t.alert)return window.__CTRender("div",{slot:"avatar",class:"avatar individual"},window.__CTRender(m.CTUserAvatar,{bgColor:e.isClosed?null:t.colorCode,defaultIcon:g.Icons.UI.AlertBellRinging,size:40}));if(1===i.length){const e=this._userLookup.get(i[0].jid);return window.__CTRender("div",{slot:"avatar",class:"avatar individual"},window.__CTRender(m.CTUserAvatar,{bgColor:t.colorCode||"#7b7e80",user:e,size:40}))}{const e=i.length.toString().length;let n="";3===e?n="small":4===e&&(n="smallest");const o=y.buildStyles({backgroundColor:t.colorCode,color:y.decideTextColorFromBgColor(t.colorCode)||"#FFF"});return window.__CTRender("div",{slot:"avatar",class:"avatar group",style:o},window.__CTRender(m.CTIcon,{class:"icon",width:"12",height:"12",icon:a.Icons.COMMON.Group}),window.__CTRender("div",{class:`count ${n}`},"+ ",i.length))}}_renderSubjectLineIcon(e){return e.isClosed?window.__CTRender("div",{class:"icon remove"},window.__CTRender(m.CTIcon,{width:"16",height:"16",icon:a.Icons.COMMON.CircleCross,onClick:t=>this._removeConversation(e,t)})):e.draft?!0===e.draft.error?window.__CTRender("div",{class:"icon error"},window.__CTRender(m.CTIcon,{width:"16",height:"16",icon:g.Icons.UI.Error})):e.draft?window.__CTRender("div",{class:"icon pending"},window.__CTRender(m.CTIcon,{width:"16",height:"16",icon:g.Icons.UI.Pencil})):void 0:null}_renderPreviewLine(e){if(!e)return null;return window.__CTRender("div",{class:"entry"},(()=>{const t=this.layer.getWorkspaceJid();switch(e.type){case a.ChatEntryType.Meta:const n=e,i=c.getChatMetaActivitySummaryText(n,this._userLookup,t,this,!1);return window.__CTRender("div",{class:"message"},i);case a.ChatEntryType.Chat:const o=e,s=this._userLookup.get(o.from),r=o.mine||e.from===t?this.translateI18nItem(T.YOU):v.formatUserName(s,v.NameFormat.PREFIX_INITIAL_LAST)||o.from,l=o.attachments&&o.attachments.length>0,d=["message"];l&&d.push("has-attachment");const h=c.getChatMessageTextForPreview(o,this);return window.__CTRender("div",{class:d.join(" ")},r,":"," ",l&&window.__CTRender("div",{class:"icon"},window.__CTRender(m.CTIcon,{width:"14",height:"14",icon:g.Icons.UI.Attachment})),l&&window.__CTRender("span",{class:"label"},this.renderHtml(h)),!l&&this.renderHtml(h))}})())}_renderActionSheet(){return window.__CTRender(E.CTCLDynamicActionSheet,{actions:this._setActionSheet()})}_startNew(){return o(this,void 0,void 0,function*(){if(this.layer.config.behaviour.updateUsersOnNewConversationClick){this.updatingUserDirectory=!0;try{yield this.layer.updateUserDirectory()}catch(e){console.error(e)}finally{this.updatingUserDirectory=!1,b.actionSheetHelper.showActionSheet("ct-cl-conversation-list")}}else b.actionSheetHelper.showActionSheet("ct-cl-conversation-list")})}_onClickConversation(e,t,n){return o(this,void 0,void 0,function*(){if(t.stopPropagation(),!e.isClosed){if(yield this.layer.setCurrentConversation(e,!1),n.alert){const t=e.participants.find(e=>v.jidsMatch(e.jid,this.layer.getWorkspaceJid())),i=this.layer.getCurrentUser()&&this.layer.getCurrentUser().group?this.layer.getCurrentUser().group.split(",").map(e=>e.trim()):[];if((e.instigator!==this.layer.getWorkspaceJid()&&(!n.autoIncludeMembersInRoles.length||!n.autoIncludeMembersInRoles.some(e=>i.includes(e)))||t&&t.role===a.ChatRole.Participant)&&!(c.isExpiredConversation(e)||e.acknowledgements&&e.acknowledgements.find(e=>e.jid===this.layer.getWorkspaceJid())))return void(yield this.layer.showConversationAlert(e,!0,!0))}this.emitComponentEvent("go-chat")}})}_removeConversation(e,t){return o(this,void 0,void 0,function*(){t.stopPropagation(),e.isClosed&&(yield this.layer.removeConversationById(e.id))})}_updateHeader(){return o(this,void 0,void 0,function*(){const e=yield this.layer.getWorkspaceAccount();e&&(this.title=e.displayName,this.allUnreadCount=this.layer.getTotalUnreadCount(e.jid),this.unreadCount=this.layer.getUnreadCountForUser(e.jid))})}_updateUpdateBanner(){return o(this,void 0,void 0,function*(){this.showUpdateBanner=this.layer.updateAvailable(),this.updateNewVersion=this.layer.newVersion()})}_updateConversations(){return o(this,void 0,void 0,function*(){const e=yield this.layer.getWorkspaceAccount();e&&(this._allConversations=yield this.layer.getConversationsForWorkspace(e.jid),yield this._userLookup.populate(this._allConversations),this.defer(()=>{this._updateVirtualList(),this.filterItems=this._generateFilterItems()}))})}_updateVirtualList(){return o(this,void 0,void 0,function*(){this.isFetching=!0;const e=this.layer.getWorkspaceJid(),t=c.prepareConversationsForList(this._userLookup,this._allConversations,e,this._filterType,this._filterTerm,this.layer);this._conversationHash=c.sortConversationsIntoHash(this._userLookup,this._allConversations,e,this._filterType,this._filterTerm,this.layer),this._virtualList.setItems(t),this.filterItems=this._generateFilterItems(),this.isFetching=!1,"ios"===C.getPlatformName()&&w.setApplicationIconBadgeNumber(this.layer.getTotalUnreadCount())})}_setActionSheet(){return this.layer.getConfiguredConversations().map(e=>({primaryText:e.name,subtitleText:e.shortDescription,action:()=>o(this,void 0,void 0,function*(){if(this.layer.config.behaviour.updateUsersOnNewConversationClick){this.updatingUserDirectory=!0;try{yield this.layer.updateUserDirectory()}catch(e){console.error(e)}finally{this.updatingUserDirectory=!1,this.emitComponentEvent("go-new-conversation"),setTimeout(()=>{this.layer.emit("new-conversation-data",e)},100)}}else this.emitComponentEvent("go-new-conversation",e)})}))}}i([s.prop({type:String,attribute:!1,default:""})],I.prototype,"title",void 0),i([s.prop({type:s.Stroolean,attribute:!1,default:!0})],I.prototype,"isFetching",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],I.prototype,"updatingUserDirectory",void 0),i([s.prop({type:Array,attribute:!1,default:[]})],I.prototype,"filterItems",void 0),i([s.prop({type:Number,attribute:!1,default:0})],I.prototype,"allUnreadCount",void 0),i([s.prop({type:Number,attribute:!1,default:0})],I.prototype,"unreadCount",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],I.prototype,"showUpdateBanner",void 0),i([s.prop({type:String,attribute:!1,default:""})],I.prototype,"updateNewVersion",void 0),t.CTCLConversationList=I,I.register()},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(29),r=n(1),a=n(15),l=n(0),c=n(12),d=n(51),h=n(6),u=n(11),p=n(8);var g;!function(e){e[e.ADD_AUDIO_ATTACHMENT="Add Audio Attachment"]="ADD_AUDIO_ATTACHMENT",e[e.NO_AUDIO_ATTACHED="No audio attached"]="NO_AUDIO_ATTACHED"}(g||(g={}));let m=class extends c.CTCLComponent{constructor(){super(...arguments),this._loadFromSource=!1,this.attachClick=(()=>o(this,void 0,void 0,function*(){const e=yield s.CtXmppClient.pickFile({mimeTypes:this.fileTypes});e&&e.length&&(this._loadFromSource=!0,this.audioSrc=e[0],this.callback&&this.callback(this.audioSrc))})),this._recordClick=(()=>o(this,void 0,void 0,function*(){this._loadFromSource=!1,this.audioSrc="",this.recordAudio=!this.recordAudio})),this._onRecordFinished=(e=>{this.callback&&this.callback(e)}),this._onRecordingDeleted=(()=>{this.audioSrc="",this._loadFromSource=!1,this.callback&&this.callback(this.audioSrc)})}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){this.addListener(h.ChatEvents.AudioRecordingStarted,()=>this.audioRecording=!0),this.addListener(h.ChatEvents.AudioRecordingStopped,()=>this.audioRecording=!1)}generateComponentMarkup(){return window.__CTRender("div",{class:"container"},window.__CTRender("h4",null,this.translateI18nItem(g.ADD_AUDIO_ATTACHMENT)),window.__CTRender("div",{class:"controls"},this.allowAttach&&window.__CTRender("div",{class:`action ${this.recordAudio||this.audioSrc?"disabled":""}`,onClick:this.recordAudio||this.audioSrc?null:this.attachClick},window.__CTRender(p.CTIcon,{width:"16",height:"16",icon:u.Icons.UI.MusicalNote})),this.allowRecord&&window.__CTRender("div",{class:`action ${this.audioSrc||this.audioRecording?"disabled":""}`,onClick:this.audioSrc||this.audioRecording?null:this._recordClick},window.__CTRender(p.CTIcon,{width:"16",height:"16",icon:u.Icons.UI.Microphone})),window.__CTRender("div",{class:"placeholder"},this.isLoading?window.__CTRender(p.CTIcon,{width:"16",height:"16",icon:l.Icons.COMMON.LoadingSpinner,spin:!0}):this.recordAudio||this.audioSrc?window.__CTRender(d.CTCLAudioRecorderPlayer,{onRecordingFinished:this._onRecordFinished,onAudioRemoved:this._onRecordingDeleted,showRecord:!this._loadFromSource,source:this.audioSrc,allowRemoval:!0}):window.__CTRender("p",null,this.translateI18nItem(g.NO_AUDIO_ATTACHED)))))}};i([r.prop({type:Array,attribute:!0,default:["audio/mp3","audio/mp4","audio/m4a"]})],m.prototype,"fileTypes",void 0),i([r.prop({type:Function,attribute:!1})],m.prototype,"callback",void 0),i([r.prop({type:Boolean,attribute:!1,default:!1})],m.prototype,"isLoading",void 0),i([r.prop({type:String,attribute:!1,default:null})],m.prototype,"audioSrc",void 0),i([r.prop({type:Boolean,attribute:!1,default:!1})],m.prototype,"recordAudio",void 0),i([r.prop({type:Boolean,attribute:!1,default:!1})],m.prototype,"audioRecording",void 0),i([r.prop({type:Boolean,attribute:!1,default:!0})],m.prototype,"allowAttach",void 0),i([r.prop({type:Boolean,attribute:!1,default:!0})],m.prototype,"allowRecord",void 0),m=i([a.component({tag:"ct-cl-audio-attachment",styles:[n(341)],i18nKeys:g})],m),t.CTCLAudioAttachment=m},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(25),r=n(14),a=n(50),l=n(21),c=n(65),d=n(45),h=n(13),u=n(1),p=n(17),g=n(0),m=n(8),f=n(13),_=n(5),v=n(12),y=n(6),C=n(78),w=n(11),b=n(18),E=n(19);var T;!function(e){e[e.EXPIRED_PRIORITY_CONVERSATION="Expired Priority Conversation"]="EXPIRED_PRIORITY_CONVERSATION",e[e.ACKNOWLEDGE="Acknowledge"]="ACKNOWLEDGE",e[e.MUTE="Mute"]="MUTE",e[e.CONVERSATION_IS_CLOSED="This conversation is closed."]="CONVERSATION_IS_CLOSED"}(T||(T={}));const R=s.getSource("PushNotification");class I{static _create(){return new p.Metadata(S,T)}static get instance(){return this._instance||(this._instance=this._create())}}I._instance=null,t.CTCLConversationAlertMetadata=I;const A=window;class S extends v.CTCLComponent{constructor(){super(),this._raisedBy="",this._to="",this._animationDuration=500,this._audioToPlay=null,this._autoDismissTimeout=null,this._attachmentAutoPlayedOnce=!1,this.mute=(()=>{this.layer.mute(),this.muted=!0,this.userInitiated=!0,this._stopAudio()}),this.setMetadata(I.instance),this._onDownloadCompleted=this._onDownloadCompleted.bind(this),this._onActionSheetOpen=this._onActionSheetOpen.bind(this)}initialize(e){const t=e=>super[e];return o(this,void 0,void 0,function*(){yield t("initialize").call(this,e)})}setupListeners(){}_setupListeners(){this.setupConnectionStatusListener(e=>{e.online&&!0===this.muted&&!1===this.disableMute&&this.emitEvent(y.ChatEvents.ResumeAlertAfterPlayingAudio)}),this.addListener(r.BaseEvents.AuthenticationCredentialsReset,()=>o(this,void 0,void 0,function*(){yield this._resetAndClose()})),this.addListener(y.ChatEvents.PriorityConversationAcknowledgedOnAnotherDevice,()=>o(this,void 0,void 0,function*(){yield this.layer.clearPendingAlert(this.conversation),yield this._resetAndClose()})),this.addListener(y.ChatEvents.MuteAlertToPlayOtherAudio,()=>{this.disableMute=!0}),this.addListener(y.ChatEvents.ResumeAlertAfterPlayingAudio,()=>{this.muted=!1,this.disableMute=!1}),this.addListener(y.ChatEvents.ConversationClosed,e=>o(this,void 0,void 0,function*(){yield this.layer.clearPendingAlert(e.conversation),this.conversation&&this.conversation.id!==e.conversation.id?this.forceRedraw():yield this._resetAndClose()})),this.addListener(y.ChatEvents.DelegationRemoved,e=>o(this,void 0,void 0,function*(){if(this.conversation&&this.conversation.alertDelegates){const t=this.conversation.alertDelegates.findIndex(t=>t.jid===e);t>-1&&(this.conversation.alertDelegates.splice(t,1),this.conversation.alertDelegates.length<1?yield this._resetAndClose():(this._to=yield this._getConversationTo(),this.forceRedraw()))}})),this.addListener(y.ChatEvents.DelegatationRelinquish,e=>o(this,void 0,void 0,function*(){if(this.conversation.alertDelegates){this.conversation.alertDelegates.find(t=>t.jid==e.jid)&&this._resetAndClose()}})),this.addListener(r.BaseEvents.AudioLoopingEnd,()=>{if(null!==this._audioToPlay&&this.conversation&&this.conversation.config.behaviour.alert&&this.conversation.config.behaviour.alert.automaticallyPlayAudioOnDownload)this.layer.emit(y.ChatEvents.RemotelyStartAudioPlayer),this._attachmentAutoPlayedOnce=!0,this._audioToPlay=null;else if(this.audioAttachmentSrc&&this.conversation&&this.conversation.config.behaviour.alert&&this.conversation.config.behaviour.alert.automaticallyPlayAudioOnDownload)this._playAudio(this.conversation.config.behaviour.alert.alertSoundFilename,1,this.conversation.config.behaviour.alert.alertVolume,c.VolumeStream.Alarm);else{if(!0===this.userInitiated)return void A.vibrationController.stop();this._autoDismissTimeout=setTimeout(()=>o(this,void 0,void 0,function*(){!0!==this.userInitiated&&(yield this._resetAndClose(),R&&R.cancelAtFront())}),3e3)}}),this.addListener(y.ChatEvents.MuteAlertToPlayOtherAudio,e=>{e.userInitiated&&(this.userInitiated=!0,this._stopAudio())}),this.addListener(y.ChatEvents.ResumeAlertAfterPlayingAudio,e=>{e&&"pause"===e.event||!0===this.userInitiated?A.vibrationController.stop():e&&"ended"===e.event&&(this.layer.logger.log(E.LoggerTypes.Other,"Audio attachment has stopped playing, creating auto-dismiss timeout..."),this._autoDismissTimeout=setTimeout(()=>o(this,void 0,void 0,function*(){!0!==this.userInitiated?(yield this._resetAndClose(),R&&R.cancelAtFront()):A.vibrationController.stop()}),3e3))})}show(e,t,n=!1){return o(this,void 0,void 0,function*(){const i=e||this.layer.getNewestPendingAlert();if(i){if(this.conversation&&i.id===this.conversation.id)return;if(yield this._resetAndClose(),this.animateAlert=t,this.userInitiated=n,this._setupListeners(),this.conversation=i,this.conversation.userInitiated=this.userInitiated,this._config=new l.ConversationConfigReader(this.layer,this.conversation),this._raisedBy=yield this._getConversationStarter(),this._to=yield this._getConversationTo(),this.showing=!1,this.layer.currentlyAlerting=!1,this.muted=!1,!n&&this._config.alert&&(this._playAudio(this._config.alertSoundFilename,this._config.alertSoundLoops,this._config.alertVolume,_.enumFromString(this._config.alertAudioStream)),this._config.vibrate&&A.vibrationController.vibrate(this._config.vibrateDuration,this._config.vibrateIterations,this._config.forceVibrate)),yield _.sleep(t?this._animationDuration:0),this.conversation.attachments&&this.conversation.attachments.length){const e=this.conversation.attachments.find(e=>e.type===w.SupportedAttachmentType.IMAGE),t=this.conversation.attachments.find(e=>e.type===w.SupportedAttachmentType.AUDIO),n=this.conversation.attachments.find(e=>e.type===w.SupportedAttachmentType.VIDEO);e&&(this.imgAttachmentSrc=e.local||e.path),t&&(this.audioAttachmentSrc=t.local||t.path),n&&(this.videoAttachmentSrc=n.local||n.path)}this.layer.addToIgnoreList(this.conversation),this.showing=!0,this.layer.currentlyAlerting=!0}})}_playAudio(e,t,n,i){A.simpleAudioPlayer.setAudio(e,t,n,i),A.simpleAudioPlayer.play()}get generateComponentStyles(){return n(343)}generateComponentMarkup(){return this.showing&&this.conversation?window.__CTRender("div",{class:"chat-conversation-alert"},this._renderHeader(),this._renderAttachment(),this._renderDescription(),this._renderFooter()):null}static get is(){return"ct-cl-conversation-alert"}_renderHeader(){const e=this.conversation.subject,t=this._config.name,n=(this._config.colorCode&&this._colorLuminance(this._config.colorCode,-.05),this._config.colorCode?this._colorLuminance(this._config.colorCode,-.1):null);return[window.__CTRender(b.CTCLHeader,{class:"header",backgroundColor:this._config.colorCode},window.__CTRender("div",{slot:"left-action"}),window.__CTRender("div",{slot:"heading"},this.renderHtml(h.formatText(e),"conversation_alert_heading")),window.__CTRender("div",{slot:"sub-heading"},t),window.__CTRender("div",{slot:"right-action"},this._renderPendingCount())),window.__CTRender("div",{class:"header-priority-details",style:f.buildStyles({backgroundColor:n})},window.__CTRender("div",{class:"from"},window.__CTRender("p",{class:"name"},window.__CTRender("span",null,"From:")," ",this._raisedBy),window.__CTRender("p",{class:"time"},window.__CTRender("span",null,"At:")," ",_.getFriendlyTime(new Date(this.conversation.createdTime)))),this._to&&window.__CTRender("div",{class:"to"},window.__CTRender("p",null,window.__CTRender("span",null,"To:")," ",this._to)))]}_renderDescription(){if(!this.conversation.description)return null;const e=h.formatText(this.conversation.description.trim());return window.__CTRender("div",{id:"chat-description",class:"chat-description"},this.renderHtml(e,"conversation_alert_chat_description"))}_onDownloadCompleted(e){this._audioToPlay=e.filepath}_renderAttachment(){return this.conversation.attachments&&0===this.conversation.attachments.length?null:window.__CTRender("div",{class:"attachment"},this.videoAttachmentSrc&&window.__CTRender("div",{class:"video"},window.__CTRender(a.CTCLAttachmentHandler,{uri:this.videoAttachmentSrc,type:w.SupportedAttachmentType.VIDEO,conversationId:this.conversation.id})),this.audioAttachmentSrc&&window.__CTRender("div",{class:"audio"},window.__CTRender(a.CTCLAttachmentHandler,{uri:this.audioAttachmentSrc,type:w.SupportedAttachmentType.AUDIO,conversationId:this.conversation.id,stream:c.VolumeStream.Alarm,volumeToPlayAt:this._config.alertVolume,downloadCompletedCallback:this._onDownloadCompleted})),this.imgAttachmentSrc&&window.__CTRender("div",{class:"image"},window.__CTRender(a.CTCLAttachmentHandler,{uri:this.imgAttachmentSrc,type:w.SupportedAttachmentType.IMAGE,allowOpenImageInFullScreen:this._config.allowOpenInFullScreen,conversationId:this.conversation.id})))}_renderFooter(){return window.__CTRender("div",{class:"footer"},this._renderReplyTemplate(),f.renderIf(!this.muted&&!this.isOnline&&!this.userInitiated,window.__CTRender(m.CTButton,{type:"none",disabled:this.disableMute,className:"mute",onClick:e=>this.mute(),style:f.buildStyles({backgroundColor:this._config.colorCode})},window.__CTRender(m.CTIcon,{width:"16",height:"16",color:"#FFF",icon:g.Icons.COMMON.Mute}))))}_onActionSheetOpen(){this.userInitiated=!0}_renderReplyTemplate(){let e;const t=(e=this._config.alertResponseOptions&&0!==this._config.alertResponseOptions.length?this._config.alertResponseOptions[0]:w.defaultAlertResponseOption).options.map(e=>({primaryText:e.label,subtitleText:e.shortDescription,action:()=>this._acknowledgeAndDismiss(e.value),disabled:!this.isOnline,color:this._config.colorCode}));return[window.__CTRender(d.CTActionSheet,{buttons:t,openSheetButtonText:"Respond",openSheetBackgroundColor:this._config.colorCode,onOpen:this._onActionSheetOpen})]}_getConversationStarter(){return o(this,void 0,void 0,function*(){const e=yield this.layer.getUserByJid(this.conversation.instigator);return e.displayName||`${e.firstName}  ${e.lastName}`})}_getConversationTo(){return o(this,void 0,void 0,function*(){const e=[];if(this.conversation.alertDelegates)for(const t of this.conversation.alertDelegates)e.push(yield this.layer.getUserByJid(t.jid));return e.reduce((e,t,n,i)=>(e+=t.displayName,n<i.length-1&&(e+=", "),e),"")})}_acknowledgeAndDismiss(e){return o(this,void 0,void 0,function*(){yield this.layer.clearPendingAlert(this.conversation);const t=this.layer.getNewestPendingAlert(),n=t&&t.config&&t.config.behaviour&&t.config.behaviour.alert&&0===t.config.behaviour.alert.alertSoundLoops;if(this._isExpired(this.conversation)){yield this.emitEvent(y.ChatEvents.PriorityConversationAcknowledged,new C.PriorityConversationAcknowledgedEventArgs(this.conversation,this.layer.getPendingAlertCount()));const e=new g.DefaultAlerts(this).AlertAcknowledge(this.translateI18nItem(T.EXPIRED_PRIORITY_CONVERSATION),this.translateI18nItem(T.EXPIRED_PRIORITY_CONVERSATION),99999,{okay:()=>o(this,void 0,void 0,function*(){this.conversation.isClosed||!1===this._config.shouldOpenConversationAfterResponded?(this.conversation.hasUnread=!1,yield this.layer.updateConversation(this.conversation,{isParticipantChange:!1,overrideHasUnread:!0}),yield this._resetAndClose(),R&&R.cancelAtFront()):yield this._dismissAndGoToConversation(),n&&(yield this.layer.showConversationAlert(null,!0))})});yield this.emitEvent(y.ChatEvents._Request_RaiseAlert,e)}else if(this.conversation.isClosed){yield this.emitEvent(y.ChatEvents.PriorityConversationAcknowledged,new C.PriorityConversationAcknowledgedEventArgs(this.conversation,this.layer.getPendingAlertCount()));const e=new g.DefaultAlerts(this).AlertAcknowledge(this.translateI18nItem(T.CONVERSATION_IS_CLOSED),this.translateI18nItem(T.CONVERSATION_IS_CLOSED),1,{okay:()=>o(this,void 0,void 0,function*(){this.conversation.hasUnread=!1,yield this.layer.updateConversation(this.conversation,{isParticipantChange:!1,overrideHasUnread:!0}),yield this._resetAndClose(),n&&(yield this.layer.showConversationAlert(null,!0)),R&&R.cancelAtFront()})});yield this.emitEvent(y.ChatEvents._Request_RaiseAlert,e)}else{if(yield this.emitEvent(y.ChatEvents.RemotelyStopAudioPlayer),this.conversation.alertDelegates){for(const t of this.conversation.alertDelegates){const n=t.jid.toLowerCase(),i=e||"acknowledge";(yield this.layer.sendConversationAcknowledgement(this.conversation,i,n))&&(yield this._addLocalAckToConvo({jid:n,value:i,ts:(new Date).getTime()}))}this._addToIgnoreList(this.conversation)}else{const t=e||"acknowledge";(yield this.layer.sendConversationAcknowledgement(this.conversation,t))&&(yield this._addLocalAckToConvo({jid:this.layer.getCurrentUserJid(),value:t,ts:(new Date).getTime()})),this._addToIgnoreList(this.conversation)}this._config.shouldOpenConversationAfterResponded?yield this._dismissAndGoToConversation():yield this._resetAndClose(),n&&(yield this.layer.showConversationAlert(null,!0)),R&&R.cancelAtFront()}})}_addLocalAckToConvo(e){return o(this,void 0,void 0,function*(){this.conversation.acknowledgements.push(e),yield this.layer.updateConversation(this.conversation)})}_dismissAndGoToConversation(){return o(this,void 0,void 0,function*(){yield this.layer.setCurrentConversation(this.conversation,!1),this._goChatFunction&&this._goChatFunction instanceof Function&&this._goChatFunction(),this.conversation=null,this._config=null,this.imgAttachmentSrc="",this.audioAttachmentSrc="",this.videoAttachmentSrc="",yield this.dismiss()})}_addToIgnoreList(e){return this.layer.addToIgnoreList(e)}_isExpired(e){const t=e.createdTime+1e3*e.expiryTTL;return(new Date).getTime()>t}_stopAudio(){A.simpleAudioPlayer.stop(!0),A.simpleAudioPlayer.release(),A.vibrationController.stop()}_resetAndClose(){return o(this,void 0,void 0,function*(){clearTimeout(this._autoDismissTimeout),this._stopAudio(),this.conversation=null,this._config=null,this.imgAttachmentSrc="",this.audioAttachmentSrc="",this.videoAttachmentSrc="",this.showing=!1,this.layer.currentlyAlerting=!1,this.unsubscribeListeners(),this._attachmentAutoPlayedOnce=!1,yield _.sleep(this.animate?this._animationDuration:0)})}dismiss(){return o(this,void 0,void 0,function*(){this.showing=!1,this.layer.currentlyAlerting=!1,yield _.sleep(this.animate?this._animationDuration:0)})}_colorLuminance(e,t){(e=String(e).replace(/[^0-9a-f]/gi,"")).length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;let n,i,o="#";for(i=0;i<3;i++){n=parseInt(e.substr(2*i,2),16);const s=Math.round(Math.min(Math.max(0,n+n*t),255)).toString(16);o+=("00"+s).substr(s.length)}return o}_renderPendingCount(){return f.renderIf(this.layer.getPendingAlertCount()>1,window.__CTRender("div",{id:"pending-count",class:"pending-count",style:f.buildStyles({backgroundColor:this._config.colorCode})},this.layer.getPendingAlertCount()-1))}setShowChatFunction(e){this._goChatFunction=e}conversationClosed(e){return o(this,void 0,void 0,function*(){this.conversation&&this.conversation.roomJid===e.roomJid&&(yield this.emitEvent(y.ChatEvents.PriorityConversationAcknowledged,new C.PriorityConversationAcknowledgedEventArgs(this.conversation,this.layer.getPendingAlertCount())),this.conversation.isClosed=!0)})}}i([u.prop({type:Object,attribute:!1,default:null})],S.prototype,"conversation",void 0),i([u.prop({type:Boolean,attribute:!0,default:!0})],S.prototype,"animateAlert",void 0),i([u.prop({type:Boolean,attribute:!0,default:!0})],S.prototype,"userInitiated",void 0),i([u.prop({type:Boolean,attribute:!0,default:!1})],S.prototype,"showing",void 0),i([u.prop({type:Boolean,attribute:!1,default:!1})],S.prototype,"muted",void 0),i([u.prop({type:String,attribute:!1,default:""})],S.prototype,"imgAttachmentSrc",void 0),i([u.prop({type:String,attribute:!1,default:""})],S.prototype,"audioAttachmentSrc",void 0),i([u.prop({type:String,attribute:!1,default:""})],S.prototype,"videoAttachmentSrc",void 0),i([u.prop({type:Boolean,attribute:!1,default:!1})],S.prototype,"disableMute",void 0),t.CTCLConversationAlert=S,S.register()},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(29),r=n(1),a=n(15),l=n(0),c=n(12),d=n(11),h=n(8),u=n(30);var p;!function(e){e[e.ADD_IMAGE_ATTACHMENT="Add image attachment"]="ADD_IMAGE_ATTACHMENT",e[e.NO_IMAGE="No image attached"]="NO_IMAGE"}(p||(p={}));let g=class extends c.CTCLComponent{constructor(){super(...arguments),this.fullImagePath="",this.imgPreviewHeight=122,this.imgPreviewWidth=122,this.attachClick=(()=>o(this,void 0,void 0,function*(){const e=yield s.CtXmppClient.pickFile({mimeTypes:this.fileTypes,encrypt:!0});if(e&&e.length){this.isLoading=!0;const t=yield u.getThumbnail(e[0],this.imgPreviewWidth,this.imgPreviewHeight,100);this.imgSrc=t,this.fullImagePath=e[0],this.isLoading=!1,this.callback&&this.callback(this.fullImagePath)}})),this.cameraClick=(()=>o(this,void 0,void 0,function*(){try{const e=yield this.layer.captureOrSelectMedia();this.isLoading=!0,e.base64=yield u.getThumbnail(e.path,this.imgPreviewWidth,this.imgPreviewHeight,100),this.imgSrc=e.base64,this.fullImagePath=e.path,this.isLoading=!1,this.callback&&this.callback(this.fullImagePath)}catch(e){console.error(e)}})),this.removeImg=(()=>{this.imgSrc="",this.fullImagePath=""})}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){}generateComponentMarkup(){return window.__CTRender("div",{class:"container"},window.__CTRender("h4",null,this.translateI18nItem(p.ADD_IMAGE_ATTACHMENT)),window.__CTRender("div",{class:"controls"},window.__CTRender("div",{class:`action ${this.imgSrc||this.isLoading?"disabled":""}`,onClick:this.cameraClick},window.__CTRender(h.CTIcon,{width:"16",height:"16",icon:d.Icons.UI.Attachment})),window.__CTRender("div",{class:`action ${this.imgSrc||this.isLoading?"disabled":""}`,onClick:this.attachClick},window.__CTRender(h.CTIcon,{width:"16",height:"16",icon:d.Icons.UI.Photo})),window.__CTRender("div",{class:"placeholder"},this.isLoading?window.__CTRender(h.CTIcon,{width:"16",height:"16",icon:l.Icons.COMMON.LoadingSpinner,spin:!0}):this.imgSrc?[window.__CTRender("div",{class:"action",onClick:this.removeImg},window.__CTRender(h.CTIcon,{width:"16",height:"16",icon:d.Icons.UI.Cross})),window.__CTRender("img",{src:this.imgSrc,height:this.imgPreviewHeight,width:this.imgPreviewWidth})]:window.__CTRender("p",null,this.translateI18nItem(p.NO_IMAGE)))))}};i([r.prop({type:Array,attribute:!0,default:["image/jpeg","image/png"]})],g.prototype,"fileTypes",void 0),i([r.prop({type:Function,attribute:!1})],g.prototype,"callback",void 0),i([r.prop({type:Boolean,attribute:!1,default:!1})],g.prototype,"isLoading",void 0),i([r.prop({type:String,attribute:!1,default:null})],g.prototype,"imgSrc",void 0),g=i([a.component({tag:"ct-cl-image-attachment",styles:[n(345)],i18nKeys:p})],g),t.CTCLImageAttachment=g},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(14),a=n(17),l=n(0),c=n(12),d=n(16),h=n(90),u=n(18),p=n(92),g=n(94),m=n(21),f=n(349),_=n(11),v=n(8),y=n(357),C=n(5),w=n(0),b=n(20),E=n(6),T=n(27);var R,I,A;!function(e){e[e.SELECT_CONTACTS="Select Contacts"]="SELECT_CONTACTS",e[e.CHOOSE_CONTACT=""]="CHOOSE_CONTACT",e[e.TOTAL_CONTACTS="Total {{number}} Contacts Added"]="TOTAL_CONTACTS",e[e.TOTAL_CONTACTS_MAX="Total {{number}} Contacts Added (out of {{maximum}})"]="TOTAL_CONTACTS_MAX",e[e.SEARCH_PLACEHOLDER="Find Contacts"]="SEARCH_PLACEHOLDER",e[e.INITIAL_MESSAGE="Find your contacts using the search bar above"]="INITIAL_MESSAGE",e[e.NO_MATCHES="No contacts match your search"]="NO_MATCHES",e[e.DIRECT="Direct"]="DIRECT",e[e.NAMED="Named"]="NAMED",e[e.NAMED_CONVERSATION="Named Conversation"]="NAMED_CONVERSATION",e[e.ADD_SUBJECT_AND_DESCRIPTION="Add a Subject & Description"]="ADD_SUBJECT_AND_DESCRIPTION",e[e.SUBJECT="Subject"]="SUBJECT",e[e.DESCRIPTION_OPTIONAL="Description (optional)"]="DESCRIPTION_OPTIONAL",e[e.CREATE="Create"]="CREATE",e[e.NEXT="Next"]="NEXT",e[e.CREATING_CONVERSATION="Creating conversation"]="CREATING_CONVERSATION",e[e.THIS_PRIORITY_WILL_POP_UP_WARNING="Selecting this priority will cause a pop-up on the recipient's device, are you sure?"]="THIS_PRIORITY_WILL_POP_UP_WARNING",e[e.WARN_NO_CONTACTS="You have not selected any contacts. Are you sure you wish to proceed?"]="WARN_NO_CONTACTS",e[e.OPTIONS="Options"]="OPTIONS",e[e.PARTICIPANT_ERROR="You cannot create this conversation without selecting contacts first."]="PARTICIPANT_ERROR"}(R||(R={}));class S{static _create(){return new a.Metadata(x,R)}static get instance(){return this._instance||(this._instance=this._create())}}S._instance=null,t.CTCLNewConversationMetadata=S,function(e){e[e.CONTACT_LIST=0]="CONTACT_LIST",e[e.NAMED_CONVERSATION_DETAILS=1]="NAMED_CONVERSATION_DETAILS"}(I||(I={})),function(e){e.DIRECT_CONVERSATION="Direct Conversation"}(A||(A={}));class x extends c.CTCLComponent{constructor(){super(),this._namedConversationSubject="",this._namedConversationDescription="",this._pendingConversationId=null,this._alertResponseOption=_.defaultAlertResponseOption,this._newPageOptions=f.generateDefaultNewPage(),this._attachments=[],this._contactsCountIncludingGroupParticipants=0,this._startDirectConversation=(()=>o(this,void 0,void 0,function*(){const e=yield this._getConversationParticipants(!1);yield this._resetUserList();const t=yield this.layer.getDirectConversationByParticipants(e);if(t)yield this.layer.setCurrentConversation(t),this.emitComponentEvent("go-chat");else{const t=d.createProvisionalDirectConversation(e,this._config.constructConfigurationToSend());yield this.layer.setProvisionalConversation(t),this.emitComponentEvent("go-chat")}})),this._goToNamedConversationDetailsStep=(()=>o(this,void 0,void 0,function*(){this.step=I.NAMED_CONVERSATION_DETAILS})),this._onReplyTemplateChange=(e=>{const t=this._config.alertResponseOptions[e];this._alertResponseOption=t||_.defaultAlertResponseOption}),this._setImgAttachment=(e=>{this._attachments.filter(e=>e.type===_.SupportedAttachmentType.IMAGE).forEach((e,t)=>this._attachments.splice(t,1)),e&&this._attachments.push({path:e,type:_.SupportedAttachmentType.IMAGE})}),this._setAudioAttachment=(e=>{const t=!this._config.subjectRequired||this._namedConversationSubject.trim().length>0,n=!this._config.descriptionRequired||this._namedConversationDescription.trim().length>0;t&&n&&(this.createNamedConversationDisabled=!1),this.isRecording=!1,this._attachments.filter(e=>e.type===_.SupportedAttachmentType.AUDIO).forEach((e,t)=>this._attachments.splice(t,1)),e&&this._attachments.push({path:e,type:_.SupportedAttachmentType.AUDIO})}),this._setVideoAttachment=(e=>{this._attachments.filter(e=>e.type===_.SupportedAttachmentType.VIDEO).forEach((e,t)=>this._attachments.splice(t,1)),e&&this._attachments.push({path:e,type:_.SupportedAttachmentType.VIDEO})}),this._onEnableChatChange=(e=>{this._newPageOptions.enableChat=e}),this.setMetadata(S.instance)}static get is(){return"ct-cl-new-conversation"}initialize(){return o(this,void 0,void 0,function*(){this.layer.setBackHandler(()=>{this._back()})})}setupListeners(){this.setupConnectionStatusListener(),this.addListener(E.ChatEvents.ConversationAdded,e=>o(this,void 0,void 0,function*(){this._pendingConversationId&&this._pendingConversationId===e.conversation.id&&(this._pendingConversationId=null,yield this._resetUserList(),yield this.layer.setCurrentConversation(e.conversation),yield this.dismissWaitingMessage(),this.emitComponentEvent("go-chat"))})),this.addListener(r.BaseEvents.ConnectionStatusChange,e=>{e.status===l.ConnectionStatus.Disconnected&&this.dismissWaitingMessage()},{dontSuppress:!0}),this.addListener(E.ChatEvents.AudioRecordingStarted,()=>{this.isRecording=!0,this.createNamedConversationDisabled=!0}),this.addListener("new-conversation-data",e=>{this._selectedConversationType=e,this.forceRedraw()})}get generateComponentStyles(){return n(360)}generateComponentMarkup(){return window.__CTRender("div",{class:"new-conversation"},this._renderHeader(),this._renderContactList(),this._renderNamedConversationDetails(),this._renderFooter())}_renderHeader(){const e=this.layer.config.behaviour.maxConversationParticipants||0,t=0===e?this.translateI18nItem(R.TOTAL_CONTACTS):this.translateI18nItem(R.TOTAL_CONTACTS_MAX),n=null!==this.showCountFrom&&this._contactsCountIncludingGroupParticipants>=this.showCountFrom?t.replace("{{number}}",this._contactsCountIncludingGroupParticipants.toString()).replace("{{maximum}}",(e-1).toString()):this.translateI18nItem(R.CHOOSE_CONTACT);let i="",o="";return this.step===I.CONTACT_LIST&&(i=this.translateI18nItem(R.SELECT_CONTACTS),o=n),this.step===I.NAMED_CONVERSATION_DETAILS&&(i=this._config.name,o=this._config.shortDescription),window.__CTRender(u.CTCLHeader,{class:"header"},window.__CTRender("div",{slot:"left-action"},window.__CTRender(v.CTIcon,{class:"action",width:"20",height:"20",icon:l.Icons.COMMON.ChevronLeft,onClick:this._back.bind(this)})),window.__CTRender("div",{slot:"heading"},i),o&&window.__CTRender("div",{slot:"sub-heading"},o))}_renderContactList(){const e=this.layer.getWorkspaceJid(),t=this.layer.config.behaviour.maxConversationParticipants,n={excludeUsers:[e],allowSearch:this.allowSearch,requireSearch:this.requireSearch,excludeGroupsWithHash:!0,searchPlaceholder:this.translateI18nItem(R.SEARCH_PLACEHOLDER),initialMessage:this.translateI18nItem(R.INITIAL_MESSAGE),noMatchesMessage:this.translateI18nItem(R.NO_MATCHES),allowSelection:!0,maxSelections:t-1,disableSelection:this._contactsCountIncludingGroupParticipants>=this.layer.config.behaviour.maxConversationParticipants-1,onChangeSelection:(e,t)=>{this._contactsCountIncludingGroupParticipants=t,this.selectedParticipantCount=e.length},onClickUser:e=>{e.users||this.layer.showContactInfo(e,null,!1)},onClickGroup:e=>this.layer.showRoleUsersModal(e),onGroupSelectionShowError:e=>e>this.layer.config.behaviour.maxConversationParticipants-1},i=["contact-list"];return this.step!==I.CONTACT_LIST&&i.push("hidden"),window.__CTRender("div",{class:i.join(" ")},window.__CTRender(T.CTUserList,Object.assign({id:"user-list"},n)))}_renderNamedConversationDetails(){if(!this._config)return null;const e=["named-conversation-details"];this.step!==I.NAMED_CONVERSATION_DETAILS&&e.push("hidden");const t=this._config.maxSubjectLength,n=this._config.maxDescriptionLength;return window.__CTRender("div",{class:e.join(" ")},window.__CTRender("div",{class:"form-item subject"},window.__CTRender(v.CTTextbox,{type:"text",name:"subject",max:t,required:this._config.subjectRequired,fullBorder:!0,placeholder:this._config.subjectFieldLabel,callback:e=>this._onChangeNamedConversationDetail(e),focusOnRender:!0})),window.__CTRender("div",{class:"form-item description"},window.__CTRender(v.CTTextbox,{type:"textarea",name:"description",max:n,required:this._config.descriptionRequired,fullBorder:!0,placeholder:this._config.descriptionFieldLabel,callback:e=>this._onChangeNamedConversationDetail(e)})),this._config.alert&&this._renderResponseOptions(),this._config.image&&window.__CTRender("div",null,window.__CTRender("hr",null),window.__CTRender(p.CTCLImageAttachment,{callback:this._setImgAttachment}),window.__CTRender("hr",null)),this._config.audio&&window.__CTRender("div",null,window.__CTRender(h.CTCLAudioAttachment,{callback:this._setAudioAttachment,allowAttach:this._config.attachPreRecordedFile,allowRecorc:this._config.attachLiveRecordedAudio}),window.__CTRender("hr",null)),this._config.video&&window.__CTRender("div",null,window.__CTRender(g.CTCLVideoAttachment,{callback:this._setVideoAttachment}),window.__CTRender("hr",null)),"user-choice"===this._config.chatAvailable&&window.__CTRender(y.CTSingleCheckbox,{label:"Enable chat",value:!0,callback:this._onEnableChatChange}))}_renderResponseOptions(){if(!this._config.alertResponseOptions)return null;const e=[...this._config.alertResponseOptions];0===this._config.alertResponseOptions.length&&e.push(_.defaultAlertResponseOption);const t=e.map((e,t)=>({key:t,value:e.name}));return window.__CTRender("div",null,window.__CTRender("div",{class:"form-item priority"},window.__CTRender(v.CTSelectionList,{name:"priority",options:t,selected:0,forceDropdown:!0,onSelect:this._onReplyTemplateChange})))}_renderFooter(){return window.__CTRender("div",{class:"footer"},this._renderFooterButtons())}_renderFooterButtons(){let e=!1,t=R.NEXT;return this._selectedConversationType&&this._selectedConversationType.name===A.DIRECT_CONVERSATION&&(e=this._selectedConversationType.behaviour.errorWhenNoContacts&&this._selectedConversationType.behaviour.errorWhenNoContacts,t=R.CREATE),this.step===I.CONTACT_LIST?[window.__CTRender(v.CTButton,{type:"primary",class:"button",disabled:!this.isOnline||e,onClick:()=>{this._startNewConversation(this._selectedConversationType)}},this.translateI18nItem(t))]:this.step===I.NAMED_CONVERSATION_DETAILS?[window.__CTRender(v.CTButton,{type:"primary",class:"button",disabled:!this.isOnline||this.createNamedConversationDisabled,onClick:this._startNamedConversation.bind(this)},this.translateI18nItem(R.CREATE))]:void 0}_back(){return o(this,void 0,void 0,function*(){this.step===I.CONTACT_LIST&&(yield this._resetUserList(),this.emitComponentEvent("go-back")),this.step===I.NAMED_CONVERSATION_DETAILS&&(this.step=I.CONTACT_LIST,setTimeout(()=>{const e=this.shadowRoot.querySelector("#user-list");e&&e.forceRecalcList()},250)),this.layer.popBackHandler()})}_startNewConversation(e){if(this._config=new m.ConversationConfigReader(this.layer,null,e),this._config.alertResponseOptions.length<1?this._alertResponseOption=_.defaultAlertResponseOption:this._alertResponseOption=this._config.alertResponseOptions[0],e&&e.behaviour.attachments){let t=!0;e.behaviour.attachments.audio&&(!0===e.behaviour.attachments.audio.attachLiveRecordedAudio&&(t=!1),!0===e.behaviour.attachments.audio.attachPreRecordedFile&&(t=!1)),!0===e.behaviour.attachments.audio&&(t=!1),(!1===e.behaviour.attachments.audio||t)&&(this._attachments=this._attachments.filter(e=>e.type!=_.SupportedAttachmentType.AUDIO)),0==e.behaviour.attachments.image&&(this._attachments=this._attachments.filter(e=>e.type!=_.SupportedAttachmentType.IMAGE))}else this._attachments=[];if(0===this.selectedParticipantCount&&this._config.errorWhenNoContacts){const e=new w.DefaultAlerts(this).AlertErrorWithOkayButton(this.translateI18nItem(b.CommonMetadata.getI18nItem(b.CommonI18nKeys.ERROR)),this.translateI18nItem(R.PARTICIPANT_ERROR),1,{okay:()=>{}});this.emitEvent(E.ChatEvents._Request_RaiseAlert,e)}else if(0===this.selectedParticipantCount&&this._config.warnWhenNoContacts){const e=new w.DefaultAlerts(this).AlertYesNoQuestion(this.translateI18nItem(b.CommonMetadata.getI18nItem(b.CommonI18nKeys.ARE_YOU_SURE)),this.translateI18nItem(R.WARN_NO_CONTACTS),1,{yes:()=>{this._config.namedSettings?this._goToNamedConversationDetailsStep():this._startDirectConversation()},no:()=>{}});this.emitEvent(E.ChatEvents._Request_RaiseAlert,e)}else this._config.namedSettings?this._goToNamedConversationDetailsStep():this._startDirectConversation()}_onChangeNamedConversationDetail(e){e&&"subject"===e.key&&(this._namedConversationSubject=e.value),e&&"description"===e.key&&(this._namedConversationDescription=e.value);const t=!this._config.subjectRequired||this._namedConversationSubject.trim().length>0,n=!this._config.descriptionRequired||this._namedConversationDescription.trim().length>0;this.isRecording||(this.createNamedConversationDisabled=!t||!n),this.forceRedraw()}_startNamedConversation(){return o(this,void 0,void 0,function*(){if(!this.createNamedConversationDisabled)if(this._config.alert&&!0!==this._config.suppressAlertModalWarning){const e=new w.DefaultAlerts(this).AlertYesNoQuestion(this.translateI18nItem(b.CommonMetadata.getI18nItem(b.CommonI18nKeys.ARE_YOU_SURE)),this.translateI18nItem(R.THIS_PRIORITY_WILL_POP_UP_WARNING),1,{yes:()=>o(this,void 0,void 0,function*(){this._completeStartNamedConversation()}),no:()=>o(this,void 0,void 0,function*(){})});this.emitEvent(E.ChatEvents._Request_RaiseAlert,e)}else this._completeStartNamedConversation()})}_completeStartNamedConversation(){return o(this,void 0,void 0,function*(){const e=yield this._getConversationParticipants(!0);yield this.showWaitingMessage(this.translateI18nItem(R.CREATING_CONVERSATION)),this._pendingConversationId=yield this.layer.createConversation(e,this._namedConversationSubject.trim(),this._namedConversationDescription.trim(),this._config.defaultConversationExpiryTTL,this._config.defaultConversationActivityTTL,this._config.constructConfigurationToSend(this._alertResponseOption,this._config.chatAvailable),this._attachments)})}_getSelectedUsers(){return o(this,void 0,void 0,function*(){const e=this.shadowRoot.querySelector("#user-list");if(!e)return[];const t=yield e.getSelections();return C.sortUserListItems(t)})}_resetUserList(){return o(this,void 0,void 0,function*(){const e=this.shadowRoot.querySelector("#user-list");e&&(yield e.reset())})}_getConversationParticipants(e){return o(this,void 0,void 0,function*(){const t=this.layer.getWorkspaceJid(),n=yield this._getSelectedUsers(),i=new Map;for(const e of n)e.isGroup?e.groupUsers.map(t=>i.set(t.jid.toLowerCase(),e)):i.set(e.transformToBaseUser().jid.toLowerCase(),e);const o=Array.from(i.keys()),s=e?[t]:null,r=e?o:[t,...o];return d.buildConversationParticipants(s,null,r)})}}i([s.prop({type:s.Stroolean,attribute:!0,default:!0})],x.prototype,"allowSearch",void 0),i([s.prop({type:s.Stroolean,attribute:!0,default:!1})],x.prototype,"requireSearch",void 0),i([s.prop({type:s.NullableNumber,attribute:!0,default:null})],x.prototype,"showCountFrom",void 0),i([s.prop({type:Number,attribute:!1,default:0})],x.prototype,"selectedParticipantCount",void 0),i([s.prop({type:Number,attribute:!1,default:I.CONTACT_LIST})],x.prototype,"step",void 0),i([s.prop({type:Boolean,attribute:!1,default:!0})],x.prototype,"createNamedConversationDisabled",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],x.prototype,"isRecording",void 0),t.CTCLNewConversation=x,x.register()},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(29),r=n(1),a=n(15),l=n(0),c=n(12),d=n(52),h=n(6),u=n(11),p=n(8);var g;!function(e){e[e.ADD_VIDEO_ATTACHMENT="Add Video Attachment"]="ADD_VIDEO_ATTACHMENT",e[e.NO_VIDEO_ATTACHED="No video attached"]="NO_VIDEO_ATTACHED"}(g||(g={}));let m=class extends c.CTCLComponent{constructor(){super(...arguments),this._loadFromSource=!1,this.attachClick=(()=>o(this,void 0,void 0,function*(){const e=yield s.CtXmppClient.pickFile({mimeTypes:this.fileTypes});e&&e.length&&(this._loadFromSource=!0,this.videoSrc=e[0],this.callback&&this.callback(this.videoSrc))})),this._recordClick=(()=>o(this,void 0,void 0,function*(){this._loadFromSource=!1,this.videoSrc="",this.recordVideo=!this.recordVideo})),this._onRecordFinished=(e=>{this.callback&&this.callback(e)}),this._onRecordingDeleted=(()=>{this.videoSrc="",this._loadFromSource=!1,this.callback&&this.callback(this.videoSrc)})}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){this.addListener(h.ChatEvents.AudioRecordingStarted,()=>this.videoRecording=!0),this.addListener(h.ChatEvents.AudioRecordingStopped,()=>this.videoRecording=!1)}generateComponentMarkup(){return window.__CTRender("div",{class:"container"},window.__CTRender("h4",null,this.translateI18nItem(g.ADD_VIDEO_ATTACHMENT)),window.__CTRender("div",{class:"controls"},window.__CTRender("div",{class:`action ${this.recordVideo||this.videoSrc?"disabled":""}`,onClick:this.recordVideo||this.videoSrc?null:this.attachClick},window.__CTRender(p.CTIcon,{width:"16",height:"16",icon:u.Icons.UI.PickVideo})),window.__CTRender("div",{class:`action ${this.videoSrc||this.videoRecording?"disabled":""}`,onClick:this.videoSrc||this.videoRecording?null:this._recordClick},window.__CTRender(p.CTIcon,{width:"16",height:"16",icon:u.Icons.UI.RecordVideo})),window.__CTRender("div",{class:"placeholder"},this.isLoading?window.__CTRender(p.CTIcon,{width:"16",height:"16",icon:l.Icons.COMMON.LoadingSpinner,spin:!0}):this.recordVideo||this.videoSrc?window.__CTRender(d.CTCLVideoRecorderPlayer,{onRecordingFinished:this._onRecordFinished,onVideoRemoved:this._onRecordingDeleted}):window.__CTRender("p",null,this.translateI18nItem(g.NO_VIDEO_ATTACHED)))))}};i([r.prop({type:Array,attribute:!0,default:["video/mp4","video/webm"]})],m.prototype,"fileTypes",void 0),i([r.prop({type:Function,attribute:!1})],m.prototype,"callback",void 0),i([r.prop({type:Boolean,attribute:!1,default:!1})],m.prototype,"isLoading",void 0),i([r.prop({type:String,attribute:!1,default:null})],m.prototype,"videoSrc",void 0),i([r.prop({type:Boolean,attribute:!1,default:!1})],m.prototype,"recordVideo",void 0),i([r.prop({type:Boolean,attribute:!1,default:!1})],m.prototype,"videoRecording",void 0),m=i([a.component({tag:"ct-cl-video-attachment",styles:[n(347)],i18nKeys:g})],m),t.CTCLVideoAttachment=m},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(15),a=n(0),l=n(12),c=n(6),d=n(22),h=n(5),u=n(23),p=n(27),g=n(14),m=n(96),f=n(28),_=n(13),v=n(26),y=n(36),C=n(9),w=n(7);var b;!function(e){e[e.ASSIGN="Assign"]="ASSIGN",e[e.ASSIGN_DESCRIPTION="Assign this delegate to a user"]="ASSIGN_DESCRIPTION",e[e.RELEASE="Release"]="RELEASE",e[e.RELEASE_DESCRIPTION="Release this delegate from a user and back into the pool"]="RELEASE_DESCRIPTION",e[e.RELEASE_MESSAGE="Are you sure you wish to release this delegate account back into the pool?"]="RELEASE_MESSAGE",e[e.REQUEST="Request"]="REQUEST",e[e.SEARCH_PLACEHOLDER="Find Roles"]="SEARCH_PLACEHOLDER",e[e.TAKE="Take"]="TAKE",e[e.TITLE="Role Admin"]="TITLE",e[e.TRANSFER="Transfer"]="TRANSFER",e[e.TRANSFER_DESCRIPTION="Transfer this delegate from one user to another"]="TRANSFER_DESCRIPTION",e[e.WAITING="Waiting..."]="WAITING",e[e.ADD_ROLE="Add Role"]="ADD_ROLE",e[e.NEXT_PAGE="Next page"]="NEXT_PAGE",e[e.PREV_PAGE="Previous page"]="PREV_PAGE",e[e.CONFIRM_ROLE_DELETION_TITLE="Delete Role"]="CONFIRM_ROLE_DELETION_TITLE",e[e.CONFIRM_ROLE_DELETION_DESCRIPTION='Are you sure you want to delete the "{{rolename}}" role?']="CONFIRM_ROLE_DELETION_DESCRIPTION",e[e.FETCHING_MORE="Fetching more..."]="FETCHING_MORE"}(b||(b={}));let E=class extends l.CTCLComponent{constructor(){super(...arguments),this._searchString="",this._canPrev=!1,this._canNext=!0,this._offset="",this.PAGE_SIZE=30,this.TILE_HEIGHT=95,this._disableLazyLoading=!1,this._nearBottom=(()=>o(this,void 0,void 0,function*(){this._loadMoreItems()})),this._atBottom=(()=>o(this,void 0,void 0,function*(){!this._disableLazyLoading&&this._canNext&&(this.isFetchingMore=!0)})),this._loadMoreItems=(()=>o(this,void 0,void 0,function*(){if(!this._disableLazyLoading&&this._canNext&&!this._alreadyFetching){this._alreadyFetching=!0,this._offset=this.roles[this.roles.length-1].displayName;const e={offset:this._offset,direction:"forward",pagesize:""+(this.PAGE_SIZE+1),filter:this._searchString},t=yield this.layer.queryRoles(e);t.length==this.PAGE_SIZE+1?(this._canNext=!0,t.pop()):this._canNext=!1,this.roles=this.roles.concat(t),this._virtualList.addItems(t),setTimeout(()=>{this.isFetchingMore=!1},1e3),this._alreadyFetching=!1}})),this._open=(()=>o(this,void 0,void 0,function*(){this._user=yield this.layer.getCurrentUser(),this.showing=!0,yield h.sleep(this.animateWhenDisplaying?500:0),this.isFetching=!0;const e=this.shadowRoot.querySelector("#roleSearch");e&&this._searchString&&e.clear(),this._queryAndSetRoles(),this._canPrev=!1,this.isFetching=!1,this._virtualList.addScrollAtBottomListener(yield this._atBottom),this._virtualList.addScrollNearBottomListener(yield this._nearBottom),this.layer.setBackHandler(()=>this._close())})),this._close=(()=>o(this,void 0,void 0,function*(){this.emitEvent(c.ChatEvents.RefreshDelegateAccountsList),this.showing=!1,yield h.sleep(this.animateWhenDisplaying?500:0),this._virtualList.setItems([]),this.layer.popBackHandler()})),this._onSearch=((e,t)=>o(this,void 0,void 0,function*(){this.isFetching=!0,this._searchString=t;const e={filter:this._searchString,direction:"forwards",pagesize:""+(this.PAGE_SIZE+1)},n=yield this.layer.queryRoles(e);n.length===this.PAGE_SIZE+1?(this._canNext=!0,n.pop()):this._canNext=!1,this.roles=n,this._virtualList.setItems(this.roles),this._canPrev=!1,this._offset="",this.isFetching=!1})),this._addRole=(()=>{this.layer.emit("open-add-role")}),this._renderItem=((e,t)=>{const n=_.buildStyles({paddingRight:"36px",fontSize:"18px"}),i=()=>{this.layer.showRoleDetailModal(e)},s=t=>{t.stopPropagation(),this.layer.emit(g.BaseEvents._Request_RaiseAlert,this.defaultAlerts.AlertYesNoQuestion(this.translateI18nItem(b.CONFIRM_ROLE_DELETION_TITLE),this.translateI18nItem(b.CONFIRM_ROLE_DELETION_DESCRIPTION).replace("{{rolename}}",e.displayName),1,{yes:()=>o(this,void 0,void 0,function*(){yield this.layer.deleteRole(e),this.layer.emit(c.ChatEvents.RefreshRoleAdminList,null)}),no:()=>{}},!0))};return window.__CTRender("div",Object.assign({class:"role clickable"},t),window.__CTRender(f.CTAvatarTile,{height:`${this.TILE_HEIGHT}px`,showAvatar:!1,detailStyle:n,onClick:()=>i()},window.__CTRender(y.CTRoleAvatar,{slot:"avatar",size:40}),window.__CTRender("div",{class:"name overflow-ellipsis"},e.displayName),this._user&&v.roleAdminGroup&&this._user.group.includes(v.roleAdminGroup)&&this.isOnline&&window.__CTRender("div",{class:"delete",onClick:e=>s(e)},window.__CTRender(u.CTIcon,{width:"20",height:"20",icon:a.Icons.COMMON.CircleCross})),this._user&&v.roleAdminGroup&&this._user.group.includes(v.roleAdminGroup)&&!this.isOnline&&window.__CTRender("div",{class:"delete-offline"},window.__CTRender(u.CTIcon,{width:"20",height:"20",icon:a.Icons.COMMON.CircleCross}))))})}initialize(){return o(this,void 0,void 0,function*(){this._virtualList=new d.VirtualList(this,[],{itemHeight:this.TILE_HEIGHT,itemKeyGetter:e=>e.jid}),this._virtualList.setItems([]),this.isOnline=this.layer.getConnectionStatus()===a.ConnectionStatus.Connected})}setupListeners(){this.addListener(c.ChatEvents.OpenRoleAdmin,this._open),this.addListener(c.ChatEvents.CloseRoleAdmin,this._close),this.addListener(c.ChatEvents.ConnectionStatusChange,e=>o(this,void 0,void 0,function*(){e.status===a.ConnectionStatus.Disconnected&&(this.isLoading=!1,this.isOnline=!1,this._disableLazyLoading=!0),e.status===a.ConnectionStatus.Connected&&(this.isOnline=!0,this._disableLazyLoading=!1,this._isCurrentUserARoleAdmin()&&0===this._virtualList.items.length&&this._queryAndSetRoles(),this._virtualList.isCurrentlyAtBottom()&&this._canNext&&this._virtualList.items.length>0&&(this.isFetchingMore=!0,this._loadMoreItems()))})),this.addListener(c.ChatEvents.RefreshRoleAdminList,this._open)}_queryAndSetRoles(){return o(this,void 0,void 0,function*(){const e={direction:"forwards",pagesize:""+(this.PAGE_SIZE+1)};try{const t=yield this.layer.queryRoles(e);t&&t.length===this.PAGE_SIZE+1?(this._canNext=!0,t.pop()):this._canNext=!1,this.roles=t,this._virtualList.setItems(this.roles)}catch(e){if(this.isOnline&&e){const e=this.layer.translateI18nItem(w.ChatCommonMetadata.getI18nItem(w.ChatCommonI18nKeys.ERROR_QUERYING_ROLE)),t=C.getErrorMessage("E_QUERY_ROLES_ERROR",this.layer);this.layer.error(e,t)}}})}_isCurrentUserARoleAdmin(){return this.showing&&(v.roleAdminGroup&&this._user.group.includes(v.roleAdminGroup)||v.rolePermissionManagementGroup&&this._user.group.includes(v.rolePermissionManagementGroup))}generateComponentMarkup(){return window.__CTRender("div",{class:"container"},window.__CTRender(p.CTCLHeader,{class:"header"},window.__CTRender("div",{slot:"left-action"},window.__CTRender(u.CTIcon,{class:"action",width:"20",height:"20",icon:a.Icons.COMMON.ChevronLeft,onClick:this._close})),window.__CTRender("div",{slot:"heading"},this.translateI18nItem(b.TITLE)),window.__CTRender("div",{slot:"right-action"},this._user&&v.roleAdminGroup&&this._user.group.includes(v.roleAdminGroup)&&window.__CTRender(u.CTIcon,{class:"action",width:"20",height:"20",icon:a.Icons.COMMON.PlusSign,onClick:this._addRole.bind(this)}))),window.__CTRender("div",{class:"filter"},window.__CTRender(u.CTSelectionTextFilter,{enableSelection:!1,placeholder:this.translateI18nItem(b.SEARCH_PLACEHOLDER),selectionItems:[],onSearch:this._onSearch,id:"roleSearch"})),window.__CTRender("div",{class:"roles"},this._searchString.length>0&&0===this._virtualList.items.length?window.__CTRender("p",{class:"no-results"},"No roles match your search"):this._virtualList.render(this._renderItem,"roles-list","roles-content")),window.__CTRender(m.CTCLAddRole,null),window.__CTRender("div",{class:this.isFetchingMore?"footer open":"footer"},window.__CTRender("div",{class:"fetching"},window.__CTRender(u.CTIcon,{width:"16",height:"16",icon:a.Icons.COMMON.LoadingSpinner,spin:!0}),this.translateI18nItem(b.FETCHING_MORE))))}};i([s.prop({type:Boolean,attribute:!0,default:!1})],E.prototype,"showing",void 0),i([s.prop({type:Boolean,attribute:!0,default:!0})],E.prototype,"animateWhenDisplaying",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],E.prototype,"isFetching",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],E.prototype,"isFetchingMore",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],E.prototype,"isLoading",void 0),i([s.prop({type:Array,attribute:!1,default:[]})],E.prototype,"roles",void 0),i([s.prop({type:Object,attribute:!1,default:null})],E.prototype,"selectedRole",void 0),E=i([r.component({tag:"ctcl-role-admin",styles:[n(382)],i18nKeys:b})],E),t.CTCLRoleAdmin=E},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(15),a=n(0),l=n(12),c=n(6),d=n(23),h=n(18),u=n(28);var p;!function(e){e[e.TITLE="Add Role"]="TITLE",e[e.DISPLAY_NAME_PLACEHOLDER="Role name"]="DISPLAY_NAME_PLACEHOLDER",e[e.GROUPS_LABEL="Groups"]="GROUPS_LABEL"}(p||(p={}));let g=class extends l.CTCLComponent{constructor(){super(...arguments),this._data=null,this._open=(()=>o(this,void 0,void 0,function*(){this.saveDisabled=!0;const e=this.shadowRoot.querySelector("ct-textbox");e&&e.clear(),this.showing=!0})),this._close=(()=>o(this,void 0,void 0,function*(){this._data={displayName:"",group:""},this.showing=!1})),this._save=(()=>o(this,void 0,void 0,function*(){try{const e=yield this.layer.createRole(this._data);this.layer.emit(c.ChatEvents.RefreshRoleAdminList,null),this.layer.showRoleDetailModal(e,!1),this._close()}catch(e){}})),this._updateDisplayName=(e=>{const t=e.value?e.value.trim():"";this.saveDisabled=0===t.length,this._data.displayName=t})}initialize(){return o(this,void 0,void 0,function*(){this._data={displayName:"",group:""}})}setupListeners(){this.setupConnectionStatusListener(),this.addListener(c.ChatEvents.OpenAddRole,this._open),this.addListener(c.ChatEvents.CloseAddRole,this._close)}generateComponentMarkup(){const e=this.layer.config.roles.maxDisplayNameLength||30;this.layer.config.roles.maxGroups,this.layer.config.roles.maxGroupLength;return window.__CTRender("div",{class:"container"},window.__CTRender(h.CTCLHeader,{class:"header"},window.__CTRender("div",{slot:"left-action"},window.__CTRender(d.CTIcon,{class:"action",width:"20",height:"20",icon:a.Icons.COMMON.ChevronLeft,onClick:this._close})),window.__CTRender("div",{slot:"heading"},this.translateI18nItem(p.TITLE)),window.__CTRender("div",{slot:"right-action"})),this.showing&&window.__CTRender("div",{class:"form"},window.__CTRender("div",{class:"form-item"},window.__CTRender(u.CTTextbox,{type:"text",name:"display_name",required:!0,fullBorder:!0,defaultValue:this._data.displayName,placeholder:this.translateI18nItem(p.DISPLAY_NAME_PLACEHOLDER),callback:e=>this._updateDisplayName(e),max:e,focusOnRender:!0})),window.__CTRender("p",{class:"note"},window.__CTRender("strong",null,"Please Note:")," New roles won't be available within the ",window.__CTRender("span",{class:"italics"},"accounts menu")," or ",window.__CTRender("span",{class:"italics"},"role assignment")," until a contact directory sync occurs. This may be between 1-24 hours.")),window.__CTRender("div",{class:"footer"},window.__CTRender(u.CTButton,{type:"primary",onClick:this._save,disabled:this.saveDisabled||!this.isOnline},"Save")))}};i([s.prop({type:Boolean,attribute:!0,default:!1})],g.prototype,"showing",void 0),i([s.prop({type:Boolean,attribute:!0,default:!0})],g.prototype,"animateWhenDisplaying",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],g.prototype,"isFetching",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],g.prototype,"isLoading",void 0),i([s.prop({type:Boolean,attribute:!1,default:!0})],g.prototype,"saveDisabled",void 0),g=i([r.component({tag:"ctcl-add-role",styles:[n(380)],i18nKeys:p})],g),t.CTCLAddRole=g},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(15),a=n(0),l=n(12),c=n(6),d=n(23),h=n(18),u=n(28),p=n(14);var g;!function(e){e[e.TITLE="Add Group"]="TITLE",e[e.NAME_PLACEHOLDER="Group name"]="NAME_PLACEHOLDER",e[e.DESCRIPTION_PLACEHOLDER="Group description"]="DESCRIPTION_PLACEHOLDER",e[e.GROUPS_LABEL="Groups"]="GROUPS_LABEL",e[e.INVALID_GROUP_NAME_TITLE="Invalid Group Name"]="INVALID_GROUP_NAME_TITLE",e[e.UNDERSCORE_PREFIX_ERROR_DESCRIPTION='A group name cannot start with "_"']="UNDERSCORE_PREFIX_ERROR_DESCRIPTION",e[e.COMMA_ERROR_DESCRIPTION='A group name cannot contain ","']="COMMA_ERROR_DESCRIPTION",e[e.CONFIRM_CREATE_CONFIG_GROUP_TITLE="Create remote config group?"]="CONFIRM_CREATE_CONFIG_GROUP_TITLE",e[e.CONFIRM_CREATE_CONFIG_GROUP_DESCRIPTION="Groups starting with '#' are reserved for remote config groups. Are you sure you want to create this group?"]="CONFIRM_CREATE_CONFIG_GROUP_DESCRIPTION"}(g||(g={}));let m=class extends l.CTCLComponent{constructor(){super(...arguments),this._data=null,this._open=(()=>o(this,void 0,void 0,function*(){this.saveDisabled=!0;const e=this.shadowRoot.querySelector("ct-textbox");e&&e.clear();const t=this.shadowRoot.querySelector("ct-taginput");t&&t.clear(),this.showing=!0})),this._close=(()=>o(this,void 0,void 0,function*(){this._data={id:"",name:"",description:""},this.showing=!1})),this._submitSave=(()=>o(this,void 0,void 0,function*(){try{const e=yield this.layer.createGroup(this._data);this.layer.emit(c.ChatEvents.RefreshGroupAdminList,null),this.layer.showGroupDetailModal(e,!1),this._close()}catch(e){}})),this._save=(()=>o(this,void 0,void 0,function*(){"_"!==this._data.name.charAt(0)?-1===this._data.name.indexOf(",")?"#"===this._data.name.charAt(0)?this.layer.emit(p.BaseEvents._Request_RaiseAlert,this.defaultAlerts.AlertYesNoQuestion(this.translateI18nItem(g.CONFIRM_CREATE_CONFIG_GROUP_TITLE),this.translateI18nItem(g.CONFIRM_CREATE_CONFIG_GROUP_DESCRIPTION),1,{yes:()=>o(this,void 0,void 0,function*(){yield this._submitSave()}),no:()=>{}},!0)):yield this._submitSave():this.layer.error(this.translateI18nItem(g.INVALID_GROUP_NAME_TITLE),this.translateI18nItem(g.COMMA_ERROR_DESCRIPTION)):this.layer.error(this.translateI18nItem(g.INVALID_GROUP_NAME_TITLE),this.translateI18nItem(g.UNDERSCORE_PREFIX_ERROR_DESCRIPTION))})),this._updateName=(e=>{const t=e.value?e.value.trim():"";this.saveDisabled=0===t.length||/^'|"/.test(t),/^('\w+|"\w+)/.test(t)&&(this.saveDisabled=!1),this._data.name=t}),this._updateDescription=(e=>{const t=e.value?e.value.trim():"";this._data.description=t})}initialize(){return o(this,void 0,void 0,function*(){this._data={id:"",name:"",description:""}})}setupListeners(){this.setupConnectionStatusListener(),this.addListener(c.ChatEvents.OpenAddGroup,this._open),this.addListener(c.ChatEvents.CloseAddGroup,this._close)}generateComponentMarkup(){const e=this.layer.config.groups.maxNameLength||30,t=this.layer.config.groups.maxDescriptionLength||120;return window.__CTRender("div",{class:"container"},window.__CTRender(h.CTCLHeader,{class:"header"},window.__CTRender("div",{slot:"left-action"},window.__CTRender(d.CTIcon,{class:"action",width:"20",height:"20",icon:a.Icons.COMMON.ChevronLeft,onClick:this._close})),window.__CTRender("div",{slot:"heading"},this.translateI18nItem(g.TITLE)),window.__CTRender("div",{slot:"right-action"})),this.showing&&window.__CTRender("div",{class:"form"},window.__CTRender("div",{class:"form-item name"},window.__CTRender(u.CTTextbox,{type:"text",name:"name",required:!0,fullBorder:!0,defaultValue:this._data.name,placeholder:this.translateI18nItem(g.NAME_PLACEHOLDER),callback:e=>this._updateName(e),max:e,focusOnRender:!0})),window.__CTRender("div",{class:"form-item description"},window.__CTRender(u.CTTextbox,{type:"text",name:"description",fullBorder:!0,defaultValue:this._data.description,placeholder:this.translateI18nItem(g.DESCRIPTION_PLACEHOLDER),callback:e=>this._updateDescription(e),max:t}))),window.__CTRender("div",{class:"footer"},window.__CTRender(u.CTButton,{type:"primary",onClick:this._save,disabled:this.saveDisabled||!this.isOnline},"Save")))}};i([s.prop({type:Boolean,attribute:!0,default:!1})],m.prototype,"showing",void 0),i([s.prop({type:Boolean,attribute:!0,default:!0})],m.prototype,"animateWhenDisplaying",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],m.prototype,"isFetching",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],m.prototype,"isLoading",void 0),i([s.prop({type:Boolean,attribute:!1,default:!0})],m.prototype,"saveDisabled",void 0),m=i([r.component({tag:"ctcl-add-group",styles:[n(385)],i18nKeys:g})],m),t.CTCLAddGroup=m},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(15),a=n(12),l=n(6),c=n(22),d=n(5),h=n(23),u=n(27),p=n(14),g=n(28),m=n(26),f=n(0),_=n(37);var v;!function(e){e[e.SEARCH_PLACEHOLDER="Find Users"]="SEARCH_PLACEHOLDER",e[e.TITLE="User Admin"]="TITLE",e[e.WAITING="Waiting..."]="WAITING",e[e.INITIAL_MESSAGE="Find users using the search bar above"]="INITIAL_MESSAGE",e[e.CONFIRM_GROUP_DELETION_TITLE="Delete Group"]="CONFIRM_GROUP_DELETION_TITLE",e[e.CONFIRM_GROUP_DELETION_DESCRIPTION='Are you sure you want to delete the "{{groupname}}" group?']="CONFIRM_GROUP_DELETION_DESCRIPTION",e[e.FETCHING_MORE="Fetching more..."]="FETCHING_MORE",e[e.CONFIRM_CONFIG_GROUP_DELETION_TITLE="Delete remote config group?"]="CONFIRM_CONFIG_GROUP_DELETION_TITLE",e[e.CONFIRM_CONFIG_GROUP_DELETION_DESCRIPTION="Removing this group may cause users to lose their app configuration settings which could result in the loss of critical functionality. Are you sure?"]="CONFIRM_CONFIG_GROUP_DELETION_DESCRIPTION"}(v||(v={}));let y=class extends a.CTCLComponent{constructor(){super(...arguments),this.TILE_HEIGHT=95,this._open=(()=>o(this,void 0,void 0,function*(){this._user=yield this.layer.getCurrentUser(),this.showing=!0,yield d.sleep(this.animateWhenDisplaying?500:0),this.layer.setBackHandler(()=>this._close())})),this._close=(()=>o(this,void 0,void 0,function*(){this.showing=!1,yield d.sleep(this.animateWhenDisplaying?500:0),this._virtualList.setItems([]),this.layer.popBackHandler()}))}initialize(){return o(this,void 0,void 0,function*(){this._virtualList=new c.VirtualList(this,[],{itemHeight:this.TILE_HEIGHT,itemKeyGetter:e=>null===e?"":e.id}),this._virtualList.setItems([]),this.isOnline=this.layer.getConnectionStatus()===f.ConnectionStatus.Connected})}setupListeners(){this.addListener(l.ChatEvents.OpenUserAdmin,this._open),this.addListener(l.ChatEvents.CloseUserAdmin,this._close),this.addListener(l.ChatEvents.ConnectionStatusChange,e=>o(this,void 0,void 0,function*(){e.status===f.ConnectionStatus.Disconnected&&(this.isOnline=!1),e.status===f.ConnectionStatus.Connected&&(this.isOnline=!0,this._isCurrentUserAUserAdmin()&&this._virtualList.items.length)})),this.addListener(l.ChatEvents.RefreshGroupAdminList,this._open)}_isCurrentUserAUserAdmin(){return this.showing&&m.userAdminGroup&&this._user&&this._user.group.includes(m.userAdminGroup)||m.uberAdminGroup&&this._user&&this._user.group.includes(m.uberAdminGroup)||m.superAdminGroup&&this._user&&this._user.group.includes(m.superAdminGroup)}_remove(){const e=this.selectedUserJids.length;this.layer.emit(p.BaseEvents._Request_RaiseAlert,this.defaultAlerts.AlertYesNoQuestion(`Remove ${e} users from contacts?`,`Are you sure you want to remove ${e} users from contacts? This will remove these users from the contact list on all users' devices. This change may take up to 24 hours to take affect.`,1,{yes:()=>o(this,void 0,void 0,function*(){this.layer.showWaitingMessage("Removing users...");let t=!1;try{t=yield this.layer.setUsersInactive(this.selectedUserJids)}catch(e){this.layer.dismissWaitingMessage()}if(t){yield Promise.all(this.selectedUserJids.map(e=>this.layer.updateDirectoryAccount(e,{active:!1},!1))),yield this.layer.saveUserDirectory();const t=this.shadowRoot.querySelector("ct-user-list");yield t.clearSelections(),yield t.clearFilter(),this.layer.dismissWaitingMessage(),this.layer.emit(p.BaseEvents._Request_RaiseAlert,this.defaultAlerts.SimpleAlertWithOkay(`${e} users removed`,`${e} users have been successfully removed from contacts.`))}else this.layer.dismissWaitingMessage(),this.layer.emit(p.BaseEvents._Request_RaiseAlert,this.defaultAlerts.SimpleAlertWithOkay("0 users removed","0 users have been successfully removed from contacts."))}),no:()=>{}},!0))}generateComponentMarkup(){const e={allowSearch:!0,requireSearch:!0,searchPlaceholder:this.translateI18nItem(v.SEARCH_PLACEHOLDER),initialMessage:this.translateI18nItem(v.INITIAL_MESSAGE),allowSelection:!0,noRoles:!0,noGroups:!0,disableFilterDropdown:!0,onChangeSelection:e=>{this.selectedUserJids=e.map(e=>e.id)},onClickUser:e=>{this.layer.showContactInfo(e,null,!1)}};return window.__CTRender("div",{class:"container"},window.__CTRender(u.CTCLHeader,{class:"header"},window.__CTRender("div",{slot:"left-action"},window.__CTRender(h.CTIcon,{class:"action",width:"20",height:"20",icon:f.Icons.COMMON.ChevronLeft,onClick:this._close})),window.__CTRender("div",{slot:"heading"},this.translateI18nItem(v.TITLE)),window.__CTRender("div",{slot:"sub-heading"},"Remove users from contacts. Currently ",this.selectedUserJids.length," selected."),window.__CTRender("div",{slot:"right-action"})),window.__CTRender("div",{id:"users-list"},window.__CTRender(_.CTUserList,Object.assign({},e))),window.__CTRender("div",{class:"footer"},window.__CTRender(g.CTButton,{type:"primary",class:"button",disabled:!this.isOnline||0===this.selectedUserJids.length,onClick:this._remove.bind(this)},"Remove ",this.selectedUserJids.length," users from contacts")))}};i([s.prop({type:Boolean,attribute:!0,default:!1})],y.prototype,"showing",void 0),i([s.prop({type:Boolean,attribute:!0,default:!0})],y.prototype,"animateWhenDisplaying",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],y.prototype,"isFetching",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],y.prototype,"isFetchingMore",void 0),i([s.prop({type:Array,attribute:!1,default:[]})],y.prototype,"selectedUserJids",void 0),y=i([r.component({tag:"ctcl-user-admin",styles:[n(389)],i18nKeys:v})],y),t.CTCLUserAdmin=y},function(e,t,n){var i=n(392);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){var i=n(394);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){var i=n(396);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){var i=n(398);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){"use strict";n.r(t);var i=n(104),o=n.n(i);var s=function(e){const t=e.Strophe;return t.isTagEqual=function(e,t){return(e.tagName||e.node.tagName)===t},t.addConnectionPlugin("streamManagement",{logging:!0,returnWholeStanza:!1,autoSendCountOnEveryIncomingStanza:!1,requestResponseInterval:0,allowResume:!0,_c:null,_NS:"urn:xmpp:sm:3",_isStreamManagementEnabled:!1,_serverProcesssedStanzasCounter:null,_clientProcessedStanzasCounter:null,_clientSentStanzasCounter:null,_originalXMLOutput:null,_requestHandler:null,_incomingHandler:null,_requestResponseIntervalCount:0,_unacknowledgedStanzas:[],_acknowledgedStanzaListeners:[],_counters:{incoming:0,outgoing:0,server:0},addAcknowledgedStanzaListener:function(e){this._acknowledgedStanzaListeners.push(e)},enable:function(t){const n={xmlns:this._NS,resume:this.allowResume};if(t)try{n.max=""+t/1e3}catch(e){console.error(`Couldn't convert '${t}' to milliseconds:`,e)}this._c.send(e.$build("enable",n)),this._c.flush(),this._c.pause()},requestAcknowledgement:function(){this._requestResponseIntervalCount=0,this._c.send(e.$build("r",{xmlns:this._NS}))},getOutgoingCounter:function(){return this._counters.outgoing},getServerProcessedCounter:function(){return this._counters.server},getIncomingCounter:function(){return this._counters.incoming},init:function(e){this._c=e,t.addNamespace("SM",this._NS);const n=localStorage.getItem(this._c.options.instance_id+"_counters");if(null!==n){let e=null;try{e=JSON.parse(n)}catch(e){}null!==e&&(this._counters=e)}this._originalXMLOutput=this._c.xmlOutput,this._c.xmlOutput=this.xmlOutput.bind(this)},statusChanged:function(e,n){e!==t.Status.CONNECTED&&e!==t.Status.DISCONNECTED||(this._requestResponseIntervalCount=0,this._isStreamManagementEnabled=!1,e===t.Status.CONNECTED&&"resumed"!==n&&this._resetCounters(),e===t.Status.CONNECTED&&"resumed"===n&&(this._isStreamManagementEnabled=!0),this._unacknowledgedStanzas=[],this._requestHandler&&this._c.deleteHandler(this._requestHandler),this._incomingHandler&&this._c.deleteHandler(this._incomingHandler),this._requestHandler=this._c.addHandler(this._handleServerRequestHandler.bind(this),this._NS,"r"),this._incomingHandler=this._c.addHandler(this._incomingStanzaHandler.bind(this),null,null))},xmlOutput:function(e){function n(e){return t.isTagEqual(e,"iq")||t.isTagEqual(e,"presence")||t.isTagEqual(e,"message")}if(n(e))this._increaseSentStanzasCounter(e);else if(void 0!==e.children)for(var i,o=0;o<e.children.length;o++)i=e.children[o],n()&&this._increaseSentStanzasCounter(i);return this._originalXMLOutput.call(this._c,e)},_incomingStanzaHandler:function(e){if(t.isTagEqual(e,"enabled")&&e.getAttribute("xmlns")===this._NS&&(this._isStreamManagementEnabled=!0,this._c.resume()),(t.isTagEqual(e,"iq")||t.isTagEqual(e,"presence")||t.isTagEqual(e,"message"))&&(this._increaseReceivedStanzasCounter(),this.autoSendCountOnEveryIncomingStanza&&this._answerProcessedStanzas(),t.isTagEqual(e,"message")&&"error"===e.getAttribute("type")&&(this._counters.outgoing=this._counters.outgoing-1)),t.isTagEqual(e,"a")){var n=parseInt(e.getAttribute("h"));this._handleAcknowledgedStanzas(n,this._counters.server),this._counters.server=n,this._persistCounters(),this.requestResponseInterval>0&&(this._requestResponseIntervalCount=0)}return!0},_handleAcknowledgedStanzas:function(e,t){var n=e-t;n<0&&this._throwError("New reported stanza count lower than previous. New: "+e+" - Previous: "+t),n>this._unacknowledgedStanzas.length&&this._throwError("Higher reported acknowledge count than unacknowledged stanzas. Reported Acknowledge Count: "+n+" - Unacknowledge Stanza Count: "+this._unacknowledgedStanzas.length+" - New: "+e+" - Previous: "+t);for(var i=0;i<n;i++)for(var o=this._unacknowledgedStanzas.shift(),s=0;s<this._acknowledgedStanzaListeners.length;s++)this._acknowledgedStanzaListeners[s](o);this.logging&&this._unacknowledgedStanzas.length>0&&console.warn("Unacknowledged stanzas",this._unacknowledgedStanzas)},_handleServerRequestHandler:function(){return this._answerProcessedStanzas(),!0},_answerProcessedStanzas:function(t){(this._isStreamManagementEnabled||!0===t)&&this._c.send(e.$build("a",{xmlns:this._NS,h:this._counters.incoming}))},_increaseSentStanzasCounter:function(e){this._isStreamManagementEnabled&&(this._unacknowledgedStanzas.push(this.returnWholeStanza?e:e.getAttribute("id")),this._counters.outgoing++,this._persistCounters(),this.requestResponseInterval>0&&(this._requestResponseIntervalCount++,this._requestResponseIntervalCount===this.requestResponseInterval&&this.requestAcknowledgement()))},_increaseReceivedStanzasCounter:function(){this._isStreamManagementEnabled&&(this._counters.incoming++,this._persistCounters())},_persistCounters:function(){localStorage.setItem(this._c.options.instance_id+"_counters",JSON.stringify(this._counters))},_resetCounters:function(){this._counters={incoming:0,outgoing:0,server:0},this._persistCounters()},_throwError:function(e){console.error(e)}}),e};t.default=s(o.a)},function(e,t,n){var i,o,s,r,a,l,c,d,h,u,p,g,m;i=function(){return function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(t){var n,i,o,s,r,a,l,c="",d=0;do{n=t.charCodeAt(d++),i=t.charCodeAt(d++),o=t.charCodeAt(d++),s=n>>2,r=(3&n)<<4|i>>4,a=(15&i)<<2|o>>6,l=63&o,isNaN(i)?(r=(3&n)<<4,a=l=64):isNaN(o)&&(l=64),c=c+e.charAt(s)+e.charAt(r)+e.charAt(a)+e.charAt(l)}while(d<t.length);return c},decode:function(t){var n,i,o,s,r,a,l,c="",d=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{s=e.indexOf(t.charAt(d++)),r=e.indexOf(t.charAt(d++)),a=e.indexOf(t.charAt(d++)),l=e.indexOf(t.charAt(d++)),n=s<<2|r>>4,i=(15&r)<<4|a>>2,o=(3&a)<<6|l,c+=String.fromCharCode(n),64!=a&&(c+=String.fromCharCode(i)),64!=l&&(c+=String.fromCharCode(o))}while(d<t.length);return c}}}()}.call((o={id:"strophe-base64",exports:{},loaded:!1}).exports,n,o.exports,o),o.loaded=!0,void 0!==i||(i=o.exports),s=function(){return function(){function e(e,i){e[i>>5]|=128<<24-i%32,e[15+(i+64>>9<<4)]=i;var r,a,l,c,d,h,u,p,g=new Array(80),m=1732584193,f=-271733879,_=-1732584194,v=271733878,y=-1009589776;for(r=0;r<e.length;r+=16){for(c=m,d=f,h=_,u=v,p=y,a=0;a<80;a++)g[a]=a<16?e[r+a]:s(g[a-3]^g[a-8]^g[a-14]^g[a-16],1),l=o(o(s(m,5),t(a,f,_,v)),o(o(y,g[a]),n(a))),y=v,v=_,_=s(f,30),f=m,m=l;m=o(m,c),f=o(f,d),_=o(_,h),v=o(v,u),y=o(y,p)}return[m,f,_,v,y]}function t(e,t,n,i){return e<20?t&n|~t&i:e<40?t^n^i:e<60?t&n|t&i|n&i:t^n^i}function n(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function i(t,n){var i=r(t);i.length>16&&(i=e(i,8*t.length));for(var o=new Array(16),s=new Array(16),a=0;a<16;a++)o[a]=909522486^i[a],s[a]=1549556828^i[a];var l=e(o.concat(r(n)),512+8*n.length);return e(s.concat(l),672)}function o(e,t){var n=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(n>>16);return i<<16|65535&n}function s(e,t){return e<<t|e>>>32-t}function r(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<24-n%32;return t}function a(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}function l(e){for(var t,n,i="",o=0;o<4*e.length;o+=3)for(t=(e[o>>2]>>8*(3-o%4)&255)<<16|(e[o+1>>2]>>8*(3-(o+1)%4)&255)<<8|e[o+2>>2]>>8*(3-(o+2)%4)&255,n=0;n<4;n++)8*o+6*n>32*e.length?i+="=":i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>6*(3-n)&63);return i}return{b64_hmac_sha1:function(e,t){return l(i(e,t))},b64_sha1:function(t){return l(e(r(t),8*t.length))},binb2str:a,core_hmac_sha1:i,str_hmac_sha1:function(e,t){return a(i(e,t))},str_sha1:function(t){return a(e(r(t),8*t.length))}}}()}.call((r={id:"strophe-sha1",exports:{},loaded:!1}).exports,n,r.exports,r),r.loaded=!0,void 0!==s||(s=r.exports),a=function(){return function(e){var t=function(e,t){var n=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(n>>16);return i<<16|65535&n},n=function(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},i=function(e,n,i,o,s,r){return t(function(e,t){return e<<t|e>>>32-t}(t(t(n,e),t(o,r)),s),i)},o=function(e,t,n,o,s,r,a){return i(t&n|~t&o,e,t,s,r,a)},s=function(e,t,n,o,s,r,a){return i(t&o|n&~o,e,t,s,r,a)},r=function(e,t,n,o,s,r,a){return i(t^n^o,e,t,s,r,a)},a=function(e,t,n,o,s,r,a){return i(n^(t|~o),e,t,s,r,a)},l=function(e,n){e[n>>5]|=128<<n%32,e[14+(n+64>>>9<<4)]=n;for(var i,l,c,d,h=1732584193,u=-271733879,p=-1732584194,g=271733878,m=0;m<e.length;m+=16)i=h,l=u,c=p,d=g,h=o(h,u,p,g,e[m+0],7,-680876936),g=o(g,h,u,p,e[m+1],12,-389564586),p=o(p,g,h,u,e[m+2],17,606105819),u=o(u,p,g,h,e[m+3],22,-1044525330),h=o(h,u,p,g,e[m+4],7,-176418897),g=o(g,h,u,p,e[m+5],12,1200080426),p=o(p,g,h,u,e[m+6],17,-1473231341),u=o(u,p,g,h,e[m+7],22,-45705983),h=o(h,u,p,g,e[m+8],7,1770035416),g=o(g,h,u,p,e[m+9],12,-1958414417),p=o(p,g,h,u,e[m+10],17,-42063),u=o(u,p,g,h,e[m+11],22,-1990404162),h=o(h,u,p,g,e[m+12],7,1804603682),g=o(g,h,u,p,e[m+13],12,-40341101),p=o(p,g,h,u,e[m+14],17,-1502002290),u=o(u,p,g,h,e[m+15],22,1236535329),h=s(h,u,p,g,e[m+1],5,-165796510),g=s(g,h,u,p,e[m+6],9,-1069501632),p=s(p,g,h,u,e[m+11],14,643717713),u=s(u,p,g,h,e[m+0],20,-373897302),h=s(h,u,p,g,e[m+5],5,-701558691),g=s(g,h,u,p,e[m+10],9,38016083),p=s(p,g,h,u,e[m+15],14,-660478335),u=s(u,p,g,h,e[m+4],20,-405537848),h=s(h,u,p,g,e[m+9],5,568446438),g=s(g,h,u,p,e[m+14],9,-1019803690),p=s(p,g,h,u,e[m+3],14,-187363961),u=s(u,p,g,h,e[m+8],20,1163531501),h=s(h,u,p,g,e[m+13],5,-1444681467),g=s(g,h,u,p,e[m+2],9,-51403784),p=s(p,g,h,u,e[m+7],14,1735328473),u=s(u,p,g,h,e[m+12],20,-1926607734),h=r(h,u,p,g,e[m+5],4,-378558),g=r(g,h,u,p,e[m+8],11,-2022574463),p=r(p,g,h,u,e[m+11],16,1839030562),u=r(u,p,g,h,e[m+14],23,-35309556),h=r(h,u,p,g,e[m+1],4,-1530992060),g=r(g,h,u,p,e[m+4],11,1272893353),p=r(p,g,h,u,e[m+7],16,-155497632),u=r(u,p,g,h,e[m+10],23,-1094730640),h=r(h,u,p,g,e[m+13],4,681279174),g=r(g,h,u,p,e[m+0],11,-358537222),p=r(p,g,h,u,e[m+3],16,-722521979),u=r(u,p,g,h,e[m+6],23,76029189),h=r(h,u,p,g,e[m+9],4,-640364487),g=r(g,h,u,p,e[m+12],11,-421815835),p=r(p,g,h,u,e[m+15],16,530742520),u=r(u,p,g,h,e[m+2],23,-995338651),h=a(h,u,p,g,e[m+0],6,-198630844),g=a(g,h,u,p,e[m+7],10,1126891415),p=a(p,g,h,u,e[m+14],15,-1416354905),u=a(u,p,g,h,e[m+5],21,-57434055),h=a(h,u,p,g,e[m+12],6,1700485571),g=a(g,h,u,p,e[m+3],10,-1894986606),p=a(p,g,h,u,e[m+10],15,-1051523),u=a(u,p,g,h,e[m+1],21,-2054922799),h=a(h,u,p,g,e[m+8],6,1873313359),g=a(g,h,u,p,e[m+15],10,-30611744),p=a(p,g,h,u,e[m+6],15,-1560198380),u=a(u,p,g,h,e[m+13],21,1309151649),h=a(h,u,p,g,e[m+4],6,-145523070),g=a(g,h,u,p,e[m+11],10,-1120210379),p=a(p,g,h,u,e[m+2],15,718787259),u=a(u,p,g,h,e[m+9],21,-343485551),h=t(h,i),u=t(u,l),p=t(p,c),g=t(g,d);return[h,u,p,g]};return{hexdigest:function(e){return function(e){for(var t="",n=0;n<4*e.length;n++)t+="0123456789abcdef".charAt(e[n>>2]>>n%4*8+4&15)+"0123456789abcdef".charAt(e[n>>2]>>n%4*8&15);return t}(l(n(e),8*e.length))},hash:function(e){return function(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}(l(n(e),8*e.length))}}}()}.call((l={id:"strophe-md5",exports:{},loaded:!1}).exports,n,l.exports,l),l.loaded=!0,void 0!==a||(a=l.exports),c=function(){return{utf16to8:function(e){var t,n,i="",o=e.length;for(t=0;t<o;t++)(n=e.charCodeAt(t))>=0&&n<=127?i+=e.charAt(t):n>2047?(i+=String.fromCharCode(224|n>>12&15),i+=String.fromCharCode(128|n>>6&63),i+=String.fromCharCode(128|n>>0&63)):(i+=String.fromCharCode(192|n>>6&31),i+=String.fromCharCode(128|n>>0&63));return i},addCookies:function(e){var t,n,i,o,s,r,a;for(t in e||{})s="",r="",a="",n=e[t],i="object"==typeof n,o=escape(unescape(i?n.value:n)),i&&(s=n.expires?";expires="+n.expires:"",r=n.domain?";domain="+n.domain:"",a=n.path?";path="+n.path:""),document.cookie=t+"="+o+s+r+a}}}.call((d={id:"strophe-utils",exports:{},loaded:!1}).exports,n,d.exports,d),d.loaded=!0,void 0!==c||(c=d.exports),h=function(){return Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice,i=Array.prototype.concat,o=n.call(arguments,1);return function(){return t.apply(e||this,i.call(o,n.call(arguments,0)))}}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),void(Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length,n=Number(arguments[1])||0;for((n=n<0?Math.ceil(n):Math.floor(n))<0&&(n+=t);n<t;n++)if(n in this&&this[n]===e)return n;return-1}))}.apply(t,[]),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var n,i;if(null===this)throw new TypeError(" this is null or not defined");var o=Object(this),s=o.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(n=t),i=0;i<s;){var r;i in o&&(r=o[i],e.call(n,r,i,o)),i++}}),u=function(){return function(e,t,n,i){var o;function s(e,t){return new o.Builder(e,t)}function r(e){return new o.Builder("iq",e)}function a(e){return new o.Builder("presence",e)}return(o={VERSION:"1.2.12",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(e){for(var t=0;t<o.XHTML.tags.length;t++)if(e==o.XHTML.tags[t])return!0;return!1},validAttribute:function(e,t){if(void 0!==o.XHTML.attributes[e]&&o.XHTML.attributes[e].length>0)for(var n=0;n<o.XHTML.attributes[e].length;n++)if(t==o.XHTML.attributes[e][n])return!0;return!1},validCSS:function(e){for(var t=0;t<o.XHTML.css.length;t++)if(e==o.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(e,t){o.NS[e]=t},forEachChild:function(e,t,n){var i,s;for(i=0;i<e.childNodes.length;i++)(s=e.childNodes[i]).nodeType!=o.ElementType.NORMAL||t&&!this.isTagEqual(s,t)||n(s)},isTagEqual:function(e,t){return e.tagName==t},_xmlGenerator:null,_makeGenerator:function(){var e;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(e=this._getIEXmlDom()).appendChild(e.createElement("strophe")):e=document.implementation.createDocument("jabber:client","strophe",null),e},xmlGenerator:function(){return o._xmlGenerator||(o._xmlGenerator=o._makeGenerator()),o._xmlGenerator},_getIEXmlDom:function(){for(var e=null,t=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<t.length&&null===e;n++)try{e=new ActiveXObject(t[n])}catch(t){e=null}return e},xmlElement:function(e){if(!e)return null;var t,n,i,s=o.xmlGenerator().createElement(e);for(t=1;t<arguments.length;t++){var r=arguments[t];if(r)if("string"==typeof r||"number"==typeof r)s.appendChild(o.xmlTextNode(r));else if("object"==typeof r&&"function"==typeof r.sort)for(n=0;n<r.length;n++){var a=r[n];"object"==typeof a&&"function"==typeof a.sort&&void 0!==a[1]&&null!==a[1]&&s.setAttribute(a[0],a[1])}else if("object"==typeof r)for(i in r)r.hasOwnProperty(i)&&void 0!==r[i]&&null!==r[i]&&s.setAttribute(i,r[i])}return s},xmlescape:function(e){return e=(e=(e=(e=(e=e.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")},xmlunescape:function(e){return e=(e=(e=(e=(e=e.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')},xmlTextNode:function(e){return o.xmlGenerator().createTextNode(e)},xmlHtmlNode:function(e){var t;return window.DOMParser?t=(new DOMParser).parseFromString(e,"text/xml"):((t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e)),t},getText:function(e){if(!e)return null;var t="";0===e.childNodes.length&&e.nodeType==o.ElementType.TEXT&&(t+=e.nodeValue);for(var n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType==o.ElementType.TEXT&&(t+=e.childNodes[n].nodeValue);return o.xmlescape(t)},copyElement:function(e){var t,n;if(e.nodeType==o.ElementType.NORMAL){for(n=o.xmlElement(e.tagName),t=0;t<e.attributes.length;t++)n.setAttribute(e.attributes[t].nodeName,e.attributes[t].value);for(t=0;t<e.childNodes.length;t++)n.appendChild(o.copyElement(e.childNodes[t]))}else e.nodeType==o.ElementType.TEXT&&(n=o.xmlGenerator().createTextNode(e.nodeValue));return n},createHtml:function(e){var t,n,i,s,r,a,l,c,d,h,u;if(e.nodeType==o.ElementType.NORMAL)if(s=e.nodeName.toLowerCase(),o.XHTML.validTag(s))try{for(n=o.xmlElement(s),t=0;t<o.XHTML.attributes[s].length;t++)if(r=o.XHTML.attributes[s][t],void 0!==(a=e.getAttribute(r))&&null!==a&&""!==a&&!1!==a&&0!==a)if("style"==r&&"object"==typeof a&&void 0!==a.cssText&&(a=a.cssText),"style"==r){for(l=[],c=a.split(";"),i=0;i<c.length;i++)h=(d=c[i].split(":"))[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),o.XHTML.validCSS(h)&&(u=d[1].replace(/^\s*/,"").replace(/\s*$/,""),l.push(h+": "+u));l.length>0&&(a=l.join("; "),n.setAttribute(r,a))}else n.setAttribute(r,a);for(t=0;t<e.childNodes.length;t++)n.appendChild(o.createHtml(e.childNodes[t]))}catch(e){n=o.xmlTextNode("")}else for(n=o.xmlGenerator().createDocumentFragment(),t=0;t<e.childNodes.length;t++)n.appendChild(o.createHtml(e.childNodes[t]));else if(e.nodeType==o.ElementType.FRAGMENT)for(n=o.xmlGenerator().createDocumentFragment(),t=0;t<e.childNodes.length;t++)n.appendChild(o.createHtml(e.childNodes[t]));else e.nodeType==o.ElementType.TEXT&&(n=o.xmlTextNode(e.nodeValue));return n},escapeNode:function(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(e){return e.indexOf("@")<0?null:e.split("@")[0]},getDomainFromJid:function(e){var t=o.getBareJidFromJid(e);if(t.indexOf("@")<0)return t;var n=t.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(e){var t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(e){return e?e.split("/")[0]:null},_handleError:function(e){void 0!==e.stack&&o.fatal(e.stack),e.sourceURL?o.fatal("error: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message):e.fileName?o.fatal("error: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message):o.fatal("error: "+e.message)},log:function(e,t){},debug:function(e){this.log(this.LogLevel.DEBUG,e)},info:function(e){this.log(this.LogLevel.INFO,e)},warn:function(e){this.log(this.LogLevel.WARN,e)},error:function(e){this.log(this.LogLevel.ERROR,e)},fatal:function(e){this.log(this.LogLevel.FATAL,e)},serialize:function(e){var t;if(!e)return null;"function"==typeof e.tree&&(e=e.tree());var n,i,s=e.nodeName;for(e.getAttribute("_realname")&&(s=e.getAttribute("_realname")),t="<"+s,n=0;n<e.attributes.length;n++)"_realname"!=e.attributes[n].nodeName&&(t+=" "+e.attributes[n].nodeName+"='"+o.xmlescape(e.attributes[n].value)+"'");if(e.childNodes.length>0){for(t+=">",n=0;n<e.childNodes.length;n++)switch((i=e.childNodes[n]).nodeType){case o.ElementType.NORMAL:t+=o.serialize(i);break;case o.ElementType.TEXT:t+=o.xmlescape(i.nodeValue);break;case o.ElementType.CDATA:t+="<![CDATA["+i.nodeValue+"]]>"}t+="</"+s+">"}else t+="/>";return t},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){o._connectionPlugins[e]=t}}).Builder=function(e,t){"presence"!=e&&"message"!=e&&"iq"!=e||(t&&!t.xmlns?t.xmlns=o.NS.CLIENT:t||(t={xmlns:o.NS.CLIENT})),this.nodeTree=o.xmlElement(e,t),this.node=this.nodeTree},o.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return o.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(e){for(var t in e)e.hasOwnProperty(t)&&(void 0===e[t]?this.node.removeAttribute(t):this.node.setAttribute(t,e[t]));return this},c:function(e,t,n){var i=o.xmlElement(e,t,n);return this.node.appendChild(i),"string"!=typeof n&&"number"!=typeof n&&(this.node=i),this},cnode:function(e){var t,n=o.xmlGenerator();try{t=void 0!==n.importNode}catch(e){t=!1}var i=t?n.importNode(e,!0):o.copyElement(e);return this.node.appendChild(i),this.node=i,this},t:function(e){var t=o.xmlTextNode(e);return this.node.appendChild(t),this},h:function(e){var t=document.createElement("body");t.innerHTML=e;for(var n=o.createHtml(t);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},o.Handler=function(e,t,n,i,s,r,a){this.handler=e,this.ns=t,this.name=n,this.type=i,this.id=s,this.options=a||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(o.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=r?o.getBareJidFromJid(r):null:this.from=r,this.user=!0},o.Handler.prototype={getNamespace:function(e){var t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t},namespaceMatch:function(e){var t=!1;if(!this.ns)return!0;var n=this;return o.forEachChild(e,null,function(e){n.getNamespace(e)===n.ns&&(t=!0)}),t=t||this.getNamespace(e)===this.ns},isMatch:function(e){var t=e.getAttribute("from");this.options.matchBareFromJid&&(t=o.getBareJidFromJid(t));var n=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!o.isTagEqual(e,this.name)||this.type&&(Array.isArray(this.type)?-1==this.type.indexOf(n):n!=this.type)||this.id&&e.getAttribute("id")!=this.id||this.from&&t!=this.from)},run:function(e){var t=null;try{t=this.handler(e)}catch(e){throw o._handleError(e),e}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},o.TimedHandler=function(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0},o.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},o.Connection=function(e,t){this.service=e,this.options=t||{};var n=this.options.protocol||"";for(var s in 0===e.indexOf("ws:")||0===e.indexOf("wss:")||0===n.indexOf("ws")?this._proto=new o.Websocket(this):this._proto=new o.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100),i.addCookies(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),o._connectionPlugins)if(o._connectionPlugins.hasOwnProperty(s)){var r=o._connectionPlugins[s],a=function(){};a.prototype=r,this[s]=new a,this[s].init(this)}},o.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this.override=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)});return"string"==typeof e||"number"==typeof e?t+":"+e:t+""},addProtocolErrorHandler:function(e,t,n){this.protocolErrorHandlers[e][t]=n},connect:function(e,t,n,i,s,r,a){this.jid=e,this.authzid=o.getBareJidFromJid(this.jid),this.authcid=a||o.getNodeFromJid(this.jid),this.pass=t,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=o.getDomainFromJid(this.jid),this._changeConnectStatus(o.Status.CONNECTING,null),this._proto._connect(i,s,r)},attach:function(e,t,n,i,s,r,a){if(!(this._proto instanceof o.Bosh))throw{name:"StropheSessionError",message:'The "attach" method can only be used with a BOSH connection.'};this._proto._attach(e,t,n,i,s,r,a)},restore:function(e,t,n,i,o){if(!this._sessionCachingSupported())throw{name:"StropheSessionError",message:'The "restore" method can only be used with a BOSH connection.'};this._proto._restore(e,t,n,i,o)},_sessionCachingSupported:function(){if(this._proto instanceof o.Bosh){if(!JSON)return!1;try{window.sessionStorage.setItem("_strophe_","_strophe_"),window.sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1},xmlInput:function(e){},xmlOutput:function(e){},rawInput:function(e){},rawOutput:function(e){},nextValidRid:function(e){},send:function(e){if(null!==e){if("function"==typeof e.sort)for(var t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendPresence:function(e,t,n,i){var o=null,s=this;"function"==typeof e.tree&&(e=e.tree());var r=e.getAttribute("id");if(r||(r=this.getUniqueId("sendPresence"),e.setAttribute("id",r)),"function"==typeof t||"function"==typeof n){var a=this.addHandler(function(e){o&&s.deleteTimedHandler(o),"error"==e.getAttribute("type")?n&&n(e):t&&t(e)},null,"presence",null,r);i&&(o=this.addTimedHandler(i,function(){return s.deleteHandler(a),n&&n(null),!1}))}return this.send(e),r},sendIQ:function(e,t,n,i){var o=null,s=this;"function"==typeof e.tree&&(e=e.tree());var r=e.getAttribute("id");if(r||(r=this.getUniqueId("sendIQ"),e.setAttribute("id",r)),"function"==typeof t||"function"==typeof n){var a=this.addHandler(function(e){o&&s.deleteTimedHandler(o);var i=e.getAttribute("type");if("result"==i)t&&t(e);else{if("error"!=i)throw{name:"StropheError",message:"Got bad IQ type of "+i};n&&n(e)}},null,"iq",["error","result"],r);i&&(o=this.addTimedHandler(i,function(){return s.deleteHandler(a),n&&n(null),!1}))}return this.send(e),r},_queueData:function(e){if(null===e||!e.tagName||!e.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(e)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100)},addTimedHandler:function(e,t){var n=new o.TimedHandler(e,t);return this.addTimeds.push(n),n},deleteTimedHandler:function(e){this.removeTimeds.push(e)},addHandler:function(e,t,n,i,s,r,a){var l=new o.Handler(e,t,n,i,s,r,a);return this.addHandlers.push(l),l},deleteHandler:function(e){this.removeHandlers.push(e);var t=this.addHandlers.indexOf(e);t>=0&&this.addHandlers.splice(t,1)},registerSASLMechanisms:function(e){this.mechanisms={},(e=e||[o.SASLAnonymous,o.SASLExternal,o.SASLMD5,o.SASLOAuthBearer,o.SASLPlain,o.SASLSHA1]).forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(e){this.mechanisms[e.prototype.name]=e},disconnect:function(e,t){if(o.info("Disconnect was called because: "+e),this.connected){this._changeConnectStatus(o.Status.DISCONNECTING,e);var n=!1;this.disconnecting=!0,this.authenticated&&(n=a({xmlns:o.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(n,t)}else o.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect(e)},_changeConnectStatus:function(e,t){for(var n in o._connectionPlugins)if(o._connectionPlugins.hasOwnProperty(n)){var i=this[n];if(i.statusChanged)try{i.statusChanged(e,t)}catch(e){o.error(n+" plugin caused an exception changing status: "+e)}}if(this.connect_callback)try{this.connect_callback(e,t)}catch(e){o._handleError(e),o.error("User connection callback caused an exception: "+e)}},_doDisconnect:function(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),o.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(o.Status.DISCONNECTED,e),this.connected=!1},_dataRecv:function(e,t){o.info("_dataRecv called");var n=this._proto._reqToData(e);if(null!==n){var i,s;for(this.xmlInput!==o.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==o.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(o.serialize(n)));this.removeHandlers.length>0;)s=this.removeHandlers.pop(),(i=this.handlers.indexOf(s))>=0&&this.handlers.splice(i,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())this._doDisconnect();else{var r,a,l=n.getAttribute("type");if(null!==l&&"terminate"==l){if(this.disconnecting)return;return r=n.getAttribute("condition"),a=n.getElementsByTagName("conflict"),null!==r?("remote-stream-error"==r&&a.length>0&&(r="conflict"),this._changeConnectStatus(o.Status.CONNFAIL,r)):this._changeConnectStatus(o.Status.CONNFAIL,"unknown"),void this._doDisconnect(r)}var c=this;o.forEachChild(n,null,function(e){var t,n;for(n=c.handlers,c.handlers=[],t=0;t<n.length;t++){var i=n[t];try{!i.isMatch(e)||!c.authenticated&&i.user?c.handlers.push(i):i.run(e)&&c.handlers.push(i)}catch(e){o.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}}})}}},mechanisms:{},_connect_cb:function(e,t,n){var i;o.info("_connect_cb was called"),this.connected=!0;try{i=this._proto._reqToData(e)}catch(e){if("badformat"!=e)throw e;this._changeConnectStatus(o.Status.CONNFAIL,"bad-format"),this._doDisconnect("bad-format")}if(i&&(this.xmlInput!==o.Connection.prototype.xmlInput&&(i.nodeName===this._proto.strip&&i.childNodes.length?this.xmlInput(i.childNodes[0]):this.xmlInput(i)),this.rawInput!==o.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(o.serialize(i))),this._proto._connect_cb(i)!==o.Status.CONNFAIL))if(i.getElementsByTagNameNS?i.getElementsByTagNameNS(o.NS.STREAM,"features").length>0:i.getElementsByTagName("stream:features").length>0||i.getElementsByTagName("features").length>0){var s,r,a=[],l=i.getElementsByTagName("mechanism");if(l.length>0)for(s=0;s<l.length;s++)r=o.getText(l[s]),this.mechanisms[r]&&a.push(this.mechanisms[r]);0!==a.length||0!==i.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(a):this._proto._no_auth_received(t)}else this._proto._no_auth_received(t)},sortMechanismsByPriority:function(e){var t,n,i,o;for(t=0;t<e.length-1;++t){for(i=t,n=t+1;n<e.length;++n)e[n].prototype.priority>e[i].prototype.priority&&(i=n);i!=t&&(o=e[t],e[t]=e[i],e[i]=o)}return e},_attemptSASLAuth:function(e){e=this.sortMechanismsByPriority(e||[]);var n=0,i=!1;for(n=0;n<e.length;++n)if(e[n].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new e[n],this._sasl_mechanism.onStart(this);var r=s("auth",{xmlns:o.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var a=this._sasl_mechanism.onChallenge(this,null);r.t(t.encode(a))}this.send(r.tree()),i=!0;break}return i},_attemptLegacyAuth:function(){null===o.getNodeFromJid(this.jid)?(this._changeConnectStatus(o.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect("x-strophe-bad-non-anon-jid")):(this._changeConnectStatus(o.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(r({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:o.NS.AUTH}).c("username",{}).t(o.getNodeFromJid(this.jid)).tree()))},authenticate:function(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()},_sasl_challenge_cb:function(e){var n=t.decode(o.getText(e)),i=this._sasl_mechanism.onChallenge(this,n),r=s("response",{xmlns:o.NS.SASL});return""!==i&&r.t(t.encode(i)),this.send(r.tree()),!0},_auth1_cb:function(e){var t=r({type:"set",id:"_auth_2"}).c("query",{xmlns:o.NS.AUTH}).c("username",{}).t(o.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return o.getResourceFromJid(this.jid)||(this.jid=o.getBareJidFromJid(this.jid)+"/strophe"),t.up().c("resource",{}).t(o.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1},_sasl_success_cb:function(e){if(this._sasl_data["server-signature"]){var n,i=t.decode(o.getText(e)).match(/([a-z]+)=([^,]+)(,|$)/);if("v"==i[1]&&(n=i[2]),n!=this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}o.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var s=[],r=function(e,t){for(;e.length;)this.deleteHandler(e.pop());return this._sasl_auth1_cb.bind(this)(t),!1};return s.push(this._addSysHandler(function(e){r.bind(this)(s,e)}.bind(this),null,"stream:features",null,null)),s.push(this._addSysHandler(function(e){r.bind(this)(s,e)}.bind(this),o.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(e){var t,n;for(this.features=e,t=0;t<e.childNodes.length;t++)"bind"==(n=e.childNodes[t]).nodeName&&(this.do_bind=!0),"session"==n.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(o.Status.AUTHFAIL,null),!1;var i=this,a=function(){i._addSysHandler(i._sasl_bind_cb.bind(i),null,null,null,"_bind_auth_2"),i.override&&(i.send(r({type:"set",id:"_override_1"}).c("override",{xmlns:"urn:commontime:infinity:bind","resource-conflict":"closeold"}).tree()),i.override=!1);var e=o.getResourceFromJid(i.jid);e?i.send(r({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:o.NS.BIND}).c("resource",{}).t(e).tree()):i.send(r({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:o.NS.BIND}).tree())};return void 0!==this.streamManagement&&void 0!==this.streamManagement.prevId?(this._addSysHandler(function(){return i.authenticated=!0,i._changeConnectStatus(o.Status.CONNECTED,"resumed"),!1},"urn:xmpp:sm:3","resumed"),this._addSysHandler(function(){return a(),!1},"urn:xmpp:sm:3","failed"),this.send(s("resume",{xmlns:"urn:xmpp:sm:3",previd:this.streamManagement.prevId,h:this.streamManagement.getIncomingCounter()||0}))):a(),!1},_sasl_bind_cb:function(e){var t;if("error"==e.getAttribute("type"))return o.info("SASL binding failed."),e.getElementsByTagName("conflict").length>0&&(t="conflict",this._doDisconnect(t)),this._changeConnectStatus(o.Status.AUTHFAIL,t),!1;var n,i=e.getElementsByTagName("bind");if(!(i.length>0))return o.info("SASL binding failed."),this._changeConnectStatus(o.Status.AUTHFAIL,null),!1;(n=i[0].getElementsByTagName("jid")).length>0&&(this.jid=o.getText(n[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(r({type:"set",id:"_session_auth_2"}).c("session",{xmlns:o.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(o.Status.CONNECTED,null)))},_sasl_session_cb:function(e){if("result"==e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(o.Status.CONNECTED,null);else if("error"==e.getAttribute("type"))return o.info("Session creation failed."),this._changeConnectStatus(o.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(e){this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure();const t=e.getElementsByTagName("text")[0];let n=null;return void 0!==t&&(n=t.innerHTML||null),this._changeConnectStatus(o.Status.AUTHFAIL,n),this.disconnect(n),!1},_auth2_cb:function(e){return"result"==e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(o.Status.CONNECTED,null)):"error"==e.getAttribute("type")&&(this._changeConnectStatus(o.Status.AUTHFAIL,null),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(e,t){var n=new o.TimedHandler(e,t);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(e,t,n,i,s){var r=new o.Handler(e,t,n,i,s);return r.user=!1,this.addHandlers.push(r),r},_onDisconnectTimeout:function(){return o.info("_onDisconnectTimeout was called"),this._changeConnectStatus(o.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var e,t,n;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)t=this.removeTimeds.pop(),(e=this.timedHandlers.indexOf(t))>=0&&this.timedHandlers.splice(e,1);var i=(new Date).getTime();for(n=[],e=0;e<this.timedHandlers.length;e++)t=this.timedHandlers[e],!this.authenticated&&t.user||(t.lastCalled+t.period-i<=0?t.run()&&n.push(t):n.push(t));this.timedHandlers=n,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),1e3))}},o.SASLMechanism=function(e,t,n){this.name=e,this.isClientFirst=t,this.priority=n},o.SASLMechanism.prototype={test:function(e){return!0},onStart:function(e){this._connection=e},onChallenge:function(e,t){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},o.SASLAnonymous=function(){},o.SASLAnonymous.prototype=new o.SASLMechanism("ANONYMOUS",!1,20),o.SASLAnonymous.prototype.test=function(e){return null===e.authcid},o.SASLPlain=function(){},o.SASLPlain.prototype=new o.SASLMechanism("PLAIN",!0,30),o.SASLPlain.prototype.test=function(e){return null!==e.authcid},o.SASLPlain.prototype.onChallenge=function(e){var t=e.authzid;return t+="\0",t+=e.authcid,t+="\0",t+=e.pass,i.utf16to8(t)},o.SASLSHA1=function(){},o.SASLSHA1.prototype=new o.SASLMechanism("SCRAM-SHA-1",!0,50),o.SASLSHA1.prototype.test=function(e){return null!==e.authcid},o.SASLSHA1.prototype.onChallenge=function(o,s,r){var a=r||n.hexdigest(1234567890*Math.random()),l="n="+i.utf16to8(o.authcid);return l+=",r=",l+=a,o._sasl_data.cnonce=a,o._sasl_data["client-first-message-bare"]=l,l="n,,"+l,this.onChallenge=function(n,o){for(var s,r,a,l,c,d,h,u,p,g,m,f,_="c=biws,",v=n._sasl_data["client-first-message-bare"]+","+o+",",y=n._sasl_data.cnonce,C=/([a-z]+)=([^,]+)(,|$)/;o.match(C);){var w=o.match(C);switch(o=o.replace(w[0],""),w[1]){case"r":s=w[2];break;case"s":r=w[2];break;case"i":a=w[2]}}if(s.substr(0,y.length)!==y)return n._sasl_data={},n._sasl_failure_cb();for(v+=_+="r="+s,r=t.decode(r),r+="\0\0\0",p=i.utf16to8(n.pass),l=d=e.core_hmac_sha1(p,r),h=1;h<a;h++){for(c=e.core_hmac_sha1(p,e.binb2str(d)),u=0;u<5;u++)l[u]^=c[u];d=c}for(l=e.binb2str(l),g=e.core_hmac_sha1(l,"Client Key"),m=e.str_hmac_sha1(l,"Server Key"),f=e.core_hmac_sha1(e.str_sha1(e.binb2str(g)),v),n._sasl_data["server-signature"]=e.b64_hmac_sha1(m,v),u=0;u<5;u++)g[u]^=f[u];return _+=",p="+t.encode(e.binb2str(g))}.bind(this),l},o.SASLMD5=function(){},o.SASLMD5.prototype=new o.SASLMechanism("DIGEST-MD5",!1,40),o.SASLMD5.prototype.test=function(e){return null!==e.authcid},o.SASLMD5.prototype._quote=function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},o.SASLMD5.prototype.onChallenge=function(e,t,o){for(var s,r=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,a=o||n.hexdigest(""+1234567890*Math.random()),l="",c=null,d="";t.match(r);)switch(s=t.match(r),t=t.replace(s[0],""),s[2]=s[2].replace(/^"(.+)"$/,"$1"),s[1]){case"realm":l=s[2];break;case"nonce":d=s[2];break;case"qop":s[2];break;case"host":c=s[2]}var h=e.servtype+"/"+e.domain;null!==c&&(h=h+"/"+c);var u=i.utf16to8(e.authcid+":"+l+":"+this._connection.pass),p=n.hash(u)+":"+d+":"+a,g="AUTHENTICATE:"+h,m="";return m+="charset=utf-8,",m+="username="+this._quote(i.utf16to8(e.authcid))+",",m+="realm="+this._quote(l)+",",m+="nonce="+this._quote(d)+",",m+="nc=00000001,",m+="cnonce="+this._quote(a)+",",m+="digest-uri="+this._quote(h)+",",m+="response="+n.hexdigest(n.hexdigest(p)+":"+d+":00000001:"+a+":auth:"+n.hexdigest(g))+",",m+="qop=auth",this.onChallenge=function(){return""},m},o.SASLOAuthBearer=function(){},o.SASLOAuthBearer.prototype=new o.SASLMechanism("OAUTHBEARER",!0,60),o.SASLOAuthBearer.prototype.test=function(e){return null!==e.authcid},o.SASLOAuthBearer.prototype.onChallenge=function(e){var t="n,a=";return t+=e.authzid,t+=",",t+="",t+="auth=Bearer ",t+=e.pass,t+="",t+="",i.utf16to8(t)},o.SASLExternal=function(){},o.SASLExternal.prototype=new o.SASLMechanism("EXTERNAL",!0,10),o.SASLExternal.prototype.onChallenge=function(e){return e.authcid===e.authzid?"":e.authzid},{Strophe:o,$build:s,$msg:function(e){return new o.Builder("message",e)},$iq:r,$pres:a,SHA1:e,Base64:t,MD5:n}}.apply(this,arguments)}.apply(t,[s,i,a,c,h]),p=function(e){return function(e,t){return e.Request=function(t,n,i,o){this.id=++e._requestId,this.xmlData=t,this.data=e.serialize(t),this.origFunc=n,this.func=n,this.rid=i,this.date=NaN,this.sends=o||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()},e.Request.prototype={getResponse:function(){var t=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if("parsererror"==(t=this.xhr.responseXML.documentElement).tagName)throw e.error("invalid response received"),e.error("responseText: "+this.xhr.responseText),e.error("responseXML: "+e.serialize(this.xhr.responseXML)),"parsererror"}else if(this.xhr.responseText)throw e.error("invalid response received"),e.error("responseText: "+this.xhr.responseText),"badformat";return t},_newXHR:function(){var e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest).overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8"):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},e.Bosh=function(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this._requests=[]},e.Bosh.prototype={strip:null,_buildBody:function(){var n=t("body",{rid:this.rid++,xmlns:e.NS.HTTPBIND});return null!==this.sid&&n.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),n},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(t,n,i){this.wait=t||this.wait,this.hold=n||this.hold,this.errors=0;var o=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":e.NS.BOSH});i&&o.attrs({route:i});var s=this._conn._connect_cb;this._requests.push(new e.Request(o.tree(),this._onRequestStateChange.bind(this,s.bind(this._conn)),o.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(t,n,i,o,s,r,a){this._conn.jid=t,this.sid=n,this.rid=i,this._conn.connect_callback=o,this._conn.domain=e.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=s||this.wait,this.hold=r||this.hold,this.window=a||this.window,this._conn._changeConnectStatus(e.Status.ATTACHED,null)},_restore:function(t,n,i,o,s){var r=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(void 0!==r&&null!==r&&r.rid&&r.sid&&r.jid&&(void 0===t||null===t||e.getBareJidFromJid(r.jid)==e.getBareJidFromJid(t)||null===e.getNodeFromJid(t)&&e.getDomainFromJid(r.jid)==t)))throw{name:"StropheSessionError",message:"_restore: no restoreable session."};this._conn.restored=!0,this._attach(r.jid,r.sid,r.rid,n,i,o,s)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(t){var n,i,o=t.getAttribute("type");if(null!==o&&"terminate"==o)return n=t.getAttribute("condition"),e.error("BOSH-Connection failed: "+n),i=t.getElementsByTagName("conflict"),null!==n?("remote-stream-error"==n&&i.length>0&&(n="conflict"),this._conn._changeConnectStatus(e.Status.CONNFAIL,n)):this._conn._changeConnectStatus(e.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(n),e.Status.CONNFAIL;this.sid||(this.sid=t.getAttribute("sid"));var s=t.getAttribute("requests");s&&(this.window=parseInt(s,10));var r=t.getAttribute("hold");r&&(this.hold=parseInt(r,10));var a=t.getAttribute("wait");a&&(this.wait=parseInt(a,10));var l=t.getAttribute("inactivity");l&&(this.inactivity=parseInt(l,10))},_disconnect:function(e){this._sendTerminate(e)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(e){var t,n=this._getRequestStatus(e);(t=this._conn.protocolErrorHandlers.HTTP[n])&&t.call(this,n)},_hitError:function(t){this.errors++,e.warn("request errored, status: "+t+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(t){t=t?t.bind(this._conn):this._conn._connect_cb.bind(this._conn);var n=this._buildBody();this._requests.push(new e.Request(n.tree(),this._onRequestStateChange.bind(this,t.bind(this._conn)),n.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(var e;this._requests.length>0;)(e=this._requests.pop()).abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}},_onIdle:function(){var t=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===t.length&&!this._conn.disconnecting&&(e.info("no requests during idle cycle, sending blank request"),t.push(null)),!this._conn.paused){if(this._requests.length<2&&t.length>0){for(var n=this._buildBody(),i=0;i<t.length;i++)null!==t[i]&&("restart"===t[i]?n.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":e.NS.BOSH}):n.cnode(t[i]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new e.Request(n.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),n.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var o=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(e.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),o>Math.floor(e.TIMEOUT*this.wait)&&(e.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(e.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_getRequestStatus:function(t,n){var i;if(4==t.xhr.readyState)try{i=t.xhr.status}catch(t){e.error("Caught an error while retrieving a request's status, reqStatus: "+i)}return void 0===i&&(i="number"==typeof n?n:0),i},_onRequestStateChange:function(t,n){if(e.debug("request id "+n.id+"."+n.sends+" state changed to "+n.xhr.readyState),n.abort)n.abort=!1;else if(4===n.xhr.readyState){var i=this._getRequestStatus(n);if(this.disconnecting&&i>=400)return this._hitError(i),void this._callProtocolErrorHandlers(n);if((i>0&&i<500||n.sends>5)&&(this._removeRequest(n),e.debug("request id "+n.id+" should now be removed")),200==i){var o=this._requests[0]==n;(this._requests[1]==n||o&&this._requests.length>0&&this._requests[0].age()>Math.floor(e.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(n.rid)+1),e.debug("request id "+n.id+"."+n.sends+" got 200"),t(n),this.errors=0}else 0===i||i>=400&&i<600||i>=12e3?(e.error("request id "+n.id+"."+n.sends+" error "+i+" happened"),this._hitError(i),this._callProtocolErrorHandlers(n),i>=400&&i<500&&(this._conn._changeConnectStatus(e.Status.DISCONNECTING,null),this._conn._doDisconnect())):e.error("request id "+n.id+"."+n.sends+" error "+i+" happened");i>0&&i<500&&!(n.sends>5)||this._throttledRequestHandler()}},_processRequest:function(t){var n=this,i=this._requests[t],o=this._getRequestStatus(i,-1);if(i.sends>this._conn.maxRetries)this._conn._onDisconnectTimeout();else{var s=i.age(),r=!isNaN(s)&&s>Math.floor(e.TIMEOUT*this.wait),a=null!==i.dead&&i.timeDead()>Math.floor(e.SECONDARY_TIMEOUT*this.wait),l=4==i.xhr.readyState&&(o<1||o>=500);if((r||a||l)&&(a&&e.error("Request "+this._requests[t].id+" timed out (secondary), restarting"),i.abort=!0,i.xhr.abort(),i.xhr.onreadystatechange=function(){},this._requests[t]=new e.Request(i.xmlData,i.origFunc,i.rid,i.sends),i=this._requests[t]),0===i.xhr.readyState){e.debug("request id "+i.id+"."+i.sends+" posting");try{var c=this._conn.options.contentType||"text/xml; charset=utf-8";i.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==i.xhr.setRequestHeader&&i.xhr.setRequestHeader("Content-Type",c),this._conn.options.withCredentials&&(i.xhr.withCredentials=!0)}catch(t){return e.error("XHR open failed."),this._conn.connected||this._conn._changeConnectStatus(e.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var d=function(){if(i.date=new Date,n._conn.options.customHeaders){var e=n._conn.options.customHeaders;for(var t in e)e.hasOwnProperty(t)&&i.xhr.setRequestHeader(t,e[t])}i.xhr.send(i.data)};if(i.sends>1){var h=1e3*Math.min(Math.floor(e.TIMEOUT*this.wait),Math.pow(i.sends,3));setTimeout(function(){d()},h)}else d();i.sends++,this._conn.xmlOutput!==e.Connection.prototype.xmlOutput&&(i.xmlData.nodeName===this.strip&&i.xmlData.childNodes.length?this._conn.xmlOutput(i.xmlData.childNodes[0]):this._conn.xmlOutput(i.xmlData)),this._conn.rawOutput!==e.Connection.prototype.rawOutput&&this._conn.rawOutput(i.data)}else e.debug("_processRequest: "+(0===t?"first":"second")+" request has readyState of "+i.xhr.readyState)}},_removeRequest:function(t){var n;for(e.debug("removing request"),n=this._requests.length-1;n>=0;n--)t==this._requests[n]&&this._requests.splice(n,1);t.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(e){var t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)},_reqToData:function(e){try{return e.getResponse()}catch(e){if("parsererror"!=e)throw e;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(t){e.info("_sendTerminate was called");var n=this._buildBody().attrs({type:"terminate"});t&&n.cnode(t.tree());var i=new e.Request(n.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),n.tree().getAttribute("rid"));this._requests.push(i),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?e.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):e.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},e}(e.Strophe,e.$build)}.apply(t,[u]),g=function(e){return function(e,t){return e.Websocket=function(e){this._conn=e,this.strip="wrapper";var t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){var n="";"ws"===e.options.protocol&&"https:"!==window.location.protocol?n+="ws":n+="wss",n+="://"+window.location.host,0!==t.indexOf("/")?n+=window.location.pathname+t:n+=t,e.service=n}},e.Websocket.prototype={_buildStream:function(){return t("open",{xmlns:e.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(t,n){var i;if(0===(i=t.getElementsByTagNameNS?t.getElementsByTagNameNS(e.NS.STREAM,"error"):t.getElementsByTagName("stream:error")).length)return!1;for(var o=i[0],s="",r=0;r<o.childNodes.length;r++){var a=o.childNodes[r];if("urn:ietf:params:xml:ns:xmpp-streams"!==a.getAttribute("xmlns"))break;s="text"===a.nodeName?a.textContent:a.nodeName}var l="WebSocket stream error: ";return l+=s||"unknown",e.error(l),this._conn._changeConnectStatus(n,s),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(t){if(this._check_streamerror(t,e.Status.CONNFAIL))return e.Status.CONNFAIL},_handleStreamStart:function(t){var n=!1,i=t.getAttribute("xmlns");"string"!=typeof i?n="Missing xmlns in <open />":i!==e.NS.FRAMING&&(n="Wrong xmlns in <open />: "+i);var o=t.getAttribute("version");return"string"!=typeof o?n="Missing version in <open />":"1.0"!==o&&(n="Wrong version in <open />: "+o),!n||(this._conn._changeConnectStatus(e.Status.CONNFAIL,n),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(t){if(0===t.data.indexOf("<open ")||0===t.data.indexOf("<?xml")){var n=t.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===n)return;var i=(new DOMParser).parseFromString(n,"text/xml").documentElement;this._conn.xmlInput(i),this._conn.rawInput(t.data),this._handleStreamStart(i)&&this._connect_cb(i)}else if(0===t.data.indexOf("<close ")){this._conn.rawInput(t.data),this._conn.xmlInput(t);var o=t.getAttribute("see-other-uri");o?(this._conn._changeConnectStatus(e.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=o,this._connect()):(this._conn._changeConnectStatus(e.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect())}else{var s=this._streamWrap(t.data),r=(new DOMParser).parseFromString(s,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(r,null,t.data)}},_disconnect:function(n,i){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED&&(n&&this._conn.send(n),!0!==i)){var o=t("close",{xmlns:e.NS.FRAMING});this._conn.xmlOutput(o);var s=e.serialize(o);this._conn.rawOutput(s);try{this.socket.send(s)}catch(t){e.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){e.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(e){return"<wrapper>"+e+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.close()}catch(e){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(t){this._conn.connected&&!this._conn.disconnecting?(e.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):t&&1006===t.code&&!this._conn.connected&&this.socket?(e.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(e.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):e.info("Websocket closed")},_no_auth_received:function(t){e.error("Server did not send any auth methods"),this._conn._changeConnectStatus(e.Status.CONNFAIL,"Server did not send any auth methods"),t&&(t=t.bind(this._conn))(),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(t){e.error("Websocket error "+t),this._conn._changeConnectStatus(e.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){if(null!==this.socket){var t=this._conn._data;if(t.length>0&&!this._conn.paused){for(var n=0;n<t.length;n++){var i,o;null!==t[n]&&(i="restart"===t[n]?this._buildStream().tree():t[n],o=e.serialize(i),this._conn.xmlOutput(i),this._conn.rawOutput(o),this.socket.send(o))}this._conn._data=[]}}},_onMessage:function(t){var n,i,o='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(t.data===o)return this._conn.rawInput(o),this._conn.xmlInput(t),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===t.data.search("<open ")){if(n=(new DOMParser).parseFromString(t.data,"text/xml").documentElement,!this._handleStreamStart(n))return}else i=this._streamWrap(t.data),n=(new DOMParser).parseFromString(i,"text/xml").documentElement;return this._check_streamerror(n,e.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===n.firstChild.nodeName&&"unavailable"===n.firstChild.getAttribute("type")?(this._conn.xmlInput(n),void this._conn.rawInput(e.serialize(n))):void this._conn._dataRecv(n,t.data)},_onOpen:function(){e.info("Websocket open");var t=this._buildStream();this._conn.xmlOutput(t.tree());var n=e.serialize(t);this._conn.rawOutput(n),this.socket.send(n)},_reqToData:function(e){return e},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}},e}(e.Strophe,e.$build)}.apply(t,[u]),void 0===(m=function(e){return e}.apply(t,[u,p,g]))||(e.exports=m)},function(e,t,n){e.exports=n(23)},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(1),s=n(33),r=n(14),a=n(19),l=n(0),c=n(16),d=n(170),h=n(21),u=n(6),p=n(4),g=n(79),m=n(238),f=n(239),_=n(11),v=n(410),y=n(20),C=n(5),w=n(27),b=n(413),E=n(34),T=n(25),R=n(95),I=n(98);n(414);const A=n(56),S=n(57),x=n(7),O=n(9),M=n(30),L=n(415);class N extends o.BaseLayer{constructor(e,t,n){super(e,t),this.VERSION="1.0.0",this.bootstrapper=null,this.dismissTimeout=null,this.currentlyAlerting=!1,this.isConversationErrorAndExists=!1,this.currentUser=null,this._allConversations=[],this._currentConversation=null,this._conversationsBeingPurged=[],this._pendingConversationAlerts=[],this._isFetchingChatEntries=!1,this.name=e,this.config=this._checkConfigForPreferences(t);const o=localStorage.getItem(`${this.name}_config`);if(null!==o&&(this.config=L(this.config,JSON.parse(o),{arrayMerge:(e,t,n)=>t})),!this.config.xmpp)throw new Error("What are you doing not specifying XMPP configuration?");this.config.groups||(this.config.groups={enableGroups:!0}),this.config.xmpp.mam&&(this.config.xmpp.mam.autoFetch=!1),this.config.xmpp.updateUserDirectoryOnLogin=!0,this.config.xmpp.bringToForegroundOnVoipPush=!1,this.config.behaviour.updateUsersOnNewConversationClick=!0;const s=n&&n.store||new v.Store(e,this.logger,t),a=n&&n.comms||new d.Comms(e,t.xmpp,s,this.logger,this);this.bootstrapper=this.bootstrap(a,s),this.bootstrapper.then(()=>{this.comms.user=this.store.getCurrentUser(),this.comms.username=this.comms.user?this.comms.user.jid:null,this.on(u.ChatEvents.ForceQuitConversation,e=>i(this,void 0,void 0,function*(){const t=yield this.getCurrentConversation();t&&t.id===e.conversation.id&&(yield this.clearCurrentConversation(),yield this.purgeConversation(t))})),this.on(u.ChatEvents.PriorityConversationNotification,e=>{e.conversation&&!this._pendingConversationAlerts.find(t=>t.id===e.conversation.id)&&this._pendingConversationAlerts.push(e.conversation)}),this.on(u.ChatEvents.PriorityConversationAcknowledged,e=>{const t=this._pendingConversationAlerts.findIndex(t=>t.id===e.conversation.id);t>-1&&this._pendingConversationAlerts.splice(t,1)}),this.on(r.BaseEvents.AuthenticationCredentialsReset,()=>i(this,void 0,void 0,function*(){this.error("Error Reconnecting","Your login credientials are no longer valid, please re-login with new credentials."),this.logout(!0,!0)})),E.default.setMyDelegateAccounts(this.store.getMyDelegates())}),window.simpleAudioPlayer=new g.SimpleAudioPlayer(e=>{const t={filePath:window.simpleAudioPlayer.src,eventDate:(new Date).getTime()};e===g.MediaStatus.MEDIA_LOOPING_END&&this.emit(r.BaseEvents.AudioLoopingEnd,t)}),window.vibrationController=new m.VibrationController}_checkConfigForPreferences(e){function t(e,t=null){return e?e&&e instanceof Array==!1&&Object.keys(e).includes("readFromPreferences")?e.readFromPreferences:e:t}return e.xmpp=t(e.xmpp,{}),e.behaviour=t(e.behaviour,{}),e.conversationTypes=t(e.conversationTypes,[]),e.roles=t(e.roles,{}),e.priorities=t(e.priorities,[]),e}cancelAutoDismiss(){this.dismissTimeout&&(clearTimeout(this.dismissTimeout),this.dismissTimeout=null)}generateCommonComponents(e){return i(this,void 0,void 0,function*(){this._contactInfoModal=document.querySelector("ct-cl-contact-info"),this._contactInfoModal||(this._contactInfoModal=document.createElement("ct-cl-contact-info"),this._contactInfoModal.owner=this.name,e.appendChild(this._contactInfoModal)),this._alertModal=document.querySelector("ct-cl-conversation-alert"),this._alertModal||(this._alertModal=document.createElement("ct-cl-conversation-alert"),this._alertModal.owner=this.name,e.appendChild(this._alertModal)),this._roleInfoModal=document.querySelector("ct-cl-role-users-modal"),this._roleInfoModal||(this._roleInfoModal=document.createElement("ct-cl-role-users-modal"),this._roleInfoModal.owner=this.name,e.appendChild(this._roleInfoModal)),this._responseModal=document.querySelector("ctcl-responses-modal"),this._responseModal||(this._responseModal=document.createElement("ctcl-responses-modal"),this._responseModal.owner=this.name,e.appendChild(this._responseModal)),this._accountMenu=document.querySelector("ctcl-account-menu"),this._accountMenu||(w.CTCLAccountMenu.register(),this._accountMenu=document.createElement("ctcl-account-menu"),this._accountMenu.owner=this.name,e.appendChild(this._accountMenu)),this._delegateManagement=document.querySelector("ctcl-delegate-management"),this._delegateManagement||(w.CTCLAccountMenu.register(),this._delegateManagement=document.createElement("ctcl-delegate-management"),this._delegateManagement.owner=this.name,e.appendChild(this._delegateManagement)),this._roleAdmin=document.querySelector("ctcl-role-admin"),this._roleAdmin||(R.CTCLRoleAdmin.register(),this._roleAdmin=document.createElement("ctcl-role-admin"),this._roleAdmin.owner=this.name,e.appendChild(this._roleAdmin)),this._userAdmin=document.querySelector("ctcl-user-admin"),this._userAdmin||(I.CTCLUserAdmin.register(),this._userAdmin=document.createElement("ctcl-user-admin"),this._userAdmin.owner=this.name,e.appendChild(this._userAdmin)),this._groupAdmin=document.querySelector("ctcl-group-admin"),this._groupAdmin||(w.CTCLGroupAdmin.register(),this._groupAdmin=document.createElement("ctcl-group-admin"),this._groupAdmin.owner=this.name,e.appendChild(this._groupAdmin)),this._roleDetailModal=document.querySelector("ct-cl-role-detail-modal"),this._roleDetailModal||(this._roleDetailModal=document.createElement("ct-cl-role-detail-modal"),this._roleDetailModal.owner=this.name,e.appendChild(this._roleDetailModal)),this._addRoleUsersModal=document.querySelector("ct-cl-add-role-users-modal"),this._addRoleUsersModal||(this._addRoleUsersModal=document.createElement("ct-cl-add-role-users-modal"),this._addRoleUsersModal.owner=this.name,e.appendChild(this._addRoleUsersModal)),this._groupDetailModal=document.querySelector("ct-cl-group-detail-modal"),this._groupDetailModal||(this._groupDetailModal=document.createElement("ct-cl-group-detail-modal"),this._groupDetailModal.owner=this.name,e.appendChild(this._groupDetailModal)),this._addGroupMembersModal=document.querySelector("ct-cl-add-group-members-modal"),this._addGroupMembersModal||(this._addGroupMembersModal=document.createElement("ct-cl-add-group-members-modal"),this._addGroupMembersModal.owner=this.name,e.appendChild(this._addGroupMembersModal))})}getHandlers(){return p.get(this)}mute(){this.emit(u.ChatEvents.Mute)}getCurrentXmppDisplayName(){const e=this.getCurrentUser();return e&&C.formatUserName(e,C.NameFormat.PREFIX_INITIAL_LAST)||""}getCurrentUser(){return this.comms.user}loadConversations(){return i(this,void 0,void 0,function*(){return 0===this._allConversations.length&&(this._allConversations=yield this.store.loadConversations()),this._allConversations})}loadAllConversations(e=null){return i(this,void 0,void 0,function*(){let t=null;if(null===e)t=e=this.getWorkspaceJid();else{t=e=e.toLowerCase();const n=E.default.getDelegateName(e);n&&(e=`${n}/${e}`)}let n=0,i=[];const o=this.store.getDelegateConversations();e?o[t]?(n=o[t].latestIdentifier,i=o[t].conversations):o[t]={latestIdentifier:0,conversations:[]}:(n=yield this.store.getLatestIdentifier(),i=yield this.store.loadConversations());const s={timestamp:n,max:0===n?1:10};this.logger.log(a.LoggerTypes.Other,"%c FETCHING ALL CONVERSATIONS","color: #696; font-weight: bold;");const r=yield this._sendIqCommand(p.ChatMessageType.FetchConversations,s,e);r.data&&r.data.lastIdentifier&&(e?o[t].latestIdentifier=r.data.lastIdentifier:yield this.store.updateLatestIdentifier(null,r.data.lastIdentifier));const l=r.data&&r.data.conversations||[];this.logger.log(a.LoggerTypes.Other,"%c CONVERSATIONS SINCE LAST FETCH:",l,"color: #696; font-weight: bold;");const c=[...i];l.length>0&&l.forEach(e=>{const t=c.findIndex(t=>t.id===e.id);-1!==t?c[t]=e:c.push(e)}),c.forEach(e=>{e.preview&&e.preview.date>(e.hideBefore||e.lastHideBefore)&&(e.lastHideBefore=e.hideBefore||e.lastHideBefore,e.hideBefore=0)}),e&&(o[t].conversations=c,yield this.store.setDelegateConversations(o)),yield this.store.saveConversations(c),this._allConversations=c;const d=[];l.forEach(e=>{d.push(e.roomJid)}),c.forEach(e=>{d.indexOf(e.roomJid)<0&&this.removeConversationById(e.roomJid)})})}getConversations(){return i(this,void 0,void 0,function*(){return C.deepCloneArray(this._allConversations||[])})}getConversationById(e){return i(this,void 0,void 0,function*(){return(yield this.getConversations()).find(t=>t.id===e)||null})}getConversationByRoomJid(e){return i(this,void 0,void 0,function*(){return(yield this.getConversations()).find(t=>t.roomJid===e)||null})}getConversationByRoomJidAcrossWorkspaces(e){return i(this,void 0,void 0,function*(){let t=(yield this.getConversations()).find(t=>t.roomJid===e)||null;if(!t){const n=this.store.getDelegateConversations();for(const i in n){if(t=n[i].conversations.find(t=>t.roomJid===e)||null)return t}}return t})}getConversationsForWorkspace(e){return i(this,void 0,void 0,function*(){e=e.toLowerCase();const t=this.store.getDelegateConversations();return t[e]?this._allConversations=t[e].conversations:e===this.getCurrentUserJid()&&(this._allConversations=yield this.store.loadConversations()),this._allConversations.filter(t=>!(!t.participants.find(t=>t.jid.toLowerCase()===e.toLowerCase())||t.hideBefore))})}getUnreadCountForUser(e=null){const t=(e||this.store.getWorkspaceAccount()||this.getCurrentUserJid()).toLowerCase(),n=this.store.getDelegateConversations()[t];if(n){return n.conversations.filter(n=>{if(1===n.participants.length){return!(n.participants[0].jid===t)}return!!n.participants.find(e=>e.jid.toLowerCase()===t)&&!(!n.hasUnread||n.isClosed||n.hideBefore||!(n.preview&&n.preview.from!==e||n.instigator!==e))}).length}return 0}getTotalUnreadCount(e=null){const t=[...E.default.getDelegatedAccounts(),this.getCurrentUserJid().toLowerCase()];if(e){const n=t.findIndex(t=>t.toLowerCase()===e.toLowerCase());n>-1&&t.splice(n,1)}return t.reduce((e,t)=>e+this.getUnreadCountForUser(t),0)}getDirectConversationByParticipants(e){return i(this,void 0,void 0,function*(){const t=new Map;(yield this.getConversations()).filter(e=>e.type===_.ConversationType.Direct).forEach(e=>{t.set(c.getParticipantHash(e.participants),e)});const n=c.getParticipantHash(e);return t.get(n)||null})}createConversationFromProvisional(e){return i(this,void 0,void 0,function*(){return e.isProvisional?this.createConversation(e.participants,e.subject,e.description,e.expiryTTL,e.activityTTL,e.config):null})}addConversation(e,t){return i(this,void 0,void 0,function*(){e.preview=t;const n=e.participants.map(e=>e.jid),i=this.store.getDelegateConversations();for(const t of n){const n=i[t];n&&(-1===n.conversations.findIndex(t=>t.id===e.id)&&(e.hasUnread=!0,n.conversations.push(e)))}yield this.store.setDelegateConversations(i),this.emit(u.ChatEvents.ConversationAdded,new u.ConversationEventArgs(e)),this.emit(u.ChatEvents.ChatEntryReceivedInWorkspace)})}updateConversation(e,t={},n){return i(this,void 0,void 0,function*(){const i=this.store.getDelegateConversations();for(const o in i){if(n&&n.toLowerCase()!==o.toLowerCase())continue;let s=i[o].conversations.findIndex(t=>t.id===e.id);if(-1===s){if(-1===e.participants.findIndex(e=>e.jid===o))continue;i[o].conversations.push(e),s=i[o].conversations.length-1}const r=i[o].conversations[s];if(t.preview&&((!r.preview||t.preview.date>r.preview.date)&&(e.preview=t.preview,t.overrideHasUnread||(e.hasUnread=!0)),e.hideBefore&&(e.lastHideBefore=e.hideBefore,e.hideBefore=0)),i[o].conversations[s]=C.deepCloneObject(e),this.getWorkspaceJid()===o){this._allConversations=i[o].conversations,yield this.store.saveConversations(this._allConversations);const n=yield this.getCurrentConversation();n&&n.id===e.id&&(yield this.setCurrentConversation(e)),this.emit(u.ChatEvents.ConversationUpdated,new u.ConversationEventArgs(e)),t.isParticipantChange&&this.emit(u.ChatEvents.ConversationParticipantsChanged,new u.ConversationParticiantsEventArgs(e,e.participants))}}e.hasUnread&&!e.isClosed&&e.hideBefore>0==!1?M.addConversationToAppGroupStorage(e.id):M.removeConversationFromAppGroupStorage(e.id),yield this.store.setDelegateConversations(i)})}saveConversationDraft(e,t){return i(this,void 0,void 0,function*(){const n=this._allConversations.find(t=>t.id===e.id);n&&(t?n.draft=t:delete n.draft,e.type===_.ConversationType.Direct?yield this.updateConversation(n,{},this.getWorkspaceJid()):yield this.updateConversation(n))})}closeConversation(e,t,n,o){return i(this,void 0,void 0,function*(){if(n){const t=yield this.getConversationsForWorkspace(n);if(!(e=t.find(t=>t.id===e.id)))return}e.participants=[],e.isClosed=!0,this.isLastConversationInDelegateAccounts(e)&&(yield this.comms.clearStoredConversationMessages(e),yield this.comms.clearStoredConversationAttachments(e)),yield this.updateConversation(e,{preview:t,isParticipantChange:o},n),yield this._alertModal.conversationClosed(e),this.emit(u.ChatEvents.ConversationClosed,new u.ConversationEventArgs(e))})}shouldCloseConversation(e,t){const n=this.store.getMyDelegates();let i=!0;return e.participants.forEach(e=>{const o=n.find(t=>t.jid===e.jid);o&&o.jid!==t&&(i=!1),e.jid===this.getCurrentUserJid()&&e.jid!==t&&(i=!1)}),i}isLastConversationInDelegateAccounts(e){const t=this.store.getDelegateConversations();let n=0;for(const i in t){const o=t[i].conversations.find(t=>t.id===e.id);o&&!o.isClosed&&n++}return!(n>1)}isConversationAnAlert(e){const t=e.priority,n=e.config&&e.config.behaviour;return(t&&"urgent"===t.toLocaleLowerCase()||n.usePagerUI||n.chatAvailable)&&n&&n.hasOwnProperty("alert")||!1}displayNewestAlert(){return i(this,void 0,void 0,function*(){const e=this.getNewestPendingAlert();e&&(yield this.priorityAlert(e))})}priorityAlert(e,t=!1){return i(this,void 0,void 0,function*(){const n=new h.ConversationConfigReader(this,e);if(n.alert&&e.instigator!==this.getWorkspaceJid()){if(!c.isExpiredConversation(e)){if(e.config&&e.config.behaviour&&e.config.behaviour.alert&&e.config.behaviour.alert.alertSoundLoops>0&&e.receivedList&&e.receivedList.find(e=>e.jid===this.getWorkspaceJid()))return;const i=E.default.getDelegateState();let o=e.participants.filter(e=>e.role===l.ChatRole.Participant).reduce((t,n)=>e.acknowledgements.find(e=>e.jid.toLowerCase()===n.jid.toLowerCase())?t:i.myAccounts.find(e=>e.jid.toLowerCase()===n.jid.toLowerCase())?[...t,n]:t,[]);const s=e.participants.find(e=>e.role===l.ChatRole.Participant&&e.jid===this.getCurrentUserJid());s&&!e.acknowledgements.find(e=>e.jid===s.jid)&&(o=[...o,this.getCurrentUser()]);const r=e.participants.find(e=>e.jid===this.getWorkspaceJid());if(!o.length)return n.autoIncludeMembersInRoles&&r&&(r.role,l.ChatRole.Owner),!1;if(e.alertDelegates=o,0===o.reduce((t,n)=>e.acknowledgements.find(e=>e.jid===n.jid)?t:[...t,n],[]).length)return!1;window.cti&&(window.cti.store.variables.default_urgent_volume=n.alertVolume);for(const t of e.alertDelegates)this.sendConversationReceived(e,t.jid.toLowerCase());return yield this.emit(u.ChatEvents.PriorityConversationNotification,new b.PriorityConversationNotificationEventArgs(e,!!n.alert,!0)),t||(yield this.showConversationAlert(e||null,!0)),!0}this._sendReceivedConversationAfterTTLExpiry(e)}return!1})}addToIgnoreList(e){if(e){if(C.isAndroid()){const t=T.getSource("PushNotification");t&&(this.logger.log(a.LoggerTypes.Other,`Adding to ignore list '${e.createdTime}'.`),t.addToIgnoreList(()=>{},()=>{},e.createdTime))}if(C.isIos()){const t=T.getSource("VoIPPushNotification");t&&(this.logger.log(a.LoggerTypes.Other,`Adding to ignore list '${e.createdTime}'.`),t.addToIgnoreList(e.createdTime,()=>{},()=>{}))}}else this.logger.log(a.LoggerTypes.Other,"Tried to add null conversation to ignore list.")}reopenConversation(e,t,n){return i(this,void 0,void 0,function*(){e.participants=t,e.isClosed=!1,yield this.updateConversation(e,{preview:n,isParticipantChange:!0}),this.emit(u.ChatEvents.ConversationAdded,new u.ConversationEventArgs(e))})}getCurrentConversation(){return i(this,void 0,void 0,function*(){return this._currentConversation})}setCurrentConversation(e,t=!1){return i(this,void 0,void 0,function*(){const n=this._currentConversation&&this._currentConversation.id||"";this._currentConversation=e,t&&(yield this.comms.clearStoredConversationMessages(e)),e.id!==n&&this.emit(u.ChatEvents.CurrentConversationChanged)})}setProvisionalConversation(e){return i(this,void 0,void 0,function*(){if(!e.isProvisional)return;const t=this._currentConversation&&this._currentConversation.id||"";this._currentConversation=e,e.id!==t&&this.emit(u.ChatEvents.CurrentConversationChanged)})}belongsToCurrentConversation(e){return i(this,void 0,void 0,function*(){const t=yield this.getCurrentConversation();return!!t&&C.jidsMatch(e.to,t.roomJid)})}clearCurrentConversation(){return i(this,void 0,void 0,function*(){this._currentConversation=null})}removeConversationById(e){return i(this,void 0,void 0,function*(){const t=this._allConversations.findIndex(t=>t.id===e);-1!==t&&this._allConversations[t].isClosed&&(this._allConversations.splice(t,1),yield this.store.saveConversations(this._allConversations),this.emit(u.ChatEvents.ConversationRemoved))})}fetchConversationEntries(e,t=null,n=0){return i(this,void 0,void 0,function*(){if(!e||e.isClosed||e.isProvisional)return[];this._isFetchingChatEntries=!0;let i=t&&t.id||null;const o=null===i;null===i?this.logger.log(a.LoggerTypes.Mam,`%c FETCHING INITIAL CHAT ENTRIES FOR CONVERSATION: %c${e.id}`,"color: #669; font-weight: bold;","color: #999; font-weight: normal;"):this.logger.log(a.LoggerTypes.Mam,`%c FETCHING EARLIER CHAT ENTRIES FOR CONVERSATION: %c${e.id} (before ${i})`,"color: #669; font-weight: bold;","color: #999; font-weight: normal;");let s=[];if(o&&((s=yield this._getChatEntriesFromMessageStore(e)).length&&(i=s[0].id),this.logger.log(a.LoggerTypes.Mam,`%c FETCHED ${s.length} ENTRIES FROM THE STORE`,"color: #669; font-weight: bold;",s)),s.length<n){o&&this.logger.log(a.LoggerTypes.Mam,"%c ...NOT ENOUGH ENTRIES FOUND IN THE STORE, SUPPLEMENTING WITH MAM MESSAGES","color: #669; font-weight: bold;"),s=[...(yield this._getChatEntriesFromMam(e,i,n-s.length))||[],...s]}return this.logger.log(a.LoggerTypes.Mam,`%c FETCHED ${s.length} CHAT ENTRIES`,"color: #669; font-weight: bold;",s),this._isFetchingChatEntries=!1,this.emit(u.ChatEvents.ChatEntriesFetched,new u.ConversationEventArgs(e)),e.hideBefore||e.lastHideBefore?s.filter(t=>t.date>(e.hideBefore||e.lastHideBefore)):s})}fetchAllConversationEntries(e){return i(this,void 0,void 0,function*(){return!e||e.isClosed||e.isProvisional?[]:yield this._getChatEntriesFromMessageStore(e)})}sendConversationMessage(e,t,n,o){return i(this,void 0,void 0,function*(){const i=yield this.sendRoomChatMessage(e.id,t,n,o,!0,this._sendAsSelectedWorkspace()),s=i._id,r=i.ts,a=this.getCurrentUserJid(),l=a,d=e.roomJid,h=i.attachments.map(e=>({remote:e.get,local:e.path})),u=c.createChatMessage(s,r,a,l,d,t,h);return r>(e&&e.preview&&e.preview.date)&&(e.preview=u),e.hasUnread=!1,e.hideBefore&&(e&&e.preview&&e.preview.date)>(e.hideBefore||e.lastHideBefore)&&(e.lastHideBefore=e.hideBefore||e.lastHideBefore,e.hideBefore=0),yield this.updateConversation(e),yield this.updateLatestIdentifier(i),u})}deleteConversationMessageById(e,t=!0){return i(this,void 0,void 0,function*(){yield this.comms.deleteMessageById(e,t)})}updateLatestIdentifier(e){return i(this,void 0,void 0,function*(){const t=parseInt(e.archive_id,10),n=e.delegateJid||this.getCurrentUserJid();yield this.store.updateLatestIdentifier(n,t)})}showContactInfoForJid(e){return i(this,void 0,void 0,function*(){return yield this.showContactInfo(yield this.getUserByJid(e),null,!1)})}showContactInfo(e,t,n,o=null){return i(this,void 0,void 0,function*(){yield this._contactInfoModal.show(e,t,n,!0,o)})}showRoleUsersModal(e,t=!0){return i(this,void 0,void 0,function*(){yield this._roleInfoModal.show(e,t)})}showResponsesModal(e,t=!0){return i(this,void 0,void 0,function*(){yield this._responseModal.show(e,t)})}showRoleDetailModal(e,t=!0){return i(this,void 0,void 0,function*(){yield this._roleDetailModal.show(e,t)})}showAddRoleUsersModal(e,t=!0,n){return i(this,void 0,void 0,function*(){yield this._addRoleUsersModal.show(e,t,n)})}addRolePermissionsToUsers(e,t){return i(this,void 0,void 0,function*(){let n=!0;this.showWaitingMessage(this.translateI18nItem(y.CommonMetadata.getI18nItem(y.CommonI18nKeys.PLEASE_WAIT)));for(const i of t){const t={role:e.jid,jid:i.jid,permission:"give",action:"grant"};try{yield this._sendIqCommand(p.ChatMessageType.ModifyRoleAcl,t,void 0,!0)}catch(e){if(this.getConnectionStatus()===l.ConnectionStatus.Disconnected)return!1;n=!1}const o={role:e.jid,jid:i.jid,permission:"take",action:"grant"};try{yield this._sendIqCommand(p.ChatMessageType.ModifyRoleAcl,o,void 0,!0)}catch(e){if(this.getConnectionStatus()===l.ConnectionStatus.Disconnected)return!1;n=!1}const s={role:e.jid,jid:i.jid,permission:"acquire",action:"grant"};try{yield this._sendIqCommand(p.ChatMessageType.ModifyRoleAcl,s,void 0,!0)}catch(e){if(this.getConnectionStatus()===l.ConnectionStatus.Disconnected)return!1;n=!1}const r={role:e.jid,jid:i.jid,permission:"relinquish",action:"grant"};try{yield this._sendIqCommand(p.ChatMessageType.ModifyRoleAcl,r,void 0,!0)}catch(e){if(this.getConnectionStatus()===l.ConnectionStatus.Disconnected)return!1;n=!1}}return this.dismissWaitingMessage(),n})}updateUserDirectory(){return i(this,void 0,void 0,function*(){return yield this.comms.updateUserDirectory()})}updateDirectoryAccount(e,t,n=!0){return i(this,void 0,void 0,function*(){return yield this.comms.updateDirectoryAccount(e,t,n)})}saveUserDirectory(){return i(this,void 0,void 0,function*(){return yield this.comms.saveUserDirectory()})}dismissContactInfo(){return i(this,void 0,void 0,function*(){yield this._contactInfoModal.dismiss()})}showConversationAlert(e,t,n=!1){return i(this,void 0,void 0,function*(){yield this._alertModal.show(e,t,n)})}dismissConversationAlert(){return i(this,void 0,void 0,function*(){yield this._alertModal.dismiss()})}setShowChatFunction(e){this._alertModal.setShowChatFunction(e)}markDirectConversationAsDeleted(e,t){return i(this,void 0,void 0,function*(){this.showWaitingMessage(this.translateI18nItem(y.CommonMetadata.getI18nItem(y.CommonI18nKeys.PLEASE_WAIT)));const n={conversation:e,timestamp:t||e.preview.date},i=yield this._sendIqCommand(p.ChatMessageType.HideDirectConversation,n);return!(!i.updated||i.updated.$attributes.id!==e.id)})}fetchDelegateAccounts(){return i(this,void 0,void 0,function*(){const e=yield this._sendIqCommand(p.ChatMessageType.DelegateAccounts,{},this.getCurrentUserJid());return this.emit(u.ChatEvents.FetchedDelegateAccounts),e&&e.result?e.result:null})}performDelegateAction(e,t){return i(this,void 0,void 0,function*(){return!!(yield this._sendIqCommand(e,t,this.getCurrentUserJid()))})}createConversation(e,t,n,o,s,r,c=[]){return i(this,void 0,void 0,function*(){const i=new h.ConversationConfigReader(this,null,r),o=[];for(let t=0;t<i.autoIncludeMembersInRoles.length;t++){const n=i.autoIncludeMembersInRoles[t];(yield this.searchUsers(n,["group"])).filter(e=>-1!==e.group.indexOf(n)).map(e=>({jid:e.jid,role:l.ChatRole.Owner})).forEach(t=>{e.find(e=>e.jid.toLowerCase()===t.jid.toLowerCase())||o.push(t)})}const s={type:i.namedSettings?_.ConversationType.Named:_.ConversationType.Direct,participants:[...e,...o],subject:t,description:n,config:r,attachments:c};if(i.priorityPush&&(s.priority=i.priorityPush),i.defaultConversationExpiryTTL>0&&(s.expiry_ttl=i.defaultConversationExpiryTTL),i.defaultConversationActivityTTL>0&&(s.activity_ttl=i.defaultConversationActivityTTL),i.disableRePush&&(s.disable_repush=i.disableRePush),s.attachments&&s.attachments.length)try{for(let e=0;e<s.attachments.length;e++){const t=yield this.comms.uploadFile(c[e].path);this.comms.client.deleteFile(c[e].path),s.attachments[e].path=t}}catch(e){return this.logger.log(a.LoggerTypes.MessageSent,e.toString(),"Unable to upload attachment:",s.attachments),this.error(this.translateI18nItem(y.CommonMetadata.getI18nItem(y.CommonI18nKeys.UPLOAD_ERROR_TITLE)),this.translateI18nItem(y.CommonMetadata.getI18nItem(y.CommonI18nKeys.UPLOAD_ERROR_DESCRIPTION))),null}const d=yield this._sendIqCommand(p.ChatMessageType.CreateConversation,s,this._sendAsSelectedWorkspace());if(!d)return null;if(!0===d.data.exists){try{const e=d.exists&&d.exists.$value?JSON.parse(d.exists.$value):null,t=d.exists&&d.exists.$attributes?{id:d.exists.$attributes.id,hideBefore:d.exists.$attributes.hide_before?parseInt(d.exists.$attributes.hide_before):null}:null;if(e)return this._currentConversation.id=t&&t.id,this._currentConversation.isClosed=!1,this._currentConversation.createdTime=e.date,this._currentConversation.lastHideBefore=t&&t.hideBefore,this._currentConversation.instigator=e.instigator,this._currentConversation.roomJid=e.roomJid,this.isConversationErrorAndExists=!0,this._currentConversation.id}catch(e){this.error(this.translateI18nItem(x.ChatCommonMetadata.getI18nItem(x.ChatCommonI18nKeys.ERROR_CREATING_CONVERSATION_TITLE)),O.ChatErrorsI18nKeys.E_UNKNOWN.toString())}return this.error(this.translateI18nItem(x.ChatCommonMetadata.getI18nItem(x.ChatCommonI18nKeys.ERROR_CREATING_CONVERSATION_TITLE)),O.ChatErrorsI18nKeys.E_DIRECT_CONVERSATION_EXISTS.toString()),null}return yield this.removeExpiredConversations(),d.data.newConversationId})}updateNamedConversation(e,t,n){return i(this,void 0,void 0,function*(){this.showWaitingMessage(this.translateI18nItem(y.CommonMetadata.getI18nItem(y.CommonI18nKeys.PLEASE_WAIT)));const i={conversation:e,newSubject:t,newDescription:n},o=yield this._sendIqCommand(p.ChatMessageType.UpdateConversation,i);return this.dismissWaitingMessage(),!!o})}addParticipantsToConversation(e,t){return i(this,void 0,void 0,function*(){this.showWaitingMessage(this.translateI18nItem(y.CommonMetadata.getI18nItem(y.CommonI18nKeys.PLEASE_WAIT)));const n={conversation:e,participants:t},i=yield this._sendIqCommand(p.ChatMessageType.AddParticipants,n);return this.dismissWaitingMessage(),!!i})}removeParticipantsFromConversation(e,t){return i(this,void 0,void 0,function*(){this.showWaitingMessage(this.translateI18nItem(y.CommonMetadata.getI18nItem(y.CommonI18nKeys.PLEASE_WAIT)));const n={conversation:e,participants:t},i=yield this._sendIqCommand(p.ChatMessageType.RemoveParticipants,n);return this.dismissWaitingMessage(),!!i})}changeParticipantRoleInConversation(e,t,n){return i(this,void 0,void 0,function*(){this.showWaitingMessage(this.translateI18nItem(y.CommonMetadata.getI18nItem(y.CommonI18nKeys.PLEASE_WAIT)));const i={conversation:e,participant:t,newRole:n},o=yield this._sendIqCommand(p.ChatMessageType.ChangeParticipantRole,i);return this.dismissWaitingMessage(),!!o})}leaveConversation(e,t=null){return i(this,void 0,void 0,function*(){this.showWaitingMessage(this.translateI18nItem(y.CommonMetadata.getI18nItem(y.CommonI18nKeys.PLEASE_WAIT)));const n={conversation:e},i=yield this._sendIqCommand(p.ChatMessageType.LeaveConversation,n,t);return this.dismissWaitingMessage(),i&&i.error?(i.error&&i.error.text&&"E_CONV_NO_OWNER"===i.error.text.$value&&this.error(O.ChatErrorsI18nKeys.E_LEAVING_CONVERSATION_ERROR.toString(),O.ChatErrorsI18nKeys.E_CONV_NO_OWNER.toString()),!1):!!i})}endConversation(e,t=null){return i(this,void 0,void 0,function*(){this.showWaitingMessage(this.translateI18nItem(y.CommonMetadata.getI18nItem(y.CommonI18nKeys.PLEASE_WAIT)));const n={conversation:e},i=yield this._sendIqCommand(p.ChatMessageType.EndConversation,n,t);return this.dismissWaitingMessage(),!!i})}getConfiguredPriorityById(e){return this.config.priorities.find(t=>t.id===e)}createExternalFile(){return i(this,void 0,void 0,function*(){return new Promise((e,t)=>{const n=window;n.resolveLocalFileSystemURL(n.cordova.file.externalRootDirectory,function(n){n.getDirectory("newDir",{create:!0,exclusive:!1},function(t){e()},function(e){t(e)})},function(e){t(e)})})})}captureOrSelectMedia(){return i(this,void 0,void 0,function*(){if(!this.config.externalFunctions||"function"!=typeof this.config.externalFunctions.captureOrSelectMedia)throw this.error("External function not implemented","External function 'captureOrSelectMedia' is not implemented"),new Error("External function 'captureOrSelectMedia' is not implemented");if(C.isAndroid())try{yield this.createExternalFile()}catch(e){this.error("Could not create external file",e||"An unspecified error occurred")}try{return yield this.config.externalFunctions.captureOrSelectMedia()}catch(e){throw this.error("Could not attach media",e||"An unspecified error occurred"),e}})}cancelMediaSeletion(e){return i(this,void 0,void 0,function*(){if(!this.config.externalFunctions||"function"!=typeof this.config.externalFunctions.cancelMediaSeletion)throw this.error("External function not implemented","External function 'cancelMediaSeletion' is not implemented"),new Error("External function 'cancelMediaSeletion' is not implemented");try{yield this.config.externalFunctions.cancelMediaSeletion(e)}catch(e){throw this.error("Could not attach media",e||"An unspecified error occurred"),e}})}hasMediaFullscreenHandler(){return this.config.externalFunctions&&"function"==typeof this.config.externalFunctions.showMediaFullscreen}showMediaFullscreen(e){return i(this,void 0,void 0,function*(){if(this.hasMediaFullscreenHandler())try{yield this.config.externalFunctions.showMediaFullscreen(e)}catch(e){throw this.error("Could not show media fullscreen",e||"An unspecified error occurred"),e}})}sendConversationReceived(e,t){return i(this,void 0,void 0,function*(){return!!(yield this._sendIqCommand(p.ChatMessageType.ReceivedConversation,e,t))})}sendConversationAcknowledgement(e,t,n=null){return i(this,void 0,void 0,function*(){const i={conversation:e,value:t};return!!(yield this._sendIqCommand(p.ChatMessageType.AcknowledgeConversation,i,n))})}addToPendingAlerts(e){return i(this,void 0,void 0,function*(){if(![this.getCurrentUserJid(),...E.default.getDelegatedAccounts()].filter(t=>!!e.participants.find(e=>e.jid===t)).every(t=>e.acknowledgements.find(e=>e.jid===t)))return this.store.addToPendingAlerts(e)})}getNewestPendingAlert(){const e=this.store.getPendingAlerts();return e.length>0?e.sort((e,t)=>t.createdTime-e.createdTime)[0]:null}clearPendingAlert(e){return i(this,void 0,void 0,function*(){return yield this.store.clearPendingAlert(e)})}getPendingAlertCount(){return this.store.getPendingAlerts().filter(e=>!c.isExpiredConversation(e)).length}purgeAllConversations(){return i(this,void 0,void 0,function*(){if(!this.config.behaviour.maxChatEntriesToStore)return;let e=0;this.logger.shouldLog(a.LoggerTypes.CleanUp)&&(e=(new Date).getTime()),this.logger.log(a.LoggerTypes.CleanUp," Purging all conversations...");const t=yield this.comms.getAllMessages();let n=[];for(const i of this._allConversations){const e=t.filter(e=>e.recipient_id===`${i.id}@${this.comms.getMucHost()}`||e.sender_id===`${i.id}@${this.comms.getMucHost()}`).sort((e,t)=>e.ts-t.ts),o=e.splice(0,e.length-this.config.behaviour.maxChatEntriesToStore);n=[...n,...o]}for(const i of n)yield this.deleteConversationMessageById(i._id,!0);if(this.logger.shouldLog(a.LoggerTypes.CleanUp)){const t=(new Date).getTime()-e;this.logger.log(a.LoggerTypes.CleanUp,` Purged ${n.length} messages in ${t}ms.`)}})}_executePurge(e){return i(this,void 0,void 0,function*(){this._conversationsBeingPurged.push(e.id);const t=yield this.comms.findChatEntriesToPurge(e);this.logger.debug(a.LoggerTypes.Other,`Purging ${t.length} messages(s) from conversation ${e.id}`);for(const e of t)yield this.deleteConversationMessageById(e._id,!0);this._conversationsBeingPurged=this._conversationsBeingPurged.filter(t=>t!==e.id),this.emit(u.ChatEvents.ConversationPurged,new u.ConversationEventArgs(e))})}purgeConversation(e){return i(this,void 0,void 0,function*(){if(e&&this.config.behaviour.maxChatEntriesToStore&&!(this._currentConversation&&e.id===this._currentConversation.id||this._pendingConversationAlerts.find(t=>t.id===e.id)))return new Promise((t,n)=>i(this,void 0,void 0,function*(){this._isFetchingChatEntries||this.isProcessing()?this.on(u.ChatEvents.MessageProcessorQueueEmpty,()=>i(this,void 0,void 0,function*(){yield this._executePurge(e),t()}),!0):(yield this._executePurge(e),t())}))})}isConversationBeingPurged(e){return this._conversationsBeingPurged.includes(e)}getConfiguredConversations(){return this.config.conversationTypes?this.config.conversationTypes.sort((e,t)=>e.sortOrder<t.sortOrder?1:e.sortOrder>t.sortOrder?-1:e.name>t.name?1:e.name<t.name?-1:0):[]}doesDirectConversationExistInConfiguration(){return this.config.conversationTypes.find(e=>!e.behaviour.namedSettings)}getWorkspaceAccount(){return i(this,void 0,void 0,function*(){const e=this.store.getWorkspaceAccount(),t=this.getCurrentUser();if(e&&e!==t.jid){const t=yield this.searchUsers(e,["jid"]);if(t&&t.length)return t[0]}return t})}getWorkspaceJid(e=!0){const t=this._sendAsSelectedWorkspace();return t&&e?t.split("/")[1]:t||this.getCurrentUserJid()}showAddGroupUsersModal(e,t,n=!0){return i(this,void 0,void 0,function*(){yield this._addGroupMembersModal.show(e,t,n)})}showGroupDetailModal(e,t=!0){return i(this,void 0,void 0,function*(){yield this._groupDetailModal.show(e,t)})}setRolePermission(e){return i(this,void 0,void 0,function*(){return!!(yield this._sendIqCommand(p.ChatMessageType.SetPermission,e))})}getRole(e){return i(this,void 0,void 0,function*(){try{const t=yield this._sendIqCommand(p.ChatMessageType.GetRole,e,null,!0),n=JSON.parse(t.json.$value);return{jid:n.role,displayName:n.description,group:n.tags,permissions:n.permissions}}catch(e){throw e.message&&e.message.toLowerCase().includes(A.ROLE_404)?this.error("Role not found","The role has been deleted and no longer exists."):this.error("Error","Unable to retrieve role information."),new Error(e)}})}queryRoles(e){return i(this,void 0,void 0,function*(){if(this.getConnectionStatus()!==l.ConnectionStatus.Connected)return void this.error("Offline","Please check your connection and try again");const t=yield this._sendIqCommand(p.ChatMessageType.QueryRoles,e),n=t&&JSON.parse(t.json.$value),i=n&&n.map(e=>({displayName:e.description,jid:e.principal,group:e.tags}));return i||[]})}createRole(e){return i(this,void 0,void 0,function*(){this.showWaitingMessage(this.translateI18nItem(y.CommonMetadata.getI18nItem(y.CommonI18nKeys.PLEASE_WAIT)));const t={role:this.comms.client.generateUniqueJid(),description:e.displayName,tags:e.group,min_active:0,max_active:1};try{yield this._sendIqCommand(p.ChatMessageType.CreateRole,t,null,!0)}catch(e){const t=e.iqResponse;let n="An unknown error occurred";throw t&&t.error&&t.error.conflict&&(n="A role with this name already exists"),this.error("Error creating role",n),new Error(n)}return this.dismissWaitingMessage(),{jid:t.role,displayName:t.description,group:t.tags,min_active:t.min_active,max_active:t.max_active}})}deleteRole(e){return i(this,void 0,void 0,function*(){this.showWaitingMessage(this.translateI18nItem(y.CommonMetadata.getI18nItem(y.CommonI18nKeys.PLEASE_WAIT)));const t={role:e.jid};yield this._sendIqCommand(p.ChatMessageType.DeleteRole,t);return this.dismissWaitingMessage(),!0})}modifyRole(e){return i(this,void 0,void 0,function*(){if(!e.jid)return void this.logger.error("Cannot modify a role without a jid.");this.showWaitingMessage(this.translateI18nItem(y.CommonMetadata.getI18nItem(y.CommonI18nKeys.PLEASE_WAIT)));const t={role:e.jid,description:e.displayName,tags:e.group,min_active:0,max_active:1};try{return yield this._sendIqCommand(p.ChatMessageType.ModifyRole,t,null,!0),this.dismissWaitingMessage(),{jid:t.role,displayName:t.description,group:t.tags,min_active:t.min_active,max_active:t.max_active}}catch(e){if(e.message&&e.message.toLowerCase().includes(A.ROLE_404))this.error("Role not found","The role has been deleted and no longer exists.");else{const t=e.iqResponse;let n="An unknown error occurred";t&&t.error&&t.error.conflict&&(n="A role with this name already exists"),this.error("Error modifying role",n)}throw new Error(e)}})}getGroup(e){return i(this,void 0,void 0,function*(){try{const t=yield this._sendIqCommand(p.ChatMessageType.GetGroup,e,null,!0),n=JSON.parse(t.json.$value);return{id:n.id,name:n.name,description:n.description,parents:n.parents,subgroups:n.subgroups}}catch(e){throw e.message&&e.message.toLowerCase().includes(S.GROUP_404)?this.error("Group not found","The group has been deleted and no longer exists."):this.error("Error","Unable to retrieve group information."),new Error(e)}})}queryGroups(e){return i(this,void 0,void 0,function*(){if(this.getConnectionStatus()!==l.ConnectionStatus.Connected)return void this.error("Offline","Please check your connection and try again");const t=yield this._sendIqCommand(p.ChatMessageType.QueryGroups,e);return t?JSON.parse(t.json.$value).map(e=>({id:e.id,name:e.name,description:e.description,members:e.members})):[]})}createGroup(e){return i(this,void 0,void 0,function*(){this.showWaitingMessage(this.translateI18nItem(y.CommonMetadata.getI18nItem(y.CommonI18nKeys.PLEASE_WAIT)));const t={name:e.name,description:e.description};let n;try{const e=yield this._sendIqCommand(p.ChatMessageType.CreateGroup,t,null,!0);e.created&&(n=e.created.$value)}catch(e){const t=e.iqResponse;let n="An unknown error occurred";throw t&&t.error&&t.error.conflict&&(n="A group with this name already exists"),this.error("Error creating group",n),new Error(n)}return this.dismissWaitingMessage(),{id:n}})}setUsersInactive(e){return i(this,void 0,void 0,function*(){const t={principal:e};try{yield this._sendIqCommand(p.ChatMessageType.SetUsersInactive,t,null,!0)}catch(e){const t=e.iqResponse;let n="An unknown error occurred";throw t&&t.error&&t.error.text&&"E_PERMISSION_DENIED"===t.error.text.$value&&(n="Permission denied."),this.error("Error removing user",n),n}return!0})}deleteGroup(e){return i(this,void 0,void 0,function*(){this.showWaitingMessage(this.translateI18nItem(y.CommonMetadata.getI18nItem(y.CommonI18nKeys.PLEASE_WAIT)));const t={id:e.id};yield this._sendIqCommand(p.ChatMessageType.DeleteGroup,t);return this.dismissWaitingMessage(),!0})}updateGroup(e){return i(this,void 0,void 0,function*(){this.showWaitingMessage(this.translateI18nItem(y.CommonMetadata.getI18nItem(y.CommonI18nKeys.PLEASE_WAIT)));const t={id:e.id,name:e.name,description:e.description};try{yield this._sendIqCommand(p.ChatMessageType.UpdateGroup,t,null,!0)}catch(e){const t=e.iqResponse;let n="An unknown error occurred";return t&&t.error&&t.error.conflict?n="A group with this name already exists":e.message&&e.message.toLowerCase().includes(S.GROUP_404)&&(n="The group has been deleted and no longer exists."),this.error("Error updating group",n),!1}return this.dismissWaitingMessage(),!0})}queryGroupMembers(e){return i(this,void 0,void 0,function*(){const t={id:e.id};let n=[];try{const e=yield this._sendIqCommand(p.ChatMessageType.QueryGroupMembers,t,null,!0);e.json&&e.json.$value&&(n=JSON.parse(e.json.$value))}catch(e){const t="An unknown error occurred";throw this.error("Error querying group members",t),new Error(t)}return n})}addGroupMembers(e,t){return i(this,void 0,void 0,function*(){this.showWaitingMessage(this.translateI18nItem(y.CommonMetadata.getI18nItem(y.CommonI18nKeys.PLEASE_WAIT)));const n=[];for(const e of t)n.push({jid:e});const i={id:e.id,members:n};try{yield this._sendIqCommand(p.ChatMessageType.AddGroupMembers,i,null,!0)}catch(e){const t="An unknown error occurred";throw this.error("Error adding group members",t),new Error(t)}return this.dismissWaitingMessage(),!0})}removeGroupMembers(e,t){return i(this,void 0,void 0,function*(){this.showWaitingMessage(this.translateI18nItem(y.CommonMetadata.getI18nItem(y.CommonI18nKeys.PLEASE_WAIT)));const n=[];for(const e of t)n.push({jid:e});const i={id:e.id,members:n};try{yield this._sendIqCommand(p.ChatMessageType.RemoveGroupMembers,i,null,!0)}catch(e){const t="An unknown error occurred";throw this.error("Error removing group members",t),new Error(t)}return this.dismissWaitingMessage(),!0})}addGroupChildren(e,t){return i(this,void 0,void 0,function*(){this.showWaitingMessage(this.translateI18nItem(y.CommonMetadata.getI18nItem(y.CommonI18nKeys.PLEASE_WAIT)));for(const n of t){const t={id:n,parent:e.id};try{yield this._sendIqCommand(p.ChatMessageType.AddGroupChild,t,null,!0)}catch(e){const t="An unknown error occurred";throw this.error("Error adding group child",t),new Error(t)}}return this.dismissWaitingMessage(),!0})}removeGroupChildren(e,t){return i(this,void 0,void 0,function*(){this.showWaitingMessage(this.translateI18nItem(y.CommonMetadata.getI18nItem(y.CommonI18nKeys.PLEASE_WAIT)));for(const n of t){const t={id:n,parent:e.id};try{yield this._sendIqCommand(p.ChatMessageType.RemoveGroupChild,t,null,!0)}catch(e){const t="An unknown error occurred";throw this.error("Error removing group child",t),new Error(t)}}return this.dismissWaitingMessage(),!0})}getExisitingConversationMaxParticipantsCount(){const e=this.config.behaviour.maxConversationParticipantsExisting,t=this.config.behaviour.maxConversationParticipants-1;let n=0;return e&&(n=e),(e&&e)>t&&(n=t),e||(n=t),n}_sendAsSelectedWorkspace(){const e=this.store.getWorkspaceAccount();if(e!==this.getCurrentUserJid()){const t=E.default.getDelegateName(e);return t?`${t}/${e}`:e}return null}_sendIqCommand(e,t,n=null,o=!1){return i(this,void 0,void 0,function*(){if(n){const e=E.default.getDelegateName(n);e&&(n=`${e}/${n}`)}return this.sendIq(this.config.xmpp.iq.host,"set",e,t,o,n||this._sendAsSelectedWorkspace())})}_getChatEntriesFromMessageStore(e){return i(this,void 0,void 0,function*(){const t=yield this.comms.getChatHistory(e.roomJid);return(yield Promise.all(t.map(e=>i(this,void 0,void 0,function*(){return yield c.convertToChatEntry(e,this)})))).filter(e=>null!==e)})}_getChatEntriesFromMam(e,t=null,n=null){return i(this,void 0,void 0,function*(){const i=this.getConnectionStatus();if(i!==l.ConnectionStatus.Connected)throw new s.NotConnectedError(i);try{let i=e.hideBefore||e.lastHideBefore||null;return i&&i++,yield this.comms.fetchConversationMessages(e,t,n,i,this._sendAsSelectedWorkspace())}catch(e){const t=this.translateI18nItem(y.CommonMetadata.getI18nItem(y.CommonI18nKeys.FETCH_ERROR));return"missing"!==e&&this.error(t,e),[]}})}_sendReceivedConversationAfterTTLExpiry(e){const t=E.default.getDelegatedAccounts(),n=this.getCurrentUser();e.participants&&e.participants.forEach(i=>{if(!!!e.receivedList.filter(e=>e.jid===i.jid)[0]){const o=i.jid.toLowerCase();t.includes(o)?this.sendConversationReceived(e,o):o===n.jid.toLowerCase()&&this.sendConversationReceived(e,n.jid)}})}static getUniqueTranslationKeys(e=!1,...t){return[...o.BaseLayer.getUniqueTranslationKeys(e,...t),...f.getChatI18nKeys(e,...t)].filter((e,t,n)=>n.indexOf(e)===t).sort()}setStatusBarColor(e){const t=window;t.cti&&t.StatusBar&&t.StatusBar.backgroundColorByHexString(e)}_printDelegateState(){return E.default.getDelegateState()}raiseToastNotification(e,t,n){return i(this,void 0,void 0,function*(){const o=document.createElement("ct-cl-toast");o.owner=this.name,o.addEventListener("click",()=>i(this,void 0,void 0,function*(){yield o.dismiss(),document.body.removeChild(o)}),{once:!0}),document.body.appendChild(o),setTimeout(()=>i(this,void 0,void 0,function*(){yield o.show(e,t,n),document.body.removeChild(o)}),250)})}removeExpiredConversations(){return i(this,void 0,void 0,function*(){if(this._allConversations)for(const e of this._allConversations){if(!(e.id&&e.activityTTL&&e.preview&&e.preview.date))continue;const t=this.comms.getSyncedTimestamp(new Date(e.preview.date+1e3*e.activityTTL).getTime());this.comms.getSyncedTimestamp()>t&&(this.logger.log(a.LoggerTypes.CleanUp,`Removing conversation with ID '${e.id}' because it has expired.`,t),e.isClosed=!0,yield this.removeConversationById(e.id))}})}}t.ChatLayer=N,window.CtChatLayer=N},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(33),s=n(14),r=n(58),a=n(19),l=n(0),c=n(140),d=n(5),h=n(6),u=n(14),p=n(64);class g{constructor(e,t){if(this.messageQueueProcessorDebounce=null,this.suppressMode=!1,this._messageHandlers=new Map,this._waitingAlertId=null,this._isProcessing=!1,this._backStack=[],!t)throw new Error("You must supply a config object");t.i18n&&t.i18n.enabled?d.setLocale(t.i18n.locale||t.i18n.language||"en-GB"):d.setLocale("en-GB"),this.name=e,this.config=t,this._eventListeners={},this.logger=new a.Logger(this.config.logging||[]),this._setUpHandlers(),document.addEventListener("backbutton",()=>{const e=this._backStack.length;e>0&&this._backStack[e-1].call()},!1),r.LayerRegistration.addInstance(this.name,this)}static getInstance(e){return r.LayerRegistration.getInstance(e)}static onReady(e,t){r.LayerRegistration.onReady(e,t)}moveTaskToBack(){this.emit(u.BaseEvents.MoveTaskToBack)}setBackHandler(e){this._backStack.push(e)}popBackHandler(){this._backStack.pop()}isProcessing(){return this._isProcessing}bootstrap(e,t){return this._buildCommonComponents(),Promise.resolve().then(()=>this._setStore(t)).then(()=>this._setLogger()).then(()=>this._setComms(e)).then(()=>this._setupPushNotifications()).then(()=>this._setupCommonEventListeners()).then(()=>r.LayerRegistration.fireReady(this.name)).catch(e=>{r.LayerRegistration.fireReady(this.name),setTimeout(()=>{this.error("Error during bootstrap",e)},100)})}on(e,t,n=!1,o=!1){void 0===this._eventListeners[e]&&(this._eventListeners[e]=[]);const s=d.generateRandomSixString(),r={id:s,oneTimeOnly:n,allowSuppress:o,callback:e=>i(this,void 0,void 0,function*(){yield t(e.detail)})};return this._eventListeners[e].push(r),()=>{const t=this._eventListeners[e].findIndex(e=>e.id===s);if(-1!==t)return this._eventListeners[e].splice(t,1)[0]}}emit(e,t,n=!1){return i(this,void 0,void 0,function*(){const i=[Promise.resolve()];this._eventListeners[e]||(this._eventListeners[e]=[]),this.logger.log(a.LoggerTypes.Events,`%c RAISING EVENT:%c ${e} (${this._eventListeners[e].length} listeners)`,"color: #066; font-weight: bold;","color: #999; font-weight: normal;",{data:t});const o=[];for(let s=0;s<this._eventListeners[e].length;s++){const r=this._eventListeners[e][s];this.suppressMode&&r.allowSuppress&&!n||i.push(r.callback({detail:t})),!0===r.oneTimeOnly&&o.push(s)}o.length&&(this._eventListeners[e]=this._eventListeners[e].filter((e,t)=>!o.includes(t))),yield Promise.all(i)})}login(e,t){return i(this,void 0,void 0,function*(){return yield this.comms.login(e,t)})}sso(){return i(this,void 0,void 0,function*(){return yield this.comms.sso()})}attemptReconnect(){this.comms.attemptReconnect()}logout(e=!1,t=!0){return i(this,void 0,void 0,function*(){return yield this.comms.logout(e,t)})}getSyncedTimestamp(){return this.comms.getSyncedTimestamp()}getConnectionStatus(){return this.comms.getConnectionStatus()}clearAllData(e=!1){return i(this,void 0,void 0,function*(){try{localStorage.removeItem(`${this.name}_config`),yield this.store.clearAllData(),yield this.comms.clearAllData(e)}catch(e){this.error("Error clearing data",e)}})}getCurrentUserJid(){return this.comms.username}getCurrentUserResource(){return this.comms.getCurrentUserResource()}getCurrentUser(){return null}getCurrentXmppDisplayName(){return this.comms.username}updateUserDirectory(){return i(this,void 0,void 0,function*(){yield this.comms.updateUserDirectory()})}getUserByJid(e){return i(this,void 0,void 0,function*(){return yield this.comms.getUserByJid(e)})}searchUsers(e="",t=[],n=!1,o=!0){return i(this,void 0,void 0,function*(){return yield this.comms.searchUsers(e,t,n,o)})}searchRoles(e="",t=[]){return i(this,void 0,void 0,function*(){return yield this.comms.searchRoles(e,t)})}searchGroups(e=""){return i(this,void 0,void 0,function*(){return yield this.comms.searchGroups(e)})}getAllUsers(e=!1,t=!1){return i(this,void 0,void 0,function*(){return yield this.comms.getAllUsers(e,t)})}getAllUsersInGroup(e,t=!0){return i(this,void 0,void 0,function*(){return yield this.comms.getAllUsersInGroup(e,t)})}getAllGroups(){return i(this,void 0,void 0,function*(){return yield this.comms.getAllGroups()})}markChatEntryRead(e){return i(this,void 0,void 0,function*(){yield this.comms.markMessageRead(e.id)})}downloadMessageAttachments(e){return i(this,void 0,void 0,function*(){if(e.attachments&&0!==e.attachments.length)return this.comms.downloadMessageAttachments(e.id)})}downloadFile(e){return i(this,void 0,void 0,function*(){try{return yield this.comms.downloadFile(e)}catch(e){this.error("Error downloading file",e)}})}downloadFileWithoutCatch(e,t=!1,n){return i(this,void 0,void 0,function*(){return yield this.comms.downloadFile(e,t,n)})}processXmlStanzaStringsFromMam(e,t=!0){return i(this,void 0,void 0,function*(){try{return yield this.comms.processXmlStanzaStringsFromMam(e,t)}catch(e){this.error("Error processing XML stanzas from MAM",e)}})}error(e,t,n=null){return i(this,void 0,void 0,function*(){if(this.dismissWaitingMessage(),t!==p.UpdateHelper.UPDATE_REQUIRED_ERROR){const n="string"==typeof t?t:t.message||"Unknown error";n.toLowerCase().includes("unknown")||this.emit(s.BaseEvents._Request_RaiseAlert,new l.DefaultAlerts(this).AlertErrorWithOkayButton(e,n,1,{}))}this.logger.error(n||t)})}getLabel(e,t){if(!this.config.labels||!this.config.labels[e])return null;const n=this.translateText(this.config.labels[e],!1);return d.tokenReplace(n,t)}translateText(e,t=!1){if(!this.config.i18n||!0!==this.config.i18n.enabled||"function"!=typeof this.config.i18n.translateFn)return e;if(void 0===e)return;if(null===e)return null;if(""===e)return"";const n=this.config.i18n.translateFn(e);return null===n?!0===t?null:this.config.i18n.debugMode?` ${e} `:e:n}translateI18nItem(e){if(!this.config.i18n||!0!==this.config.i18n.enabled)return e.key;const t=this.translateText(e.scopedKey,!0);return null!==t?t:this.translateText(e.key)}getUniqueCommsId(){return this.comms.getUniqueId()}sendMessage(e,t,n,o=[],s=!1){return i(this,void 0,void 0,function*(){const i=d.deepCloneObject(n),r=yield this._prepareMessage(e,i);if(null===r)return null;try{const n=yield this.comms.sendMessage(t,r,o);return d.parseMessagePayload(n,e)}catch(e){if(s)throw e;this.error("Error sending message",e)}})}sendRoomChatMessage(e,t,n=[],o=!0,s=!1,r=null){return i(this,void 0,void 0,function*(){try{return yield this.comms.sendRoomMessage(e,t,null,n,o,r)}catch(e){if(s)throw e;this.error("Error sending room chat message",e)}})}sendRoomMessage(e,t,n,o=!1){return i(this,void 0,void 0,function*(){const i=d.deepCloneObject(n),s=yield this._prepareMessage(t,i);if(null===s)return null;try{const n=yield this.comms.sendRoomMessage(e,null,s);return d.parseMessagePayload(n,t)}catch(e){if(o)throw e;this.error("Error sending room message",e)}})}sendMulticastMessage(e,t,n,o=[],s=!1){return i(this,void 0,void 0,function*(){const i=d.deepCloneObject(t),r=yield this._prepareMessage(e,i);if(null===r)return null;try{const t=yield this.comms.sendMulticastMessage(n,r,o);return d.parseMessagePayload(t,e)}catch(e){if(s)throw e;"object"==typeof e?(this.logger.error(e),this._workOutIfAttachmentTooLarge(e)):this.error("Error sending multicast message",e)}})}sendIq(e,t,n,s,r=!1,a=null){return i(this,void 0,void 0,function*(){const i=d.deepCloneObject(s),l=this._getHandlerForMessageType(n);if(!l)return null;const c=yield this._prepareIq(n,i);if(null===c)return null;let h=null;try{h=yield this.comms.sendIq(e,t,c,a)}catch(e){const t=e;if(r)throw t;return yield l.callHandleIqErrorResponse(i,t)}try{return yield l.callHandleIqResponse(i,h)}catch(e){const t=new o.IQError(e.message||e,h);if(r)throw t;return yield l.callHandleIqErrorResponse(i,t)}})}sendMessageToBot(e,t,n=!1){return i(this,void 0,void 0,function*(){const i=d.deepCloneObject(t);try{yield this._sendBotCommand(e,i,null)}catch(e){if(n)throw e;this.error("Error sending bot message",e)}})}sendBotCommand(e,t,n=!1){return i(this,void 0,void 0,function*(){const i=d.deepCloneObject(t);try{return yield this.comms.sendBotCommand(e.toString(),i)}catch(e){if(n)throw e;this.error("Error sending bot command",e)}})}setSupportLoggingTypes(e=["_all_"]){return i(this,void 0,void 0,function*(){return this.logger.setTypes(e),yield this.store.saveLoggerTypes(e)})}resetSupportLogging(){return i(this,void 0,void 0,function*(){return this.logger.resetTypes(),yield this.store.deleteLoggerTypes()})}showCancellableWaitingMessage(e,t){return i(this,void 0,void 0,function*(){yield this.dismissWaitingMessage();const n=new l.DefaultAlerts(this).AlertWaitingCancellable(e,{cancel:()=>i(this,void 0,void 0,function*(){t()})});this._waitingAlertId=n.id,this._alertModalManager.raiseAlert(n)})}showWaitingMessage(e){return i(this,void 0,void 0,function*(){yield this.dismissWaitingMessage();const t=new l.DefaultAlerts(this).AlertWaiting(e);this._waitingAlertId=t.id,this._alertModalManager.raiseAlert(t)})}dismissWaitingMessage(){return i(this,void 0,void 0,function*(){this._waitingAlertId&&(this._alertModalManager.dismissAlertById(this._waitingAlertId),this._waitingAlertId=null)})}getHandlerForMessage(e){const t=d.getMessageType(e);return this._getHandlerForMessageType(t)}setTheme(e){return i(this,void 0,void 0,function*(){yield this.store.saveTheme(e),this._setThemeOnHtml(e)})}_setComms(e){return new Promise((t,n)=>{const i=this.config.xmpp.initTimeout||1e4,o=setTimeout(()=>{this.logger.log(a.LoggerTypes.XmppClient,`Comms was not initialised within ${Math.floor(i/1e3)} seconds.`)},i);this.comms=e,this.comms.onLogin(e=>{this.comms.getServerVersion(),this.handleLogin(e)}),this.comms.onLogout(e=>{this.handleLogout(e)}),this.comms.onNewMessage(e=>{this.handleNewMessage(e)}),this.comms.onMessageUpdate(e=>{this.handleMessageUpdate(e)}),this.comms.onChatMarkerUpdate(e=>{this.handleChatMarkerUpdate(e)}),this.comms.onStatusUpdate((e,t,n)=>{this.handleConnectionChange(e,t,n)}),this.comms.onPresenceUpdate(e=>{this.handlePresenceUpdate(e)}),this.comms.onRoomNewParticipant(e=>{this.handleRoomParticipantUpdate(e)}),this.comms.onRoomParticipantUpdate(e=>{this.handleRoomParticipantUpdate(e)}),this.comms.onInitialized(()=>{t(),clearTimeout(o),this.config.xmpp.user.id&&this.config.xmpp.user.password&&this.config.xmpp.user.domain&&(this.showWaitingMessage(`Logging in as ${this.config.xmpp.user.id}`),this._attemptAutoLogin(this.config.xmpp.user.id,this.config.xmpp.user.password,this.config.xmpp.user.domain))}),this.comms.client.addNewVersionEventListener(()=>{this.isUpdateRequired()&&(this.emit(h.ChatEvents._Request_RaiseAlert,{type:this.getUpdateAlertInfo().type,title:this.getUpdateAlertInfo().title,body:this.getUpdateAlertInfo().msg,priority:1,buttons:[this.getUpdateAlertInfo().button]}),this.logout())})})}_setStore(e){return new Promise(t=>{this.store=e,this.store.init().then(()=>t())})}_setLogger(){return new Promise(e=>i(this,void 0,void 0,function*(){const t=yield this.store.getLoggerTypes();t&&this.logger.setTypes(t),e()}))}_setupPushNotifications(){return new Promise(e=>i(this,void 0,void 0,function*(){const t=window;this.config.enablePushNotifications&&t.cordova&&t.cordova.plugins.notification?t.cti.store.notification&&t.cti.store.notification.token?(yield this.store.savePushNotificationToken(t.cti.store.notification.token),e()):t.cordova.plugins.notification.registerForPush(t=>i(this,void 0,void 0,function*(){yield this.store.savePushNotificationToken(t),e()}),t=>{this.logger.error(t),e()},{channelName:this.name}):e()}))}_setupCommonEventListeners(){return new Promise(e=>i(this,void 0,void 0,function*(){const t=yield this.store.getTheme();this._setThemeOnHtml(t),this.on(s.BaseEvents._Request_ThemeChange,e=>i(this,void 0,void 0,function*(){yield this.store.saveTheme(e),this._setThemeOnHtml(e)})),e()}))}_setThemeOnHtml(e){document.querySelector("html").setAttribute("theme",e),this.emit(s.BaseEvents._Request_RedrawAllUIs)}_setUpHandlers(){this._messageHandlers=new Map,this.getHandlers().forEach(e=>{e.messageKey&&this._messageHandlers.set(e.messageKey,e),e.eventType&&e.eventType.length&&e.eventType.forEach(t=>{this.on(t,n=>i(this,void 0,void 0,function*(){try{yield e.callHandleEvent(t,n)}catch(e){this.error("Error handling event",`Event type: ${t.toString()}. ${e.message||e}`)}}))})})}_prepareMessage(e,t){return i(this,void 0,void 0,function*(){const n=this._messageHandlers.get(e),i=yield n.callCreateMessage(t);return null===i||void 0===i?null:{[n.messageKey]:JSON.stringify(i)}})}_prepareIq(e,t){return i(this,void 0,void 0,function*(){const n=yield this._messageHandlers.get(e).callCreateIq(t);return null===n||void 0===n?null:n})}_sendBotCommand(e,t,n){return i(this,void 0,void 0,function*(){const i=e.toString(),o=yield this._prepareBotMessage(e,t,n);if(null===o)return;const s=yield this.comms.sendBotCommand(i,o);if(s&&!1===s.success){!0===(yield this._shouldRetryBotMessage(e,t,s))&&(yield this._sendBotCommand(e,t,s))}})}_prepareBotMessage(e,t,n){return i(this,void 0,void 0,function*(){const i=this._messageHandlers.get(e),o=yield i.callCreateBotMessage(t,n);return null===o||void 0===o?null:{[i.messageKey]:JSON.stringify(o)}})}_shouldRetryBotMessage(e,t,n){return i(this,void 0,void 0,function*(){return yield this._messageHandlers.get(e).callHandleFailedBotResponse(t,n)})}_buildCommonComponents(){return i(this,void 0,void 0,function*(){let e=document.querySelector("div#___ct_base_layer_modal_container");e||((e=document.createElement("div")).id="___ct_base_layer_modal_container",e.setAttribute("style","position: absolute; top: 0; left: 0; width: 0; height: 0; z-index: 99999;"),document.body.appendChild(e)),this._alertModalManager=document.querySelector("ct-alert-modal-manager"),this._alertModalManager||(this._alertModalManager=document.createElement("ct-alert-modal-manager"),this._alertModalManager.owner=this.name,e.appendChild(this._alertModalManager)),yield this.generateCommonComponents(e)})}_attemptAutoLogin(e,t,n){return i(this,void 0,void 0,function*(){let i=`${e}@${n}`;this.config.xmpp.user&&!0===this.config.xmpp.user.forceLowercaseJid&&(i=i.toLowerCase()),this.logger.log(a.LoggerTypes.Connectivity,`%c ATTEMPTING AUTOMATIC LOGIN AS > %c${i}`,"color: #669; font-weight: bold;","color: #999; font-weight: normal;"),yield this.comms.login(i,t)})}_getHandlerForMessageType(e){return this._messageHandlers.get(e.toString())||this.error("No handler found",`No handlers was found for message type '${e.toString()}'`),this._messageHandlers.get(e)}_workOutIfAttachmentTooLarge(e){const t="There was an error sending the message, please try again.";if(e.nodeName&&"iq"===e.nodeName&&e.childNodes&&e.childNodes[1]&&"error"===e.childNodes[1].nodeName){const t=e.childNodes[1];if(t.childNodes&&t.childNodes[1]&&"text"===t.childNodes[1].nodeName){const e=t.childNodes[1].textContent.match(/\d+/)[0],n=e?parseInt(e):0;if(n){const e=`The attachment is too large. Please select a file lower than ${Math.round(n/1024/1024)}MB in size.`;throw this.error("Attachment Too Large",e),new Error(e)}{const e="The attachment is too large. Please choose a smaller attachment.";throw this.error("Attachment Too Large",e),new Error(e)}}}throw this.error("Error sending multicast message",t),new Error(t)}handleLogin(e){this.emit(s.BaseEvents.LoginResult,e)}handleLogout(e){this.emit(s.BaseEvents.LogoutResult,e)}_finishedProcessing(){clearTimeout(this.messageQueueProcessorDebounce),this.messageQueueProcessorDebounce=setTimeout(()=>{this._isProcessing=!1,this.emit(h.ChatEvents.MessageProcessorQueueEmpty)},1e3)}handleNewMessage(e){return i(this,void 0,void 0,function*(){this.emit(s.BaseEvents.UserActivity,new s.UserActivityEventArgs(e.jid,e.ts));const t=d.getMessageType(e),n=d.parseMessagePayload(e,t),i=this._getHandlerForMessageType(t);if(i)try{this._isProcessing=!0,this.logger.log(a.LoggerTypes.ProcessingReceived,"%c PROCESSING NEW MESSAGE:%c","color: #060; font-weight: bold;","color: #999; font-weight: normal;",d.getMessageContentForDebug(n)),yield i.callHandleMessage(n),this._finishedProcessing()}catch(e){this.error("Error processing message",e)}})}handleMessageUpdate(e){return i(this,void 0,void 0,function*(){this.emit(s.BaseEvents.UserActivity,new s.UserActivityEventArgs(e.jid,e.ts));const t=d.getMessageType(e),n=d.parseMessagePayload(e,t),i=this._getHandlerForMessageType(t);if(i)try{this._isProcessing=!0,this.logger.log(a.LoggerTypes.ProcessingUpdated,"%c PROCESSING MESSAGE UPDATE:%c","color: #060; font-weight: bold;","color: #999; font-weight: normal;",d.getMessageContentForDebug(n)),yield i.callHandleMessageUpdate(n),this._finishedProcessing()}catch(e){this.error("Error processing message",e)}})}handleChatMarkerUpdate(e){return i(this,void 0,void 0,function*(){const t=Object.assign({},e);let n=`${t.sender_resource}@${this.config.xmpp.user.domain}`;this.config.xmpp.user&&!0===this.config.xmpp.user.forceLowercaseJid&&(n=n.toLowerCase()),t.sender_resource=n,this.emit(s.BaseEvents.UserActivity,new s.UserActivityEventArgs(t.sender_resource,t.message.updated_at||t.message.ts));const i=d.getMessageType(t.message),o=d.parseMessagePayload(t.message,i),r=Object.assign({},t,{message:o}),l=this._getHandlerForMessageType(i);if(l)try{this._isProcessing=!0;const e=t.sender_resource.split("@").shift();this.logger.log(a.LoggerTypes.ProcessingChatMarker,`%c PROCESSING CHAT MARKER: %c${e} > ${t.type}`,"color: #669; font-weight: bold;","color: #999; font-weight: normal;"),yield l.callHandleMessageReceipt(r),this._finishedProcessing()}catch(e){this.error("Error processing message",e)}})}handleRoomParticipantUpdate(e){if(!e.jid)return;this.emit(s.BaseEvents.UserActivity,new s.UserActivityEventArgs(e.jid,e.updated_at||e.ts));const t=e.metadata&&e.metadata.role?e.metadata.role:"";this.emit(s.BaseEvents.RoomParticipantUpdate,new s.RoomParticipantUpdateEventArgs(e.jid,e.room_name,t,l.RoomRole[e.room_role]))}handleConnectionChange(e,t,n){this.comms.setConnectionStatus(e),g.onReady(this.name,()=>{this.emit(s.BaseEvents.ConnectionStatusChange,new s.ConnectionStatusEventArgs(e,t,n)),this.comms.client.hasBeenLoggedIn().then(t=>{t&&e===l.ConnectionStatus.Disconnected&&"Invalid username or password"===n.getReason()&&this.emit(s.BaseEvents.AuthenticationCredentialsReset)})})}handlePresenceUpdate(e){e.online&&this.emit(s.BaseEvents.UserActivity,new s.UserActivityEventArgs(e.id,this.getSyncedTimestamp()));const t=e.online?l.ConnectionStatus.Connected:l.ConnectionStatus.Disconnected;this.emit(s.BaseEvents.OtherUserConnectionStatusChange,new s.UserConnectionStatusEventArgs(e.id,t))}updateAvailable(){return this.comms.client.getUpdateHelper().isUpdateAvailable()}openUpdateSite(){this.comms.client.openUpdateSite()}newVersion(){return this.comms.client.getUpdateHelper().getNewVersion()}isUpdateRequired(){return this.comms.client.getUpdateHelper().isUpdateRequired()}getUpdateAlertInfo(){return this.comms.client.getUpdateHelper().getUpdateAlertInfo()}addNewVersionEventListener(e){this.comms.client.addNewVersionEventListener(e)}static getUniqueTranslationKeys(e=!1,...t){return c.getCommonI18nKeys(e,...t)}}t.BaseLayer=g},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});t.IQError=class extends Error{constructor(e,t){super(e),this.iqResponse=t}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});t.NotConnectedError=class extends Error{constructor(e,t){super(t),this.connectionStatus=e}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(31);t.CommsEventArgs=class extends i.BaseEventArgs{constructor(e,t,n){super(),this.success=e,t&&(this.errorMessage=t),n&&(this.button=n)}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(31);t.UserActivityEventArgs=class extends i.BaseEventArgs{constructor(e,t){super(),this.jid=e,this.date=t}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(31);t.UserConnectionStatusEventArgs=class extends i.BaseEventArgs{constructor(e,t){super(),this.jid=e,this.connectionStatus=t}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(31);t.RoomParticipantUpdateEventArgs=class extends i.BaseEventArgs{constructor(e,t,n,i){super(),this.jid=e,this.roomName=t,this.role=n,this.roomRole=i}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(31);t.ConnectionStatusEventArgs=class extends i.BaseEventArgs{constructor(e,t,n){super(),this.status=e,this.reconnectTime=t,this.disconnectStatus=n}}},function(e,t){e.exports=moment},function(e,t,n){"use strict";n.r(t),function(e){var n,i,o=[];function s(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function r(e,t){Object.defineProperty(this,"kind",{value:e,enumerable:!0}),t&&t.length&&Object.defineProperty(this,"path",{value:t,enumerable:!0})}function a(e,t,n){a.super_.call(this,"E",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0}),Object.defineProperty(this,"rhs",{value:n,enumerable:!0})}function l(e,t){l.super_.call(this,"N",e),Object.defineProperty(this,"rhs",{value:t,enumerable:!0})}function c(e,t){c.super_.call(this,"D",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0})}function d(e,t,n){d.super_.call(this,"A",e),Object.defineProperty(this,"index",{value:t,enumerable:!0}),Object.defineProperty(this,"item",{value:n,enumerable:!0})}function h(e,t,n){var i=e.slice((n||t)+1||e.length);return e.length=t<0?e.length+t:t,e.push.apply(e,i),e}function u(e){var t=typeof e;return"object"!==t?t:e===Math?"math":null===e?"null":Array.isArray(e)?"array":"[object Date]"===Object.prototype.toString.call(e)?"date":"function"==typeof e.toString&&/^\/.*\//.test(e.toString())?"regexp":"object"}function p(e,t,n,i,o,s,r){o=o||[],r=r||[];var g=o.slice(0);if(void 0!==s){if(i){if("function"==typeof i&&i(g,s))return;if("object"==typeof i){if(i.prefilter&&i.prefilter(g,s))return;if(i.normalize){var m=i.normalize(g,s,e,t);m&&(e=m[0],t=m[1])}}}g.push(s)}"regexp"===u(e)&&"regexp"===u(t)&&(e=e.toString(),t=t.toString());var f=typeof e,_=typeof t,v="undefined"!==f||r&&r[r.length-1].lhs&&r[r.length-1].lhs.hasOwnProperty(s),y="undefined"!==_||r&&r[r.length-1].rhs&&r[r.length-1].rhs.hasOwnProperty(s);if(!v&&y)n(new l(g,t));else if(!y&&v)n(new c(g,e));else if(u(e)!==u(t))n(new a(g,e,t));else if("date"===u(e)&&e-t!=0)n(new a(g,e,t));else if("object"===f&&null!==e&&null!==t)if(r.filter(function(t){return t.lhs===e}).length)e!==t&&n(new a(g,e,t));else{if(r.push({lhs:e,rhs:t}),Array.isArray(e)){var C;e.length;for(C=0;C<e.length;C++)C>=t.length?n(new d(g,C,new c(void 0,e[C]))):p(e[C],t[C],n,i,g,C,r);for(;C<t.length;)n(new d(g,C,new l(void 0,t[C++])))}else{var w=Object.keys(e),b=Object.keys(t);w.forEach(function(o,s){var a=b.indexOf(o);a>=0?(p(e[o],t[o],n,i,g,o,r),b=h(b,a)):p(e[o],void 0,n,i,g,o,r)}),b.forEach(function(e){p(void 0,t[e],n,i,g,e,r)})}r.length=r.length-1}else e!==t&&("number"===f&&isNaN(e)&&isNaN(t)||n(new a(g,e,t)))}function g(e,t,n,i){return i=i||[],p(e,t,function(e){e&&i.push(e)},n),i.length?i:void 0}function m(e,t,n){if(e&&t&&n&&n.kind){for(var i=e,o=-1,s=n.path?n.path.length-1:0;++o<s;)void 0===i[n.path[o]]&&(i[n.path[o]]="number"==typeof n.path[o]?[]:{}),i=i[n.path[o]];switch(n.kind){case"A":!function e(t,n,i){if(i.path&&i.path.length){var o,s=t[n],r=i.path.length-1;for(o=0;o<r;o++)s=s[i.path[o]];switch(i.kind){case"A":e(s[i.path[o]],i.index,i.item);break;case"D":delete s[i.path[o]];break;case"E":case"N":s[i.path[o]]=i.rhs}}else switch(i.kind){case"A":e(t[n],i.index,i.item);break;case"D":t=h(t,n);break;case"E":case"N":t[n]=i.rhs}return t}(n.path?i[n.path[o]]:i,n.index,n.item);break;case"D":delete i[n.path[o]];break;case"E":case"N":i[n.path[o]]=n.rhs}}}n="object"==typeof e&&e?e:"undefined"!=typeof window?window:{},(i=n.DeepDiff)&&o.push(function(){void 0!==i&&n.DeepDiff===g&&(n.DeepDiff=i,i=void 0)}),s(a,r),s(l,r),s(c,r),s(d,r),Object.defineProperties(g,{diff:{value:g,enumerable:!0},observableDiff:{value:p,enumerable:!0},applyDiff:{value:function(e,t,n){e&&t&&p(e,t,function(i){n&&!n(e,t,i)||m(e,t,i)})},enumerable:!0},applyChange:{value:m,enumerable:!0},revertChange:{value:function(e,t,n){if(e&&t&&n&&n.kind){var i,o,s=e;for(o=n.path.length-1,i=0;i<o;i++)void 0===s[n.path[i]]&&(s[n.path[i]]={}),s=s[n.path[i]];switch(n.kind){case"A":!function e(t,n,i){if(i.path&&i.path.length){var o,s=t[n],r=i.path.length-1;for(o=0;o<r;o++)s=s[i.path[o]];switch(i.kind){case"A":e(s[i.path[o]],i.index,i.item);break;case"D":case"E":s[i.path[o]]=i.lhs;break;case"N":delete s[i.path[o]]}}else switch(i.kind){case"A":e(t[n],i.index,i.item);break;case"D":case"E":t[n]=i.lhs;break;case"N":t=h(t,n)}return t}(s[n.path[i]],n.index,n.item);break;case"D":case"E":s[n.path[i]]=n.lhs;break;case"N":delete s[n.path[i]]}}},enumerable:!0},isConflict:{value:function(){return void 0!==i},enumerable:!0},noConflict:{value:function(){return o&&(o.forEach(function(e){e()}),o=null),g},enumerable:!0}}),t.default=g}.call(this,n(40))},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(0);t.BaseHandler=class{constructor(e){this.messageKey=null,this.eventType=[],this.layer=e,this.defaultAlerts=new o.DefaultAlerts(e)}createMessage(e){throw new Error("Not implemented")}createIq(e){throw new Error("Not implemented")}createBotMessage(e,t){throw new Error("Not implemented")}handleFailedBotResponse(e,t){return i(this,void 0,void 0,function*(){return!1})}handleMessage(e){return i(this,void 0,void 0,function*(){})}handleMessageUpdate(e){return i(this,void 0,void 0,function*(){})}handleMessageReceipt(e){return i(this,void 0,void 0,function*(){})}handleEvent(e,t){return i(this,void 0,void 0,function*(){})}handleIqResponse(e,t){return i(this,void 0,void 0,function*(){return t})}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){return t.iqResponse})}callCreateMessage(e){return i(this,void 0,void 0,function*(){const t=this.createMessage(e);return this._embelishI18n(t),t})}callCreateIq(e){return i(this,void 0,void 0,function*(){const t=this.createIq(e);return this._embelishI18n(t),t})}callCreateBotMessage(e,t){return i(this,void 0,void 0,function*(){const t=yield this.createBotMessage(e);return this._embelishI18n(t),t})}callHandleFailedBotResponse(e,t){return i(this,void 0,void 0,function*(){return!(!t||!0===t.success)&&(yield this.handleFailedBotResponse(e,t))})}callHandleMessage(e){return i(this,void 0,void 0,function*(){yield this.handleMessage(e)})}callHandleMessageUpdate(e){return i(this,void 0,void 0,function*(){yield this.handleMessageUpdate(e)})}callHandleMessageReceipt(e){return i(this,void 0,void 0,function*(){yield this.handleMessageReceipt(e)})}callHandleEvent(e,t){return i(this,void 0,void 0,function*(){yield this.handleEvent(e,t)})}callHandleIqResponse(e,t){return i(this,void 0,void 0,function*(){return yield this.handleIqResponse(e,t)})}callHandleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){return yield this.handleIqErrorResponse(e,t)})}_embelishI18n(e){this.layer.config.i18n&&!0===this.layer.config.i18n.enabled&&(e.language=this.layer.config.i18n.language,e.locale=this.layer.config.i18n.locale)}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Broadcaster="broadcaster"]="Broadcaster",e[e.Responder="responder"]="Responder"}(t.AppMode||(t.AppMode={}))},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(17);t.Metadata=class{constructor(e,t){e&&(this._scope="string"==typeof e?e:"name"in e?e.name:e.toString()),this._i18nItems=new Map,t&&this.fillFromEnum(t)}fillFromEnum(e){let t=0;for(const n in e)e.hasOwnProperty(n)&&t%2!=0&&this.addI18nItem(n),t+=1}addI18nItem(e){e&&this._i18nItems.set(e.toString(),new i.I18nItem(this._scope,e.toString()))}getI18nItem(e){if(!e)return;const t=e.toString();if(!this._i18nItems.has(t))throw new Error(`No i18n item registered for key: "${t}"`);return this._i18nItems.get(t)}getUniqueI18Keys(e){return[...this._i18nItems.values()].map(t=>e?t.scopedKey:t.key).filter((e,t,n)=>n.indexOf(e)===t)}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});t.I18nItem=class{constructor(e,t){this.scope=e,this.key=t}get scopedKey(){return`${this.scope}_${this.key}`}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Meta="meta"]="Meta",e[e.Chat="chat"]="Chat",e[e.Divider="divider"]="Divider"}(t.ChatEntryType||(t.ChatEntryType={}))},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Participant="member"]="Participant",e[e.Administrator="admin"]="Administrator",e[e.Owner="owner"]="Owner"}(t.ChatRole||(t.ChatRole={}))},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Connecting="connecting"]="Connecting",e[e.Connected="connected"]="Connected",e[e.Disconnected="disconnected"]="Disconnected",e[e.Disconnecting="disconnecting"]="Disconnecting"}(t.ConnectionStatus||(t.ConnectionStatus={}))},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});t.DisconnectionStatus=class{constructor(e,t){this.wontReconnect=e,this.reason=t}getReason(){return this.reason}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.None="none"]="None",e[e.Participant="participant"]="Participant",e[e.Moderator="moderator"]="Moderator"}(t.RoomRole||(t.RoomRole={}))},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Contact="contact"]="Contact",e[e.VCard="vcard"]="VCard",e[e.Participant="participant"]="Participant",e[e.DirectoryUser="directoryuser"]="DirectoryUser"}(t.UserAdditionalDetailsType||(t.UserAdditionalDetailsType={}))},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(59),o=n(20);t.getCommonI18nKeys=function(e=!1,...t){return 0===t.length&&(t=[...s.keys()]),t.reduce((t,n)=>t.concat(function(e,t){return(null===t||s.has(t))&&s.get(t).getUniqueI18Keys(e)||[]}(e,n)),[]).filter((e,t,n)=>n.indexOf(e)===t).sort()};const s=new Map;s.set("DefaultAlerts",i.DefaultAlertsMetadata.instance),s.set("Common",o.CommonMetadata)},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(14);t.AttachmentDownloadComplete=class extends i.BaseEventArgs{constructor(e,t,n){super(),this.filepath=e,this.type=n,this.conversationId=t}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(14);t.AudioAttachmentDownloadComplete=class extends i.BaseEventArgs{constructor(e,t){super(),this.filepath=e,this.conversation=t}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(61);t.ChatNotificationEventArgs=class extends i.ChatEntryEventArgs{constructor(e,t,n,i){super(e),this.conversationTitle=t,this.messagePreview=n,this.isForCurrentConversation=i}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(6);t.ConversationParticiantRoleEventArgs=class extends i.ConversationEventArgs{constructor(e,t,n){super(e),this.participant=t,this.newRole=n}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(6);t.ConversationParticiantsEventArgs=class extends i.ConversationEventArgs{constructor(e,t){super(e),this.participants=t}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(14);t.DelegateManagementEventArgs=class extends i.BaseEventArgs{constructor(e,t,n){super(),this.delegate=e,this.action=t,this.onAction=n}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(63);t.ForceQuitConversationEventArgs=class extends i.ConversationEventArgs{constructor(e,t,n){super(e),this.instigator=t,this.reason=n}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});var i=n(149);t.RenderMixin=i.RenderMixin;var o=n(150);t.ComponentStylesMixin=o.ComponentStylesMixin;var s=n(151);t.OverridingStylesMixin=s.OverridingStylesMixin},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0}),t.RenderMixin=function(e){function t(e){return e instanceof Array?e:[e]}return class extends e{renderCallback(){const e=t(this.styleElements||[]),n=t(this.componentMarkup&&this.componentMarkup()||[]);return[...e,...n]}}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(32);t.ComponentStylesMixin=function(e){class t extends e{constructor(...e){super(...e);const n=window.ShadyCSS,o=!n;if(this.styleElements||(this.styleElements=[]),this.componentStyles)if(o)this.styleElements=[i.h("style",this.componentStyles),...this.styleElements];else{if(!this.overridingStylesMixinApplied)return;const e=this.localName;if(!0!==t._seenTags[e]){t._seenTags[e]=!0;const i=document.createElement("template");i.innerHTML=`<style>${this.componentStyles}</style>`,n.prepareTemplate(i,e)}}}get componentStylesMixinApplied(){return!0}}return t._seenTags={},t}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(32);t.OverridingStylesMixin=function(e){class t extends e{constructor(...e){super(...e);const n=this.localName,o=window.ShadyCSS,s=!o,r=window.__CtOverridingStyles||{},a=[...r["*"]||[],...r[n.toLowerCase()]||[]];if(s)a&&(this.styleElements||(this.styleElements=[]),a.forEach(e=>{const t=/^(.*?)\.css$/.test(e)?`@import url('${e}');`:e;this.styleElements=[...this.styleElements,i.h("style",t)]}));else if(!0!==t._seenTags[n]){t._seenTags[n]=!0;const e=[];a&&a.forEach(t=>{const n=/^(.*?)\.css$/.test(t)?function(e){return new Promise(t=>{const n=new XMLHttpRequest;n.onreadystatechange=(()=>{n.readyState===XMLHttpRequest.DONE&&(200===n.status?t(n.responseText):t(`:host { content: 'Error: could not load stylesheet: ${e}' }`))}),n.open("GET",e),n.send()})}(t):Promise.resolve(t);e.push(n)}),Promise.all(e).then(e=>{const t=document.createElement("template");if(this.componentStyles&&!0===this.componentStylesMixinApplied&&(t.innerHTML+=this.componentStyles),e.length>0){const n=e.join("\n");t.innerHTML+=`<style>${n}</style>`}t.innerHTML.length&&o.prepareTemplate(t,n)})}}get overridingStylesMixinApplied(){return!0}}return t._seenTags={},t}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(38),r=n(42),a=n(14),l=n(58),c=n(19),d=n(0),h=n(32);class u extends s.CTBaseComponent{constructor(){super(...arguments),this._connected=!1,this._metadata=null,this._defaultAlerts=null,this._debouncers={},this._listenerUnsubscribers=[]}get layer(){return this._baseLayer?this._baseLayer:null}get metadata(){if(null===this._metadata){if(Object.getPrototypeOf(this)._metadata)return Object.getPrototypeOf(this)._metadata;throw new Error(`Metadata not set for component <${this.localName}>`)}return this._metadata}get defaultAlerts(){return this._defaultAlerts||(this._defaultAlerts=new d.DefaultAlerts(this._baseLayer))}get generateComponentStyles(){return null}getStyles(){if(this.styles&&this.styles.length)return this.styles.reduce((e,t)=>e+=t,"");return this.generateComponentStyles||""}get componentStyles(){return this.getStyles()}componentMarkup(){if(!this.layer){const e=this._findParentCTLayerComponent();if(e&&(this._baseLayer=e._baseLayer,this._initializeForBaseLayer()),!this._connected)return null;if(!this.layer)return e?console.error(`Component <${this.localName}> child of <${e.localName}> does not have an owner layer specified`):console.error(`Component <${this.localName}> does not have an owner layer specified`),h.h("em",{style:{display:"inline-block",fontSize:"12px",color:"#900",backgroundColor:"#FF0",padding:"3px 6px"}},`${this.localName}:`,h.h("br"),"OWNER NOT SPECIFIED")}return this.generateComponentMarkup()}connectedCallback(){super.connectedCallback()}disconnectedCallback(){super.disconnectedCallback(),this.unsubscribeListeners()}unsubscribeListeners(){this._listenerUnsubscribers.forEach(e=>e())}attributeChangedCallback(e,t,n){switch(super.attributeChangedCallback(e,t,n),e){case"owner":n!==t&&""!==n&&(this.owner=n,this._attemptConnectToBaseLayer())}}setMetadata(e){this._metadata=e}defer(e){setTimeout(e,0)}debounce(e,t,n=100){clearTimeout(this._debouncers[e]),this._debouncers[e]=setTimeout(()=>{t(),delete this._debouncers[e]},n)}cancelDebounce(e){clearTimeout(this._debouncers[e])}emitEvent(e,t){return o(this,void 0,void 0,function*(){this._baseLayer?yield this._baseLayer.emit(e,t):console.error(`Could not emit event from component <${this.localName}> - it does not have an owner layer specified`)})}emitComponentEvent(e,t){this._baseLayer?(this._baseLayer.logger.log(c.LoggerTypes.Events,`%c RAISING COMPONENT EVENT:%c ${e}`,"color: #066; font-weight: bold;","color: #999; font-weight: normal;",{component:this,data:t}),this.dispatchEvent(new CustomEvent(e,{detail:t}))):console.error(`Could not emit event from component <${this.localName}> - it does not have an owner layer specified`)}addListener(e,t,n){if(this._baseLayer){let i=!1,o=!0;n&&!0===n.onceOnly&&(i=!0),n&&!0===n.dontSuppress&&(o=!1);const s=this._baseLayer.on(e,t,i,o);this._listenerUnsubscribers.push(s)}else console.error(`Could not set event handler on component <${this.localName}> - it does not have an owner layer specified`)}addListeners(e,t,n){e.forEach(e=>{this.addListener(e,t,n)})}launchModal(e){this._baseLayer.emit(a.BaseEvents._Request_RaiseAlert,e)}launchAckownledgeDialog(e,t,n){this._baseLayer.emit(a.BaseEvents._Request_RaiseAlert,this.defaultAlerts.AlertAcknowledge(e,t,1,{okay:()=>{n()}}))}launchConfirmationDialog(e,t,n,i){this._baseLayer.emit(a.BaseEvents._Request_RaiseAlert,this.defaultAlerts.AlertYesNoQuestion(e,t,1,{yes:()=>{n()},no:()=>{"function"==typeof i&&i()}}))}showWaitingMessage(e){return o(this,void 0,void 0,function*(){yield this._baseLayer.showWaitingMessage(e)})}dismissWaitingMessage(){return o(this,void 0,void 0,function*(){yield this._baseLayer.dismissWaitingMessage()})}getLabel(e,t){return this.layer.getLabel(e,t)}translateText(e,t){return this._baseLayer.translateText(e,!1)}translateI18nItem(e){let t;if(e&&["scope","key"].every(t=>e.hasOwnProperty(t))?t=e.key:(t=e.toString(),e=this.metadata&&this.metadata.getI18nItem(t)||null),null===e)return t;if(null===this.metadata)return t;if(!this._baseLayer.config.i18n||!0!==this._baseLayer.config.i18n.enabled)return t;const n=this._baseLayer.translateText(e.scopedKey,!0);return null!==n?n:this._baseLayer.translateText(e.key)}_attemptConnectToBaseLayer(){this.owner&&l.LayerRegistration.onReady(this.owner,()=>{this._connectToLayer()})}_connectToLayer(){return o(this,void 0,void 0,function*(){this._connected||this.owner&&(this._baseLayer=l.LayerRegistration.getInstance(this.owner)||null,this._baseLayer&&(yield this._initializeForBaseLayer()))})}_initializeForBaseLayer(){return o(this,void 0,void 0,function*(){if(!this.layer)return;yield this.initialize.apply(this),this.setupListeners(),this._connected=!0,this.forceRedraw();["ct-cl-chat-message-list"].includes(this.nodeName.toLowerCase())||this.addListener(a.BaseEvents._Request_RedrawAllUIs,()=>o(this,void 0,void 0,function*(){this.layer&&(yield this.initialize.apply(this),this.forceRedraw())}))})}_findParentCTLayerComponent(){let e=this,t=!1;do{(e=e.parentNode||e.host)||(t=!0),e&&e.owner&&(t=!0)}while(!t);return e||null}}u.is=null,i([r.prop({type:String,attribute:!0})],u.prototype,"owner",void 0),t.CTLayerComponent=u},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(32);t.Stroolean=i.prop.create({coerce:e=>"string"==typeof e&&"true"===e.toLowerCase(),default:!1,deserialize:e=>"string"==typeof e&&"true"===e.toLowerCase(),serialize:e=>e?"true":"false"}),t.NullableNumber=i.prop.create({coerce:e=>"null"===e?null:parseInt(e),default:null,deserialize:e=>"null"===e?null:parseInt(e),serialize:e=>null===e||void 0===e?"null":e.toString()})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.AUDIO="audio"]="AUDIO",e[e.IMAGE="image"]="IMAGE",e[e.VIDEO="video"]="VIDEO"}(t.SupportedAttachmentType||(t.SupportedAttachmentType={}))},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.START="start"]="START",e[e.UPDATE="update"]="UPDATE",e[e.ADD="add"]="ADD",e[e.REMOVE="remove"]="REMOVE",e[e.CHANGEROLE="changerole"]="CHANGEROLE",e[e.LEFT="left"]="LEFT",e[e.END="end"]="END",e[e.ACK="acknowledge"]="ACK",e[e.RECEIVED="received"]="RECEIVED"}(t.ChatMetaActivityType||(t.ChatMetaActivityType={}))},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultAlertResponseOption={id:"_default",name:"Acknowledge",options:[{name:"Acknowledge",type:"button",label:"Acknowledge",value:"Acknowledge"}]},t.directConversationConfig={id:"1",sortOrder:1,name:"Direct",shortDescription:"A personal conversation with you and one or more participants.",colorCode:"",displayGroup:"normal",behaviour:{chatAvailable:!0,canSendAttachmentsWithinConversation:!0}},t.namedConversationConfig={id:"2",sortOrder:2,name:"Named",shortDescription:"A converstion with a subject and context.",colorCode:"",displayGroup:"normal",behaviour:{chatAvailable:!0,namedSettings:{subjectRequired:!0,descriptionRequired:!0},participantCanLeave:!0,ownerCanEditAfterSend:!0,ownerCanCloseEarly:!0,ownerCanAddAdditionalContacts:!0,canSendAttachmentsWithinConversation:!0}},t.page={id:"3",sortOrder:3,name:"Page",shortDescription:"A single page that requires a prompted response from the participants.",colorCode:"",displayGroup:"normal",behaviour:{warnWhenNoContacts:!0,chatAvailable:!1,namedSettings:{subjectRequired:!0,subjectFieldLabel:"Title",descriptionRequired:!0,descriptionFieldLabel:"Description"},participantCanLeave:!1,ownerCanEditAfterSend:!1,ownerCanCloseEarly:!1,canSendAttachmentsWithinConversation:!1,autoRemoveOnClose:!0,alert:{alertResponseOptions:[t.defaultAlertResponseOption],shouldOpenConversationAfterResponded:!1,participantAlertResponsesVisible:!1},attachments:{image:!0,audio:!0}}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Direct="direct"]="Direct",e[e.Named="named"]="Named"}(t.ConversationType||(t.ConversationType={}))},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ACQUIRE="acquire",e.GIVE="give",e.RELINQUISH="relinquish",e.TAKE="take",e.ASSIGN="assign",e.REMOVE="release",e.TRANSFER="transfer"}(i=t.DelegatePermissions||(t.DelegatePermissions={})),t.fakeDelegateFetch={"AC304133@belfastpoc.com":{1:{active:["AC965603@belfastpoc.com"],proxies:["AC637579@belfastpoc.com","AC372475@belfastpoc.com","AC965603@belfastpoc.com"],perms:[i.ACQUIRE,i.GIVE,i.TAKE,i.RELINQUISH]}},"AC440801@belfastpoc.com":{2:{active:[],proxies:["AC637579@belfastpoc.com","AC372475@belfastpoc.com","AC965603@belfastpoc.com"],perms:[i.ACQUIRE,i.GIVE,i.TAKE,i.RELINQUISH]}},"AC450921@belfastpoc.com":{3:{active:[],proxies:["AC637579@belfastpoc.com","AC372475@belfastpoc.com","AC965603@belfastpoc.com"],perms:[i.ACQUIRE,i.GIVE,i.TAKE,i.RELINQUISH]}},"AC503280@belfastpoc.com":{4:{active:[],proxies:["AC637579@belfastpoc.com","AC372475@belfastpoc.com","AC965603@belfastpoc.com"],perms:[i.ACQUIRE,i.GIVE,i.TAKE,i.RELINQUISH]}},"AC645393@belfastpoc.com":{5:{active:[],proxies:["AC637579@belfastpoc.com","AC372475@belfastpoc.com","AC965603@belfastpoc.com"],perms:[i.ACQUIRE,i.GIVE,i.TAKE,i.RELINQUISH]}},"AC654215@belfastpoc.com":{6:{active:[],proxies:["AC637579@belfastpoc.com","AC372475@belfastpoc.com","AC965603@belfastpoc.com"],perms:[i.ACQUIRE,i.GIVE,i.TAKE,i.RELINQUISH]}},"AC660723@belfastpoc.com":{7:{active:[],proxies:["AC637579@belfastpoc.com","AC372475@belfastpoc.com","AC965603@belfastpoc.com"],perms:[i.ACQUIRE,i.GIVE,i.TAKE,i.RELINQUISH]}},"AC661592@belfastpoc.com":{8:{active:[],proxies:["AC637579@belfastpoc.com","AC372475@belfastpoc.com","AC965603@belfastpoc.com"],perms:[i.ACQUIRE,i.GIVE,i.TAKE,i.RELINQUISH]}},"AC686789@belfastpoc.com":{9:{active:[],proxies:["AC637579@belfastpoc.com","AC372475@belfastpoc.com","AC965603@belfastpoc.com"],perms:[i.ACQUIRE,i.GIVE,i.TAKE,i.RELINQUISH]}},"AC830117@belfastpoc.com":{10:{active:[],proxies:["AC637579@belfastpoc.com","AC372475@belfastpoc.com","AC965603@belfastpoc.com"],perms:[i.ACQUIRE,i.GIVE,i.TAKE,i.RELINQUISH]}},"AC864846@belfastpoc.com":{11:{active:[],proxies:["AC637579@belfastpoc.com","AC372475@belfastpoc.com","AC965603@belfastpoc.com"],perms:[i.ACQUIRE,i.GIVE,i.TAKE,i.RELINQUISH]}},"AC917327@belfastpoc.com":{12:{active:[],proxies:["AC637579@belfastpoc.com","AC372475@belfastpoc.com","AC965603@belfastpoc.com"],perms:[i.ACQUIRE,i.GIVE,i.TAKE,i.RELINQUISH]}},"AC948280@belfastpoc.com":{13:{active:[],proxies:["AC637579@belfastpoc.com","AC372475@belfastpoc.com","AC965603@belfastpoc.com"],perms:[i.ACQUIRE,i.GIVE,i.TAKE,i.RELINQUISH]}}},t.fakeDelegateJIDs=["AC304133@belfastpoc.com","AC440801@belfastpoc.com","AC450921@belfastpoc.com","AC503280@belfastpoc.com","AC645393@belfastpoc.com","AC654215@belfastpoc.com","AC660723@belfastpoc.com","AC661592@belfastpoc.com","AC686789@belfastpoc.com","AC830117@belfastpoc.com","AC864846@belfastpoc.com","AC917327@belfastpoc.com","AC948280@belfastpoc.com"]},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.UI={Pencil:{viewBox:"0 0 1024 1024",paths:["M732.458 3.542l-572.458 572.458-160 448 447.666-160 572.792-572.458c32-128-160-320-288-288zM288 704l-64-64 544-544 64 64-544 544z"]},Attachment:{viewBox:"0 0 20 17",paths:["M10,14.5454545 C6.98758655,14.5454545 4.54545455,12.1033225 4.54545455,9.09090909 C4.54545455,6.07849564 6.98758655,3.63636364 10,3.63636364 C13.0111844,3.63636364 15.4545455,6.07849564 15.4545455,9.09090909 C15.4545455,12.1033225 13.0111844,14.5454545 10,14.5454545 L10,14.5454545 Z M18.75,2.51748252 L14.375,2.51748252 C14.0625,1.25874126 13.75,5.32907052e-15 12.5,5.32907052e-15 L7.5,5.32907052e-15 C6.25,5.32907052e-15 5.9375,1.25874126 5.625,2.51748252 L1.25,2.51748252 C0.56125,2.51748252 0,3.08391608 0,3.77622378 L0,15.1048951 C0,15.7972028 0.56125,16.3636364 1.25,16.3636364 L18.75,16.3636364 C19.4375,16.3636364 20,15.7972028 20,15.1048951 L20,3.77622378 C20,3.08391608 19.4375,2.51748252 18.75,2.51748252 L18.75,2.51748252 Z M5.45454545,9.09090909 C5.45454545,11.6013986 7.48811189,13.6363636 10,13.6363636 C12.5104895,13.6363636 14.5454545,11.6013986 14.5454545,9.09090909 C14.5454545,6.58041958 12.5104895,4.54545455 10,4.54545455 C7.48811189,4.54545455 5.45454545,6.58041958 5.45454545,9.09090909 L5.45454545,9.09090909 Z"]},Error:{viewBox:"0 0 1024 1024",paths:["M512 96c-111.118 0-215.584 43.272-294.156 121.844s-121.844 183.038-121.844 294.156c0 111.118 43.272 215.584 121.844 294.156s183.038 121.844 294.156 121.844c111.118 0 215.584-43.272 294.156-121.844s121.844-183.038 121.844-294.156c0-111.118-43.272-215.584-121.844-294.156s-183.038-121.844-294.156-121.844zM512 0v0c282.77 0 512 229.23 512 512s-229.23 512-512 512c-282.77 0-512-229.23-512-512s229.23-512 512-512zM448 704h128v128h-128zM448 192h128v384h-128z"]},SendMessage:{viewBox:"0 0 21 20",paths:["M-1.82964754e-13,10.1013362 L6.38194101,12.2201407 L20.4222112,-1.77635684e-15 L-1.82964754e-13,10.1013362 Z M8.93471742,13.1008485 L16.7857813,15.903797 L20.4222112,-1.77635684e-15 L8.93471742,13.1008485 Z M8.93471742,19.4827895 L12.638796,15.778711 L8.93471742,14.4563728 L8.93471742,19.4827895 Z"]},Reconnect:{viewBox:"0 0 1024 1024",paths:["M1024 384h-384l143.53-143.53c-72.53-72.526-168.96-112.47-271.53-112.47s-199 39.944-271.53 112.47c-72.526 72.53-112.47 168.96-112.47 271.53s39.944 199 112.47 271.53c72.53 72.526 168.96 112.47 271.53 112.47s199-39.944 271.528-112.472c6.056-6.054 11.86-12.292 17.456-18.668l96.32 84.282c-93.846 107.166-231.664 174.858-385.304 174.858-282.77 0-512-229.23-512-512s229.23-512 512-512c141.386 0 269.368 57.326 362.016 149.984l149.984-149.984v384z"]},Download:{viewBox:"0 0 1024 1024",paths:["M576 576h-128v192h-160l224 224 224-224h-160z","M892.216 514.542c2.49-11.29 3.784-22.87 3.784-34.542 0-88.224-71.776-160-160-160-13.956 0-27.796 1.83-41.164 5.378-24.838-77.286-97.404-133.378-182.836-133.378-86.654 0-160.886 58.042-184.312 138.118-22.982-6.66-47.052-10.118-71.688-10.118-141.158 0-256 114.84-256 256 0 61.986 22.444 121.798 63.2 168.42 40.354 46.164 95.852 76.346 156.266 84.988 1.538 0.218 3.064 0.326 4.572 0.326 15.666 0 29.354-11.514 31.638-27.472 2.502-17.496-9.652-33.708-27.146-36.208-45.262-6.474-86.864-29.116-117.144-63.754-30.558-34.956-47.386-79.81-47.386-126.3 0-105.87 86.13-192 192-192 52.024 0 100.73 20.466 137.146 57.63 12.368 12.624 32.63 12.83 45.252 0.458 12.624-12.37 12.83-32.628 0.458-45.252-15.676-15.998-33.070-29.66-51.76-40.848 12.84-57.42 64.304-99.988 124.904-99.988 70.58 0 128 57.42 128 128 0 8.706-0.876 17.398-2.602 25.832-3.542 17.316 7.624 34.222 24.938 37.764 2.164 0.444 4.32 0.656 6.448 0.656 14.884 0 28.218-10.442 31.318-25.592 2.218-10.854 3.494-21.972 3.812-33.126 10.244-3.624 21.096-5.534 32.086-5.534 52.936 0 96 43.066 96 96 0 10.964-1.88 21.784-5.484 32h-26.516c-17.674 0-32 14.326-32 32s14.326 32 32 32h64c52.934 0 96 43.066 96 96s-43.066 96-96 96h-64c-17.674 0-32 14.326-32 32s14.326 32 32 32h64c88.224 0 160-71.776 160-160 0-78.594-56.976-144.086-131.784-157.458z"]},ScrollToBottom:{viewBox:"0 0 1024 1024",nodes:[{name:"mask",attributes:{id:"ScrollToBottom-Mask"},children:[{name:"rect",attributes:{width:"100%",height:"100%",fill:"white"}},{name:"path",attributes:{d:"M512 684l150-350-300 0z",fill:"black"}}]},{name:"path",attributes:{d:"M512 64c282.77 0 512 186.25 512 416 0 229.752-229.23 416-512 416-27.156 0-53.81-1.734-79.824-5.044-109.978 109.978-241.25 129.7-368.176 132.596v-26.916c68.536-33.578 128-94.74 128-164.636 0-9.754-0.758-19.33-2.164-28.696-115.796-76.264-189.836-192.754-189.836-323.304 0-229.75 229.23-416 512-416z",mask:"url(#ScrollToBottom-Mask)"}}]},Plus:{viewBox:"0 0 1024 1024",paths:["M992 384h-352v-352c0-17.672-14.328-32-32-32h-192c-17.672 0-32 14.328-32 32v352h-352c-17.672 0-32 14.328-32 32v192c0 17.672 14.328 32 32 32h352v352c0 17.672 14.328 32 32 32h192c17.672 0 32-14.328 32-32v-352h352c17.672 0 32-14.328 32-32v-192c0-17.672-14.328-32-32-32z"]},Photo:{viewBox:"0 0 1024 1024",paths:["M959.884 128c0.040 0.034 0.082 0.076 0.116 0.116v767.77c-0.034 0.040-0.076 0.082-0.116 0.116h-895.77c-0.040-0.034-0.082-0.076-0.114-0.116v-767.772c0.034-0.040 0.076-0.082 0.114-0.114h895.77zM960 64h-896c-35.2 0-64 28.8-64 64v768c0 35.2 28.8 64 64 64h896c35.2 0 64-28.8 64-64v-768c0-35.2-28.8-64-64-64v0z","M832 288c0 53.020-42.98 96-96 96s-96-42.98-96-96 42.98-96 96-96 96 42.98 96 96z","M896 832h-768v-128l224-384 256 320h64l224-192z"]},Cross:{viewBox:"0 0 1024 1024",paths:["M893.254 221.254l-90.508-90.508-290.746 290.744-290.746-290.744-90.508 90.506 290.746 290.748-290.746 290.746 90.508 90.508 290.746-290.746 290.746 290.746 90.508-90.51-290.744-290.744z"]},MusicalNote:{viewBox:"0 0 1024 1024",paths:["M812.158 294.412c-87.050-122.21-78.88-35.914-163.208-279.684l-89.178-14.728-99.218 732.95c-223.632-127.958-364.672 3.468-328.984 168.886 18.92 87.712 161.432 170.274 301.8 88.78 66.342-39.89 87.672-104.22 96.14-149.838l70.876-543.852c252.89 222.974 172.142 357.892 119.85 513.244 107.498-44.334 275.88-239.888 91.922-515.758z"]},Microphone:{viewBox:"0 0 1024 1024",paths:["M896 448c0-6.26-0.152-12.59-0.454-18.812-1.278-26.478-23.746-46.918-50.256-45.632-26.478 1.278-46.908 23.778-45.63 50.256 0.224 4.688 0.34 9.46 0.34 14.186 0 158.894-129.196 288.166-288 288.166s-288-129.272-288-288.166c0-4.692 0.114-9.438 0.336-14.106 1.27-26.48-19.166-48.974-45.644-50.246-26.46-1.26-48.974 19.166-50.244 45.646-0.298 6.196-0.448 12.49-0.448 18.708 0 190.018 138.622 348.226 320 378.8v133.2c0 35.346 28.654 64 64 64s64-28.654 64-64v-133.2c181.378-30.574 320-188.782 320-378.8z","M512 0c-106.040 0-192 85.96-192 192v256c0 106.040 85.96 192 192 192s192-85.96 192-192v-256c0-106.040-85.96-192-192-192z"]},CheckboxChecked:{viewBox:"0 0 1024 1024",paths:["M896 0h-768c-70.4 0-128 57.6-128 128v768c0 70.4 57.6 128 128 128h768c70.4 0 128-57.6 128-128v-768c0-70.4-57.6-128-128-128zM448 794.51l-237.254-237.256 90.51-90.508 146.744 146.744 306.746-306.746 90.508 90.51-397.254 397.256z"]},CheckboxUnchecked:{viewBox:"0 0 1024 1024",paths:["M896 0h-768c-70.4 0-128 57.6-128 128v768c0 70.4 57.6 128 128 128h768c70.4 0 128-57.6 128-128v-768c0-70.4-57.6-128-128-128zM896 896h-768v-768h768v768z"]},SquareFilled:{viewBox:"0 0 1024 1024",paths:["M128 128h768v768h-768z"]},CircleFilled:{viewBox:"0 0 1024 1024",paths:["M0 512c0-282.77 229.23-512 512-512s512 229.23 512 512c0 282.77-229.23 512-512 512s-512-229.23-512-512z"]},Play:{viewBox:"0 0 1024 1024",paths:["M192 128l640 384-640 384z"]},Pause:{viewBox:"0 0 1024 1024",paths:["M128 128h320v768h-320zM576 128h320v768h-320z"]},AlertBell:{viewBox:"0 0 20 20",paths:["M20,16.25 C17.92875,16.25 16.25,14.57125 16.25,12.5 L16.25,6.93125 C16.25,4.1825 14.1025,1.89 11.25,1.36375 L11.25,0 L8.75,0 L8.75,1.36375 C5.8975,1.89 3.75,4.1825 3.75,6.93125 L3.75,12.5 C3.75,14.57125 2.07125,16.25 0,16.25 L0,17.5 L8.39,17.5 C8.28875,17.7225 8.23125,17.97125 8.23125,18.2325 C8.23125,19.20875 9.0225,20 9.99875,20 C10.97375,20 11.76625,19.20875 11.76625,18.2325 C11.76625,17.97125 11.71,17.72375 11.6075,17.5 L19.99875,17.5 L19.99875,16.25 L20,16.25 Z"]},AlertBellRinging:{viewBox:"0 0 20 20",paths:["M19.353,8 C19.02675,8 18.753,7.72933333 18.7305,7.37733333 C18.58425,4.99466667 17.59675,2.78533333 15.948,1.156 C15.6955,0.905333333 15.6805,0.484 15.91425,0.213333333 C16.14925,-0.0573333333 16.54425,-0.072 16.798,0.177333333 C18.6805,2.04 19.80925,4.56533333 19.97675,7.28933333 C20.0005,7.65733333 19.73925,7.97466667 19.39425,7.99866667 C19.3805,8 19.368,8 19.353,8","M20,16.25 C17.92875,16.25 16.25,14.57125 16.25,12.5 L16.25,6.93125 C16.25,4.1825 14.1025,1.89 11.25,1.36375 L11.25,0 L8.75,0 L8.75,1.36375 C5.8975,1.89 3.75,4.1825 3.75,6.93125 L3.75,12.5 C3.75,14.57125 2.07125,16.25 0,16.25 L0,17.5 L8.39,17.5 C8.28875,17.7225 8.23125,17.97125 8.23125,18.2325 C8.23125,19.20875 9.0225,20 9.99875,20 C10.97375,20 11.76625,19.20875 11.76625,18.2325 C11.76625,17.97125 11.71,17.72375 11.6075,17.5 L19.99875,17.5 L19.99875,16.25 L20,16.25 Z","M0.64575,8 C0.632,8 0.6195,8 0.6045,7.99866667 C0.2595,7.97466667 -0.0005,7.65733333 0.022,7.28933333 C0.1895,4.56533333 1.3195,2.04 3.20075,0.177333333 C3.4545,-0.0733333333 3.8495,-0.0573333333 4.0845,0.213333333 C4.3195,0.484 4.3045,0.905333333 4.052,1.156 C2.40325,2.78533333 1.41575,4.99466667 1.26825,7.37733333 C1.247,7.72933333 0.972,8 0.64575,8"]},PickVideo:{viewBox:"0 0 1024 1024",paths:["M78.302 262.54l865.444-231.884 49.69 185.452-865.444 231.884zM128 448v576h896v-576h-896zM448 896v-320l256 160-256 160z"]},RecordVideo:{viewBox:"0 0 1024 1024",paths:["M978.84 256.252c-10.588 0-21.458 3.722-31.436 10.766l-179.404 126.614v-105.632c0-52.8-43.2-96-96-96h-576c-52.8 0-96 43.2-96 96v448c0 52.8 43.2 96 96 96h576c52.8 0 96-43.2 96-96v-105.63l179.402 126.614c9.978 7.042 20.848 10.764 31.434 10.766 0.002 0 0.002 0 0.006 0 14.088 0 26.954-6.496 35.292-17.822 6.456-8.77 9.868-20.054 9.868-32.636v-410.582c-0.002-33.126-22.72-50.458-45.162-50.458z"]}}}(t.Icons||(t.Icons={}))},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(167)),i(n(168))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(29),s=n(180),r=n(33),a=n(19),l=n(0),c=n(16),d=n(4),h=n(34),u=n(7),p=n(20),g=n(5),m=n(6),f=n(14);t.Comms=class extends s.BaseComms{constructor(e,t,n,i,o){super(e,t,n,i),this.user=null,this._loggedIn=!1,this._postLoginTimeout=null,this._shouldClearData=!1,this._mamFetchInProgress=!1,this._mamQueryInProgress=!1,this._disconnectedDuringMamFetch=!1,this._onDisconnectDuringLogin=(e=>{e.detail===l.ConnectionStatus.Disconnected&&this._postLoginTimeout&&(this.clearPostLoginTimeout(),this._chatLayer.clearAllData(),document.removeEventListener("__cm-connection-change",this._onDisconnectDuringLogin))}),this._chatLayer=o,this._setupHandlers()}sso(e=!0){const t=e=>super[e];return i(this,void 0,void 0,function*(){this._chatLayer.showCancellableWaitingMessage(this._chatLayer.translateI18nItem(p.CommonMetadata.getI18nItem(p.CommonI18nKeys.AUTHENTICATING)),()=>{this._chatLayer.emit(f.BaseEvents.AuthenticationCredentialsReset)}),document.removeEventListener("__cm-connection-change",this._onDisconnectDuringLogin),document.addEventListener("__cm-connection-change",this._onDisconnectDuringLogin);try{yield t("sso").call(this,e),yield this._postLogin()}catch(e){throw e}})}login(e,t,n=!0){const o=e=>super[e];return i(this,void 0,void 0,function*(){this._chatLayer.showWaitingMessage(this._chatLayer.translateI18nItem(p.CommonMetadata.getI18nItem(p.CommonI18nKeys.AUTHENTICATING))),document.removeEventListener("__cm-connection-change",this._onDisconnectDuringLogin),document.addEventListener("__cm-connection-change",this._onDisconnectDuringLogin);try{yield o("login").call(this,e,t,!1),yield this._postLogin()}catch(e){throw this._handleLoginFailure(),this.triggerLoginEvent(!1,e.msg),e}})}setPresence(){return i(this,void 0,void 0,function*(){try{yield this.client.sendPresence()}catch(e){throw this.logger.error(e),e}})}getAllMessages(){return i(this,void 0,void 0,function*(){return yield this.client.getAllMessages()})}getMucHost(){return this.client.mucHost}findChatEntriesToPurge(e){return i(this,void 0,void 0,function*(){let t=[];try{const n=(yield this.getAllMessages()).filter(t=>t.recipient_id===`${e.id}@${this.client.mucHost}`||t.sender_id===`${e.id}@${this.client.mucHost}`).sort((e,t)=>e.ts-t.ts);t=n.splice(0,n.length-this._chatLayer.config.behaviour.maxChatEntriesToStore)}catch(e){this.logger.error("Couldn't fetch chat entries to purge:",e)}return t})}isMamFetchInProgress(){return this._mamFetchInProgress}embelishUser(e){return e.connectionStatus=e.connectionStatus||l.ConnectionStatus.Disconnected,e.displayName=g.formatUserName(e,g.NameFormat.PREFIX_FIRST_LAST),e}_setupHandlers(){this.onStatusUpdate(e=>i(this,void 0,void 0,function*(){this.user&&(this.user.connectionStatus=e)})),this.onAutoReconnected(({resumed:e})=>i(this,void 0,void 0,function*(){const t=!0===this._loggedIn,n=!0===e;if(!1===t){try{yield this._chatLayer.bootstrapper}catch(e){return this._handleLoginFailure(),void this.triggerLoginEvent(!1,e)}try{yield this._postLogin(n)}catch(e){return void this.client.forceDisconnect()}}else if(this._disconnectedDuringMamFetch||!n){yield this._getAppConfig(),this._disconnectedDuringMamFetch&&(yield this._chatLayer.clearAllData()),yield h.default.getCurrentlyDelegatedAccounts(this._chatLayer);const e=yield this._getLatestIdentifiersForPersonalMamQueries();yield this.fetchAllConversationsForAllAccounts(),yield this._processMissedPersonalMamMessagesForAccounts(e),yield this._chatLayer.displayNewestAlert(),n||(yield this.client.enableStreamManagement()),yield this.setPresence()}else yield this._getAppConfig(),yield this.fetchAllConversationsForAllAccounts(),yield this.setPresence();yield this._chatLayer.removeExpiredConversations(),this._chatLayer.emit(m.ChatEvents.AutoReconnected,{resumed:e})})),this.onDatabasesAutoDestroyed(()=>i(this,void 0,void 0,function*(){this._shouldClearData=!0}))}fetchAllConversationsForAllAccounts(){return i(this,void 0,void 0,function*(){const e=h.default.getDelegatedAccounts(),t=[this._chatLayer.getCurrentUserJid(),...e];for(const n of t)yield this._chatLayer.loadAllConversations(n)})}_postLogin(e=!1){return i(this,void 0,void 0,function*(){return this.username?new Promise((t,n)=>i(this,void 0,void 0,function*(){this.clearPostLoginTimeout(),this._shouldClearData&&(this.logger.log(a.LoggerTypes.CleanUp,"%c DELETING DATA FOR FRESH USER","color: #669; font-weight: bold;"),localStorage.removeItem(`${this._chatLayer.name}_config`),yield this._chatLayer.store.clearChatData(),this._shouldClearData=!1);try{yield this._getAppConfig()}catch(e){return n({msg:e})}const i=this.xmppConfig.loginTimeout||1e4;if(this._postLoginTimeout=setTimeout(()=>{this.clearPostLoginTimeout(),this.logger.log(a.LoggerTypes.Connectivity,"%c LOGIN TIMED OUT","color: #600; font-weight: bold;"),n(new Error(this._chatLayer.translateI18nItem(p.CommonMetadata.getI18nItem(p.CommonI18nKeys.LOGIN_TIMEOUT))))},i),yield this._chatLayer.showWaitingMessage(this._chatLayer.translateI18nItem(p.CommonMetadata.getI18nItem(p.CommonI18nKeys.SYNCING))),this.user=yield this._chatLayer.getUserByJid(this.username),yield this._chatLayer.store.setCurrentUser(this.user),!this.user){const e=this._chatLayer.translateI18nItem(p.CommonMetadata.getI18nItem(p.CommonI18nKeys.USER_NOT_FOUND)).replace("{{username}}",this.username);return n(new Error(e))}yield h.default.getCurrentlyDelegatedAccounts(this._chatLayer);const o=yield this._getLatestIdentifiersForPersonalMamQueries();yield this._chatLayer.showWaitingMessage(this._chatLayer.translateI18nItem(u.ChatCommonMetadata.getI18nItem(u.ChatCommonI18nKeys.FETCHING_CONVERSATIONS))),yield this.fetchAllConversationsForAllAccounts(),e||(yield this._chatLayer.showWaitingMessage(this._chatLayer.translateI18nItem(u.ChatCommonMetadata.getI18nItem(u.ChatCommonI18nKeys.FETCHING_OWN_DATA))),yield this._processMissedPersonalMamMessagesForAccounts(o)),this.logger.log(a.LoggerTypes.Connectivity,`%c LOGIN COMPLETE > %c${this.username}`,"color: #669; font-weight: bold;","color: #999; font-weight: normal;"),yield this._chatLayer.dismissWaitingMessage(),this.clearPostLoginTimeout(),this._loggedIn=!0,yield this._chatLayer.purgeAllConversations(),e||(yield this.client.enableStreamManagement()),yield this.setPresence(),this.triggerLoginEvent(!0),e||(yield this._chatLayer.displayNewestAlert()),this._chatLayer.emit(m.ChatEvents.PostLoginComplete),t()})):Promise.reject(new Error("Error in post-login: no username specified"))})}_getAppConfig(){return i(this,void 0,void 0,function*(){return new Promise((e,t)=>i(this,void 0,void 0,function*(){const n=yield this.client.getAppConfig();if(n.error&&"no_config"!==n.error)t(`Unable to get the app config from the server. Error code: '${n.error}'`);else{const t=localStorage.getItem(`${this._chatLayer.name}_config`);if(n.error&&"no_config"===n.error){if(null===t)return void e();localStorage.removeItem(`${this._chatLayer.name}_config`)}0===this._chatLayer.getPendingAlertCount()?JSON.stringify(n)===t?e():(localStorage.setItem(`${this._chatLayer.name}_config`,JSON.stringify(n)),yield this._chatLayer.dismissWaitingMessage(),this._chatLayer.emit(m.ChatEvents._Request_RaiseAlert,{type:"info",title:"Configuration Updated",body:"Your app configuration has been updated and your app needs to restart. Automatically restarting in 3 seconds...",raisedOn:(new Date).getTime(),priority:1,buttons:[{text:"Restart now",type:"primary",action:()=>i(this,void 0,void 0,function*(){yield this.client.deleteStreamManagementId(),window.location.reload()})}]}),setTimeout(()=>i(this,void 0,void 0,function*(){yield this.client.deleteStreamManagementId(),window.location.reload()}),3e3)):e()}}))})}_handleLoginFailure(){const e=e=>super[e];return i(this,void 0,void 0,function*(){this.user=null,this._loggedIn=!1,this.clearPostLoginTimeout(),yield e("logout").call(this,!0,!0)})}fetchConversationMessages(e,t=null,n=null,o=null,s=null){return i(this,void 0,void 0,function*(){let i=(1e3*Date.now()).toString();return t&&(i=(yield this.client.getMessageById(t)).archive_id),yield this._fetchEarlierConversationMessages(e,i,n,o,s)})}clearStoredConversationMessages(e){return i(this,void 0,void 0,function*(){yield this.client.deleteMessagesByRoomName(e.id)})}clearStoredConversationAttachments(e){return i(this,void 0,void 0,function*(){return new Promise((t,n)=>i(this,void 0,void 0,function*(){const n=[];e.attachments&&e.attachments.forEach(e=>{void 0!==e.local&&n.push(new Promise(t=>this.client.deleteFile(e.local).then(t).catch(n=>{this.logger.log(a.LoggerTypes.XmppClient,`Couldn't delete attachment at: '${e.local}':`,n),t()})))}),Promise.all(n).then(()=>{t()})}))})}clearPostLoginTimeout(){clearTimeout(this._postLoginTimeout),this._postLoginTimeout=null}_shouldIgnoreMamMessage(e){return!g.getMessageType(e)||!(!e.data[d.ChatMessageType.DelegationUpdate]||"active"!==e.data[d.ChatMessageType.DelegationUpdate].change)}_getLatestIdentifiersForPersonalMamQueries(){return i(this,void 0,void 0,function*(){const e=[],t=parseInt(this.client.getLastArchiveId());t>0&&e.push({jid:this._chatLayer.getCurrentUserJid(),latestIdentifier:String(t)});const n=yield this._chatLayer.store.getDelegateConversations(),i=h.default.getDelegateState();for(const o in n){const t=i.names[o];if(!t)continue;const s=n[o].latestIdentifier;s<=0||e.push({jid:`${t}/${o}`,latestIdentifier:String(s)})}return e})}_processMissedPersonalMamMessagesForAccounts(e){return i(this,void 0,void 0,function*(){e.forEach(e=>i(this,void 0,void 0,function*(){const t=e.latestIdentifier,n=e.jid===this._chatLayer.getCurrentUserJid()?null:e.jid,i=n?`Querying personal MAM for workspace '${n}' with latest identifier '${t}'...`:`Querying personal MAM for main account with latest identifier '${t}'...`;this._chatLayer.logger.log(a.LoggerTypes.Mam,i),yield this._processMissedPersonalMamMessage(t,n)}))})}_processMissedPersonalMamMessage(e=null,t=null){return i(this,void 0,void 0,function*(){if(!0!==this._mamFetchInProgress)try{if(this._mamQueryInProgress=!1,this._disconnectedDuringMamFetch=!1,null===e)return;this.logger.log(a.LoggerTypes.Mam,`%c QUERYING PERSONAL MAM FOR MISSED MESSAGE(S) FOR USER: %c${this.username} (since ${e})`,"color: #669; font-weight: bold;","color: #999; font-weight: normal;");const n=Date.now(),s=yield this.client.queryMam(null,e,null,-1,!1,t),l=Date.now();if(this._mamQueryInProgress=!1,this.logger.log(a.LoggerTypes.Mam,`%c QUERYING PERSONAL MAM TOOK ${l-n}ms`,"color: #669; font-weight: bold;"),this.logger.log(a.LoggerTypes.Mam,`%c FOUND ${s.length} MISSED MESSAGE(S) IN PERSONAL MAM`,"color: #669; font-weight: bold;"),s.length>0){const e=[],n=[];s.forEach(n=>i(this,void 0,void 0,function*(){const i=(t?t.split("/")[1]:null)||this.username;n&&g.jidsMatch(n.recipient_id,i)?this._shouldIgnoreMamMessage(n)?e.push(n):(this.logger.shouldLog(a.LoggerTypes.Mam)&&this.logger.log(a.LoggerTypes.Mam,"%c DISPATCHING PERSONAL MAM MESSAGE:%c","color: #669; font-weight: bold;","color: #999; font-weight: normal;",g.getMessageContentForDebug(n)),this.client._dispatchEvent(o.CtXmppClient.EVENT_TYPES.NEW_MESSAGE,n)):e.push(n)})),this.logger.log(a.LoggerTypes.Mam,`%c ${s.length-n.length-e.length} PERSONAL MAM MESSAGE(S) DISPATCHED`,"color: #669; font-weight: bold;"),n.length>0&&this.logger.log(a.LoggerTypes.Mam,`%c ${n.length} PERSONAL MAM MESSAGE(S) IGNORED DUE TO STANZA EXCLUSION RULES`,"color: #669; font-weight: bold;",n),e.length>0&&this.logger.log(a.LoggerTypes.Mam,`%c ${e.length} INVALID PERSONAL MAM MESSAGE(S) IGNORED`,"color: #C00; font-weight: bold;",e),this._mamFetchInProgress=!1}else this._mamFetchInProgress=!1}catch(e){const t=o.CtXmppClient.xmlToJson(e),n=t&&t.iq&&t.iq.error&&t.iq.error.text&&t.iq.error.text.$value||"";throw this.logger.log(a.LoggerTypes.Mam,"%c ERROR DURING PERSONAL MAM FETCH","color: #C00; font-weight: bold;",Object.assign({},t)),new r.IQError(n,t.iq)}else this.logger.log(a.LoggerTypes.Mam,"%c MAM FETCHING ALREADY IN PROGRESS: SKIPPING MAM CHECK","color: #669; font-weight: bold;")})}_fetchEarlierConversationMessages(e,t,n,s=null,l=null){return i(this,void 0,void 0,function*(){if(!0!==this._mamFetchInProgress)try{const d=e.roomJid.split("@").shift();this._mamQueryInProgress=!1,this._disconnectedDuringMamFetch=!1,this.logger.log(a.LoggerTypes.Mam,`%c QUERYING ROOM MAM FOR MESSAGES FOR CONVERSATION: %c${d} (before ${t})`,"color: #669; font-weight: bold;","color: #999; font-weight: normal;");const h=Date.now(),u=yield this.client.queryMamRoomHistoryByName(d,t,n,!1,s,l),p=Date.now();this._mamQueryInProgress=!1,this.logger.log(a.LoggerTypes.Mam,`%c QUERYING ROOM MAM TOOK ${p-h}ms`,"color: #669; font-weight: bold;"),this.logger.log(a.LoggerTypes.Mam,`%c FOUND ${u.length} MESSAGE(S) IN THE ROOM MAM`,"color: #669; font-weight: bold;",u);const m=[];if(u.length>0){const e=[],t=[];u.forEach(t=>{t?t.placeholder?e.push(t):g.getMessageType(t)?(this.logger.shouldLog(a.LoggerTypes.Mam)&&this.logger.log(a.LoggerTypes.Mam,"%c DISPATCHING ROOM MAM MESSAGE:%c","color: #669; font-weight: bold;","color: #999; font-weight: normal;",g.getMessageContentForDebug(t)),this.client._dispatchEvent(o.CtXmppClient.EVENT_TYPES.NEW_MESSAGE,t),m.push(t)):e.push(t):e.push(t)});const n=yield Promise.all(m.map(e=>i(this,void 0,void 0,function*(){return yield c.convertToChatEntry(e,this._chatLayer)})));return this.logger.log(a.LoggerTypes.Mam,`%c ${u.length-t.length-e.length} ROOM MAM MESSAGE(S) DISPATCHED`,"color: #669; font-weight: bold;"),t.length>0&&this.logger.log(a.LoggerTypes.Mam,`%c ${t.length} ROOM MAM MESSAGE(S) IGNORED DUE TO STANZA EXCLUSION RULES`,"color: #669; font-weight: bold;",t),e.length>0&&this.logger.log(a.LoggerTypes.Mam,`%c ${e.length} INVALID ROOM MAM MESSAGE(S) IGNORED`,"color: #C00; font-weight: bold;",e),this._mamFetchInProgress=!1,n}return this._mamFetchInProgress=!1,[]}catch(e){const t=o.CtXmppClient.xmlToJson(e),n=t&&t.iq&&t.iq.error&&t.iq.error.text&&t.iq.error.text.$value||"";if(this.logger.log(a.LoggerTypes.Mam,"%c ERROR DURING ROOM MAM FETCH","color: #C00; font-weight: bold;",Object.assign({},t)),!n.includes("Only members may query archives of this room"))throw new r.IQError(n,t.iq);return}else this.logger.log(a.LoggerTypes.Mam,"%c MAM FETCHING ALREADY IN PROGRESS: SKIPPING MAM CHECK","color: #669; font-weight: bold;")})}}},function(e,t){var n,i,o=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{i="function"==typeof clearTimeout?clearTimeout:r}catch(e){i=r}}();var l,c=[],d=!1,h=-1;function u(){d&&l&&(d=!1,l.length?c=l.concat(c):h=-1,c.length&&p())}function p(){if(!d){var e=a(u);d=!0;for(var t=c.length;t;){for(l=c,c=[];++h<t;)l&&l[h].run();h=-1,t=c.length}l=null,d=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===r||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new g(e,t)),1!==c.length||d||a(p)},g.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t,n){"use strict";t.byteLength=function(e){var t=c(e),n=t[0],i=t[1];return 3*(n+i)/4-i},t.toByteArray=function(e){var t,n,i=c(e),r=i[0],a=i[1],l=new s(function(e,t,n){return 3*(t+n)/4-n}(0,r,a)),d=0,h=a>0?r-4:r;for(n=0;n<h;n+=4)t=o[e.charCodeAt(n)]<<18|o[e.charCodeAt(n+1)]<<12|o[e.charCodeAt(n+2)]<<6|o[e.charCodeAt(n+3)],l[d++]=t>>16&255,l[d++]=t>>8&255,l[d++]=255&t;2===a&&(t=o[e.charCodeAt(n)]<<2|o[e.charCodeAt(n+1)]>>4,l[d++]=255&t);1===a&&(t=o[e.charCodeAt(n)]<<10|o[e.charCodeAt(n+1)]<<4|o[e.charCodeAt(n+2)]>>2,l[d++]=t>>8&255,l[d++]=255&t);return l},t.fromByteArray=function(e){for(var t,n=e.length,o=n%3,s=[],r=0,a=n-o;r<a;r+=16383)s.push(h(e,r,r+16383>a?a:r+16383));1===o?(t=e[n-1],s.push(i[t>>2]+i[t<<4&63]+"==")):2===o&&(t=(e[n-2]<<8)+e[n-1],s.push(i[t>>10]+i[t>>4&63]+i[t<<2&63]+"="));return s.join("")};for(var i=[],o=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,l=r.length;a<l;++a)i[a]=r[a],o[r.charCodeAt(a)]=a;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function d(e){return i[e>>18&63]+i[e>>12&63]+i[e>>6&63]+i[63&e]}function h(e,t,n){for(var i,o=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(d(i));return o.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,i,o){var s,r,a=8*o-i-1,l=(1<<a)-1,c=l>>1,d=-7,h=n?o-1:0,u=n?-1:1,p=e[t+h];for(h+=u,s=p&(1<<-d)-1,p>>=-d,d+=a;d>0;s=256*s+e[t+h],h+=u,d-=8);for(r=s&(1<<-d)-1,s>>=-d,d+=i;d>0;r=256*r+e[t+h],h+=u,d-=8);if(0===s)s=1-c;else{if(s===l)return r?NaN:1/0*(p?-1:1);r+=Math.pow(2,i),s-=c}return(p?-1:1)*r*Math.pow(2,s-i)},t.write=function(e,t,n,i,o,s){var r,a,l,c=8*s-o-1,d=(1<<c)-1,h=d>>1,u=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:s-1,g=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,r=d):(r=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-r))<1&&(r--,l*=2),(t+=r+h>=1?u/l:u*Math.pow(2,1-h))*l>=2&&(r++,l/=2),r+h>=d?(a=0,r=d):r+h>=1?(a=(t*l-1)*Math.pow(2,o),r+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,o),r=0));o>=8;e[n+p]=255&a,p+=g,a/=256,o-=8);for(r=r<<o|a,c+=o;c>0;e[n+p]=255&r,p+=g,r/=256,c-=8);e[n+p-g]|=128*m}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e,t,n,i=!0){this._id=null,this._timeout=-1,this._startTime=-1,this._totalTimeRun=-1,this._complete=!1,this._duration=-1,this._callback=null,this._paused=!1,this._pauseable=!1,this._id=e,this._duration=n,this._callback=t,this._startTime=(new Date).getTime(),this._timeout=setTimeout(this._callback,this._duration),this._pauseable=!1!==i}_timeDiff(e){return(new Date).getTime()-e}cancel(){clearTimeout(this._timeout),this._paused=!1}pause(){clearTimeout(this._timeout),this._totalTimeRun=this._timeDiff(this._startTime),this._complete=this._totalTimeRun>=this._duration,this._complete||(this._paused=!0)}resume(){this._paused=!1,this._timeout=this._complete?-1:setTimeout(this._callback,this._duration-this._totalTimeRun)}end(){this._paused=!1,clearTimeout(this._timeout),this._callback()}restart(){this._paused=!1,this._startTime=(new Date).getTime(),this._timeout=setTimeout(this._callback,this._duration)}get paused(){return this._paused}get pauseable(){return this._pauseable}get id(){return this._id}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(177),o=n(44);t.UsersDirectory=class{constructor(e,t=!1){this._instanceId=null,this._worker=null,this._debug=!1,this._db=null,this._dbName=null,this.initialised=!1,this.initialising=!1,this._workerResponseListeners={},this._instanceId=e,this._debug=t,this._dbName=`${e}_user_index`}_onWorkerResponse(e){if(e.data&&this._debug,e.data._id){const t=this._workerResponseListeners[e.data._id];if(!t)return;!0!==t(e.data)&&delete this._workerResponseListeners[e.data._id]}else switch(e.data.action){case"store-record":const t=this._db.transaction([this._dbName],"readwrite");t.oncomplete=(()=>{this._postMessageToWorker({action:"store-record-response",success:!0,key:e.data.key})}),t.onerror=(t=>{console.error(`Failed to put '${e.data.key}'.`),this._postMessageToWorker({key:e.data.key,action:"store-record-response",success:!1,msg:t.toString()})}),t.objectStore(this._dbName).put(e.data.record,e.data.key);break;case"retrieve-record":const n=this._db.transaction([this._dbName]).objectStore(this._dbName).get(e.data.key);n.onsuccess=(()=>{this._postMessageToWorker({action:"retrieve-record-response",success:!0,key:e.data.key,record:n.result})}),n.onerror=(t=>{console.error(`Failed to get ${e.data.key}:`,t),this._postMessageToWorker({key:e.data.key,action:"retrieve-record-response",success:!1,msg:t.toString(),record:null})})}}_postMessageToWorker(e,t){if(null===this._worker)throw new Error("Worker has not been initialised!");const n=o.generateGuid();t&&(this._workerResponseListeners[n]=t),this._worker.postMessage(Object.assign({},e,{_id:n}))}initialise(){return new Promise((e,t)=>{this.initialising=!0;let n=null,s=localStorage.getItem(`${this._instanceId}_ud_iv`);if(null==s){n=window.crypto.getRandomValues(new Uint8Array(16));let e=[];for(let i=0;i<16;i++)e.push(String.fromCharCode(n[i]));const t=e.join("");localStorage.setItem(`${this._instanceId}_ud_iv`,t)}else{const e=new Uint8Array(16);for(let t=0;t<s.length;t++)e[t]=s.charCodeAt(t);n=e}o.getEncryptionKey(this._instanceId).then(o=>{const s=indexedDB.open(this._dbName);s.onupgradeneeded=(e=>{this.initialising=!1,e.target.result.createObjectStore(this._dbName)}),s.onerror=(e=>{this.initialising=!1,console.error("Couldn't open IndexedDB database.",e)}),s.onsuccess=(s=>{this._db=s.target.result,this._worker=new Worker(window.URL.createObjectURL(new Blob([`const start = ${i.default.toString()}; start.call(self);`],{type:"text/javascript"}))),this._worker.onmessage=this._onWorkerResponse.bind(this),this._postMessageToWorker({action:"initialise",instanceId:this._instanceId,key:o,iv:n,debug:this._debug},n=>(this.initialising=!1,!0===n.success?(this.initialised=!0,e(n.msg)):(console.error(n.msg),this.initialised=!1,this.destroy(!0).then(()=>{t(n.msg)}).catch(e=>{t(e)})),!1))})})})}update(e,t,n){if(!0!==this.initialised)throw new Error("User index must be initialised first.");return new Promise((i,o)=>{this._postMessageToWorker({action:"fetch",endpoint:n,jid:e,pass:t},e=>(!0===e.success?i(e):(console.error(e.msg),o(e.msg)),!1))})}search(e,t,n=!1,i=!0){if(!0!==this.initialised)throw new Error("User index must be initialised first.");return new Promise((o,s)=>{this._postMessageToWorker({action:"search",query:e,fields:t||[],excludeRoles:n,excludeInactive:i},e=>(!0===e.success?o(e.results):(console.error(e.msg),s(e.msg)),!1))})}searchRoles(e,t){if(!0!==this.initialised)throw new Error("User index must be initialised first.");return new Promise((n,i)=>{this._postMessageToWorker({action:"role-search",query:e,fields:t||[]},e=>(!0===e.success?n(e.results):(console.error(e.msg),i(e.msg)),!1))})}searchGroups(e){if(!0!==this.initialised)throw new Error("User index must be initialised first.");return new Promise((t,n)=>{this._postMessageToWorker({action:"group-search",query:e},e=>(!0===e.success?t(e.results):(console.error(e.msg),n(e.msg)),!1))})}getUserByJid(e){if(!0!==this.initialised)throw new Error("User index must be initialised first.");return new Promise((t,n)=>{this._postMessageToWorker({action:"jid-search",jid:e},e=>(!0===e.success?t(e.results):(console.error(e.msg),n(e.msg)),!1))})}getUsersByJid(e){if(!0!==this.initialised)throw new Error("User index must be initialised first.");return new Promise((t,n)=>{this._postMessageToWorker({action:"get-users-by-jid",jids:e},e=>(!0===e.success?t(e.results):(console.error(e.msg),n(e.msg)),!1))})}getAllUsers(e=!1,t=!1){if(!0!==this.initialised)throw new Error("User index must be initialised first.");return new Promise((n,i)=>{this._postMessageToWorker({action:"get-all-users",excludeDeleted:e,excludeRoles:t},e=>(!0===e.success?n(e.results):(console.error(e.msg),i(e.msg)),!1))})}getAllUsersInGroup(e,t=!1,n=!1,i=!0){if(!0!==this.initialised)throw new Error("User index must be initialised first.");return new Promise((o,s)=>{this._postMessageToWorker({action:"get-all-users-in-group",group:e,excludeDeleted:t,excludeRoles:n,excludeInactiveUsers:i},e=>(!0===e.success?o(e.results):(console.error(e.msg),s(e.msg)),!1))})}getAllJids(e=!0,t=!1){if(!0!==this.initialised)throw new Error("User index must be initialised first.");return new Promise((n,i)=>{this._postMessageToWorker({action:"get-all-jids",excludeDeleted:e,excludeRoles:t},e=>(!0===e.success?n(e.results):(console.error(e.msg),i(e.msg)),!1))})}getAllRoles(e=!1){if(!0!==this.initialised)throw new Error("User index must be initialised first.");return new Promise((t,n)=>{this._postMessageToWorker({action:"get-all-roles",excludeDeleted:e},e=>(!0===e.success?t(e.results):(console.error(e.msg),n(e.msg)),!1))})}getAllGroups(){if(!0!==this.initialised)throw new Error("User index must be initialised first.");return new Promise((e,t)=>{this._postMessageToWorker({action:"get-all-groups"},n=>(!0===n.success?e(n.results):(console.error(n.msg),t(n.msg)),!1))})}updateAccount(e,t){if(!0!==this.initialised)throw new Error("User index must be initialised first.");return new Promise((n,i)=>{this._postMessageToWorker({action:"update-object",jid:e,updates:t},e=>(!0===e.success?n(e.results):(console.error(e.msg),i(e.msg)),!1))})}saveIndex(){if(!0!==this.initialised)throw new Error("User index must be initialised first.");return new Promise((e,t)=>{this._postMessageToWorker({action:"save-index"},n=>(!0===n.success?e(n.msg):(console.error(n.msg),t(n.msg)),!1))})}destroy(e=!1){if(!0!==this.initialised&&!1===e)throw new Error("User index must be initialised first.");return new Promise((e,t)=>{this._db.close();const n=indexedDB.deleteDatabase(this._dbName);n.onerror=(e=>{t("Error deleting user directory database.")}),n.onsuccess=(()=>{this._db=null,this.initialised=!1,e()}),n.onblocked=(e=>{e.target.result.close(),t("Couldn't delete user directory database due to the operation being blocked.")})})}static _resolvePath(e){return e?0===e.indexOf("http")||0===e.indexOf("//")?e:0===e.indexOf("/")?window.location.origin+e:`${window.location.origin}/${e}`:null}}},function(e,t,n){"use strict";function i(){let e=!1,t=null,i="lunr_index",o="idxBlock",s="docBlock";const r=function(){var e=function(t){var n=new e.Index;return n.pipeline.add(e.trimmer,e.stopWordFilter,e.stemmer),t&&t.call(n,n),n};return e.version="0.9.5",lunr=e,e.utils={},e.utils.warn=function(e){return function(t){e.console&&console.warn&&console.warn(t)}}(this),e.utils.toString=function(e){return void 0===e||null===e?"":e.toString()},e.EventEmitter=function(){this.events={}},e.EventEmitter.prototype.addListener=function(){var e=Array.prototype.slice.call(arguments),t=e.pop(),n=e;if("function"!=typeof t)throw new TypeError("last argument must be a function");n.forEach(function(e){this.hasHandler(e)||(this.events[e]=[]),this.events[e].push(t)},this)},e.EventEmitter.prototype.removeListener=function(e,t){if(this.hasHandler(e)){var n=this.events[e].indexOf(t);-1!==n&&(this.events[e].splice(n,1),0==this.events[e].length&&delete this.events[e])}},e.EventEmitter.prototype.emit=function(e){if(this.hasHandler(e)){var t=Array.prototype.slice.call(arguments,1);this.events[e].forEach(function(e){e.apply(void 0,t)},this)}},e.EventEmitter.prototype.hasHandler=function(e){return e in this.events},e.tokenizer=function(t){if(!arguments.length||null===t||void 0===t)return[];if(Array.isArray(t)){var n=t.filter(function(e){return null!==e&&void 0!==e}),i=[];return(n=n.map(function(t){return e.utils.toString(t).toLowerCase()})).forEach(function(t){var n=t.split(e.tokenizer.seperator);i=i.concat(n)},this),i}return t.toString().trim().toLowerCase().split(e.tokenizer.seperator)},e.tokenizer.defaultSeperator=/[\s\-]+/,e.tokenizer.seperator=e.tokenizer.defaultSeperator,e.tokenizer.setSeperator=function(t){null!==t&&void 0!==t&&"object"==typeof t&&(e.tokenizer.seperator=t)},e.tokenizer.resetSeperator=function(){e.tokenizer.seperator=e.tokenizer.defaultSeperator},e.tokenizer.getSeperator=function(){return e.tokenizer.seperator},e.Pipeline=function(){this._queue=[]},e.Pipeline.registeredFunctions={},e.Pipeline.registerFunction=function(t,n){n in e.Pipeline.registeredFunctions&&e.utils.warn("Overwriting existing registered function: "+n),t.label=n,e.Pipeline.registeredFunctions[n]=t},e.Pipeline.getRegisteredFunction=function(t){return t in e.Pipeline.registeredFunctions!=1?null:e.Pipeline.registeredFunctions[t]},e.Pipeline.warnIfFunctionNotRegistered=function(t){t.label&&t.label in this.registeredFunctions||e.utils.warn("Function is not registered with pipeline. This may cause problems when serialising the index.\n",t)},e.Pipeline.load=function(t){var n=new e.Pipeline;return t.forEach(function(t){var i=e.Pipeline.getRegisteredFunction(t);if(!i)throw new Error("Cannot load un-registered function: "+t);n.add(i)}),n},e.Pipeline.prototype.add=function(){Array.prototype.slice.call(arguments).forEach(function(t){e.Pipeline.warnIfFunctionNotRegistered(t),this._queue.push(t)},this)},e.Pipeline.prototype.after=function(t,n){e.Pipeline.warnIfFunctionNotRegistered(n);var i=this._queue.indexOf(t);if(-1===i)throw new Error("Cannot find existingFn");this._queue.splice(i+1,0,n)},e.Pipeline.prototype.before=function(t,n){e.Pipeline.warnIfFunctionNotRegistered(n);var i=this._queue.indexOf(t);if(-1===i)throw new Error("Cannot find existingFn");this._queue.splice(i,0,n)},e.Pipeline.prototype.remove=function(e){var t=this._queue.indexOf(e);-1!==t&&this._queue.splice(t,1)},e.Pipeline.prototype.run=function(e){for(var t=[],n=e.length,i=this._queue.length,o=0;o<n;o++){for(var s=e[o],r=0;r<i&&void 0!==(s=this._queue[r](s,o,e))&&null!==s;r++);void 0!==s&&null!==s&&t.push(s)}return t},e.Pipeline.prototype.reset=function(){this._queue=[]},e.Pipeline.prototype.get=function(){return this._queue},e.Pipeline.prototype.toJSON=function(){return this._queue.map(function(t){return e.Pipeline.warnIfFunctionNotRegistered(t),t.label})},e.Index=function(){this._fields=[],this._ref="id",this.pipeline=new e.Pipeline,this.documentStore=new e.DocumentStore,this.index={},this.eventEmitter=new e.EventEmitter,this._idfCache={},this.on("add","remove","update",function(){this._idfCache={}}.bind(this))},e.Index.prototype.on=function(){var e=Array.prototype.slice.call(arguments);return this.eventEmitter.addListener.apply(this.eventEmitter,e)},e.Index.prototype.off=function(e,t){return this.eventEmitter.removeListener(e,t)},e.Index.load=function(t){t.version!==e.version&&e.utils.warn("version mismatch: current "+e.version+" importing "+t.version);var n=new this;for(var i in n._fields=t.fields,n._ref=t.ref,n.documentStore=e.DocumentStore.load(t.documentStore),n.pipeline=e.Pipeline.load(t.pipeline),n.index={},t.index)n.index[i]=e.InvertedIndex.load(t.index[i]);return n},e.Index.prototype.addField=function(t){return this._fields.push(t),this.index[t]=new e.InvertedIndex,this},e.Index.prototype.setRef=function(e){return this._ref=e,this},e.Index.prototype.saveDocument=function(t){return this.documentStore=new e.DocumentStore(t),this},e.Index.prototype.addDoc=function(t,n){if(t){n=void 0===n||n;var i=t[this._ref];this.documentStore.addDoc(i,t),this._fields.forEach(function(n){var o=this.pipeline.run(e.tokenizer(t[n]));this.documentStore.addFieldLength(i,n,o.length);var s={};for(var r in o.forEach(function(e){e in s?s[e]+=1:s[e]=1},this),s){var a=s[r];a=Math.sqrt(a),this.index[n].addToken(r,{ref:i,tf:a})}},this),n&&this.eventEmitter.emit("add",t,this)}},e.Index.prototype.removeDocByRef=function(e,t){if(e&&!1!==this.documentStore.isDocStored()&&this.documentStore.hasDoc(e)){var n=this.documentStore.getDoc(e);this.removeDoc(n,!1)}},e.Index.prototype.removeDoc=function(t,n){if(t){n=void 0===n||n;var i=t[this._ref];this.documentStore.hasDoc(i)&&(this.documentStore.removeDoc(i),this._fields.forEach(function(n){this.pipeline.run(e.tokenizer(t[n])).forEach(function(e){this.index[n].removeToken(e,i)},this)},this),n&&this.eventEmitter.emit("remove",t,this))}},e.Index.prototype.updateDoc=function(e,t){t=void 0===t||t,this.removeDocByRef(e[this._ref],!1),this.addDoc(e,!1),t&&this.eventEmitter.emit("update",e,this)},e.Index.prototype.idf=function(e,t){var n="@"+t+"/"+e;if(Object.prototype.hasOwnProperty.call(this._idfCache,n))return this._idfCache[n];var i=this.index[t].getDocFreq(e),o=1+Math.log(this.documentStore.length/(i+1));return this._idfCache[n]=o,o},e.Index.prototype.getFields=function(){return this._fields.slice()},e.Index.prototype.search=function(t,n){if(!t)return[];t="string"==typeof t?{any:t}:JSON.parse(JSON.stringify(t));var i=null;null!=n&&(i=JSON.stringify(n));for(var o=new e.Configuration(i,this.getFields()).get(),s={},r=Object.keys(t),a=0;a<r.length;a++){var l=r[a];s[l]=this.pipeline.run(e.tokenizer(t[l]))}var c={};for(var d in o){var h=s[d]||s.any;if(h){var u=this.fieldSearch(h,d,o),p=o[d].boost;for(var g in u)u[g]=u[g]*p;for(var g in u)g in c?c[g]+=u[g]:c[g]=u[g]}}var m,f=[];for(var g in c)m={ref:g,score:c[g]},this.documentStore.hasDoc(g)&&(m.doc=this.documentStore.getDoc(g)),f.push(m);return f.sort(function(e,t){return t.score-e.score}),f},e.Index.prototype.fieldSearch=function(e,t,n){var i=n[t].bool,o=n[t].expand,s=null,r={};if(0!==n[t].boost)return e.forEach(function(e){var n=[e];1==o&&(n=this.index[t].expandToken(e));var a={};n.forEach(function(n){var o=this.index[t].getDocs(n),l=this.idf(n,t);if(s&&"AND"==i){var c={};for(var d in s)d in o&&(c[d]=o[d]);o=c}for(var d in n==e&&this.fieldSearchStats(r,n,o),o){var h=this.index[t].getTermFrequency(n,d),u=this.documentStore.getFieldLength(d,t),p=1;0!=u&&(p=1/Math.sqrt(u));var g=1;n!=e&&(g=.15*(1-(n.length-e.length)/n.length));var m=h*l*p*g;d in a?a[d]+=m:a[d]=m}},this),s=this.mergeScores(s,a,i)},this),s=this.coordNorm(s,r,e.length)},e.Index.prototype.mergeScores=function(e,t,n){if(!e)return t;if("AND"==n){var i={};for(var o in t)o in e&&(i[o]=e[o]+t[o]);return i}for(var o in t)o in e?e[o]+=t[o]:e[o]=t[o];return e},e.Index.prototype.fieldSearchStats=function(e,t,n){for(var i in n)i in e?e[i].push(t):e[i]=[t]},e.Index.prototype.coordNorm=function(e,t,n){for(var i in e)if(i in t){var o=t[i].length;e[i]=e[i]*o/n}return e},e.Index.prototype.toJSON=function(){var t={};return this._fields.forEach(function(e){t[e]=this.index[e].toJSON()},this),{version:e.version,fields:this._fields,ref:this._ref,documentStore:this.documentStore.toJSON(),index:t,pipeline:this.pipeline.toJSON()}},e.Index.prototype.use=function(e){var t=Array.prototype.slice.call(arguments,1);t.unshift(this),e.apply(this,t)},e.DocumentStore=function(e){this._save=null===e||void 0===e||e,this.docs={},this.docInfo={},this.length=0},e.DocumentStore.load=function(e){var t=new this;return t.length=e.length,t.docs=e.docs,t.docInfo=e.docInfo,t._save=e.save,t},e.DocumentStore.prototype.isDocStored=function(){return this._save},e.DocumentStore.prototype.addDoc=function(e,t){this.hasDoc(e)||this.length++,!0===this._save?this.docs[e]=function(e){if(null===e||"object"!=typeof e)return e;var t=e.constructor();for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(t):this.docs[e]=null},e.DocumentStore.prototype.getDoc=function(e){return!1===this.hasDoc(e)?null:this.docs[e]},e.DocumentStore.prototype.hasDoc=function(e){return e in this.docs},e.DocumentStore.prototype.removeDoc=function(e){this.hasDoc(e)&&(delete this.docs[e],delete this.docInfo[e],this.length--)},e.DocumentStore.prototype.addFieldLength=function(e,t,n){null!==e&&void 0!==e&&0!=this.hasDoc(e)&&(this.docInfo[e]||(this.docInfo[e]={}),this.docInfo[e][t]=n)},e.DocumentStore.prototype.updateFieldLength=function(e,t,n){null!==e&&void 0!==e&&0!=this.hasDoc(e)&&this.addFieldLength(e,t,n)},e.DocumentStore.prototype.getFieldLength=function(e,t){return null===e||void 0===e?0:e in this.docs&&t in this.docInfo[e]?this.docInfo[e][t]:0},e.DocumentStore.prototype.toJSON=function(){return{docs:this.docs,docInfo:this.docInfo,length:this.length,save:this._save}},e.stemmer=function(){var e={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},t={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},n="[aeiouy]",i="[^aeiou][^aeiouy]*",o=new RegExp("^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*"),s=new RegExp("^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*"),r=new RegExp("^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*([aeiouy][aeiou]*)?$"),a=new RegExp("^([^aeiou][^aeiouy]*)?[aeiouy]"),l=/^(.+?)(ss|i)es$/,c=/^(.+?)([^s])s$/,d=/^(.+?)eed$/,h=/^(.+?)(ed|ing)$/,u=/.$/,p=/(at|bl|iz)$/,g=new RegExp("([^aeiouylsz])\\1$"),m=new RegExp("^"+i+n+"[^aeiouwxy]$"),f=/^(.+?[^aeiou])y$/,_=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,v=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,y=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,C=/^(.+?)(s|t)(ion)$/,w=/^(.+?)e$/,b=/ll$/,E=new RegExp("^"+i+n+"[^aeiouwxy]$");return function(n){var i,T,R,I,A,S,x;if(n.length<3)return n;if("y"==(R=n.substr(0,1))&&(n=R.toUpperCase()+n.substr(1)),A=c,(I=l).test(n)?n=n.replace(I,"$1$2"):A.test(n)&&(n=n.replace(A,"$1$2")),A=h,(I=d).test(n)){var O=I.exec(n);(I=o).test(O[1])&&(I=u,n=n.replace(I,""))}else A.test(n)&&(i=(O=A.exec(n))[1],(A=a).test(i)&&(S=g,x=m,(A=p).test(n=i)?n+="e":S.test(n)?(I=u,n=n.replace(I,"")):x.test(n)&&(n+="e")));return(I=f).test(n)&&(n=(i=(O=I.exec(n))[1])+"i"),(I=_).test(n)&&(i=(O=I.exec(n))[1],T=O[2],(I=o).test(i)&&(n=i+e[T])),(I=v).test(n)&&(i=(O=I.exec(n))[1],T=O[2],(I=o).test(i)&&(n=i+t[T])),A=C,(I=y).test(n)?(i=(O=I.exec(n))[1],(I=s).test(i)&&(n=i)):A.test(n)&&(i=(O=A.exec(n))[1]+O[2],(A=s).test(i)&&(n=i)),(I=w).test(n)&&(i=(O=I.exec(n))[1],A=r,S=E,((I=s).test(i)||A.test(i)&&!S.test(i))&&(n=i)),A=s,(I=b).test(n)&&A.test(n)&&(I=u,n=n.replace(I,"")),"y"==R&&(n=R.toLowerCase()+n.substr(1)),n}}(),e.Pipeline.registerFunction(e.stemmer,"stemmer"),e.stopWordFilter=function(t){if(t&&!0!==e.stopWordFilter.stopWords[t])return t},e.clearStopWords=function(){e.stopWordFilter.stopWords={}},e.addStopWords=function(t){null!=t&&!1!==Array.isArray(t)&&t.forEach(function(t){e.stopWordFilter.stopWords[t]=!0},this)},e.resetStopWords=function(){e.stopWordFilter.stopWords=e.defaultStopWords},e.defaultStopWords={"":!0,a:!0,able:!0,about:!0,across:!0,after:!0,all:!0,almost:!0,also:!0,am:!0,among:!0,an:!0,and:!0,any:!0,are:!0,as:!0,at:!0,be:!0,because:!0,been:!0,but:!0,by:!0,can:!0,cannot:!0,could:!0,dear:!0,did:!0,do:!0,does:!0,either:!0,else:!0,ever:!0,every:!0,for:!0,from:!0,get:!0,got:!0,had:!0,has:!0,have:!0,he:!0,her:!0,hers:!0,him:!0,his:!0,how:!0,however:!0,i:!0,if:!0,in:!0,into:!0,is:!0,it:!0,its:!0,just:!0,least:!0,let:!0,like:!0,likely:!0,may:!0,me:!0,might:!0,most:!0,must:!0,my:!0,neither:!0,no:!0,nor:!0,not:!0,of:!0,off:!0,often:!0,on:!0,only:!0,or:!0,other:!0,our:!0,own:!0,rather:!0,said:!0,say:!0,says:!0,she:!0,should:!0,since:!0,so:!0,some:!0,than:!0,that:!0,the:!0,their:!0,them:!0,then:!0,there:!0,these:!0,they:!0,this:!0,tis:!0,to:!0,too:!0,twas:!0,us:!0,wants:!0,was:!0,we:!0,were:!0,what:!0,when:!0,where:!0,which:!0,while:!0,who:!0,whom:!0,why:!0,will:!0,with:!0,would:!0,yet:!0,you:!0,your:!0},e.stopWordFilter.stopWords=e.defaultStopWords,e.Pipeline.registerFunction(e.stopWordFilter,"stopWordFilter"),e.trimmer=function(e){if(null===e||void 0===e)throw new Error("token should not be undefined");return e.replace(/^\W+/,"").replace(/\W+$/,"")},e.Pipeline.registerFunction(e.trimmer,"trimmer"),e.InvertedIndex=function(){this.root={docs:{},df:0}},e.InvertedIndex.load=function(e){var t=new this;return t.root=e.root,t},e.InvertedIndex.prototype.addToken=function(e,t,n){n=n||this.root;for(var i=0;i<=e.length-1;){var o=e[i];o in n||(n[o]={docs:{},df:0}),i+=1,n=n[o]}var s=t.ref;n.docs[s]?n.docs[s]={tf:t.tf}:(n.docs[s]={tf:t.tf},n.df+=1)},e.InvertedIndex.prototype.hasToken=function(e){if(!e)return!1;for(var t=this.root,n=0;n<e.length;n++){if(!t[e[n]])return!1;t=t[e[n]]}return!0},e.InvertedIndex.prototype.getNode=function(e){if(!e)return null;for(var t=this.root,n=0;n<e.length;n++){if(!t[e[n]])return null;t=t[e[n]]}return t},e.InvertedIndex.prototype.getDocs=function(e){var t=this.getNode(e);return null==t?{}:t.docs},e.InvertedIndex.prototype.getTermFrequency=function(e,t){var n=this.getNode(e);return null==n?0:t in n.docs?n.docs[t].tf:0},e.InvertedIndex.prototype.getDocFreq=function(e){var t=this.getNode(e);return null==t?0:t.df},e.InvertedIndex.prototype.removeToken=function(e,t){if(e){var n=this.getNode(e);null!=n&&t in n.docs&&(delete n.docs[t],n.df-=1)}},e.InvertedIndex.prototype.expandToken=function(e,t,n){if(null==e||""==e)return[];if(t=t||[],void 0==n&&null==(n=this.getNode(e)))return t;for(var i in n.df>0&&t.push(e),n)"docs"!==i&&"df"!==i&&this.expandToken(e+i,t,n[i]);return t},e.InvertedIndex.prototype.toJSON=function(){return{root:this.root}},e.Configuration=function(t,n){var i;if(t=t||"",void 0==n||null==n)throw new Error("fields should not be null");this.config={};try{i=JSON.parse(t),this.buildUserConfig(i,n)}catch(t){e.utils.warn("user configuration parse failed, will use default configuration"),this.buildDefaultConfig(n)}},e.Configuration.prototype.buildDefaultConfig=function(e){this.reset(),e.forEach(function(e){this.config[e]={boost:1,bool:"OR",expand:!1}},this)},e.Configuration.prototype.buildUserConfig=function(t,n){var i="OR",o=!1;if(this.reset(),"bool"in t&&(i=t.bool||i),"expand"in t&&(o=t.expand||o),"fields"in t)for(var s in t.fields)if(n.indexOf(s)>-1){var r=t.fields[s],a=o;void 0!=r.expand&&(a=r.expand),this.config[s]={boost:r.boost||0===r.boost?r.boost:1,bool:r.bool||i,expand:a}}else e.utils.warn("field name in user configuration not found in index instance fields");else this.addAllFields2UserConfig(i,o,n)},e.Configuration.prototype.addAllFields2UserConfig=function(e,t,n){n.forEach(function(n){this.config[n]={boost:1,bool:e,expand:t}},this)},e.Configuration.prototype.get=function(){return this.config},e.Configuration.prototype.reset=function(){this.config={}},lunr.SortedSet=function(){this.length=0,this.elements=[]},lunr.SortedSet.load=function(e){var t=new this;return t.elements=e,t.length=e.length,t},lunr.SortedSet.prototype.add=function(){var e,t;for(e=0;e<arguments.length;e++)t=arguments[e],~this.indexOf(t)||this.elements.splice(this.locationFor(t),0,t);this.length=this.elements.length},lunr.SortedSet.prototype.toArray=function(){return this.elements.slice()},lunr.SortedSet.prototype.map=function(e,t){return this.elements.map(e,t)},lunr.SortedSet.prototype.forEach=function(e,t){return this.elements.forEach(e,t)},lunr.SortedSet.prototype.indexOf=function(e){for(var t=0,n=this.elements.length,i=n-t,o=t+Math.floor(i/2),s=this.elements[o];i>1;){if(s===e)return o;s<e&&(t=o),s>e&&(n=o),i=n-t,o=t+Math.floor(i/2),s=this.elements[o]}return s===e?o:-1},lunr.SortedSet.prototype.locationFor=function(e){for(var t=0,n=this.elements.length,i=n-t,o=t+Math.floor(i/2),s=this.elements[o];i>1;)s<e&&(t=o),s>e&&(n=o),i=n-t,o=t+Math.floor(i/2),s=this.elements[o];return s>e?o:s<e?o+1:void 0},lunr.SortedSet.prototype.intersect=function(e){for(var t=new lunr.SortedSet,n=0,i=0,o=this.length,s=e.length,r=this.elements,a=e.elements;!(n>o-1||i>s-1);)r[n]!==a[i]?r[n]<a[i]?n++:r[n]>a[i]&&i++:(t.add(r[n]),n++,i++);return t},lunr.SortedSet.prototype.clone=function(){var e=new lunr.SortedSet;return e.elements=this.toArray(),e.length=e.elements.length,e},lunr.SortedSet.prototype.union=function(e){var t,n,i;this.length>=e.length?(t=this,n=e):(t=e,n=this),i=t.clone();for(var o=0,s=n.toArray();o<s.length;o++)i.add(s[o]);return i},lunr.SortedSet.prototype.toJSON=function(){return this.toArray()},e}();let a=!0;const l=new Map;function c(e,t,n){self.postMessage({_id:t,action:e,success:!1,msg:n})}function d(e,t,n,i){self.postMessage({_id:t,action:e,success:!0,results:n,msg:i})}let h="pureJs";self.onmessage=function(u){switch(u.data.action){case"initialise":const p=()=>{e=!0,d("initialisation-complete",u.data._id,void 0,void 0)},v=e=>{c("initialisation-complete",u.data._id,e)};if(!u.data.instanceId)return void v("Error initialising user index database.");a=!0===u.data.debug,this._blockSize=u.data.blockSize||this._blockSize,new Promise((e,t)=>{f(h).then(t=>{if(void 0===t){const t=void 0===self.crypto.subtle;m(h,t).then(()=>{e(t)})}else e(t)})}).then(e=>{e?(!function(){!function(e){function t(e){return parseInt(e)===e}function i(e){if(!t(e.length))return!1;for(var n=0;n<e.length;n++)if(!t(e[n])||e[n]<0||e[n]>255)return!1;return!0}function o(e,n){if(e.buffer&&ArrayBuffer.isView(e)&&"Uint8Array"===e.name)return n&&(e=e.slice?e.slice():Array.prototype.slice.call(e)),e;if(Array.isArray(e)){if(!i(e))throw new Error("Array contains invalid value: "+e);return new Uint8Array(e)}if(t(e.length)&&i(e))return new Uint8Array(e);throw new Error("unsupported array-like object")}function s(e){return new Uint8Array(e)}function r(e,t,n,i,o){null==i&&null==o||(e=e.slice?e.slice(i,o):Array.prototype.slice.call(e,i,o)),t.set(e,n)}var a=function(){return{toBytes:function(e){var t=[],n=0;e=encodeURI(e);for(;n<e.length;){var i=e.charCodeAt(n++);37===i?(t.push(parseInt(e.substr(n,2),16)),n+=2):t.push(i)}return o(t)},fromBytes:function(e){var t=[],n=0;for(;n<e.length;){var i=e[n];i<128?(t.push(String.fromCharCode(i)),n++):i>191&&i<224?(t.push(String.fromCharCode((31&i)<<6|63&e[n+1])),n+=2):(t.push(String.fromCharCode((15&i)<<12|(63&e[n+1])<<6|63&e[n+2])),n+=3)}return t.join("")}}}(),l=function(){var e="0123456789abcdef";return{toBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},fromBytes:function(t){for(var n=[],i=0;i<t.length;i++){var o=t[i];n.push(e[(240&o)>>4]+e[15&o])}return n.join("")}}}(),c={16:10,24:12,32:14},d=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],h=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],u=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],p=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],g=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],m=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],f=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],_=[1374988112,2118214995,437757123,975658646,1001089995,530400753,2902087851,1273168787,540080725,2910219766,2295101073,4110568485,1340463100,3307916247,641025152,3043140495,3736164937,632953703,1172967064,1576976609,3274667266,2169303058,2370213795,1809054150,59727847,361929877,3211623147,2505202138,3569255213,1484005843,1239443753,2395588676,1975683434,4102977912,2572697195,666464733,3202437046,4035489047,3374361702,2110667444,1675577880,3843699074,2538681184,1649639237,2976151520,3144396420,4269907996,4178062228,1883793496,2403728665,2497604743,1383856311,2876494627,1917518562,3810496343,1716890410,3001755655,800440835,2261089178,3543599269,807962610,599762354,33778362,3977675356,2328828971,2809771154,4077384432,1315562145,1708848333,101039829,3509871135,3299278474,875451293,2733856160,92987698,2767645557,193195065,1080094634,1584504582,3178106961,1042385657,2531067453,3711829422,1306967366,2438237621,1908694277,67556463,1615861247,429456164,3602770327,2302690252,1742315127,2968011453,126454664,3877198648,2043211483,2709260871,2084704233,4169408201,0,159417987,841739592,504459436,1817866830,4245618683,260388950,1034867998,908933415,168810852,1750902305,2606453969,607530554,202008497,2472011535,3035535058,463180190,2160117071,1641816226,1517767529,470948374,3801332234,3231722213,1008918595,303765277,235474187,4069246893,766945465,337553864,1475418501,2943682380,4003061179,2743034109,4144047775,1551037884,1147550661,1543208500,2336434550,3408119516,3069049960,3102011747,3610369226,1113818384,328671808,2227573024,2236228733,3535486456,2935566865,3341394285,496906059,3702665459,226906860,2009195472,733156972,2842737049,294930682,1206477858,2835123396,2700099354,1451044056,573804783,2269728455,3644379585,2362090238,2564033334,2801107407,2776292904,3669462566,1068351396,742039012,1350078989,1784663195,1417561698,4136440770,2430122216,775550814,2193862645,2673705150,1775276924,1876241833,3475313331,3366754619,270040487,3902563182,3678124923,3441850377,1851332852,3969562369,2203032232,3868552805,2868897406,566021896,4011190502,3135740889,1248802510,3936291284,699432150,832877231,708780849,3332740144,899835584,1951317047,4236429990,3767586992,866637845,4043610186,1106041591,2144161806,395441711,1984812685,1139781709,3433712980,3835036895,2664543715,1282050075,3240894392,1181045119,2640243204,25965917,4203181171,4211818798,3009879386,2463879762,3910161971,1842759443,2597806476,933301370,1509430414,3943906441,3467192302,3076639029,3776767469,2051518780,2631065433,1441952575,404016761,1942435775,1408749034,1610459739,3745345300,2017778566,3400528769,3110650942,941896748,3265478751,371049330,3168937228,675039627,4279080257,967311729,135050206,3635733660,1683407248,2076935265,3576870512,1215061108,3501741890],v=[1347548327,1400783205,3273267108,2520393566,3409685355,4045380933,2880240216,2471224067,1428173050,4138563181,2441661558,636813900,4233094615,3620022987,2149987652,2411029155,1239331162,1730525723,2554718734,3781033664,46346101,310463728,2743944855,3328955385,3875770207,2501218972,3955191162,3667219033,768917123,3545789473,692707433,1150208456,1786102409,2029293177,1805211710,3710368113,3065962831,401639597,1724457132,3028143674,409198410,2196052529,1620529459,1164071807,3769721975,2226875310,486441376,2499348523,1483753576,428819965,2274680428,3075636216,598438867,3799141122,1474502543,711349675,129166120,53458370,2592523643,2782082824,4063242375,2988687269,3120694122,1559041666,730517276,2460449204,4042459122,2706270690,3446004468,3573941694,533804130,2328143614,2637442643,2695033685,839224033,1973745387,957055980,2856345839,106852767,1371368976,4181598602,1033297158,2933734917,1179510461,3046200461,91341917,1862534868,4284502037,605657339,2547432937,3431546947,2003294622,3182487618,2282195339,954669403,3682191598,1201765386,3917234703,3388507166,0,2198438022,1211247597,2887651696,1315723890,4227665663,1443857720,507358933,657861945,1678381017,560487590,3516619604,975451694,2970356327,261314535,3535072918,2652609425,1333838021,2724322336,1767536459,370938394,182621114,3854606378,1128014560,487725847,185469197,2918353863,3106780840,3356761769,2237133081,1286567175,3152976349,4255350624,2683765030,3160175349,3309594171,878443390,1988838185,3704300486,1756818940,1673061617,3403100636,272786309,1075025698,545572369,2105887268,4174560061,296679730,1841768865,1260232239,4091327024,3960309330,3497509347,1814803222,2578018489,4195456072,575138148,3299409036,446754879,3629546796,4011996048,3347532110,3252238545,4270639778,915985419,3483825537,681933534,651868046,2755636671,3828103837,223377554,2607439820,1649704518,3270937875,3901806776,1580087799,4118987695,3198115200,2087309459,2842678573,3016697106,1003007129,2802849917,1860738147,2077965243,164439672,4100872472,32283319,2827177882,1709610350,2125135846,136428751,3874428392,3652904859,3460984630,3572145929,3593056380,2939266226,824852259,818324884,3224740454,930369212,2801566410,2967507152,355706840,1257309336,4148292826,243256656,790073846,2373340630,1296297904,1422699085,3756299780,3818836405,457992840,3099667487,2135319889,77422314,1560382517,1945798516,788204353,1521706781,1385356242,870912086,325965383,2358957921,2050466060,2388260884,2313884476,4006521127,901210569,3990953189,1014646705,1503449823,1062597235,2031621326,3212035895,3931371469,1533017514,350174575,2256028891,2177544179,1052338372,741876788,1606591296,1914052035,213705253,2334669897,1107234197,1899603969,3725069491,2631447780,2422494913,1635502980,1893020342,1950903388,1120974935],y=[2807058932,1699970625,2764249623,1586903591,1808481195,1173430173,1487645946,59984867,4199882800,1844882806,1989249228,1277555970,3623636965,3419915562,1149249077,2744104290,1514790577,459744698,244860394,3235995134,1963115311,4027744588,2544078150,4190530515,1608975247,2627016082,2062270317,1507497298,2200818878,567498868,1764313568,3359936201,2305455554,2037970062,1047239e3,1910319033,1337376481,2904027272,2892417312,984907214,1243112415,830661914,861968209,2135253587,2011214180,2927934315,2686254721,731183368,1750626376,4246310725,1820824798,4172763771,3542330227,48394827,2404901663,2871682645,671593195,3254988725,2073724613,145085239,2280796200,2779915199,1790575107,2187128086,472615631,3029510009,4075877127,3802222185,4107101658,3201631749,1646252340,4270507174,1402811438,1436590835,3778151818,3950355702,3963161475,4020912224,2667994737,273792366,2331590177,104699613,95345982,3175501286,2377486676,1560637892,3564045318,369057872,4213447064,3919042237,1137477952,2658625497,1119727848,2340947849,1530455833,4007360968,172466556,266959938,516552836,0,2256734592,3980931627,1890328081,1917742170,4294704398,945164165,3575528878,958871085,3647212047,2787207260,1423022939,775562294,1739656202,3876557655,2530391278,2443058075,3310321856,547512796,1265195639,437656594,3121275539,719700128,3762502690,387781147,218828297,3350065803,2830708150,2848461854,428169201,122466165,3720081049,1627235199,648017665,4122762354,1002783846,2117360635,695634755,3336358691,4234721005,4049844452,3704280881,2232435299,574624663,287343814,612205898,1039717051,840019705,2708326185,793451934,821288114,1391201670,3822090177,376187827,3113855344,1224348052,1679968233,2361698556,1058709744,752375421,2431590963,1321699145,3519142200,2734591178,188127444,2177869557,3727205754,2384911031,3215212461,2648976442,2450346104,3432737375,1180849278,331544205,3102249176,4150144569,2952102595,2159976285,2474404304,766078933,313773861,2570832044,2108100632,1668212892,3145456443,2013908262,418672217,3070356634,2594734927,1852171925,3867060991,3473416636,3907448597,2614737639,919489135,164948639,2094410160,2997825956,590424639,2486224549,1723872674,3157750862,3399941250,3501252752,3625268135,2555048196,3673637356,1343127501,4130281361,3599595085,2957853679,1297403050,81781910,3051593425,2283490410,532201772,1367295589,3926170974,895287692,1953757831,1093597963,492483431,3528626907,1446242576,1192455638,1636604631,209336225,344873464,1015671571,669961897,3375740769,3857572124,2973530695,3747192018,1933530610,3464042516,935293895,3454686199,2858115069,1863638845,3683022916,4085369519,3292445032,875313188,1080017571,3279033885,621591778,1233856572,2504130317,24197544,3017672716,3835484340,3247465558,2220981195,3060847922,1551124588,1463996600],C=[4104605777,1097159550,396673818,660510266,2875968315,2638606623,4200115116,3808662347,821712160,1986918061,3430322568,38544885,3856137295,718002117,893681702,1654886325,2975484382,3122358053,3926825029,4274053469,796197571,1290801793,1184342925,3556361835,2405426947,2459735317,1836772287,1381620373,3196267988,1948373848,3764988233,3385345166,3263785589,2390325492,1480485785,3111247143,3780097726,2293045232,548169417,3459953789,3746175075,439452389,1362321559,1400849762,1685577905,1806599355,2174754046,137073913,1214797936,1174215055,3731654548,2079897426,1943217067,1258480242,529487843,1437280870,3945269170,3049390895,3313212038,923313619,679998e3,3215307299,57326082,377642221,3474729866,2041877159,133361907,1776460110,3673476453,96392454,878845905,2801699524,777231668,4082475170,2330014213,4142626212,2213296395,1626319424,1906247262,1846563261,562755902,3708173718,1040559837,3871163981,1418573201,3294430577,114585348,1343618912,2566595609,3186202582,1078185097,3651041127,3896688048,2307622919,425408743,3371096953,2081048481,1108339068,2216610296,0,2156299017,736970802,292596766,1517440620,251657213,2235061775,2933202493,758720310,265905162,1554391400,1532285339,908999204,174567692,1474760595,4002861748,2610011675,3234156416,3693126241,2001430874,303699484,2478443234,2687165888,585122620,454499602,151849742,2345119218,3064510765,514443284,4044981591,1963412655,2581445614,2137062819,19308535,1928707164,1715193156,4219352155,1126790795,600235211,3992742070,3841024952,836553431,1669664834,2535604243,3323011204,1243905413,3141400786,4180808110,698445255,2653899549,2989552604,2253581325,3252932727,3004591147,1891211689,2487810577,3915653703,4237083816,4030667424,2100090966,865136418,1229899655,953270745,3399679628,3557504664,4118925222,2061379749,3079546586,2915017791,983426092,2022837584,1607244650,2118541908,2366882550,3635996816,972512814,3283088770,1568718495,3499326569,3576539503,621982671,2895723464,410887952,2623762152,1002142683,645401037,1494807662,2595684844,1335535747,2507040230,4293295786,3167684641,367585007,3885750714,1865862730,2668221674,2960971305,2763173681,1059270954,2777952454,2724642869,1320957812,2194319100,2429595872,2815956275,77089521,3973773121,3444575871,2448830231,1305906550,4021308739,2857194700,2516901860,3518358430,1787304780,740276417,1699839814,1592394909,2352307457,2272556026,188821243,1729977011,3687994002,274084841,3594982253,3613494426,2701949495,4162096729,322734571,2837966542,1640576439,484830689,1202797690,3537852828,4067639125,349075736,3342319475,4157467219,4255800159,1030690015,1155237496,2951971274,1757691577,607398968,2738905026,499347990,3794078908,1011452712,227885567,2818666809,213114376,3034881240,1455525988,3414450555,850817237,1817998408,3092726480],w=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],b=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],E=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],T=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];function R(e){for(var t=[],n=0;n<e.length;n+=4)t.push(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3]);return t}var I=function(e){if(!(this instanceof I))throw Error("AES must be instanitated with `new`");Object.defineProperty(this,"key",{value:o(e,!0)}),this._prepare()};I.prototype._prepare=function(){var e=c[this.key.length];if(null==e)throw new Error("invalid key size (must be 16, 24 or 32 bytes)");this._Ke=[],this._Kd=[];for(var t=0;t<=e;t++)this._Ke.push([0,0,0,0]),this._Kd.push([0,0,0,0]);for(var n,i=4*(e+1),o=this.key.length/4,s=R(this.key),t=0;t<o;t++)n=t>>2,this._Ke[n][t%4]=s[t],this._Kd[e-n][t%4]=s[t];for(var r,a=0,l=o;l<i;){if(r=s[o-1],s[0]^=h[r>>16&255]<<24^h[r>>8&255]<<16^h[255&r]<<8^h[r>>24&255]^d[a]<<24,a+=1,8!=o)for(var t=1;t<o;t++)s[t]^=s[t-1];else{for(var t=1;t<o/2;t++)s[t]^=s[t-1];r=s[o/2-1],s[o/2]^=h[255&r]^h[r>>8&255]<<8^h[r>>16&255]<<16^h[r>>24&255]<<24;for(var t=o/2+1;t<o;t++)s[t]^=s[t-1]}for(var t=0;t<o&&l<i;)u=l>>2,p=l%4,this._Ke[u][p]=s[t],this._Kd[e-u][p]=s[t++],l++}for(var u=1;u<e;u++)for(var p=0;p<4;p++)r=this._Kd[u][p],this._Kd[u][p]=w[r>>24&255]^b[r>>16&255]^E[r>>8&255]^T[255&r]},I.prototype.encrypt=function(e){if(16!=e.length)throw new Error("invalid plaintext size (must be 16 bytes)");for(var t=this._Ke.length-1,n=[0,0,0,0],i=R(e),o=0;o<4;o++)i[o]^=this._Ke[0][o];for(var r=1;r<t;r++){for(var o=0;o<4;o++)n[o]=p[i[o]>>24&255]^g[i[(o+1)%4]>>16&255]^m[i[(o+2)%4]>>8&255]^f[255&i[(o+3)%4]]^this._Ke[r][o];i=n.slice()}for(var a,l=s(16),o=0;o<4;o++)a=this._Ke[t][o],l[4*o]=255&(h[i[o]>>24&255]^a>>24),l[4*o+1]=255&(h[i[(o+1)%4]>>16&255]^a>>16),l[4*o+2]=255&(h[i[(o+2)%4]>>8&255]^a>>8),l[4*o+3]=255&(h[255&i[(o+3)%4]]^a);return l},I.prototype.decrypt=function(e){if(16!=e.length)throw new Error("invalid ciphertext size (must be 16 bytes)");for(var t=this._Kd.length-1,n=[0,0,0,0],i=R(e),o=0;o<4;o++)i[o]^=this._Kd[0][o];for(var r=1;r<t;r++){for(var o=0;o<4;o++)n[o]=_[i[o]>>24&255]^v[i[(o+3)%4]>>16&255]^y[i[(o+2)%4]>>8&255]^C[255&i[(o+1)%4]]^this._Kd[r][o];i=n.slice()}for(var a,l=s(16),o=0;o<4;o++)a=this._Kd[t][o],l[4*o]=255&(u[i[o]>>24&255]^a>>24),l[4*o+1]=255&(u[i[(o+3)%4]>>16&255]^a>>16),l[4*o+2]=255&(u[i[(o+2)%4]>>8&255]^a>>8),l[4*o+3]=255&(u[255&i[(o+1)%4]]^a);return l};var A=function(e){if(!(this instanceof A))throw Error("AES must be instanitated with `new`");this.description="Electronic Code Block",this.name="ecb",this._aes=new I(e)};A.prototype.encrypt=function(e){if((e=o(e)).length%16!=0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var t=s(e.length),n=s(16),i=0;i<e.length;i+=16)r(e,n,0,i,i+16),r(n=this._aes.encrypt(n),t,i);return t},A.prototype.decrypt=function(e){if((e=o(e)).length%16!=0)throw new Error("invalid ciphertext size (must be multiple of 16 bytes)");for(var t=s(e.length),n=s(16),i=0;i<e.length;i+=16)r(e,n,0,i,i+16),r(n=this._aes.decrypt(n),t,i);return t};var S=function(e,t){if(!(this instanceof S))throw Error("AES must be instanitated with `new`");if(this.description="Cipher Block Chaining",this.name="cbc",t){if(16!=t.length)throw new Error("invalid initialation vector size (must be 16 bytes)")}else t=s(16);this._lastCipherblock=o(t,!0),this._aes=new I(e)};S.prototype.encrypt=function(e){if((e=o(e)).length%16!=0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var t=s(e.length),n=s(16),i=0;i<e.length;i+=16){r(e,n,0,i,i+16);for(var a=0;a<16;a++)n[a]^=this._lastCipherblock[a];this._lastCipherblock=this._aes.encrypt(n),r(this._lastCipherblock,t,i)}return t},S.prototype.decrypt=function(e){if((e=o(e)).length%16!=0)throw new Error("invalid ciphertext size (must be multiple of 16 bytes)");for(var t=s(e.length),n=s(16),i=0;i<e.length;i+=16){r(e,n,0,i,i+16),n=this._aes.decrypt(n);for(var a=0;a<16;a++)t[i+a]=n[a]^this._lastCipherblock[a];r(e,this._lastCipherblock,0,i,i+16)}return t};var x=function(e,t,n){if(!(this instanceof x))throw Error("AES must be instanitated with `new`");if(this.description="Cipher Feedback",this.name="cfb",t){if(16!=t.length)throw new Error("invalid initialation vector size (must be 16 size)")}else t=s(16);n||(n=1),this.segmentSize=n,this._shiftRegister=o(t,!0),this._aes=new I(e)};x.prototype.encrypt=function(e){if(e.length%this.segmentSize!=0)throw new Error("invalid plaintext size (must be segmentSize bytes)");for(var t,n=o(e,!0),i=0;i<n.length;i+=this.segmentSize){t=this._aes.encrypt(this._shiftRegister);for(var s=0;s<this.segmentSize;s++)n[i+s]^=t[s];r(this._shiftRegister,this._shiftRegister,0,this.segmentSize),r(n,this._shiftRegister,16-this.segmentSize,i,i+this.segmentSize)}return n},x.prototype.decrypt=function(e){if(e.length%this.segmentSize!=0)throw new Error("invalid ciphertext size (must be segmentSize bytes)");for(var t,n=o(e,!0),i=0;i<n.length;i+=this.segmentSize){t=this._aes.encrypt(this._shiftRegister);for(var s=0;s<this.segmentSize;s++)n[i+s]^=t[s];r(this._shiftRegister,this._shiftRegister,0,this.segmentSize),r(e,this._shiftRegister,16-this.segmentSize,i,i+this.segmentSize)}return n};var O=function(e,t){if(!(this instanceof O))throw Error("AES must be instanitated with `new`");if(this.description="Output Feedback",this.name="ofb",t){if(16!=t.length)throw new Error("invalid initialation vector size (must be 16 bytes)")}else t=s(16);this._lastPrecipher=o(t,!0),this._lastPrecipherIndex=16,this._aes=new I(e)};O.prototype.encrypt=function(e){for(var t=o(e,!0),n=0;n<t.length;n++)16===this._lastPrecipherIndex&&(this._lastPrecipher=this._aes.encrypt(this._lastPrecipher),this._lastPrecipherIndex=0),t[n]^=this._lastPrecipher[this._lastPrecipherIndex++];return t},O.prototype.decrypt=O.prototype.encrypt;var M=function(e){if(!(this instanceof M))throw Error("Counter must be instanitated with `new`");0===e||e||(e=1),"number"==typeof e?(this._counter=s(16),this.setValue(e)):this.setBytes(e)};M.prototype.setValue=function(e){if("number"!=typeof e||parseInt(e)!=e)throw new Error("invalid counter value (must be an integer)");if(e>Number.MAX_SAFE_INTEGER)throw new Error("integer value out of safe range");for(var t=15;t>=0;--t)this._counter[t]=e%256,e=parseInt(e/256)},M.prototype.setBytes=function(e){if(16!=(e=o(e,!0)).length)throw new Error("invalid counter bytes size (must be 16 bytes)");this._counter=e},M.prototype.increment=function(){for(var e=15;e>=0;e--){if(255!==this._counter[e]){this._counter[e]++;break}this._counter[e]=0}};var L=function(e,t){if(!(this instanceof L))throw Error("AES must be instanitated with `new`");this.description="Counter",this.name="ctr",t instanceof M||(t=new M(t)),this._counter=t,this._remainingCounter=null,this._remainingCounterIndex=16,this._aes=new I(e)};L.prototype.encrypt=function(e){for(var t=o(e,!0),n=0;n<t.length;n++)16===this._remainingCounterIndex&&(this._remainingCounter=this._aes.encrypt(this._counter._counter),this._remainingCounterIndex=0,this._counter.increment()),t[n]^=this._remainingCounter[this._remainingCounterIndex++];return t},L.prototype.decrypt=L.prototype.encrypt;var N={AES:I,Counter:M,ModeOfOperation:{ecb:A,cbc:S,cfb:x,ofb:O,ctr:L},utils:{hex:l,utf8:a},padding:{pkcs7:{pad:function(e){var t=16-(e=o(e,!0)).length%16,n=s(e.length+t);r(e,n);for(var i=e.length;i<n.length;i++)n[i]=t;return n},strip:function(e){if((e=o(e,!0)).length<16)throw new Error("PKCS#7 invalid length");var t=e[e.length-1];if(t>16)throw new Error("PKCS#7 padding byte out of range");for(var n=e.length-t,i=0;i<t;i++)if(e[n+i]!==t)throw new Error("PKCS#7 invalid padding byte");var a=s(n);return r(e,a,0,0,n),a}}},_arrayTest:{coerceArray:o,createArray:s,copyArray:r}};"undefined"!=typeof exports||("function"==typeof define&&n(178)?define(N):(e.aesjs&&(N._aesjs=e.aesjs),e.aesjs=N))}(this)}(),this.subtle=null):this.subtle=self.crypto.subtle,function(e){return new Promise((t,n)=>{this.subtle?this.subtle.importKey("raw",e,{name:"AES-CBC"},!1,["encrypt","decrypt"]).then(e=>{t(e)}):t(e)})}(u.data.key).then(e=>{this._key=e,this._iv=u.data.iv,new Promise((e,t)=>{let n=null,r=0,a=0;f(i).then(i=>{if(!i)return e(n);g(i).then(i=>{n=i,function i(){f(s+r).then(s=>{if(!s)return function i(){f(o+a).then(o=>{if(!o)return e(n);g(o).then(e=>{n.index[e.prop]=e.data,a++,i()}).catch(t)}).catch(t)}();g(s).then(e=>{n.documentStore.docs=Object.assign(n.documentStore.docs,e),r++,i()}).catch(t)}).catch(t)}()}).catch(t)}).catch(t)}).then(e=>{e&&(t=r.Index.load(e)),p()}).catch(e=>{v("Failed reading database for previously stored index.")})}).catch(e=>{v("Failed importing key for previously stored index.")})}).catch(e=>{v("Failed detecting crypto type for previously stored index")});break;case"fetch":if(!1===e)return void c("index-complete",u.data._id,"Initialisation must be completed before the 'fetch' action can take place.");const y=Date.now();fetch(u.data.endpoint,{method:"GET",headers:{Authorization:"Basic "+function(e){return btoa(unescape(encodeURIComponent(e)))}(`${u.data.jid}:${u.data.pass}`)}}).then(e=>{if(200!==e.status)throw new Error(`Couldn't download user directory. Status code: '${e.status}'.`);return e.json()}).then(e=>{const n={added:e.added||[],updated:e.updated||[],removed:e.removed||[]};void 0!==e.full&&(t=null,n.added=e.full);const i=Date.now()-y,o=[`Downloaded '${n.added.length}' additions, '${n.updated.length}' updates and '${n.removed.length}' deletions in ${i}ms`];null===t&&(t=r(function(){this.setRef("jid"),this.addField("jid"),this.addField("firstName"),this.addField("lastName"),this.addField("jobTitle"),this.addField("telephone"),this.addField("group"),this.addField("is_role"),this.addField("active"),this.saveDocument(!0)}),o.push("Created a fresh index")),n.added.length>0&&(n.added.forEach(e=>t.addDoc(e)),o.push(`Added '${n.added.length}' users to index`)),n.updated.length>0&&(n.updated.forEach(e=>t.updateDoc(e)),o.push(`Updated '${n.updated.length}' users in index`)),n.removed.length>0&&(n.removed.forEach(e=>t.removeDoc(e)),o.push(`Removed '${n.removed.length}' users from index`)),_(2e3).then(()=>{self.postMessage({_id:u.data._id,success:!0,action:"index-complete",hash:e.hash||null,msg:`${o.join(", ")} | Completed in ${Date.now()-y}ms.`})}).catch(e=>{c("index-complete",u.data._id,"Couldn't persist updated index.")})}).catch(e=>{const t=`Unable to download user directory from location '${u.data.endpoint}'`;console.error(t,e),c("index-complete",u.data._id,t)});break;case"update-object":if(!1===e)return void c("update-object-complete",u.data._id,"Initialisation must be completed before the 'update-object' action can take place.");if(null===t)return void c("update-object-complete",u.data._id,"There is no index to update, have you downloaded the index yet?");const C=u.data.jid;if(!C)return void c("update-object-complete",u.data._id,"A jid must be specified to update an object");const w=u.data.updates;if(!w)return void c("update-object-complete",u.data._id,"No updates have been specified");const b=Date.now(),E=t.search(C,{expand:!0})[0];if(E&&E.doc){const e=E.doc,n=Object.assign({},e,w);t.updateDoc(n),d("update-object-complete",u.data._id,n,`Updated object with JID '${C}' in ${Date.now()-b}ms.`)}else t.addDoc(w,!1),d("update-object-complete",u.data._id,w,`Created object with JID '${C}' in ${Date.now()-b}ms.`);break;case"save-index":if(!1===e)return void c("save-index-complete",u.data._id,"Initialisation must be completed before the 'update-object' action can take place.");const T=Date.now();_(2e3).then(()=>{self.postMessage({_id:u.data._id,success:!0,action:"save-index-complete",msg:`Save index completed in ${Date.now()-T}ms.`})}).catch(e=>{c("save-index-complete",u.data._id,"Couldn't persist updated index.")});break;case"search":if(r.clearStopWords(),!1===e)return void c("search-complete",u.data._id,"Initialisation must be completed before the 'search' action can take place.");if(null===t)return void c("search-complete",u.data._id,"There is no index to be searched, have you updated the index yet?");const R=Date.now();let I=null;if(Array.isArray(u.data.fields)&&u.data.fields.length>0){const e={fields:{},bool:"OR",expand:!0};u.data.fields.forEach(t=>{e.fields[t]={}}),I=t.search(u.data.query,e)}else I=t.search(u.data.query,{expand:!0});let A=I.map(e=>e.doc);u.data.excludeRoles&&(A=A.filter(e=>!e.is_role)),u.data.excludeInactive&&(A=A.filter(e=>e.is_role||e.active)),d("search-complete",u.data._id,A,`Found ${A.length} users in ${Date.now()-R}ms.`);break;case"role-search":if(r.clearStopWords(),!1===e)return void c("role-search-complete",u.data._id,"Initialisation must be completed before the 'search' action can take place.");if(null===t)return void c("role-search-complete",u.data._id,"There is no index to be searched, have you updated the index yet?");const S=Date.now();let x=null;if(Array.isArray(u.data.fields)&&u.data.fields.length>0){const e={fields:{},bool:"OR",expand:!0};u.data.fields.forEach(t=>{e.fields[t]={}}),x=t.search(u.data.query,e)}else x=t.search(u.data.query,{expand:!0});const O=x.map(e=>e.doc).filter(e=>e.is_role);d("role-search-complete",u.data._id,O,`Found ${O.length} roles in ${Date.now()-S}ms.`);break;case"group-search":if(!1===e)return void self.postMessage({_id:u.data._id,success:!1,action:"group-search-complete",msg:"Initialisation must be completed before the 'group-search-complete' action can take place."});if(null===t)return void self.postMessage({_id:u.data._id,success:!1,action:"group-search-complete",msg:"There is no index available, have you updated the index yet?"});const M=Date.now(),L=[];for(let e in t.documentStore.docs){const n=t.documentStore.docs[e];n.group&&n.group.split(", ").forEach(e=>{const t=e.trim();t.toLowerCase().indexOf(u.data.query.toLowerCase())>=0&&!L.includes(t)&&L.push(t)})}self.postMessage({_id:u.data._id,success:!0,action:"group-search-complete",msg:`Fetched '${L.length}' groups in ${Date.now()-M}ms.`,results:L});break;case"jid-search":if(!1===e)return void c("jid-search-complete",u.data._id,"Initialisation must be completed before the 'jid-search' action can take place.");if(null===t)return void c("jid-search-complete",u.data._id,"There is no index to be searched, have you updated the index yet?");const N=Date.now(),D=t.search(u.data.jid,{expand:!0})[0],P=void 0!==D?D.doc:null;d("jid-search-complete",u.data._id,P,null!==P?`Found user with JID '${u.data.jid}' in ${Date.now()-N}ms.`:`No user with JID '${u.data.jid}' could be found.`);break;case"get-users-by-jid":if(!1===e)return void c("get-users-by-jid-complete",u.data._id,"Initialisation must be completed before the 'get-users-by-jid' action can take place.");if(null===t)return void c("get-users-by-jid-complete",u.data._id,"There is no index to be searched, have you updated the index yet?");const k=Date.now(),U=u.data.jids.map(e=>{const n=e.split("@")[0],i=e.split("@")[1];return t.documentStore.docs[e]||t.documentStore.docs[n.toUpperCase()+"@"+i]||t.documentStore.docs[n.toLowerCase()+"@"+i]}).filter(e=>!!e);d("get-users-by-jid-complete",u.data._id,U,U.length>0?`Found '${U.length}' users in ${Date.now()-k}ms.`:"No users could be found.");break;case"get-all-roles":if(!1===e)return void c("get-all-roles-complete",u.data._id,"Initialisation must be completed before the 'get-all-roles' action can take place.");if(null===t)return void c("get-all-roles-complete",u.data._id,"There is no index available, have you updated the index yet?");const j=Date.now(),F=[];for(let e in t.documentStore.docs){const n=t.documentStore.docs[e];n.is_role&&(u.data.excludeDeleted&&n.deleted||F.push(n))}d("get-all-roles-complete",u.data._id,F,`Fetched '${F.length}' roles in ${Date.now()-j}ms.`);break;case"get-all-users":if(!1===e)return void c("get-all-users-complete",u.data._id,"Initialisation must be completed before the 'get-all-users' action can take place.");if(null===t)return void c("get-all-users-complete",u.data._id,"There is no index available, have you updated the index yet?");const B=Date.now(),G=[];for(let e in t.documentStore.docs)u.data.excludeDeleted&&t.documentStore.docs[e].deleted||u.data.excludeRoles&&t.documentStore.docs[e].is_role||G.push(t.documentStore.docs[e]);d("get-all-users-complete",u.data._id,G,`Fetched '${G.length}' users in ${Date.now()-B}ms.`);break;case"get-all-users-in-group":if(!1===e)return void c("get-all-users-in-group-complete",u.data._id,"Initialisation must be completed before the 'get-all-users-in-group' action can take place.");if(null===t)return void c("get-all-users-in-group-complete",u.data._id,"There is no index available, have you updated the index yet?");const H=Date.now(),q=[];for(let e in t.documentStore.docs){const n=t.documentStore.docs[e];u.data.excludeDeleted&&n.deleted||(u.data.excludeRoles&&n.is_role||(!u.data.excludeInactiveUsers||n.active||n.is_role)&&n.group&&-1!==n.group.split(", ").indexOf(u.data.group)&&q.push(t.documentStore.docs[e]))}d("get-all-users-in-group-complete",u.data._id,q,`Fetched '${q.length}' users in ${Date.now()-H}ms.`);break;case"get-all-jids":if(!1===e)return void c("get-all-jids-complete",u.data._id,"Initialisation must be completed before the 'get-all-jids' action can take place.");if(null===t)return void c("get-all-jids-complete",u.data._id,"There is no index available, have you updated the index yet?");const $=Date.now(),z=[];for(let e in t.documentStore.docs)u.data.excludeDeleted&&t.documentStore.docs[e].deleted||u.data.excludeRoles&&t.documentStore.docs[e].is_role||z.push(e);d("get-all-jids-complete",u.data._id,z,`Fetched '${z.length}' jids in ${Date.now()-$}ms.`);break;case"get-all-groups":if(!1===e)return void c("get-all-groups-complete",u.data._id,"Initialisation must be completed before the 'get-all-groups' action can take place.");if(null===t)return void c("get-all-groups-complete",u.data._id,"There is no index available, have you updated the index yet?");const V=Date.now(),W=[];for(let e in t.documentStore.docs){const n=t.documentStore.docs[e];n.group&&n.group.split(", ").forEach(e=>{const t=e.trim();W.includes(t)||W.push(t)})}d("get-all-groups-complete",u.data._id,W,`Fetched '${W.length}' groups in ${Date.now()-V}ms.`);break;case"store-record-response":case"retrieve-record-response":const J=l.get(u.data.key);J&&(u.data.success?J.resolve(u.data.record):J.reject(u.data.msg),l.delete(u.data.key));break;default:d(void 0,u.data._id,void 0,`Invalid action '${u.data.action}' was specified.`)}function p(e){return new Promise((t,n)=>{(function(e){return new Promise((t,n)=>{const i=new TextEncoder;t(i.encode(e))})})(JSON.stringify(e)).then(e=>{if(this.subtle)this.subtle.encrypt({name:"AES-CBC",iv:this._iv},this._key,e).then(e=>{t(e)}).catch(n);else{const n=new aesjs.ModeOfOperation.ctr(this._key).encrypt(e);t(n)}}).catch(n)})}function g(e){return new Promise((t,n)=>{if(this.subtle)this.subtle.decrypt({name:"AES-CBC",iv:this._iv},this._key,e).then(e=>{v(new Uint8Array(e)).then(e=>{t(JSON.parse(e))}).catch(n)}).catch(n);else{v(new aesjs.ModeOfOperation.ctr(this._key).decrypt(e)).then(e=>{t(JSON.parse(e))}).catch(n)}})}function m(e,t){return new Promise((n,i)=>{l.set(e,{resolve:n,reject:i}),self.postMessage({action:"store-record",key:e,record:t})})}function f(e){return new Promise((t,n)=>{l.set(e,{resolve:t,reject:n}),self.postMessage({action:"retrieve-record",key:e})})}function _(e=1e3){return a&&console.time("encrypt"),new Promise((n,r)=>{let l=0,c=0;const d=t.toJSON(),h=JSON.parse(JSON.stringify(d)),u=Object.keys(h.documentStore.docs),g=Object.keys(h.index);!function t(){if(0===u.length)a&&console.timeEnd("encrypt"),a&&console.time("index"),h.documentStore.docs={},a&&console.time("index2"),function e(){if(0===g.length)h.index={},p(h).then(e=>{a&&console.timeEnd("index2"),m(i,e).then(n).catch(r)});else{const t=g.shift();a&&console.time("chunk"),p({prop:t,data:h.index[t]}).then(t=>{m(o+c++,t).then(()=>{a&&console.timeEnd("chunk"),e()})})}}();else{const n={};u.splice(0,e).forEach(e=>{const t=d.documentStore.docs[e];n[e]=t}),a&&console.time("block"),p(n).then(e=>{m(s+l++,e).then(()=>{a&&console.timeEnd("block"),t()}).catch(r)}).catch(r)}}()})}function v(e){return new Promise((t,n)=>{t((new TextDecoder).decode(e))})}}}n.r(t),n.d(t,"default",function(){return i})},function(e,t){(function(t){e.exports=t}).call(this,{})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(){this.nsResolve=function(e){return"vc"==e?"vcard-temp":null},this.json={}}static fromXml(e){const t=new i;try{t.initFromXML(e)}catch(e){return void console.error("Bad vCard: "+e)}return t}static fromJSON(e){const t=new i;return t.initFromJSON(e),t}_extractEmail(e){const t={};return"string"==typeof e.USERID&&(t.address=e.USERID),e.HOME&&(t.home=!0),e.WORK&&(t.work=!0),e.INTERNET&&(t.internet=!0),e.PREF&&(t.pref=!0),e.X400&&(t.x400=!0),t}_extractTelephone(e){const t={};return"string"==typeof e.NUMBER&&(t.number=e.NUMBER),e.HOME&&(t.home=!0),e.WORK&&(t.work=!0),e.VOICE&&(t.voice=!0),e.FAX&&(t.fax=!0),e.PAGER&&(t.pager=!0),e.MSG&&(t.msg=!0),e.CELL&&(t.cell=!0),e.VIDEO&&(t.video=!0),e.BBS&&(t.bbs=!0),e.MODEM&&(t.modem=!0),e.ISDN&&(t.isdn=!0),e.PCS&&(t.pcs=!0),e.PREF&&(t.pref=!0),t}_extractAddress(e){const t={};return"string"==typeof e.POBOX&&(t.poBox=e.POBOX),"string"==typeof e.EXTADD&&(t.extraAddress=e.EXTADD),"string"==typeof e.STREET&&(t.street=e.STREET),"string"==typeof e.LOCALITY&&(t.locality=e.LOCALITY),"string"==typeof e.REGION&&(t.locality=e.REGION),"string"==typeof e.PCODE&&(t.locality=e.PCODE),"string"==typeof e.CTRY&&(t.locality=e.CTRY),e.WORK&&(t.work=!0),e.HOME&&(t.home=!0),e.POSTAL&&(t.postal=!0),e.PARCEL&&(t.parcel=!0),e.DOM&&(t.dom=!0),e.INTL&&(t.intl=!0),e.PREF&&(t.pref=!0),t}initFromXML(e){const t={};"string"==typeof e.VERSION&&(t.version=e.VERSION),"string"==typeof e.FN&&(t.fullName=e.FN),"object"!=typeof e.N||Array.isArray(e.N)||(t.name={},"string"==typeof e.N.FAMILY&&(t.name.family=e.N.FAMILY),"string"==typeof e.N.GIVEN&&(t.name.given=e.N.GIVEN),"string"==typeof e.N.MIDDLE&&(t.name.middle=e.N.MIDDLE),"string"==typeof e.N.PREFIX&&(t.name.prefix=e.N.PREFIX),"string"==typeof e.N.SUFFIX&&(t.name.suffix=e.N.SUFFIX)),"string"==typeof e.NICKNAME&&(t.nickName=e.NICKNAME),"object"!=typeof e.PHOTO||Array.isArray(e.PHOTO)||(t.photo={},"string"==typeof e.PHOTO.TYPE&&(t.photo.type=e.PHOTO.TYPE),"string"==typeof e.PHOTO.BINVAL&&(t.photo.binval=e.PHOTO.BINVAL)),"string"==typeof e.BDAY&&(t.birthday=e.BDAY),"object"==typeof e.ADR&&(t.address=[],Array.isArray(e.ADR)?e.ADR.forEach(e=>{t.address.push(this._extractAddress(e))}):t.address.push(this._extractAddress(e.ADR))),"object"==typeof e.TEL&&(t.telephone=[],Array.isArray(e.TEL)?e.TEL.forEach(e=>{t.telephone.push(this._extractTelephone(e))}):t.telephone.push(this._extractTelephone(e.TEL))),"object"==typeof e.EMAIL&&(t.email=[],Array.isArray(e.EMAIL)?e.EMAIL.forEach(e=>{t.email.push(this._extractEmail(e))}):t.email.push(this._extractEmail(e.EMAIL))),"string"==typeof e.JABBERID&&(t.jabberId=e.JABBERID),"string"==typeof e.MAILER&&(t.mailer=e.MAILER),"string"==typeof e.TZ&&(t.timeZone=e.TZ),"object"!=typeof e.GEO||Array.isArray(e.GEO)||(t.geolocation={},"string"==typeof e.GEO.LAT&&(t.geolocation.lat=e.GEO.LAT),"string"==typeof e.GEO.LON&&(t.geolocation.lng=e.N.GIVEN)),"string"==typeof e.TITLE&&(t.title=e.TITLE),"string"==typeof e.ROLE&&(t.role=e.ROLE),"object"!=typeof e.LOGO||Array.isArray(e.LOGO)||(t.logo={},"string"==typeof e.LOGO.TYPE&&(t.logo.type=e.PHOTO.TYPE),"string"==typeof e.PHOTO.BINVAL&&(t.logo.binval=e.PHOTO.BINVAL),"string"==typeof e.PHOTO.EXTVAL&&(t.logo.extval=e.PHOTO.EXTVAL)),"object"!=typeof e.AGENT||Array.isArray(e.AGENT)||(t.agent={},"string"==typeof e.AGENT.EXTVAL&&(t.agent.extval=e.AGENT.EXTVAL)),"object"!=typeof e.ORG||Array.isArray(e.ORG)||(t.organisation={},"string"==typeof e.ORG.ORGNAME&&(t.organisation.name=e.ORG.ORGNAME),"string"==typeof e.ORG.ORGUNIT&&(t.organisation.unit=e.ORG.ORGUNIT)),"object"==typeof e.CATEGORIES&&(t.categories=[],Array.isArray(e.CATEGORIES)?e.CATEGORIES.forEach(e=>{t.categories.push({keyword:e.KEYWORD})}):t.telephone.push({keyword:e.CATEGORIES.KEYWORD})),"string"==typeof e.NOTE&&(t.note=e.NOTE),"string"==typeof e.PRODID&&(t.prodid=e.PRODID),"string"==typeof e.REV&&(t.rev=e.REV),"string"==typeof e["SORT-STRING"]&&(t.sortString=e["SORT-STRING"]),"object"!=typeof e.SOUND||Array.isArray(e.SOUND)||(t.sound={},"string"==typeof e.SOUND.PHONETIC&&(t.sound.phonetic=e.SOUND.PHONETIC),"string"==typeof e.SOUND.BINVAL&&(t.sound.binval=e.SOUND.BINVAL),"string"==typeof e.SOUND.EXTVAL&&(t.sound.extval=e.SOUND.EXTVAL)),"string"==typeof e.UID&&(t.uid=e.UID),"string"==typeof e.URL&&(t.url=e.URL),"string"==typeof e.DESC&&(t.description=e.DESC),"object"!=typeof e.CLASS||Array.isArray(e.CLASS)||(e.CLASS.PUBLIC&&(t.classification="public"),e.CLASS.PRIVATE&&(t.classification="private"),e.CLASS.CONFIDENTIAL&&(t.classification="confidential")),"object"!=typeof e.KEY||Array.isArray(e.KEY)||(t.key={},"string"==typeof e.KEY.CRED&&(t.key.credential=e.KEY.CRED),"string"==typeof e.KEY.TYPE&&(t.key.type=e.KEY.TYPE)),this.json=t}initFromJSON(e){this.json=e}toJSON(){return this.json}toXML(e){const t=(new DOMParser).parseFromString('<vCard xmlns="vcard-temp"/>',"text/xml"),n=t.firstElementChild;if(this.json.fullName&&this.addNode(n,"FN",this.json.fullName),this.json.name){const e=this.addNode(n,"N");this.json.name.family&&this.addNode(e,"FAMILY",this.json.name.family),this.json.name.given&&this.addNode(e,"GIVEN",this.json.name.given),this.json.name.middle&&this.addNode(e,"MIDDLE",this.json.name.middle),this.json.name.prefix&&this.addNode(e,"PREFIX",this.json.name.prefix),this.json.name.suffix&&this.addNode(e,"SUFFIX",this.json.name.suffix)}if(this.json.nickName&&this.addNode(n,"NICKNAME",this.json.nickName),this.json.photo){const e=this.addNode(n,"PHOTO");this.json.photo.type&&this.addNode(e,"TYPE",this.json.photo.type),this.json.photo.binval&&this.addNode(e,"BINVAL",this.json.photo.binval)}if(this.json.birthday&&this.addNode(n,"BDAY",this.json.birthday),this.json.address&&this.json.address.forEach(e=>{const t=this.addNode(n,"ADR");e.home&&this.addNode(t,"HOME"),e.work&&this.addNode(t,"WORK"),e.postal&&this.addNode(t,"POSTAL"),e.parcel&&this.addNode(t,"PARCEL"),e.dom&&this.addNode(t,"DOM"),e.intl&&this.addNode(t,"INTL"),e.pref&&this.addNode(t,"PREF"),e.poBox&&this.addNode(t,"POBOX",e.poBox),e.extraAddress&&this.addNode(t,"EXTADD",e.extraAddress),e.street&&this.addNode(t,"STREET",e.street),e.locality&&this.addNode(t,"LOCALITY",e.locality),e.region&&this.addNode(t,"REGION",e.region),e.postcode&&this.addNode(t,"PCODE",e.postcode),e.country&&this.addNode(t,"CTRY",e.country)}),this.json.telephone&&this.json.telephone.forEach(e=>{const t=this.addNode(n,"TEL");e.home&&this.addNode(t,"HOME"),e.work&&this.addNode(t,"WORK"),e.voice&&this.addNode(t,"VOICE"),e.fax&&this.addNode(t,"FAX"),e.pager&&this.addNode(t,"PAGER"),e.msg&&this.addNode(t,"MSG"),e.cell&&this.addNode(t,"CELL"),e.video&&this.addNode(t,"VIDEO"),e.bbs&&this.addNode(t,"BBS"),e.modem&&this.addNode(t,"MODEM"),e.isdn&&this.addNode(t,"ISDN"),e.pcs&&this.addNode(t,"PCS"),e.pref&&this.addNode(t,"PREF"),e.number&&this.addNode(t,"NUMBER",e.number)}),this.json.email&&this.json.email.forEach(e=>{const t=this.addNode(n,"EMAIL");e.home&&this.addNode(t,"HOME"),e.work&&this.addNode(t,"WORK"),e.internet&&this.addNode(t,"INTERNET"),e.pref&&this.addNode(t,"PREF"),e.x400&&this.addNode(t,"X400"),e.address&&this.addNode(t,"USERID",e.address)}),this.json.jabberId&&this.addNode(n,"JABBERID",this.json.jabberId),this.json.mailer&&this.addNode(n,"MAILER",this.json.mailer),this.json.timeZone&&this.addNode(n,"TZ",this.json.timeZone),this.json.geolocation){const e=this.addNode(n,"GEO");this.json.geolocation.lat&&this.addNode(e,"LAT",this.json.geolocation.lat),this.json.geolocation.lng&&this.addNode(e,"LON",this.json.geolocation.lng)}if(this.json.title&&this.addNode(n,"TITLE",this.json.title),this.json.role&&this.addNode(n,"ROLE",this.json.role),this.json.logo){const e=this.addNode(n,"LOGO");this.json.logo.type&&this.addNode(e,"TYPE",this.json.logo.type),this.json.logo.binval&&this.addNode(e,"BINVAL",this.json.logo.binval),this.json.logo.extval&&this.addNode(e,"EXTVAL",this.json.logo.extval)}if(this.json.organisation){const e=this.addNode(n,"ORG");this.json.organisation.name&&this.addNode(e,"ORGNAME",this.json.organisation.name),this.json.organisation.unit&&this.addNode(e,"ORGUNIT",this.json.organisation.unit)}if(this.json.categories&&this.json.categories.forEach(e=>{const t=this.addNode(n,"CATEGORIES");e.keyword&&this.addNode(t,"KEYWORD",e.keyword)}),this.json.note&&this.addNode(n,"NOTE",this.json.note),this.json.productId&&this.addNode(n,"PRODID",this.json.productId),this.json.lastRevised&&this.addNode(n,"REV",this.json.lastRevised),this.json.sortString&&this.addNode(n,"SORT-STRING",this.json.sortString),this.json.sound){const e=this.addNode(n,"SOUND");this.json.sound.phonetic&&this.addNode(e,"PHONETIC",this.json.sound.phonetic),this.json.sound.extval&&this.addNode(e,"EXTVAL",this.json.sound.extval),this.json.sound.binval&&this.addNode(e,"BINVAL",this.json.sound.binval)}if(this.json.uid&&this.addNode(n,"UID",this.json.uid),this.json.url&&this.addNode(n,"URL",this.json.url),this.json.description&&this.addNode(n,"DESC",this.json.description),this.json.classification){const e=this.addNode(n,"CLASS");"public"===this.json.classification&&this.addNode(e,"PUBLIC"),"private"===this.json.classification&&this.addNode(e,"PRIVATE"),"confidential"===this.json.classification&&this.addNode(e,"CONFIDENTIAL")}if(this.json.key){const e=this.addNode(n,"KEY");this.json.key.credential&&this.addNode(e,"CRED",this.json.key.credential),this.json.key.type&&this.addNode(e,"TYPE",this.json.key.type)}let i="";if(e)i=(new XMLSerializer).serializeToString(t);else{const e=t.children[0];for(let t=0;t<e.childElementCount;t++){i+=(new XMLSerializer).serializeToString(e.childNodes.item(t))}}return i}addNode(e,t,n){const i=e.ownerDocument.createElement(t);return e.appendChild(i),void 0!==n&&(i.textContent=n),i}}t.VCardSimple=i},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});
/*! Copyright (c) 2018 CommonTime Ltd */
const o=n(29),s=n(103),r=n(33),a=n(14),l=n(19),c=n(0),d=n(5);t.BaseComms=class{constructor(e,t,n,i){this._firstConnectionInitialized=!1,this._loggingIn=!1,this._loginTimeout=null,this._clientName=e;const s={debug:i.getTypesAsEnumValues().includes(l.LoggerTypes.XmppClient),mucHost:t.mucHost,mam:{auto:t.mam&&!0===t.mam.autoFetch||!1,defaultTimeLimit:t.maxMessageAge||0,pageSize:500},autoLogin:void 0===t.autoLogin||t.autoLogin,autoReconnect:void 0===t.autoReconnect||t.autoReconnect,enablePing:!1!==t.enablePing,pingInterval:t.pingInterval||5e3,pingTimeout:t.pingTimeout||1e4,multicastHost:t.multicastHost,uploadHost:t.uploadHost,autoMarkMessages:t.useChatMarkers,autoPurgeOldMessagesAge:t.maxMessageAge||0,encryption:t.encryption||!1,fileEncryption:t.fileEncryption||!1,authAttachments:!0===t.authAttachments,streamResumption:!1!==t.streamResumption,useEncodedJidAsResource:t.user&&!0===t.user.userPersistentResource||!1,adSpn:t.adSpn||null,adSecurityPackage:t.adSecurityPackage||null,push:t.push||{androidEnabled:!1,iosEnabled:!0},updateUserDirectoryOnLogin:t.updateUserDirectoryOnLogin||null,enableMessageCarbons:t.enableMessageCarbons||!1,bringToForegroundOnVoipPush:void 0!==t.bringToForegroundOnVoipPush?t.bringToForegroundOnVoipPush:null,updateUserDirectoryInterval:t.updateUserDirectoryInterval||18e5,alwaysSendPresence:t.alwaysSendPresence,sleepingBeauty:t.sleepingBeauty,customerVersion:t.customerVersion,customerLabel:t.customerLabel,maxReconnectBackoff:t.maxReconnectBackoff||3e3};t.sso&&t.sso.adfs&&t.sso.adfs.enabled&&(s.sso={},s.sso.enabled=!0,s.sso.discovery=t.sso.adfs.discovery,s.sso.clientId=t.sso.adfs.clientId,s.sso.scopes=t.sso.adfs.scopes,s.sso.port=t.sso.adfs.port),t.push&&(s.push=t.push),t.adTokenPlaceholder&&(s.adTokenPlaceholder=t.adTokenPlaceholder),this.client=new o.CtXmppClient(this._clientName,t.endpoint,s),this.store=n,this.logger=i,this.xmppConfig=t,this._localEventHandlers={},this._setupCommonHandlers()}onInitialized(e){this.client.addEventListener(o.CtXmppClient.EVENT_TYPES.INITIALISED,()=>{e()})}onLogin(e){void 0===this._localEventHandlers["comms-login"]&&(this._localEventHandlers["comms-login"]=[]),this._localEventHandlers["comms-login"].push(e)}onLogout(e){void 0===this._localEventHandlers["comms-logout"]&&(this._localEventHandlers["comms-logout"]=[]),this._localEventHandlers["comms-logout"].push(e)}onNewMessage(e){this.client.addEventListener(o.CtXmppClient.EVENT_TYPES.NEW_MESSAGE,t=>{e(Object.assign({},t))})}onMessageUpdate(e){this.client.addEventListener(o.CtXmppClient.EVENT_TYPES.MESSAGE_UPDATED,t=>{e(Object.assign({},t))})}onChatMarkerUpdate(e){this.client.addEventListener(o.CtXmppClient.EVENT_TYPES.RECEIPT_RECEIVED,t=>{e(Object.assign({},t))})}onStatusUpdate(e){this.client.addEventListener(o.CtXmppClient.EVENT_TYPES.STATUS,t=>{this.resetServerVersion();let n=c.ConnectionStatus.Disconnected,i=null;switch(t.id){case s.default.Strophe.Status.CONNFAIL:n=c.ConnectionStatus.Disconnected,i=new c.DisconnectionStatus(t.wontReconnect,t.reason);break;case s.default.Strophe.Status.AUTHFAIL:n=c.ConnectionStatus.Disconnected,i=new c.DisconnectionStatus(!1,t.reason);break;case s.default.Strophe.Status.ERROR:n=c.ConnectionStatus.Disconnected,i=new c.DisconnectionStatus(t.wontReconnect,t.reason);break;case s.default.Strophe.Status.CONNECTING:case s.default.Strophe.Status.AUTHENTICATING:n=c.ConnectionStatus.Connecting;break;case s.default.Strophe.Status.CONNECTED:n=c.ConnectionStatus.Connected;break;case s.default.Strophe.Status.DISCONNECTING:n=c.ConnectionStatus.Disconnecting;break;case s.default.Strophe.Status.DISCONNECTED:n=c.ConnectionStatus.Disconnected,i=new c.DisconnectionStatus(t.wontReconnect,t.reason),document.dispatchEvent(new CustomEvent("__cm-connection-change",{detail:n}));break;default:c.ConnectionStatus.Disconnected}e(n,t.reconnectTime,i)})}onPresenceUpdate(e){this.client.addEventListener(o.CtXmppClient.EVENT_TYPES.PRESENCE_UPDATE,t=>{e(t)})}onRoomNewParticipant(e){this.client.addEventListener(o.CtXmppClient.EVENT_TYPES.NEW_PARTICIPANT,t=>{e(Object.assign({},t))})}onRoomParticipantUpdate(e){this.client.addEventListener(o.CtXmppClient.EVENT_TYPES.PARTICIPANT_UPDATED,t=>{e(Object.assign({},t))})}onError(e){this.client.addEventListener(o.CtXmppClient.EVENT_TYPES.ERROR,t=>{e(t)})}onStartFetchingMissedMessages(e){const t="missed-messages-start";void 0===this._localEventHandlers[t]&&(this._localEventHandlers[t]=[]),this._localEventHandlers[t].push(e)}onFinishedFetchingMissedMessages(e){const t="missed-messages-finished";void 0===this._localEventHandlers[t]&&(this._localEventHandlers[t]=[]),this._localEventHandlers[t].push(e)}onAutoReconnected(e){this.client.addEventListener(o.CtXmppClient.EVENT_TYPES.AUTO_RECONNECTED,t=>{this.getServerVersion(),e(t)})}onDatabasesAutoDestroyed(e){this.client.addEventListener(o.CtXmppClient.EVENT_TYPES.AUTO_DBS_DESTROYED,()=>{e()})}getSyncedTimestamp(e){const t=null===e||void 0===e?(new Date).getTime():e;return this.client.getSyncedTimestamp(t)}getCurrentUserResource(){return this.client.resource}getConnectionStatus(){return this.status}setConnectionStatus(e){this.status=e}sso(e=!0){return i(this,void 0,void 0,function*(){return new Promise((t,n)=>i(this,void 0,void 0,function*(){this._loggingIn=!0;try{yield this.client.sso(),this.checkTimeSync(!1),e&&this.triggerLoginEvent(!0),this._loggingIn=!1,t()}catch(t){this.logger.log(l.LoggerTypes.Connectivity,t),this._loggingIn=!1,e&&this.triggerLoginEvent(!1,t.msg),yield this.client.logout(!0),n(t)}}))})}login(e,t,n=!0){return i(this,void 0,void 0,function*(){return!0===this._loggingIn?Promise.reject(new Error("Login currently in progress, please wait.")):new Promise((o,s)=>i(this,void 0,void 0,function*(){try{let r=t;!0===this.xmppConfig.user.sendAppIdentifier&&(r=`app_id~${this.xmppConfig.user.appIdentifier}~${t}`),this._loggingIn=!0,clearTimeout(this._loginTimeout);const a=this.xmppConfig.loginTimeout||1e4;this._loginTimeout=setTimeout(()=>i(this,void 0,void 0,function*(){clearTimeout(this._loginTimeout),yield this.logout(!0,!0),this.logger.log(l.LoggerTypes.Connectivity,"%c LOGIN TIMED OUT","color: #600; font-weight: bold;"),s(new Error(`Logging in took longer than ${Math.floor(a/1e3)} seconds. Please check your connectivity and try again.`))}),a),this.xmppConfig.user&&!0===this.xmppConfig.user.forceLowercaseJid&&(e=e.toLowerCase()),this.logger.log(l.LoggerTypes.Connectivity,`%c ATTEMPTING LOGIN > %c${e}`,"color: #669; font-weight: bold;","color: #999; font-weight: normal;"),this.username=e,yield this.client.login(e,r),this.checkTimeSync(!1),n&&this.triggerLoginEvent(!0),clearTimeout(this._loginTimeout),this._loggingIn=!1,o()}catch(t){clearTimeout(this._loginTimeout),this._loggingIn=!1,this.logger.log(l.LoggerTypes.Connectivity,`%c LOGIN FAILED > %c${e}`,"color: #600; font-weight: bold;","color: #999; font-weight: normal;"),this.username="",n&&this.triggerLoginEvent(!1,t.msg),s(t)}}))})}logout(e=!1,t=!0){return i(this,void 0,void 0,function*(){try{this.logger.log(l.LoggerTypes.Connectivity,`%c LOGGING OUT > %c${this.username}`,"color: #669; font-weight: bold;","color: #999; font-weight: normal;"),this._loggingIn=!1,this._firstConnectionInitialized=!1,yield this.client.logout(e),this.username="",t&&this.triggerLogoutEvent(!0)}catch(e){this.logger.log(l.LoggerTypes.Connectivity,`%c LOGOUT FAILED > %c${this.username}`,"color: #600; font-weight: bold;","color: #999; font-weight: normal;"),t&&this.triggerLogoutEvent(!1)}})}attemptReconnect(){this.client.reLoginNow()}joinRoom(e){return i(this,void 0,void 0,function*(){yield this._joinOrLeaveRoom(e)})}leaveRoom(e){return i(this,void 0,void 0,function*(){yield this._joinOrLeaveRoom(e,!0)})}setClientStateActive(e){return i(this,void 0,void 0,function*(){const t=e?o.CtXmppClient.CLIENT_STATES.ACTIVE:o.CtXmppClient.CLIENT_STATES.INACTIVE;this.client.setClientState(t)})}getUniqueId(){return this.client.getUniqueId()}sendMessage(e,t,n=[]){return i(this,void 0,void 0,function*(){if(!e)throw new Error("No recipient specified");if(this.status!==c.ConnectionStatus.Connected)throw new Error("Unable to send message: not currently connected");const i=yield this.client.sendChatMessage(e,null,t,n);return this.logger.shouldLog(l.LoggerTypes.MessageSent)&&this.logger.log(l.LoggerTypes.MessageSent,`%c MESSAGE SENT: %c${e} >`,"color: #600; font-weight: bold;","color: #999; font-weight: normal;",d.getMessageContentForDebug(i)),i})}sendRoomMessage(e,t=null,n=null,o=[],s=!0,r=null){return i(this,void 0,void 0,function*(){if(!e)throw new Error("No room name specified");if(this.status!==c.ConnectionStatus.Connected)throw new Error("Unable to send room message: not currently connected");const i=yield this.client.sendGroupChatMessage(e,t,n,o,s,!1,r);return this.logger.shouldLog(l.LoggerTypes.MessageSent)&&this.logger.log(l.LoggerTypes.MessageSent,`%c ROOM MESSAGE SENT: %c${e} >`,"color: #600; font-weight: bold;","color: #999; font-weight: normal;",d.getMessageContentForDebug(i)),i})}sendMulticastMessage(e,t,n=[]){return i(this,void 0,void 0,function*(){if(this.status!==c.ConnectionStatus.Connected)throw new Error("Unable to multicast message: not currently connected");const i=yield this.client.sendMulticastMessage(e,null,t,n);if(this.logger.shouldLog(l.LoggerTypes.MessageSent)){const t=JSON.stringify(e);this.logger.log(l.LoggerTypes.MessageSent,`%c MUTILCAST MESSAGE SENT: %c${t} >`,"color: #600; font-weight: bold;","color: #999; font-weight: normal;",d.getMessageContentForDebug(i))}return i})}sendIq(e,t,n,s=null){return i(this,void 0,void 0,function*(){if(!e)throw new Error("No recipient specified");if(!t)throw new Error("No type specified");if(this.status!==c.ConnectionStatus.Connected)throw new Error("Unable to send IQ: not currently connected");const i=Object.keys(n)[0];this.logger.shouldLog(l.LoggerTypes.MessageSent)&&this.logger.log(l.LoggerTypes.MessageSent,`%c IQ SENT: %c${i} >`,"color: #906; font-weight: bold;","color: #999; font-weight: normal;",{iq:n});try{const a=yield this.client.sendIq(e,t,n,25e3,void 0,s);return this.logger.shouldLog(l.LoggerTypes.MessageSent)&&this.logger.log(l.LoggerTypes.MessageSent,`%c IQ RESPONSE: %c${i} >`,"color: #906; font-weight: bold;","color: #999; font-weight: normal;",Object.assign({},a)),a.iq}catch(e){const t=o.CtXmppClient.xmlToJson(e),n=t&&t.iq&&t.iq.error&&t.iq.error.text&&t.iq.error.text.$value||"";throw this.logger.log(l.LoggerTypes.MessageSent,`%c IQ ERROR: %c${i} > ${n}`,"color: #C00; font-weight: bold;","color: #999; font-weight: normal;",Object.assign({},t)),new r.IQError(n,t.iq)}})}sendBotCommand(e,t){return i(this,void 0,void 0,function*(){if(this.status!==c.ConnectionStatus.Connected)throw new Error(`Unable to send bot command "${e}": not currently connected`);if(!this.xmppConfig.bot)throw new Error("No bot configured in XmppConfig");const n=this.xmppConfig.bot.componentJid;if(!n)throw new Error("Unable to issue bot command; no bot component jid configured");if(void 0!==t&&null!==t){const n=Object.assign({},t);e in n&&(n[e]=JSON.parse(n[e])),this.logger.log(l.LoggerTypes.MessageSent,`%c BOT COMMAND SENT: %c${e} >`,"color: #600; font-weight: bold;","color: #999; font-weight: normal;",{data:n})}else this.logger.log(l.LoggerTypes.MessageSent,`%c BOT COMMAND SENT: %c${e}`,"color: #600; font-weight: bold;","color: #999; font-weight: normal;");try{const i=yield this.client.sendBotCommand(n,e,t,this.xmppConfig.bot.timeout);return this.logger.log(l.LoggerTypes.MessageSent,`%c BOT RESPONSE: %c${e} > ${i.success?"success":"fail"}`,"color: #600; font-weight: bold;","color: #999; font-weight: normal;",{data:i.data||null}),i}catch(e){const t="Server connections to local subdomains are forbidden"===e?`Unable to connect to bot: ${n}`:e.message||e;throw new Error(t)}})}deleteMessageById(e,t=!0){return i(this,void 0,void 0,function*(){yield this.client.deleteMessageById(e,t)})}deleteMessageByRoomName(e){return i(this,void 0,void 0,function*(){yield this.client.deleteMessagesByRoomName(e)})}updateStatus(e,t,n=!1,o){return i(this,void 0,void 0,function*(){const i=yield this.client.setChatStatus(e,t,n,o);if(this.logger.shouldLog(l.LoggerTypes.Status)){const e=JSON.stringify(i);this.logger.log(l.LoggerTypes.Status,`%c STATUS UPDATED: %c${e}`,"color: #669; font-weight: bold;","color: #999; font-weight: normal;")}return i})}listParticipantsByRoom(e){return i(this,void 0,void 0,function*(){return(yield this.client.listParticipantsByRoom(e)).map(e=>this._participantToUser(e))})}getParticipantByRoomAndJid(e,t){return i(this,void 0,void 0,function*(){const n=yield this.client.getParticipantByRoomAndJid(e,t);return n?this._participantToUser(n):null})}getAllContacts(){return i(this,void 0,void 0,function*(){return(yield this.client.getContacts()).map(e=>this._xmppContactToUser(e)).filter(e=>null!==e)})}getAllGroups(){return i(this,void 0,void 0,function*(){return this.client.getAllGroups()})}getUserByJid(e){return i(this,void 0,void 0,function*(){const t=yield this.client.getUserByJid(e);return t?yield this._directoryUserToUser(t):null})}updateUserDirectory(){return i(this,void 0,void 0,function*(){yield this.client.updateUserDirectory()})}updateDirectoryAccount(e,t,n=!0){return i(this,void 0,void 0,function*(){return this.client.updateAccount(e,t,n)})}saveUserDirectory(){return i(this,void 0,void 0,function*(){yield this.client.saveUserIndex()})}searchUsers(e="",t=[],n=!1,o=!0){return i(this,void 0,void 0,function*(){const i=void 0!==e&&null!==e&&e.length>0?yield this.client.searchUsers(e,t,n,o):yield this.client.getAllUsers(!1,n),s=[];for(const e of i)null!==e&&s.push(this._directoryUserToUser(e));return s})}searchRoles(e="",t=[]){return i(this,void 0,void 0,function*(){const n=void 0!==e&&null!==e&&e.length>0?yield this.client.searchRoles(e,t):yield this.client.getAllRoles(!1),i=[];for(const e of n)null!==e&&i.push(this._directoryUserToUser(e));return i})}searchGroups(e=""){return i(this,void 0,void 0,function*(){return void 0!==e&&null!==e&&e.length>0?yield this.client.searchGroups(e):yield this.client.getAllGroups()})}getAllUsers(e=!1,t=!1){return i(this,void 0,void 0,function*(){return(yield this.client.getAllUsers(e,t)).map(e=>this._directoryUserToUser(e)).sort()})}getAllUsersInGroup(e,t=!0){return i(this,void 0,void 0,function*(){return(yield this.client.getAllUsersInGroup(e,!0,!1,t)).map(e=>this._directoryUserToUser(e)).sort()})}markMessageRead(e){return i(this,void 0,void 0,function*(){if(!this.xmppConfig.useChatMarkers)return;const t=yield this.client.getMessageById(e);t&&!t.mine&&t.markable&&(t.state.markers.some(e=>"read"===e.type&&e.sender_resource&&e.sender_resource.toLowerCase()===this.username.split("@")[0].toLowerCase()||e.sender_id.toLowerCase()===this.username.toLowerCase())||(yield this.client.markMessageRead(t)))})}getChatHistory(e){return i(this,void 0,void 0,function*(){return yield this.client.getChatHistory(e)})}queryMam(e,t,n,o,s=!0){return i(this,void 0,void 0,function*(){return yield this.client.queryMam(e,t,n,o,s)})}processXmlStanzaStringsFromMam(e,t=!0){return i(this,void 0,void 0,function*(){return yield this.client.processXmlStanzaStringsFromMam(e,t)})}clearAllData(e=!1){return i(this,void 0,void 0,function*(){yield this.client.destroyDbs(!1,e)})}createPushNotificationRegistration(e){return i(this,void 0,void 0,function*(){const t=this._generatePushNotificationPayload(e.platform,e.channelUri,e.azureId);return yield this.client.sendIq("push.localhost","set",t)})}checkTimeSync(e=!0){const t=(new Date).getTime(),n=this.getSyncedTimestamp(t),i=Math.abs(n-t),o=i<1e4,s=o?"#666":"#F00",r=o?"#999":"#F00",a=e?console.log:o?()=>{}:console.log;if(a.call(console.log,`%c CLIENT TIME: %c${new Date(t).toTimeString()}`,"color: #666; font-weight: bold;","color: #999; font-weight: normal;"),a.call(console.log,`%c SERVER TIME: %c${new Date(n).toTimeString()}`,"color: #666; font-weight: bold;","color: #999; font-weight: normal;"),i){const e=Math.floor(i/36e5%24),o=Math.floor(i/6e4%60),l=Math.floor(i/1e3%60),c=Math.floor(i%1e3);let d="";e>0&&(d+=`${e}h `),o>0&&(d+=`${o}m `),l>0&&(d+=`${l}s `),c>0&&(d+=`${c}ms `),t>n?a.call(console.log,`%c TIME SYNC: %cClient is %c${d.trim()} ahead %cof server`,`color: ${s}; font-weight: bold;`,`color: ${r}; font-weight: normal;`,`color: ${r}; font-weight: bold;`,`color: ${r}; font-weight: normal;`):a.call(console.log,`%c TIME SYNC: %cClient is %c${d.trim()} behind %cserver`,`color: ${s}; font-weight: bold;`,`color: ${r}; font-weight: normal;`,`color: ${r}; font-weight: bold;`,`color: ${r}; font-weight: normal;`)}else a.call(console.log,"%c TIME SYNC: %cClient and server times are identical","color: #666; font-weight: bold;","color: #999; font-weight: normal;")}updateVCardForUser(e){return i(this,void 0,void 0,function*(){if(this.username&&this.username===e)return null;yield this.client.updatevCardForContact(e)})}getOurVCard(){return i(this,void 0,void 0,function*(){try{return yield this.client.getOurvCard()}catch(e){return null}})}downloadMessageAttachments(e){return i(this,void 0,void 0,function*(){const t=yield this.client.getMessageById(e);t&&(yield this.client.downloadAttachments(t,!0))})}downloadFile(e,t=!1,n){return i(this,void 0,void 0,function*(){return(yield this.client.doDownload(e)).source||null})}getServerVersion(){return i(this,void 0,void 0,function*(){this.serverVersion=yield this.client.getServerVersion()})}resetServerVersion(){return i(this,void 0,void 0,function*(){this.serverVersion=null})}uploadFile(e){return i(this,void 0,void 0,function*(){try{return yield this.client.uploadAttachment(e)}catch(t){throw this.logger.log(l.LoggerTypes.MessageSent,`%c UPLOAD ERROR: %c$Unable to upload file > ${t}`,"color: #C00; font-weight: bold;","color: #999; font-weight: normal;",e),new Error("Unable to upload attachment")}})}initializeFirstConnection(){return i(this,void 0,void 0,function*(){})}buildCurrentUser(e){return i(this,void 0,void 0,function*(){const t=e.split("@").shift(),n={id:e,jid:e,username:t,firstName:"",lastName:"",connectionStatus:this.getConnectionStatus()},i=yield this.getOurVCard();return yield this.embelishUser(n,i,c.UserAdditionalDetailsType.VCard)})}triggerLoginEvent(e,t){this._fireLocalEventHandlers("comms-login",new a.CommsEventArgs(e,t))}triggerLogoutEvent(e,t){this._fireLocalEventHandlers("comms-logout",new a.CommsEventArgs(e,t))}triggerFetchingMissedMessagesState(e){e?this._fireLocalEventHandlers("missed-messages-start"):this._fireLocalEventHandlers("missed-messages-finished")}_setupCommonHandlers(){this.client.addEventListener(o.CtXmppClient.EVENT_TYPES.NEW_MESSAGE,e=>i(this,void 0,void 0,function*(){this.logger.shouldLog(l.LoggerTypes.MessageReceived)&&this.logger.log(l.LoggerTypes.MessageReceived,"%c MESSAGE RECEIVED:%c","color: #060; font-weight: bold;","color: #999; font-weight: normal;",d.getMessageContentForDebug(e))})),this.client.addEventListener(o.CtXmppClient.EVENT_TYPES.MESSAGE_UPDATED,e=>{this.logger.shouldLog(l.LoggerTypes.MessageUpdated)&&this.logger.log(l.LoggerTypes.MessageUpdated,"%c MESSAGE UPDATED:%c","color: #060; font-weight: bold;","color: #999; font-weight: normal;",d.getMessageContentForDebug(e))}),this.client.addEventListener(o.CtXmppClient.EVENT_TYPES.RECEIPT_RECEIVED,e=>{if(this.logger.shouldLog(l.LoggerTypes.MessageChatMarker)){const t=e.sender_resource.split("@").shift();this.logger.log(l.LoggerTypes.MessageChatMarker,`%c CHAT MARKER RECEIVED: %c${t} > ${e.type}`,"color: #669; font-weight: bold;","color: #999; font-weight: normal;")}}),this.client.addEventListener(o.CtXmppClient.EVENT_TYPES.STATUS,e=>i(this,void 0,void 0,function*(){const t=c.ConnectionStatus[e.label];if(this.setConnectionStatus(t),t===c.ConnectionStatus.Connected&&(this.username=this.client.bareJid,!1===this._firstConnectionInitialized&&(yield this.initializeFirstConnection(),this._firstConnectionInitialized=!0)),this.logger.shouldLog(l.LoggerTypes.Connectivity)){const n=e.reconnectTime?` - reconnect attempt in ${e.reconnectTime/1e3} second(s)`:"";this.logger.log(l.LoggerTypes.Connectivity,`%c CONNECTIVITY CHANGE: %c${t}${n}`,"color: #669; font-weight: bold;","color: #999; font-weight: normal;")}})),this.client.addEventListener(o.CtXmppClient.EVENT_TYPES.NEW_PARTICIPANT,e=>i(this,void 0,void 0,function*(){if(e.jid&&this.logger.shouldLog(l.LoggerTypes.Participation)){const t=this._participantToUser(e);this.logger.log(l.LoggerTypes.Participation,`%c NEW PARTICIPANT: %c${t.username} > ${t.connectionStatus}`,"color: #006; font-weight: bold;","color: #999; font-weight: normal;",{participant:e})}})),this.client.addEventListener(o.CtXmppClient.EVENT_TYPES.PARTICIPANT_UPDATED,e=>i(this,void 0,void 0,function*(){if(e.jid&&this.logger.shouldLog(l.LoggerTypes.Participation)){const t=this._participantToUser(e);this.logger.log(l.LoggerTypes.Participation,`%c PARTICIPANT UPDATED: %c${t.username} > ${t.connectionStatus}`,"color: #006; font-weight: bold;","color: #999; font-weight: normal;",{participant:e})}})),this.client.addEventListener(o.CtXmppClient.EVENT_TYPES.PRESENCE_UPDATE,e=>i(this,void 0,void 0,function*(){if(e.id&&this.logger.shouldLog(l.LoggerTypes.Presence)){const t=this._xmppContactToUser(e);t?this.logger.log(l.LoggerTypes.Presence,`%c PRESENCE UPDATED: %c${t.username} > ${t.connectionStatus}`,"color: #006; font-weight: bold;","color: #999; font-weight: normal;"):this.logger.error(l.LoggerTypes.Presence,"%c PRESENCE UPDATED FOR UNKNOWN CONTACT:","color: #006; font-weight: bold;",{contact:e})}})),this.client.addEventListener(o.CtXmppClient.EVENT_TYPES.ERROR,e=>{this.logger.error("%c ERROR:","color: #C00; font-weight: bold;","\r\n\t",e)}),this.client.addEventListener(o.CtXmppClient.EVENT_TYPES.AUTO_RECONNECTED,({resumed:e})=>i(this,void 0,void 0,function*(){if(this.logger.shouldLog(l.LoggerTypes.Connectivity)){const t=!0===e?" - STREAM RESUMED":"";this.logger.log(l.LoggerTypes.Connectivity,`%c AUTO RECONNECTED AFTER DISCONNECT${t}`,"color: #669; font-weight: bold;")}})),this.client.addEventListener(o.CtXmppClient.EVENT_TYPES.DBS_DESTROYED,()=>{this.logger.shouldLog(l.LoggerTypes.CleanUp)&&this.logger.log(l.LoggerTypes.CleanUp,"%c DATABASES DESTROYED","color: #669; font-weight: bold;")}),this.client.addEventListener(o.CtXmppClient.EVENT_TYPES.AUTO_DBS_DESTROYED,()=>{this.logger.shouldLog(l.LoggerTypes.CleanUp)&&this.logger.log(l.LoggerTypes.CleanUp,"%c DATABASES AUTO DESTROYED","color: #669; font-weight: bold;")}),this.client.addEventListener(o.CtXmppClient.EVENT_TYPES.FORCE_LOGGED_OUT,()=>{this.logout(!0,!0)})}_joinOrLeaveRoom(e,t=!1){return i(this,void 0,void 0,function*(){"participant"===e.type&&((yield t)?this.client.leaveRoom(e.name):this.client.joinRoom(e.name)),"subscriber"===e.type&&((yield t)?this.client.unsubscribeFromRoom(e.name):this.client.subscribeToRoom(e.name,e.nodes))})}_participantToUser(e){const t={id:e._id,jid:e.jid,username:e.username,firstName:"",lastName:"",connectionStatus:e.online?c.ConnectionStatus.Connected:c.ConnectionStatus.Disconnected};return this.embelishUser(t,e,c.UserAdditionalDetailsType.Participant)}_xmppContactToUser(e){if(!e||!e.id)return null;const t={id:e.id,jid:e.id,username:e.id.substring(0,e.id.indexOf("@")),firstName:"",lastName:"",connectionStatus:e.online?c.ConnectionStatus.Connected:c.ConnectionStatus.Disconnected,groups:e.groups,subscription:e.subscription};return this.embelishUser(t,e,c.UserAdditionalDetailsType.Contact)}_directoryUserToUser(e){if(!e||!e.jid)return null;const t=e.jid,n={id:t,jid:t,username:t.substring(0,t.indexOf("@")),connectionStatus:c.ConnectionStatus.Disconnected,prefix:e.prefix,firstName:e.firstName,lastName:e.lastName,displayName:null,telephone:e.telephone,jobTitle:e.jobTitle,avatar:e.avatar,group:e.group,is_role:e.is_role};return this.embelishUser(n,e,c.UserAdditionalDetailsType.DirectoryUser)}_fireLocalEventHandlers(e,t){void 0!==this._localEventHandlers[e]&&this._localEventHandlers[e].forEach(e=>e(t))}_generatePushNotificationPayload(e,t,n){return{push:{$attributes:{xmlns:"urn:commontime:infinity:push"},notification:{type:"android"===e?"gcm":"apns",installation_id:n,registration_id:t}}}}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),s=n(6);t.AttachmentDownloadedHandler=class extends o.BaseChatHandler{constructor(){super(...arguments),this.eventType=[s.ChatEvents.AttachmentDownloadComplete]}handleEvent(e,t){return i(this,void 0,void 0,function*(){if(e===s.ChatEvents.AttachmentDownloadComplete){const e=t,n=yield this.layer.getConversationById(e.conversationId);if(n){const t=n.attachments.find(t=>t.type===e.type);t&&(t.local=e.filepath,yield this.layer.updateConversation(n))}}})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),s=n(6);t.AutoReconnectedHandler=class extends o.BaseChatHandler{constructor(){super(...arguments),this.eventType=[s.ChatEvents.AutoReconnected]}handleEvent(e,t){return i(this,void 0,void 0,function*(){e===s.ChatEvents.AutoReconnected&&window.cti&&"Login"===window.cti.store.state.currentPage&&(this.layer.comms.clearPostLoginTimeout(),window.cti.utils.callAction("go-to-page",{name:"Conversations"}))})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(6),s=n(3),r=n(30),a=n(184),l=n(0),c=n(24),d=window;t.RaiseDeviceNotificationHandler=class extends s.BaseChatHandler{constructor(){super(...arguments),this.eventType=[o.ChatEvents.PriorityConversationNotification,o.ChatEvents.ChatNotification]}handleEvent(e,t){return i(this,void 0,void 0,function*(){if(e===o.ChatEvents.ChatNotification){if(this.layer.currentlyAlerting)return;const e=t,n=e.chatEntry;if(!n||n.from===this.layer.getCurrentUserJid()||n.actingDelegate===this.layer.getCurrentUserJid())return;let i="New Notification",o=e.messagePreview,s=l.Icons.COMMON.User;if(n){const t=yield this.layer.getUserByJid(e.chatEntry.from);if(t){t.is_role&&(s=l.Icons.COMMON.Role);const n=`${t.firstName} ${t.lastName}`.trim();i="New Message",o=this.layer.config.behaviour.showMessageContentInNotifications?`${n}: ${e.messagePreview}`:`From: ${n}`}}if(yield r.isAppInForeground())e.isForCurrentConversation||this.layer.raiseToastNotification(i,o,s);else{const e=this.layer.config.behaviour.showMessageContentInNotifications?(new Date).getTime():1;a.raiseNativeNotification(i,o,e)}return"ios"===c.getPlatformName()&&r.setApplicationIconBadgeNumber(this.layer.getTotalUnreadCount()),d.simpleAudioPlayer.setAudio("Clinical_Messaging_Notification.m4a",1),d.simpleAudioPlayer.play(),void d.vibrationController.vibrate(100)}e===o.ChatEvents.PriorityConversationNotification&&!(yield r.isAppInForeground())&&d.PushNotification&&d.PushNotification.bringToFront&&d.PushNotification.bringToFront()})}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(25),s=n(24),r=n(5),a=o.getSource("notification");t.raiseNativeNotification=function(e,t,n=1){return i(this,void 0,void 0,function*(){s.isDevice()?(r.isIos()&&a.registerPermission(),a.core.schedule({id:n,title:e,text:t},null,null)):"granted"===(yield Notification.requestPermission())&&new Notification(e,{body:t})})}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),s=n(4),r=n(7),a=n(10);t.ReceivedConversationHandler=class extends o.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.ReceivedConversation}createIq(e){return a.createIq("rec",this.layer.config.xmpp.iq.namespace,{roomid:e.id})}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){return this.layer.translateI18nItem(r.ChatCommonMetadata.getI18nItem(r.ChatCommonI18nKeys.ERROR_RECEIVING_CONVERSATION)),this.layer.logger.error("Could not mark conversation as received:",t),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),s=n(4),r=n(11),a=n(6),l=n(5),c=n(16);t.ParticipantReceivedHandler=class extends o.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.ParticipantReceived}handleMessage(e){const t=e=>super[e];return i(this,void 0,void 0,function*(){if(this.isMamMessage(e))return;const n=e.data.participantreceipt,i=yield this.layer.getConversationById(n.id);if(!i)return t("handleConversationNotFound").call(this,e,n.id);i.receivedList||(i.receivedList=[]),i.receivedList.find(e=>e.jid===this.layer.getWorkspaceJid())||(i.receivedList.push({jid:n.instigator,ts:parseInt(n.ts),value:""}),i.hasUnread=!0),yield this.layer.updateConversation(i);const o=yield this.layer.getCurrentConversation();o&&o.id===i.id&&this.layer.emit(a.ChatEvents.CurrentConversationChanged)})}convert(e,t){return i(this,void 0,void 0,function*(){const n=e._id,i=l.findRoomJidInMessage(e,this.layer.config.xmpp.mucHost);return c.createMetaEntry(n,t.date,i,r.ChatMetaActivityType.RECEIVED,t.instigator,"received")})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(14),s=n(3),r=n(20);t.CommsConnectionHandler=class extends s.BaseChatHandler{constructor(){super(...arguments),this.eventType=[o.BaseEvents.LoginResult,o.BaseEvents._Request_Logout]}handleEvent(e,t){return i(this,void 0,void 0,function*(){if(e===o.BaseEvents.LoginResult){const e=t;if(!e.success){const t=this.layer.translateI18nItem(r.CommonMetadata.getI18nItem(r.CommonI18nKeys.LOGIN_ERROR_TITLE)),n=e.errorMessage||this.layer.translateI18nItem(r.CommonMetadata.getI18nItem(r.CommonI18nKeys.LOGIN_ERROR_GENERIC));this.layer.error(t,n)}}if(e===o.BaseEvents._Request_Logout)try{yield this.layer.logout(!0),yield this.layer.store.setWorkspaceAccount(null),this.layer.emit(o.BaseEvents.LogoutResult,{success:!0})}catch(e){const t=this.layer.translateI18nItem(r.CommonMetadata.getI18nItem(r.CommonI18nKeys.LOGOUT_ERROR_TITLE));this.layer.error(t,e)}})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),s=n(34),r=n(6),a=n(7),l=n(69),c=n(0),d=window;t.DelegationUpdateHandler=class extends o.BaseChatHandler{constructor(){super(...arguments),this.messageKey=l.ChatMessageType.DelegationUpdate}handleMessage(e){return i(this,void 0,void 0,function*(){if(this.isInjectedMessage(e))return;const t=e.data[l.ChatMessageType.DelegationUpdate],n=yield this.layer.searchUsers(t.role,["jid"]),i=t.role;let o="";n.length&&(o=n[0].displayName);let a=[];switch(t.change){case"active":s.default.addToDelegatedAccounts(this.layer,t.role),s.default.getCurrentlyDelegatedAccounts(this.layer),t.instigator!==this.layer.getCurrentUserJid()&&(a=this._genMessage("active",o||i),this.layer.raiseToastNotification("New Delegation",a[1],c.Icons.COMMON.Role)),yield this.layer.loadAllConversations(t.role);break;case"inactive":s.default.removeFromDelegatedAccounts(this.layer,t.role),s.default.getCurrentlyDelegatedAccounts(this.layer),this.layer.emit(r.ChatEvents.DelegationRemoved,t.role);let e=!1;this.layer.getWorkspaceJid()===t.role&&(e=!0),t.instigator!==this.layer.getCurrentUserJid()&&(a=this._genMessage("inactive",o||i),o?this.layer.error(a[0],a[1]):this.layer.logger.error(a[0],a[1])),this.layer.getWorkspaceJid().toLocaleLowerCase()===t.role.toLocaleLowerCase()&&(yield this.layer.store.setWorkspaceAccount(this.layer.getCurrentUserJid()),this.layer.emit(r.ChatEvents.WorkspaceUserChanged),e&&d.cti&&d.cti.utils.callAction("go-to-page",{name:"Conversations"}))}this.layer.emit(r.ChatEvents.RefreshDelegateAccountsList)})}_genMessage(e,t){switch(e){case"active":return[this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.DELEGATE_ACCOUNT_GIVEN_TITLE)),this._replace(this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.DELEGATE_ACCOUNT_GIVEN_MESSAGE)),"name",t)];case"inactive":return[this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.DELEGATE_ACCOUNT_TAKEN_TITLE)),this._replace(this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.DELEGATE_ACCOUNT_TAKEN_MESSAGE)),"name",t)]}}_replace(e,t,n){return e.replace(`{{${t}}}`,n)}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(0),s=n(16),r=n(35),a=n(6),l=n(3),c=n(11),d=n(5);t.ChatEntryEventHandler=class extends l.BaseChatHandler{constructor(){super(...arguments),this.eventType=[a.ChatEvents.ChatEntryReceived]}handleEvent(e,t){return i(this,void 0,void 0,function*(){if(e===a.ChatEvents.ChatEntryReceived){const e=t,n=e.chatEntry;if(!n)return;const i=this.layer.getWorkspaceJid(),o=yield this.layer.getConversationByRoomJidAcrossWorkspaces(n.to),l=yield this.layer.getCurrentConversation(),c=l&&o&&l.id===o.id||!1;if(o&&this._shouldRaiseNotification(n,i,o,c)){const t=new r.UserLookup(this.layer);yield t.populate([o]);const l=s.getConversationTitle(o,t,i,""),d=this._getMessagePreview(n,t,i);this.layer.emit(a.ChatEvents.ChatNotification,new a.ChatNotificationEventArgs(e.chatEntry,l,d,c))}}})}_shouldRaiseNotification(e,t,n,i){if(e.type===o.ChatEntryType.Chat&&e.mine)return!1;if(e.type===o.ChatEntryType.Meta&&d.jidsMatch(e.instigator,t))return!1;if(e.date<=(n.hideBefore||n.lastHideBefore))return!1;if(n.config&&n.config.behaviour&&n.config.behaviour.alert&&n.instigator!==this.layer.getWorkspaceJid()&&n.acknowledgements&&!n.acknowledgements.find(e=>e.jid===this.layer.getWorkspaceJid()))return!1;if(n.config&&n.config.behaviour&&n.config.behaviour.alert&&n.instigator!==this.layer.getWorkspaceJid()&&n.acknowledgements&&e.date<=n.acknowledgements.find(e=>e.jid===this.layer.getWorkspaceJid()).ts)return!1;const s=this.layer.getConfiguredPriorityById(n.priority);if(s&&s.alert&&n.acknowledgements&&!n.acknowledgements.find(e=>e.jid===this.layer.getWorkspaceJid()))return!1;if(s&&s.alert&&n.acknowledgements&&e.date<=n.acknowledgements.find(e=>e.jid===this.layer.getWorkspaceJid()).ts)return!1;if(i&&e.type!==o.ChatEntryType.Meta&&e.action===c.ChatMetaActivityType.ACK.toString())return!0;if(e.type===o.ChatEntryType.Chat)return!0;if(e.type===o.ChatEntryType.Meta){const i=e;if(i.action===c.ChatMetaActivityType.START.toString())return n.type!==c.ConversationType.Direct;if([c.ChatMetaActivityType.ADD.toString(),c.ChatMetaActivityType.REMOVE.toString(),c.ChatMetaActivityType.CHANGEROLE.toString()].includes(i.action)&&i.subject===t)return!0}return!1}_getMessagePreview(e,t,n){if(e.type===o.ChatEntryType.Chat){const t=e;return s.getChatMessageTextForPreview(t,this.layer)}if(e.type===o.ChatEntryType.Meta){const i=e;return s.getChatMetaActivitySummaryText(i,t,n,this.layer,!1)}}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),s=n(4),r=n(9),a=n(7),l=n(10);t.AcknowledgeConversationHandler=class extends o.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.AcknowledgeConversation}createIq(e){return l.createIq("ack",this.layer.config.xmpp.iq.namespace,{roomid:e.conversation.id,value:e.value})}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_ACKNOWLEDGING_CONVERSATION)),n=t.message,i=r.getErrorMessage(n,this.layer);return this.layer.error(e,i),null})}}},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(192)),i(n(193)),i(n(194)),i(n(195)),i(n(196)),i(n(197)),i(n(198)),i(n(199)),i(n(200))},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10),c=n(6);t.AcquireDelegationHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.AcquireDelegation}createIq(e){return l.createIq("acquire","urn:commontime:infinity:delegate",{name:e.name,role:e.role.toLowerCase()})}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_ACQUIRING_DELEGATE_ACCOUNT)),t=o.getErrorMessage("E_ACQUIRE_ERROR",this.layer);return this.layer.emit(c.ChatEvents.UnableToAcquireRole,null),this.layer.error(e,t),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.AssignDelegationHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.AssignDelegation}createIq(e){return l.createIq("assign","urn:commontime:infinity:delegate",{name:e.name,role:e.role.toLowerCase(),to:e.to})}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_ASSIGNING_DELEGATE_ACCOUNT)),t=o.getErrorMessage("E_ASSIGN_ERROR",this.layer);return this.layer.error(e,t),null})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.GetDelegateAccountListHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.DelegateAccounts}createIq(e){return l.createIq("query-roles","urn:commontime:infinity:delegate",{})}handleIqResponse(e,t){return i(this,void 0,void 0,function*(){if(t.json&&t.json.$value)try{const e=JSON.parse(t.json.$value);return t.result=e,t}catch(e){throw new Error(e)}return t})}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_FETCHING_DELEGATE_ACCOUNTS)),n=t.message,i=o.getErrorMessage(n,this.layer);return i!==o.ChatErrorsI18nKeys.E_UNKNOWN.toString()&&this.layer.error(e,i),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.GiveDelegationHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.GiveDelegation}createIq(e){return l.createIq("give","urn:commontime:infinity:delegate",{name:e.name,role:e.role.toLowerCase(),to:e.to.toLowerCase()})}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_GIVING_DELEGATE_ACCOUNT)),t=o.getErrorMessage("E_GIVE_ERROR",this.layer);return this.layer.error(e,t),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.ReleaseDelegationHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.ReleaseDelegation}createIq(e){return l.createIq("release","urn:commontime:infinity:delegate",{name:e.name,role:e.role.toLowerCase(),from:e.from.toLowerCase()})}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_RELEASING_DELEGATE_ACCOUNT)),t=o.getErrorMessage("E_RELEASE_ERROR",this.layer);return this.layer.error(e,t),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.RelinquishDelegationHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.RelinquishDelegation}createIq(e){return l.createIq("relinquish","urn:commontime:infinity:delegate",{name:e.name,role:e.role.toLowerCase()})}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_RELINQUISHING_DELEGATE_ACCOUNT)),t=o.getErrorMessage("E_RELINQUISH_ERROR",this.layer);return this.layer.error(e,t),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10),c=n(6);t.TakeDelegationHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.TakeDelegation}createIq(e){return l.createIq("take","urn:commontime:infinity:delegate",{name:e.name,role:e.role.toLowerCase(),from:e.from.toLowerCase()})}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const t=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_TAKING_DELEGATE_ACCOUNT)),n=yield this.layer.getUserByJid(e.from),i=yield this.layer.getUserByJid(e.role),s=n&&i?`You do not have the required permissions to take the role '${i.displayName}' from '${n.displayName}'. Contact a role administrator for assistance.`:o.getErrorMessage("E_TAKE_ERROR",this.layer);return this.layer.emit(c.ChatEvents.UnableToTakeRole,null),this.layer.error(t,s),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.TransferDelegationHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.TransferDelegation}createIq(e){return l.createIq("transfer","urn:commontime:infinity:delegate",{name:e.name,role:e.role.toLowerCase(),from:e.from,to:e.to})}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_TRANSFERING_DELEGATE_ACCOUNT)),t=o.getErrorMessage("E_TRANSFER_ERROR",this.layer);return this.layer.error(e,t),null})}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),s=n(4),r=n(9),a=n(7),l=n(10);t.DeleteDirectConversationHandler=class extends o.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.HideDirectConversation}createIq(e){return l.createIq("hide_before",this.layer.config.xmpp.iq.namespace,{roomid:e.conversation.id,timestamp:e.timestamp.toString()})}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_DELETING_DIRECT_CONVERSATION)),n=(t.message.includes("connected")?"E_NO_CONNECTION_DELETING_DIRECT":t.message)||"E_DELETING_DIRECT_CONVERSATION_ERROR",i=r.getErrorMessage(n,this.layer);return this.layer.error(e,i),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(29),s=n(16),r=n(6),a=n(4),l=n(3),c=n(5),d=n(19);t.ChatMessageHandler=class extends l.BaseChatHandler{constructor(){super(...arguments),this.messageKey=a.ChatMessageType.XmppChat,this.DEBOUNCE_PURGE_NAME="purge",this.DEBOUNCE_DURATION=2e3,this._debouncers={}}handleMessage(e){return i(this,void 0,void 0,function*(){if(this.isMamMessage(e)||this.isInjectedMessage(e)||this.isPlaceholderMessage(e))return;const t=yield this.convert(e),n=yield this.layer.getConversationByRoomJid(t.to);if(!n||n.isClosed){const e=this.layer.store.getDelegateConversations();for(const n in e){const i=e[n].conversations.find(e=>e.roomJid===t.to);if(i){i.hasUnread=!0,i.preview=t,yield this.layer.store.setDelegateConversations(e),this.layer.emit(r.ChatEvents.ChatEntryReceivedInWorkspace),this.layer.emit(r.ChatEvents.ChatEntryReceived,new r.ChatEntryEventArgs(t));break}}return null}if(t.date<=(n.hideBefore||n.lastHideBefore))return null;const i={};t.date>(n.hideBefore||n.lastHideBefore)&&(i.preview=t),yield this.layer.updateConversation(n,{preview:t}),this.debounce(this.DEBOUNCE_PURGE_NAME,()=>this.layer.purgeConversation(n),this.DEBOUNCE_DURATION),this.layer.emit(r.ChatEvents.ChatEntryReceived,new r.ChatEntryEventArgs(t))})}debounce(e,t,n=100){clearTimeout(this._debouncers[e]),this._debouncers[e]=setTimeout(()=>{t(),delete this._debouncers[e]},n)}handleMessageUpdate(e){return i(this,void 0,void 0,function*(){if(!e.sender_id)return void this.layer.logger.log(d.LoggerTypes.Other," Message received with no sender_id",e);const t=yield this.convert(e),n=yield this.layer.getConversationByRoomJid(t.to);return!n||n.isClosed?null:t.date<=(n.hideBefore||n.lastHideBefore)?null:void this.layer.emit(r.ChatEvents.ChatEntryUpdated,new r.ChatEntryEventArgs(t))})}convert(e){return i(this,void 0,void 0,function*(){const t=e._id,n=e.ts,i=this.layer.getWorkspaceJid(),r=this.layer.getWorkspaceJid()!==this.layer.getCurrentUserJid()?e.fromMam?`${e.sender_resource}@${this.layer.config.xmpp.user.domain}`===this.layer.getWorkspaceJid():e.sender_id.includes(this.layer.getWorkspaceJid()):e.fromMam?`${e.sender_resource}@${this.layer.config.xmpp.user.domain}`===this.layer.getCurrentUserJid():e.sender_id===this.layer.getCurrentUserJid();let a="";if(this.layer.getWorkspaceJid()!==this.layer.getCurrentUserJid())a=e.mine||e.injected?e.sender_id:`${e.sender_resource}@${this.layer.config.xmpp.user.domain}`;else{const t=e.sender_id.split("/");a=e.injected?e.sender_id:e.mine&&e.actingDelegate&&t.length>0?t[1]:e.delegateJid||`${e.sender_resource}@${this.layer.config.xmpp.user.domain}`}const l=c.findRoomJidInMessage(e,this.layer.config.xmpp.mucHost),d="string"==typeof e.body?e.body:"",h=e.attachments instanceof Array?e.attachments.map(e=>({remote:e.get,local:e.path})):[],u=[],p=[];return(e.state&&e.state.markers||[]).forEach(e=>{const t={jid:`${e.sender_resource}@${this.layer.config.xmpp.user.domain}`,date:e.ts};e.type===o.CtXmppClient.MARKER_TYPES.RECEIVED&&u.push(t),e.type===o.CtXmppClient.MARKER_TYPES.READ&&p.push(t)}),s.createChatMessage(t,n,i,a,l,d,h,u,p,e.placeholder,e.actingDelegate,r)})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),s=n(4);t.ConversationEndedHandler=class extends o.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.ConversationEnded}handleMessage(e){return i(this,void 0,void 0,function*(){})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(16),s=n(21),r=n(4),a=n(3),l=n(11),c=n(5);t.ConversationStartedHandler=class extends a.BaseChatHandler{constructor(){super(...arguments),this.messageKey=r.ChatMessageType.ConversationStarted}handleMessage(e){return i(this,void 0,void 0,function*(){if(this.isMamMessage(e))return;const t=e.data[this.messageKey];let n=yield this.layer.getConversationById(t.id);if(null!==n)return;const i=c.enumFromString(t.type);n=o.createConversation(t.id,i,t.roomJid,t.participants,t.title,t.description,t.date,t.priority,t.expiry_ttl,t.activity_ttl,[],[],t.instigator,void 0,t.reply_template,t.attachments);const r=new s.ConversationConfigReader(this.layer,n),a=yield this.convert(e,t);yield this.layer.removeExpiredConversations(),yield this.layer.addConversation(n,a),r.alert&&(yield this.layer.addToPendingAlerts(n),yield this.layer.priorityAlert(n))})}convert(e,t){return i(this,void 0,void 0,function*(){const n=e._id,i=c.findRoomJidInMessage(e,this.layer.config.xmpp.mucHost);return o.createMetaEntry(n,t.date,i,l.ChatMetaActivityType.START,t.instigator)})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),s=n(4),r=n(6),a=n(11),l=n(16),c=n(5);t.ConversationUpdatedHandler=class extends o.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.ConversationUpdated}handleMessage(e){const t=e=>super[e];return i(this,void 0,void 0,function*(){if(this.isMamMessage(e))return;const n=e.data[this.messageKey],i=yield this.layer.getConversationById(n.id);if(!i)return t("handleConversationNotFound").call(this,e,n.id);i.subject=n.title,i.description=n.description;const o=yield this.convert(e,n);yield this.layer.updateConversation(i,{preview:o}),this.layer.emit(r.ChatEvents.ChatEntryReceived,new r.ChatEntryEventArgs(o))})}convert(e,t){return i(this,void 0,void 0,function*(){const n=e._id,i=c.findRoomJidInMessage(e,this.layer.config.xmpp.mucHost);return l.createMetaEntry(n,t.date,i,a.ChatMetaActivityType.UPDATE,t.instigator,null,t.title)})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(16),s=n(6),r=n(4),a=n(3),l=n(11),c=n(5),d=n(78);t.ParticipantAcknowledgedHandler=class extends a.BaseChatHandler{constructor(){super(...arguments),this.messageKey=r.ChatMessageType.ParticipantAcknowledged}handleMessage(e){const t=e=>super[e];return i(this,void 0,void 0,function*(){if(this.isMamMessage(e))return;const n=e.data[this.messageKey],i=yield this.convert(e,n);let o=null;const r=this.layer.store.getDelegateConversations();if(r[n.instigator]&&(o=r[n.instigator].conversations.find(e=>e.id===n.id))&&i&&((!o.preview||i.date>o.preview.date)&&(o.preview=i,o.hasUnread=!0),o.hideBefore&&(o.lastHideBefore=o.hideBefore,o.hideBefore=0)),o||(o=r[this.layer.getWorkspaceJid()].conversations.find(e=>e.id===n.id)),!o)return t("handleConversationNotFound").call(this,e,n.id);o.acknowledgements||(o.acknowledgements=[]),o.acknowledgements.find(e=>e.jid===n.instigator)||(o.acknowledgements.push({jid:n.instigator,ts:parseInt(n.date),value:n.value}),n.instigator!==this.layer.getWorkspaceJid()&&(o.hasUnread=!0)),yield this.layer.store.setDelegateConversations(r);const a=yield this.layer.getCurrentConversation();a&&a.id===o.id&&(yield this.layer.setCurrentConversation(o)),this.layer.emit(s.ChatEvents.ConversationUpdated,new s.ConversationEventArgs(o)),this.layer.emit(s.ChatEvents.ChatEntryReceived,new s.ChatEntryEventArgs(i)),this.layer.emit(s.ChatEvents.PriorityConversationAcknowledged,new d.PriorityConversationAcknowledgedEventArgs(o,this.layer.getPendingAlertCount(),n.instigator))})}convert(e,t){return i(this,void 0,void 0,function*(){const n=e._id,i=c.findRoomJidInMessage(e,this.layer.config.xmpp.mucHost);return o.createMetaEntry(n,t.date,i,l.ChatMetaActivityType.ACK,t.instigator,t.value)})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),s=n(4),r=n(6),a=n(11),l=n(16),c=n(5);t.ParticipantAddedHandler=class extends o.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.ParticipantAdded}handleMessage(e){const t=e=>super[e];return i(this,void 0,void 0,function*(){if(this.isMamMessage(e))return;const n=e.data[this.messageKey],i=yield this.layer.getConversationById(n.id);if(!i)return t("handleConversationNotFound").call(this,e,n.id);const o=[...i.participants,n.participant];i.participants=c.uniqueArrayItems(o,e=>e.jid);const s=yield this.convert(e,n);yield this.layer.updateConversation(i,{preview:s,isParticipantChange:!0}),this.layer.emit(r.ChatEvents.ChatEntryReceived,new r.ChatEntryEventArgs(s))})}convert(e,t){return i(this,void 0,void 0,function*(){const n=e._id,i=c.findRoomJidInMessage(e,this.layer.config.xmpp.mucHost);return l.createMetaEntry(n,t.date,i,a.ChatMetaActivityType.ADD,t.instigator,t.participant.jid)})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),s=n(4),r=n(6),a=n(11),l=n(16),c=n(5);t.ParticipantLeftHandler=class extends o.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.ParticipantLeft}handleMessage(e){const t=e=>super[e];return i(this,void 0,void 0,function*(){if(this.isMamMessage(e))return;const n=e.data[this.messageKey],i=yield this.layer.getConversationById(n.id);if(!i)return t("handleConversationNotFound").call(this,e,n.id);i.participants=i.participants.filter(e=>!c.jidsMatch(e.jid,n.instigator));const o=yield this.convert(e,n);yield this.layer.updateConversation(i,{preview:o,isParticipantChange:!0}),this.layer.emit(r.ChatEvents.ChatEntryReceived,new r.ChatEntryEventArgs(o))})}convert(e,t){return i(this,void 0,void 0,function*(){const n=e._id,i=c.findRoomJidInMessage(e,this.layer.config.xmpp.mucHost);return l.createMetaEntry(n,t.date,i,a.ChatMetaActivityType.LEFT,t.instigator)})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(16),s=n(6),r=n(4),a=n(3),l=n(11),c=n(5);t.ParticipantRemovedHandler=class extends a.BaseChatHandler{constructor(){super(...arguments),this.messageKey=r.ChatMessageType.ParticipantRemoved}handleMessage(e){const t=e=>super[e];return i(this,void 0,void 0,function*(){if(this.isMamMessage(e))return;const n=e.data[this.messageKey],i=yield this.layer.getConversationById(n.id);if(!i)return t("handleConversationNotFound").call(this,e,n.id);i.participants=i.participants.filter(e=>!c.jidsMatch(e.jid,n.participant.jid));const o=yield this.convert(e,n);yield this.layer.updateConversation(i,{preview:o,isParticipantChange:!0}),this.layer.emit(s.ChatEvents.ChatEntryReceived,new s.ChatEntryEventArgs(o))})}convert(e,t){return i(this,void 0,void 0,function*(){const n=e._id,i=c.findRoomJidInMessage(e,this.layer.config.xmpp.mucHost);return o.createMetaEntry(n,t.date,i,l.ChatMetaActivityType.REMOVE,t.instigator,t.participant.jid)})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),s=n(4),r=n(6),a=n(11),l=n(16),c=n(5);t.ParticipantRoleChangedHandler=class extends o.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.ParticipantRoleChanged}handleMessage(e){const t=e=>super[e];return i(this,void 0,void 0,function*(){if(this.isMamMessage(e))return;const n=e.data[this.messageKey],i=yield this.layer.getConversationById(n.id);if(!i)return t("handleConversationNotFound").call(this,e,n.id);const o=i.participants.find(e=>c.jidsMatch(e.jid,n.participant.jid));if(!o)return void console.error(" Unable to find participant in conversation");o.role=n.participant.role;const s=yield this.convert(e,n);yield this.layer.updateConversation(i,{preview:s,isParticipantChange:!0}),this.layer.emit(r.ChatEvents.ChatEntryReceived,new r.ChatEntryEventArgs(s))})}convert(e,t){return i(this,void 0,void 0,function*(){const n=e._id,i=c.findRoomJidInMessage(e,this.layer.config.xmpp.mucHost);return l.createMetaEntry(n,t.date,i,a.ChatMetaActivityType.CHANGEROLE,t.instigator,t.participant.jid,t.participant.role.toString())})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),s=n(4),r=n(11),a=n(16),l=n(5),c=n(21);t.UserAddedHandler=class extends o.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.User_Added}handleMessage(e){return i(this,void 0,void 0,function*(){const t=e.data[this.messageKey];let n=yield this.layer.getConversationById(t.id);if(null===n&&this.isMamMessage(e))return;if(null!==n&&!n.isClosed)return;const i=new c.ConversationConfigReader(this.layer,n),o=this.layer.getCurrentUserJid(),s=a.createMetaEntry(e._id,t.date,t.roomJid,r.ChatMetaActivityType.ADD,t.instigator,o);if(n&&n.isClosed)yield this.layer.reopenConversation(n,t.participants,s);else{const e=l.enumFromString(t.type);n=a.createConversation(t.id,e,t.roomJid,t.participants,t.title,t.description,t.started,t.priority,t.expiry_ttl,t.activity_ttl,t.receipts,t.responses,t.started_by,void 0,t.reply_template),yield this.layer.addConversation(n,s)}i.alert&&(yield this.layer.addToPendingAlerts(n),yield this.layer.priorityAlert(n))})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(0),s=n(3),r=n(4),a=n(6),l=n(11),c=n(16),d=n(7);t.UserConversationEndedHandler=class extends s.BaseChatHandler{constructor(){super(...arguments),this.messageKey=r.ChatMessageType.User_ConversationEnded}handleMessage(e){const t=e=>super[e];return i(this,void 0,void 0,function*(){const n=e.data[this.messageKey];let i=null;const s=this.layer.store.getDelegateConversations();for(const e in s){const t=s[e].conversations;for(const e of t)if(e.id===n.id){i=e;break}}if(!i)return t("handleConversationNotFound").call(this,e,n.id);const r=c.createMetaEntry(e._id,n.date,i.roomJid,l.ChatMetaActivityType.END,n.instigator);yield this.layer.closeConversation(i,r),"expired"===n.state&&(yield this.layer.removeConversationById(i.id));const h=yield this.layer.getCurrentConversation(),u=h&&h.id===i.id,p=this.layer.getWorkspaceJid()===n.instigator;if(u&&!p){const e=this.layer.translateI18nItem(d.ChatCommonMetadata.getI18nItem(d.ChatCommonI18nKeys.ENDED_TITLE)),t=this.layer.translateI18nItem(d.ChatCommonMetadata.getI18nItem(d.ChatCommonI18nKeys.ENDED_MESSAGE)).replace("{{subject}}",i.subject);this.layer.emit(a.ChatEvents.ForceQuitConversation,new a.ForceQuitConversationEventArgs(i,n.instigator,l.ChatMetaActivityType.END)),setTimeout(()=>this.layer.emit(a.ChatEvents._Request_RaiseAlert,new o.DefaultAlerts(this.layer).AlertAcknowledge(e,t,1,{}),!0),1e3)}})}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),s=n(4),r=n(6);t.UserDeleteDirectConversationHandler=class extends o.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.User_DeleteDirectConversation}handleMessage(e){const t=e=>super[e];return i(this,void 0,void 0,function*(){const n=e.data[this.messageKey];if(this.layer.getWorkspaceJid().toLowerCase()===n.instigator.toLowerCase()){const i=yield this.layer.getConversationById(n.id);if(!i)return t("handleConversationNotFound").call(this,e,n.id);if(i.preview&&i.preview.date>parseInt(n.hide_before))i.hideBefore&&(i.lastHideBefore=i.hideBefore,i.hideBefore=0),yield this.layer.updateConversation(i,{},this.layer.getWorkspaceJid());else{const e=yield this.layer.getCurrentConversation();if(e&&e.id===i.id)e.hideBefore=parseInt(n.hide_before),yield this.layer.comms.clearStoredConversationMessages(e),yield this.layer.updateConversation(e,{},this.layer.getWorkspaceJid()),yield this.layer.clearCurrentConversation(),this.layer.emit(r.ChatEvents.ConversationDeleted);else{const e=yield this.layer.getConversationById(n.id);e.hideBefore=parseInt(n.hide_before),yield this.layer.comms.clearStoredConversationMessages(e),yield this.layer.updateConversation(e,{},this.layer.getWorkspaceJid())}}this.layer.dismissWaitingMessage()}})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(3),s=n(4),r=n(11),a=n(16);t.UserLeftHandler=class extends o.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.User_Left}handleMessage(e){const t=e=>super[e];return i(this,void 0,void 0,function*(){const n=e.data[this.messageKey],i=yield this.layer.getConversationById(n.id);if(!i)return t("handleConversationNotFound").call(this,e,n.id);const o=this.layer.getCurrentUserJid(),s=a.createMetaEntry(e._id,n.date,i.roomJid,r.ChatMetaActivityType.LEFT,o),l=this.layer.store.getWorkspaceAccount()||o;this.layer.shouldCloseConversation(i,l)&&(yield this.layer.closeConversation(i,s))})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(0),s=n(3),r=n(4),a=n(6),l=n(11),c=n(16),d=n(7);t.UserRemovedHandler=class extends s.BaseChatHandler{constructor(){super(...arguments),this.messageKey=r.ChatMessageType.User_Removed}handleMessage(e){const t=e=>super[e];return i(this,void 0,void 0,function*(){const n=e.data[this.messageKey],i=yield this.layer.getConversationById(n.id);if(!i)return t("handleConversationNotFound").call(this,e,n.id);const s=yield this.layer.getCurrentConversation(),r=s&&s.id===i.id,h=this.layer.getWorkspaceJid(),u=h===n.instigator;if(r&&!u){const e=this.layer.translateI18nItem(d.ChatCommonMetadata.getI18nItem(d.ChatCommonI18nKeys.REMOVED_TITLE)),t=this.layer.translateI18nItem(d.ChatCommonMetadata.getI18nItem(d.ChatCommonI18nKeys.REMOVED_MESSAGE)).replace("{{subject}}",i.subject);this.layer.emit(a.ChatEvents._Request_RaiseAlert,new o.DefaultAlerts(this.layer).AlertAcknowledge(e,t,1,{})),this.layer.emit(a.ChatEvents.ForceQuitConversation,new a.ConversationEventArgs(i))}const p=c.createMetaEntry(e._id,n.date,i.roomJid,l.ChatMetaActivityType.REMOVE,n.instigator,h);let g;try{g=e.recipient_id.split("/")[0]}catch(t){g=e.recipient_id}yield this.layer.closeConversation(i,p,g,!0),this.layer.emit(a.ChatEvents.ChatEntryReceived,new a.ChatEntryEventArgs(p))})}}},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(217)),i(n(218)),i(n(219)),i(n(220)),i(n(221))},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.CreateRoleHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.CreateRole}createIq(e){return l.createIq("admin_create_role","urn:commontime:infinity:delegate",e)}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_CREATING_ROLE)),t=o.getErrorMessage("E_CREATE_ROLE_ERROR",this.layer);return this.layer.error(e,t),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.ModifyRoleHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.ModifyRole}createIq(e){return l.createIq("admin_modify_role","urn:commontime:infinity:delegate",e)}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_MODIFYING_ROLE)),t=o.getErrorMessage("E_MODIFY_ROLE_ERROR",this.layer);return this.layer.error(e,t),null})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.DeleteRoleHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.DeleteRole}createIq(e){return l.createIq("admin_delete_role","urn:commontime:infinity:delegate",e)}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_DELEATING_ROLE)),t=o.getErrorMessage("E_DELETE_ROLE_ERROR",this.layer);return this.layer.error(e,t),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.ModifyRoleAclHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.ModifyRoleAcl}createIq(e){return l.createIq("admin_modify_role_acl","urn:commontime:infinity:delegate",e)}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_MODIFYING_ROLE_ACL)),t=o.getErrorMessage("E_MODIFY_ROLE_ACL_ERROR",this.layer);return this.layer.error(e,t),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.QueryRolesHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.QueryRoles}createIq(e){return l.createIq("admin_list_roles","urn:commontime:infinity:delegate",e)}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_QUERYING_ROLE)),t=o.getErrorMessage("E_QUERY_ROLES_ERROR",this.layer);return this.layer.error(e,t),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.GetRoleHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.GetRole}createIq(e){return l.createIq("admin_get_role","urn:commontime:infinity:delegate",e)}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_GETTING_ROLE)),t=o.getErrorMessage("E_QUERY_ROLES_ERROR",this.layer);return this.layer.error(e,t),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.SetRolePermissionHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.SetPermission}createIq(e){return l.createIq("admin_modify_role_acl","urn:commontime:infinity:delegate",e)}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_SETTING_PERMISSIONS_ROLE)),t=o.getErrorMessage("E_MODIFY_ROLE_ERROR",this.layer);return this.layer.error(e,t),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.GetGroupHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.GetGroup}createIq(e){return l.createIq("admin_get_group","urn:commontime:infinity:groups",e)}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_GETTING_GROUP)),t=o.getErrorMessage("E_QUERY_GROUPS_ERROR",this.layer);return this.layer.error(e,t),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.QueryGroupsHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.QueryGroups}createIq(e){return l.createIq("admin_query_groups","urn:commontime:infinity:groups",e)}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_QUERYING_GROUP)),t=o.getErrorMessage("E_QUERY_GROUPS_ERROR",this.layer);return this.layer.error(e,t),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.CreateGroupHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.CreateGroup}createIq(e){return l.createIq("admin_create_group","urn:commontime:infinity:groups",e)}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_CREATING_GROUP)),t=o.getErrorMessage("E_CREATE_GROUP_ERROR",this.layer);return this.layer.error(e,t),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.DeleteGroupHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.DeleteGroup}createIq(e){return l.createIq("admin_delete_group","urn:commontime:infinity:groups",e)}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_DELEATING_GROUP)),t=o.getErrorMessage("E_DELETE_GROUP_ERROR",this.layer);return this.layer.error(e,t),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.UpdateGroupHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.UpdateGroup}createIq(e){return l.createIq("admin_update_group","urn:commontime:infinity:groups",e)}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_UPDATING_GROUP)),t=o.getErrorMessage("E_UPDATE_GROUP_ERROR",this.layer);return this.layer.error(e,t),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.QueryGroupMembersHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.QueryGroupMembers}createIq(e){return l.createIq("admin_query_group_members","urn:commontime:infinity:groups",e)}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_QUERYING_GROUP_MEMBERS)),t=o.getErrorMessage("E_QUERY_GROUP_MEMBERS_ERROR",this.layer);return this.layer.error(e,t),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.AddGroupMembersHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.AddGroupMembers}createIq(e){return l.createIq("admin_add_group_members","urn:commontime:infinity:groups",{id:e.id,members:{item:e.members.map(e=>l.createIqNode({jid:e.jid}))}})}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_ADDING_GROUP_MEMBERS)),t=o.getErrorMessage("E_ADD_GROUP_MEMBERS_ERROR",this.layer);return this.layer.error(e,t),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.RemoveGroupMembersHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.RemoveGroupMembers}createIq(e){return l.createIq("admin_remove_group_members","urn:commontime:infinity:groups",{id:e.id,members:{item:e.members.map(e=>l.createIqNode({jid:e.jid}))}})}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_REMOVING_GROUP_MEMBERS)),t=o.getErrorMessage("E_REMOVE_GROUP_MEMBERS_ERROR",this.layer);return this.layer.error(e,t),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.AddGroupChildHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.AddGroupChild}createIq(e){return l.createIq("admin_add_group_child","urn:commontime:infinity:groups",e)}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_ADDING_GROUP_CHILD)),t=o.getErrorMessage("E_ADD_GROUP_CHILD_ERROR",this.layer);return this.layer.error(e,t),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.RemoveGroupChildHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.RemoveGroupChild}createIq(e){return l.createIq("admin_remove_group_child","urn:commontime:infinity:groups",e)}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_REMOVING_GROUP_CHILD)),t=o.getErrorMessage("E_REMOVE_GROUP_CHILD_ERROR",this.layer);return this.layer.error(e,t),null})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(236))},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9),s=n(4),r=n(3),a=n(7),l=n(10);t.SetUsersInactiveHandler=class extends r.BaseChatHandler{constructor(){super(...arguments),this.messageKey=s.ChatMessageType.SetUsersInactive}createIq(e){return l.createIq("disable","urn:commontime:infinity:principal",e)}handleIqErrorResponse(e,t){return i(this,void 0,void 0,function*(){const e=this.layer.translateI18nItem(a.ChatCommonMetadata.getI18nItem(a.ChatCommonI18nKeys.ERROR_SETTING_USERS_INACTIVE)),t=o.getErrorMessage("E_SET_USERS_INACTIVE_ERROR",this.layer);return this.layer.error(e,t),null})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(5);var o;!function(e){e[e.iOS=1]="iOS",e[e.Android=2]="Android",e[e.Desktop=3]="Desktop"}(o||(o={}));t.VibrationController=class{constructor(){this._iterations=0;const e=window;e.cti?this._platform="android"===e.cti.store.env.platform.name?o.Android:o.iOS:this._platform=o.Desktop}_vibrate(e=100,t=!1){i.isDesktop()?navigator.vibrate(e):(0,navigator.vibrate)(e,t)}vibrate(e=100,t=1,n=!1){clearInterval(this._timer);const i=e+500;this._iterations=t,0===e?this._platform===o.iOS?(this._vibrate(e,n),this._timer=setInterval(()=>this._vibrate(e,n),i)):this._platform===o.Android&&this._vibrate(864e5,n):(this._vibrate(e,n),0===this._iterations?this._timer=setInterval(()=>this._vibrate(e,n),i):(this._iterations=t-1,this._timer=setInterval(()=>{this._iterations>0?(this._iterations--,this._vibrate(e,n)):this.stop()},i)))}vibrateWithPattern(e,t=1,n=!1){if(clearInterval(this._timer),this._iterations=0,this._platform===o.Android){const i=e.reduce((e,t)=>e+=t,0)+500;this._vibrate(e,n),this._iterations--,this._timer=0===t?setInterval(()=>this._vibrate(e,n),i):setInterval(()=>{this._iterations>0?(this._iterations--,this._vibrate(e,n)):this.stop()},i)}}stop(){this._iterations=0,clearInterval(this._timer),delete this._timer,this._vibrate(0)}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(80),o=n(85),s=n(87),r=n(88),a=n(89),l=n(18),c=n(93),d=n(9),h=n(91),u=n(7),p=window;t.getChatI18nKeys=function(e=!1,...t){return 0===t.length&&(t=[...p.translationData.keys()]),t.reduce((t,n)=>t.concat(function(e,t){return(null===t||p.translationData.has(t))&&p.translationData.get(t).getUniqueI18Keys(e)||[]}(e,n)),[]).filter((e,t,n)=>n.indexOf(e)===t).sort()},p.translationData.set("CTCLConversationAlert",h.CTCLConversationAlertMetadata.instance),p.translationData.set("CTCLAddConversationContacts",i.CTCLAddConversationContactsMetadata.instance),p.translationData.set("CTCLChatMessageList",o.CTCLChatMessageListMetadata.instance),p.translationData.set("CTCLContactInfo",s.CTCLContactInfoMetadata.instance),p.translationData.set("CTCLConversationInfo",r.CTCLConversationInfoMetadata.instance),p.translationData.set("CTCLConversationList",a.CTCLConversationListMetadata.instance),p.translationData.set("CTCLHeader",l.CTCLHeaderMetadata.instance),p.translationData.set("CTCLNewConversation",c.CTCLNewConversationMetadata.instance),p.translationData.set("ChatErrors",d.ChatErrorsMetadata),p.translationData.set("ChatCommon",u.ChatCommonMetadata)},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(14),a=n(0),l=n(20);class c extends s.CTLayerComponent{initialize(e){return o(this,void 0,void 0,function*(){this.layer.setShowChatFunction(()=>{this.emitComponentEvent("go-chat")})})}setupConnectionStatusListener(e){this._updateConnectionStatus(this.layer.getConnectionStatus()),this.addListener(r.BaseEvents.ConnectionStatusChange,t=>{this._updateConnectionStatus(t.status,e)},{dontSuppress:!0})}showAcknowledge(e,t){return new Promise(n=>{super.launchAckownledgeDialog(e,t,()=>n())})}requestConfirmation(e){return new Promise(t=>{const n=this.translateI18nItem(l.CommonMetadata.getI18nItem(l.CommonI18nKeys.ARE_YOU_SURE));super.launchConfirmationDialog(n,e,()=>t(!0),()=>t(!1))})}_updateConnectionStatus(e,t){this.connectionStatus=e,this.isOnline=e===a.ConnectionStatus.Connected,"function"==typeof t&&t({status:this.connectionStatus,online:this.isOnline})}}i([s.prop({type:String,attribute:!1,default:a.ConnectionStatus.Disconnected})],c.prototype,"connectionStatus",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],c.prototype,"isOnline",void 0),t.CTCLComponent=c},function(e,t,n){e.exports=n(242).default},function(e,t,n){"use strict";t.__esModule=!0;var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(243));var o=i.tokenize,s=i.options.Options;function r(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function a(e){return e.replace(/"/g,"&quot;")}function l(e){if(!e)return"";var t=[];for(var n in e){var i=e[n]+"";t.push(n+'="'+a(i)+'"')}return t.join(" ")}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=new s(t);for(var n=o(e),i=[],c=0;c<n.length;c++){var d=n[c];if("nl"===d.type&&t.nl2br)i.push("<br>\n");else if(d.isLink&&t.check(d)){var h=t.resolve(d),u=h.formatted,p=h.formattedHref,g=h.tagName,m=h.className,f=h.target,_=h.attributes,v="<"+g+' href="'+a(p)+'"';m&&(v+=' class="'+a(m)+'"'),f&&(v+=' target="'+a(f)+'"'),_&&(v+=" "+l(_)),v+=">"+r(u)+"</"+g+">",i.push(v)}else i.push(r(d.toString()))}return i.join("")}String.prototype.linkify||(String.prototype.linkify=function(e){return c(this,e)}),t.default=c},function(e,t,n){"use strict";t.__esModule=!0,t.tokenize=t.test=t.scanner=t.parser=t.options=t.inherits=t.find=void 0;var i=n(39),o=a(n(244)),s=a(n(245)),r=a(n(246));function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)});var l=function(e){return r.run(s.run(e))};t.find=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=l(e),i=[],o=0;o<n.length;o++){var s=n[o];!s.isLink||t&&s.type!==t||i.push(s.toObject())}return i},t.inherits=i.inherits,t.options=o,t.parser=r,t.scanner=s,t.test=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=l(e);return 1===n.length&&n[0].isLink&&(!t||n[0].type===t)},t.tokenize=l},function(e,t,n){"use strict";t.__esModule=!0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o={defaultProtocol:"http",events:null,format:r,formatHref:r,nl2br:!1,tagName:"a",target:function(e,t){return"url"===t?"_blank":null},validate:!0,ignoreTags:[],attributes:null,className:"linkified"};function s(e){e=e||{},this.defaultProtocol=e.defaultProtocol||o.defaultProtocol,this.events=e.events||o.events,this.format=e.format||o.format,this.formatHref=e.formatHref||o.formatHref,this.nl2br=e.nl2br||o.nl2br,this.tagName=e.tagName||o.tagName,this.target=e.target||o.target,this.validate=e.validate||o.validate,this.ignoreTags=[],this.attributes=e.attributes||e.linkAttributes||o.attributes,this.className=e.className||e.linkClass||o.className;for(var t=e.ignoreTags||o.ignoreTags,n=0;n<t.length;n++)this.ignoreTags.push(t[n].toUpperCase())}function r(e){return e}t.defaults=o,t.Options=s,t.contains=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1},s.prototype={resolve:function(e){var t=e.toHref(this.defaultProtocol);return{formatted:this.get("format",e.toString(),e),formattedHref:this.get("formatHref",t,e),tagName:this.get("tagName",t,e),className:this.get("className",t,e),target:this.get("target",t,e),events:this.getObject("events",t,e),attributes:this.getObject("attributes",t,e)}},check:function(e){return this.get("validate",e.toString(),e)},get:function(e,t,n){var s=this[e];if(!s)return s;switch(void 0===s?"undefined":i(s)){case"function":return s(t,n.type);case"object":var r=s[n.type]||o[e];return"function"==typeof r?r(t,n.type):r}return s},getObject:function(e,t,n){var i=this[e];return"function"==typeof i?i(t,n.type):i}}},function(e,t,n){"use strict";t.__esModule=!0,t.start=t.run=t.TOKENS=t.State=void 0;var i=n(81),o=n(46),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(o);var r="aaa|aarp|abb|abbott|abogado|ac|academy|accenture|accountant|accountants|aco|active|actor|ad|adac|ads|adult|ae|aeg|aero|af|afl|ag|agency|ai|aig|airforce|airtel|al|alibaba|alipay|allfinanz|alsace|am|amica|amsterdam|an|analytics|android|ao|apartments|app|apple|aq|aquarelle|ar|aramco|archi|army|arpa|arte|as|asia|associates|at|attorney|au|auction|audi|audio|author|auto|autos|avianca|aw|ax|axa|az|azure|ba|baidu|band|bank|bar|barcelona|barclaycard|barclays|bargains|bauhaus|bayern|bb|bbc|bbva|bcg|bcn|bd|be|beats|beer|bentley|berlin|best|bet|bf|bg|bh|bharti|bi|bible|bid|bike|bing|bingo|bio|biz|bj|black|blackfriday|bloomberg|blue|bm|bms|bmw|bn|bnl|bnpparibas|bo|boats|boehringer|bom|bond|boo|book|boots|bosch|bostik|bot|boutique|br|bradesco|bridgestone|broadway|broker|brother|brussels|bs|bt|budapest|bugatti|build|builders|business|buy|buzz|bv|bw|by|bz|bzh|ca|cab|cafe|cal|call|camera|camp|cancerresearch|canon|capetown|capital|car|caravan|cards|care|career|careers|cars|cartier|casa|cash|casino|cat|catering|cba|cbn|cc|cd|ceb|center|ceo|cern|cf|cfa|cfd|cg|ch|chanel|channel|chase|chat|cheap|chloe|christmas|chrome|church|ci|cipriani|circle|cisco|citic|city|cityeats|ck|cl|claims|cleaning|click|clinic|clinique|clothing|cloud|club|clubmed|cm|cn|co|coach|codes|coffee|college|cologne|com|commbank|community|company|compare|computer|comsec|condos|construction|consulting|contact|contractors|cooking|cool|coop|corsica|country|coupon|coupons|courses|cr|credit|creditcard|creditunion|cricket|crown|crs|cruises|csc|cu|cuisinella|cv|cw|cx|cy|cymru|cyou|cz|dabur|dad|dance|date|dating|datsun|day|dclk|de|dealer|deals|degree|delivery|dell|deloitte|delta|democrat|dental|dentist|desi|design|dev|diamonds|diet|digital|direct|directory|discount|dj|dk|dm|dnp|do|docs|dog|doha|domains|download|drive|dubai|durban|dvag|dz|earth|eat|ec|edeka|edu|education|ee|eg|email|emerck|energy|engineer|engineering|enterprises|epson|equipment|er|erni|es|esq|estate|et|eu|eurovision|eus|events|everbank|exchange|expert|exposed|express|fage|fail|fairwinds|faith|family|fan|fans|farm|fashion|fast|feedback|ferrero|fi|film|final|finance|financial|firestone|firmdale|fish|fishing|fit|fitness|fj|fk|flickr|flights|florist|flowers|flsmidth|fly|fm|fo|foo|football|ford|forex|forsale|forum|foundation|fox|fr|fresenius|frl|frogans|frontier|fund|furniture|futbol|fyi|ga|gal|gallery|gallup|game|garden|gb|gbiz|gd|gdn|ge|gea|gent|genting|gf|gg|ggee|gh|gi|gift|gifts|gives|giving|gl|glass|gle|global|globo|gm|gmail|gmbh|gmo|gmx|gn|gold|goldpoint|golf|goo|goog|google|gop|got|gov|gp|gq|gr|grainger|graphics|gratis|green|gripe|group|gs|gt|gu|gucci|guge|guide|guitars|guru|gw|gy|hamburg|hangout|haus|hdfcbank|health|healthcare|help|helsinki|here|hermes|hiphop|hitachi|hiv|hk|hm|hn|hockey|holdings|holiday|homedepot|homes|honda|horse|host|hosting|hoteles|hotmail|house|how|hr|hsbc|ht|hu|hyundai|ibm|icbc|ice|icu|id|ie|ifm|iinet|il|im|immo|immobilien|in|industries|infiniti|info|ing|ink|institute|insurance|insure|int|international|investments|io|ipiranga|iq|ir|irish|is|iselect|ist|istanbul|it|itau|iwc|jaguar|java|jcb|je|jetzt|jewelry|jlc|jll|jm|jmp|jo|jobs|joburg|jot|joy|jp|jpmorgan|jprs|juegos|kaufen|kddi|ke|kerryhotels|kerrylogistics|kerryproperties|kfh|kg|kh|ki|kia|kim|kinder|kitchen|kiwi|km|kn|koeln|komatsu|kp|kpn|kr|krd|kred|kuokgroup|kw|ky|kyoto|kz|la|lacaixa|lamborghini|lamer|lancaster|land|landrover|lanxess|lasalle|lat|latrobe|law|lawyer|lb|lc|lds|lease|leclerc|legal|lexus|lgbt|li|liaison|lidl|life|lifeinsurance|lifestyle|lighting|like|limited|limo|lincoln|linde|link|live|living|lixil|lk|loan|loans|local|locus|lol|london|lotte|lotto|love|lr|ls|lt|ltd|ltda|lu|lupin|luxe|luxury|lv|ly|ma|madrid|maif|maison|makeup|man|management|mango|market|marketing|markets|marriott|mba|mc|md|me|med|media|meet|melbourne|meme|memorial|men|menu|meo|mg|mh|miami|microsoft|mil|mini|mk|ml|mm|mma|mn|mo|mobi|mobily|moda|moe|moi|mom|monash|money|montblanc|mormon|mortgage|moscow|motorcycles|mov|movie|movistar|mp|mq|mr|ms|mt|mtn|mtpc|mtr|mu|museum|mutuelle|mv|mw|mx|my|mz|na|nadex|nagoya|name|natura|navy|nc|ne|nec|net|netbank|network|neustar|new|news|nexus|nf|ng|ngo|nhk|ni|nico|nikon|ninja|nissan|nl|no|nokia|norton|nowruz|np|nr|nra|nrw|ntt|nu|nyc|nz|obi|office|okinawa|om|omega|one|ong|onl|online|ooo|oracle|orange|org|organic|origins|osaka|otsuka|ovh|pa|page|pamperedchef|panerai|paris|pars|partners|parts|party|passagens|pe|pet|pf|pg|ph|pharmacy|philips|photo|photography|photos|physio|piaget|pics|pictet|pictures|pid|pin|ping|pink|pizza|pk|pl|place|play|playstation|plumbing|plus|pm|pn|pohl|poker|porn|post|pr|praxi|press|pro|prod|productions|prof|promo|properties|property|protection|ps|pt|pub|pw|pwc|py|qa|qpon|quebec|quest|racing|re|read|realtor|realty|recipes|red|redstone|redumbrella|rehab|reise|reisen|reit|ren|rent|rentals|repair|report|republican|rest|restaurant|review|reviews|rexroth|rich|ricoh|rio|rip|ro|rocher|rocks|rodeo|room|rs|rsvp|ru|ruhr|run|rw|rwe|ryukyu|sa|saarland|safe|safety|sakura|sale|salon|samsung|sandvik|sandvikcoromant|sanofi|sap|sapo|sarl|sas|saxo|sb|sbs|sc|sca|scb|schaeffler|schmidt|scholarships|school|schule|schwarz|science|scor|scot|sd|se|seat|security|seek|select|sener|services|seven|sew|sex|sexy|sfr|sg|sh|sharp|shell|shia|shiksha|shoes|show|shriram|si|singles|site|sj|sk|ski|skin|sky|skype|sl|sm|smile|sn|sncf|so|soccer|social|softbank|software|sohu|solar|solutions|song|sony|soy|space|spiegel|spot|spreadbetting|sr|srl|st|stada|star|starhub|statefarm|statoil|stc|stcgroup|stockholm|storage|store|studio|study|style|su|sucks|supplies|supply|support|surf|surgery|suzuki|sv|swatch|swiss|sx|sy|sydney|symantec|systems|sz|tab|taipei|taobao|tatamotors|tatar|tattoo|tax|taxi|tc|tci|td|team|tech|technology|tel|telecity|telefonica|temasek|tennis|tf|tg|th|thd|theater|theatre|tickets|tienda|tiffany|tips|tires|tirol|tj|tk|tl|tm|tmall|tn|to|today|tokyo|tools|top|toray|toshiba|total|tours|town|toyota|toys|tp|tr|trade|trading|training|travel|travelers|travelersinsurance|trust|trv|tt|tube|tui|tunes|tushu|tv|tvs|tw|tz|ua|ubs|ug|uk|unicom|university|uno|uol|us|uy|uz|va|vacations|vana|vc|ve|vegas|ventures|verisign|versicherung|vet|vg|vi|viajes|video|viking|villas|vin|vip|virgin|vision|vista|vistaprint|viva|vlaanderen|vn|vodka|volkswagen|vote|voting|voto|voyage|vu|vuelos|wales|walter|wang|wanggou|watch|watches|weather|weatherchannel|webcam|weber|website|wed|wedding|weir|wf|whoswho|wien|wiki|williamhill|win|windows|wine|wme|wolterskluwer|work|works|world|ws|wtc|wtf|xbox|xerox|xin|xperia|xxx|xyz|yachts|yahoo|yamaxun|yandex|ye|yodobashi|yoga|yokohama|youtube|yt|za|zara|zero|zip|zm|zone|zuerich|zw".split("|"),a="0123456789".split(""),l="0123456789abcdefghijklmnopqrstuvwxyz".split(""),c=[" ","\f","\r","\t","\v","","",""],d=[],h=function(e){return new i.CharacterState(e)},u=h(),p=h(o.NUM),g=h(o.DOMAIN),m=h(),f=h(o.WS);u.on("@",h(o.AT)).on(".",h(o.DOT)).on("+",h(o.PLUS)).on("#",h(o.POUND)).on("?",h(o.QUERY)).on("/",h(o.SLASH)).on("_",h(o.UNDERSCORE)).on(":",h(o.COLON)).on("{",h(o.OPENBRACE)).on("[",h(o.OPENBRACKET)).on("<",h(o.OPENANGLEBRACKET)).on("(",h(o.OPENPAREN)).on("}",h(o.CLOSEBRACE)).on("]",h(o.CLOSEBRACKET)).on(">",h(o.CLOSEANGLEBRACKET)).on(")",h(o.CLOSEPAREN)).on("&",h(o.AMPERSAND)).on([",",";","!",'"',"'"],h(o.PUNCTUATION)),u.on("\n",h(o.NL)).on(c,f),f.on(c,f);for(var _=0;_<r.length;_++){var v=(0,i.stateify)(r[_],u,o.TLD,o.DOMAIN);d.push.apply(d,v)}var y=(0,i.stateify)("file",u,o.DOMAIN,o.DOMAIN),C=(0,i.stateify)("ftp",u,o.DOMAIN,o.DOMAIN),w=(0,i.stateify)("http",u,o.DOMAIN,o.DOMAIN),b=(0,i.stateify)("mailto",u,o.DOMAIN,o.DOMAIN);d.push.apply(d,y),d.push.apply(d,C),d.push.apply(d,w);var E=y.pop(),T=C.pop(),R=w.pop(),I=b.pop(),A=h(o.DOMAIN),S=h(o.PROTOCOL),x=h(o.MAILTO);T.on("s",A).on(":",S),R.on("s",A).on(":",S),d.push(A),E.on(":",S),A.on(":",S),I.on(":",x);var O=(0,i.stateify)("localhost",u,o.LOCALHOST,o.DOMAIN);d.push.apply(d,O),u.on(a,p),p.on("-",m).on(a,p).on(l,g),g.on("-",m).on(l,g);for(var M=0;M<d.length;M++)d[M].on("-",m).on(l,g);m.on("-",m).on(a,g).on(l,g),u.defaultTransition=h(o.SYM);var L=u;t.State=i.CharacterState,t.TOKENS=s,t.run=function(e){for(var t=e.replace(/[A-Z]/g,function(e){return e.toLowerCase()}),n=e.length,i=[],o=0;o<n;){for(var s=u,r=null,a=0,l=null,c=-1;o<n&&(r=s.next(t[o]));)(s=r).accepts()?(c=0,l=s):c>=0&&c++,a++,o++;if(!(c<0)){o-=c,a-=c;var d=l.emit();i.push(new d(e.substr(o-a,a)))}}return i},t.start=L},function(e,t,n){"use strict";t.__esModule=!0,t.start=t.run=t.TOKENS=t.State=void 0;var i=n(81),o=n(46),s=(a(o),n(247)),r=a(s);function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var l=function(e){return new i.TokenState(e)},c=l(),d=l(),h=l(),u=l(),p=l(),g=l(),m=l(),f=l(s.URL),_=l(),v=l(s.URL),y=l(s.URL),C=l(),w=l(),b=l(),E=l(),T=l(),R=l(s.URL),I=l(s.URL),A=l(s.URL),S=l(s.URL),x=l(),O=l(),M=l(),L=l(),N=l(),D=l(),P=l(s.EMAIL),k=l(),U=l(s.EMAIL),j=l(s.MAILTOEMAIL),F=l(),B=l(),G=l(),H=l(),q=l(s.NL);c.on(o.NL,q).on(o.PROTOCOL,d).on(o.MAILTO,h).on(o.SLASH,u),d.on(o.SLASH,u),u.on(o.SLASH,p),c.on(o.TLD,g).on(o.DOMAIN,g).on(o.LOCALHOST,f).on(o.NUM,g),p.on(o.TLD,y).on(o.DOMAIN,y).on(o.NUM,y).on(o.LOCALHOST,y),g.on(o.DOT,m),N.on(o.DOT,D),m.on(o.TLD,f).on(o.DOMAIN,g).on(o.NUM,g).on(o.LOCALHOST,g),D.on(o.TLD,P).on(o.DOMAIN,N).on(o.NUM,N).on(o.LOCALHOST,N),f.on(o.DOT,m),P.on(o.DOT,D),f.on(o.COLON,_).on(o.SLASH,y),_.on(o.NUM,v),v.on(o.SLASH,y),P.on(o.COLON,k),k.on(o.NUM,U);var $=[o.DOMAIN,o.AT,o.LOCALHOST,o.NUM,o.PLUS,o.POUND,o.PROTOCOL,o.SLASH,o.TLD,o.UNDERSCORE,o.SYM,o.AMPERSAND],z=[o.COLON,o.DOT,o.QUERY,o.PUNCTUATION,o.CLOSEBRACE,o.CLOSEBRACKET,o.CLOSEANGLEBRACKET,o.CLOSEPAREN,o.OPENBRACE,o.OPENBRACKET,o.OPENANGLEBRACKET,o.OPENPAREN];y.on(o.OPENBRACE,w).on(o.OPENBRACKET,b).on(o.OPENANGLEBRACKET,E).on(o.OPENPAREN,T),C.on(o.OPENBRACE,w).on(o.OPENBRACKET,b).on(o.OPENANGLEBRACKET,E).on(o.OPENPAREN,T),w.on(o.CLOSEBRACE,y),b.on(o.CLOSEBRACKET,y),E.on(o.CLOSEANGLEBRACKET,y),T.on(o.CLOSEPAREN,y),R.on(o.CLOSEBRACE,y),I.on(o.CLOSEBRACKET,y),A.on(o.CLOSEANGLEBRACKET,y),S.on(o.CLOSEPAREN,y),x.on(o.CLOSEBRACE,y),O.on(o.CLOSEBRACKET,y),M.on(o.CLOSEANGLEBRACKET,y),L.on(o.CLOSEPAREN,y),w.on($,R),b.on($,I),E.on($,A),T.on($,S),w.on(z,x),b.on(z,O),E.on(z,M),T.on(z,L),R.on($,R),I.on($,I),A.on($,A),S.on($,S),R.on(z,R),I.on(z,I),A.on(z,A),S.on(z,S),x.on($,R),O.on($,I),M.on($,A),L.on($,S),x.on(z,x),O.on(z,O),M.on(z,M),L.on(z,L),y.on($,y),C.on($,y),y.on(z,C),C.on(z,C),h.on(o.TLD,j).on(o.DOMAIN,j).on(o.NUM,j).on(o.LOCALHOST,j),j.on($,j).on(z,F),F.on($,j).on(z,F);var V=[o.DOMAIN,o.NUM,o.PLUS,o.POUND,o.QUERY,o.UNDERSCORE,o.SYM,o.AMPERSAND,o.TLD];g.on(V,B).on(o.AT,G),f.on(V,B).on(o.AT,G),m.on(V,B),B.on(V,B).on(o.AT,G).on(o.DOT,H),H.on(V,B),G.on(o.TLD,N).on(o.DOMAIN,N).on(o.LOCALHOST,P);t.State=i.TokenState,t.TOKENS=r,t.run=function(e){for(var t=e.length,n=0,i=[],o=[];n<t;){for(var r=c,a=null,l=null,d=0,h=null,u=-1;n<t&&!(a=r.next(e[n]));)o.push(e[n++]);for(;n<t&&(l=a||r.next(e[n]));)a=null,(r=l).accepts()?(u=0,h=r):u>=0&&u++,n++,d++;if(u<0)for(var p=n-d;p<n;p++)o.push(e[p]);else{o.length>0&&(i.push(new s.TEXT(o)),o=[]),n-=u,d-=u;var g=h.emit();i.push(new g(e.slice(n-d,n)))}}return o.length>0&&i.push(new s.TEXT(o)),i},t.start=c},function(e,t,n){"use strict";t.__esModule=!0,t.URL=t.TEXT=t.NL=t.EMAIL=t.MAILTOEMAIL=t.Base=void 0;var i=n(82),o=n(39),s=n(46);function r(e){return e instanceof s.DOMAIN||e instanceof s.TLD}var a=(0,i.createTokenClass)();a.prototype={type:"token",isLink:!1,toString:function(){for(var e=[],t=0;t<this.v.length;t++)e.push(this.v[t].toString());return e.join("")},toHref:function(){return this.toString()},toObject:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http";return{type:this.type,value:this.toString(),href:this.toHref(e)}}};var l=(0,o.inherits)(a,(0,i.createTokenClass)(),{type:"email",isLink:!0}),c=(0,o.inherits)(a,(0,i.createTokenClass)(),{type:"email",isLink:!0,toHref:function(){this.v;return"mailto:"+this.toString()}}),d=(0,o.inherits)(a,(0,i.createTokenClass)(),{type:"text"}),h=(0,o.inherits)(a,(0,i.createTokenClass)(),{type:"nl"}),u=(0,o.inherits)(a,(0,i.createTokenClass)(),{type:"url",isLink:!0,toHref:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http",t=!1,n=!1,i=this.v,o=[],a=0;i[a]instanceof s.PROTOCOL;)t=!0,o.push(i[a].toString().toLowerCase()),a++;for(;i[a]instanceof s.SLASH;)n=!0,o.push(i[a].toString()),a++;for(;r(i[a]);)o.push(i[a].toString().toLowerCase()),a++;for(;a<i.length;a++)o.push(i[a].toString());return o=o.join(""),t||n||(o=e+"://"+o),o},hasProtocol:function(){return this.v[0]instanceof s.PROTOCOL}});t.Base=a,t.MAILTOEMAIL=l,t.EMAIL=c,t.NL=h,t.TEXT=d,t.URL=u},function(e,t,n){var i=n(249);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: block;\n  width: 100%; }\n  :host div.container ct-button {\n    font-size: 1.4em; }\n  :host div.container div.sheet-bg {\n    display: flex;\n    position: absolute;\n    top: 0;\n    left: 0;\n    height: 100%;\n    width: 100%;\n    background-color: rgba(0, 0, 0, 0.3);\n    transition: all 0.1s ease-in;\n    opacity: 1;\n    overflow: hidden; }\n    :host div.container div.sheet-bg.hidden {\n      opacity: 0;\n      pointer-events: none; }\n    :host div.container div.sheet-bg div.sheet-buttons {\n      display: flex;\n      flex-direction: column;\n      justify-content: flex-end;\n      flex: 1;\n      padding: 10px 20px;\n      max-width: 100%; }\n      :host div.container div.sheet-bg div.sheet-buttons div.inner-sheet-buttons {\n        transform: translateY(0);\n        transition: all 0.3s ease-in-out; }\n        :host div.container div.sheet-bg div.sheet-buttons div.inner-sheet-buttons div.title {\n          background-color: var(--action-sheet-button-bg, #fff);\n          color: var(--button-primary-bg, #000000);\n          display: flex;\n          align-content: center;\n          justify-content: center;\n          height: 40px;\n          line-height: 40px;\n          border-top-left-radius: 10px;\n          border-top-right-radius: 10px;\n          border-bottom-left-radius: 0;\n          border-bottom-right-radius: 0;\n          overflow: hidden;\n          padding: 0 20px;\n          text-align: center;\n          border-bottom: 1px solid var(--action-sheet-border-color, #d9d9d9);\n          color: var(--action-sheet-subtitle-color, #828688); }\n          :host div.container div.sheet-bg div.sheet-buttons div.inner-sheet-buttons div.title p {\n            white-space: nowrap;\n            text-overflow: ellipsis;\n            overflow: hidden;\n            margin: 0; }\n        :host div.container div.sheet-bg div.sheet-buttons div.inner-sheet-buttons div.inner-buttons,\n        :host div.container div.sheet-bg div.sheet-buttons div.inner-sheet-buttons div.close {\n          border-radius: 10px;\n          overflow: hidden; }\n          :host div.container div.sheet-bg div.sheet-buttons div.inner-sheet-buttons div.inner-buttons ct-button,\n          :host div.container div.sheet-bg div.sheet-buttons div.inner-sheet-buttons div.close ct-button {\n            border-bottom: 1px solid var(--action-sheet-border-color, #d9d9d9);\n            border-radius: 0; }\n            :host div.container div.sheet-bg div.sheet-buttons div.inner-sheet-buttons div.inner-buttons ct-button:last-child,\n            :host div.container div.sheet-bg div.sheet-buttons div.inner-sheet-buttons div.close ct-button:last-child {\n              border-bottom: 0; }\n        :host div.container div.sheet-bg div.sheet-buttons div.inner-sheet-buttons div.close {\n          margin-top: 10px; }\n        :host div.container div.sheet-bg div.sheet-buttons div.inner-sheet-buttons.hidden {\n          transform: translateY(100%); }\n",""])},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(14),a=n(8);class l extends s.CTLayerComponent{static get is(){return"ct-alert-modal-manager"}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){this.addListener(r.BaseEvents._Request_RaiseAlert,e=>this.raiseAlert(e)),this.addListener(r.BaseEvents._Request_CloseAlert,e=>this.dismissAlertById(e))}get generateComponentStyles(){return n(251)}generateComponentMarkup(){return window.__CTRender("div",{class:"alerts"},this.alerts.map((e,t)=>window.__CTRender(a.CTAlertModal,{id:e.id||this.defaultAlerts.generateId(),raisedOn:e.raisedOn,priority:e.priority,type:e.type,title:e.title,body:e.body,buttons:e.buttons,remaining:this.alerts.length,positionInStack:t,showLoadingAnimation:e.showLoadingAnimation})))}raiseAlert(e){if(e){if(e.buttons)for(const t of e.buttons)if(t.action){const e=t.action.bind(this);t.action=(n=>{e(n),t.stopAutoDismiss||this.dismissAlert()})}else t.action=(()=>this.dismissAlert());this.alerts=[...this.alerts,e],this.alertsToShow=!0}}dismissAlert(e=0){this.alerts.splice(e,1),0===this.alerts.length?this.alertsToShow=!1:this.alerts=this.alerts.map((e,t)=>(e.remaining=this.alerts.length,e))}dismissAlertById(e){const t=this.alerts.findIndex(t=>t.id===e);-1!==t&&this.dismissAlert(t)}}i([s.prop({type:Boolean,attribute:!0,default:!1})],l.prototype,"alertsToShow",void 0),i([s.prop({type:Array,attribute:!1,default:[]})],l.prototype,"alerts",void 0),t.CTAlertModalManager=l,l.register()},function(e,t,n){var i=n(252);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: none;\n  width: 100%;\n  height: 100%;\n  background: var(--modal-overlay, rgba(0, 0, 0, 0.5));\n  position: fixed;\n  top: 0;\n  z-index: 9999999;\n  padding: 20px;\n  overflow: auto; }\n  :host .alerts {\n    display: flex;\n    width: 100%;\n    max-width: 420px;\n    margin: auto;\n    position: relative; }\n\n:host([alerts-to-show]) {\n  display: flex; }\n",""])},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(60),a=n(8),l=n(13),c=n(0),d=n(14);class h extends s.CTLayerComponent{static get is(){return"ct-alert-modal"}initialize(){return o(this,void 0,void 0,function*(){this.isOffline=this.layer.getConnectionStatus()===c.ConnectionStatus.Disconnected})}setupListeners(){this.addListener(d.BaseEvents.ConnectionStatusChange,e=>{switch(e.status){case c.ConnectionStatus.Connected:this.isOffline=!1;break;case c.ConnectionStatus.Disconnected:this.isOffline=!0}})}get generateComponentStyles(){return n(254)}generateComponentMarkup(){const e=r.Icons.COMMON.LoadingSpinner,t=5*this.positionInStack;return this.style.right=`${t}px`,this.style.bottom=`${t}px`,this.style.zIndex=`${this.remaining-this.positionInStack}`,0===this.positionInStack?this.showing=!0:this.stacked=!0,window.__CTRender("div",{"alert-id":this.id,class:`alert-dialog ${this.type}`},this.remaining>1&&this.showing?window.__CTRender("div",{class:"remaining"},this.remaining):null,window.__CTRender("div",{class:"title"},this.renderHtml(this.title,"alert_modal_title")),window.__CTRender("div",{class:"body"},l.renderIf(this.showLoadingAnimation,window.__CTRender(a.CTIcon,{class:"loading",width:"18",height:"18",spin:!0,icon:e})),window.__CTRender("div",{class:"message"},this.renderHtml(this.body,"alert_modal_body"))),l.renderIf(!!this.buttons&&this.buttons.length>0,window.__CTRender("div",{class:"buttons"},this.buttons.map((e,t)=>window.__CTRender(a.CTButton,{type:e.type,class:`${this.buttons.length>2?"overflex":""} ${2===this.buttons.length&&0===t?"right-border":""}`,onClick:t=>e.action(t.target.textContent),disabled:!(!e.disableWhenOffline||!this.isOffline),autoFocus:e.autoFocus},e.text)))))}}i([s.prop({type:Boolean,attribute:!0,default:!1})],h.prototype,"showing",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],h.prototype,"stacked",void 0),i([s.prop({type:String,attribute:!1,default:0})],h.prototype,"id",void 0),i([s.prop({type:Number,attribute:!1,default:0})],h.prototype,"raisedOn",void 0),i([s.prop({type:Number,attribute:!1,default:0})],h.prototype,"priority",void 0),i([s.prop({type:String,attribute:!1,default:"info"})],h.prototype,"type",void 0),i([s.prop({type:String,attribute:!1,default:""})],h.prototype,"title",void 0),i([s.prop({type:String,attribute:!1,default:""})],h.prototype,"body",void 0),i([s.prop({type:Array,attribute:!1,default:[]})],h.prototype,"buttons",void 0),i([s.prop({type:Number,attribute:!1,default:0})],h.prototype,"remaining",void 0),i([s.prop({type:Number,attribute:!1,default:0})],h.prototype,"positionInStack",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],h.prototype,"showLoadingAnimation",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],h.prototype,"isOffline",void 0),t.CTAlertModal=h,h.register()},function(e,t,n){var i=n(255);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: none;\n  width: 100%;\n  height: 100%;\n  flex-direction: column;\n  background-color: var(--modal-bg, #ffffff); }\n  :host .alert-dialog {\n    overflow: hidden; }\n    :host .alert-dialog .remaining {\n      position: absolute;\n      width: 35px;\n      height: 35px;\n      background-color: red;\n      border-radius: 50%;\n      text-align: center;\n      line-height: 35px;\n      color: white;\n      right: -5%;\n      top: -5%; }\n    :host .alert-dialog .title {\n      display: flex;\n      justify-content: center;\n      text-align: center;\n      font-size: 16px;\n      text-transform: uppercase;\n      margin: 0 auto;\n      padding: 10px; }\n    :host .alert-dialog .body {\n      display: flex;\n      justify-content: center;\n      text-align: center;\n      align-items: flex-start;\n      font-size: 18px;\n      font-weight: 300;\n      padding: 50px; }\n      :host .alert-dialog .body ct-icon {\n        flex: none;\n        margin: 3px 10px 0 0; }\n    :host .alert-dialog .buttons {\n      padding: 10px 5px;\n      flex: none;\n      display: flex;\n      flex-wrap: wrap;\n      flex-direction: row;\n      justify-content: space-between; }\n      :host .alert-dialog .buttons ct-button {\n        flex: 1;\n        margin: 0 5px;\n        border-radius: 0; }\n        :host .alert-dialog .buttons ct-button.overflex {\n          flex-basis: 100%; }\n          :host .alert-dialog .buttons ct-button.overflex + ct-button {\n            margin-top: 10px; }\n    :host .alert-dialog.error .title {\n      background-color: var(--alert-error-bg, #c80031);\n      color: var(--alert-error-text, #ffffff); }\n    :host .alert-dialog.info .title {\n      background-color: var(--alert-info-bg, #15233b);\n      color: var(--alert-info-text, #ffffff); }\n    :host .alert-dialog.question .title {\n      background-color: var(--alert-question-bg, #15233b);\n      color: var(--alert-question-text, #ffffff); }\n    :host .alert-dialog.success .title {\n      background-color: var(--alert-success-bg, #bcdf90);\n      color: var(--alert-success-text, #ffffff); }\n\n:host([showing]) {\n  display: flex;\n  z-index: 10; }\n\n:host([stacked]) {\n  display: flex;\n  position: absolute;\n  bottom: 5px;\n  right: 5px;\n  z-index: 1; }\n  :host([stacked]):before {\n    content: '';\n    display: block;\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.25); }\n",""])},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(13);class a extends s.CTLayerComponent{static get is(){return"ct-avatar-tile"}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return n(257)}generateComponentMarkup(){const e=["avatar-tile"];this.hatched&&e.push("hatched");const t=r.buildStyles({height:this.height||"auto",borderBottom:this.border?"":"0px"});return window.__CTRender("div",{class:e.join(" "),style:t},window.__CTRender("div",{class:"avatar",style:this.avatarStyle},window.__CTRender("slot",{name:"avatar"})),window.__CTRender("div",{class:"detail",style:this.detailStyle},window.__CTRender("slot",null)),window.__CTRender("slot",{name:"additional"}))}}i([s.prop({type:String,attribute:!1,default:null})],a.prototype,"height",void 0),i([s.prop({type:s.Stroolean,attribute:!1,default:!1})],a.prototype,"hatched",void 0),i([s.prop({type:s.Stroolean,attribute:!1,default:!0})],a.prototype,"border",void 0),i([s.prop({type:Object,attribute:!1,default:{}})],a.prototype,"detailStyle",void 0),i([s.prop({type:Object,attribute:!1,default:{}})],a.prototype,"avatarStyle",void 0),t.CTAvatarTile=a,a.register()},function(e,t,n){var i=n(258);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: block; }\n  :host .avatar-tile {\n    position: relative;\n    display: flex;\n    align-items: center;\n    padding: var(--avatar-tile-padding, 6px 10px);\n    color: var(--default-font-color, #212121);\n    background-color: var(--list-item-bg, #ffffff);\n    border-bottom: var(--list-item-border, 1px solid #dddddd); }\n    :host .avatar-tile .avatar {\n      flex: none;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: center; }\n      :host .avatar-tile .avatar ::slotted(*) {\n        margin: 0 10px 0 0; }\n      @media only screen and (min-width: 960px) {\n        :host .avatar-tile .avatar {\n          flex: 0 0 10%;\n          justify-content: flex-start;\n          flex-direction: row;\n          flex-basis: 6vw; } }\n    :host .avatar-tile .detail {\n      flex: 1 1 auto;\n      display: flex;\n      flex-direction: column;\n      overflow: hidden; }\n      @media only screen and (min-width: 960px) {\n        :host .avatar-tile .detail {\n          flex-direction: row; }\n          :host .avatar-tile .detail slot {\n            display: flex;\n            flex: 1; }\n            :host .avatar-tile .detail slot::slotted(.name) {\n              flex: 1 1 20% !important;\n              align-items: center;\n              margin: auto 0; }\n            :host .avatar-tile .detail slot::slotted(.job-title), :host .avatar-tile .detail slot::slotted(.group) {\n              display: flex;\n              flex: 1 0 35%;\n              align-items: center; } }\n    :host .avatar-tile.hatched {\n      background-size: 5px 5px;\n      background-image: linear-gradient(45deg, rgba(0, 0, 0, 0) 46%, #d8d8d8 49%, #d8d8d8 51%, rgba(0, 0, 0, 0) 55%); }\n",""])},function(e,t,n){var i=n(260);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n@keyframes ripple {\n  100% {\n    transform: scale(2);\n    opacity: 0; } }\n\n:host {\n  display: block;\n  position: relative;\n  border-radius: 10px;\n  overflow: hidden; }\n  :host button {\n    position: relative;\n    background: transparent;\n    color: #000;\n    padding: 0.55em 1em;\n    border: 1px solid transparent;\n    font-family: inherit;\n    font-size: inherit;\n    font-weight: inherit;\n    outline: none;\n    cursor: pointer;\n    overflow: hidden;\n    width: 100%;\n    height: 100%;\n    min-height: 45px;\n    border-radius: inherit; }\n    :host button .button-content {\n      pointer-events: none;\n      display: inline-flex;\n      justify-content: center;\n      align-items: center; }\n      :host button .button-content .icon {\n        display: block; }\n      :host button .button-content .righticon {\n        padding-left: 9px;\n        margin-top: 2px; }\n      :host button .button-content .label {\n        display: block; }\n      :host button .button-content .icon + .label {\n        margin: 0 0 0 5px; }\n    :host button .ripple {\n      background-color: white;\n      border-radius: 50%;\n      opacity: 0.4;\n      transform: scale(0.01);\n      position: absolute;\n      pointer-events: none; }\n      :host button .ripple.animate {\n        animation: ripple 0.6s ease-out; }\n    :host button.primary {\n      background-color: var(--button-primary-bg, #000000);\n      border: var(--button-primary-border, 1px solid #000000);\n      color: var(--button-primary-text, #ffffff); }\n      :host button.primary .ripple {\n        background-color: var(--button-primary-ripple, #ffffff); }\n    :host button.secondary {\n      background-color: var(--button-secondary-bg, transparent);\n      border: var(--button-secondary-border, 1px solid #000000);\n      color: var(--button-secondary-text, #000000); }\n      :host button.secondary .ripple {\n        background-color: var(--button-secondary-ripple, #000000); }\n    :host button.tertiary {\n      background-color: var(--button-tertiary-bg, #ddd);\n      border: var(--button-tertiary-border, 1px solid #ddd);\n      color: var(--button-tertiary-text, #000000); }\n      :host button.tertiary .ripple {\n        background-color: var(--button-tertiary-ripple, #ffffff); }\n    :host button.invert-primary {\n      background: var(--button-invert-primary-bg, #ffffff);\n      border: var(--button-invert-primary-border, 1px solid #ffffff);\n      color: var(--button-invert-primary-text, #2c394e); }\n      :host button.invert-primary .ripple {\n        background-color: var(--button-invert-primary-ripple, #2c394e); }\n    :host button.invert-secondary {\n      background: var(--button-invert-secondary-bg, transparent);\n      border: var(--button-invert-secondary-border, 1px solid #ffffff);\n      color: var(--button-invert-secondary-text, #ffffff); }\n      :host button.invert-secondary .ripple {\n        background-color: var(--button-invert-secondary-ripple, #ffffff); }\n    :host button.selected {\n      background-color: var(--button-selected-bg, #15233b);\n      border: var(--button-selected-border, 1px solid #15233b);\n      color: var(--button-selected-text, #ffffff); }\n      :host button.selected .ripple {\n        background-color: var(--button-selected-ripple, #ffffff); }\n    :host button.cancel {\n      background-color: var(--button-cancel-bg, transparent);\n      border: var(--button-cancel-border, 1px solid #ffffff);\n      color: var(--button-cancel-text, #000000); }\n      :host button.cancel .ripple {\n        background-color: var(--button-cancel-ripple, #000000); }\n    :host button.warning {\n      background-color: var(--button-warning-bg, #fdb851);\n      border: var(--button-warning-border, #fdb851);\n      color: var(--button-warning-text, #ffffff); }\n      :host button.warning .ripple {\n        background-color: var(--button-warning-ripple, #ffffff); }\n    :host button.dangerous {\n      background-color: var(--button-dangerous-bg, #f24647);\n      border: var(--button-dangerous-border, #f24647);\n      color: var(--button-dangerous-text, #ffffff); }\n      :host button.dangerous .ripple {\n        background-color: var(--button-dangerous-ripple, #ffffff); }\n    :host button.headerBack {\n      background-color: #231f20;\n      border: none;\n      color: white; }\n      :host button.headerBack .ripple {\n        background-color: white; }\n    :host button.transparent {\n      background-color: transparent;\n      border: none; }\n    :host button.large {\n      padding: 1.25em 1em; }\n    :host button[disabled] {\n      opacity: 0.5;\n      cursor: not-allowed; }\n    :host button.action-sheet {\n      background-color: var(--action-sheet-button-bg, #fff);\n      color: var(--button-primary-bg, #000000); }\n      :host button.action-sheet div.label {\n        display: flex;\n        flex-direction: column;\n        justify-content: flex-start; }\n      @media (pointer: fine) {\n        :host button.action-sheet {\n          transition: filter 0.3s ease-out; }\n          :host button.action-sheet:hover {\n            filter: brightness(95%); } }\n    :host button.account-take {\n      background-color: transparent;\n      border: 1px solid var(--button-primary-bg, #000000);\n      color: var(--button-primary-bg, #000000);\n      padding: 5px 0;\n      min-height: 30px;\n      min-width: 90px;\n      font-weight: bold; }\n    :host button.account-waiting {\n      background-color: black;\n      border: 1px solid black;\n      color: white;\n      padding: 5px 0;\n      min-height: 30px;\n      min-width: 90px;\n      font-weight: bold; }\n    :host button.account-release {\n      background-color: transparent;\n      border: 1px solid var(--button-dangerous-bg, #f24647);\n      color: var(--button-dangerous-bg, #f24647);\n      padding: 5px 0;\n      min-height: 30px;\n      min-width: 90px;\n      font-weight: bold; }\n      :host button.account-release::slotted {\n        color: var(--button-dangerous-bg, #f24647); }\n\n::slotted(p) {\n  margin: 0; }\n\n::slotted(p.hasSubtitle) {\n  padding-top: 6px; }\n\n::slotted(span) {\n  padding-bottom: 10px;\n  font-size: 0.7em;\n  color: var(--action-sheet-subtitle-color, #828688); }\n",""])},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(19),s=n(12),r=n(8);class a extends s.CTCLComponent{constructor(){super(...arguments),this.ALL_LOGGERS_TOKEN="_all_",this._loggingTypes=Object.values(o.LoggerTypes).filter((e,t)=>t%2==0),this._selectedLoggingTypes=[]}static get is(){return"ct-debugger"}initialize(){return i(this,void 0,void 0,function*(){this._selectedLoggingTypes=this.layer.logger.getTypes()})}setupListeners(){}get generateComponentStyles(){return n(262)}generateComponentMarkup(){return window.__CTRender("div",{class:"debugger"},this._renderLoggingOptions(),this._renderResetOptions())}_renderLoggingOptions(){const e=this.layer.logger.hasInitialTypes();return window.__CTRender("div",{class:"section logging"},window.__CTRender("div",{class:"heading"},"Logging"),window.__CTRender("div",{class:"buttons"},window.__CTRender(r.CTButton,{class:"button",type:"secondary",width:"auto",onClick:this._enableAllLogging.bind(this)},"All"),window.__CTRender(r.CTButton,{class:"button",type:"secondary",width:"auto",onClick:this._disableAllLogging.bind(this)},"None"),e&&window.__CTRender(r.CTButton,{class:"button",type:"secondary",width:"auto",onClick:this._resetAllLogging.bind(this)},"Reset")),window.__CTRender("div",{class:"options"},this._loggingTypes.map(e=>{const t=this._selectedLoggingTypes.includes(e)||this._selectedLoggingTypes.includes(this.ALL_LOGGERS_TOKEN);return window.__CTRender("div",{key:e,class:"option"},window.__CTRender("label",{htmlFor:e},window.__CTRender("input",{type:"checkbox",id:e,checked:t,onChange:()=>this._onChangeLoggingType(e)})," ",e))})))}_renderResetOptions(){return window.__CTRender("div",{class:"section reset"},window.__CTRender("div",{class:"heading"},"App reset"),window.__CTRender("div",{class:"buttons"},window.__CTRender(r.CTButton,{class:"button",type:"secondary",width:"auto",onClick:this._reloadApp.bind(this)},"Reload"),window.__CTRender(r.CTButton,{class:"button",type:"secondary",width:"auto",onClick:this._clearAllAppData.bind(this)},"Clear local data")))}_enableAllLogging(){return i(this,void 0,void 0,function*(){yield this.layer.setSupportLoggingTypes([...this._loggingTypes]),this._updateLoggers()})}_disableAllLogging(){this.layer.setSupportLoggingTypes([]),this._updateLoggers()}_resetAllLogging(){this.layer.resetSupportLogging(),this._updateLoggers()}_onChangeLoggingType(e){this._selectedLoggingTypes.includes(this.ALL_LOGGERS_TOKEN)&&(this._selectedLoggingTypes=[...this._loggingTypes]);const t=this._selectedLoggingTypes.includes(e)?this._selectedLoggingTypes.filter(t=>t!==e):[...this._selectedLoggingTypes,e];this.layer.setSupportLoggingTypes(t),this._updateLoggers()}_reloadApp(){this.layer.showWaitingMessage("Reloading..."),window.location.reload()}_clearAllAppData(){this.layer.showWaitingMessage("Clearing all data..."),this.layer.clearAllData().then(()=>{window.location.reload()})}_updateLoggers(){this._selectedLoggingTypes=this.layer.logger.getTypes(),this.forceRedraw()}}t.CTDebugger=a,a.register()},function(e,t,n){var i=n(263);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: block; }\n  :host .debugger .section {\n    border: 1px dotted var(--default-border-color, #d9d9d9);\n    border-radius: 8px;\n    padding: 10px; }\n    :host .debugger .section .heading {\n      font-size: 18px;\n      font-weight: 600;\n      margin: 0 0 10px 0; }\n    :host .debugger .section .buttons {\n      display: flex;\n      margin: 10px 0; }\n      :host .debugger .section .buttons .button + .button {\n        margin: 0 0 0 5px; }\n    :host .debugger .section.logging .options {\n      display: flex;\n      flex-wrap: wrap; }\n      :host .debugger .section.logging .options .option {\n        width: 160px; }\n  :host .debugger .section + .section {\n    margin: 10px 0 0 0; }\n",""])},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(29),r=n(1),a=n(0),l=n(8);class c extends r.CTLayerComponent{constructor(){super(...arguments),this.btnClick=(()=>o(this,void 0,void 0,function*(){const e=yield s.CtXmppClient.pickFile({mimeTypes:this.fileTypes});this.callback&&this.callback(e)}))}static get is(){return"ct-file-picker"}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return""}generateComponentMarkup(){return window.__CTRender("div",null,window.__CTRender(l.CTButton,{icon:a.Icons.COMMON.PlusSign,iconColor:"#fff",onClick:this.btnClick}))}}i([r.prop({type:Array,attribute:!0,default:["image/jpeg","image/png","image/gif"]})],c.prototype,"fileTypes",void 0),i([r.prop({type:Function,attribute:!1})],c.prototype,"callback",void 0),t.CTFilePicker=c,c.register()},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(13),a=n(16),l=n(24);class c extends s.CTLayerComponent{constructor(){super(),this._textbox=null,this._sizeTest=null,this._htmlStripper=null,this._messageContent="",this._sizeTestContent="",this._isMaxSizeMessageTextBox=!1,this._setupResizeWatcher()}static get is(){return"ct-growing-textbox"}initialize(){return o(this,void 0,void 0,function*(){this.onRenderComplete(()=>this._updateTextboxHeight(),!0)})}setupListeners(){}get generateComponentStyles(){return n(266)}generateComponentMarkup(){const e=["textbox","animate-height",`${this.isChat?"textbox--chat":""}`];this.transparent&&e.push("transparent"),this._isMaxSizeMessageTextBox&&e.push("max-size");const t=r.buildStyles({"max-height":`${this.maxHeight||200}px`});return null!==this.height&&(t.height=`${this.height}px`),window.__CTRender("div",{class:"growing-textbox"},window.__CTRender("textarea",{id:"textbox",class:e.join(" "),style:t,rows:1,value:this.value,placeholder:this.placeholder,disabled:this.disabled,maxLength:this.maxLength,onFocus:this._onFocus.bind(this),onInput:this._onChange.bind(this),onKeydown:e=>this._onKeyDown(e)}),window.__CTRender("div",{id:"size-test",class:"textbox size-test"},this.renderHtml(this._sizeTestContent,"growing_textbox_content")))}_onFocus(){"function"==typeof this.onFocus&&this.onFocus()}_onChange(){this._updateTextboxHeight(),"function"==typeof this.onChange&&this.onChange()}_onKeyDown(e){13===e.keyCode&&(l.isDevice()||e.shiftKey||e.ctrlKey)?(e.preventDefault(),a.insertAtCaret(this._textbox,"\n"),this._updateTextboxHeight()):13===e.keyCode&&(e.preventDefault(),"function"==typeof this.onSubmit&&this.onSubmit())}focus(){this._getDomNodes(),this._textbox&&this._textbox.focus()}getValue(){return this._getDomNodes(),this._textbox?this._textbox.value:""}clear(){this._getDomNodes(),this._textbox&&(this.value="",this._textbox.value="",this._updateTextboxHeight())}_getDomNodes(){const e=this.shadowRoot;this._textbox=this._textbox||e.querySelector("#textbox"),this._sizeTest=this._sizeTest||e.querySelector("#size-test"),this._htmlStripper=this._htmlStripper||document.createElement("div")}_setupResizeWatcher(){window.addEventListener("resize",this._updateTextboxHeight.bind(this))}_updateTextboxHeight(){if(this._getDomNodes(),!this._textbox)return;if(!this._sizeTest)return;const e=this._textbox.value;this._sizeTest.style.width=`${this._textbox.offsetWidth}px`,this._messageContent=e,this._htmlStripper.innerHTML=this._stopJsInjection(e);const t=this._htmlStripper.textContent.replace(/\n/g,"<br/>");this._sizeTestContent=t,this._sizeTest.innerHTML=t+"&nbsp",this.height=this._sizeTest.offsetHeight;const n=(this.height||0)>=this.maxHeight;n!==this._isMaxSizeMessageTextBox&&(this._isMaxSizeMessageTextBox=n,this.forceRedraw())}_stopJsInjection(e){return e.replace(/</g,"_")}}i([s.prop({type:String,attribute:!0,default:""})],c.prototype,"value",void 0),i([s.prop({type:String,attribute:!0,default:""})],c.prototype,"placeholder",void 0),i([s.prop({type:s.NullableNumber,attribute:!0,default:null})],c.prototype,"height",void 0),i([s.prop({type:Number,attribute:!0,default:200})],c.prototype,"maxHeight",void 0),i([s.prop({type:s.Stroolean,attribute:!0,default:!1})],c.prototype,"transparent",void 0),i([s.prop({type:s.Stroolean,attribute:!0,default:!1})],c.prototype,"disabled",void 0),i([s.prop({type:s.Stroolean,attribute:!0,default:!1})],c.prototype,"isChat",void 0),i([s.prop({type:Number,attribute:!0,default:!1})],c.prototype,"maxLength",void 0),i([s.prop({type:Function,attribute:!1,default:null})],c.prototype,"onFocus",void 0),i([s.prop({type:Function,attribute:!1,default:null})],c.prototype,"onChange",void 0),i([s.prop({type:Function,attribute:!1,default:null})],c.prototype,"onSubmit",void 0),t.CTGrowingTextbox=c,c.register()},function(e,t,n){var i=n(267);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: flex; }\n  :host .growing-textbox {\n    display: flex;\n    flex-direction: column;\n    flex: 1 1 auto;\n    background-color: var(--default-bg-color-light, #fff);\n    overflow: hidden;\n    border: var(--secondary-border, 1px solid #dddddd);\n    border-radius: 10px; }\n    :host .growing-textbox .textbox {\n      flex: 1 1 auto;\n      font-family: inherit;\n      font-size: inherit;\n      font-weight: inherit;\n      min-height: 32px;\n      overflow: hidden;\n      padding: 6px 10px;\n      resize: none;\n      outline: none;\n      border: var(--secondary-border, 1px solid #dddddd);\n      will-change: transform;\n      color: var(--tertiary-font-color, inherit); }\n      :host .growing-textbox .textbox.animate-height {\n        transition: height 0.1s ease-out; }\n      :host .growing-textbox .textbox.transparent {\n        background: transparent;\n        border: 0;\n        padding: 7px 10px; }\n      :host .growing-textbox .textbox.max-size {\n        overflow: auto; }\n      :host .growing-textbox .textbox.size-test {\n        position: fixed;\n        top: -10000px;\n        left: -10000px;\n        height: auto;\n        white-space: pre-wrap; }\n      :host .growing-textbox .textbox::placeholder {\n        color: var(--select-placeholder-color, #828688); }\n      :host .growing-textbox .textbox::-webkit-input-placeholder {\n        color: var(--select-placeholder-color, #828688); }\n      :host .growing-textbox .textbox--chat {\n        font-size: 16px; }\n",""])},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(13);class a extends s.CTLayerComponent{static get is(){return"ct-icon"}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return n(269)}generateComponentMarkup(){if(!this.icon)return null;const e=r.buildStyles({fill:"auto"!==this.color?this.color:window.getComputedStyle(this.parentElement).color,width:this.width,height:this.height,margin:this.margin}),t=this.icon.viewBox||"0 0 1024 1024",n=this.icon.nodes||[],i=this.icon.paths||[];return n.length?this._drawFromNodes(t,n,e):this._drawFromPaths(t,i,e)}_drawFromPaths(e,t,n){return window.__CTRender("svg",{width:this.width,height:this.height,viewBox:e,style:n},t.map(e=>window.__CTRender("path",{d:e})))}_drawFromNodes(e,t,n){return window.__CTRender("svg",{width:this.width,height:this.height,viewBox:e,style:n},t.map(e=>this._drawNode(e)))}_drawNode(e){return window.__CTRender(e.name,Object.assign({},e.attributes),(e.children||[]).map(e=>this._drawNode(e)))}}i([s.prop({type:String,attribute:!0})],a.prototype,"width",void 0),i([s.prop({type:String,attribute:!0})],a.prototype,"height",void 0),i([s.prop({type:String,attribute:!0})],a.prototype,"margin",void 0),i([s.prop({type:String,attribute:!0,default:"auto"})],a.prototype,"color",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],a.prototype,"spin",void 0),i([s.prop({type:Object,attribute:!1,default:null})],a.prototype,"icon",void 0),t.CTIcon=a,a.register()},function(e,t,n){var i=n(270);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: flex; }\n  :host svg {\n    margin: auto; }\n\n:host([spin]) svg {\n  animation: spin 1s infinite linear;\n  transform-origin: 50% 50%; }\n\n@keyframes spin {\n  from {\n    transform: rotate(0deg); }\n  to {\n    transform: rotate(360deg); } }\n",""])},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(14),a=n(17),l=n(0),c=n(8),d=n(13);var h;!function(e){e[e.USERNAME="Username"]="USERNAME",e[e.PASSWORD="Password"]="PASSWORD",e[e.LOG_IN="Log In"]="LOG_IN",e[e.LOG_OUT="Log Out"]="LOG_OUT"}(h||(h={}));class u{static _create(){return new a.Metadata(p,h)}static get instance(){return this._instance||(this._instance=this._create())}}u._instance=null,t.CTLoginFormMetadata=u;class p extends s.CTLayerComponent{constructor(){super(),this.setMetadata(u.instance)}static get is(){return"ct-login-form"}initialize(){return o(this,void 0,void 0,function*(){this._resetFields()})}setupListeners(){this.addListener(r.BaseEvents.AuthenticationCredentialsReset,()=>{this.isWaiting=!1,this._resetFields()}),this.addListener(r.BaseEvents.ConnectionStatusChange,e=>{switch(e.status){case l.ConnectionStatus.Connected:this.userLoggedIn=!0;break;case l.ConnectionStatus.Connecting:this.isWaiting=!0;break;default:this.isWaiting=!1,this.userLoggedIn=!1}},{dontSuppress:!0})}get generateComponentStyles(){return n(272)}generateComponentMarkup(){return this.userLoggedIn?this.layer.config.xmpp.sso&&this.layer.config.xmpp.sso.adfs.enabled?this._renderSSOLogoutForm():this._renderLogoutForm():this.layer.config.xmpp.sso&&this.layer.config.xmpp.sso.adfs.enabled?this._renderSSOForm():this._renderLoginForm()}_renderSSOForm(){const e=["form"];this.theme&&e.push(`theme-${this.theme}`);const t=d.buildStyles({flex:"auto",flexDirection:"column",display:"flex",justifyContent:"center",paddingLeft:"30px",paddingRight:"30px"});return this.theme&&({}[`theme-${this.theme}`]=!0),window.__CTRender("div",{class:e.join(" ")},window.__CTRender("div",{class:"form-buttons",style:t},window.__CTRender(c.CTButton,{class:"button",type:"primary",disabled:!1,onClick:e=>this._sso(),isWaiting:this.isWaiting},this.logInLabel||this.translateI18nItem(h.LOG_IN))))}_renderLoginForm(){const e=["form"];this.theme&&e.push(`theme-${this.theme}`);const t=d.buildStyles({display:this.hideUsername?"none":"block"}),n={};return this.theme&&(n[`theme-${this.theme}`]=!0),window.__CTRender("div",{class:e.join(" ")},window.__CTRender("div",{class:"form-field",style:t},window.__CTRender(c.CTTextbox,Object.assign({type:"text",placeholder:this.translateI18nItem(h.USERNAME),name:"username",nonTransparent:!0,defaultValue:this._username,disabled:this.disableUsername||this.isWaiting},n,{callback:e=>this._onChange(e),returnKeypress:e=>this._login()}))),window.__CTRender("div",{class:"form-field"},window.__CTRender(c.CTTextbox,Object.assign({type:"password",placeholder:this.translateI18nItem(h.PASSWORD),name:"password",nonTransparent:!0,defaultValue:this._password},n,{callback:e=>this._onChange(e),disabled:this.isWaiting,returnKeypress:e=>this._login()}))),window.__CTRender("div",{class:"form-buttons"},window.__CTRender(c.CTButton,{class:"button",type:"primary",disabled:this.disabled,onClick:e=>this._login(),isWaiting:this.isWaiting},this.logInLabel||this.translateI18nItem(h.LOG_IN))))}_renderSSOLogoutForm(){const e=["form"];this.theme&&e.push(`theme-${this.theme}`);const t=d.buildStyles({flex:"auto",flexDirection:"column",display:"flex",justifyContent:"center",paddingLeft:"30px",paddingRight:"30px"});return this.theme&&({}[`theme-${this.theme}`]=!0),window.__CTRender("div",{class:e.join(" ")},window.__CTRender("div",{class:"form-buttons",style:t},window.__CTRender(c.CTButton,{class:"button",type:"primary",disabled:!1,onClick:e=>this._logout(),isWaiting:this.isWaiting},this.translateI18nItem(h.LOG_OUT))))}_renderLogoutForm(){let e=this.layer.getCurrentUserJid();this.autoAppendDomainName&&(e=e.split("@").shift());const t={};return this.theme&&(t[`theme-${this.theme}`]=!0),window.__CTRender("div",{class:"form",style:d.buildStyles({display:"flex"})},window.__CTRender("div",{class:"form-field"},window.__CTRender(c.CTTextbox,Object.assign({type:"text",name:"username",defaultValue:e},t,{disabled:!0}))),window.__CTRender("div",{class:"form-buttons"},window.__CTRender(c.CTButton,{type:"primary",disabled:!1,onClick:e=>this._logout(),isWaiting:this.isWaiting},this.translateI18nItem(h.LOG_OUT))))}_onChange(e){e&&"username"===e.key&&(this._username=e.value),e&&"password"===e.key&&(this._password=e.value),this.disabled=!this._username||!this._password}_resetFields(){this._username=this.username||"",this._password="",this.disabled=!0}_sso(){return o(this,void 0,void 0,function*(){this.isWaiting=!0;try{yield this.layer.sso(),this.isWaiting=!1,this.emitComponentEvent(r.BaseEvents.LoginFormResult,new r.CommsEventArgs(!0))}catch(e){console.error("SSO ERROR: "+e),this.isWaiting=!1,this.emitComponentEvent(r.BaseEvents.LoginFormResult,new r.CommsEventArgs(!1,"Could not log in via adfs"))}})}_login(){return o(this,void 0,void 0,function*(){if(this._username&&this._password){this.isWaiting=!0;let e=this.autoAppendDomainName?`${this._username.trim()}@${this.layer.config.xmpp.user.domain}`:this._username.trim();this.layer.config.xmpp.user&&!0===this.layer.config.xmpp.user.forceLowercaseJid&&(e=e.toLowerCase());try{yield this.layer.login(e,this._password),this.emitComponentEvent(r.BaseEvents.LoginFormResult,new r.CommsEventArgs(!0)),this.isWaiting=!1,this._resetFields()}catch(t){this.emitComponentEvent(r.BaseEvents.LoginFormResult,new r.CommsEventArgs(!1,`Could not log in as ${e}`)),this.isWaiting=!1,this._password="",this._onChange(),document.activeElement.blur()}}})}_logout(){return o(this,void 0,void 0,function*(){this.isWaiting=!0;try{yield this.layer.logout(),this.isWaiting=!1,this._resetFields()}catch(e){this.emitComponentEvent(r.BaseEvents.LoginFormResult,new r.CommsEventArgs(!1,"There was an error logging out. Please try again.")),this.isWaiting=!1,document.activeElement.blur()}})}}i([s.prop({type:String,attribute:!0,default:""})],p.prototype,"theme",void 0),i([s.prop({type:s.Stroolean,attribute:!0,default:!0})],p.prototype,"autoAppendDomainName",void 0),i([s.prop({type:String,attribute:!0,default:""})],p.prototype,"username",void 0),i([s.prop({type:s.Stroolean,attribute:!0,default:!1})],p.prototype,"hideUsername",void 0),i([s.prop({type:s.Stroolean,attribute:!0,default:!1})],p.prototype,"disableUsername",void 0),i([s.prop({type:String,attribute:!0,default:null})],p.prototype,"logInLabel",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],p.prototype,"isWaiting",void 0),i([s.prop({type:Boolean,attribute:!1,default:!0})],p.prototype,"disabled",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],p.prototype,"userLoggedIn",void 0),t.CTLoginForm=p,p.register()},function(e,t,n){var i=n(273);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: flex;\n  width: 100%;\n  margin: auto;\n  flex: auto; }\n  :host .form {\n    display: flex;\n    flex-direction: column;\n    width: 100%; }\n    :host .form .form-field,\n    :host .form .form-buttons {\n      margin: 5px 0; }\n    :host .form.theme-light .form-buttons .button {\n      --button-primary-bg: transparent;\n      --button-primary-text: #ffffff;\n      --button-primary-border: 1px solid #ffffff; }\n",""])},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(0),a=n(8);class l extends s.CTLayerComponent{constructor(){super(),this._open=!1,this._setUpEventHandlers()}static get is(){return"ct-menu"}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return n(275)}generateComponentMarkup(){return window.__CTRender("div",{class:"menu-container"},window.__CTRender("div",{class:"button",onClick:e=>this._toggleMenu(e)},window.__CTRender(a.CTIcon,{width:"20",height:"20",icon:r.Icons.COMMON.MenuDots})),this._open&&window.__CTRender("div",{class:"menu"},this.menuItems.map(e=>this._renderMenuItem(e))))}_renderMenuItem(e){const t=["menu-item"];return e.disabled&&t.push("disabled"),e.className&&t.push(e.className),window.__CTRender("div",{class:t.join(" "),onClick:()=>this._performAction(e)},e.label)}_toggleMenu(e){e.stopPropagation(),this._setMenuState(!this._open)}_performAction(e){e&&e.action&&(e.disabled||(this._setMenuState(!1),e.action()))}_setUpEventHandlers(){const e=this._handleDocumentInteraction.bind(this);document.addEventListener("click",e),window.addEventListener("resize",e)}_setMenuState(e=!this._open){this._open=e,this.forceRedraw()}_handleDocumentInteraction(){this._open&&this._setMenuState(!1)}}i([s.prop({type:Array,attribute:!0,default:[]})],l.prototype,"menuItems",void 0),t.CTMenu=l;t.MenuItem=class{constructor(e,t,n=!1,i=null){this.label=e,this.action=t,this.disabled=n,this.className=i}},l.register()},function(e,t,n){var i=n(276);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: inline-block;\n  color: inherit; }\n  :host .menu-container {\n    position: relative; }\n    :host .menu-container .button {\n      cursor: pointer; }\n    :host .menu-container .menu {\n      position: absolute;\n      top: 25px;\n      right: 0;\n      min-width: 80px;\n      background: var(--list-bg);\n      color: var(--default-font-color, #212121);\n      border: var(--list-item-border);\n      z-index: 99999;\n      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5); }\n      :host .menu-container .menu .menu-item {\n        border-bottom: var(--list-item-border);\n        padding: 10px;\n        cursor: pointer;\n        white-space: nowrap; }\n        :host .menu-container .menu .menu-item.disabled {\n          opacity: 0.5; }\n        :host .menu-container .menu .menu-item:hover:not(.disabled) {\n          background: var(--secondary-color, #efefef); }\n        :host .menu-container .menu .menu-item:last-child {\n          border-bottom: 0; }\n",""])},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(14),a=n(17),l=n(0),c=n(8),d=n(13),h=n(83);var u;!function(e){e[e.ONLINE="Online"]="ONLINE",e[e.OFFLINE="Offline"]="OFFLINE",e[e.RECONNECTING="Reconnecting"]="RECONNECTING",e[e.RECONNECT="Reconnect"]="RECONNECT"}(u||(u={}));class p{static _create(){return new a.Metadata(g,u)}static get instance(){return this._instance||(this._instance=this._create())}}p._instance=null,t.CTOnlineIndicatorMetadata=p;class g extends s.CTLayerComponent{constructor(){super(),this.attemptCount=0,this.setMetadata(p.instance)}static get is(){return"ct-online-indicator"}initialize(){return o(this,void 0,void 0,function*(){this.status=this.layer.getConnectionStatus()})}setupListeners(){this.addListener(r.BaseEvents.ConnectionStatusChange,e=>{this.status=e.status,this.reconnectTime=e.reconnectTime,this.allowReconnect=e.status===l.ConnectionStatus.Disconnected,clearInterval(this.timeoutId),e.reconnectTime&&(this.timeoutId=setInterval(()=>{this.reconnectTime-=1e3},1e3))},{dontSuppress:!0})}get generateComponentStyles(){return n(278)}generateComponentMarkup(){const e=["online-indicator",this.status===l.ConnectionStatus.Connected?"online":"offline"],t=this.status===l.ConnectionStatus.Connecting?l.Icons.COMMON.LoadingSpinner:this.status===l.ConnectionStatus.Connected?l.Icons.COMMON.StatusOnline:l.Icons.COMMON.StatusOffline;return window.__CTRender("div",{class:e.join(" ")},d.renderIf(this.showIcon,window.__CTRender("div",{class:"icon"},window.__CTRender(c.CTIcon,{width:"16",height:"16",icon:t,spin:this.status===l.ConnectionStatus.Connecting}))),d.renderIf(this.showText,window.__CTRender("div",{class:"label"},window.__CTRender("span",{class:"status"},this._getStatusLabel()),d.renderIf(this.status===l.ConnectionStatus.Disconnected&&void 0!==this.reconnectTime&&this.reconnectTime>0,window.__CTRender("span",{class:"reconnect-detail"},window.__CTRender("span",{class:"countdown"},this._getCountdownLabel()),window.__CTRender(h.CTButton,{type:"invert-secondary",disabled:!this.allowReconnect,onClick:e=>this._tryLoginNow(e)},this.translateI18nItem(u.RECONNECT)))))))}_getStatusLabel(){switch(this.status){case l.ConnectionStatus.Connected:return this.translateI18nItem(u.ONLINE);case l.ConnectionStatus.Connecting:return this.translateI18nItem(u.RECONNECTING);case l.ConnectionStatus.Disconnecting:case l.ConnectionStatus.Disconnected:return this.translateI18nItem(u.OFFLINE)}}_getCountdownLabel(){return`(${this.reconnectTime/1e3}s)`}_tryLoginNow(e){!1!==this.allowReconnect&&(this.allowReconnect=!1,this.status=l.ConnectionStatus.Connecting,this.layer.attemptReconnect())}}i([s.prop({type:s.Stroolean,attribute:!0,default:!0})],g.prototype,"showIcon",void 0),i([s.prop({type:s.Stroolean,attribute:!0,default:!0})],g.prototype,"showText",void 0),i([s.prop({type:String,attribute:!1,default:l.ConnectionStatus.Disconnected})],g.prototype,"status",void 0),i([s.prop({type:Number,attribute:!1,default:0})],g.prototype,"reconnectTime",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],g.prototype,"allowReconnect",void 0),t.CTOnlineIndicator=g,g.register()},function(e,t,n){var i=n(279);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: inline-flex;\n  font-size: inherit;\n  font-weight: inherit;\n  color: inherit; }\n  :host .online-indicator {\n    display: flex;\n    align-items: center; }\n    :host .online-indicator .icon {\n      flex: none;\n      margin: 0 5px 0 0; }\n    :host .online-indicator .label {\n      display: flex;\n      align-items: center;\n      flex: 1 1; }\n      :host .online-indicator .label .reconnect-detail {\n        display: flex;\n        align-items: center; }\n        :host .online-indicator .label .reconnect-detail .countdown {\n          width: 40px;\n          padding: 0 5px; }\n",""])},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(0),a=n(8),l=n(13);class c extends s.CTLayerComponent{static get is(){return"ct-selection-list"}initialize(){return o(this,void 0,void 0,function*(){"function"==typeof this.onSelect&&this.onSelect(this.options[this.selected].key)})}setupListeners(){}get generateComponentStyles(){return n(281)}generateComponentMarkup(){const e=!this.forceDropdown&&(this.buttonList||this.options.length<=4),t=["selection-list"];return this.buttonList&&t.push("button-list"),window.__CTRender("div",{class:t.join(" ")},window.__CTRender("label",null,"Response Options"),l.renderIfElse(e,this._renderButtons(),this._renderDropDown()))}_renderDropDown(){return window.__CTRender("div",{class:"dropdown-contanier"},window.__CTRender("select",{onChange:e=>this._onMakeSelection(e),value:this.selected.toString()},this.options.map(e=>window.__CTRender("option",{"data-key":e.key,value:e.key.toString(),defaultSelected:this.selected===e.key},e.value))),window.__CTRender(a.CTIcon,{class:"select-icon",width:"12",height:"12",icon:r.Icons.COMMON.ChevronDown}))}_renderButtons(){return this.options.map(e=>window.__CTRender("div",{class:"button-container"},window.__CTRender(a.CTButton,{"data-key":e.key,type:"secondary",selected:this.selected===e.key,onClick:e=>this._onMakeSelection(e)},e.value)))}_onMakeSelection(e){const t=e.target;if(!t)return;let n=null;switch(t.nodeName){case"CT-BUTTON":n=parseInt(t.getAttribute("data-key"));break;case"SELECT":n=parseInt(t.value)}if(isNaN(n))return;const i=this.options.find(e=>e.key===n);i&&(this._makeSelection(i.key),this.selected=i.key)}_makeSelection(e){"function"==typeof this.onSelect&&this.onSelect(e)}}i([s.prop({type:Number,attribute:!0,default:Number.MIN_VALUE})],c.prototype,"selected",void 0),i([s.prop({type:s.Stroolean,attribute:!0,default:!1})],c.prototype,"buttonList",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],c.prototype,"forceDropdown",void 0),i([s.prop({type:Function,attribute:!0})],c.prototype,"onSelect",void 0),i([s.prop({type:Array,attribute:!1,default:[]})],c.prototype,"options",void 0),t.CTSelectionList=c,c.register()},function(e,t,n){var i=n(282);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: block;\n  width: 100%; }\n  :host .selection-list {\n    display: flex;\n    flex-direction: row;\n    flex-wrap: wrap;\n    color: var(--default-bg-color-light-font, #212121); }\n    :host .selection-list label {\n      margin: 10px 0 5px;\n      text-transform: uppercase;\n      font-size: 0.8em;\n      color: var(--tertiary-placeholder-color, #212121); }\n    :host .selection-list .dropdown-contanier {\n      flex: 1 1 100%;\n      position: relative; }\n      :host .selection-list .dropdown-contanier select {\n        width: 100%;\n        height: 30px;\n        font-size: 16px;\n        outline: none;\n        background-color: var(--default-bg-color-light, #fff);\n        border: 1px solid var(--select-border-color, #d9d9d9);\n        color: inherit;\n        -webkit-appearance: none;\n        padding: 0.3em;\n        border-radius: 0; }\n      :host .selection-list .dropdown-contanier ct-icon.select-icon {\n        pointer-events: none;\n        position: absolute;\n        top: 0;\n        right: 0;\n        height: 100%;\n        padding: 0 7px;\n        cursor: pointer; }\n    :host .selection-list .button-container {\n      position: relative;\n      flex: 0 1 50%; }\n      :host .selection-list .button-container:nth-child(2n - 1) {\n        padding: 10px 5px 0 0; }\n      :host .selection-list .button-container:nth-child(2n - 2) {\n        padding: 10px 0 0 5px; }\n      :host .selection-list .button-container:nth-child(1), :host .selection-list .button-container:nth-child(2) {\n        padding-top: 0; }\n    :host .selection-list.button-list {\n      display: block; }\n      :host .selection-list.button-list .button-container {\n        display: block;\n        padding: 0 0 1px 0; }\n        :host .selection-list.button-list .button-container:last-child {\n          padding: 0; }\n",""])},function(e,t,n){var i=n(284);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: flex;\n  flex: 1; }\n  :host div.container {\n    display: flex;\n    flex: 1;\n    height: 40px;\n    border-radius: 20px;\n    border: 1px solid var(--select-border-color, #d9d9d9);\n    background-color: var(--default-bg-color-light, #fff);\n    position: relative;\n    color: var(--default-bg-color-light-font, #212121); }\n    :host div.container div.select > select, :host div.container input {\n      outline: 0;\n      font-size: 14px;\n      padding: 0 10px;\n      border: 0; }\n    :host div.container div.select {\n      border-top-left-radius: 20px;\n      border-bottom-left-radius: 20px;\n      border-top-right-radius: 0;\n      border-bottom-right-radius: 0;\n      flex: 0 0 30%;\n      width: 30%;\n      height: 100%;\n      position: relative;\n      border-right: 1px solid var(--select-border-color, #d9d9d9); }\n      :host div.container div.select select {\n        border-top-left-radius: 20px;\n        border-bottom-left-radius: 20px;\n        -webkit-appearance: none;\n        padding-right: 26px;\n        width: 100%;\n        height: 100%;\n        cursor: pointer;\n        background-color: transparent;\n        color: inherit; }\n      :host div.container div.select.highlight, :host div.container div.select.highlight > select {\n        color: var(--primary-color, #15233b);\n        font-weight: bold; }\n    :host div.container input {\n      flex: 1;\n      border-top-right-radius: 20px;\n      border-bottom-right-radius: 20px;\n      padding-right: 26px;\n      margin: 0;\n      border-top-left-radius: 0;\n      border-bottom-left-radius: 0;\n      background-color: transparent;\n      color: inherit; }\n      :host div.container input::placeholder {\n        color: var(--select-placeholder-color, #828688);\n        text-overflow: ellipsis; }\n      :host div.container input::-webkit-input-placeholder {\n        color: var(--select-placeholder-color, #828688);\n        text-overflow: ellipsis; }\n    :host div.container ct-icon.select-icon {\n      pointer-events: none; }\n    :host div.container ct-icon.clear,\n    :host div.container ct-icon.select-icon {\n      position: absolute;\n      top: 0;\n      right: 0;\n      height: 100%;\n      padding: 0 7px;\n      cursor: pointer; }\n",""])},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(0),a=n(8),l=n(13);class c extends s.CTLayerComponent{static get is(){return"ct-slide-panel"}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return n(286)}generateComponentMarkup(){const e=["slide-panel",this.state],t=l.buildStyles({width:this.menuWidth||"300px"});return window.__CTRender("div",{class:e.join(" ")},window.__CTRender("div",{class:"button",onClick:this._toggleMenu.bind(this)},window.__CTRender(a.CTIcon,{width:"20",height:"20",icon:r.Icons.COMMON.Menu})),window.__CTRender("div",{class:"blocker",onClick:this._closeMenu.bind(this)}),window.__CTRender("div",{class:"slide-panel-menu",style:t},window.__CTRender("slot",null)))}_toggleMenu(){this.state&&"closed"!==this.state?this.state="closed":this.state="open"}_closeMenu(){this.state="closed"}}i([s.prop({type:String,attribute:!0,default:"300px"})],c.prototype,"menuWidth",void 0),i([s.prop({type:String,attribute:!1,default:""})],c.prototype,"state",void 0),t.CTSlidePanel=c,c.register()},function(e,t,n){var i=n(287);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: block;\n  color: inherit; }\n\n@keyframes fadein {\n  0% {\n    opacity: 0;\n    transform: translateX(-100%); }\n  1% {\n    opacity: 0;\n    transform: translateX(0); }\n  100% {\n    opacity: 1;\n    transform: translateX(0); } }\n\n@keyframes fadeout {\n  0% {\n    opacity: 1;\n    transform: translateX(0); }\n  99% {\n    opacity: 0;\n    transform: translateX(0); }\n  100% {\n    opacity: 0;\n    transform: translateX(-100%); } }\n\n@keyframes slidein {\n  0% {\n    transform: translateX(-200%); }\n  1% {\n    transform: translateX(-100%); }\n  100% {\n    transform: translateX(0); } }\n\n@keyframes slideout {\n  0% {\n    transform: translateX(0); }\n  99% {\n    transform: translateX(-100%); }\n  100% {\n    transform: translateX(-200%); } }\n  :host .slide-panel {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 100%; }\n    :host .slide-panel .button {\n      display: block;\n      z-index: 99999;\n      cursor: pointer; }\n    :host .slide-panel .blocker {\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      transform: translateX(-200%);\n      background: rgba(0, 0, 0, 0.5);\n      z-index: 99997;\n      will-change: transform; }\n    :host .slide-panel .slide-panel-menu {\n      position: fixed;\n      top: 0;\n      left: 0;\n      height: 100%;\n      transform: translateX(-200%);\n      background: transparent;\n      color: #212121;\n      z-index: 99998;\n      will-change: transform; }\n    :host .slide-panel.open .blocker {\n      animation: fadein var(--animation-fast, 0.3s) 1 ease-out normal forwards; }\n    :host .slide-panel.open .slide-panel-menu {\n      animation: slidein var(--animation-fast, 0.3s) 1 ease-out normal forwards; }\n    :host .slide-panel.closed .blocker {\n      animation: fadeout var(--animation-fast, 0.3s) 1 ease-out normal forwards; }\n    :host .slide-panel.closed .slide-panel-menu {\n      animation: slideout var(--animation-fast, 0.3s) 1 ease-out normal forwards; }\n",""])},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(0),a=n(8),l=n(13);class c extends s.CTLayerComponent{constructor(){super(...arguments),this._input=null}static get is(){return"ct-textbox"}initialize(){return o(this,void 0,void 0,function*(){this._value=this.defaultValue||"",this._isPasswordField=this.type&&"password"===this.type.toLowerCase(),this._isPasswordField&&this._watchPasswordField(),this.focusOnRender&&this.defer(()=>{this._input&&this._input.focus()})})}setupListeners(){}get generateComponentStyles(){return n(289)}generateComponentMarkup(){const e={};return this.max&&(e.maxlength=this.max),window.__CTRender("div",{class:this.disabled?"disabled":""},l.renderIf(void 0!==this.label,window.__CTRender("label",{htmlFor:this.name},this.label)),window.__CTRender("div",{class:`input ${this.nonTransparent?"input-container-no-border":""}`},l.renderIfElse("textarea"===this.type,window.__CTRender("textarea",Object.assign({class:`${this.forceTransparency?"transparent":""}`,placeholder:this.placeholder,name:this.name,onFocus:e=>this._toggleFocus(!0),onBlur:e=>this._toggleFocus(!1),onInput:e=>this._updateValue({key:e.target.name,value:e.target.value}),onkeydown:this._keydown.bind(this),value:this.defaultValue,disabled:this.disabled,required:this.required,rows:5,ref:e=>this._input=e},e)),window.__CTRender("input",Object.assign({class:`${this.forceTransparency?"transparent ":""}${this.nonTransparent?"input--noTransparency":""}`,type:this.type,placeholder:this.placeholder,name:this.name,onFocus:e=>this._toggleFocus(!0),onBlur:e=>this._toggleFocus(!1),onInput:e=>this._updateValue({key:e.target.name,value:e.target.value}),onkeydown:this._keydown.bind(this),value:this.defaultValue,disabled:this.disabled,required:this.required,ref:e=>this._input=e},e))),l.renderIf(this.required,window.__CTRender(a.CTIcon,{class:"required",width:"8",height:"8",color:"#a91a49",icon:r.Icons.COMMON.RequiredField})),l.renderIf(this.showClearOptions&&!this._isPasswordField,window.__CTRender(a.CTIcon,{class:"clear-value isLoginFormIcon",color:"#000",width:"12",height:"12",icon:r.Icons.COMMON.ClearTextbox,onClick:e=>this._clear()})),l.renderIf(this._isPasswordField,window.__CTRender(a.CTIcon,{class:`isLoginFormIcon isLoginFormIcon--password show-password ${"text"===this.type?"show-password-enabled":""}`,color:"#000",width:"15",height:"15",icon:r.Icons.COMMON.ShowPassword,onClick:e=>this._togglePasswordFieldType()}))))}_toggleFocus(e){const t=this.shadowRoot.querySelector(".input"),n="textarea"===this.type?t.querySelector("textarea"):t.querySelector("input");e?(t.classList.add("focus"),"scrollIntoViewIfNeeded"in n?n.scrollIntoViewIfNeeded():"scrollIntoView"in n&&n.scrollIntoView()):t.classList.remove("focus")}_keydown(e){13===e.keyCode&&this.returnKeypress&&this.returnKeypress()}_updateValue(e){this._value=e.value,"function"==typeof this.callback&&this.callback({key:e.key,value:e.value,validated:this.validated})}_clear(){let e;(e="textarea"!==this.type?this.shadowRoot.querySelector("input"):this.shadowRoot.querySelector("textarea")).value="",e.focus(),e.dispatchEvent(new Event("input"))}clear(){this._clear()}_togglePasswordFieldType(){this._isPasswordField&&("password"===this.type?this.type="text":this.type="password")}_watchPasswordField(){const e=e=>{const t=this.shadowRoot.querySelector(".input");if(e.path){!1===e.path.includes(t)&&"text"===this.type&&(this.type="password")}};document.removeEventListener("click",e),document.addEventListener("click",e)}}i([s.prop({type:String,attribute:!0})],c.prototype,"placeholder",void 0),i([s.prop({type:String,attribute:!0})],c.prototype,"type",void 0),i([s.prop({type:String,attribute:!0})],c.prototype,"label",void 0),i([s.prop({type:String,attribute:!0})],c.prototype,"name",void 0),i([s.prop({type:Boolean,attribute:!0,default:!0})],c.prototype,"showClearOptions",void 0),i([s.prop({type:String,attribute:!0})],c.prototype,"defaultValue",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],c.prototype,"required",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],c.prototype,"disabled",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],c.prototype,"fullBorder",void 0),i([s.prop({type:Number,attribute:!0,default:4e3})],c.prototype,"max",void 0),i([s.prop({type:Boolean,attribute:!1,default:!0})],c.prototype,"validated",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],c.prototype,"forceTransparency",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],c.prototype,"focusOnRender",void 0),i([s.prop({type:Boolean,attribute:!0})],c.prototype,"nonTransparent",void 0),t.CTTextbox=c,c.register()},function(e,t,n){var i=n(290);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host label {\n  color: var(--default-font-color, #212121); }\n\n:host div div.input {\n  position: relative;\n  display: flex;\n  flex-direction: row;\n  margin: 0 0 5px 0;\n  border-bottom: 1px solid var(--default-border-color, #d9d9d9); }\n  :host div div.input.focus {\n    border-color: var(--login-form-border-color, green); }\n  :host div div.input input,\n  :host div div.input textarea {\n    flex: 1 1;\n    font-family: inherit;\n    font-size: inherit;\n    font-weight: inherit;\n    background-color: var(--default-bg-color-light, transparent);\n    border: none;\n    padding: 0.3em 0.5em;\n    margin: auto;\n    outline: none;\n    resize: none;\n    color: var(--login-form-font-color, inherit); }\n    :host div div.input input.transparent,\n    :host div div.input textarea.transparent {\n      background-color: transparent; }\n    :host div div.input input:focus,\n    :host div div.input textarea:focus {\n      border: none;\n      outline-offset: 0; }\n      :host div div.input input:focus:not(:placeholder-shown) ~ .clear-value,\n      :host div div.input textarea:focus:not(:placeholder-shown) ~ .clear-value {\n        opacity: 0.5;\n        cursor: pointer; }\n      :host div div.input input:focus:not(:placeholder-shown) ~ .required,\n      :host div div.input textarea:focus:not(:placeholder-shown) ~ .required {\n        visibility: hidden; }\n    :host div div.input input:valid ~ .required,\n    :host div div.input textarea:valid ~ .required {\n      visibility: hidden; }\n  :host div div.input .input--noTransparency {\n    background-color: #ffffff;\n    border-radius: 4px;\n    color: #000 !important;\n    padding-right: 30px; }\n  :host div div.input ct-icon {\n    flex: 0 0 20px;\n    text-align: center; }\n    :host div div.input ct-icon.show-password {\n      opacity: 0.5; }\n      :host div div.input ct-icon.show-password.show-password-enabled {\n        opacity: 1; }\n    :host div div.input ct-icon.required {\n      position: absolute;\n      right: 5px;\n      top: 0;\n      height: 100%; }\n    :host div div.input ct-icon.clear-value {\n      opacity: 0; }\n    :host div div.input ct-icon + ct-icon {\n      margin: 0 0 0 5px; }\n    :host div div.input ct-icon.isLoginFormIcon {\n      position: absolute;\n      right: 10px;\n      top: 50%;\n      transform: translateY(-50%);\n      display: block; }\n      :host div div.input ct-icon.isLoginFormIcon--password {\n        height: 19px; }\n  :host div div.input .validation {\n    margin-bottom: 1%;\n    color: red; }\n\n:host div.disabled div.input {\n  border-bottom: none; }\n\n:host div div.input-container-no-border {\n  border-bottom: none !important; }\n\n:host([full-border]) div div.input {\n  background-color: var(--default-bg-color-light, #fff);\n  border: 1px solid var(--select-border-color, #d9d9d9);\n  color: var(--default-bg-color-light-font, #212121); }\n  :host([full-border]) div div.input input::placeholder,\n  :host([full-border]) div div.input textarea::placeholder {\n    color: var(--select-placeholder-color, #828688); }\n  :host([full-border]) div div.input input::-webkit-input-placeholder,\n  :host([full-border]) div div.input textarea::-webkit-input-placeholder {\n    color: var(--select-placeholder-color, #828688); }\n\n:host([theme-light]) label {\n  color: #ffffff; }\n\n:host([theme-light]) div div.input {\n  border-bottom: 1px solid rgba(255, 255, 255, 0.6);\n  color: #ffffff; }\n  :host([theme-light]) div div.input input,\n  :host([theme-light]) div div.input textarea {\n    color: #ffffff; }\n    :host([theme-light]) div div.input input::placeholder,\n    :host([theme-light]) div div.input textarea::placeholder {\n      color: rgba(255, 255, 255, 0.6); }\n    :host([theme-light]) div div.input input::-webkit-input-placeholder,\n    :host([theme-light]) div div.input textarea::-webkit-input-placeholder {\n      color: rgba(255, 255, 255, 0.6); }\n  :host([theme-light]) div div.input.focus {\n    border-color: #ffffff; }\n  :host([theme-light]) div div.input .input--noTransparency::placeholder {\n    color: #000; }\n  :host([theme-light]) div div.input .input--noTransparency::-webkit-input-placeholder {\n    color: #000; }\n",""])},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(0),a=n(8),l=n(13);class c extends s.CTLayerComponent{static get is(){return"ct-user-avatar"}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return n(292)}generateComponentMarkup(){const e=l.buildStyles({width:`${this.size}px`,height:`${this.size}px`});this.bgColor&&(e.backgroundColor=this.bgColor,e.backgroundImage="none"),this.border&&(e.border=this.border);const t={};this.badge&&!this.indicator&&(t["data-badge"]=this.badge.toString()),this.indicator&&(t.indicator=!0),this.blob&&(t.blob=!0),this.onclick&&(e.cursor="pointer");const n=Math.floor(this.size/2);return window.__CTRender("div",Object.assign({class:"bg",style:e},t),window.__CTRender(a.CTIcon,{icon:this.defaultIcon,width:n,height:n}),this.user.avatar&&window.__CTRender("img",{class:"image",src:"data:image/png;base64,"+this.user.avatar,width:this.size,height:this.size}))}}i([s.prop({type:Number,attribute:!1,default:40})],c.prototype,"size",void 0),i([s.prop({type:Object,attribute:!1})],c.prototype,"user",void 0),i([s.prop({type:Object,attribute:!1,default:r.Icons.COMMON.User})],c.prototype,"defaultIcon",void 0),i([s.prop({type:String,attribute:!1,default:""})],c.prototype,"bgColor",void 0),i([s.prop({type:String,attribute:!1,default:""})],c.prototype,"border",void 0),i([s.prop({type:Number,attribute:!1,default:0})],c.prototype,"badge",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],c.prototype,"indicator",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],c.prototype,"blob",void 0),t.CTUserAvatar=c,c.register()},function(e,t,n){var i=n(293);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,'/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: block; }\n  :host .bg {\n    position: relative;\n    flex: none;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    border-radius: 50%;\n    overflow: hidden;\n    background-color: #147efb;\n    background-image: linear-gradient(to bottom, #308fff 2%, #147efb 82%);\n    color: var(--avatar-color, #ffffff); }\n    :host .bg .image {\n      position: absolute;\n      top: 0;\n      left: 0;\n      border-radius: 50%; }\n    :host .bg[data-badge], :host .bg[indicator] {\n      position: relative;\n      overflow: visible; }\n      :host .bg[data-badge]:after, :host .bg[indicator]:after {\n        position: absolute;\n        top: -6px;\n        right: -6px;\n        margin: 0;\n        background-color: #cf1930;\n        min-width: 10px;\n        min-height: 10px;\n        line-height: 10px;\n        padding: 5px;\n        text-align: center;\n        border-radius: 20px;\n        font-size: 10px;\n        color: #fff;\n        content: attr(data-badge); }\n    :host .bg[indicator]:after {\n      background-color: var(--primary-color, #15233b);\n      min-width: 0px;\n      min-height: 0px;\n      border: 2px solid var(--list-item-bg, #ffffff);\n      top: -2px;\n      right: -2px; }\n    :host .bg[blob] {\n      position: relative;\n      overflow: visible; }\n      :host .bg[blob]:after {\n        position: absolute;\n        top: -3px;\n        right: -3px;\n        margin: 0;\n        background-color: #cf1930;\n        min-width: 5px;\n        min-height: 5px;\n        padding: 5px;\n        border-radius: 10px;\n        color: #fff;\n        content: ""; }\n',""])},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(14),a=n(0),l=n(8),c=n(13);class d extends s.CTLayerComponent{static get is(){return"ct-user-display"}initialize(){return o(this,void 0,void 0,function*(){this._update()})}setupListeners(){this.addListeners([r.BaseEvents.ConnectionStatusChange,r.BaseEvents.CurrentUserVCardUpdate],()=>{this._update()})}get generateComponentStyles(){return n(295)}generateComponentMarkup(){switch(this.type){case"simple":return this._renderSimple();case"full":return this._renderFull()}return null}_renderSimple(){return this.displayName?window.__CTRender("div",{class:"user-display"},this.showIcon&&window.__CTRender("div",{class:"icon"},window.__CTRender(l.CTIcon,{width:"16",height:"16",icon:a.Icons.COMMON.UserIconEmpty})),window.__CTRender("div",{class:"label"},this.displayName)):null}_renderFull(){return this.user?window.__CTRender("div",{class:"user-display"},window.__CTRender(l.CTUserTile,{user:this.user,showAvatar:this.showIcon,detailStyle:c.buildStyles({flexDirection:"column",overflow:"hidden",width:"100%"})})):null}_update(){switch(this.type){case"simple":this.displayName=this.layer.getCurrentXmppDisplayName(),this.user=null;break;case"full":this.displayName=null,this.user=this.layer.getCurrentUser()}}}i([s.prop({type:String,attribute:!0,default:"simple"})],d.prototype,"type",void 0),i([s.prop({type:s.Stroolean,attribute:!0,default:!0})],d.prototype,"showIcon",void 0),i([s.prop({type:String,attribute:!1,default:null})],d.prototype,"displayName",void 0),i([s.prop({type:Object,attribute:!1,default:null})],d.prototype,"user",void 0),t.CTUserDisplay=d,d.register()},function(e,t,n){var i=n(296);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: inline-flex;\n  font-size: inherit;\n  font-weight: inherit;\n  color: inherit; }\n  :host .user-display {\n    display: flex;\n    align-items: center;\n    width: 100%; }\n    :host .user-display .icon {\n      flex: none;\n      margin: 0 5px 0 0; }\n    :host .user-display .label {\n      flex: 1 1; }\n",""])},function(e,t,n){var i=n(298);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: block; }\n  :host .bg {\n    position: relative;\n    flex: none;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    border-radius: 50%;\n    overflow: hidden;\n    background-color: #672b78;\n    background-image: linear-gradient(to bottom, #803694, #672b78);\n    color: var(--avatar-color, #ffffff); }\n    :host .bg[data-badge], :host .bg[indicator] {\n      position: relative;\n      overflow: visible; }\n      :host .bg[data-badge]:after, :host .bg[indicator]:after {\n        position: absolute;\n        top: -6px;\n        right: -6px;\n        margin: 0;\n        background-color: #cf1930;\n        min-width: 10px;\n        min-height: 10px;\n        line-height: 10px;\n        padding: 5px;\n        text-align: center;\n        border-radius: 20px;\n        font-size: 10px;\n        color: #fff;\n        content: attr(data-badge); }\n    :host .bg .image {\n      position: absolute;\n      top: 0;\n      left: 0;\n      border-radius: 50%; }\n",""])},function(e,t,n){var i=n(300);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  width: 100%; }\n  :host .name {\n    flex: 1 1 auto;\n    font-size: 18px;\n    color: var(--default-font-color, #212121);\n    white-space: pre-line;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    line-height: 23px; }\n  :host .name.no-margin {\n    margin-bottom: 0; }\n  :host .job-title, :host .group {\n    color: var(--subtle-font-color, #828688);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis; }\n  :host .group {\n    font-style: italic; }\n  :host .empty {\n    color: #828688; }\n",""])},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(0),a=n(8),l=n(5),c=n(84),d=n(6),h=n(20),u=n(17);var p;!function(e){e[e.ERROR="Error"]="ERROR",e[e.CONFIRM_REMOVE_LAST_PERMISSION="You are about to remove the last remaining permission for this user in this role.  Do you want to remove this user from the role?"]="CONFIRM_REMOVE_LAST_PERMISSION",e[e.CONFIRM_REMOVE_USER="Remove this user from this role?"]="CONFIRM_REMOVE_USER"}(p||(p={}));class g{static _create(){return new u.Metadata(m,p)}static get instance(){return this._instance||(this._instance=this._create())}}g._instance=null,t.CTRolePermissionsUserTileMetadata=g;class m extends s.CTLayerComponent{constructor(){super(),this._busy=!1,this.setMetadata(g.instance)}static get is(){return"ct-role-permissions-user-tile"}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return n(302)}_showContactInfo(){this.layer.showContactInfoForJid(this.user.jid)}_deleteUserFromRole(){return o(this,void 0,void 0,function*(){if(yield this._checkRoleExists()){const e=new r.DefaultAlerts(this).AlertYesNoQuestion(this.translateI18nItem(h.CommonMetadata.getI18nItem(h.CommonI18nKeys.ARE_YOU_SURE)),this.translateI18nItem(g.instance.getI18nItem(p.CONFIRM_REMOVE_USER)),1,{yes:()=>o(this,void 0,void 0,function*(){this._busy=!0;const e={role:this.role.jid,permission:"give",jid:this.user.jid,action:"revoke"};(yield this.layer.setRolePermission(e))&&(this.giveTake=!1),e.permission="acquire",(yield this.layer.setRolePermission(e))&&(this.acquire=!1),e.permission="relinquish",(yield this.layer.setRolePermission(e))&&(this.relinquish=!1),this._busy=!1,this.layer.emit(d.ChatEvents.RefreshRoleAdminList,null),this.layer.emit(d.ChatEvents.RefreshRole,null)})});this.emitEvent(d.ChatEvents._Request_RaiseAlert,e)}else this.onRoleDoesNotExist&&this.onRoleDoesNotExist instanceof Function&&this.onRoleDoesNotExist()})}generateComponentMarkup(){if(!this.user)return;this.user.group||["group"].push("empty");this.user.jobTitle||["job-title"].push("empty");return window.__CTRender("div",{class:"columns"},window.__CTRender(c.CTUserTile,{user:this.user,height:this.height,avatarClickedCallback:this._showContactInfo,showJobTitle:!1,showGroups:!1},window.__CTRender("div",{slot:"additional",class:"permissions"},window.__CTRender("div",{class:"checkbox-container",onClick:(e=>o(this,void 0,void 0,function*(){if(e.preventDefault(),e.stopImmediatePropagation(),yield this._checkRoleExists()){const e=()=>o(this,void 0,void 0,function*(){const e={role:this.role.jid,permission:"give",jid:this.user.jid,action:this.giveTake?"revoke":"grant"};this._busy=!0;const t=yield this.layer.setRolePermission(e);this._busy=!1,t&&(this.giveTake=!this.giveTake)});if(this.acquire||this.relinquish||!this.giveTake)yield e();else{const t=new r.DefaultAlerts(this).AlertYesNoQuestion(this.translateI18nItem(h.CommonMetadata.getI18nItem(h.CommonI18nKeys.ARE_YOU_SURE)),this.translateI18nItem(g.instance.getI18nItem(p.CONFIRM_REMOVE_LAST_PERMISSION)),1,{yes:()=>o(this,void 0,void 0,function*(){yield e(),this.layer.emit(d.ChatEvents.RefreshRoleAdminList,null),this.layer.emit(d.ChatEvents.RefreshRole,null)})});this.emitEvent(d.ChatEvents._Request_RaiseAlert,t)}}else this.onRoleDoesNotExist&&this.onRoleDoesNotExist instanceof Function&&this.onRoleDoesNotExist()})).bind(this)},window.__CTRender("label",null,"GIVE/TAKE"),window.__CTRender("div",{class:"checkbox"},this.giveTake&&window.__CTRender(a.CTIcon,{width:"12",height:"12",icon:r.Icons.COMMON.Tick}))),window.__CTRender("div",{class:"checkbox-container",onClick:(e=>o(this,void 0,void 0,function*(){if(e.preventDefault(),e.stopImmediatePropagation(),yield this._checkRoleExists()){const e=()=>o(this,void 0,void 0,function*(){const e={role:this.role.jid,permission:"acquire",jid:this.user.jid,action:this.acquire?"revoke":"grant"};this._busy=!0;const t=yield this.layer.setRolePermission(e);this._busy=!1,t&&(this.acquire=!this.acquire)});if(!this.acquire||this.relinquish||this.giveTake)yield e();else{const t=new r.DefaultAlerts(this).AlertYesNoQuestion(this.translateI18nItem(h.CommonMetadata.getI18nItem(h.CommonI18nKeys.ARE_YOU_SURE)),this.translateI18nItem(g.instance.getI18nItem(p.CONFIRM_REMOVE_LAST_PERMISSION)),1,{yes:()=>o(this,void 0,void 0,function*(){yield e(),this.layer.emit(d.ChatEvents.RefreshRoleAdminList,null),this.layer.emit(d.ChatEvents.RefreshRole,null)})});this.emitEvent(d.ChatEvents._Request_RaiseAlert,t)}}else this.onRoleDoesNotExist&&this.onRoleDoesNotExist instanceof Function&&this.onRoleDoesNotExist()})).bind(this)},window.__CTRender("label",null,"ACQUIRE"),window.__CTRender("div",{class:"checkbox"},this.acquire&&window.__CTRender(a.CTIcon,{width:"12",height:"12",icon:r.Icons.COMMON.Tick}))),window.__CTRender("div",{class:"checkbox-container",onClick:(e=>o(this,void 0,void 0,function*(){if(e.preventDefault(),e.stopImmediatePropagation(),yield this._checkRoleExists()){const e=()=>o(this,void 0,void 0,function*(){const e={role:this.role.jid,permission:"relinquish",jid:this.user.jid,action:this.relinquish?"revoke":"grant"};this._busy=!0;const t=yield this.layer.setRolePermission(e);this._busy=!1,t&&(this.relinquish=!this.relinquish)});if(this.acquire||!this.relinquish||this.giveTake)yield e();else{const t=new r.DefaultAlerts(this).AlertYesNoQuestion(this.translateI18nItem(h.CommonMetadata.getI18nItem(h.CommonI18nKeys.ARE_YOU_SURE)),this.translateI18nItem(g.instance.getI18nItem(p.CONFIRM_REMOVE_LAST_PERMISSION)),1,{yes:()=>o(this,void 0,void 0,function*(){yield e(),this.layer.emit(d.ChatEvents.RefreshRoleAdminList,null),this.layer.emit(d.ChatEvents.RefreshRole,null)})});this.emitEvent(d.ChatEvents._Request_RaiseAlert,t)}}else this.onRoleDoesNotExist&&this.onRoleDoesNotExist instanceof Function&&this.onRoleDoesNotExist()})).bind(this)},window.__CTRender("label",null,"RELINQUISH"),window.__CTRender("div",{class:"checkbox"},this.relinquish&&window.__CTRender(a.CTIcon,{width:"12",height:"12",icon:r.Icons.COMMON.Tick}))),window.__CTRender("div",{class:"spinner"},this._busy&&window.__CTRender(a.CTIcon,{width:"20",height:"20",icon:r.Icons.COMMON.LoadingSpinner}),!this._busy&&window.__CTRender(a.CTIcon,{width:"20",height:"20",icon:r.Icons.COMMON.CircleCross,onClick:this._deleteUserFromRole.bind(this)})))))}_checkRoleExists(){return new Promise(e=>o(this,void 0,void 0,function*(){try{yield this.layer.getRole({role:this.role.jid});e(!0)}catch(t){e(!1)}}))}}i([s.prop({type:Object,attribute:!1,default:{}})],m.prototype,"role",void 0),i([s.prop({type:s.Stroolean,attribute:!1,default:!0})],m.prototype,"showAvatar",void 0),i([s.prop({type:Object,attribute:!1})],m.prototype,"user",void 0),i([s.prop({type:Object,attribute:!1,default:l.NameFormat.PREFIX_FIRST_LAST})],m.prototype,"nameFormat",void 0),i([s.prop({type:String,attribute:!1,default:null})],m.prototype,"height",void 0),i([s.prop({type:Object,attribute:!1,default:{}})],m.prototype,"detailStyle",void 0),i([s.prop({type:s.Stroolean,attribute:!1,default:!1})],m.prototype,"giveTake",void 0),i([s.prop({type:s.Stroolean,attribute:!1,default:!1})],m.prototype,"acquire",void 0),i([s.prop({type:s.Stroolean,attribute:!1,default:!1})],m.prototype,"relinquish",void 0),i([s.prop({type:Function,attribute:!1})],m.prototype,"onRoleDoesNotExist",void 0),t.CTRolePermissionsUserTile=m,m.register()},function(e,t,n){var i=n(303);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  width: 100%;\n  display: block; }\n  :host .name {\n    flex: 1 1 auto;\n    font-size: 18px;\n    color: var(--default-font-color, #212121);\n    white-space: pre-line;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    line-height: 23px; }\n  :host .job-title, :host .group {\n    color: var(--subtle-font-color, #828688);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis; }\n  :host .group {\n    font-style: italic; }\n  :host .empty {\n    color: #E1E1E1; }\n  :host .columns {\n    display: flex;\n    align-items: center; }\n    :host .columns ct-user-tile {\n      flex: 2 0; }\n    :host .columns .permissions {\n      width: 280px;\n      display: flex; }\n      :host .columns .permissions .checkbox-container {\n        width: 70px;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        cursor: pointer; }\n        :host .columns .permissions .checkbox-container label {\n          font-size: 10px;\n          font-weight: bold;\n          color: var(--default-font-color, #212121);\n          display: none;\n          cursor: pointer; }\n        :host .columns .permissions .checkbox-container .checkbox {\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          width: 18px;\n          height: 18px;\n          color: var(--subtle-font-color, #828688);\n          border: 2px solid var(--subtle-font-color, #828688); }\n      :host .columns .permissions .spinner {\n        width: 70px;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        cursor: pointer; }\n\n@media screen and (max-width: 960px) {\n  :host .columns .permissions {\n    margin-top: 5px; }\n    :host .columns .permissions .spinner {\n      position: absolute;\n      top: 40px;\n      right: 0; }\n    :host .columns .permissions .checkbox-container {\n      width: 120px;\n      justify-content: flex-start; }\n      :host .columns .permissions .checkbox-container label {\n        display: block;\n        margin-right: 10px; } }\n\n@media screen and (max-width: 420px) {\n  :host .columns .permissions {\n    width: auto;\n    margin-left: -9px; }\n    :host .columns .permissions .checkbox-container {\n      display: flex;\n      flex-direction: column;\n      width: 70px; }\n      :host .columns .permissions .checkbox-container label {\n        margin-right: 0;\n        margin-bottom: 5px; } }\n",""])},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(305);class a extends s.CTLayerComponent{constructor(){super(...arguments),this._tagify=null}static get is(){return"ct-tag-input"}renderedCallback(){super.renderedCallback();const e=this.shadowRoot.querySelector("input"),t=this.shadowRoot.querySelector(".container");e&&(this._onUpdate=this._onUpdate.bind(this),this._tagify=new r(e,{whitelist:this.whitelist||[],dropdown:{enabled:1,rootElement:t},maxTags:this.max||1/0,maxChars:this.maxLength||1/0}),this._value=this.defaultValue||[],this._tagify.addTags(this._value),this._tagify.on("add",this._onUpdate),this._tagify.on("remove",this._onUpdate))}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return n(306)}generateComponentMarkup(){return window.__CTRender("div",{class:"container"},window.__CTRender("input",{type:"text",placeholder:this.placeholder,name:this.name}))}clear(){this._clear()}_onUpdate(e){if(!e.detail.data)return;const t=e.detail.data.value;"add"===e.type?this._value=[...this._value,t]:"remove"===e.type&&(this._value=this._value.filter(e=>e!==t)),"function"==typeof this.callback&&this.callback({value:this._value})}_clear(){const e=this.shadowRoot.querySelector("input");e.value="",e.focus(),e.dispatchEvent(new Event("input"))}}i([s.prop({type:String,attribute:!0})],a.prototype,"placeholder",void 0),i([s.prop({type:String,attribute:!0})],a.prototype,"name",void 0),i([s.prop({type:Array,attribute:!1})],a.prototype,"defaultValue",void 0),i([s.prop({type:Number,attribute:!0,default:4e3})],a.prototype,"max",void 0),i([s.prop({type:Number,attribute:!0,default:4e3})],a.prototype,"maxLength",void 0),i([s.prop({type:Array,attribute:!1,default:!1})],a.prototype,"whitelist",void 0),t.CTTagInput=a,a.register()},function(e,t,n){var i,o,s;o=[],void 0===(s="function"==typeof(i=function(){"use strict";function e(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function n(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?t(o,!0).forEach(function(t){i(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):t(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){if(!e)return console.warn("Tagify: ","invalid input element ",e),this;this.applySettings(e,t),this.state={},this.value=[],this.listeners={},this.DOM={},this.$dropdownRootElement=this.settings.dropdown.rootElement?this.settings.dropdown.rootElement:document.body,this.extend(this,new this.EventDispatcher(this)),this.build(e),this.loadOriginalValues(),this.events.customBinding.call(this),this.events.binding.call(this),e.autofocus&&this.DOM.input.focus()}return o.prototype={isIE:window.document.documentMode,TEXTS:{empty:"empty",exceed:"number of tags exceeded",pattern:"pattern mismatch",duplicate:"already exists",notAllowed:"not allowed",maxChars:"max number of characters exceeded"},DEFAULTS:{delimiters:",",pattern:null,maxChars:1/0,maxTags:1/0,callbacks:{},addTagOnBlur:!0,duplicates:!1,whitelist:[],blacklist:[],enforceWhitelist:!1,keepInvalidTags:!1,autoComplete:!0,mixTagsAllowedAfter:/,|\.|\:|\s/,backspace:!0,skipInvalid:!1,transformTag:function(){},dropdown:{classname:"",enabled:2,maxItems:10,itemTemplate:"",fuzzySearch:!0}},templates:{wrapper:function(e,t){return'<tags class="tagify '.concat(t.mode?"tagify--mix":""," ").concat(e.className,'"\n                          ').concat(t.readonly?'readonly aria-readonly="true"':'aria-haspopup="true" aria-expanded="false"','\n                          role="tagslist">\n                <span contenteditable data-placeholder="').concat(e.placeholder||"&#8203;",'" aria-placeholder="').concat(e.placeholder||"",'"\n                      class="tagify__input"\n                      role="textbox"\n                      aria-multiline="false"></span>\n            </tags>')},tag:function(e,t){return"<tag title='".concat(t.title||e,"'\n                         contenteditable='false'\n                         spellcheck='false'\n                         class='tagify__tag ").concat(t.class?t.class:"","'\n                         ").concat(this.getAttributes(t),">\n                <x title='' class='tagify__tag__removeBtn' role='button' aria-label='remove tag'></x>\n                <div>\n                    <span class='tagify__tag-text'>").concat(e,"</span>\n                </div>\n            </tag>")},dropdownItem:function(e){var t=(e.value||e).replace(/`|'/g,"&#39;");return"<div ".concat(this.getAttributes(e),"\n                         class='tagify__dropdown__item ").concat(e.class?e.class:"",'\'\n                         tabindex="0"\n                         role="menuitem"\n                         aria-labelledby="dropdown-label">').concat(t,"</div>")}},customEventsList:["click","add","remove","invalid","input","edit"],applySettings:function(e,t){var n=e.getAttribute("data-whitelist"),i=e.getAttribute("data-blacklist");if(this.DEFAULTS.templates=this.templates,this.DEFAULTS.dropdown.itemTemplate=this.templates.dropdownItem,this.settings=this.extend({},this.DEFAULTS,t),this.settings.readonly=e.hasAttribute("readonly"),this.isIE&&(this.settings.autoComplete=!1),i&&(i=i.split(this.settings.delimiters))instanceof Array&&(this.settings.blacklist=i),n&&(n=n.split(this.settings.delimiters))instanceof Array&&(this.settings.whitelist=n),e.pattern)try{this.settings.pattern=new RegExp(e.pattern)}catch(e){}if(this.settings&&this.settings.delimiters)try{this.settings.delimiters=new RegExp(this.settings.delimiters,"g")}catch(e){}},parseHTML:function(e){return(new DOMParser).parseFromString(e.trim(),"text/html").body.firstElementChild},escapeHTML:function(e){var t=document.createTextNode(e),n=document.createElement("p");return n.appendChild(t),n.innerHTML},build:function(e){var t=this.DOM,n=this.settings.templates.wrapper(e,this.settings);t.originalInput=e,t.scope=this.parseHTML(n),t.input=t.scope.querySelector("[contenteditable]"),e.parentNode.insertBefore(t.scope,e),this.settings.dropdown.enabled>=0&&this.dropdown.init.call(this)},destroy:function(){this.DOM.scope.parentNode.removeChild(this.DOM.scope),this.dropdown.hide.call(this,!0)},loadOriginalValues:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.DOM.originalInput.value;if(e){this.removeAllTags();try{e=JSON.parse(e)}catch(e){}"mix"==this.settings.mode?this.parseMixTags(e):this.addTags(e).forEach(function(e){e&&e.classList.add("tagify--noAnim")})}},extend:function(e,t,n){function i(e){if(e instanceof Element)return!1;var t=Object.prototype.toString.call(e).split(" ")[1].slice(0,-1);return e===Object(e)&&"Array"!=t&&"Function"!=t&&"RegExp"!=t&&"HTMLUnknownElement"!=t}function o(e,t){for(var n in t)t.hasOwnProperty(n)&&(i(t[n])?i(e[n])?o(e[n],t[n]):e[n]=Object.assign({},t[n]):e[n]=t[n])}return e instanceof Object||(e={}),o(e,t),n&&o(e,n),e},EventDispatcher:function(e){var t=document.createTextNode("");this.off=function(e,n){return n&&t.removeEventListener.call(t,e,n),this},this.on=function(e,n){return n&&t.addEventListener.call(t,e,n),this},this.trigger=function(n,i){var o;if(n)if(e.settings.isJQueryPlugin)$(e.DOM.originalInput).triggerHandler(n,[i]);else{try{o=new CustomEvent(n,{detail:i})}catch(e){console.warn(e)}t.dispatchEvent(o)}}},events:{customBinding:function(){var e=this;this.customEventsList.forEach(function(t){e.on(t,e.settings.callbacks[t])})},binding:function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=this.events.callbacks,i=t?"addEventListener":"removeEventListener";for(var o in t&&!this.listeners.main&&(this.DOM.input.addEventListener(this.isIE?"keydown":"input",n[this.isIE?"onInputIE":"onInput"].bind(this)),this.settings.isJQueryPlugin&&$(this.DOM.originalInput).on("tagify.removeAllTags",this.removeAllTags.bind(this))),e=this.listeners.main=this.listeners.main||{paste:["input",n.onPaste.bind(this)],focus:["input",n.onFocusBlur.bind(this)],blur:["input",n.onFocusBlur.bind(this)],keydown:["input",n.onKeydown.bind(this)],click:["scope",n.onClickScope.bind(this)],dblclick:["scope",n.onDoubleClickScope.bind(this)]})this.DOM[e[o][0]][i](o,e[o][1])},callbacks:{onFocusBlur:function(e){var t=e.target.textContent.trim();"mix"!=this.settings.mode&&("focus"==e.type?(this.DOM.scope.classList.add("tagify--focus"),0===this.settings.dropdown.enabled&&this.dropdown.show.call(this)):"blur"==e.type?(this.DOM.scope.classList.remove("tagify--focus"),t&&this.settings.addTagOnBlur&&this.addTags(t,!0).length):(this.DOM.input.removeAttribute("style"),this.dropdown.hide.call(this)))},onKeydown:function(e){var t,n=this,i=e.target.textContent;if("mix"==this.settings.mode){switch(e.key){case"Delete":case"Backspace":var o=[];t=this.DOM.input.children,setTimeout(function(){[].forEach.call(t,function(e){return o.push(e.getAttribute("value"))}),n.value=n.value.filter(function(e){return-1!=o.indexOf(e.value)})},20);break;case"Enter":e.preventDefault()}return!0}switch(e.key){case"Backspace":""!=i&&8203!=i.charCodeAt(0)||(!0===this.settings.backspace?this.removeTag():"edit"==this.settings.backspace&&this.editTag());break;case"Esc":case"Escape":this.input.set.call(this),e.target.blur();break;case"ArrowRight":case"Tab":if(!i)return!0;case"Enter":e.preventDefault(),this.addTags(this.input.value||i,!0)}},onInput:function(e){var t=this.input.normalize.call(this),n=t.length>=this.settings.dropdown.enabled,i={value:t,inputElm:this.DOM.input};if("mix"==this.settings.mode)return this.events.callbacks.onMixTagsInput.call(this,e);t?this.input.value!=t&&(i.isValid=this.validateTag.call(this,t),this.input.set.call(this,t,!1),this.trigger("input",i),-1!=t.search(this.settings.delimiters)?this.addTags(t).length&&this.input.set.call(this):this.settings.dropdown.enabled>=0&&this.dropdown[n?"show":"hide"].call(this,t)):this.input.set.call(this,"")},onMixTagsInput:function(e){var t,n,i,o,s;if(this.maxTagsReached())return!0;window.getSelection&&(t=window.getSelection()).rangeCount>0&&((n=t.getRangeAt(0).cloneRange()).collapse(!0),n.setStart(window.getSelection().focusNode,0),(o=(i=n.toString().split(this.settings.mixTagsAllowedAfter))[i.length-1].match(this.settings.pattern))&&(this.state.tag={prefix:o[0],value:o.input.split(o[0])[1]},o=this.state.tag,s=this.state.tag.value.length>=this.settings.dropdown.enabled)),this.update(),this.trigger("input",this.extend({},this.state.tag,{textContent:this.DOM.input.textContent})),this.state.tag&&this.dropdown[s?"show":"hide"].call(this,this.state.tag.value)},onInputIE:function(e){var t=this;setTimeout(function(){t.events.callbacks.onInput.call(t,e)})},onPaste:function(e){},onClickScope:function(e){var t,n=e.target.closest("tag");"TAGS"==e.target.tagName?this.DOM.input.focus():"X"==e.target.tagName?this.removeTag(e.target.parentNode):n&&(t=this.getNodeIndex(n),this.trigger("click",{tag:n,index:t,data:this.value[t]}))},onEditTagInput:function(e){var t=e.closest("tag"),n=this.getNodeIndex(t),i=this.input.normalize(e),o=i.toLowerCase()==e.originalValue.toLowerCase()||this.validateTag(i);t.classList.toggle("tagify--invalid",!0!==o),t.isValid=o,this.trigger("input",{tag:t,index:n,data:this.extend({},this.value[n],{newValue:i})})},onEditTagBlur:function(e){var t,i=e.closest("tag"),o=this.getNodeIndex(i),s=this.input.normalize(e)||e.originalValue,r=this.input.normalize(e)!=e.originalValue,a=i.isValid,l=n({},this.value[o],{value:s});r&&(this.settings.transformTag.call(this,l),a=this.validateTag(l.value)),void 0!==a&&!0!==a||(e.textContent=l.value,this.value[o].value=l.value,this.update(),(t=e.cloneNode(!0)).removeAttribute("contenteditable"),i.title=l.value,i.classList.remove("tagify--editable"),e.parentNode.replaceChild(t,e),this.trigger("edit",{tag:i,index:o,data:this.value[o]}))},onEditTagkeydown:function(e){switch(e.key){case"Esc":case"Escape":e.target.textContent=e.target.originalValue;case"Enter":case"Tab":e.preventDefault(),e.target.blur()}},onDoubleClickScope:function(e){var t=e.target.closest("tag"),n=this.settings,i=t.classList.contains("tagify--editable"),o=t.hasAttribute("readonly");"mix"==n.mode||n.readonly||n.enforceWhitelist||!t||i||o||this.editTag(t)}}},editTag:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getLastTag(),n=t.querySelector(".tagify__tag-text"),i=this.events.callbacks;n?(t.classList.add("tagify--editable"),n.originalValue=n.textContent,n.setAttribute("contenteditable",!0),n.addEventListener("blur",i.onEditTagBlur.bind(this,n)),n.addEventListener("input",i.onEditTagInput.bind(this,n)),n.addEventListener("keydown",function(t){return i.onEditTagkeydown.call(e,t)}),n.focus()):console.warn("Cannot find element in Tag template: ",".tagify__tag-text")},input:{value:"",set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.input.value=e,t&&(this.DOM.input.innerHTML=e),e||this.dropdown.hide.call(this),e.length<2&&this.input.autocomplete.suggest.call(this,""),this.input.validate.call(this)},setRangeAtStartEnd:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1?arguments[1]:void 0;document.createRange&&((e=document.createRange()).selectNodeContents(i||this.DOM.input),e.collapse(n),(t=window.getSelection()).removeAllRanges(),t.addRange(e))},validate:function(){var e=!this.input.value||this.validateTag.call(this,this.input.value);this.DOM.input.classList.toggle("tagify__input--invalid",!0!==e)},normalize:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.DOM.input).innerText;return"settings"in this&&this.settings.delimiters&&(e=e.replace(/(?:\r\n|\r|\n)/g,this.settings.delimiters.source.charAt(1))),e=e.replace(/\s/g," ").replace(/^\s+/,"")},autocomplete:{suggest:function(e){e&&this.input.value?this.DOM.input.setAttribute("data-suggest",e.substring(this.input.value.length)):this.DOM.input.removeAttribute("data-suggest")},set:function(e){var t=this.DOM.input.getAttribute("data-suggest"),n=e||(t?this.input.value+t:null);return!!n&&(this.input.set.call(this,n),this.input.autocomplete.suggest.call(this,""),this.dropdown.hide.call(this),this.input.setRangeAtStartEnd.call(this),!0)}}},getNodeIndex:function(e){var t=0;if(e)for(;e=e.previousElementSibling;)t++;return t},getTagElms:function(){return this.DOM.scope.querySelectorAll("tag")},getLastTag:function(){var e=this.DOM.scope.querySelectorAll("tag:not(.tagify--hide):not([readonly])");return e[e.length-1]},isTagDuplicate:function(e){return this.value.findIndex(function(t){return e.trim().toLowerCase()===t.value.toLowerCase()})},getTagIndexByValue:function(e){var t=[];return this.getTagElms().forEach(function(n,i){n.textContent.trim().toLowerCase()==e.toLowerCase()&&t.push(i)}),t},getTagElmByValue:function(e){var t=this.getTagIndexByValue(e)[0];return this.getTagElms()[t]},markTagByValue:function(e,t){return!!(t=t||this.getTagElmByValue(e))&&(t.classList.add("tagify--mark"),t)},isTagBlacklisted:function(e){return e=e.toLowerCase().trim(),this.settings.blacklist.filter(function(t){return e==t.toLowerCase()}).length},isTagWhitelisted:function(e){return this.settings.whitelist.some(function(t){if((t.value||t).toLowerCase()===e.toLowerCase())return!0})},validateTag:function(e){var t=e.trim(),n=!0;return t?this.settings.pattern&&!this.settings.pattern.test(t)?n=this.TEXTS.pattern:this.settings.duplicates||-1===this.isTagDuplicate(t)?this.isTagBlacklisted(t)||this.settings.enforceWhitelist&&!this.isTagWhitelisted(t)?n=this.TEXTS.notAllowed:this.settings.maxChars&&t.length>this.settings.maxChars&&(n=this.TEXTS.maxChars):n=this.TEXTS.duplicate:n=this.TEXTS.empty,n},maxTagsReached:function(){return this.value.length>=this.settings.maxTags&&this.TEXTS.exceed},normalizeTags:function(t){var i,o=this.settings,s=o.whitelist,r=o.delimiters,a=o.mode,l=!!s&&s[0]instanceof Object,c=t instanceof Array&&t[0]instanceof Object&&"value"in t[0],d=[],h=function(e){return e.split(r).filter(function(e){return e}).map(function(e){return{value:e.trim()}})};if(c)return t=(i=[]).concat.apply(i,e(t.map(function(e){return h(e.value).map(function(t){return n({},e,{},t)})})));if("number"==typeof t&&(t=t.toString()),"string"==typeof t){if(!t.trim())return[];t=h(t)}else if(!c&&t instanceof Array){var u;t=(u=[]).concat.apply(u,e(t.map(function(e){return h(e)})))}return l&&(t.forEach(function(e){var t=s.filter(function(t){return t.value.toLowerCase()==e.value.toLowerCase()});t[0]?d.push(t[0]):"mix"!=a&&d.push(e)}),t=d),t},parseMixTags:function(e){for(var t,n,i=!1,o="",s=e,r=0;r<e.length;r++)"["==e[r]&&e[r]==e[r+1]&&(i=!0),i&&(o+=e[r]),"]"==e[r]&&e[r]==e[r-1]&&(i=!1,t=o.slice(2).slice(0,-2),this.isTagWhitelisted(t)&&!this.settings.duplicates&&-1==this.isTagDuplicate(t)&&(n=this.normalizeTags.call(this,t)[0],s=this.replaceMixStringWithTag(s,o,n).html),o="");return this.DOM.input.innerHTML=s,this.update(),e},replaceMixStringWithTag:function(e,t,n,i){return n&&e&&-1!=e.indexOf(t)&&(i=this.createTagElem(n),this.value.push(n),e=e.replace(t,i.outerHTML+"&#8288;")),{html:e,tagElm:i}},addMixTag:function(e){if(e&&this.state.tag){for(var t,n,i,o,s=this.state.tag.prefix+this.state.tag.value,r=document.createNodeIterator(this.DOM.input,NodeFilter.SHOW_TEXT),a=100;(t=r.nextNode())&&a--;)if(t.nodeType===Node.TEXT_NODE){if(-1==(i=t.nodeValue.indexOf(s)))continue;o=t.splitText(i),this.settings.transformTag.call(this,e),n=this.createTagElem(e),o.nodeValue=o.nodeValue.replace(s,""),t.parentNode.insertBefore(n,o),n.insertAdjacentHTML("afterend","&#8288;")}n&&(this.value.push(e),this.update(),this.trigger("add",this.extend({},{index:this.value.length,tag:n},e))),this.state.tag=null}},addTags:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.settings.skipInvalid,o=[];return e&&e.length?(e=this.normalizeTags.call(this,e),"mix"==this.settings.mode?this.addMixTag(e[0]):(this.DOM.input.removeAttribute("style"),e.forEach(function(e){var t,s,r={};if(e=Object.assign({},e),n.settings.transformTag.call(n,e),!0!==(t=n.maxTagsReached()||n.validateTag.call(n,e.value))){if(i)return;r["aria-invalid"]=!0,r.class=(e.class||"")+" tagify--notAllowed",r.title=t,n.markTagByValue(e.value),n.trigger("invalid",{data:e,index:n.value.length,message:t})}r.role="tag",e.readonly&&(r["aria-readonly"]=!0),s=n.createTagElem(n.extend({},e,r)),o.push(s),function(e){var t=this.DOM.scope.lastElementChild;t===this.DOM.input?this.DOM.scope.insertBefore(e,t):this.DOM.scope.appendChild(e)}.call(n,s),!0===t?(n.value.push(e),n.update(),n.DOM.scope.classList.toggle("hasMaxTags",n.value.length>=n.settings.maxTags),n.trigger("add",{tag:s,index:n.value.length-1,data:e})):n.settings.keepInvalidTags||setTimeout(function(){n.removeTag(s,!0)},1e3)}),e.length&&t&&this.input.set.call(this),o)):(console.warn("[addTags]","no tags to add:",e),o)},minify:function(e){return e.replace(new RegExp(">[\r\n ]+<","g"),"><")},createTagElem:function(e){var t=this.escapeHTML(e.value),n=this.settings.templates.tag.call(this,t,e);return this.settings.readonly&&(e.readonly=!0),n=this.minify(n),this.parseHTML(n)},removeTag:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getLastTag(),t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:250;if("string"==typeof e&&(e=this.getTagElmByValue(e)),e instanceof HTMLElement){var i,o=this.getNodeIndex(e);n&&n>10?(e.style.width=parseFloat(window.getComputedStyle(e).width)+"px",document.body.clientTop,e.classList.add("tagify--hide"),setTimeout(s,400)):s(),t||(i=this.value.splice(o,1)[0],this.update(),this.trigger("remove",{tag:e,index:o,data:i}),this.dropdown.render.call(this))}function s(){e.parentNode&&e.parentNode.removeChild(e)}},removeAllTags:function(){this.value=[],this.update(),Array.prototype.slice.call(this.getTagElms()).forEach(function(e){return e.parentNode.removeChild(e)})},getAttributes:function(e){if("[object Object]"!=Object.prototype.toString.call(e))return"";var t,n,i=Object.keys(e),o="";for(n=i.length;n--;)"class"!=(t=i[n])&&e.hasOwnProperty(t)&&(o+=" "+t+(e[t]?'="'.concat(e[t],'"'):""));return o},update:function(){this.DOM.originalInput.value="mix"==this.settings.mode?this.getMixedTagsAsString():this.value.length?JSON.stringify(this.value):""},getMixedTagsAsString:function(){var e="";return this.DOM.input.childNodes.forEach(function(t,n){1==t.nodeType?t.classList.contains("tagify__tag")&&(e+="[["+t.getAttribute("value")+"]]"):e+=t.textContent}),e},dropdown:{init:function(){this.DOM.dropdown=this.dropdown.build.call(this)},build:function(){var e=this.settings.dropdown,t=e.position,n=e.classname,i="".concat("manual"==t?"":"tagify__dropdown"," ").concat(n).trim(),o='<div class="'.concat(i,'" role="menu"></div>');return this.parseHTML(o)},show:function(e){var t,n="manual"==this.settings.dropdown.position;if(this.settings.whitelist.length){if(this.suggestedListItems=this.dropdown.filterListItems.call(this,e),!this.suggestedListItems.length)return this.input.autocomplete.suggest.call(this),void this.dropdown.hide.call(this);t=this.dropdown.createListHTML.call(this,this.suggestedListItems),this.DOM.dropdown.innerHTML=this.minify(t),this.settings.enforceWhitelist&&!n&&this.dropdown.highlightOption.call(this,this.DOM.dropdown.querySelector(".tagify__dropdown__item")),this.DOM.scope.setAttribute("aria-expanded",!0),this.trigger("dropdown:show",this.DOM.dropdown),this.$dropdownRootElement.contains(this.DOM.dropdown)||(n||(this.dropdown.position.call(this),this.$dropdownRootElement.appendChild(this.DOM.dropdown),this.events.binding.call(this,!1)),this.dropdown.events.binding.call(this))}},hide:function(e){var t=this.DOM,n=t.scope,i=t.dropdown,o="manual"==this.settings.dropdown.position&&!e;i&&this.$dropdownRootElement.contains(i)&&!o&&(window.removeEventListener("resize",this.dropdown.position),this.dropdown.events.binding.call(this,!1),this.events.binding.call(this),n.setAttribute("aria-expanded",!1),i.parentNode.removeChild(i),this.trigger("dropdown:hide",i))},render:function(){this.suggestedListItems=this.dropdown.filterListItems.call(this,"");var e=this.dropdown.createListHTML.call(this,this.suggestedListItems);this.DOM.dropdown.innerHTML=this.minify(e)},position:function(){var e=this.DOM.scope.getBoundingClientRect();this.DOM.dropdown.style.cssText="left: "+(e.left+window.pageXOffset)+"px;                                                top: "+(e.top+e.height-1+window.pageYOffset)+"px;                                                width: "+e.width+"px"},events:{binding:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.listeners.dropdown=this.listeners.dropdown||{position:this.dropdown.position.bind(this),onKeyDown:this.dropdown.events.callbacks.onKeyDown.bind(this),onMouseOver:this.dropdown.events.callbacks.onMouseOver.bind(this),onClick:this.dropdown.events.callbacks.onClick.bind(this)},n=e?"addEventListener":"removeEventListener";"manual"!=this.settings.dropdown.position&&(window[n]("resize",t.position),window[n]("keydown",t.onKeyDown)),window[n]("mousedown",t.onClick),this.DOM.dropdown[n]("mouseover",t.onMouseOver)},callbacks:{onKeyDown:function(e){var t=this,n=this.DOM.dropdown.querySelector("[class$='--active']"),i=n||this.DOM.dropdown.children[0],o="";switch(e.key){case"ArrowDown":case"ArrowUp":case"Down":case"Up":e.preventDefault(),i&&(i=i[("ArrowUp"==e.key||"Up"==e.key?"previous":"next")+"ElementSibling"]),i||(i=this.DOM.dropdown.children["ArrowUp"==e.key||"Up"==e.key?this.DOM.dropdown.children.length-1:0]),this.dropdown.highlightOption.call(this,i,!0);break;case"Escape":case"Esc":this.dropdown.hide.call(this);break;case"ArrowRight":case"Tab":if(e.preventDefault(),!this.input.autocomplete.set.call(this,i?i.textContent:null))return!1;case"Enter":if(e.preventDefault(),n)return o=this.suggestedListItems[this.getNodeIndex(n)]||this.input.value,this.addTags([o],!0),this.dropdown.hide.call(this),setTimeout(function(){return t.DOM.input.focus()},100),!1;this.addTags(this.input.value,!0)}},onMouseOver:function(e){e.target.className.includes("__item")&&this.dropdown.highlightOption.call(this,e.target)},onClick:function(e){var t,n,i=this;0==e.button&&e.path[0]!=this.DOM.dropdown&&((n=e.path[0])&&(t=this.suggestedListItems[this.getNodeIndex(n)]||this.input.value,this.addTags([t],!0),setTimeout(function(){return i.DOM.input.focus()},100)),this.dropdown.hide.call(this))}}},highlightOption:function(e,t){if(e){var n,i="tagify__dropdown__item--active";this.DOM.dropdown.querySelectorAll("[class$='--active']").forEach(function(e){e.classList.remove(i),e.removeAttribute("aria-selected")}),e.classList.add(i),e.setAttribute("aria-selected",!0),t&&(e.parentNode.scrollTop=e.clientHeight+e.offsetTop-e.parentNode.clientHeight),this.settings.autoComplete&&!this.settings.dropdown.fuzzySearch&&(n=this.suggestedListItems[this.getNodeIndex(e)].value||this.input.value,this.input.autocomplete.suggest.call(this,n))}},filterListItems:function(e){var t,n,i,o,s=this,r=[],a=this.settings.whitelist,l=this.settings.dropdown.maxItems||1/0,c=0;if(!e)return a.filter(function(e){return-1==s.isTagDuplicate(e.value||e)}).slice(0,l);for(;c<a.length&&(i=(((t=a[c]instanceof Object?a[c]:{value:a[c]}).searchBy||"")+" "+t.value).toLowerCase().indexOf(e.toLowerCase()),n=this.settings.dropdown.fuzzySearch?i>=0:0==i,o=!this.settings.duplicates&&this.isTagDuplicate(t.value)>-1,n&&!o&&l--&&r.push(t),0!=l);c++);return r},createListHTML:function(e){var t=this.settings.templates.dropdownItem.bind(this);return e.map(t).join("")}}},o})?i.apply(t,o):i)||(e.exports=s)},function(e,t,n){var i=n(307);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,'/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host label {\n  color: var(--default-font-color, #212121); }\n\n:host div div.input {\n  position: relative;\n  display: flex;\n  flex-direction: row;\n  margin: 0 0 5px 0;\n  border-bottom: 1px solid var(--default-border-color, #d9d9d9); }\n  :host div div.input.focus {\n    border-color: var(--login-form-border-color, green); }\n  :host div div.input input,\n  :host div div.input textarea {\n    flex: 1 1;\n    font-family: inherit;\n    font-size: inherit;\n    font-weight: inherit;\n    background-color: var(--default-bg-color-light, transparent);\n    border: none;\n    padding: 0.3em;\n    margin: auto;\n    outline: none;\n    resize: none;\n    color: var(--login-form-font-color, inherit); }\n    :host div div.input input.transparent,\n    :host div div.input textarea.transparent {\n      background-color: transparent; }\n    :host div div.input input:focus,\n    :host div div.input textarea:focus {\n      border: none;\n      outline-offset: 0; }\n      :host div div.input input:focus:not(:placeholder-shown) ~ .clear-value,\n      :host div div.input textarea:focus:not(:placeholder-shown) ~ .clear-value {\n        opacity: 0.5;\n        cursor: pointer; }\n      :host div div.input input:focus:not(:placeholder-shown) ~ .required,\n      :host div div.input textarea:focus:not(:placeholder-shown) ~ .required {\n        visibility: hidden; }\n    :host div div.input input:valid ~ .required,\n    :host div div.input textarea:valid ~ .required {\n      visibility: hidden; }\n  :host div div.input ct-icon {\n    flex: 0 0 20px;\n    text-align: center; }\n    :host div div.input ct-icon.show-password {\n      opacity: 0.5; }\n      :host div div.input ct-icon.show-password.show-password-enabled {\n        opacity: 1; }\n    :host div div.input ct-icon.required {\n      position: absolute;\n      right: 5px;\n      top: 0;\n      height: 100%; }\n    :host div div.input ct-icon.clear-value {\n      opacity: 0; }\n    :host div div.input ct-icon + ct-icon {\n      margin: 0 0 0 5px; }\n  :host div div.input .validation {\n    margin-bottom: 1%;\n    color: red; }\n\n:host div.disabled div.input {\n  border-bottom: none; }\n\n:host([full-border]) div div.input {\n  background-color: var(--default-bg-color-light, #fff);\n  border: 1px solid var(--select-border-color, #d9d9d9);\n  color: var(--default-bg-color-light-font, #212121); }\n  :host([full-border]) div div.input input::placeholder,\n  :host([full-border]) div div.input textarea::placeholder {\n    color: var(--select-placeholder-color, #828688); }\n  :host([full-border]) div div.input input::-webkit-input-placeholder,\n  :host([full-border]) div div.input textarea::-webkit-input-placeholder {\n    color: var(--select-placeholder-color, #828688); }\n\n:host([theme-light]) label {\n  color: #ffffff; }\n\n:host([theme-light]) div div.input {\n  border-bottom: 1px solid rgba(255, 255, 255, 0.6);\n  color: #ffffff; }\n  :host([theme-light]) div div.input input,\n  :host([theme-light]) div div.input textarea {\n    color: #ffffff; }\n    :host([theme-light]) div div.input input::placeholder,\n    :host([theme-light]) div div.input textarea::placeholder {\n      color: rgba(255, 255, 255, 0.6); }\n    :host([theme-light]) div div.input input::-webkit-input-placeholder,\n    :host([theme-light]) div div.input textarea::-webkit-input-placeholder {\n      color: rgba(255, 255, 255, 0.6); }\n  :host([theme-light]) div div.input.focus {\n    border-color: #ffffff; }\n\n.tagify {\n  --tag-bg: #E5E5E5;\n  --tag-hover: #D3E2E2;\n  display: flex;\n  align-items: flex-start;\n  flex-wrap: wrap;\n  border: 1px solid #DDD;\n  padding: 0;\n  cursor: text;\n  position: relative;\n  transition: .1s; }\n\n@keyframes tags--bump {\n  30% {\n    transform: scale(1.2); } }\n  .tagify:hover {\n    border-color: #CCC; }\n  .tagify.tagify--focus {\n    border-color: var(--header-bg); }\n  .tagify[readonly] {\n    cursor: default; }\n    .tagify[readonly] > .tagify__input {\n      visibility: hidden;\n      width: 0;\n      margin: 0.15em 0; }\n    .tagify[readonly] .tagify__tag__removeBtn {\n      display: none; }\n    .tagify[readonly] .tagify__tag > div {\n      padding: 0.15em 0.5em; }\n      .tagify[readonly] .tagify__tag > div::before {\n        background: linear-gradient(45deg, #d6d6d6 25%, transparent 25%, transparent 50%, #d6d6d6 50%, #d6d6d6 75%, transparent 75%, transparent) 0/5px 5px;\n        box-shadow: none; }\n  .tagify + input,\n  .tagify + textarea {\n    border: 0;\n    display: none; }\n  .tagify__tag {\n    display: inline-block;\n    margin: 0.15em 0 0.15em 0.15em;\n    position: relative;\n    z-index: 1;\n    cursor: default;\n    transition: .13s ease-out; }\n    .tagify__tag.tagify--editable > div::before {\n      box-shadow: 0 0 0 2px #D3E2E2 inset !important;\n      box-shadow: 0 0 0 2px var(--tag-hover) inset !important; }\n    .tagify__tag.tagify--editable.tagify--invalid > div::before {\n      box-shadow: 0 0 0 2px #D39494 inset !important; }\n    .tagify__tag > div {\n      vertical-align: top;\n      position: relative;\n      box-sizing: border-box;\n      max-width: 100%;\n      padding: 0.15em 0.5em;\n      color: black;\n      border-radius: 3px;\n      user-select: none;\n      transition: .13s ease-out;\n      padding-right: 1.5em; }\n      .tagify__tag > div > * {\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        display: inline-block;\n        vertical-align: top; }\n        .tagify__tag > div > *[contenteditable] {\n          outline: none; }\n      .tagify__tag > div::before {\n        content: \'\';\n        position: absolute;\n        border-radius: inherit;\n        left: 0;\n        top: 0;\n        right: 0;\n        bottom: 0;\n        box-shadow: 0 0 0 16px #E5E5E5 inset;\n        box-shadow: 0 0 0 16px var(--tag-bg) inset;\n        z-index: -1;\n        pointer-events: none;\n        transition: 120ms ease;\n        animation: tags--bump .3s ease-out 1; }\n    .tagify__tag:hover:not([readonly]) div::before {\n      top: -2px;\n      right: -2px;\n      bottom: -2px;\n      left: -2px;\n      box-shadow: 0 0 0 16px #D3E2E2 inset;\n      box-shadow: 0 0 0 16px var(--tag-hover) inset; }\n    .tagify__tag.tagify--noAnim {\n      animation: none; }\n    .tagify__tag.tagify--hide {\n      width: 0 !important;\n      padding-left: 0;\n      padding-right: 0;\n      margin-left: 0;\n      margin-right: 0;\n      opacity: 0;\n      transform: scale(0);\n      transition: .3s;\n      pointer-events: none; }\n    .tagify__tag.tagify--mark div::before {\n      animation: none; }\n    .tagify__tag.tagify--notAllowed div > span {\n      opacity: .5; }\n    .tagify__tag.tagify--notAllowed div::before {\n      box-shadow: 0 0 0 20px rgba(211, 148, 148, 0.44) inset !important;\n      transition: .2s; }\n    .tagify__tag[readonly] .tagify__tag__removeBtn {\n      display: none; }\n    .tagify__tag[readonly] > div {\n      padding: 0.15em 0.5em; }\n      .tagify__tag[readonly] > div::before {\n        background: linear-gradient(45deg, #d6d6d6 25%, transparent 25%, transparent 50%, #d6d6d6 50%, #d6d6d6 75%, transparent 75%, transparent) 0/5px 5px;\n        box-shadow: none; }\n  .tagify__tag__removeBtn {\n    font: 14px/16px Serif;\n    width: 14px;\n    height: 14px;\n    text-align: center;\n    border-radius: 50px;\n    position: absolute;\n    z-index: 1;\n    right: calc(0.5em - 2px);\n    top: 50%;\n    cursor: pointer;\n    transform: translateY(-50%);\n    transition: .2s ease-out; }\n    .tagify__tag__removeBtn::after {\n      content: "\\D7"; }\n    .tagify__tag__removeBtn:hover {\n      color: white;\n      background: #c77777; }\n      .tagify__tag__removeBtn:hover + div > span {\n        opacity: .5; }\n      .tagify__tag__removeBtn:hover + div::before {\n        box-shadow: 0 0 0 20px rgba(211, 148, 148, 0.3) inset !important;\n        transition: .2s; }\n  .tagify__input {\n    display: block;\n    min-width: 110px;\n    margin: 0.15em;\n    padding: 0.15em 0.5em;\n    position: relative;\n    /*\r\n            in "mix mode" the tags are inside the "input" element\r\n        */ }\n    .tagify__input:empty::before {\n      transition: .2s ease-out;\n      opacity: 0.5;\n      transform: none; }\n    .tagify__input:focus {\n      outline: none; }\n      .tagify__input:focus::before {\n        transition: .2s ease-out;\n        opacity: 0;\n        transform: translatex(6px); }\n        @supports (-moz-appearance: none) {\n          .tagify__input:focus::before {\n            display: none; } }\n      .tagify__input:focus:empty::before {\n        transition: .2s ease-out;\n        opacity: 0.3;\n        transform: none; }\n        @supports (-moz-appearance: none) {\n          .tagify__input:focus:empty::before {\n            display: inline-block; } }\n    .tagify__input::before {\n      content: attr(data-placeholder);\n      line-height: 1.8;\n      position: absolute;\n      top: 0;\n      z-index: 1;\n      color: black;\n      white-space: nowrap;\n      pointer-events: none;\n      opacity: 0; }\n    @supports (-moz-appearance: none) {\n      .tagify__input::before {\n        line-height: inherit;\n        position: relative; } }\n    .tagify__input::after {\n      content: attr(data-suggest);\n      color: black;\n      opacity: .3;\n      pointer-events: none; }\n    .tagify__input .tagify__tag {\n      line-height: 1.1; }\n      .tagify__input .tagify__tag > div {\n        padding-top: 0;\n        padding-bottom: 0; }\n        .tagify__input .tagify__tag > div::before {\n          top: -3px;\n          bottom: -3px; }\n      .tagify__input .tagify__tag:hover:not([readonly]) > div::before {\n        top: -3px;\n        bottom: -3px;\n        left: 0;\n        right: 0; }\n  .tagify--mix .tagify__input {\n    padding: 0.15em;\n    margin: 0;\n    width: 100%;\n    height: 100%;\n    line-height: 1.7; }\n  .tagify__dropdown {\n    z-index: 999;\n    background: white;\n    max-height: 300px;\n    overflow: auto;\n    border: 1px solid var(--header-bg);\n    box-shadow: 0 2px 4px -2px rgba(0, 0, 0, 0.2);\n    box-sizing: border-box; }\n    .tagify__dropdown__item {\n      box-sizing: inherit;\n      padding: .35em .6em;\n      margin: 2px;\n      cursor: pointer;\n      border-radius: 3px;\n      position: relative;\n      outline: none; }\n      .tagify__dropdown__item--active {\n        background: #E5E5E5; }\n      .tagify__dropdown__item:active {\n        background: #f2f2f2; }\n',""])},function(e,t,n){var i=n(309);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n:host {\n  display: block;\n  font-size: 1em; }\n  :host .heading ::slotted(*) {\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    padding-left: 10px;\n    padding-right: 10px; }\n  :host .header {\n    position: relative;\n    display: flex;\n    align-items: center;\n    height: var(--header-height, 75px);\n    padding: 0 10px;\n    background: var(--header-bg, #22b1c8);\n    color: var(--header-text, #ffffff); }\n    :host .header .left-action {\n      flex: 0 0 20px; }\n    :host .header .details {\n      flex: 1 1 auto;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: center;\n      height: 100%;\n      text-align: center;\n      transition: padding 0.3s ease-out;\n      overflow: hidden; }\n      :host .header .details .heading {\n        font-size: 1.5em;\n        width: 100%; }\n      :host .header .details .sub-heading {\n        font-weight: 100;\n        font-size: 16px; }\n      :host .header .details .status {\n        position: absolute;\n        bottom: 0;\n        left: 50%;\n        transform: translate(-50%, 100%);\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        font-size: .833em;\n        padding: 3px 10px;\n        border: 1px solid rgba(255, 255, 255, 0.5);\n        border-bottom: 0;\n        border-radius: 10px 10px 0 0;\n        will-change: transform;\n        transition: transform 0.3s ease-out;\n        z-index: -1; }\n        :host .header .details .status .icon {\n          margin: 0 0 0 5px; }\n    :host .header .right-action {\n      flex: 0 0 20px; }\n    :host .header.offline .details {\n      padding: 0 0 20px 0; }\n      :host .header.offline .details .status {\n        transform: translate(-50%, 0);\n        z-index: 1;\n        cursor: pointer; }\n        :host .header.offline .details .status:hover {\n          background: rgba(255, 255, 255, 0.1); }\n    :host .header.disconnecting .details .status, :host .header.connecting .details .status {\n      opacity: 0.5;\n      cursor: default; }\n",""])},function(e,t,n){var i=n(311);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: block; }\n  :host .bg {\n    position: relative;\n    flex: none;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    border-radius: 50%;\n    overflow: hidden;\n    background-color: #0fa54b;\n    background-image: linear-gradient(to bottom, #7fe4a7 0%, #0fa54b 87%);\n    color: var(--avatar-color, #ffffff); }\n    :host .bg .image {\n      position: absolute;\n      top: 0;\n      left: 0;\n      border-radius: 50%; }\n",""])},function(e,t,n){var i=n(313);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host .name {\n  flex: 1 1 auto;\n  font-size: 18px;\n  color: var(--default-font-color, #212121);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis; }\n\n@media screen and (min-width: 960px) {\n  :host .count {\n    line-height: 2.3; } }\n\n:host .job-title, :host .group {\n  color: var(--subtle-font-color, #828688);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis; }\n\n:host .group {\n  font-style: italic; }\n\n:host .empty {\n  color: #E1E1E1; }\n",""])},function(e,t,n){var i=n(315);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,'/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: flex;\n  flex-direction: column;\n  height: 100%; }\n  :host .user-list {\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    flex: 1 1 auto;\n    height: 100%; }\n    :host .user-list .search {\n      flex: 0 0 55px;\n      display: flex;\n      padding: 0 20px;\n      justify-content: center;\n      align-items: center;\n      background: var(--secondary-color, #2c394e);\n      border-bottom: var(--secondary-border, 1px solid #dddddd); }\n      :host .user-list .search .search-box {\n        width: 75%;\n        font-size: 14px; }\n      :host .user-list .search .fields {\n        margin-top: 10px; }\n      :host .user-list .search input[type="radio"] {\n        display: none; }\n      :host .user-list .search input[type="radio"]:checked + span {\n        font-weight: bold;\n        color: var(--primary-color, #15233b); }\n      :host .user-list .search label {\n        border-right: solid 1px #E1E1E1;\n        padding: 0 10px;\n        color: #999999;\n        font-size: 14px; }\n      :host .user-list .search label:first-child {\n        color: #CCCCCC; }\n      :host .user-list .search label:first-child, :host .user-list .search label:last-child {\n        border-right: none; }\n    :host .user-list .selected-users {\n      flex: none;\n      display: flex;\n      align-items: center;\n      height: 0;\n      background-color: var(--list-item-bg, #ffffff);\n      overflow-x: auto;\n      overflow-y: hidden;\n      -webkit-overflow-scrolling: touch;\n      transition: height var(--animation-normal, 0.5s) ease-out; }\n      :host .user-list .selected-users .scroller {\n        display: inline-flex; }\n        :host .user-list .selected-users .scroller .selected-user {\n          display: inline-flex;\n          flex-direction: column;\n          justify-content: center;\n          align-items: center;\n          text-overflow: ellipsis;\n          width: 75px;\n          margin: 10px 0 0 0; }\n          :host .user-list .selected-users .scroller .selected-user .avatar {\n            position: relative;\n            margin: 0 0 5px 0; }\n            :host .user-list .selected-users .scroller .selected-user .avatar .remove {\n              position: absolute;\n              display: flex;\n              flex-direction: column;\n              justify-content: center;\n              align-items: center;\n              top: -5px;\n              right: -5px;\n              width: 16px;\n              height: 16px;\n              border-radius: 50%;\n              background: #7b7e80;\n              border: 2px solid var(--avatar-color, #ffffff);\n              color: var(--primary-font-color, #ffffff);\n              cursor: pointer; }\n          :host .user-list .selected-users .scroller .selected-user .name {\n            font-size: 14px;\n            color: var(--default-font-color);\n            overflow: hidden;\n            text-overflow: ellipsis;\n            width: 100%;\n            height: 20px;\n            line-height: 0.9em;\n            text-align: center;\n            white-space: nowrap; }\n      :host .user-list .selected-users.has-selections {\n        height: 70px;\n        border-bottom: var(--list-item-border, 1px solid #dddddd); }\n    :host .user-list .user-list-items {\n      position: relative;\n      display: flex;\n      flex-direction: column;\n      flex: 1 1 auto;\n      overflow: hidden;\n      height: 100%; }\n      :host .user-list .user-list-items .users-loading-bg {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        display: flex;\n        background: var(--list-bg, #2c394e);\n        z-index: -1; }\n      :host .user-list .user-list-items .users {\n        flex: 1 1 auto;\n        overflow: auto;\n        -webkit-overflow-scrolling: touch; }\n        :host .user-list .user-list-items .users .user {\n          position: relative; }\n          :host .user-list .user-list-items .users .user .selection {\n            position: absolute;\n            top: 0;\n            right: 0;\n            height: 100%;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            padding: 0 20px;\n            cursor: pointer; }\n            :host .user-list .user-list-items .users .user .selection .checkbox {\n              display: flex;\n              justify-content: center;\n              align-items: center;\n              width: 16px;\n              height: 16px;\n              color: var(--subtle-font-color, #828688);\n              border: 2px solid var(--subtle-font-color, #828688) !important; }\n            :host .user-list .user-list-items .users .user .selection .current {\n              display: flex;\n              justify-content: center;\n              align-items: center;\n              color: white;\n              background-color: #7d7d7d;\n              border-radius: 4px;\n              padding: 3px 4px;\n              opacity: 1; }\n          :host .user-list .user-list-items .users .user.selected .selection .checkbox {\n            border: 0; }\n          :host .user-list .user-list-items .users .user.selection-disabled .selection {\n            opacity: 0;\n            cursor: not-allowed; }\n          :host .user-list .user-list-items .users .user.item-disabled .selection {\n            cursor: default; }\n          :host .user-list .user-list-items .users .user.clickable {\n            cursor: pointer; }\n    :host .user-list .initial-message,\n    :host .user-list .fetching,\n    :host .user-list .no-users {\n      flex: 1;\n      display: flex;\n      justify-content: center;\n      align-items: flex-start;\n      height: 100%;\n      text-align: center;\n      padding: 55px;\n      background: var(--list-bg, #2c394e);\n      color: var(--subtle-font-color, #828688); }\n    :host .user-list .initial-message {\n      align-items: center;\n      font-size: 18px; }\n',""])},function(e,t,n){var i=n(317);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n:host {\n  display: block;\n  height: 100%;\n  font-size: 1em; }\n  :host .contact-list {\n    flex: 1 1 auto;\n    display: flex;\n    flex-direction: column;\n    height: 100%; }\n    :host .contact-list .header .action {\n      cursor: pointer; }\n    :host .contact-list .user-list {\n      flex: 1 1 auto;\n      display: flex;\n      flex-direction: column;\n      overflow: auto; }\n      :host .contact-list .user-list #user-list {\n        display: flex;\n        flex-direction: column;\n        flex: 1; }\n    :host .contact-list .footer {\n      flex: 0 0 auto;\n      background: var(--secondary-color, #f2f2f2);\n      border-top: var(--secondary-border, 1px solid #dddddd);\n      display: flex;\n      padding: 10px 20px; }\n      :host .contact-list .footer .button {\n        flex: 1 1;\n        margin: 0 5px; }\n",""])},function(e,t,n){var i=n(319);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n:host {\n  display: block;\n  font-size: 1em; }\n  :host .attachment {\n    display: block; }\n    :host .attachment .loading,\n    :host .attachment .error {\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: center;\n      width: 160px;\n      height: 100px;\n      color: var(--chat-message-bubble-received-text, #212121); }\n      :host .attachment .loading.mine,\n      :host .attachment .error.mine {\n        color: var(--chat-message-bubble-sent-text, #ffffff); }\n      :host .attachment .loading.hidden,\n      :host .attachment .error.hidden {\n        display: none; }\n      :host .attachment .loading .message,\n      :host .attachment .error .message {\n        display: flex;\n        flex-direction: row;\n        margin: 5px 0 0 0; }\n        :host .attachment .loading .message .icon,\n        :host .attachment .error .message .icon {\n          margin: 0 5px 0 0; }\n    :host .attachment .error {\n      cursor: pointer; }\n    :host .attachment .image {\n      display: block;\n      margin: 0 auto;\n      max-width: 200px;\n      border-radius: 15px;\n      overflow: hidden; }\n      :host .attachment .image.interactive {\n        cursor: pointer; }\n      :host .attachment .image.hidden {\n        display: none; }\n    :host .attachment + .content {\n      margin: 5px 0 0 0; }\n",""])},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(43),s=n(25),r=n(5),a=s.getSource("Media");var l;!function(e){e[e.NoAudioDevicesFound=1]="NoAudioDevicesFound"}(l=t.AudioRecorderError||(t.AudioRecorderError={}));t.SimpleAudioRecorder=class{constructor(e,t){this._onDataAvailable=(e=>{this._chunks.push(e.data)}),this._onStopRecording=(e=>i(this,void 0,void 0,function*(){this._stream.stop();const e=new Blob(this._chunks);try{const t=yield this._encodeToMp3(e);this._onFinishedCallback&&this._onFinishedCallback(t)}catch(e){this._onFinishedCallback&&this._onFinishedCallback(null)}})),this._mediaError=(()=>{}),this._mediaStatusUpdate=(e=>{}),this._isMobile=r.isMobile(),this._onFinishedCallback=e,this._errorCallback=t}_encodeToMp3(e){return new Promise((t,n)=>i(this,void 0,void 0,function*(){const i=yield o.saveFileToDisk(e,"recording.webm"),s=this._workOutPath(i);window.require("easy-ffmpeg")(i).output(s).on("end",()=>{window.require("fs").unlink(i,()=>{t(s)})}).on("error",e=>{console.error("Encoding error:",e),n(e)}).run()}))}_workOutPath(e){const t=window;return t.process&&"win32"===t.process.platform?`${`${e.substring(0,e.lastIndexOf("\\"))}`}\\${(new Date).valueOf()}_recording.mp3`:`${`${e.substring(0,e.lastIndexOf("/"))}`}/${(new Date).valueOf()}_recording.mp3`}start(){return i(this,void 0,void 0,function*(){if(this._isMobile){let e=yield o.getStorageLocation();0===e.indexOf("file://")&&(e=e.replace("file://",""));const t=`${e}${(new Date).getTime()}.m4a`;this._media=new a(t,()=>{},this._mediaError,this._mediaStatusUpdate),this._media.startRecordWithCompression({SampleRate:44100,NumberOfChannels:1})}else try{this._chunks=[],this._stream=yield navigator.mediaDevices.getUserMedia({audio:!0}),this._recorder=new window.MediaRecorder(this._stream),this._recorder.addEventListener("dataavailable",this._onDataAvailable),this._recorder.addEventListener("stop",this._onStopRecording),this._recorder.start()}catch(e){console.error("NK:",e),e.name&&"DevicesNotFoundError"===e.name&&this._errorCallback&&this._errorCallback(l.NoAudioDevicesFound)}})}stop(){return i(this,void 0,void 0,function*(){this._isMobile?(this._media.stopRecord(),this._media.release(),this._onFinishedCallback&&this._onFinishedCallback(this._media.src)):this._recorder&&this._recorder.stop&&this._recorder.stop()})}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(14);t.AttachmentInteractionEventArgs=class extends i.BaseEventArgs{constructor(e,t){super(),this.event=e,this.userInitiated=t}}},function(e,t,n){var i=n(323);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n:host {\n  display: flex;\n  flex: 1; }\n  :host div.container {\n    display: flex;\n    flex: 1; }\n    :host div.container div.progress {\n      display: flex;\n      width: 100%;\n      align-items: center;\n      margin: auto 0; }\n      :host div.container div.progress div.bar {\n        display: flex;\n        flex: 1;\n        background-color: var(--default-border-color, #dddddd);\n        height: 3px;\n        width: 100%; }\n        :host div.container div.progress div.bar span {\n          display: inline-block;\n          height: 3px;\n          background-color: var(--primary-color, #22b1c8);\n          transition: all 100ms linear; }\n      :host div.container div.progress div.length {\n        font-size: 0.8em; }\n        :host div.container div.progress div.length.left {\n          margin-right: 10px; }\n        :host div.container div.progress div.length.right {\n          margin-left: 10px; }\n    :host div.container div.controls {\n      display: flex;\n      align-items: center;\n      justify-content: center; }\n      :host div.container div.controls div.action {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        flex: none;\n        width: 36px;\n        height: 36px;\n        background: var(--primary-color, #22b1c8);\n        color: var(--primary-font-color, #ffffff);\n        border-radius: 50%;\n        cursor: pointer;\n        margin-right: 10px;\n        transition: background 300ms ease-in;\n        transition: opacity 300ms linear; }\n        :host div.container div.controls div.action.disabled {\n          background: var(--subtle-font-color, #828688);\n          cursor: default; }\n        :host div.container div.controls div.action.flash {\n          opacity: 0.5; }\n",""])},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(43);t.SimpleVideoRecorder=class{constructor(e,t){this._constraints={audio:!0,video:{width:640,height:480,frameRate:24}},this._onDataAvailable=(e=>{this._chunks.push(e.data)}),this._onStopRecording=(e=>i(this,void 0,void 0,function*(){const e=new Blob(this._chunks);try{const t=yield o.saveFileToDisk(e,"video.webm");this._onFinishedCallback&&this._onFinishedCallback(t)}catch(e){console.error("NK: File saving error",e)}})),this._video=e,this._onFinishedCallback=t}_encodeToMp4(e){return new Promise((t,n)=>i(this,void 0,void 0,function*(){const i=yield o.saveFileToDisk(e,"video.webm"),s=`${`${i.substring(0,i.lastIndexOf("/"))}`}/${(new Date).valueOf()}_video.mp4`;window.require("easy-ffmpeg")(i).output(s).on("end",()=>{window.require("fs").unlink(i,()=>{t(s)})}).on("error",e=>{console.error("Encoding error:",e),n(e)}).run()}))}start(){return i(this,void 0,void 0,function*(){this._chunks=[],this._stream=yield navigator.mediaDevices.getUserMedia(this._constraints),this._video.onloadedmetadata=(()=>this._video.play()),this._video.muted=!0,this._video.srcObject=this._stream,this._recorder=new window.MediaRecorder(this._stream),this._recorder.addEventListener("dataavailable",this._onDataAvailable),this._recorder.addEventListener("stop",this._onStopRecording),this._recorder.start()})}stop(){this._recorder.stop(),this._stream.getTracks().forEach(e=>e.stop()),this._video.srcObject=null}}},function(e,t,n){var i=n(326);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n:host {\n  display: flex;\n  flex: 1; }\n  :host div.container {\n    display: flex;\n    flex: 1;\n    justify-content: space-between; }\n    :host div.container div.controls {\n      display: flex;\n      align-items: flex-start;\n      justify-content: center; }\n      :host div.container div.controls div.action {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        flex: none;\n        width: 36px;\n        height: 36px;\n        background: var(--primary-color, #22b1c8);\n        color: var(--primary-font-color, #ffffff);\n        border-radius: 50%;\n        cursor: pointer;\n        margin-right: 10px;\n        transition: background 300ms ease-in;\n        transition: opacity 300ms linear; }\n        :host div.container div.controls div.action.disabled {\n          background: var(--subtle-font-color, #828688);\n          cursor: default; }\n        :host div.container div.controls div.action.flash {\n          opacity: 0.5; }\n    :host div.container div.player {\n      display: flex;\n      width: 100%;\n      align-items: center;\n      margin: auto 0;\n      justify-content: center; }\n",""])},function(e,t,n){var i=n(328);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,":host {\n  display: block;\n  width: 100%;\n  height: 100%; }\n  :host div.container {\n    width: 100%; }\n    :host div.container .attached-image {\n      box-sizing: border-box;\n      display: inline-block;\n      height: auto;\n      width: 150px; }\n    :host div.container div.error {\n      display: flex;\n      align-items: center; }\n      :host div.container div.error ct-icon {\n        margin-right: 10px; }\n    :host div.container--isThumbnail {\n      width: 75px; }\n      :host div.container--isThumbnail .attached-image {\n        width: 75px;\n        height: 75px; }\n",""])},function(e,t,n){var i=n(330);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/* Common Standard Breakpoints */\n.CTCLPill-pill {\n  box-sizing: border-box;\n  color: var(--tertiary-font-color, white);\n  padding: 5px 20px;\n  border-radius: 20px;\n  width: 105px; }\n  @media screen and (min-width: 640px) {\n    .CTCLPill-pill {\n      width: 120px; } }\n\n@media screen and (min-width: 960px) {\n  .CTCLPill-textContainer.isInline {\n    width: 120px; } }\n\n.CTCLPill-textContainer.isInline .CTCLPill-inlineText {\n  display: inline-block;\n  vertical-align: middle; }\n\n.CTCLPill-textContainer.isInline .CTCLPill-text {\n  width: calc(100% - 37px); }\n\n.CTCLPill-text {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: inline-block;\n  vertical-align: middle;\n  font-weight: bold;\n  margin-right: 5px;\n  width: 100%; }\n\n.CTCLPill-inlineText {\n  font-weight: 600;\n  text-align: right;\n  width: 32px; }\n\n.CTCLPill--default {\n  background-color: #303233;\n  font-weight: 600;\n  text-align: center;\n  width: 90px; }\n\n.CTCLPill--received {\n  background-color: #37be52; }\n\n.CTCLPill--responded {\n  width: 100%; }\n\n.CTCLPill--awaiting {\n  border: 2px solid #303233;\n  color: #303233;\n  padding: 3px 20px;\n  width: auto; }\n  @media screen and (min-width: 568px) {\n    .CTCLPill--awaiting {\n      width: 105px; } }\n  @media screen and (min-width: 960px) {\n    .CTCLPill--awaiting {\n      width: auto; } }\n\n.CTCLPill--noAction {\n  background-color: #303233;\n  color: white;\n  font-weight: 600;\n  width: 100%; }\n\n.CTCLPill--isExpired {\n  background-color: #303233;\n  border-radius: 0;\n  border-top-left-radius: 12px;\n  border-top-right-radius: 12px;\n  bottom: 0;\n  font-weight: 600;\n  left: 50%;\n  padding: 2px 20px;\n  position: absolute;\n  transform: translateX(-50%);\n  width: auto; }\n\n.CTCLPill--isUndelivered, .CTCLPill--isReceivedAfterExpiry {\n  background-color: #303233; }\n",""])},function(e,t,n){var i=n(332);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: inherit;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n/* Common Standard Breakpoints */\n:host {\n  display: flex;\n  width: 100%;\n  flex: 1 1;\n  overflow-y: auto; }\n  :host div.container {\n    border-top: var(--secondary-border, 1px solid #dddddd);\n    display: flex;\n    flex-direction: column;\n    width: 100%; }\n    @media screen and (min-width: 568px) {\n      :host div.container {\n        border-top: none; } }\n    :host div.container div.headings {\n      background: var(--secondary-color, #f2f2f2);\n      border-top: var(--secondary-border, 1px solid #dddddd);\n      border-bottom: var(--secondary-border, 1px solid #dddddd);\n      color: var(--subtle-font-color);\n      align-items: center;\n      padding: 5px 10px;\n      display: none; }\n      @media screen and (min-width: 568px) {\n        :host div.container div.headings {\n          display: block; } }\n      @media screen and (min-width: 768px) {\n        :host div.container div.headings {\n          padding-left: 25px; } }\n      @media screen and (min-width: 1280px) {\n        :host div.container div.headings {\n          padding-left: 15px; } }\n      @media screen and (min-width: 1280px) {\n        :host div.container div.headings {\n          border-top: none; } }\n      :host div.container div.headings div.user, :host div.container div.headings div.sentHeadingContainer, :host div.container div.headings div.received, :host div.container div.headings div.response {\n        box-sizing: border-box;\n        display: inline-block; }\n      @media screen and (min-width: 568px) {\n        :host div.container div.headings div.sentHeadingContainer {\n          margin-left: 1%;\n          width: 16.333%; } }\n      @media screen and (min-width: 568px) {\n        :host div.container div.headings div.received, :host div.container div.headings div.response {\n          margin-left: 1%;\n          width: 20.333%; } }\n      @media screen and (min-width: 568px) {\n        :host div.container div.headings div.user {\n          width: 38%; } }\n      :host div.container div.headings div span {\n        text-transform: uppercase; }\n    :host div.container div.user-list {\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n      overflow-y: auto; }\n      :host div.container div.user-list div.user-row {\n        align-items: center; }\n        @media only screen and (max-width: 640px) {\n          :host div.container div.user-list div.user-row {\n            font-size: 0.8em; } }\n        @media screen and (min-width: 568px) {\n          :host div.container div.user-list div.user-row {\n            padding: 5px 10px;\n            border-bottom: 1px solid var(--default-border-color, #dddddd); } }\n        @media screen and (min-width: 768px) {\n          :host div.container div.user-list div.user-row {\n            padding-left: 25px; } }\n        @media screen and (min-width: 1280px) {\n          :host div.container div.user-list div.user-row {\n            padding-left: 15px; } }\n        :host div.container div.user-list div.user-row div.user {\n          box-sizing: border-box;\n          color: var(--default-font-color, #212121);\n          display: block;\n          padding: 10px;\n          border-bottom: var(--secondary-border, 1px solid #dddddd); }\n          @media screen and (min-width: 568px) {\n            :host div.container div.user-list div.user-row div.user {\n              display: inline-block;\n              vertical-align: middle;\n              padding: 0;\n              border-bottom: none;\n              width: 38%; } }\n          :host div.container div.user-list div.user-row div.user .particpant-mob-view {\n            display: inline-block;\n            vertical-align: middle;\n            color: var(--default-bg-color-light-font, --default-font-color);\n            font-size: 12px;\n            margin-right: 10px;\n            padding-left: 10px;\n            width: 30%; }\n            @media screen and (min-width: 568px) {\n              :host div.container div.user-list div.user-row div.user .particpant-mob-view {\n                display: none; } }\n          :host div.container div.user-list div.user-row div.user .user-row-avatar {\n            display: inline-block;\n            vertical-align: middle;\n            margin-right: 10px; }\n            @media screen and (min-width: 768px) {\n              :host div.container div.user-list div.user-row div.user .user-row-avatar {\n                display: inline-block; } }\n          :host div.container div.user-list div.user-row div.user span.participantName {\n            display: inline-block;\n            vertical-align: middle;\n            white-space: nowrap;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            box-sizing: border-box;\n            font-size: 1.5rem; }\n            @media screen and (min-width: 568px) {\n              :host div.container div.user-list div.user-row div.user span.participantName {\n                display: inline-block;\n                width: calc(100% - 50px); } }\n        :host div.container div.user-list div.user-row div.sent-time-container {\n          display: block; }\n          @media screen and (min-width: 568px) {\n            :host div.container div.user-list div.user-row div.sent-time-container {\n              display: inline-block;\n              vertical-align: middle;\n              width: 16.333%; } }\n        :host div.container div.user-list div.user-row div.received,\n        :host div.container div.user-list div.user-row div.response {\n          display: block; }\n          @media screen and (min-width: 568px) {\n            :host div.container div.user-list div.user-row div.received,\n            :host div.container div.user-list div.user-row div.response {\n              display: inline-block;\n              vertical-align: middle;\n              width: 20.333%; } }\n        :host div.container div.user-list div.user-row div.sent-time-container,\n        :host div.container div.user-list div.user-row div.received,\n        :host div.container div.user-list div.user-row div.response {\n          padding: 10px 0;\n          border-bottom: var(--secondary-border, 1px solid #dddddd); }\n          @media screen and (min-width: 568px) {\n            :host div.container div.user-list div.user-row div.sent-time-container,\n            :host div.container div.user-list div.user-row div.received,\n            :host div.container div.user-list div.user-row div.response {\n              margin-left: 1%;\n              border-bottom: none; } }\n          :host div.container div.user-list div.user-row div.sent-time-container .sent-time-mob-view,\n          :host div.container div.user-list div.user-row div.received .sent-time-mob-view,\n          :host div.container div.user-list div.user-row div.response .sent-time-mob-view {\n            display: inline-block;\n            vertical-align: middle;\n            color: var(--default-bg-color-light-font, --default-font-color);\n            font-size: 12px;\n            margin-right: 10px;\n            padding-left: 10px;\n            width: 30%; }\n            @media screen and (min-width: 568px) {\n              :host div.container div.user-list div.user-row div.sent-time-container .sent-time-mob-view,\n              :host div.container div.user-list div.user-row div.received .sent-time-mob-view,\n              :host div.container div.user-list div.user-row div.response .sent-time-mob-view {\n                display: none; } }\n          :host div.container div.user-list div.user-row div.sent-time-container .sent-time-text-container,\n          :host div.container div.user-list div.user-row div.received .sent-time-text-container,\n          :host div.container div.user-list div.user-row div.response .sent-time-text-container {\n            display: inline-block;\n            vertical-align: middle; }\n            @media screen and (min-width: 568px) {\n              :host div.container div.user-list div.user-row div.sent-time-container .sent-time-text-container,\n              :host div.container div.user-list div.user-row div.received .sent-time-text-container,\n              :host div.container div.user-list div.user-row div.response .sent-time-text-container {\n                width: 100%; } }\n            :host div.container div.user-list div.user-row div.sent-time-container .sent-time-text-container .sent-time,\n            :host div.container div.user-list div.user-row div.received .sent-time-text-container .sent-time,\n            :host div.container div.user-list div.user-row div.response .sent-time-text-container .sent-time {\n              font-weight: 600;\n              font-size: 14px;\n              display: inline-block;\n              padding-left: 18px; }\n              @media screen and (min-width: 568px) {\n                :host div.container div.user-list div.user-row div.sent-time-container .sent-time-text-container .sent-time,\n                :host div.container div.user-list div.user-row div.received .sent-time-text-container .sent-time,\n                :host div.container div.user-list div.user-row div.response .sent-time-text-container .sent-time {\n                  padding: 0; } }\n          :host div.container div.user-list div.user-row div.sent-time-container .received-mob-view,\n          :host div.container div.user-list div.user-row div.received .received-mob-view,\n          :host div.container div.user-list div.user-row div.response .received-mob-view {\n            display: inline-block;\n            vertical-align: middle;\n            color: var(--default-bg-color-light-font, --default-font-color);\n            font-size: 12px;\n            margin-right: 10px;\n            padding-left: 10px;\n            width: 30%; }\n            @media screen and (min-width: 568px) {\n              :host div.container div.user-list div.user-row div.sent-time-container .received-mob-view,\n              :host div.container div.user-list div.user-row div.received .received-mob-view,\n              :host div.container div.user-list div.user-row div.response .received-mob-view {\n                display: none; } }\n          :host div.container div.user-list div.user-row div.sent-time-container .received-pill,\n          :host div.container div.user-list div.user-row div.received .received-pill,\n          :host div.container div.user-list div.user-row div.response .received-pill {\n            display: inline-block;\n            vertical-align: middle; }\n            @media screen and (min-width: 568px) {\n              :host div.container div.user-list div.user-row div.sent-time-container .received-pill,\n              :host div.container div.user-list div.user-row div.received .received-pill,\n              :host div.container div.user-list div.user-row div.response .received-pill {\n                text-align: center; } }\n          :host div.container div.user-list div.user-row div.sent-time-container .response-mob-view,\n          :host div.container div.user-list div.user-row div.received .response-mob-view,\n          :host div.container div.user-list div.user-row div.response .response-mob-view {\n            display: inline-block;\n            vertical-align: middle;\n            color: var(--default-bg-color-light-font, --default-font-color);\n            font-size: 12px;\n            margin-right: 10px;\n            padding-left: 10px;\n            width: 30%; }\n            @media screen and (min-width: 568px) {\n              :host div.container div.user-list div.user-row div.sent-time-container .response-mob-view,\n              :host div.container div.user-list div.user-row div.received .response-mob-view,\n              :host div.container div.user-list div.user-row div.response .response-mob-view {\n                display: none; } }\n          :host div.container div.user-list div.user-row div.sent-time-container .response-pill,\n          :host div.container div.user-list div.user-row div.received .response-pill,\n          :host div.container div.user-list div.user-row div.response .response-pill {\n            display: inline-block;\n            vertical-align: middle; }\n",""])},function(e,t,n){"use strict";
/*!
    * Clamp.js 0.5.1
    *
    * Copyright 2011-2013, Joseph Schmitt http://joe.sh
    * Released under the WTFPL license
    * http://sam.zoy.org/wtfpl/
*/
function i(e,t){t=t||{};var n,i=window,o={clamp:t.clamp||1e6,useNativeClamp:void 0===t.useNativeClamp||t.useNativeClamp,splitOnChars:t.splitOnChars||[".","-","",""," "],animate:t.animate||!1,truncationChar:t.truncationChar||"",truncationHTML:t.truncationHTML},s=e.style,r=e.innerHTML,a=void 0!==e.style.webkitLineClamp,l=o.clamp,c=l.indexOf&&(l.indexOf("px")>-1||l.indexOf("em")>-1);function d(e,t){return i.getComputedStyle||(i.getComputedStyle=function(e,t){return this.el=e,this.getPropertyValue=function(t){var n=/(\-([a-z]){1})/g;return"float"==t&&(t="styleFloat"),n.test(t)&&(t=t.replace(n,function(){return arguments[2].toUpperCase()})),e.currentStyle&&e.currentStyle[t]?e.currentStyle[t]:null},this}),i.getComputedStyle(e,null).getPropertyValue(t)}function h(t){var n=t||e.clientHeight,i=u(e);return Math.max(Math.floor(n/i),0)}function u(e){var t=d(e,"line-height");return"normal"==t&&(t=1.2*parseInt(d(e,"font-size"))),parseInt(t)}o.truncationHTML&&((n=document.createElement("span")).innerHTML=o.truncationHTML);var p,g,m,f=o.splitOnChars.slice(0),_=f[0];function v(t){return t.lastChild.children&&t.lastChild.children.length>0?v(Array.prototype.slice.call(t.children).pop()):t.lastChild&&t.lastChild.nodeValue&&""!=t.lastChild.nodeValue&&t.lastChild.nodeValue!=o.truncationChar?t.lastChild:(t.lastChild.parentNode.removeChild(t.lastChild),v(e))}function y(e,t){e.nodeValue=t+o.truncationChar}if("auto"==l?l=h():c&&(l=h(parseInt(l))),a&&o.useNativeClamp)s.overflow="hidden",s.textOverflow="ellipsis",s.webkitBoxOrient="vertical",s.display="-webkit-box",s.webkitLineClamp=l,c&&(s.height=o.clamp+"px");else{var C=function(t){return u(e)*t}(l);C<=e.clientHeight&&(m=function t(i,s){if(s){var r=i.nodeValue.replace(o.truncationChar,"");if(p||(_=f.length>0?f.shift():"",p=r.split(_)),p.length>1?(g=p.pop(),y(i,p.join(_))):p=null,n&&(i.nodeValue=i.nodeValue.replace(o.truncationChar,""),e.innerHTML=i.nodeValue+" "+n.innerHTML+o.truncationChar),p){if(e.clientHeight<=s){if(!(f.length>=0&&""!=_))return e.innerHTML;y(i,p.join(_)+_+g),p=null}}else""==_&&(y(i,""),i=v(e),f=o.splitOnChars.slice(0),_=f[0],p=null,g=null);if(!o.animate)return t(i,s);setTimeout(function(){t(i,s)},!0===o.animate?10:o.animate)}}(v(e),C))}return{original:r,clamped:m}}n.r(t),n.d(t,"clamp",function(){return i})},function(e,t,n){var i=n(335);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,'/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: inherit;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n/* Common Standard Breakpoints */\n:host {\n  display: block;\n  height: 736px;\n  font-size: 1em; }\n  :host code, :host pre.code {\n    background: #FFFFFF;\n    border: solid 1px rgba(255, 255, 255, 0.5);\n    border-radius: 3px;\n    color: #D92164;\n    padding: 0 5px; }\n  :host pre.code {\n    padding: 5px; }\n  :host .chat-message-list {\n    position: relative;\n    flex: 1 1 auto;\n    display: flex;\n    flex-direction: column;\n    height: 736px;\n    overflow-x: hidden;\n    background-color: var(--chat-list-bg-color, #fff); }\n    @media screen and (min-width: 1280px) {\n      :host .chat-message-list.desktop {\n        flex-direction: row; }\n        :host .chat-message-list.desktop .description-container {\n          flex-basis: 40%;\n          flex-shrink: 0;\n          flex-direction: column;\n          background: var(--default-bg-color-light, #F1F1F1); }\n          :host .chat-message-list.desktop .description-container .image-thumbnail {\n            align-items: center;\n            width: 100%;\n            padding: 20px 20px 0;\n            flex: 0 1;\n            height: 30%; }\n          :host .chat-message-list.desktop .description-container #description-text {\n            overflow: initial !important; }\n          :host .chat-message-list.desktop .description-container .expander {\n            display: none; }\n          :host .chat-message-list.desktop .description-container .priority-description {\n            word-break: break-word; } }\n    :host .chat-message-list ctcl-response-view {\n      flex-basis: 50%;\n      flex: 1; }\n    :host .chat-message-list .response-container {\n      flex: 1; }\n    :host .chat-message-list .header span.action {\n      display: flex;\n      justify-content: center; }\n      :host .chat-message-list .header span.action ct-icon {\n        margin: 5px 8px 0; }\n    :host .chat-message-list .header span.title {\n      white-space: nowrap;\n      text-overflow: ellipsis;\n      overflow: hidden; }\n    :host .chat-message-list .header a {\n      color: inherit; }\n    :host .chat-message-list .audio-attachment {\n      padding: 20px;\n      background: var(--default-bg-color-light, #F1F1F1);\n      color: var(--default-bg-color-light-font, --default-font-color); }\n    :host .chat-message-list .priority-description {\n      display: flex;\n      flex-direction: row;\n      flex-shrink: 0;\n      background: var(--default-bg-color-light, #F1F1F1);\n      color: var(--default-bg-color-light-font, --default-font-color); }\n      :host .chat-message-list .priority-description .image-thumbnail {\n        height: 75px;\n        width: 75px;\n        flex: 0 0 auto; }\n        :host .chat-message-list .priority-description .image-thumbnail .ct-cl-attachment-handler {\n          display: block; }\n          :host .chat-message-list .priority-description .image-thumbnail .ct-cl-attachment-handler .container {\n            width: 75px; }\n      :host .chat-message-list .priority-description .description-text {\n        font-size: 1.333em;\n        padding: 15px 10px 0 10px;\n        margin-bottom: 15px; }\n        :host .chat-message-list .priority-description .description-text.collapsed {\n          overflow: hidden; }\n        :host .chat-message-list .priority-description .description-text a {\n          color: inherit; }\n        @media screen and (min-width: 768px) {\n          :host .chat-message-list .priority-description .description-text {\n            padding: 15px 10px 0 25px; } }\n      :host .chat-message-list .priority-description .description-text:not(.collapsed) {\n        height: auto;\n        max-height: 200px;\n        overflow-y: auto !important;\n        text-wrap: normal;\n        -webkit-overflow-scrolling: touch;\n        white-space: pre-line; }\n      :host .chat-message-list .priority-description .expander {\n        display: flex;\n        flex-direction: column-reverse;\n        padding: 15px; }\n        :host .chat-message-list .priority-description .expander > .hidden {\n          display: none; }\n    :host .chat-message-list .chat-history {\n      flex: 1 1 auto;\n      position: relative;\n      overflow: auto;\n      -webkit-overflow-scrolling: touch; }\n      :host .chat-message-list .chat-history .fetch-more {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        text-align: center;\n        height: 80px;\n        overflow: hidden;\n        transition: height var(--animation-normal, 0.5s) ease-out;\n        color: var(--subtle-font-color, #828688); }\n        :host .chat-message-list .chat-history .fetch-more .error {\n          display: flex;\n          align-items: center; }\n          :host .chat-message-list .chat-history .fetch-more .error .icon {\n            margin: 0 5px 0 0; }\n        :host .chat-message-list .chat-history .fetch-more.no-more {\n          height: 0; }\n      :host .chat-message-list .chat-history .entry {\n        display: flex; }\n        :host .chat-message-list .chat-history .entry.divider {\n          justify-content: center;\n          background: var(--light-header-bg, #f2f2f2);\n          color: var(--light-header-text, #828688);\n          padding: 3px 15px;\n          margin: 10px 0;\n          font-size: 13px;\n          font-weight: 600;\n          text-transform: uppercase; }\n        :host .chat-message-list .chat-history .entry.meta {\n          padding: 10px;\n          justify-content: center;\n          text-align: center; }\n          :host .chat-message-list .chat-history .entry.meta .bubble {\n            display: inline-block;\n            background: var(--light-header-bg, #f2f2f2);\n            color: var(--light-header-text, #828688);\n            font-size: 13px;\n            padding: 3px 30px;\n            margin: 0 auto;\n            border-radius: 10px; }\n            :host .chat-message-list .chat-history .entry.meta .bubble .b {\n              font-weight: 700; }\n          :host .chat-message-list .chat-history .entry.meta + .meta {\n            padding-top: 0; }\n        :host .chat-message-list .chat-history .entry.chat {\n          padding: 10px 0; }\n          :host .chat-message-list .chat-history .entry.chat .chat {\n            display: flex;\n            flex-direction: column; }\n            :host .chat-message-list .chat-history .entry.chat .chat .from {\n              font-size: 13px;\n              margin: 0 0 2px 4px; }\n              :host .chat-message-list .chat-history .entry.chat .chat .from span {\n                color: var(--light-header-text, #828688);\n                display: block; }\n            :host .chat-message-list .chat-history .entry.chat .chat .bubble {\n              position: relative;\n              display: inline-block;\n              padding: 8px;\n              font-size: 1em;\n              border-radius: 20px; }\n              :host .chat-message-list .chat-history .entry.chat .chat .bubble .content {\n                word-break: break-word;\n                white-space: pre-line;\n                word-wrap: break-word;\n                padding: 3px 5px;\n                font-size: 16px; }\n                :host .chat-message-list .chat-history .entry.chat .chat .bubble .content a {\n                  color: inherit; }\n              :host .chat-message-list .chat-history .entry.chat .chat .bubble.emojis-only .content {\n                font-size: 36px;\n                line-height: 1em; }\n              :host .chat-message-list .chat-history .entry.chat .chat .bubble:after {\n                content: "";\n                display: block;\n                position: absolute;\n                width: 0;\n                height: 0;\n                transform: rotate(-45deg); }\n            :host .chat-message-list .chat-history .entry.chat .chat .meta {\n              display: flex;\n              font-size: 13px;\n              font-weight: 600;\n              padding: 2px 5px 2px 2px;\n              color: var(--subtle-font-color, #828688); }\n              :host .chat-message-list .chat-history .entry.chat .chat .meta .chat-status {\n                margin: 0 3px 0 0; }\n          :host .chat-message-list .chat-history .entry.chat.sent {\n            justify-content: flex-end; }\n            :host .chat-message-list .chat-history .entry.chat.sent .chat {\n              margin: 0 15px 0 50px;\n              align-items: flex-end; }\n              :host .chat-message-list .chat-history .entry.chat.sent .chat .bubble {\n                background: #308fff;\n                background-image: linear-gradient(to bottom, #308fff 2%, #147efb 82%);\n                color: var(--chat-message-bubble-sent-text, #ffffff); }\n                :host .chat-message-list .chat-history .entry.chat.sent .chat .bubble:after {\n                  right: 0;\n                  margin: 1px -7px 0 0;\n                  border-top: 5px solid transparent;\n                  border-bottom: 5px solid transparent;\n                  border-left: 15px solid #147efb;\n                  transform: rotate(45deg); }\n            :host .chat-message-list .chat-history .entry.chat.sent .meta {\n              justify-content: flex-end;\n              align-items: center; }\n          :host .chat-message-list .chat-history .entry.chat.received {\n            justify-content: flex-start; }\n            :host .chat-message-list .chat-history .entry.chat.received .chat {\n              margin: 0 50px 0 15px; }\n              :host .chat-message-list .chat-history .entry.chat.received .chat .from {\n                color: var(--chat-message-bubble-received-from, #22b1c8); }\n              :host .chat-message-list .chat-history .entry.chat.received .chat .bubble {\n                background: #f1f1f1;\n                background-image: linear-gradient(to bottom, #f1f1f1 2%, #e6e6e6 100%);\n                color: var(--chat-message-bubble-received-text, #212121); }\n                :host .chat-message-list .chat-history .entry.chat.received .chat .bubble:after {\n                  left: 0;\n                  margin: 2px 0 0 -6px;\n                  border-top: 5px solid transparent;\n                  border-bottom: 5px solid transparent;\n                  border-right: 15px solid #e6e6e6; }\n      :host .chat-message-list .chat-history.stop-scroll {\n        overflow: hidden; }\n    :host .chat-message-list .chat-scroll-to-bottom {\n      position: fixed;\n      right: -100%;\n      bottom: 65px;\n      display: flex;\n      align-items: center;\n      padding: 3px;\n      background: #ffffff;\n      border: var(--secondary-border, #f2f2f2);\n      border-width: 1px 0 1px 1px;\n      border-radius: 50px 0 0 50px;\n      cursor: pointer; }\n      :host .chat-message-list .chat-scroll-to-bottom .icon {\n        width: 34px;\n        height: 34px;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        background: var(--primary-color, #22b1c8);\n        color: var(--primary-font-color, #ffffff);\n        border: 1px solid var(--primary-font-color, #ffffff);\n        border-radius: 50%; }\n      :host .chat-message-list .chat-scroll-to-bottom .number {\n        margin: 0 3px;\n        color: var(--primary-color, #22b1c8);\n        font-size: 0.833em;\n        font-weight: 600; }\n      :host .chat-message-list .chat-scroll-to-bottom.animate {\n        transition: all 0.3s ease-out; }\n      :host .chat-message-list .chat-scroll-to-bottom.visible {\n        right: 0; }\n    :host .chat-message-list .pager-ui {\n      background: var(--default-bg-color-light, #F1F1F1);\n      color: var(--default-bg-color-light-font, --default-font-color);\n      flex: 1;\n      display: flex;\n      flex-direction: column; }\n      :host .chat-message-list .pager-ui .image-thumbnail {\n        margin-top: 20px;\n        text-align: center;\n        width: 100%; }\n        :host .chat-message-list .pager-ui .image-thumbnail .ct-cl-attachment-handler {\n          display: inline-block; }\n      :host .chat-message-list .pager-ui .description-text {\n        font-size: 1.333em;\n        padding: 20px 10px 0 25px;\n        margin-bottom: auto;\n        word-break: break-word; }\n        :host .chat-message-list .pager-ui .description-text a {\n          color: inherit; }\n      :host .chat-message-list .pager-ui .meta {\n        display: flex;\n        padding: 2px 5px;\n        background: var(--light-header-bg, #ebebeb);\n        color: var(--light-header-text, #828688);\n        padding: 3px 30px;\n        margin: 0 15% 40px;\n        border-radius: 10px;\n        justify-content: center; }\n        :host .chat-message-list .pager-ui .meta span {\n          text-align: center; }\n    :host .chat-message-list .footer {\n      flex: none;\n      display: flex;\n      align-items: flex-end;\n      padding: 10px;\n      background: var(--secondary-color, #f2f2f2);\n      border-top: var(--secondary-border, 1px solid #dddddd); }\n      :host .chat-message-list .footer .action {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        flex: none;\n        width: 32px;\n        height: 32px;\n        background: var(--primary-color, #22b1c8);\n        color: var(--primary-font-color, #ffffff);\n        border-radius: 50%;\n        cursor: pointer; }\n        :host .chat-message-list .footer .action.disabled {\n          background: var(--subtle-font-color, #828688);\n          cursor: default; }\n      :host .chat-message-list .footer .textbox {\n        position: relative;\n        flex: 1 1 auto;\n        margin: 0 5px;\n        background: transparent; }\n        :host .chat-message-list .footer .textbox .media {\n          display: flex;\n          flex-direction: row;\n          justify-content: center;\n          padding: 7px 10px;\n          border-bottom: var(--secondary-border, 1px solid #dddddd); }\n          :host .chat-message-list .footer .textbox .media .media-item {\n            position: relative; }\n            :host .chat-message-list .footer .textbox .media .media-item .media-image {\n              max-height: 75px;\n              display: block; }\n            :host .chat-message-list .footer .textbox .media .media-item .remove {\n              position: absolute;\n              top: 5px;\n              right: 5px;\n              color: #ffffff;\n              background: #212121;\n              border-radius: 50%;\n              cursor: pointer; }\n        :host .chat-message-list .footer .textbox .error {\n          position: absolute;\n          bottom: 8px;\n          right: 5px;\n          color: var(--conversation-has-error-color, #d93247); }\n        :host .chat-message-list .footer .textbox.disabled {\n          background: var(--secondary-color, #f2f2f2); }\n',""])},function(e,t,n){var i=n(337);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,'/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: inherit;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: flex;\n  flex-direction: column;\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  background: #ffffff;\n  font-size: 1em;\n  transform: translateY(101%);\n  will-change: transform;\n  z-index: 99998; }\n  :host .contact-info {\n    flex: 1 1 auto;\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    background-color: var(--list-bg);\n    color: var(--default-font-color);\n    overflow: auto; }\n    :host .contact-info .header .action {\n      cursor: pointer; }\n    :host .contact-info .user-info {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      flex: none;\n      padding: 10px 40px 20px 40px; }\n      :host .contact-info .user-info .avatar {\n        margin: 0 0 10px 0; }\n      :host .contact-info .user-info .name {\n        font-size: 1.333em; }\n      :host .contact-info .user-info .job-title {\n        font-size: 1.333em;\n        font-weight: 300;\n        color: var(--subtle-font-color, #828688); }\n      :host .contact-info .user-info .group {\n        font-size: 1.333em;\n        font-weight: 300;\n        font-style: italic;\n        color: var(--subtle-font-color, #828688); }\n      :host .contact-info .user-info .telephone {\n        font-size: 1.333em;\n        color: var(--primary-color, #22b1c8);\n        text-decoration: none; }\n      :host .contact-info .user-info .actions {\n        margin: 20px 0 0 0; }\n    :host .contact-info .conversation-context {\n      display: flex;\n      flex-direction: column;\n      flex: 1 1 auto; }\n      :host .contact-info .conversation-context .roles {\n        flex: 1 1 auto; }\n        :host .contact-info .conversation-context .roles .row {\n          display: flex;\n          align-items: center;\n          border-bottom: var(--secondary-border, 1px solid #dddddd); }\n          :host .contact-info .conversation-context .roles .row .r {\n            margin: 0 0 0 auto;\n            text-align: right; }\n          :host .contact-info .conversation-context .roles .row.header {\n            flex: none;\n            background: var(--light-header-bg, #f2f2f2);\n            color: var(--light-header-text, #828688);\n            font-size: 0.833em;\n            font-weight: 600;\n            text-transform: uppercase;\n            padding: 7px 20px; }\n          :host .contact-info .conversation-context .roles .row.role {\n            padding: 10px 20px;\n            cursor: pointer; }\n            :host .contact-info .conversation-context .roles .row.role .l {\n              position: relative;\n              padding: 0 0 0 30px; }\n              :host .contact-info .conversation-context .roles .row.role .l .radio {\n                position: absolute;\n                display: flex;\n                justify-content: center;\n                align-items: center;\n                left: 0;\n                top: 50%;\n                transform: translateY(-50%);\n                width: 18px;\n                height: 18px;\n                border: 2px solid var(--default-font-color, #212121);\n                border-radius: 50%; }\n            :host .contact-info .conversation-context .roles .row.role .r {\n              font-size: 0.833em;\n              color: var(--subtle-font-color, #828688); }\n          :host .contact-info .conversation-context .roles .row.disabled {\n            opacity: 0.5;\n            cursor: not-allowed; }\n          :host .contact-info .conversation-context .roles .row.selected .l .radio:before {\n            content: "";\n            display: block;\n            width: 6px;\n            height: 6px;\n            background-color: var(--default-font-color, #212121);\n            border-radius: 50%; }\n      :host .contact-info .conversation-context .footer {\n        flex: none;\n        padding: 10px;\n        text-align: center; }\n\n:host([animate-modal]) {\n  transition: transform var(--animation-normal, 0.5s) ease-out; }\n\n:host([showing]) {\n  transform: translateY(0); }\n',""])},function(e,t,n){var i=n(339);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n:host {\n  display: block;\n  height: 100%;\n  font-size: 1em; }\n  :host .conversation-info {\n    flex: 1 1 auto;\n    display: flex;\n    flex-direction: column;\n    height: 100%; }\n    :host .conversation-info .header .action {\n      cursor: pointer; }\n    :host .conversation-info .role {\n      flex: none;\n      background: var(--dark-header-bg, #212121);\n      color: var(--dark-header-text, #f2f2f2);\n      padding: 7px 20px;\n      z-index: 9999; }\n    :host .conversation-info .scrollable {\n      flex: 1 1 auto;\n      display: flex;\n      flex-direction: column;\n      overflow: auto; }\n      :host .conversation-info .scrollable .named-info {\n        flex: none; }\n        :host .conversation-info .scrollable .named-info .subject,\n        :host .conversation-info .scrollable .named-info .description {\n          padding: 10px 20px;\n          color: var(--subtle-font-color, #828688);\n          background-color: #ffffff;\n          word-break: break-word; }\n          :host .conversation-info .scrollable .named-info .subject.form-item,\n          :host .conversation-info .scrollable .named-info .description.form-item {\n            padding: 10px 10px 5px 10px; }\n        :host .conversation-info .scrollable .named-info .description,\n        :host .conversation-info .scrollable .named-info .buttons {\n          border-top: 1px solid var(--light-header-bg, #f2f2f2); }\n        :host .conversation-info .scrollable .named-info .buttons {\n          display: flex;\n          justify-content: center;\n          padding: 10px; }\n          :host .conversation-info .scrollable .named-info .buttons .button + .button {\n            margin: 0 0 0 10px; }\n        :host .conversation-info .scrollable .named-info a {\n          color: inherit; }\n      :host .conversation-info .scrollable .participants {\n        flex: 1 1 auto; }\n        :host .conversation-info .scrollable .participants .heading {\n          flex: none;\n          background: var(--light-header-bg, #f2f2f2);\n          color: var(--light-header-text, #828688);\n          font-size: 0.833em;\n          font-weight: 600;\n          text-transform: uppercase;\n          padding: 7px 20px; }\n        :host .conversation-info .scrollable .participants ct-icon {\n          margin-top: 20px; }\n        :host .conversation-info .scrollable .participants .participant-list {\n          flex: 1 1 auto; }\n          :host .conversation-info .scrollable .participants .participant-list .participant {\n            position: relative;\n            cursor: pointer; }\n            :host .conversation-info .scrollable .participants .participant-list .participant .badges {\n              position: absolute;\n              top: 50%;\n              right: 10px;\n              transform: translateY(-50%); }\n              :host .conversation-info .scrollable .participants .participant-list .participant .badges .badge {\n                display: inline-block;\n                font-size: 0.75em;\n                font-weight: 300;\n                text-transform: uppercase;\n                padding: 3px 10px;\n                border-radius: 4px;\n                margin: 0 0 0 5px;\n                line-height: 1em; }\n                :host .conversation-info .scrollable .participants .participant-list .participant .badges .badge.admin {\n                  background: #303233;\n                  color: #ffffff; }\n                :host .conversation-info .scrollable .participants .participant-list .participant .badges .badge.owner {\n                  background: var(--primary-color, #22b1c8);\n                  color: var(--primary-font-color, #ffffff); }\n      :host .conversation-info .scrollable .footer {\n        flex: none;\n        padding: 10px;\n        text-align: center; }\n",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{showActionSheet(e){document.querySelector(e).shadowRoot.querySelector("ct-cl-dynamic-action-sheet").layer.emit("show-dynamic-action-sheet")}}t.ActionSheetHelper=i,t.actionSheetHelper=new i},function(e,t,n){var i=n(342);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n:host {\n  display: block; }\n  :host div.container {\n    display: flex;\n    padding: 10px;\n    flex-direction: column; }\n    :host div.container h4 {\n      margin-top: 0;\n      font-weight: normal;\n      text-transform: uppercase;\n      font-size: 0.8em;\n      color: var(--tertiary-placeholder-color, #212121); }\n    :host div.container div.controls {\n      display: flex; }\n      :host div.container div.controls div.action {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        flex: none;\n        width: 36px;\n        height: 36px;\n        background: var(--primary-color, #22b1c8);\n        color: var(--primary-font-color, #ffffff);\n        border-radius: 50%;\n        cursor: pointer;\n        margin-right: 10px;\n        transition: 0.5s all ease-in; }\n        :host div.container div.controls div.action.disabled {\n          background: var(--subtle-font-color, #828688);\n          cursor: default; }\n      :host div.container div.controls div.placeholder {\n        display: flex;\n        flex: 1; }\n        :host div.container div.controls div.placeholder ctcl-audio-player {\n          flex: 0; }\n        :host div.container div.controls div.placeholder div.action {\n          margin-left: auto; }\n        :host div.container div.controls div.placeholder p {\n          margin: auto 0;\n          align-items: center;\n          color: var(--subtle-font-color, #828688); }\n",""])},function(e,t,n){var i=n(344);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n:host {\n  display: flex;\n  flex-direction: column;\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  background: #ffffff;\n  font-size: 1em;\n  transform: translateY(101%);\n  will-change: transform;\n  z-index: 99998; }\n  :host .chat-conversation-alert {\n    flex-direction: column;\n    height: 100%;\n    display: flex;\n    background-color: var(--list-bg);\n    color: var(--default-font-color); }\n    :host .chat-conversation-alert .header .action {\n      cursor: pointer; }\n    :host .chat-conversation-alert .header .pending-count {\n      border-radius: 50%;\n      width: 33px;\n      height: 25px;\n      padding-top: 8px;\n      text-align: center;\n      filter: brightness(85%); }\n    :host .chat-conversation-alert .header a {\n      color: inherit; }\n    :host .chat-conversation-alert .header-priority-details {\n      display: flex;\n      flex: 0 0 auto;\n      flex-direction: column;\n      background: var(--header-bg, #22b1c8);\n      color: var(--header-text, #fff);\n      z-index: 9999;\n      padding: 0 20px; }\n      :host .chat-conversation-alert .header-priority-details div.from {\n        display: flex;\n        flex: 0;\n        justify-content: space-between; }\n        :host .chat-conversation-alert .header-priority-details div.from p.name {\n          flex: 0 0 65%;\n          overflow: hidden;\n          text-overflow: ellipsis; }\n        :host .chat-conversation-alert .header-priority-details div.from p.time {\n          flex: 0 0 30%; }\n      :host .chat-conversation-alert .header-priority-details div.to {\n        flex: 0; }\n        :host .chat-conversation-alert .header-priority-details div.to p {\n          margin: 0 0 10px; }\n      :host .chat-conversation-alert .header-priority-details > div p {\n        margin: 10px 0;\n        font-size: 18px; }\n        :host .chat-conversation-alert .header-priority-details > div p span {\n          font-size: 14px;\n          font-weight: 300;\n          text-transform: uppercase; }\n      :host .chat-conversation-alert .header-priority-details > div > div {\n        color: var(--header-text, #ffffff); }\n      :host .chat-conversation-alert .header-priority-details > :not(:last-child) {\n        flex: 0 0 125px; }\n      :host .chat-conversation-alert .header-priority-details > :last-child {\n        flex: 1 1 auto; }\n      :host .chat-conversation-alert .header-priority-details label {\n        font-size: 1em; }\n      :host .chat-conversation-alert .header-priority-details .header-priority-detail-value {\n        font-size: 1.333em; }\n    :host .chat-conversation-alert .chat-description {\n      font-size: 1.333em;\n      display: flex;\n      flex-direction: column;\n      flex: 1;\n      padding: 20px 25px;\n      overflow-y: auto;\n      white-space: pre-line;\n      max-height: 270px; }\n      :host .chat-conversation-alert .chat-description code, :host .chat-conversation-alert .chat-description pre.code {\n        background: #FFFFFF;\n        border: solid 1px rgba(255, 255, 255, 0.5);\n        border-radius: 3px;\n        color: #D92164;\n        padding: 0 5px; }\n      :host .chat-conversation-alert .chat-description pre.code {\n        padding: 5px; }\n      :host .chat-conversation-alert .chat-description a {\n        color: inherit; }\n    :host .chat-conversation-alert .attachment {\n      display: flex;\n      padding: 20px 25px 0;\n      flex: 0 1 auto;\n      flex-direction: column;\n      min-height: 250px;\n      max-height: 250px;\n      overflow: hidden; }\n      :host .chat-conversation-alert .attachment div.image {\n        display: flex;\n        flex: 1;\n        justify-content: center;\n        align-self: center;\n        padding: 20px; }\n        :host .chat-conversation-alert .attachment div.image img {\n          height: 100%; }\n      :host .chat-conversation-alert .attachment div.audio {\n        display: flex;\n        flex: 1; }\n        :host .chat-conversation-alert .attachment div.audio ctcl-attachment-handler {\n          height: initial;\n          margin-bottom: auto; }\n    :host .chat-conversation-alert .footer {\n      flex: 0 0 auto;\n      color: #ffffff;\n      font-size: 1em;\n      background: var(--secondary-color, #f2f2f2);\n      border-top: var(--secondary-border, 1px solid #dddddd);\n      padding: 10px 20px;\n      flex-direction: row;\n      display: flex;\n      margin-top: auto; }\n      :host .chat-conversation-alert .footer .yes {\n        flex: 1 1;\n        margin: 0 5px; }\n      :host .chat-conversation-alert .footer .mute {\n        margin-left: 10px;\n        font-weight: 300; }\n\n:host([animate-alert]) {\n  transition: transform var(--animation-normal, 0.5s) ease-out; }\n\n:host([showing]) {\n  transform: translateY(0); }\n",""])},function(e,t,n){var i=n(346);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n:host {\n  display: block; }\n  :host div.container {\n    display: flex;\n    padding: 10px;\n    flex-direction: column; }\n    :host div.container h4 {\n      margin-top: 0;\n      font-weight: normal;\n      text-transform: uppercase;\n      font-size: 0.8em;\n      color: var(--tertiary-placeholder-color, #212121); }\n    :host div.container div.controls {\n      display: flex; }\n      :host div.container div.controls div.action {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        flex: none;\n        width: 36px;\n        height: 36px;\n        background: var(--primary-color, #22b1c8);\n        color: var(--primary-font-color, #ffffff);\n        border-radius: 50%;\n        cursor: pointer;\n        margin-right: 10px;\n        transition: 0.5s all ease-in; }\n        :host div.container div.controls div.action.disabled {\n          background: var(--subtle-font-color, #828688);\n          cursor: default; }\n      :host div.container div.controls div.placeholder {\n        display: flex;\n        flex: 1; }\n        :host div.container div.controls div.placeholder div.action {\n          margin-left: auto; }\n        :host div.container div.controls div.placeholder p {\n          margin: auto 0;\n          align-items: center;\n          color: var(--subtle-font-color, #828688); }\n",""])},function(e,t,n){var i=n(348);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n:host {\n  display: block; }\n  :host div.container {\n    display: flex;\n    padding: 10px;\n    flex-direction: column; }\n    :host div.container h4 {\n      margin-top: 0;\n      font-weight: normal;\n      text-transform: uppercase;\n      font-size: 0.8em;\n      color: var(--tertiary-placeholder-color, #212121); }\n    :host div.container div.controls {\n      display: flex; }\n      :host div.container div.controls div.action {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        flex: none;\n        width: 36px;\n        height: 36px;\n        background: var(--primary-color, #22b1c8);\n        color: var(--primary-font-color, #ffffff);\n        border-radius: 50%;\n        cursor: pointer;\n        margin-right: 10px;\n        transition: 0.5s all ease-in; }\n        :host div.container div.controls div.action.disabled {\n          background: var(--subtle-font-color, #828688);\n          cursor: default; }\n      :host div.container div.controls div.placeholder {\n        display: flex;\n        flex: 1; }\n        :host div.container div.controls div.placeholder ctcl-audio-player {\n          flex: 0; }\n        :host div.container div.controls div.placeholder div.action {\n          margin-left: auto; }\n        :host div.container div.controls div.placeholder p {\n          margin: auto 0;\n          align-items: center;\n          color: var(--subtle-font-color, #828688); }\n",""])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(350))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(351);t.generateDefaultNewPage=function(){return{replyTemplate:i.defaultReplyTemplate,imgSrc:"",audioSrc:"",enableChat:!0}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});var i=n(352);t.ChatLayerConfig=i.ChatLayerConfig;var o=n(353);t.ChatXmppConfig=o.ChatXmppConfig;var s=n(354);t.ChatBehaviourConfig=s.ChatBehaviourConfig;var r=n(355);t.ChatExternalFunctionsConfig=r.ChatExternalFunctionsConfig,function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(356))},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultReplyTemplate={id:"_default",name:"Acknowledge",options:[{name:"Acknowledge",type:"button",label:"Acknowledge",value:"Acknowledge"}]}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(15),a=n(11),l=n(8);let c=class extends s.CTLayerComponent{constructor(){super(...arguments),this._toggle=(()=>{this.value=!this.value,this.callback&&this.callback(this.value)})}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){}generateComponentMarkup(){return window.__CTRender("div",{class:"container",onClick:this._toggle},window.__CTRender("p",null,this.label),this.value?window.__CTRender(l.CTIcon,{width:"16",height:"16",icon:a.Icons.UI.CheckboxChecked}):window.__CTRender(l.CTIcon,{width:"16",height:"16",icon:a.Icons.UI.CheckboxUnchecked}))}};i([s.prop({type:Function,attribute:!1})],c.prototype,"callback",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],c.prototype,"value",void 0),i([s.prop({type:String,attribute:!1,default:null})],c.prototype,"label",void 0),c=i([r.component({tag:"ct-single-checkbox",styles:[n(358)]})],c),t.CTSingleCheckbox=c},function(e,t,n){var i=n(359);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: block; }\n  :host div.container {\n    display: flex;\n    margin: 5px 0;\n    padding: 0 5px;\n    justify-content: space-between;\n    cursor: pointer;\n    color: var(--primary-color, #15233b); }\n    :host div.container p {\n      color: var(--default-font-color, #212121); }\n",""])},function(e,t,n){var i=n(361);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n:host {\n  display: block;\n  height: 100%;\n  font-size: 1em; }\n  :host hr {\n    display: block;\n    height: 1px;\n    border: 0;\n    border-top: 1px solid var(--default-border-color, #dddddd);\n    margin: 10px 5px;\n    padding: 0; }\n  :host .new-conversation {\n    flex: 1 1 auto;\n    display: flex;\n    flex-direction: column;\n    height: 100%; }\n    :host .new-conversation .header .action {\n      cursor: pointer; }\n    :host .new-conversation .contact-list {\n      flex: 1 1 auto;\n      display: flex;\n      flex-direction: column;\n      overflow: auto; }\n      :host .new-conversation .contact-list #user-list {\n        display: flex;\n        flex-direction: column;\n        flex: 1; }\n      :host .new-conversation .contact-list.hidden {\n        display: none; }\n    :host .new-conversation .named-conversation-details {\n      flex: 1 1 auto;\n      display: flex;\n      flex-direction: column;\n      overflow: auto;\n      background: var(--secondary-color, #f2f2f2);\n      padding: 10px; }\n      :host .new-conversation .named-conversation-details.hidden {\n        display: none; }\n      :host .new-conversation .named-conversation-details .priority-type-description {\n        text-align: center;\n        padding: 15px 30px 0 30px; }\n    :host .new-conversation .footer {\n      flex: 0 0 auto;\n      background: var(--secondary-color, #f2f2f2);\n      border-top: var(--secondary-border, 1px solid #dddddd);\n      display: flex;\n      padding: 10px 20px; }\n      :host .new-conversation .footer .button {\n        flex: 1 1;\n        margin: 0 5px;\n        font-size: 1.4em; }\n",""])},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(15),a=n(0),l=n(12),c=n(18),d=n(8),h=n(22),u=n(13),p=n(5);var g;!function(e){e[e.NO_USERS="There are no users for this role."]="NO_USERS",e[e.USERS="Users"]="USERS"}(g||(g={}));let m=class extends l.CTCLComponent{constructor(){super(...arguments),this._chatGroup=null,this._animationDuration=500,this._goChatFunction=null,this.TILE_HEIGHT=70}initialize(){return o(this,void 0,void 0,function*(){this._virtualList=new h.VirtualList(this,[],{itemHeight:this.TILE_HEIGHT,itemKeyGetter:e=>e.jid}),this._virtualList.setItems([])})}setupListeners(){this.setupConnectionStatusListener()}generateComponentMarkup(){return window.__CTRender("div",{class:"contact-info"},this._renderHeader(),window.__CTRender("div",{class:"user-list-items"},this._renderUsers()))}_renderHeader(){return window.__CTRender(c.CTCLHeader,{class:"header"},window.__CTRender("div",{slot:"left-action"},window.__CTRender(d.CTIcon,{class:"action",width:"20",height:"20",icon:a.Icons.COMMON.ChevronLeft,onClick:this._back.bind(this)})),window.__CTRender("div",{slot:"heading"},`${this._chatGroup?this._chatGroup.name:""} ${this.translateI18nItem(g.USERS)}`),window.__CTRender("div",{slot:"sub-heading"}))}_renderUsers(){return 0===this.usersToDisplay.length?window.__CTRender("div",{class:"no-users"},this.translateI18nItem(g.NO_USERS)):this._virtualList.render(this._renderItem.bind(this),"users","users-content")}_renderItem(e,t){const n=u.buildStyles({paddingRight:"36px"});return window.__CTRender("div",Object.assign({class:["user"].join(" ")},t),window.__CTRender(d.CTUserTile,{user:e,nameFormat:this.nameFormat,height:`${this.TILE_HEIGHT}px`,detailStyle:n}))}_back(){this.dismiss()}show(e,t=!0){return o(this,void 0,void 0,function*(){this._chatGroup=e,this.usersToDisplay=this._chatGroup.users,this._virtualList.setItems(this.usersToDisplay),this.animateModal=t,this.showing=!0,this.layer.setBackHandler(()=>{this._back()}),yield p.sleep(t?this._animationDuration:0)})}dismiss(e=!0){return o(this,void 0,void 0,function*(){this.animateModal=e,this.showing=!1,this.layer.popBackHandler(),yield p.sleep(e?this._animationDuration:0),this._chatGroup=null,this.usersToDisplay=[],this._virtualList.setItems([])})}};i([s.prop({type:Object,attribute:!1,default:p.NameFormat.PREFIX_FIRST_LAST})],m.prototype,"nameFormat",void 0),i([s.prop({type:Boolean,attribute:!0,default:!0})],m.prototype,"animateModal",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],m.prototype,"showing",void 0),i([s.prop({type:Array,attribute:!1,default:[]})],m.prototype,"usersToDisplay",void 0),m=i([r.component({tag:"ct-cl-role-users-modal",styles:[n(363)],i18nKeys:g})],m),t.CTCLRoleUsersModal=m},function(e,t,n){var i=n(364);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n:host {\n  display: flex;\n  flex-direction: column;\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  background: #ffffff;\n  font-size: 1em;\n  transform: translateY(101%);\n  will-change: transform;\n  z-index: 99998; }\n  :host .contact-info {\n    flex: 1 1 auto;\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    background-color: var(--list-bg);\n    color: var(--default-font-color); }\n    :host .contact-info .header .action {\n      cursor: pointer; }\n    :host .contact-info .user-list-items {\n      position: relative;\n      display: flex;\n      flex-direction: column;\n      flex: 1 1 auto;\n      height: 100%;\n      overflow: hidden; }\n      :host .contact-info .user-list-items .users-loading-bg {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        display: flex;\n        background: var(--list-bg, #f2f2f2);\n        z-index: -1; }\n      :host .contact-info .user-list-items .users {\n        flex: 1 1 auto;\n        overflow: auto;\n        -webkit-overflow-scrolling: touch; }\n        :host .contact-info .user-list-items .users .user {\n          position: relative; }\n          :host .contact-info .user-list-items .users .user .selection {\n            position: absolute;\n            top: 0;\n            right: 0;\n            height: 100%;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            padding: 0 20px;\n            cursor: pointer; }\n            :host .contact-info .user-list-items .users .user .selection .checkbox {\n              display: flex;\n              justify-content: center;\n              align-items: center;\n              width: 16px;\n              height: 16px;\n              color: var(--subtle-font-color, #828688);\n              border: 2px solid var(--subtle-font-color, #828688); }\n          :host .contact-info .user-list-items .users .user.selected .selection .checkbox {\n            border: 0; }\n          :host .contact-info .user-list-items .users .user.selection-disabled .selection {\n            opacity: 0;\n            cursor: not-allowed; }\n          :host .contact-info .user-list-items .users .user.clickable {\n            cursor: pointer; }\n\n:host([animate-modal]) {\n  transition: transform var(--animation-normal, 0.5s) ease-out; }\n\n:host([showing]) {\n  transform: translateY(0); }\n",""])},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(15),a=n(0),l=n(12),c=n(6),d=n(34),h=n(11),u=n(28),p=n(20),g=n(22),m=n(13),f=n(5),_=n(23),v=n(27),y=n(26);var C;!function(e){e[e.ABOUT="About"]="ABOUT",e[e.ACCOUNT_LABEL="Account"]="ACCOUNT_LABEL",e[e.ADD="Add"]="ADD",e[e.ACQUIRE="Acquire"]="ACQUIRE",e[e.ACQUIRE_DESCRIPTION="Aquire a delegation from the pool"]="ACQUIRE_DESCRIPTION",e[e.AVAILABLE="Available Delegate Accounts"]="AVAILABLE",e[e.DELEGATED="Delegated to you"]="DELEGATED",e[e.DENIED_TITLE="Denied"]="DENIED_TITLE",e[e.DENIED_MESSAGE="Your request to take the delegate account has been denied."]="DENIED_MESSAGE",e[e.GIVE="Give"]="GIVE",e[e.GIVE_DESCRIPTION="Unilaterally give a delegation to another user (forced)"]="GIVE_DESCRIPTION",e[e.LOGGED_IN_AS="Logged in as"]="LOGGED_IN_AS",e[e.LOGOUT_FAILURE="Unable to Logout"]="LOGOUT_FAILURE",e[e.LOGOUT_FAILURE_MESSAGE="You cannot sign out whilst accounts are delegated to you. Please release these accounts first."]="LOGOUT_FAILURE_MESSAGE",e[e.ROLE_ASSIGNMENT="Role Assignment"]="ROLE_ASSIGNMENT",e[e.ROLE_ADMIN="Role Admin"]="ROLE_ADMIN",e[e.GROUP_ADMIN="Group Admin"]="GROUP_ADMIN",e[e.USER_ADMIN="User Admin"]="USER_ADMIN",e[e.NO_DELEGATE_ACCOUNTS="No accounts are delegated"]="NO_DELEGATE_ACCOUNTS",e[e.NO_PREVIOUS="No previously delegated accounts"]="NO_PREVIOUS",e[e.OFFLINE_ERROR_TITLE="Connectivity Required"]="OFFLINE_ERROR_TITLE",e[e.OFFLINE_ERROR_MESSAGE="You cannot perform delegate actions with no connectivity. Please reconnect and try again."]="OFFLINE_ERROR_MESSAGE",e[e.RELEASE_MESSAGE="You are about to release this account and will no longer be responsible for it. Is this correct?"]="RELEASE_MESSAGE",e[e.RELINQUISH="Relinquish"]="RELINQUISH",e[e.RELINQUISH_DESCRIPTION="Let go to the pool without passing to anyone else"]="RELINQUISH_DESCRIPTION",e[e.SUCCESS="Successful Handover"]="SUCCESS",e[e.SWITCH_THEME="Switch Theme"]="SWITCH_THEME",e[e.TAKE="Take"]="TAKE",e[e.TAKE_DESCRIPTION="Unilaterally take a delegation from another user (forced)"]="TAKE_DESCRIPTION",e[e.WHEN_LABEL="When"]="WHEN_LABEL",e[e.WORKSPACE_ERROR_MESSAGE="There was an error moving to this delegate workspace. Please try again."]="WORKSPACE_ERROR_MESSAGE",e[e.WORKSPACE_ERROR_TITLE="Error Setting Workspace"]="WORKSPACE_ERROR_TITLE"}(C||(C={}));let w=class extends l.CTCLComponent{constructor(){super(...arguments),this._fetchAndRefresh=(()=>o(this,void 0,void 0,function*(){"open"===this.state&&(this.isFetching=!0,yield d.default.getCurrentlyDelegatedAccounts(this.layer),this.isFetching=!1,this._updateDelegateState(d.default.getDelegateState()))})),this._open=(()=>o(this,void 0,void 0,function*(){this.isFetching=!0,this.user=this.layer.getCurrentUser(),this.currentWorkspaceAccount=this.layer.store.getWorkspaceAccount()||this.user.jid,this.state="open",this.setAttribute("pointers","auto"),this.layer.setBackHandler(()=>this._close());const e=yield d.default.getCurrentlyDelegatedAccounts(this.layer);requestAnimationFrame(()=>{this.layer.comms.getConnectionStatus()===a.ConnectionStatus.Connected?(this._updateDelegateState(e),this.isFetching=!1):(this._updateDelegateState(d.default.getDelegateState()),this.isFetching=!1)})})),this._close=(()=>o(this,void 0,void 0,function*(){this.state="closed",setTimeout(()=>{this.setAttribute("pointers","none")},200),this._allDelegateAccountsList.setItems([]),this.layer.popBackHandler()})),this._openSheet=((e,t=!1)=>(this.actionsheetButtons.forEach(e=>e.exclude=!0),e.mine&&e.permissions.includes(h.DelegatePermissions.GIVE)&&(this.actionsheetButtons[0].exclude=!1),e.mine&&e.permissions.includes(h.DelegatePermissions.RELINQUISH)&&(this.actionsheetButtons[3].exclude=!1),!e.mine&&e.activeUsers&&e.activeUsers.length>0&&e.permissions.includes(h.DelegatePermissions.TAKE)&&(this.actionsheetButtons[1].exclude=!1),e.mine||void 0!==e.activeUsers&&0!==e.activeUsers.length||!e.permissions.includes(h.DelegatePermissions.ACQUIRE)||(this.actionsheetButtons[2].exclude=!1),t||(this.selectedDelegate=e,this.emitEvent(c.ChatEvents.ActionSheetToggle,{title:e.displayName,buttons:this.actionsheetButtons,id:"account-sheet"})),this.actionsheetButtons)),this._logout=(()=>{let e;e=!(this.layer.config&&this.layer.config.behaviour&&this.layer.config.behaviour.preventLogoutWithRoleAssigned)?new a.DefaultAlerts(this).AlertYesNoQuestion(this.translateI18nItem(p.CommonMetadata.getI18nItem(p.CommonI18nKeys.ARE_YOU_SURE)),this.translateI18nItem(p.CommonMetadata.getI18nItem(p.CommonI18nKeys.LOGOUT_MESSAGE)),1,{yes:()=>o(this,void 0,void 0,function*(){this._close(),this.emitEvent(c.ChatEvents._Request_Logout)})}):new a.DefaultAlerts(this).AlertErrorWithOkayButton(this.translateI18nItem(C.LOGOUT_FAILURE),this.translateI18nItem(C.LOGOUT_FAILURE_MESSAGE),1),this.emitEvent(c.ChatEvents._Request_RaiseAlert,e)}),this._relinquish=(e=>o(this,void 0,void 0,function*(){if(this.layer.getConnectionStatus()!==a.ConnectionStatus.Connected)return void this._renderOfflineMessage();const t=new a.DefaultAlerts(this).AlertYesNoQuestion(this.translateI18nItem(p.CommonMetadata.getI18nItem(p.CommonI18nKeys.ARE_YOU_SURE)),this.translateI18nItem(C.RELEASE_MESSAGE),1,{yes:()=>o(this,void 0,void 0,function*(){this.isLoading=!0;const t=yield d.default.relinquishAccount(this.layer,e);this._updateDelegateState(t),this.emitEvent(c.ChatEvents.WorkspaceUserChanged),this.emitEvent(c.ChatEvents.DelegatationRelinquish,e)})});this.emitEvent(c.ChatEvents._Request_RaiseAlert,t)})),this._take=(e=>o(this,void 0,void 0,function*(){if(this.layer.getConnectionStatus()!==a.ConnectionStatus.Connected)return void this._renderOfflineMessage();this.isLoading=!0;const t=yield d.default.takeAccount(this.layer,e);this._updateDelegateState(t)})),this._acquire=(e=>o(this,void 0,void 0,function*(){if(this.layer.getConnectionStatus()!==a.ConnectionStatus.Connected)return void this._renderOfflineMessage();this.isLoading=!0;const t=yield d.default.acquireAccount(this.layer,e);this._updateDelegateState(t)})),this._give=((e,t)=>o(this,void 0,void 0,function*(){if(this.layer.getConnectionStatus()!==a.ConnectionStatus.Connected)return void this._renderOfflineMessage();this.isLoading=!0;const n=yield d.default.giveAccount(this.layer,e,t);this.emitEvent(c.ChatEvents.WorkspaceUserChanged),this._updateDelegateState(n)}))}initialize(){return o(this,void 0,void 0,function*(){this.delegateAccounts=[],this.setAttribute("pointers","none"),this._allDelegateAccountsList=new g.VirtualList(this,[],{itemHeight:60,itemKeyGetter:e=>e.jid}),this._allDelegateAccountsList.setItems(this.delegateAccounts),this.actionsheetButtons=[{primaryText:this.translateI18nItem(C.GIVE),subtitleText:this.translateI18nItem(C.GIVE_DESCRIPTION),action:()=>{this.layer.getConnectionStatus()===a.ConnectionStatus.Connected?this.emitEvent(c.ChatEvents.OpenDelegateManagement,new c.DelegateManagementEventArgs(this.selectedDelegate,"Give",this._give)):this._renderOfflineMessage()},exclude:!0},{primaryText:this.translateI18nItem(C.TAKE),subtitleText:this.translateI18nItem(C.TAKE_DESCRIPTION),action:()=>this._take(this.selectedDelegate),exclude:!0},{primaryText:this.translateI18nItem(C.ACQUIRE),subtitleText:this.translateI18nItem(C.ACQUIRE_DESCRIPTION),action:()=>this._acquire(this.selectedDelegate),exclude:!0},{primaryText:this.translateI18nItem(C.RELINQUISH),subtitleText:this.translateI18nItem(C.RELINQUISH_DESCRIPTION),action:()=>this._relinquish(this.selectedDelegate),exclude:!0}]})}setupListeners(){this.addListener(c.ChatEvents.OpenAccountsMenu,this._open),this.addListener(c.ChatEvents.CloseAccountsMenu,this._close),this.addListener(c.ChatEvents.RefreshDelegateAccountsList,()=>o(this,void 0,void 0,function*(){const e=d.default.getDelegateState();this._updateDelegateState(e)})),this.addListener(c.ChatEvents.WorkspaceUserChanged,()=>{this.currentWorkspaceAccount=this.layer.store.getWorkspaceAccount()}),this.addListener(c.ChatEvents.DelegationRemoved,()=>o(this,void 0,void 0,function*(){yield this._fetchAndRefresh()})),this.addListener(c.ChatEvents.UnableToAcquireRole,()=>o(this,void 0,void 0,function*(){yield this._fetchAndRefresh()})),this.addListener(c.ChatEvents.UnableToTakeRole,()=>o(this,void 0,void 0,function*(){yield this._fetchAndRefresh()})),this.addListener(c.ChatEvents.ConnectionStatusChange,e=>{e.status===a.ConnectionStatus.Disconnected&&(this._updateDelegateState(d.default.getDelegateState()),this.isFetching=!1)})}_updateDelegateState(e=null){if(e){this.delegateAccounts=e.myAccounts,this.allDelegateAccounts=e.possibleAccounts.filter(e=>e.permissions.includes(h.DelegatePermissions.ACQUIRE)||e.permissions.includes(h.DelegatePermissions.TAKE));const t=this.allDelegateAccounts.filter(e=>this._openSheet(e,!0).filter(e=>!e.exclude).length>0);this._allDelegateAccountsList.setItems(t),this.isDelegateAdmin=e.adminAccounts.length>0}else this.allDelegateAccounts=[];this.isLoading=!1}_renderOfflineMessage(){this.layer.error(this.translateI18nItem(C.OFFLINE_ERROR_TITLE),this.translateI18nItem(C.OFFLINE_ERROR_MESSAGE))}_setWorkspaceAccount(e){return o(this,void 0,void 0,function*(){try{yield this.layer.store.setWorkspaceAccount(e)}catch(e){this.layer.store.setWorkspaceAccount(this.layer.getCurrentUserJid()),this.layer.error(this.translateI18nItem(C.WORKSPACE_ERROR_TITLE),this.translateI18nItem(C.WORKSPACE_ERROR_MESSAGE),e)}finally{this.emitEvent(c.ChatEvents.WorkspaceUserChanged),this._close()}})}generateComponentMarkup(){if(!this.user)return null;const e=["slide-panel",this.state],t=m.buildStyles({width:this.menuWidth||"300px"});return window.__CTRender("div",{class:e.join(" ")},window.__CTRender("div",{class:"blocker",onClick:()=>this.emitEvent(c.ChatEvents.CloseAccountsMenu)}),window.__CTRender("div",{class:"slide-panel-menu",style:t},window.__CTRender(v.CTCLHeader,{class:"header"},window.__CTRender("div",{slot:"left-action"},window.__CTRender(_.CTIcon,{class:"action",width:"20",height:"20",icon:a.Icons.COMMON.ChevronLeft,onClick:this._close})),window.__CTRender("div",{slot:"heading"},"Accounts"),window.__CTRender("div",{slot:"right-action"},this._renderRightMenu())),window.__CTRender("div",{class:"content"},window.__CTRender("div",{class:"accounts"},window.__CTRender("div",{class:"section-header"},window.__CTRender("h6",null,this.translateI18nItem(C.LOGGED_IN_AS))),this._renderUserRow(),window.__CTRender("div",{class:"section-header"},window.__CTRender("h6",null,this.translateI18nItem(C.DELEGATED))),this._renderMyDelegatedAccounts(),window.__CTRender("div",{class:"possible-delegates"},this._renderPreviouslyDelegatedAccounts()),window.__CTRender("div",{class:"add"},window.__CTRender(u.CTActionSheet,{buttons:this.actionsheetButtons,heading:"This is an example heading.",id:"account-sheet"}))))),window.__CTRender(v.CTCLDelegateAccountList,null))}_renderRightMenu(){const e=[new _.MenuItem(this.translateI18nItem(C.ABOUT),()=>o(this,void 0,void 0,function*(){window.cti&&(this._close(),yield f.sleep(250),window.cti.utils.callAction("go-to-page",{name:"About"}))}))];return window.cti&&"true"===window.cti.store.preferences.qaMode&&e.push(new _.MenuItem("QA Data",()=>o(this,void 0,void 0,function*(){window.cti&&(this._close(),yield f.sleep(250),window.cti.utils.callAction("go-to-page",{name:"QA"}))}))),this.layer.getWorkspaceJid()===this.layer.getCurrentUserJid()&&y.roleAssignmentGroup&&this.user.group.includes(y.roleAssignmentGroup)&&e.push(new _.MenuItem(this.translateI18nItem(C.ROLE_ASSIGNMENT),()=>this.emitEvent(c.ChatEvents.OpenDelegateAccountList))),this.layer.getWorkspaceJid()===this.layer.getCurrentUserJid()&&(y.roleAdminGroup&&this.user.group.includes(y.roleAdminGroup)||y.rolePermissionManagementGroup&&this.user.group.includes(y.rolePermissionManagementGroup))&&e.push(new _.MenuItem(this.translateI18nItem(C.ROLE_ADMIN),()=>this.emitEvent(c.ChatEvents.OpenRoleAdmin))),this.layer.getWorkspaceJid()===this.layer.getCurrentUserJid()&&(y.groupAdminGroup&&this.user.group.includes(y.groupAdminGroup)||y.uberAdminGroup&&this.user.group.includes(y.uberAdminGroup)||y.superAdminGroup&&this.user.group.includes(y.superAdminGroup))&&e.push(new _.MenuItem(this.translateI18nItem(C.GROUP_ADMIN),()=>this.emitEvent(c.ChatEvents.OpenGroupAdmin))),y.userAdminGroup&&this.user.group.includes(y.userAdminGroup)&&e.push(new _.MenuItem(this.translateI18nItem(C.USER_ADMIN),()=>this.emitEvent(c.ChatEvents.OpenUserAdmin))),window.__CTRender(u.CTMenu,{menuItems:e})}_renderUserRow(){const e=this.layer.getUnreadCountForUser(this.user.jid);return window.__CTRender(v.CTCLDelegateAccountRow,{account:this.user,subTitle:this.user.jobTitle,unreadCount:e,onClick:()=>this._setWorkspaceAccount(this.user.jid),highlight:this.currentWorkspaceAccount===this.user.jid.toLowerCase(),isCurrentUser:!0,onLogout:this._logout})}_renderMyDelegatedAccounts(){const e=this.delegateAccounts.filter(e=>e.mine);return e.length?window.__CTRender("div",{class:"my-delegates"},e.map(e=>{const t=this.layer.getUnreadCountForUser(e.jid);return window.__CTRender(v.CTCLDelegateAccountRow,{account:e,avatar:"Role",unreadCount:t,onAction:this._openSheet,isLoading:this.isLoading,onClick:()=>this._setWorkspaceAccount(e.jid),highlight:this.currentWorkspaceAccount===e.jid.toLowerCase()})})):window.__CTRender("div",{class:"row"},window.__CTRender("p",null,this.translateI18nItem(C.NO_DELEGATE_ACCOUNTS)))}_renderPreviouslyDelegatedAccounts(){return[...[window.__CTRender("div",{class:"section-header"},window.__CTRender("h6",null,this.translateI18nItem(C.AVAILABLE)))],window.__CTRender("div",{class:"accounts-container"},this.isFetching?window.__CTRender("div",{class:"fetching"},window.__CTRender(_.CTIcon,{width:"16",height:"16",icon:a.Icons.COMMON.LoadingSpinner,spin:!0})):this._allDelegateAccountsList.items.length>0?this._allDelegateAccountsList.render((e,t)=>window.__CTRender(v.CTCLDelegateAccountRow,Object.assign({account:e,avatar:"Role",onAction:this._openSheet,isLoading:this.isLoading,isWaiting:e.waiting,onClick:e=>this.layer.showContactInfo(e,null,!1)},t)),"accounts-list","account-content"):window.__CTRender("p",{class:"no-delegates"},"There are currently no delegate accounts available to you."))]}};i([s.prop({type:String,attribute:!0,default:"100%"})],w.prototype,"menuWidth",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],w.prototype,"isFetching",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],w.prototype,"isLoading",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],w.prototype,"isDelegateAdmin",void 0),i([s.prop({type:String,attribute:!0,default:"closed"})],w.prototype,"state",void 0),i([s.prop({type:Array,attribute:!1,default:[]})],w.prototype,"delegateAccounts",void 0),i([s.prop({type:Array,attribute:!1,default:[]})],w.prototype,"allDelegateAccounts",void 0),i([s.prop({type:Object,attribute:!1,default:null})],w.prototype,"selectedDelegate",void 0),i([s.prop({type:String,attribute:!1,default:""})],w.prototype,"currentWorkspaceAccount",void 0),i([s.prop({type:Array,attribute:!1,default:[]})],w.prototype,"actionsheetButtons",void 0),w=i([r.component({tag:"ctcl-account-menu",styles:[n(366)],i18nKeys:C})],w),t.CTCLAccountMenu=w},function(e,t,n){var i=n(367);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,'/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: inherit;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: block;\n  color: inherit;\n  position: fixed;\n  top: 0;\n  bottom: 0;\n  width: 100%; }\n\n@keyframes fadein {\n  0% {\n    opacity: 0;\n    transform: translateX(-100%); }\n  1% {\n    opacity: 0;\n    transform: translateX(0); }\n  100% {\n    opacity: 1;\n    transform: translateX(0); } }\n\n@keyframes fadeout {\n  0% {\n    opacity: 1;\n    transform: translateX(0); }\n  99% {\n    opacity: 0;\n    transform: translateX(0); }\n  100% {\n    opacity: 0;\n    transform: translateX(-100%); } }\n\n@keyframes slidein {\n  0% {\n    transform: translateX(-200%); }\n  1% {\n    transform: translateX(-100%); }\n  100% {\n    transform: translateX(0); } }\n\n@keyframes slideout {\n  0% {\n    transform: translateX(0); }\n  99% {\n    transform: translateX(-100%); }\n  100% {\n    transform: translateX(-200%); } }\n  :host .slide-panel {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 100%;\n    width: 100%; }\n    :host .slide-panel .header .action {\n      cursor: pointer; }\n    :host .slide-panel .button {\n      display: block;\n      z-index: 99999;\n      cursor: pointer; }\n    :host .slide-panel .blocker {\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      transform: translateX(-200%);\n      background: rgba(0, 0, 0, 0.5);\n      z-index: 99995;\n      will-change: transform, opacity;\n      opacity: 0; }\n    :host .slide-panel .slide-panel-menu {\n      height: 100%;\n      width: 100%;\n      transform: translateX(-200%);\n      background: var(--secondary-color, #f2f2f2);\n      color: #212121;\n      z-index: 99996;\n      will-change: transform; }\n    :host .slide-panel.open .blocker {\n      animation: fadein 200ms 1 ease-out normal forwards; }\n    :host .slide-panel.open .slide-panel-menu {\n      animation: slidein 200ms 1 ease-out normal forwards; }\n    :host .slide-panel.closed .blocker {\n      animation: fadeout 200ms 1 ease-out normal forwards; }\n    :host .slide-panel.closed .slide-panel-menu {\n      animation: slideout 200ms 1 ease-out normal forwards; }\n    :host .slide-panel .content {\n      display: flex;\n      flex-direction: column;\n      height: calc(100vh - var(--header-height, $header-height));\n      width: 100vw;\n      overflow: hidden; }\n      :host .slide-panel .content .accounts {\n        flex: 1 1 auto;\n        height: 100%;\n        overflow: auto;\n        display: flex;\n        flex-direction: column; }\n        :host .slide-panel .content .accounts .section-header {\n          background: var(--secondary-color, #f2f2f2);\n          padding: 3px 20px;\n          border-bottom: 1px solid var(--default-border-color, #dddddd); }\n          :host .slide-panel .content .accounts .section-header h6 {\n            margin: 0;\n            color: var(--subtle-font-color, #828688);\n            text-transform: uppercase;\n            font-size: 0.75em;\n            font-weight: 400; }\n        :host .slide-panel .content .accounts div.my-delegates {\n          flex: 0 0 auto;\n          max-height: 240px;\n          overflow: auto; }\n        :host .slide-panel .content .accounts div.possible-delegates {\n          position: relative;\n          display: flex;\n          flex-direction: column;\n          flex: 1 1 auto;\n          overflow: hidden; }\n        :host .slide-panel .content .accounts .row {\n          display: flex;\n          align-items: center;\n          min-height: 60px;\n          padding: 0 20px;\n          border-bottom: 1px solid var(--default-border-color, #dddddd);\n          background-color: var(--list-item-bg, #ffffff); }\n          :host .slide-panel .content .accounts .row.current {\n            background-color: #e7f7fa; }\n          :host .slide-panel .content .accounts .row.pointer {\n            cursor: pointer; }\n          :host .slide-panel .content .accounts .row ct-user-avatar {\n            margin-right: 10px; }\n          :host .slide-panel .content .accounts .row .details {\n            display: flex;\n            flex-direction: column;\n            flex: 1 1 75%;\n            overflow: hidden;\n            padding-right: 5px;\n            justify-content: center; }\n            :host .slide-panel .content .accounts .row .details p {\n              margin: 0;\n              color: var(--subtle-font-color, #828688); }\n              :host .slide-panel .content .accounts .row .details p.title {\n                font-size: 1.333em;\n                color: #212121;\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis; }\n          :host .slide-panel .content .accounts .row div.actions {\n            flex: 0 0 25%;\n            display: flex;\n            align-items: center;\n            justify-content: flex-end; }\n        :host .slide-panel .content .accounts div.accounts-container {\n          position: relative;\n          display: flex;\n          flex-direction: column;\n          flex: 1 1 auto;\n          overflow: hidden;\n          color: var(--default-font-color, #212121); }\n          :host .slide-panel .content .accounts div.accounts-container ct-icon {\n            padding: 20px; }\n          :host .slide-panel .content .accounts div.accounts-container div.accounts-list {\n            flex: 1 1 auto;\n            overflow: auto;\n            -webkit-overflow-scrolling: touch;\n            padding-bottom: 20px; }\n          :host .slide-panel .content .accounts div.accounts-container p.no-delegates {\n            padding: 1rem;\n            text-align: center; }\n      :host .slide-panel .content .add {\n        flex: 0 0 auto;\n        background: var(--secondary-color, #f2f2f2);\n        border-top: var(--secondary-border, 1px solid #dddddd);\n        display: flex;\n        justify-content: center; }\n\n:host([pointers="none"]) {\n  pointer-events: none; }\n\n:host([pointers="auto"]) {\n  pointer-events: auto; }\n',""])},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(15),a=n(0),l=n(12),c=n(6),d=n(34),h=n(11),u=n(45),p=n(20),g=n(22),m=n(5),f=n(23),_=n(27);var v;!function(e){e[e.ASSIGN="Assign"]="ASSIGN",e[e.ASSIGN_DESCRIPTION="Assign this delegate to a user"]="ASSIGN_DESCRIPTION",e[e.RELEASE="Release"]="RELEASE",e[e.RELEASE_DESCRIPTION="Release this delegate from a user and back into the pool"]="RELEASE_DESCRIPTION",e[e.RELEASE_MESSAGE="Are you sure you wish to release this delegate account back into the pool?"]="RELEASE_MESSAGE",e[e.REQUEST="Request"]="REQUEST",e[e.SEARCH_PLACEHOLDER="Find Accounts"]="SEARCH_PLACEHOLDER",e[e.TAKE="Take"]="TAKE",e[e.TITLE="Role Assignment"]="TITLE",e[e.TRANSFER="Transfer"]="TRANSFER",e[e.TRANSFER_DESCRIPTION="Transfer this delegate from one user to another"]="TRANSFER_DESCRIPTION",e[e.WAITING="Waiting..."]="WAITING"}(v||(v={}));let y=class extends l.CTCLComponent{constructor(){super(...arguments),this._open=(()=>o(this,void 0,void 0,function*(){this.showing=!0,this.isFetching=!0,yield m.sleep(this.animateWhenDisplaying?500:0),yield this.layer.updateUserDirectory(),this._updateDelegateState(d.default.getDelegateState()),this.isFetching=!1,this._virtualList.setItems(this.delegateAccounts)})),this._close=(()=>o(this,void 0,void 0,function*(){this.delegateAccounts=[],this.emitEvent(c.ChatEvents.RefreshDelegateAccountsList),this.showing=!1,yield m.sleep(this.animateWhenDisplaying?500:0),this._virtualList.setItems([])})),this._onSearch=((e,t)=>{t?(this._searchString=t.toLowerCase().trim(),this._virtualList.setItems(this._doDelegateListFilter(t))):(this._searchString=null,this._virtualList.setItems(this.delegateAccounts))}),this._assign=((e,t)=>o(this,void 0,void 0,function*(){this.isLoading=!0;const n=yield d.default.assignAccount(this.layer,e,t);this._updateDelegateState(n)})),this._release=(e=>o(this,void 0,void 0,function*(){const t=new a.DefaultAlerts(this).AlertYesNoQuestion(this.translateI18nItem(p.CommonMetadata.getI18nItem(p.CommonI18nKeys.ARE_YOU_SURE)),this.translateI18nItem(v.RELEASE_MESSAGE),1,{yes:()=>o(this,void 0,void 0,function*(){this.isLoading=!0;const t=yield d.default.releaseAccount(this.layer,e);this._updateDelegateState(t)})});this.emitEvent(c.ChatEvents._Request_RaiseAlert,t)})),this._transfer=((e,t)=>o(this,void 0,void 0,function*(){this.isLoading=!0;const n=yield d.default.transferAccount(this.layer,e,t);this._updateDelegateState(n)})),this._openSheet=(e=>{this.actionsheetButtons.forEach(e=>e.exclude=!0),0===e.activeUsers.length&&e.permissions.includes(h.DelegatePermissions.ASSIGN)&&(this.actionsheetButtons[0].exclude=!1),e.activeUsers.length>0&&e.permissions.includes(h.DelegatePermissions.REMOVE)&&(this.actionsheetButtons[1].exclude=!1),e.activeUsers.length>0&&e.permissions.includes(h.DelegatePermissions.TRANSFER)&&(this.actionsheetButtons[2].exclude=!1),this.selectedDelegate=e,this.emitEvent(c.ChatEvents.ActionSheetToggle,{title:e.displayName,buttons:this.actionsheetButtons,id:"admin-del"})}),this._refresh=(()=>o(this,void 0,void 0,function*(){if(this.isLoading)return;this.isLoading=!0;const e=yield d.default.getCurrentlyDelegatedAccounts(this.layer);yield this.layer.updateUserDirectory(),this._updateDelegateState(e)})),this._renderItem=((e,t)=>window.__CTRender(_.CTCLDelegateAccountRow,Object.assign({account:e,isLoading:this.isLoading,avatar:"Role",onAction:this._openSheet,onClick:e=>this.layer.showContactInfo(e,null,!1)},t,{alwaysShowActiveUser:!0})))}initialize(){return o(this,void 0,void 0,function*(){this._virtualList=new g.VirtualList(this,[],{itemHeight:60,itemKeyGetter:e=>e.jid,blockSize:10}),this._virtualList.setItems([]),this.actionsheetButtons=[{primaryText:this.translateI18nItem(v.ASSIGN),subtitleText:this.translateI18nItem(v.ASSIGN_DESCRIPTION),action:()=>{this.emitEvent(c.ChatEvents.OpenDelegateManagement,new c.DelegateManagementEventArgs(this.selectedDelegate,"Assign",this._assign))},exclude:!0},{primaryText:this.translateI18nItem(v.RELEASE),subtitleText:this.translateI18nItem(v.RELEASE_DESCRIPTION),action:()=>this._release(this.selectedDelegate),exclude:!0},{primaryText:this.translateI18nItem(v.TRANSFER),subtitleText:this.translateI18nItem(v.TRANSFER_DESCRIPTION),action:()=>this.emitEvent(c.ChatEvents.OpenDelegateManagement,new c.DelegateManagementEventArgs(this.selectedDelegate,"Transfer",this._transfer)),exclude:!0}]})}setupListeners(){this.addListener(c.ChatEvents.OpenDelegateAccountList,this._open),this.addListener(c.ChatEvents.CloseDelegateAccountList,this._close),this.addListener(c.ChatEvents.ConnectionStatusChange,e=>o(this,void 0,void 0,function*(){e.status===a.ConnectionStatus.Disconnected&&(this.isLoading=!1)}))}_doDelegateListFilter(e){const t=e.toLowerCase().trim();return this.delegateAccounts.filter(e=>e.displayName.toLowerCase().includes(t)||e.jid.toLowerCase().includes(t))}_refreshDelegates(){return o(this,void 0,void 0,function*(){const e=yield d.default.getCurrentlyDelegatedAccounts(this.layer);this._updateDelegateState(e)})}_updateDelegateState(e){const t=e.adminAccounts,n=e.myAccounts.filter(e=>e.permissions.includes(h.DelegatePermissions.ASSIGN)||e.permissions.includes(h.DelegatePermissions.REMOVE)||e.permissions.includes(h.DelegatePermissions.TRANSFER)),i=e.possibleAccounts.filter(e=>e.permissions.includes(h.DelegatePermissions.ASSIGN)||e.permissions.includes(h.DelegatePermissions.REMOVE)||e.permissions.includes(h.DelegatePermissions.TRANSFER));this.delegateAccounts=[...new Set([...t,...n,...i])],this._searchString?this._virtualList.setItems(this._doDelegateListFilter(this._searchString)):this._virtualList.setItems(this.delegateAccounts),this.isLoading=!1}generateComponentMarkup(){return window.__CTRender("div",{class:"container"},window.__CTRender(_.CTCLHeader,{class:"header"},window.__CTRender("div",{slot:"left-action"},window.__CTRender(f.CTIcon,{class:"action",width:"20",height:"20",icon:a.Icons.COMMON.ChevronLeft,onClick:this._close})),window.__CTRender("div",{slot:"heading"},this.translateI18nItem(v.TITLE)),window.__CTRender("div",{slot:"right-action"},window.__CTRender(f.CTIcon,{class:"action",width:"20",height:"20",icon:a.Icons.COMMON.Refresh,spin:this.isLoading,onClick:this._refresh}))),window.__CTRender("div",{class:"filter"},window.__CTRender(f.CTSelectionTextFilter,{enableSelection:!1,placeholder:this.translateI18nItem(v.SEARCH_PLACEHOLDER),selectionItems:[],onSearch:this._onSearch})),window.__CTRender("div",{class:"accounts"},this.isFetching?window.__CTRender("div",{class:"fetching"},window.__CTRender(f.CTIcon,{width:"16",height:"16",icon:a.Icons.COMMON.LoadingSpinner,spin:!0})):0===this._virtualList.items.length?window.__CTRender("p",{class:"no-results"},"No roles match your search"):this._virtualList.render(this._renderItem,"accounts-list","account-content")),window.__CTRender("div",{class:"add"},window.__CTRender(u.CTActionSheet,{buttons:this.actionsheetButtons,heading:"This is an example heading.",id:"admin-del"})))}};i([s.prop({type:Boolean,attribute:!0,default:!1})],y.prototype,"showing",void 0),i([s.prop({type:Boolean,attribute:!0,default:!0})],y.prototype,"animateWhenDisplaying",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],y.prototype,"isFetching",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],y.prototype,"isLoading",void 0),i([s.prop({type:Array,attribute:!1,default:[]})],y.prototype,"delegateAccounts",void 0),i([s.prop({type:Array,attribute:!1,default:[]})],y.prototype,"actionsheetButtons",void 0),i([s.prop({type:Object,attribute:!1,default:null})],y.prototype,"selectedDelegate",void 0),y=i([r.component({tag:"ctcl-delegate-account-list",styles:[n(369)],i18nKeys:v})],y),t.CTCLDelegateAccountList=y},function(e,t,n){var i=n(370);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: inherit;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: flex;\n  flex-direction: column;\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  background: #ffffff;\n  font-size: 1em;\n  transform: translateY(101%);\n  will-change: transform;\n  z-index: 99998; }\n  :host div.container {\n    flex-direction: column;\n    height: 100%;\n    display: flex;\n    background-color: var(--list-bg);\n    color: var(--default-font-color);\n    flex: 1 1 auto; }\n    :host div.container .header .action {\n      cursor: pointer; }\n    :host div.container p.no-results {\n      flex: 1;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      height: 100%;\n      text-align: center;\n      padding: 55px;\n      color: var(--subtle-font-color, #828688);\n      font-size: 18px; }\n    :host div.container div.filter {\n      flex: 0 0 55px;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: var(--secondary-color, #f2f2f2);\n      border-bottom: var(--secondary-border, 1px solid #dddddd);\n      padding: 0 20px; }\n      :host div.container div.filter .search-box {\n        width: 80%;\n        font-size: 0.833em; }\n    :host div.container div.accounts {\n      position: relative;\n      display: flex;\n      flex-direction: column;\n      flex: 1 1 auto;\n      height: 100%;\n      overflow: hidden; }\n      :host div.container div.accounts div.fetching {\n        margin: 20px 0; }\n      :host div.container div.accounts div.accounts-list {\n        flex: 1 1 auto;\n        overflow: auto;\n        -webkit-overflow-scrolling: touch; }\n      :host div.container div.accounts .row {\n        display: flex;\n        padding: 10px 20px;\n        border-bottom: 1px solid var(--default-border-color, #dddddd);\n        background-color: var(--list-item-bg, #ffffff);\n        color: var(--default-font-color, #212121); }\n        :host div.container div.accounts .row.mine {\n          background-color: #e7f7fa; }\n        :host div.container div.accounts .row ct-user-avatar {\n          margin-right: 10px; }\n        :host div.container div.accounts .row .details {\n          display: flex;\n          flex-direction: column;\n          flex: 1 1 75%;\n          overflow: hidden;\n          padding-right: 5px;\n          justify-content: center; }\n          :host div.container div.accounts .row .details p {\n            margin: 0;\n            color: var(--subtle-font-color, #828688); }\n            :host div.container div.accounts .row .details p.title {\n              font-size: 1.333em;\n              color: #212121;\n              white-space: nowrap;\n              overflow: hidden;\n              text-overflow: ellipsis; }\n        :host div.container div.accounts .row div.actions {\n          flex: 0 0 25%;\n          display: flex;\n          align-items: center;\n          justify-content: flex-end; }\n\n:host([animate-when-displaying]) {\n  transition: transform var(--animation-normal, 0.5s) ease-out; }\n\n:host([showing]) {\n  transform: translateY(0); }\n",""])},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(15),a=n(0),l=n(12),c=n(23),d=n(36);var h;!function(e){e[e.LOGOUT="Sign Out"]="LOGOUT",e[e.RELEASE="Release"]="RELEASE",e[e.REQUEST="Request"]="REQUEST",e[e.TAKE="Take"]="TAKE",e[e.WAITING="Waiting..."]="WAITING"}(h||(h={}));let u=class extends l.CTCLComponent{constructor(){super(...arguments),this._onClick=(()=>{this.onClick&&this.onClick(this.account)}),this._onSelect=(e=>{e.stopImmediatePropagation(),this.onSelect&&this.onSelect(this.account)}),this._logout=(()=>{this.onLogout&&this.onLogout()}),this._onAction=(e=>{e.stopImmediatePropagation(),this.onAction&&this.onAction(this.account)})}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){}generateComponentMarkup(){if(!this.account)return null;let e="";return this.onClick&&(e="pointer"),window.__CTRender("div",{class:`container ${this.highlight?"current":""} ${e}`,onClick:this.selectable?this._onSelect:this._onClick},this._generateAvatar(),window.__CTRender("div",{class:"details"},window.__CTRender("p",{class:"title"},this.account.displayName),this.subTitle||this.account.jid===this.layer.getCurrentUserJid()?this.subTitle:this.account.mine&&!this.alwaysShowActiveUser||!this.account.is_role?window.__CTRender("span",{class:"job-title"},this.account.jobTitle):window.__CTRender("p",null,this.account.activeUsers&&this.account.activeUsers.length?this.account.activeUsers[0]?this.account.activeUsers[0].displayName:"Unknown User":"Empty")),!this.hideActions&&window.__CTRender("div",{class:"actions"},this._renderAction()))}_renderAction(){return this.selectable?window.__CTRender("div",{class:"radio"},window.__CTRender(c.CTIcon,{icon:this.selected?a.Icons.COMMON.RadioChecked:a.Icons.COMMON.RadioEmpty,height:"16",width:"16"})):this.isCurrentUser?this.layer.config.behaviour.hideSignOutButton?null:window.__CTRender(c.CTButton,{type:"account-release",onClick:this._logout},this.translateI18nItem(h.LOGOUT)):window.__CTRender("div",{class:"dots-button",onClick:!this.isLoading&&this._onAction},this.isLoading?window.__CTRender(c.CTIcon,{icon:a.Icons.COMMON.LoadingSpinner,spin:!0,height:"16",width:"16",color:"#7b7e80"}):window.__CTRender(c.CTIcon,{icon:a.Icons.COMMON.MenuDots,height:"16",width:"16",color:"#7b7e80"}))}_generateAvatar(){switch(this.avatar){case"Role":return window.__CTRender("div",{className:"role-avatar-container"},window.__CTRender(d.CTRoleAvatar,{badge:this.unreadCount,slot:"avatar",size:40,onClick:this._onClick}));default:return window.__CTRender(c.CTUserAvatar,{badge:this.unreadCount,onClick:this._onClick})}}};i([s.prop({type:Object,attribute:!1,default:null})],u.prototype,"account",void 0),i([s.prop({type:String,attribute:!1,default:""})],u.prototype,"subTitle",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],u.prototype,"isLoading",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],u.prototype,"isWaiting",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],u.prototype,"hideActions",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],u.prototype,"selectable",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],u.prototype,"selected",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],u.prototype,"highlight",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],u.prototype,"isCurrentUser",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],u.prototype,"alwaysShowActiveUser",void 0),i([s.prop({type:Number,attribute:!1,default:0})],u.prototype,"unreadCount",void 0),i([s.prop({type:String,attribute:!1})],u.prototype,"avatar",void 0),i([s.prop({type:Function,attribute:!1,default:null})],u.prototype,"onClick",void 0),i([s.prop({type:Function,attribute:!1,default:null})],u.prototype,"onSelect",void 0),i([s.prop({type:Function,attribute:!1,default:null})],u.prototype,"onLogout",void 0),i([s.prop({type:Function,attribute:!1,default:null})],u.prototype,"onAction",void 0),u=i([r.component({tag:"ctcl-delegate-account-row",styles:[n(372)],i18nKeys:h})],u),t.CTCLDelegateAccountRow=u},function(e,t,n){var i=n(373);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: inherit;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host div.container {\n  display: flex;\n  height: 60px;\n  padding: 10px 20px;\n  border-bottom: 1px solid var(--default-border-color, #dddddd);\n  background-color: var(--list-item-bg, #ffffff);\n  color: var(--default-font-color, #212121); }\n  :host div.container .role-avatar-container {\n    margin-right: 10px; }\n  :host div.container.current {\n    filter: brightness(90%); }\n  :host div.container.pointer {\n    cursor: pointer; }\n    @media (pointer: fine) {\n      :host div.container.pointer {\n        transition: padding 0.2s ease-in-out; }\n        :host div.container.pointer:hover {\n          padding-left: 40px; } }\n  :host div.container ct-user-avatar {\n    margin-right: 10px; }\n  :host div.container .details {\n    display: flex;\n    flex-direction: column;\n    flex: 1 1 75%;\n    overflow: hidden;\n    padding-right: 5px;\n    justify-content: center; }\n    :host div.container .details p {\n      margin: 0;\n      color: var(--subtle-font-color, #828688); }\n      :host div.container .details p.title {\n        font-size: 1.333em;\n        color: var(--default-font-color, #212121);\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis; }\n    :host div.container .details span.job-title {\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis; }\n  :host div.container div.actions {\n    flex: 0 0 25%;\n    display: flex;\n    align-items: center;\n    justify-content: flex-end;\n    color: var(--primary-color, #22b1c8); }\n    :host div.container div.actions div.dots-button {\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: center;\n      padding: 5px;\n      color: #212121;\n      height: 40px;\n      width: 40px;\n      font-size: 11px;\n      cursor: pointer;\n      border-radius: 4px;\n      background-color: var(--list-item-bg, #ffffff); }\n      @media (pointer: fine) {\n        :host div.container div.actions div.dots-button {\n          transition: filter 0.3s ease-out; }\n          :host div.container div.actions div.dots-button:hover {\n            filter: brightness(95%); } }\n    :host div.container div.actions div.radio {\n      height: 40px;\n      width: 40px;\n      display: flex;\n      align-items: center;\n      justify-content: center; }\n",""])},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(15),a=n(0),l=n(12),c=n(6),d=n(11),h=n(22),u=n(5),p=n(23),g=n(27),m=n(13);var f;!function(e){e[e.DELEGATE="Delegate"]="DELEGATE",e[e.GIVE="Give"]="GIVE",e[e.SEARCH_PLACEHOLDER="Search for user..."]="SEARCH_PLACEHOLDER",e[e.SELECTED_ACCOUNT="Selected Account"]="SELECTED_ACCOUNT",e[e.SELECT_USER="Select User"]="SELECT_USER"}(f||(f={}));let _=class extends l.CTCLComponent{constructor(){super(...arguments),this._searchAvailableThreshold=10,this.ITEM_HEIGHT=60,this._open=(e=>o(this,void 0,void 0,function*(){if(this.title=e.action,this.delegate=Object.assign({},e.delegate),this.onAction=e.onAction,this.showing=!0,this.isFetching=!0,yield u.sleep(this.animateWhenDisplaying?500:0),!!!this.delegate.proxies.find(e=>!(!e||!e.id)&&"*"===e.id)||e.action.toLowerCase()!==d.DelegatePermissions.TRANSFER&&e.action.toLowerCase()!==d.DelegatePermissions.ASSIGN)this.delegate.proxies=this.delegate.proxies.filter(e=>!(!e||!e.id)&&e.jid!==this.layer.getCurrentUserJid().toLowerCase());else{const e=yield this.layer.getAllUsers(!0,!0);this.delegate.proxies=e.map(e=>Object.assign({delegable:!0,badge:0,mine:!1},e))}const t=this.delegate.activeUsers?this.delegate.activeUsers.map(e=>e.jid):[];this.delegateAccounts=this.delegate.proxies?this.delegate.proxies.filter(e=>e&&e.jid!==this.delegate.jid&&"*"!==e.jid).filter(e=>!t.includes(e.jid)).sort((e,t)=>e.displayName<t.displayName?-1:1):[],this.isFetching=!1,this._virtualList.setItems(this.delegateAccounts)})),this._close=(()=>o(this,void 0,void 0,function*(){this.showing=!1,yield u.sleep(this.animateWhenDisplaying?500:0),this.isLoading=!1,this.title="",this.delegate=null,this.selectedTarget=null,this.actionDisabled=!0,this._virtualList.setItems([])})),this._onSelect=(e=>{this.selectedTarget&&this.selectedTarget.jid===e.jid?(this.selectedTarget=null,this.actionDisabled=!0):(this.selectedTarget=e,this.actionDisabled=!1)}),this._action=(()=>o(this,void 0,void 0,function*(){this.isLoading=!0,this.onAction&&(yield this.onAction(this.delegate,this.selectedTarget.jid.toLowerCase())),this._close()})),this._onSearch=((e,t)=>{if(t){const e=t.toLowerCase().trim(),n=this.delegateAccounts.filter(t=>t.displayName.toLowerCase().includes(e)||t.jid.toLowerCase().includes(e));this._virtualList.setItems(n)}else this._virtualList.setItems(this.delegateAccounts)}),this._renderItem=((e,t)=>{const n=this.selectedTarget&&this.selectedTarget.jid===e.jid,i=m.buildStyles({height:`${this.ITEM_HEIGHT}px`});return window.__CTRender("div",Object.assign({style:i},t),window.__CTRender(g.CTCLDelegateAccountRow,{account:e,selectable:!0,selected:n,highlight:n,onClick:e=>this.layer.showContactInfo(e,null,!1),onSelect:this._onSelect}))})}initialize(){return o(this,void 0,void 0,function*(){this._virtualList=new h.VirtualList(this,[],{itemHeight:this.ITEM_HEIGHT,itemKeyGetter:e=>e.jid,blockSize:10}),this._virtualList.setItems([])})}setupListeners(){this.addListener(c.ChatEvents.OpenDelegateManagement,this._open),this.addListener(c.ChatEvents.CloseDelegateManagement,this._close)}generateComponentMarkup(){return this.delegate?window.__CTRender("div",{class:"container"},window.__CTRender(g.CTCLHeader,{class:"header"},window.__CTRender("div",{slot:"left-action"},window.__CTRender(p.CTIcon,{class:"action",width:"20",height:"20",icon:a.Icons.COMMON.ChevronLeft,onClick:this._close})),window.__CTRender("div",{slot:"heading"},this.title," ",this.translateI18nItem(f.DELEGATE))),window.__CTRender("div",{class:"section-header"},window.__CTRender("h6",null,this.translateI18nItem(f.SELECTED_ACCOUNT))),window.__CTRender(g.CTCLDelegateAccountRow,{account:this.delegate,hideActions:!0}),window.__CTRender("div",{class:"section-header"},window.__CTRender("h6",null,this.translateI18nItem(f.SELECT_USER))),this.delegateAccounts&&this.delegateAccounts.length>this._searchAvailableThreshold&&window.__CTRender("div",{class:"filter"},window.__CTRender(p.CTSelectionTextFilter,{enableSelection:!1,placeholder:this.translateI18nItem(f.SEARCH_PLACEHOLDER),selectionItems:[],onSearch:this._onSearch})),window.__CTRender("div",{class:"accounts"},this.isFetching?window.__CTRender("div",{class:"fetching"},window.__CTRender(p.CTIcon,{width:"16",height:"16",icon:a.Icons.COMMON.LoadingSpinner,spin:!0})):0===this._virtualList.items.length?window.__CTRender("p",{class:"no-accounts"},"There are no accounts you can ",this.title," this Role to"):this._virtualList.render(this._renderItem.bind(this),"accounts-list","account-content")),window.__CTRender("div",{class:"footer"},window.__CTRender(p.CTButton,{type:"primary",class:"button",disabled:this.actionDisabled,onClick:this._action,isWaiting:this.isLoading},this.title))):null}};i([s.prop({type:Boolean,attribute:!0,default:!1})],_.prototype,"showing",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],_.prototype,"isLoading",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],_.prototype,"isFetching",void 0),i([s.prop({type:Boolean,attribute:!0,default:!0})],_.prototype,"animateWhenDisplaying",void 0),i([s.prop({type:String,attribute:!1,default:""})],_.prototype,"title",void 0),i([s.prop({type:Object,attribute:!1,default:null})],_.prototype,"delegate",void 0),i([s.prop({type:Array,attribute:!1,default:[]})],_.prototype,"delegateAccounts",void 0),i([s.prop({type:Object,attribute:!1,default:null})],_.prototype,"selectedTarget",void 0),i([s.prop({type:Boolean,attribute:!0,default:!0})],_.prototype,"actionDisabled",void 0),i([s.prop({type:Function,attribute:!1,default:null})],_.prototype,"onAction",void 0),_=i([r.component({tag:"ctcl-delegate-management",styles:[n(375)],i18nKeys:f})],_),t.CTCLDelegateManagement=_},function(e,t,n){var i=n(376);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: inherit;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: flex;\n  flex-direction: column;\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  background: #ffffff;\n  font-size: 1em;\n  transform: translateY(101%);\n  will-change: transform;\n  z-index: 99998; }\n  :host div.container {\n    flex-direction: column;\n    height: 100%;\n    display: flex;\n    background-color: var(--list-bg);\n    color: var(--default-font-color);\n    flex: 1 1 auto; }\n    :host div.container .header .action {\n      cursor: pointer; }\n    :host div.container .section-header {\n      background: var(--secondary-color, #f2f2f2);\n      padding: 3px 20px;\n      border-bottom: 1px solid var(--default-border-color, #dddddd); }\n      :host div.container .section-header h6 {\n        margin: 0;\n        color: var(--subtle-font-color, #828688);\n        text-transform: uppercase;\n        font-size: 0.75em;\n        font-weight: 400; }\n    :host div.container div.filter {\n      flex: 0 0 55px;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: var(--secondary-color, #f2f2f2);\n      border-bottom: var(--secondary-border, 1px solid #dddddd);\n      padding: 0 20px; }\n      :host div.container div.filter .search-box {\n        width: 80%;\n        font-size: 0.833em; }\n    :host div.container p.no-accounts {\n      flex: 1;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      height: 100%;\n      text-align: center;\n      padding: 55px;\n      color: var(--subtle-font-color, #828688);\n      font-size: 18px; }\n    :host div.container div.accounts {\n      position: relative;\n      display: flex;\n      flex-direction: column;\n      flex: 1 1 auto;\n      height: 100%;\n      overflow: hidden; }\n      :host div.container div.accounts div.fetching {\n        margin: 20px 0; }\n      :host div.container div.accounts div.accounts-list {\n        flex: 1 1 auto;\n        overflow: auto;\n        -webkit-overflow-scrolling: touch; }\n    :host div.container .footer {\n      flex: 0 0 auto;\n      background: var(--secondary-color, #f2f2f2);\n      border-top: var(--secondary-border, 1px solid #dddddd);\n      display: flex;\n      padding: 10px 20px; }\n      :host div.container .footer .button {\n        flex: 1 1;\n        margin: 0 5px;\n        font-size: 1.4em; }\n\n:host([animate-alert]) {\n  transition: transform var(--animation-normal, 0.5s) ease-out; }\n\n:host([showing]) {\n  transform: translateY(0); }\n",""])},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(15),a=n(0),l=n(12),c=n(18),d=n(53),h=n(8),u=n(5);var p;!function(e){e[e.RESPONSES="Responses"]="RESPONSES"}(p||(p={}));let g=class extends l.CTCLComponent{constructor(){super(...arguments),this._animationDuration=500}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){}show(e,t=!0){return o(this,void 0,void 0,function*(){this.conversation=e,this.animateModal=t,this.showing=!0,this.layer.setBackHandler(()=>{this._back()}),yield u.sleep(t?this._animationDuration:0)})}dismiss(e=!0){return o(this,void 0,void 0,function*(){this.animateModal=e,this.showing=!1,this.layer.popBackHandler(),yield u.sleep(e?this._animationDuration:0),this.conversation=null})}_back(){this.dismiss()}generateComponentMarkup(){return window.__CTRender("div",{class:"container"},this._renderHeader(),window.__CTRender("div",{class:"user-responses"},this.conversation&&window.__CTRender(d.CTCLResponseView,{conversation:this.conversation})))}_renderHeader(){return window.__CTRender(c.CTCLHeader,{class:"header"},window.__CTRender("div",{slot:"left-action"},window.__CTRender(h.CTIcon,{class:"action",width:"20",height:"20",icon:a.Icons.COMMON.ChevronLeft,onClick:this._back.bind(this)})),window.__CTRender("div",{slot:"heading"},`${this.translateI18nItem(p.RESPONSES)}`),window.__CTRender("div",{slot:"sub-heading"}))}};i([s.prop({type:Object,attribute:!1,default:null})],g.prototype,"conversation",void 0),i([s.prop({type:Boolean,attribute:!0,default:!0})],g.prototype,"animateModal",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],g.prototype,"showing",void 0),g=i([r.component({tag:"ctcl-responses-modal",styles:[n(378)],i18nKeys:p})],g),t.CTCLResponsesModal=g},function(e,t,n){var i=n(379);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n:host {\n  display: flex;\n  flex-direction: column;\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  background: #ffffff;\n  font-size: 1em;\n  transform: translateY(101%);\n  will-change: transform;\n  z-index: 99998; }\n  :host .container {\n    flex: 1 1 auto;\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    background-color: var(--list-bg);\n    color: var(--default-font-color); }\n    :host .container .header .action {\n      cursor: pointer; }\n    :host .container .user-responses {\n      position: relative;\n      display: flex;\n      flex-direction: column;\n      flex: 1 1 auto;\n      height: 100%;\n      overflow: hidden; }\n\n:host([animate-modal]) {\n  transition: transform var(--animation-normal, 0.5s) ease-out; }\n\n:host([showing]) {\n  transform: translateY(0); }\n",""])},function(e,t,n){var i=n(381);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: inherit;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: flex;\n  flex-direction: column;\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  background: #ffffff;\n  font-size: 1em;\n  transform: translateY(101%);\n  will-change: transform;\n  z-index: 99998; }\n  :host div.container {\n    flex-direction: column;\n    height: 100%;\n    display: flex;\n    background-color: var(--list-bg);\n    color: var(--default-font-color);\n    flex: 1 1 auto; }\n    :host div.container .header .action {\n      cursor: pointer; }\n    :host div.container .footer {\n      background: var(--secondary-color, #f2f2f2);\n      border-top: var(--secondary-border, 1px solid #dddddd);\n      padding: 10px 20px;\n      font-size: 16px; }\n      :host div.container .footer .italics {\n        font-style: italic; }\n    :host div.container div.form {\n      position: relative;\n      display: flex;\n      flex-direction: column;\n      flex: 1 1 auto;\n      height: 100%;\n      overflow: hidden;\n      padding: 10px;\n      font-size: 16px; }\n    :host div.container p.note {\n      font-size: 14px;\n      padding: 0 15px; }\n    :host div.container .italics {\n      font-style: italic; }\n\n:host([animate-when-displaying]) {\n  transition: transform var(--animation-normal, 0.5s) ease-out; }\n\n:host([showing]) {\n  transform: translateY(0); }\n",""])},function(e,t,n){var i=n(383);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: inherit;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: flex;\n  flex-direction: column;\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  background: #ffffff;\n  font-size: 1em;\n  transform: translateY(101%);\n  will-change: transform;\n  z-index: 99998; }\n  :host div.container {\n    flex-direction: column;\n    height: 100%;\n    display: flex;\n    background-color: var(--list-bg);\n    color: var(--default-font-color);\n    flex: 1 1 auto; }\n    :host div.container .header .action {\n      cursor: pointer; }\n    :host div.container div.filter {\n      flex: 0 0 55px;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: var(--secondary-color, #f2f2f2);\n      border-bottom: var(--secondary-border, 1px solid #dddddd);\n      padding: 0 20px; }\n      :host div.container div.filter .search-box {\n        width: 80%;\n        font-size: 0.833em; }\n    :host div.container p.no-results {\n      flex: 1;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      height: 100%;\n      text-align: center;\n      padding: 55px;\n      color: var(--subtle-font-color, #828688);\n      font-size: 18px; }\n    :host div.container div.footer {\n      flex: 0 0 auto;\n      display: flex;\n      transition: top 150ms ease-in, height 150ms ease-in;\n      font-size: 1em;\n      top: 50px;\n      position: relative;\n      height: 0px;\n      justify-content: center; }\n      :host div.container div.footer .fetching {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        font-size: large;\n        height: 50px;\n        width: 100%;\n        background: var(--secondary-color, #f2f2f2);\n        border-top: var(--secondary-border, 1px solid #dddddd); }\n        :host div.container div.footer .fetching ct-icon {\n          margin-right: 5px; }\n    :host div.container div.footer.open {\n      top: 0px;\n      height: 50px; }\n    :host div.container div.roles {\n      position: relative;\n      display: flex;\n      flex-direction: column;\n      flex: 1 1 auto;\n      height: 100%;\n      overflow: hidden; }\n      :host div.container div.roles div.fetching {\n        margin: 20px 0; }\n      :host div.container div.roles div.roles-list {\n        flex: 1 1 auto;\n        overflow: auto;\n        -webkit-overflow-scrolling: touch; }\n    :host div.container div.delete {\n      position: absolute;\n      right: 10px;\n      top: 38px;\n      padding: 0px 5px 0px 5px;\n      cursor: pointer; }\n    :host div.container div.delete-offline {\n      position: absolute;\n      right: 10px;\n      top: 38px;\n      padding: 0px 5px 0px 5px;\n      opacity: 0.5;\n      cursor: not-allowed; }\n    :host div.container div.overflow-ellipsis {\n      overflow: hidden;\n      text-overflow: ellipsis; }\n\n:host([animate-when-displaying]) {\n  transition: transform var(--animation-normal, 0.5s) ease-out; }\n\n:host([showing]) {\n  transform: translateY(0); }\n",""])},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(15),a=n(0),l=n(12),c=n(6),d=n(22),h=n(5),u=n(23),p=n(27),g=n(14),m=n(97),f=n(28),_=n(13),v=n(26),y=n(7),C=n(9);var w;!function(e){e[e.ASSIGN="Assign"]="ASSIGN",e[e.ASSIGN_DESCRIPTION="Assign this delegate to a user"]="ASSIGN_DESCRIPTION",e[e.RELEASE="Release"]="RELEASE",e[e.RELEASE_DESCRIPTION="Release this delegate from a user and back into the pool"]="RELEASE_DESCRIPTION",e[e.RELEASE_MESSAGE="Are you sure you wish to release this delegate account back into the pool?"]="RELEASE_MESSAGE",e[e.REQUEST="Request"]="REQUEST",e[e.SEARCH_PLACEHOLDER="Find Groups"]="SEARCH_PLACEHOLDER",e[e.TAKE="Take"]="TAKE",e[e.TITLE="Group Admin"]="TITLE",e[e.TRANSFER="Transfer"]="TRANSFER",e[e.TRANSFER_DESCRIPTION="Transfer this delegate from one user to another"]="TRANSFER_DESCRIPTION",e[e.WAITING="Waiting..."]="WAITING",e[e.ADD_ROLE="Add Group"]="ADD_ROLE",e[e.NEXT_PAGE="Next page"]="NEXT_PAGE",e[e.PREV_PAGE="Previous page"]="PREV_PAGE",e[e.CONFIRM_GROUP_DELETION_TITLE="Delete Group"]="CONFIRM_GROUP_DELETION_TITLE",e[e.CONFIRM_GROUP_DELETION_DESCRIPTION='Are you sure you want to delete the "{{groupname}}" group?']="CONFIRM_GROUP_DELETION_DESCRIPTION",e[e.FETCHING_MORE="Fetching more..."]="FETCHING_MORE",e[e.CONFIRM_CONFIG_GROUP_DELETION_TITLE="Delete remote config group?"]="CONFIRM_CONFIG_GROUP_DELETION_TITLE",e[e.CONFIRM_CONFIG_GROUP_DELETION_DESCRIPTION="Removing this group may cause users to lose their app configuration settings which could result in the loss of critical functionality. Are you sure?"]="CONFIRM_CONFIG_GROUP_DELETION_DESCRIPTION"}(w||(w={}));let b=class extends l.CTCLComponent{constructor(){super(...arguments),this._searchString="",this._canPrev=!1,this._canNext=!0,this._offset="",this.PAGE_SIZE=30,this.TILE_HEIGHT=95,this._disableLazyLoading=!1,this._nearBottom=(()=>o(this,void 0,void 0,function*(){this._loadMoreItems()})),this._atBottom=(()=>o(this,void 0,void 0,function*(){!this._disableLazyLoading&&this._canNext&&(this.isFetchingMore=!0)})),this._loadMoreItems=(()=>o(this,void 0,void 0,function*(){if(!this._disableLazyLoading&&this._canNext&&!this._alreadyFetching){this._alreadyFetching=!0,this._offset=this.groups[this.groups.length-1].name;const e={offset:this._offset,direction:"forward",page_size:""+(this.PAGE_SIZE+1),filter:this._searchString},t=yield this.layer.queryGroups(e);t.length===this.PAGE_SIZE+1?(this._canNext=!0,t.pop()):this._canNext=!1,this.groups=this.groups.concat(t),this._virtualList.addItems(t),setTimeout(()=>{this.isFetchingMore=!1},1e3),this._alreadyFetching=!1}})),this._open=(()=>o(this,void 0,void 0,function*(){this._user=yield this.layer.getCurrentUser(),this.showing=!0,yield h.sleep(this.animateWhenDisplaying?500:0),this.isFetching=!0;const e=this.shadowRoot.querySelector("#groupSearch");e&&this._searchString&&e.clear(),this._queryAndSetGroups(),this._canPrev=!1,this.isFetching=!1,this._virtualList.addScrollAtBottomListener(yield this._atBottom),this._virtualList.addScrollNearBottomListener(yield this._nearBottom),this.layer.setBackHandler(()=>this._close())})),this._close=(()=>o(this,void 0,void 0,function*(){this.emitEvent(c.ChatEvents.RefreshDelegateAccountsList),this.showing=!1,yield h.sleep(this.animateWhenDisplaying?500:0),this._virtualList.setItems([]),this.layer.popBackHandler()})),this._onSearch=((e,t)=>o(this,void 0,void 0,function*(){this.isFetching=!0,this._searchString=t;const e={filter:this._searchString,direction:"forward",page_size:""+(this.PAGE_SIZE+1)},n=yield this.layer.queryGroups(e);n.length===this.PAGE_SIZE+1?(this._canNext=!0,n.pop()):this._canNext=!1,this.groups=n,this._virtualList.setItems(this.groups),this._canPrev=!1,this._offset="",this.isFetching=!1})),this._addGroup=(()=>{this.layer.emit("open-add-group")}),this._renderItem=((e,t)=>{const n=_.buildStyles({paddingRight:"36px",fontSize:"18px"}),i=()=>{this.layer.showGroupDetailModal(e)},s=e=>o(this,void 0,void 0,function*(){yield this.layer.deleteGroup(e),this.layer.emit(c.ChatEvents.RefreshGroupAdminList,null)}),r=t=>{t.stopPropagation(),this.layer.emit(g.BaseEvents._Request_RaiseAlert,this.defaultAlerts.AlertYesNoQuestion(this.translateI18nItem(w.CONFIRM_GROUP_DELETION_TITLE),this.translateI18nItem(w.CONFIRM_GROUP_DELETION_DESCRIPTION).replace("{{groupname}}",e.name),1,{yes:()=>o(this,void 0,void 0,function*(){"#"===e.name[0]?this.layer.emit(g.BaseEvents._Request_RaiseAlert,this.defaultAlerts.AlertYesNoQuestion(this.translateI18nItem(w.CONFIRM_CONFIG_GROUP_DELETION_TITLE),this.translateI18nItem(w.CONFIRM_CONFIG_GROUP_DELETION_DESCRIPTION).replace("{{groupname}}",e.name),1,{yes:()=>o(this,void 0,void 0,function*(){yield s(e)}),no:()=>{}},!0,!1,"error")):yield s(e)}),no:()=>{}},!0))};return window.__CTRender("div",Object.assign({class:"group clickable"},t),window.__CTRender(f.CTAvatarTile,{height:`${this.TILE_HEIGHT}px`,showAvatar:!1,detailStyle:n,onClick:()=>i()},window.__CTRender(p.CTGroupAvatar,{slot:"avatar",size:40}),window.__CTRender("div",{class:"name overflow-ellipsis"},e.name),this.isOnline&&"_"!==e.name[0]&&window.__CTRender("div",{class:"delete",onClick:e=>r(e)},window.__CTRender(u.CTIcon,{width:"20",height:"20",icon:a.Icons.COMMON.CircleCross})),!this.isOnline&&"_"!==e.name[0]&&window.__CTRender("div",{class:"delete-offline"},window.__CTRender(u.CTIcon,{width:"20",height:"20",icon:a.Icons.COMMON.CircleCross}))))})}initialize(){return o(this,void 0,void 0,function*(){this._virtualList=new d.VirtualList(this,[],{itemHeight:this.TILE_HEIGHT,itemKeyGetter:e=>null===e?"":e.id}),this._virtualList.setItems([]),this.isOnline=this.layer.getConnectionStatus()===a.ConnectionStatus.Connected})}setupListeners(){this.addListener(c.ChatEvents.OpenGroupAdmin,this._open),this.addListener(c.ChatEvents.CloseGroupAdmin,this._close),this.addListener(c.ChatEvents.ConnectionStatusChange,e=>o(this,void 0,void 0,function*(){e.status===a.ConnectionStatus.Disconnected&&(this.isLoading=!1,this.isOnline=!1,this._disableLazyLoading=!0),e.status===a.ConnectionStatus.Connected&&(this.isOnline=!0,this._disableLazyLoading=!1,this._isCurrentUserAGroupAdmin()&&0===this._virtualList.items.length&&this._queryAndSetGroups(),this._virtualList.isCurrentlyAtBottom()&&this._canNext&&this._virtualList.items.length>0&&(this.isFetchingMore=!0,this._loadMoreItems()))})),this.addListener(c.ChatEvents.RefreshGroupAdminList,this._open)}_queryAndSetGroups(){return o(this,void 0,void 0,function*(){try{const e={direction:"forward",page_size:""+(this.PAGE_SIZE+1)},t=yield this.layer.queryGroups(e);t.length===this.PAGE_SIZE+1?(this._canNext=!0,t.pop()):this._canNext=!1,this.groups=t,this._virtualList.setItems(this.groups)}catch(e){if(this.isOnline&&e){const e=this.layer.translateI18nItem(y.ChatCommonMetadata.getI18nItem(y.ChatCommonI18nKeys.ERROR_QUERYING_GROUP)),t=C.getErrorMessage("E_UNKNOWN",this.layer);this.layer.error(e,t)}}})}_isCurrentUserAGroupAdmin(){return this.showing&&v.groupAdminGroup&&this._user&&this._user.group.includes(v.groupAdminGroup)||v.uberAdminGroup&&this._user&&this._user.group.includes(v.uberAdminGroup)||v.superAdminGroup&&this._user&&this._user.group.includes(v.superAdminGroup)}generateComponentMarkup(){return window.__CTRender("div",{class:"container"},window.__CTRender(p.CTCLHeader,{class:"header"},window.__CTRender("div",{slot:"left-action"},window.__CTRender(u.CTIcon,{class:"action",width:"20",height:"20",icon:a.Icons.COMMON.ChevronLeft,onClick:this._close})),window.__CTRender("div",{slot:"heading"},this.translateI18nItem(w.TITLE)),window.__CTRender("div",{slot:"right-action"},this._user&&v.groupAdminGroup&&this._user.group.includes(v.groupAdminGroup)&&window.__CTRender(u.CTIcon,{class:"action",width:"20",height:"20",icon:a.Icons.COMMON.PlusSign,onClick:this._addGroup.bind(this)}))),window.__CTRender("div",{class:"filter"},window.__CTRender(u.CTSelectionTextFilter,{enableSelection:!1,placeholder:this.translateI18nItem(w.SEARCH_PLACEHOLDER),selectionItems:[],onSearch:this._onSearch,id:"groupSearch"})),window.__CTRender("div",{class:"groups"},this._searchString.length>0&&0===this._virtualList.items.length?window.__CTRender("p",{class:"no-results"},"No groups match your search"):this._virtualList.render(this._renderItem,"groups-list","groups-content")),window.__CTRender(m.CTCLAddGroup,null),window.__CTRender("div",{class:this.isFetchingMore?"footer open":"footer"},window.__CTRender("div",{class:"fetching"},window.__CTRender(u.CTIcon,{width:"16",height:"16",icon:a.Icons.COMMON.LoadingSpinner,spin:!0}),this.translateI18nItem(w.FETCHING_MORE))))}};i([s.prop({type:Boolean,attribute:!0,default:!1})],b.prototype,"showing",void 0),i([s.prop({type:Boolean,attribute:!0,default:!0})],b.prototype,"animateWhenDisplaying",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],b.prototype,"isFetching",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],b.prototype,"isFetchingMore",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],b.prototype,"isLoading",void 0),i([s.prop({type:Array,attribute:!1,default:[]})],b.prototype,"groups",void 0),i([s.prop({type:Object,attribute:!1,default:null})],b.prototype,"selectedGroup",void 0),b=i([r.component({tag:"ctcl-group-admin",styles:[n(387)],i18nKeys:w})],b),t.CTCLGroupAdmin=b},function(e,t,n){var i=n(386);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n:host {\n  display: flex;\n  flex-direction: column;\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  background: #ffffff;\n  font-size: 1em;\n  transform: translateY(101%);\n  will-change: transform;\n  z-index: 99998; }\n  :host div.container {\n    flex-direction: column;\n    height: 100%;\n    display: flex;\n    background-color: var(--list-bg);\n    color: var(--default-font-color);\n    flex: 1 1 auto; }\n    :host div.container .header .action {\n      cursor: pointer; }\n    :host div.container .footer {\n      background: var(--secondary-color, #f2f2f2);\n      border-top: var(--secondary-border, 1px solid #dddddd);\n      padding: 10px 20px;\n      font-size: 16px; }\n      :host div.container .footer .italics {\n        font-style: italic; }\n    :host div.container div.form {\n      position: relative;\n      display: flex;\n      flex-direction: column;\n      flex: 1 1 auto;\n      height: 100%;\n      overflow: hidden;\n      padding: 10px;\n      font-size: 16px; }\n    :host div.container p.note {\n      font-size: 14px;\n      padding: 0 15px; }\n    :host div.container .italics {\n      font-style: italic; }\n    :host div.container .name,\n    :host div.container .description {\n      padding: 10px 20px;\n      color: var(--subtle-font-color, #828688);\n      background-color: #ffffff;\n      word-break: break-word;\n      font-size: 16px; }\n      :host div.container .name.form-item,\n      :host div.container .description.form-item {\n        padding: 10px 10px 5px 10px; }\n\n:host([animate-when-displaying]) {\n  transition: transform var(--animation-normal, 0.5s) ease-out; }\n\n:host([showing]) {\n  transform: translateY(0); }\n",""])},function(e,t,n){var i=n(388);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: inherit;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: flex;\n  flex-direction: column;\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  background: #ffffff;\n  font-size: 1em;\n  transform: translateY(101%);\n  will-change: transform;\n  z-index: 99998; }\n  :host div.container {\n    flex-direction: column;\n    height: 100%;\n    display: flex;\n    background-color: var(--list-bg);\n    color: var(--default-font-color);\n    flex: 1 1 auto; }\n    :host div.container .header .action {\n      cursor: pointer; }\n    :host div.container div.filter {\n      flex: 0 0 55px;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: var(--secondary-color, #f2f2f2);\n      border-bottom: var(--secondary-border, 1px solid #dddddd);\n      padding: 0 20px; }\n      :host div.container div.filter .search-box {\n        width: 80%;\n        font-size: 0.833em; }\n    :host div.container p.no-results {\n      flex: 1;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      height: 100%;\n      text-align: center;\n      padding: 55px;\n      color: var(--subtle-font-color, #828688);\n      font-size: 18px; }\n    :host div.container div.footer {\n      flex: 0 0 auto;\n      display: flex;\n      transition: top 150ms ease-in, height 150ms ease-in;\n      font-size: 1em;\n      top: 50px;\n      position: relative;\n      height: 0px;\n      justify-content: center; }\n      :host div.container div.footer .fetching {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        font-size: large;\n        height: 50px;\n        width: 100%;\n        background: var(--secondary-color, #f2f2f2);\n        border-top: var(--secondary-border, 1px solid #dddddd); }\n        :host div.container div.footer .fetching ct-icon {\n          margin-right: 5px; }\n    :host div.container div.footer.open {\n      top: 0px;\n      height: 50px; }\n    :host div.container div.groups {\n      position: relative;\n      display: flex;\n      flex-direction: column;\n      flex: 1 1 auto;\n      height: 100%;\n      overflow: hidden; }\n      :host div.container div.groups div.fetching {\n        margin: 20px 0; }\n      :host div.container div.groups div.groups-list {\n        flex: 1 1 auto;\n        overflow: auto;\n        -webkit-overflow-scrolling: touch; }\n    :host div.container div.delete {\n      position: absolute;\n      right: 10px;\n      top: 38px;\n      padding: 0px 5px 0px 5px;\n      cursor: pointer; }\n    :host div.container div.delete-offline {\n      position: absolute;\n      right: 10px;\n      top: 38px;\n      padding: 0px 5px 0px 5px;\n      opacity: 0.5;\n      cursor: not-allowed; }\n    :host div.container div.overflow-ellipsis {\n      overflow: hidden;\n      text-overflow: ellipsis; }\n\n:host([animate-when-displaying]) {\n  transition: transform var(--animation-normal, 0.5s) ease-out; }\n\n:host([showing]) {\n  transform: translateY(0); }\n",""])},function(e,t,n){var i=n(390);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: inherit;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: block;\n  flex-direction: column;\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  background: #ffffff;\n  font-size: 1em;\n  transform: translateY(101%);\n  will-change: transform;\n  z-index: 99997; }\n  :host div.container {\n    flex-direction: column;\n    height: 100%;\n    display: flex;\n    background-color: var(--list-bg);\n    color: var(--default-font-color);\n    flex: 1 1 auto; }\n    :host div.container #users-list {\n      display: flex;\n      flex: 1;\n      flex-direction: column;\n      overflow: hidden; }\n    :host div.container .header .action {\n      cursor: pointer; }\n    :host div.container div.filter {\n      flex: 0 0 55px;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: var(--secondary-color, #f2f2f2);\n      border-bottom: var(--secondary-border, 1px solid #dddddd);\n      padding: 0 20px; }\n      :host div.container div.filter .search-box {\n        width: 80%;\n        font-size: 0.833em; }\n    :host div.container p.no-results {\n      flex: 1;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      height: 100%;\n      text-align: center;\n      padding: 55px;\n      color: var(--subtle-font-color, #828688);\n      font-size: 18px; }\n    :host div.container div.users {\n      position: relative;\n      display: flex;\n      flex-direction: column;\n      flex: 1 1 auto;\n      height: 100%;\n      overflow: hidden; }\n      :host div.container div.users div.fetching {\n        margin: 20px 0; }\n      :host div.container div.users div.users-list {\n        flex: 1 1 auto;\n        overflow: auto;\n        -webkit-overflow-scrolling: touch; }\n    :host div.container div.delete {\n      position: absolute;\n      right: 10px;\n      top: 38px;\n      padding: 0px 5px 0px 5px;\n      cursor: pointer; }\n    :host div.container div.delete-offline {\n      position: absolute;\n      right: 10px;\n      top: 38px;\n      padding: 0px 5px 0px 5px;\n      opacity: 0.5;\n      cursor: not-allowed; }\n    :host div.container div.overflow-ellipsis {\n      overflow: hidden;\n      text-overflow: ellipsis; }\n    :host div.container div.footer {\n      flex: none;\n      padding: 10px; }\n      :host div.container div.footer ct-button {\n        font-size: 16px; }\n\n:host([animate-when-displaying]) {\n  transition: transform var(--animation-normal, 0.5s) ease-out; }\n\n:host([showing]) {\n  transform: translateY(0); }\n",""])},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(0),a=n(15),l=n(12),c=n(18),d=n(8),h=n(22),u=n(6),p=n(13),g=n(56),m=n(26);var f;!function(e){e[e.ROLE_DETAIL_HEADING="Role Details"]="ROLE_DETAIL_HEADING",e[e.USER_LIST_HEADER="Users who can be in this role"]="USER_LIST_HEADER",e[e.ADD_MORE_USERS="Add Users"]="ADD_MORE_USERS",e[e.SUBJECT="Subject"]="SUBJECT",e[e.GROUPS_PLACEHOLDER="Groups (optional)"]="GROUPS_PLACEHOLDER",e[e.EDIT="Edit details"]="EDIT",e[e.SAVE="Save"]="SAVE",e[e.CANCEL="Cancel"]="CANCEL",e[e.SEARCH_PLACEHOLDER="Find Users"]="SEARCH_PLACEHOLDER"}(f||(f={}));let _=class extends l.CTCLComponent{constructor(){super(...arguments),this._groups=[],this._users=[],this._existingUsers=[],this._displayName="",this._group="",this._canEditRolePermissions=!1,this.TILE_HEIGHT=95,this._onSearchChange=((e,t)=>{const n=!t||0===t.trim().length?0:250;this.debounce("search",()=>{this._virtualList.setItems(this._users.filter(e=>(e.firstName.toLowerCase()+" "+e.lastName.toLowerCase()).includes(t.toLowerCase())))},n)})}show(e,t=!0){return o(this,void 0,void 0,function*(){this.editMode=!1,this.animateModal=t,this.role=e,this.showing=!0,this._displayName=this.role.displayName,this._group=this.role.group||"",this.isLoading=!0;const n=yield this.layer.getAllGroups();this._groups=n.filter(e=>"_"!==e[0]),this._virtualList=new h.VirtualList(this,[],{itemHeight:this.TILE_HEIGHT,itemKeyGetter:e=>e.jid}),this._virtualList.setItems([]),this.defer(()=>o(this,void 0,void 0,function*(){yield this._refreshRole(),this.isLoading=!1})),m.rolePermissionManagementGroup&&this.layer.getCurrentUser().group.includes(m.rolePermissionManagementGroup)&&(this._canEditRolePermissions=!0),this.layer.setBackHandler(()=>this.dismiss())})}dismiss(e=!0){return o(this,void 0,void 0,function*(){this.animateModal=e,this.showing=!1,this._displayName="",this._group="",this.role=null,this.layer.popBackHandler()})}_close(){this.dismiss(this.animateModal)}setupListeners(){this.setupConnectionStatusListener(),this.addListener(u.ChatEvents.RefreshRole,this._refreshRole.bind(this)),this.addListener(u.ChatEvents.CloseRoleDetail,this._close.bind(this))}_refreshRole(){return o(this,void 0,void 0,function*(){try{this.role=yield this.layer.getRole({role:this.role.jid});const e=[...new Set(Object.values(this.role.permissions).flatMap(e=>e))];return this._users=yield this.layer.comms.client.getUsersByJid(e),this._users=this._users.filter(e=>{const t=e.jid?e.jid.toLowerCase():"",n=this.role.permissions.give&&!!this.role.permissions.give.find(e=>e==t),i=this.role.permissions.acquire&&!!this.role.permissions.acquire.find(e=>e==t),o=this.role.permissions.relinquish&&!!this.role.permissions.relinquish.find(e=>e==t);return n||i||o}),this._existingUsers=this._users,this._virtualList.setItems(this._users),!0}catch(e){return e.message&&e.message.toLowerCase().includes(g.ROLE_404)&&(this._close(),this.emitEvent(u.ChatEvents.RefreshRoleAdminList,null)),!1}})}get generateComponentStyles(){return n(99)}generateComponentMarkup(){if(!this.role)return;const e=m.roleAdminGroup&&this.layer.getCurrentUser().group.includes(m.roleAdminGroup);return window.__CTRender("div",{class:"role-details"},this._renderHeader(),window.__CTRender("div",{class:"content"},this._renderRoleInfo(e),!this.editMode&&window.__CTRender("div",{class:"container"},this._canEditRolePermissions&&window.__CTRender("div",{class:"heading"},window.__CTRender("div",{class:"left"},this.translateI18nItem(f.USER_LIST_HEADER)),window.__CTRender("div",{class:"right"},window.__CTRender("div",{class:"colhead"},"Give/Take"),window.__CTRender("div",{class:"colhead"},"Acquire"),window.__CTRender("div",{class:"colhead"},"Relinquish"),window.__CTRender("div",{class:"colhead"},"Remove"))),!this._canEditRolePermissions&&window.__CTRender("div",{class:"heading"},this.translateI18nItem(f.USER_LIST_HEADER)),this.isLoading?window.__CTRender(d.CTIcon,{width:"16",height:"16",icon:r.Icons.COMMON.LoadingSpinner,spin:!0}):this._renderUsers()),!this.editMode&&this._renderFooter()))}_renderHeader(){const e=this.role.displayName;return window.__CTRender(c.CTCLHeader,{class:"header"},window.__CTRender("div",{slot:"left-action"},window.__CTRender(d.CTIcon,{class:"action",width:"20",height:"20",icon:r.Icons.COMMON.ChevronLeft,onClick:this._close.bind(this)})),window.__CTRender("div",{slot:"heading"},this.translateI18nItem(f.ROLE_DETAIL_HEADING)),window.__CTRender("div",{slot:"sub-heading"},e))}_renderRoleInfo(e){if(e&&this.editMode){const e=this.layer.config.roles.maxDisplayNameLength||30;this.layer.config.roles.maxGroups,this.layer.config.roles.maxGroupLength;return window.__CTRender("div",{class:"named-info"},window.__CTRender("div",{class:"form-item subject"},window.__CTRender(d.CTTextbox,{type:"text",name:"subject",required:!0,fullBorder:!0,defaultValue:this.role.displayName,placeholder:"Display name",callback:e=>this._onChangeDisplayName(e),max:e})),window.__CTRender("p",{class:"note"},window.__CTRender("strong",null,"Please Note:")," Changes to a role's name won't be available within the ",window.__CTRender("span",{class:"italics"},"accounts menu")," or ",window.__CTRender("span",{class:"italics"},"role assignment")," until a contact directory sync occurs. This may be between 1-24 hours."),window.__CTRender("div",{class:"buttons"},window.__CTRender(d.CTButton,{class:"button",type:"primary",width:"auto",disabled:this.saveDisabled||!this.isOnline,onClick:this._saveChanges.bind(this)},this.translateI18nItem(f.SAVE)),window.__CTRender(d.CTButton,{class:"button",type:"secondary",width:"auto",disabled:!this.isOnline,onClick:this._cancelChanges.bind(this)},this.translateI18nItem(f.CANCEL))))}return window.__CTRender("div",{class:"named-info"},window.__CTRender("div",{class:"subject"},this.role.displayName),e&&window.__CTRender("div",{class:"buttons"},window.__CTRender(d.CTButton,{class:"button",type:"secondary",width:"auto",disabled:!this.isOnline,onClick:this._enterEditMode.bind(this)},this.translateI18nItem(f.EDIT))))}_renderUsers(){return p.renderIfElse(this._users.length>0,window.__CTRender("div",{class:"users"},this.allowSearch&&window.__CTRender("div",{class:"search"},window.__CTRender(d.CTSelectionTextFilter,{placeholder:this.translateI18nItem(f.SEARCH_PLACEHOLDER),onSearch:this._onSearchChange,enableSelection:!1})),this._virtualList.render(this._renderItem.bind(this),"user-list","user-list-content")),window.__CTRender("div",{class:"no-users"},"No users have been added to this role"))}_showContactInfo(e){this.layer.showContactInfoForJid(e.jid)}_renderItem(e,t){const n=e.jid?e.jid.toLowerCase():"",i=this.role.permissions.give&&!!this.role.permissions.give.find(e=>e==n),o=this.role.permissions.acquire&&!!this.role.permissions.acquire.find(e=>e==n),s=this.role.permissions.relinquish&&!!this.role.permissions.relinquish.find(e=>e==n);return window.__CTRender("div",Object.assign({class:"user"},t),this._canEditRolePermissions&&window.__CTRender(d.CTRolePermissionsUserTile,{role:this.role,giveTake:i,acquire:o,relinquish:s,user:e,height:`${this.TILE_HEIGHT}px`,onRoleDoesNotExist:()=>{this._close(),this.emitEvent(u.ChatEvents.RefreshRoleAdminList,null)}}),!this._canEditRolePermissions&&window.__CTRender(d.CTUserTile,{user:e,height:`${this.TILE_HEIGHT}px`,onClick:()=>this._showContactInfo(e),showJobTitle:!1,showGroups:!1}))}_renderFooter(){return this._canEditRolePermissions&&window.__CTRender("div",{class:"footer"},window.__CTRender(d.CTButton,{type:"secondary",width:"auto",disabled:!this.isOnline,onClick:this._addContacts.bind(this)},this.translateI18nItem(f.ADD_MORE_USERS)))}_enterEditMode(){return o(this,void 0,void 0,function*(){yield this._refreshRole(),this.saveDisabled=!1,this.editMode=!0})}_onChangeDisplayName(e){const t=e.value?e.value.trim():"";this.saveDisabled=0===t.length,this._displayName=t}_saveChanges(){return o(this,void 0,void 0,function*(){if(!this.saveDisabled)try{const e={jid:this.role.jid,displayName:this._displayName,group:this._group};(yield this.layer.modifyRole(e))&&(this.role.displayName=this._displayName,this.role.group=this._group,this.editMode=!1,this.layer.emit(u.ChatEvents.RefreshRoleAdminList,null))}catch(e){return void(e.message&&e.message.toLowerCase().includes(g.ROLE_404)&&(this._close(),this.emitEvent(u.ChatEvents.RefreshRoleAdminList,null)))}})}_cancelChanges(){this._displayName=this.role.displayName,this._group=this.role.group,this.editMode=!1}_addContacts(){return o(this,void 0,void 0,function*(){(yield this._refreshRole())&&this.layer.showAddRoleUsersModal(this.role,!0,this._existingUsers)})}};i([s.prop({type:Object,attribute:!1,default:null})],_.prototype,"role",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],_.prototype,"showing",void 0),i([s.prop({type:Boolean,attribute:!0,default:!0})],_.prototype,"animateModal",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],_.prototype,"editMode",void 0),i([s.prop({type:Boolean,attribute:!1,default:!0})],_.prototype,"saveDisabled",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],_.prototype,"isLoading",void 0),i([s.prop({type:Boolean,attribute:!1,default:!0})],_.prototype,"allowSearch",void 0),_=i([a.component({tag:"ct-cl-role-detail-modal",styles:[n(99)],i18nKeys:f})],_),t.CTCLRoleDetailModal=_},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,'/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n:host {\n  display: flex;\n  flex-direction: column;\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  background: #ffffff;\n  font-size: 1em;\n  transform: translateY(101%);\n  will-change: transform;\n  z-index: 99998; }\n  :host .role-details {\n    flex: 1 1 auto;\n    display: flex;\n    flex-direction: column;\n    height: 100%; }\n    :host .role-details .heading {\n      display: flex; }\n      :host .role-details .heading .left {\n        flex: 2 0; }\n      :host .role-details .heading .right {\n        display: flex;\n        width: 280px; }\n        :host .role-details .heading .right .colhead {\n          width: 70px;\n          text-align: center; }\n    :host .role-details .role {\n      flex: none;\n      background: var(--dark-header-bg, #212121);\n      color: var(--dark-header-text, #f2f2f2);\n      padding: 7px 20px;\n      z-index: 9999; }\n    :host .role-details .content {\n      flex: 1 1 auto;\n      display: flex;\n      flex-direction: column;\n      height: 80%; }\n      :host .role-details .content .named-info {\n        flex: none; }\n        :host .role-details .content .named-info .subject,\n        :host .role-details .content .named-info .description {\n          padding: 10px 20px;\n          color: var(--subtle-font-color, #828688);\n          background-color: #ffffff;\n          word-break: break-word;\n          font-size: 16px; }\n          :host .role-details .content .named-info .subject.form-item,\n          :host .role-details .content .named-info .description.form-item {\n            padding: 10px 10px 5px 10px; }\n        :host .role-details .content .named-info .description,\n        :host .role-details .content .named-info .buttons {\n          border-top: 1px solid var(--light-header-bg, #f2f2f2); }\n        :host .role-details .content .named-info .note {\n          font-size: 14px;\n          padding: 0 15px; }\n        :host .role-details .content .named-info .italics {\n          font-style: italic; }\n        :host .role-details .content .named-info .buttons {\n          display: flex;\n          justify-content: center;\n          padding: 10px; }\n          :host .role-details .content .named-info .buttons .button + .button {\n            margin: 0 0 0 10px; }\n      :host .role-details .content .container {\n        flex: 1;\n        display: flex;\n        flex-direction: column;\n        overflow: hidden; }\n        :host .role-details .content .container .heading {\n          flex: none;\n          background: var(--light-header-bg, #f2f2f2);\n          color: var(--light-header-text, #828688);\n          font-size: 0.833em;\n          font-weight: 600;\n          text-transform: uppercase;\n          padding: 7px 10px 7px 10px; }\n        :host .role-details .content .container ct-icon {\n          margin-top: 20px; }\n        :host .role-details .content .container .no-users {\n          font-size: 14px;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          color: var(--subtle-font-color, #828688);\n          height: 100%; }\n        :host .role-details .content .container .search {\n          flex: 0 0 55px;\n          display: flex;\n          padding: 0 20px;\n          justify-content: center;\n          align-items: center;\n          background: var(--secondary-color, #f2f2f2);\n          border-bottom: var(--secondary-border, 1px solid #dddddd); }\n          :host .role-details .content .container .search .search-box {\n            width: 75%;\n            font-size: 0.833em; }\n          :host .role-details .content .container .search .fields {\n            margin-top: 10px; }\n          :host .role-details .content .container .search input[type="radio"] {\n            display: none; }\n          :host .role-details .content .container .search input[type="radio"]:checked + span {\n            font-weight: bold;\n            color: var(--primary-color, #22b1c8); }\n          :host .role-details .content .container .search label {\n            border-right: solid 1px #E1E1E1;\n            padding: 0 10px;\n            color: #999999;\n            font-size: 14px; }\n          :host .role-details .content .container .search label:first-child {\n            color: #CCCCCC; }\n          :host .role-details .content .container .search label:first-child, :host .role-details .content .container .search label:last-child {\n            border-right: none; }\n        :host .role-details .content .container .users {\n          position: relative;\n          display: flex;\n          flex-direction: column;\n          height: 100%;\n          overflow: hidden; }\n          :host .role-details .content .container .users .user-list {\n            flex: 1 1 auto;\n            overflow: auto;\n            -webkit-overflow-scrolling: touch; }\n      :host .role-details .content .footer {\n        flex: none;\n        padding: 10px;\n        text-align: center;\n        border-top: var(--secondary-border, 1px solid #dddddd);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: 10px 20px; }\n\n:host([animate-modal]) {\n  transition: transform var(--animation-normal, 0.5s) ease-out; }\n\n:host([showing]) {\n  transform: translateY(0); }\n\n@media screen and (max-width: 960px) {\n  :host .role-details .heading .right {\n    display: none; } }\n',""])},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(0),a=n(15),l=n(12),c=n(18),d=n(8),h=n(22),u=n(6),p=n(13),g=n(57),m=n(14),f=n(20),_=n(26),v=n(49),y=n(5);var C;!function(e){e[e.GROUP_DETAIL_HEADING="Group Details"]="GROUP_DETAIL_HEADING",e[e.USER_LIST_HEADER="Members of this group"]="USER_LIST_HEADER",e[e.ADD_MORE_USERS="Add Members"]="ADD_MORE_USERS",e[e.SUBJECT="Subject"]="SUBJECT",e[e.GROUPS_PLACEHOLDER="Groups (optional)"]="GROUPS_PLACEHOLDER",e[e.EDIT="Edit details"]="EDIT",e[e.SAVE="Save"]="SAVE",e[e.CANCEL="Cancel"]="CANCEL",e[e.SEARCH_PLACEHOLDER="Find Members"]="SEARCH_PLACEHOLDER",e[e.CONFIRM_REMOVE_MEMBER="Remove this member from this group?"]="CONFIRM_REMOVE_MEMBER",e[e.INVALID_GROUP_NAME_TITLE="Invalid Group Name"]="INVALID_GROUP_NAME_TITLE",e[e.UNDERSCORE_PREFIX_ERROR_DESCRIPTION='A group name cannot start with "_"']="UNDERSCORE_PREFIX_ERROR_DESCRIPTION",e[e.COMMA_ERROR_DESCRIPTION='A group name cannot contain ","']="COMMA_ERROR_DESCRIPTION"}(C||(C={}));let w=class extends l.CTCLComponent{constructor(){super(...arguments),this._users=[],this._groupChildren=[],this._listItems=[],this._name="",this._description="",this._groupMembers=[],this._isHashGroup=!1,this.TILE_HEIGHT=95,this._onSearchChange=((e,t)=>{const n=!t||0===t.trim().length?0:250;this._grouDetailsSearchFilter=e,this._grouDetailsSearchTerm=t,this.debounce("search",()=>{this._listItems=[...this._users.filter(e=>(e.firstName.toLowerCase()+" "+e.lastName.toLowerCase()).includes(t.toLowerCase())),...this._groupChildren.filter(e=>e.name.toLowerCase().includes(t.toLowerCase()))],this._sortListItems(),this._virtualList.setItems(this._listItems)},n)})}show(e,t=!0){return o(this,void 0,void 0,function*(){this.editMode=!1,this.animateModal=t,this.group=e,this.showing=!0,this._name=this.group.name,this._isHashGroup=this._name&&"#"===this._name[0],this._description=this.group.description,this.isLoading=!0,this._grouDetailsSearchFilter="",this._grouDetailsSearchTerm="",this._virtualList=new h.VirtualList(this,[],{itemHeight:this.TILE_HEIGHT,itemKeyGetter:e=>""}),this._virtualList.setItems([]),this._user=yield this.layer.getCurrentUser(),this.defer(()=>o(this,void 0,void 0,function*(){yield this._refreshGroup(),this.isLoading=!1})),this.layer.setBackHandler(()=>this.dismiss())})}dismiss(e=!0){return o(this,void 0,void 0,function*(){this.animateModal=e,this.showing=!1,this._name="",this._description="",this._groupMembers=[],this.group=null})}_close(){this.dismiss(this.animateModal),this.layer.popBackHandler()}setupListeners(){this.setupConnectionStatusListener(),this.addListener(u.ChatEvents.RefreshGroup,this._refreshGroup.bind(this)),this.addListener(u.ChatEvents.CloseGroupDetail,this._close.bind(this))}_refreshGroup(){return o(this,void 0,void 0,function*(){try{if(this.group=yield this.layer.getGroup({id:this.group.id}),this._name=this.group.name,this._isHashGroup=this._name&&"#"===this._name[0],this._description=this.group.description,this._groupMembers=yield this.layer.queryGroupMembers(this.group),this._users=yield this.layer.comms.client.getUsersByJid([...this._groupMembers.map(e=>e.jid)]),this._groupChildren=void 0!==this.group.subgroups?this.group.subgroups:[],this._listItems=[...this._users,...this._groupChildren],this._sortListItems(),0===this._listItems.length&&this._grouDetailsSearchTerm&&(this._grouDetailsSearchTerm="",this._grouDetailsSearchFilter=""),this._grouDetailsSearchTerm){this.shadowRoot.getElementById("groupDetailSelectionTextFilter").onSearch(this._grouDetailsSearchFilter,this._grouDetailsSearchTerm)}else this._virtualList.setItems(this._listItems);return!0}catch(e){return e.message&&e.message.toLowerCase().includes(g.GROUP_404)&&(this._close(),this.emitEvent(u.ChatEvents.RefreshGroupAdminList,null)),!1}})}get generateComponentStyles(){return n(100)}generateComponentMarkup(){if(!this.group||!this.group.name)return;const e=0!==this.group.name.indexOf("_")&&_.groupAdminGroup&&this.layer.getCurrentUser().group.includes(_.groupAdminGroup);return window.__CTRender("div",{class:"group-details"},this._renderHeader(),window.__CTRender("div",{class:"content"},this._renderGroupInfo(e),!this.editMode&&window.__CTRender("div",{class:"container"},this._isHashGroup&&window.__CTRender("div",{class:"info"},window.__CTRender("div",{class:"icon"},window.__CTRender(d.CTIcon,{width:"20",height:"20",icon:r.Icons.COMMON.Info})),window.__CTRender("p",null,"Groups starting with '#' are reserved for remote config groups. Users within this group may receive app configuration settings which affect critical functionality. Users shouldnt be in more than one remote config group.")),window.__CTRender("div",{class:"heading"},this.translateI18nItem(C.USER_LIST_HEADER)),this.isLoading?window.__CTRender(d.CTIcon,{width:"16",height:"16",icon:r.Icons.COMMON.LoadingSpinner,spin:!0}):this._renderUsers()),!this.editMode&&this._renderFooter()))}_renderHeader(){const e=this.group.name;return window.__CTRender(c.CTCLHeader,{class:"header"},window.__CTRender("div",{slot:"left-action"},window.__CTRender(d.CTIcon,{class:"action",width:"20",height:"20",icon:r.Icons.COMMON.ChevronLeft,onClick:this._close.bind(this)})),window.__CTRender("div",{slot:"heading"},this.translateI18nItem(C.GROUP_DETAIL_HEADING)),window.__CTRender("div",{slot:"sub-heading"},e))}_renderGroupInfo(e){if(e&&this.editMode){const e=this.layer.config.groups.maxNameLength||30,t=this.layer.config.groups.maxDescriptionLength||120;return window.__CTRender("div",{class:"named-info"},window.__CTRender("div",{class:"form-item name"},window.__CTRender(d.CTTextbox,{type:"text",name:"name",required:!0,fullBorder:!0,defaultValue:this.group.name,placeholder:"Name",callback:e=>this._onChangeName(e),max:e})),window.__CTRender("div",{class:"form-item description"},window.__CTRender(d.CTTextbox,{type:"text",name:"description",fullBorder:!0,defaultValue:this.group.description,placeholder:"Description",callback:e=>this._onChangeDescription(e),max:t})),window.__CTRender("div",{class:"buttons"},window.__CTRender(d.CTButton,{class:"button",type:"primary",width:"auto",disabled:this.saveDisabled||!this.isOnline,onClick:this._saveChanges.bind(this)},this.translateI18nItem(C.SAVE)),window.__CTRender(d.CTButton,{class:"button",type:"secondary",width:"auto",disabled:!this.isOnline,onClick:this._cancelChanges.bind(this)},this.translateI18nItem(C.CANCEL))))}return window.__CTRender("div",{class:"named-info"},window.__CTRender("div",{class:"name"},this.group.name),this.group.description&&window.__CTRender("div",{class:"description"},this.group.description),e&&window.__CTRender("div",{class:"buttons"},window.__CTRender(d.CTButton,{class:"button",type:"secondary",width:"auto",disabled:!this.isOnline,onClick:this._enterEditMode.bind(this)},this.translateI18nItem(C.EDIT))))}_renderUsers(){return p.renderIfElse(this._users.length+this._groupChildren.length>0,window.__CTRender("div",{class:"users"},this.allowSearch&&window.__CTRender("div",{class:"search"},window.__CTRender(d.CTSelectionTextFilter,{id:"groupDetailSelectionTextFilter",placeholder:this.translateI18nItem(C.SEARCH_PLACEHOLDER),onSearch:this._onSearchChange,enableSelection:!1})),this._virtualList.render(this._renderItem.bind(this),"user-list","user-list-content")),window.__CTRender("div",{class:"no-members"},"No members have been added to this group"))}_showContactInfo(e){this.layer.showContactInfoForJid(e.jid)}_showGroupInfo(e){}_renderItem(e,t){const n=t=>{t.stopPropagation(),this.layer.emit(m.BaseEvents._Request_RaiseAlert,this.defaultAlerts.AlertYesNoQuestion(this.translateI18nItem(f.CommonMetadata.getI18nItem(f.CommonI18nKeys.ARE_YOU_SURE)),this.translateI18nItem(C.CONFIRM_REMOVE_MEMBER),1,{yes:()=>o(this,void 0,void 0,function*(){e.jid?this.layer.removeGroupMembers(this.group,[e.jid]):this.layer.removeGroupChildren(this.group,[e.id]),this._refreshGroup()}),no:()=>{}},!0))};return window.__CTRender("div",Object.assign({class:"user"},t),e.jid&&window.__CTRender(d.CTUserTile,{user:e,height:`${this.TILE_HEIGHT}px`,onClick:()=>this._showContactInfo(e),showJobTitle:!1,showGroups:!1})||window.__CTRender(v.CTGroupTile,{group:e,height:`${this.TILE_HEIGHT}px`,onClick:()=>this._showGroupInfo(e),hideMemberCount:!0}),this._user&&_.groupAdminGroup&&this._user.group.includes(_.groupAdminGroup)&&window.__CTRender("div",{class:"delete",onClick:e=>n(e)},window.__CTRender(d.CTIcon,{width:"20",height:"20",icon:r.Icons.COMMON.CircleCross})))}_renderFooter(){return window.__CTRender("div",{class:"footer"},window.__CTRender(d.CTButton,{type:"secondary",width:"auto",disabled:!this.isOnline,onClick:this._addContacts.bind(this)},this.translateI18nItem(C.ADD_MORE_USERS)))}_enterEditMode(){return o(this,void 0,void 0,function*(){yield this._refreshGroup(),this.saveDisabled=!1,this.editMode=!0})}_onChangeDescription(e){const t=e.value?e.value.trim():"";this._description=t}_onChangeName(e){const t=e.value?e.value.trim():"";this.saveDisabled=0===t.length,this._name=t}_saveChanges(){return o(this,void 0,void 0,function*(){if(!this.saveDisabled)if("_"!==this._name.charAt(0))if(-1===this._name.indexOf(","))if(this._isHashGroup&&"#"!==this._name.charAt(0))this.layer.error(this.translateI18nItem(C.INVALID_GROUP_NAME_TITLE),"You cannot remove the '#' from the name of a remote config group.");else if(this._isHashGroup||"#"!==this._name.charAt(0))try{const e={id:this.group.id,name:this._name,description:this._description};(yield this.layer.updateGroup(e))&&(this.group.name=this._name,this.group.description=this._description,this.editMode=!1),this.layer.emit(u.ChatEvents.RefreshGroupAdminList,null)}catch(e){return void(e.message&&e.message.toLowerCase().includes(g.GROUP_404)&&this._close())}else this.layer.error(this.translateI18nItem(C.INVALID_GROUP_NAME_TITLE),"You cannot add '#' to the start of an existing group name.");else this.layer.error(this.translateI18nItem(C.INVALID_GROUP_NAME_TITLE),this.translateI18nItem(C.COMMA_ERROR_DESCRIPTION));else this.layer.error(this.translateI18nItem(C.INVALID_GROUP_NAME_TITLE),this.translateI18nItem(C.UNDERSCORE_PREFIX_ERROR_DESCRIPTION))})}_cancelChanges(){this._name=this.group.name,this._description=this.group.description,this.editMode=!1}_addContacts(){return o(this,void 0,void 0,function*(){(yield this._refreshGroup())&&this.layer.showAddGroupUsersModal(this.group,this._groupMembers)})}_sortListItems(){this._listItems=y.deepCloneArray(this._listItems).sort((e,t)=>{if(e.subgroups||t.subgroups)return 1;const n=e.lastName||"",i=t.lastName||"",o=n.localeCompare(i);if(0!==o)return o;const s=e.firstName||"",r=t.firstName||"";return s.localeCompare(r)}),this._listItems=y.deepCloneArray(this._listItems).sort((e,t)=>{let n,i;return n=e.jid?e.firstName||"":e.name||"",i=t.jid?t.firstName||"":t.name||"",n.localeCompare(i)})}};i([s.prop({type:Object,attribute:!1,default:null})],w.prototype,"group",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],w.prototype,"showing",void 0),i([s.prop({type:Boolean,attribute:!0,default:!0})],w.prototype,"animateModal",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],w.prototype,"editMode",void 0),i([s.prop({type:Boolean,attribute:!1,default:!0})],w.prototype,"saveDisabled",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],w.prototype,"isLoading",void 0),i([s.prop({type:Boolean,attribute:!1,default:!0})],w.prototype,"allowSearch",void 0),w=i([a.component({tag:"ct-cl-group-detail-modal",styles:[n(100)],i18nKeys:C})],w),t.CTCLGroupDetailModal=w},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,'/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n:host {\n  display: flex;\n  flex-direction: column;\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  background: #ffffff;\n  font-size: 1em;\n  transform: translateY(101%);\n  will-change: transform;\n  z-index: 99998; }\n  :host .group-details {\n    flex: 1 1 auto;\n    display: flex;\n    flex-direction: column;\n    height: 100%; }\n    :host .group-details .heading {\n      display: flex; }\n      :host .group-details .heading .left {\n        flex: 2 0; }\n      :host .group-details .heading .right {\n        display: flex; }\n        :host .group-details .heading .right .colhead {\n          width: 70px;\n          text-align: center; }\n    :host .group-details .group {\n      flex: none;\n      background: var(--dark-header-bg, #212121);\n      color: var(--dark-header-text, #f2f2f2);\n      padding: 7px 20px;\n      z-index: 9999; }\n    :host .group-details .content {\n      flex: 1 1 auto;\n      display: flex;\n      flex-direction: column;\n      height: 80%; }\n      :host .group-details .content .named-info {\n        flex: none; }\n        :host .group-details .content .named-info .name,\n        :host .group-details .content .named-info .description {\n          padding: 10px 20px;\n          color: var(--subtle-font-color, #828688);\n          background-color: #ffffff;\n          word-break: break-word;\n          font-size: 16px; }\n          :host .group-details .content .named-info .name.form-item,\n          :host .group-details .content .named-info .description.form-item {\n            padding: 10px 10px 5px 10px; }\n        :host .group-details .content .named-info .description,\n        :host .group-details .content .named-info .buttons {\n          border-top: 1px solid var(--light-header-bg, #f2f2f2); }\n        :host .group-details .content .named-info .note {\n          font-size: 14px;\n          padding: 0 15px; }\n        :host .group-details .content .named-info .italics {\n          font-style: italic; }\n        :host .group-details .content .named-info .buttons {\n          display: flex;\n          justify-content: center;\n          padding: 10px; }\n          :host .group-details .content .named-info .buttons .button + .button {\n            margin: 0 0 0 10px; }\n      :host .group-details .content .container {\n        flex: 1 1 auto;\n        height: 100%;\n        display: flex;\n        flex-direction: column;\n        overflow: hidden; }\n        :host .group-details .content .container .info {\n          font-size: 14px;\n          padding: 0 15px;\n          background: var(--light-header-bg, #f2f2f2);\n          color: var(--light-header-text, #828688);\n          border-radius: 5px;\n          margin: 10px;\n          padding: 10px; }\n          :host .group-details .content .container .info .icon {\n            display: inline-block;\n            height: 20px;\n            width: 20px;\n            vertical-align: middle; }\n          :host .group-details .content .container .info p {\n            margin: 0 0 0 10px;\n            display: inline-block;\n            width: calc(100% - 30px);\n            vertical-align: middle; }\n        :host .group-details .content .container .heading {\n          flex: none;\n          background: var(--light-header-bg, #f2f2f2);\n          color: var(--light-header-text, #828688);\n          font-size: 0.833em;\n          font-weight: 600;\n          text-transform: uppercase;\n          padding: 7px 10px 7px 10px; }\n        :host .group-details .content .container .no-members {\n          font-size: 14px;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          color: var(--subtle-font-color, #828688);\n          height: 100%; }\n        :host .group-details .content .container .search {\n          flex: 0 0 55px;\n          display: flex;\n          padding: 0 20px;\n          justify-content: center;\n          align-items: center;\n          background: var(--secondary-color, #f2f2f2);\n          border-bottom: var(--secondary-border, 1px solid #dddddd); }\n          :host .group-details .content .container .search .search-box {\n            width: 75%;\n            font-size: 0.833em; }\n          :host .group-details .content .container .search .fields {\n            margin-top: 10px; }\n          :host .group-details .content .container .search input[type="radio"] {\n            display: none; }\n          :host .group-details .content .container .search input[type="radio"]:checked + span {\n            font-weight: bold;\n            color: var(--primary-color, #22b1c8); }\n          :host .group-details .content .container .search label {\n            border-right: solid 1px #E1E1E1;\n            padding: 0 10px;\n            color: #999999;\n            font-size: 14px; }\n          :host .group-details .content .container .search label:first-child {\n            color: #CCCCCC; }\n          :host .group-details .content .container .search label:first-child, :host .group-details .content .container .search label:last-child {\n            border-right: none; }\n        :host .group-details .content .container .users {\n          position: relative;\n          display: flex;\n          flex-direction: column;\n          flex: 1 1 auto;\n          height: 100%;\n          overflow: hidden; }\n          :host .group-details .content .container .users .user-list {\n            flex: 1 1 auto;\n            overflow: auto;\n            -webkit-overflow-scrolling: touch; }\n        :host .group-details .content .container div.delete {\n          position: absolute;\n          right: 10px;\n          top: 38px;\n          padding: 0px 5px 0px 5px;\n          cursor: pointer; }\n      :host .group-details .content .footer {\n        flex: none;\n        padding: 10px;\n        text-align: center;\n        border-top: var(--secondary-border, 1px solid #dddddd);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: 10px 20px; }\n\n:host([animate-modal]) {\n  transition: transform var(--animation-normal, 0.5s) ease-out; }\n\n:host([showing]) {\n  transform: translateY(0); }\n\n@media screen and (max-width: 960px) {\n  :host .group-details .heading .right {\n    display: none; } }\n',""])},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(0),a=n(15),l=n(12),c=n(18),d=n(8),h=n(5),u=n(6),p=n(14),g=n(56),m=n(26),f=n(37);var _;!function(e){e[e.ROLE_DETAIL_HEADING="Add Users"]="ROLE_DETAIL_HEADING",e[e.CHOOSE_USER="Choose users to add to role"]="CHOOSE_USER",e[e.SEARCH_PLACEHOLDER="Find Users"]="SEARCH_PLACEHOLDER",e[e.INITIAL_MESSAGE="Find users using the search bar above"]="INITIAL_MESSAGE",e[e.ADD="Add"]="ADD",e[e.ERROR_SETTING_PERMISSIONS_TITTLE="Failed to Set Permissions"]="ERROR_SETTING_PERMISSIONS_TITTLE",e[e.ERROR_SETTING_PERMISSIONS_DESCRIPTION="There was a problem in setting permissions for a user."]="ERROR_SETTING_PERMISSIONS_DESCRIPTION",e[e.ERROR_SETTING_PERMISSIONS_ROLE="The group you are trying to add contains a role, cannot add a role to a role."]="ERROR_SETTING_PERMISSIONS_ROLE"}(_||(_={}));let v=class extends l.CTCLComponent{constructor(){super(...arguments),this._users=[],this._existingUsers=[],this._groupUsers=[]}show(e,t=!0,n){return o(this,void 0,void 0,function*(){this._existingJids=[],this.editMode=!1,this.animateModal=t,this.role=e,this.showing=!0,this.isLoading=!0,this._existingUsers=n,this._existingUsers.forEach(e=>{this._existingJids.push(e.jid)}),this.defer(()=>o(this,void 0,void 0,function*(){const e=this.role.permissions.give?this.role.permissions.give.flatMap(e=>e):[],t=this.role.permissions.take?this.role.permissions.take.flatMap(e=>e):[],n=this.role.permissions.acquire?this.role.permissions.acquire.flatMap(e=>e):[],i=this.role.permissions.relinquish?this.role.permissions.relinquish.flatMap(e=>e):[],o=[...new Set([...e,...t,...n,...i])];this._users=yield this.layer.comms.client.getUsersByJid(o),this._groupUsers=yield this.layer.getAllUsersInGroup(m.roleAssignmentGroup),this.isLoading=!1})),this.layer.setBackHandler(()=>this.dismiss())})}dismiss(e=!0){return o(this,void 0,void 0,function*(){this.animateModal=e,this.showing=!1,this.layer.popBackHandler()})}_close(){this.dismiss(this.animateModal)}setupListeners(){this.setupConnectionStatusListener()}get generateComponentStyles(){return n(101)}generateComponentMarkup(){const e=this._users.map(e=>e.jid.toLowerCase()),t=(this._groupUsers.map(e=>e.jid.toLowerCase()),{excludeUsers:[...e],currentRole:this.role&&this.role.jid,allowSearch:!0,requireSearch:!0,searchPlaceholder:this.translateI18nItem(_.SEARCH_PLACEHOLDER),initialMessage:this.translateI18nItem(_.INITIAL_MESSAGE),allowSelection:!0,noRoles:!0,inRoleAdminUI:!0,maxSelections:this.layer.config.roles.maxUsersToRoleInOneRequest||25,onChangeSelection:e=>{this.selectedUserCount=e.length},onClickUser:e=>{this.layer.showContactInfo(e,null,!1)},onClickGroup:e=>this.layer.showRoleUsersModal(e)});return window.__CTRender("div",{class:"add-role-users"},this._renderHeader(),window.__CTRender("div",{class:"user-list"},window.__CTRender(f.CTUserList,Object.assign({id:"user-list"},t))),this._renderFooter())}_renderHeader(){return window.__CTRender(c.CTCLHeader,{class:"header"},window.__CTRender("div",{slot:"left-action"},window.__CTRender(d.CTIcon,{class:"action",width:"20",height:"20",icon:r.Icons.COMMON.ChevronLeft,onClick:this._back.bind(this)})),window.__CTRender("div",{slot:"heading"},this.translateI18nItem(_.ROLE_DETAIL_HEADING)),window.__CTRender("div",{slot:"sub-heading"},"Add up to ",this.layer.config.roles.maxUsersToRoleInOneRequest||25," at once. Currently ",this.selectedUserCount," selected."))}_renderFooter(){return window.__CTRender("div",{class:"footer"},window.__CTRender(d.CTButton,{type:"primary",class:"button",disabled:!this.isOnline||0===this.selectedUserCount,onClick:this._add.bind(this)},this.translateI18nItem(_.ADD)))}_back(){return o(this,void 0,void 0,function*(){yield this._clearSelectedUsers(),yield this._clearFilter(),this._close()})}_alertUserOnPermissionsError(e){this.layer.emit(p.BaseEvents._Request_RaiseAlert,this.defaultAlerts.AlertErrorWithOkayButton(this.translateI18nItem(_.ERROR_SETTING_PERMISSIONS_TITTLE),e,1,{okay:()=>{}}))}_add(){return o(this,void 0,void 0,function*(){this.usersAdditionOccuring=!0;try{yield this.layer.getRole({role:this.role.jid})}catch(e){return void(e.message&&e.message.toLowerCase().includes(g.ROLE_404)&&(this._back(),this.emitEvent(u.ChatEvents.RefreshRoleAdminList,null),this.emitEvent(u.ChatEvents.CloseRoleDetail,null)))}const e=(yield this._getSelectedUsers()).filter(e=>this.role.jid!==e.jid).filter(e=>!e.is_role);let t=e;if(!t.length)return void this._alertUserOnPermissionsError(this.translateI18nItem(_.ERROR_SETTING_PERMISSIONS_ROLE));this._existingUsers.length&&this._existingJids.length&&(t=e.filter(e=>!this._existingJids.includes(e.jid))),!t.length||(yield this.layer.addRolePermissionsToUsers(this.role,t))||this._alertUserOnPermissionsError(this.translateI18nItem(_.ERROR_SETTING_PERMISSIONS_DESCRIPTION)),this._back(),this.layer.emit(u.ChatEvents.RefreshRoleAdminList,null),this.layer.emit(u.ChatEvents.RefreshRole,null)})}_getSelectedUsers(){return o(this,void 0,void 0,function*(){const e=this.shadowRoot.querySelector("#user-list");if(!e)return[];const t=yield e.getSelections(),n=t.filter(e=>e.isUser),i=t.filter(e=>e.isGroup),o=[...new Set([...i.map(e=>e.groupUsers).flatMap(e=>e),...n.map(e=>e.transformToBaseUser())])];return h.sortUsersByName(o)})}_clearSelectedUsers(){return o(this,void 0,void 0,function*(){const e=this.shadowRoot.querySelector("#user-list");e&&(yield e.clearSelections())})}_clearFilter(){return o(this,void 0,void 0,function*(){const e=this.shadowRoot.querySelector("#user-list");e&&(yield e.clearFilter())})}};i([s.prop({type:s.NullableNumber,attribute:!0,default:null})],v.prototype,"showCountFrom",void 0),i([s.prop({type:Object,attribute:!1,default:null})],v.prototype,"role",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],v.prototype,"showing",void 0),i([s.prop({type:Boolean,attribute:!0,default:!0})],v.prototype,"animateModal",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],v.prototype,"editMode",void 0),i([s.prop({type:Boolean,attribute:!1,default:!0})],v.prototype,"saveDisabled",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],v.prototype,"isLoading",void 0),i([s.prop({type:Number,attribute:!1,default:0})],v.prototype,"selectedUserCount",void 0),i([s.prop({type:Object,attribute:!1,default:!1})],v.prototype,"usersAdditionOccuring",void 0),v=i([a.component({tag:"ct-cl-add-role-users-modal",styles:[n(101)],i18nKeys:_})],v),t.CTCLAddRoleUsersModal=v},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n:host {\n  display: flex;\n  flex-direction: column;\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  background: #ffffff;\n  font-size: 1em;\n  transform: translateY(101%);\n  will-change: transform;\n  z-index: 99998; }\n  :host .add-role-users {\n    flex: 1 1 auto;\n    display: flex;\n    flex-direction: column;\n    height: 100%; }\n    :host .add-role-users .header .action {\n      cursor: pointer; }\n    :host .add-role-users .content {\n      flex: 1 1 auto;\n      display: flex;\n      flex-direction: column; }\n    :host .add-role-users .footer {\n      flex: none;\n      padding: 10px;\n      text-align: center; }\n    :host .add-role-users .user-list {\n      flex: 1 1 auto;\n      display: flex;\n      flex-direction: column;\n      overflow: auto; }\n      :host .add-role-users .user-list #user-list {\n        display: flex;\n        flex-direction: column;\n        flex: 1; }\n\n:host([animate-modal]) {\n  transition: transform var(--animation-normal, 0.5s) ease-out; }\n\n:host([showing]) {\n  transform: translateY(0); }\n",""])},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(0),a=n(15),l=n(12),c=n(18),d=n(8),h=n(5),u=n(6),p=n(57),g=n(14),m=n(37);var f;!function(e){e[e.GROUP_ADD_MEMBERS_HEADING="Add Members"]="GROUP_ADD_MEMBERS_HEADING",e[e.CHOOSE_USER="Choose members to add to group"]="CHOOSE_USER",e[e.SEARCH_PLACEHOLDER="Find Members"]="SEARCH_PLACEHOLDER",e[e.INITIAL_MESSAGE="Find members using the search bar above"]="INITIAL_MESSAGE",e[e.ADD="Add"]="ADD",e[e.ERROR_ADDING_MEMBERS_TITTLE="Failed to add members to group"]="ERROR_ADDING_MEMBERS_TITTLE",e[e.ERROR_ADDING_MEMBERS_DESCRIPTION="There was a problem in adding a member to the group."]="ERROR_ADDING_MEMBERS_DESCRIPTION",e[e.ERROR_GROUP_IS_PARENT_TITTLE="Unable to add group"]="ERROR_GROUP_IS_PARENT_TITTLE",e[e.ERROR_GROUP_IS_PARENT_DESCRIPTION="It is not possible to add this group as it is a parent of the currently selected group."]="ERROR_GROUP_IS_PARENT_DESCRIPTION"}(f||(f={}));let _=class extends l.CTCLComponent{constructor(){super(...arguments),this._users=[]}show(e,t,n=!0){return o(this,void 0,void 0,function*(){this.editMode=!1,this.animateModal=n,this.group=e,this.showing=!0,this.isLoading=!0,this.defer(()=>o(this,void 0,void 0,function*(){this._users=yield this.layer.comms.client.getUsersByJid([...t.map(e=>e.jid)]),this.isLoading=!1}))})}dismiss(e=!0){return o(this,void 0,void 0,function*(){this.animateModal=e,this.showing=!1})}_close(){this.dismiss(this.animateModal)}setupListeners(){this.setupConnectionStatusListener()}get generateComponentStyles(){return n(102)}generateComponentMarkup(){const e={excludeUsers:this._users.map(e=>e.jid.toLowerCase()),excludeGroups:this.group&&this.group.subgroups.map(e=>e.name)||[],currentGroup:this.group&&this.group.id,allowSearch:!0,requireSearch:!0,searchPlaceholder:this.translateI18nItem(f.SEARCH_PLACEHOLDER),initialMessage:this.translateI18nItem(f.INITIAL_MESSAGE),allowSelection:!0,maxSelections:this.layer.config.groups.maxUsersToGroupInOneRequest||25,inGroupAdminUI:!0,blockGroupSelection:this.group&&this.group.parents.flatMap(e=>e.id),blockGroupSelectionTitle:this.translateI18nItem(f.ERROR_GROUP_IS_PARENT_TITTLE),blockGroupSelectionReason:this.translateI18nItem(f.ERROR_GROUP_IS_PARENT_DESCRIPTION),onChangeSelection:e=>{this.selectedUserCount=e.length},onClickUser:e=>{this.layer.showContactInfo(e,null,!1)}};return window.__CTRender("div",{class:"add-group-users"},this._renderHeader(),window.__CTRender("div",{class:"user-list"},window.__CTRender(m.CTUserList,Object.assign({id:"user-list"},e))),this._renderFooter())}_renderHeader(){return window.__CTRender(c.CTCLHeader,{class:"header"},window.__CTRender("div",{slot:"left-action"},window.__CTRender(d.CTIcon,{class:"action",width:"20",height:"20",icon:r.Icons.COMMON.ChevronLeft,onClick:this._back.bind(this)})),window.__CTRender("div",{slot:"heading"},this.translateI18nItem(f.GROUP_ADD_MEMBERS_HEADING)),window.__CTRender("div",{slot:"sub-heading"},"Add up to ",this.layer.config.groups.maxUsersToGroupInOneRequest||25," at once. Currently ",this.selectedUserCount," selected."))}_renderFooter(){return window.__CTRender("div",{class:"footer"},window.__CTRender(d.CTButton,{type:"primary",class:"button",disabled:!this.isOnline||0===this.selectedUserCount,onClick:this._add.bind(this)},this.translateI18nItem(f.ADD)))}_back(){return o(this,void 0,void 0,function*(){yield this._clearSelectedItems(),yield this._clearFilter(),this._close()})}_add(){return o(this,void 0,void 0,function*(){this.usersAdditionOccuring=!0;try{yield this.layer.getGroup({id:this.group.id})}catch(e){return void(e.message&&e.message.toLowerCase().includes(p.GROUP_404)&&(this._back(),this.emitEvent(u.ChatEvents.RefreshGroupAdminList,null),this.emitEvent(u.ChatEvents.CloseGroupDetail,null)))}let e=!0,t=!0;const n=yield this._getSelectedUsersRoles();n.length>0&&(e=yield this.layer.addGroupMembers(this.group,[...n.map(e=>e.jid)]));const i=yield this._getSelectedGroups();i.length>0&&(t=yield this.layer.addGroupChildren(this.group,[...i.map(e=>e.id)])),e&&t||this.layer.emit(g.BaseEvents._Request_RaiseAlert,this.defaultAlerts.AlertErrorWithOkayButton(this.translateI18nItem(f.ERROR_ADDING_MEMBERS_TITTLE),this.translateI18nItem(f.ERROR_ADDING_MEMBERS_DESCRIPTION),1,{okay:()=>{}})),this._back(),this.layer.emit(u.ChatEvents.RefreshGroupAdminList,null),this.layer.emit(u.ChatEvents.RefreshGroup,null)})}_getSelectedGroups(){return o(this,void 0,void 0,function*(){const e=this.shadowRoot.querySelector("#user-list");if(!e)return[];let t=yield e.getSelections();return(t=t.filter(e=>e.isGroup)).map(e=>e.transformToGroup()).flatMap(e=>e)})}_getSelectedUsersRoles(){return o(this,void 0,void 0,function*(){const e=this.shadowRoot.querySelector("#user-list");if(!e)return[];let t=yield e.getSelections();const n=(t=t.filter(e=>e.isUser||e.isRole)).map(e=>e.transformToBaseUser()).flatMap(e=>e);return h.sortUsersByName(n)})}_clearSelectedItems(){return o(this,void 0,void 0,function*(){const e=this.shadowRoot.querySelector("#user-list");e&&(yield e.clearSelections())})}_clearFilter(){return o(this,void 0,void 0,function*(){const e=this.shadowRoot.querySelector("#user-list");e&&(yield e.clearFilter())})}};i([s.prop({type:s.NullableNumber,attribute:!0,default:null})],_.prototype,"showCountFrom",void 0),i([s.prop({type:Object,attribute:!1,default:null})],_.prototype,"group",void 0),i([s.prop({type:Boolean,attribute:!0,default:!1})],_.prototype,"showing",void 0),i([s.prop({type:Boolean,attribute:!0,default:!0})],_.prototype,"animateModal",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],_.prototype,"editMode",void 0),i([s.prop({type:Boolean,attribute:!1,default:!0})],_.prototype,"saveDisabled",void 0),i([s.prop({type:Boolean,attribute:!1,default:!1})],_.prototype,"isLoading",void 0),i([s.prop({type:Number,attribute:!1,default:0})],_.prototype,"selectedUserCount",void 0),i([s.prop({type:Object,attribute:!1,default:!1})],_.prototype,"usersAdditionOccuring",void 0),_=i([a.component({tag:"ct-cl-add-group-members-modal",styles:[n(102)],i18nKeys:f})],_),t.CTCLAddGroupMembersModal=_},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n:host {\n  display: flex;\n  flex-direction: column;\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  background: #ffffff;\n  font-size: 1em;\n  transform: translateY(101%);\n  will-change: transform;\n  z-index: 99998; }\n  :host .add-group-users {\n    flex: 1 1 auto;\n    display: flex;\n    flex-direction: column;\n    height: 100%; }\n    :host .add-group-users .header .action {\n      cursor: pointer; }\n    :host .add-group-users .content {\n      flex: 1 1 auto;\n      display: flex;\n      flex-direction: column; }\n    :host .add-group-users .footer {\n      flex: none;\n      padding: 10px;\n      text-align: center; }\n    :host .add-group-users .user-list {\n      flex: 1 1 auto;\n      display: flex;\n      flex-direction: column;\n      overflow: auto; }\n      :host .add-group-users .user-list #user-list {\n        display: flex;\n        flex-direction: column;\n        flex: 1; }\n\n:host([animate-modal]) {\n  transition: transform var(--animation-normal, 0.5s) ease-out; }\n\n:host([showing]) {\n  transform: translateY(0); }\n",""])},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(0),a=n(8);class l extends s.CTLayerComponent{static get is(){return"ct-searchbox"}initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){}get generateComponentStyles(){return n(400)}generateComponentMarkup(){let e=r.Icons.COMMON.Search;return"filter"===this.type&&(e=r.Icons.COMMON.Filter),window.__CTRender("div",{class:"search-box"},window.__CTRender("input",{type:"text",placeholder:this.placeholder,oninput:e=>this._onChange(e.target.value),onblur:e=>this._onBlur()}),window.__CTRender(a.CTIcon,{class:"icon",width:"16",height:"16",icon:e}),this.allowClear&&this.showClear&&window.__CTRender(a.CTIcon,{class:"clear",width:"12",height:"12",icon:r.Icons.COMMON.CircleCross,onClick:this._clear.bind(this)}))}_onChange(e){0===e.length?(this.cancelDebounce("search"),this.showClear=!1,this.value="",this.onSearch("")):(this.showClear=!0,this.debounce("search",()=>{this.value=e,"function"==typeof this.onSearch&&this.onSearch(e)},this.delay))}_clear(e=!0){if(!this.allowClear)return;const t=this.shadowRoot.querySelector("input");t.value="",e&&t.focus(),this._onChange("")}_onBlur(){this.onBlur&&this.onBlur()}clear(){return o(this,void 0,void 0,function*(){this._clear(!1)})}}i([s.prop({type:String,attribute:!0,default:"search"})],l.prototype,"type",void 0),i([s.prop({type:String,attribute:!0,default:""})],l.prototype,"placeholder",void 0),i([s.prop({type:Number,attribute:!0,default:200})],l.prototype,"delay",void 0),i([s.prop({type:s.Stroolean,attribute:!0,default:!0})],l.prototype,"allowClear",void 0),i([s.prop({type:Function,attribute:!1,default:null})],l.prototype,"onSearch",void 0),i([s.prop({type:Function,attribute:!1,default:null})],l.prototype,"onBlur",void 0),i([s.prop({type:s.Stroolean,attribute:!1,default:!1})],l.prototype,"showClear",void 0),i([s.prop({type:String,attribute:!1,default:""})],l.prototype,"value",void 0),t.CTSearchbox=l,l.register()},function(e,t,n){var i=n(401);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* == Buttons == */\n/* === Modals === */\n/* === Alerts === */\n:host {\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: 400;\n  color: #212121; }\n  :host h1, :host h2, :host h3, :host h4, :host h5, :host h6 {\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale; }\n\n:host, :host * {\n  box-sizing: border-box; }\n\n.user-html p {\n  margin: 0; }\n  .user-html p + p {\n    margin: .8em 0 0 0; }\n\n.user-html strong {\n  font-weight: 600; }\n\n:host {\n  display: block; }\n  :host .search-box {\n    position: relative;\n    color: var(--subtle-font-color, #828688); }\n    :host .search-box input {\n      width: 100%;\n      height: 30px;\n      font-family: inherit;\n      font-size: 14px;\n      font-weight: inherit;\n      padding: 4px 26px;\n      border-radius: 15px;\n      background: #ffffff;\n      color: var(--default-font-color, #212121);\n      border: var(--secondary-border, 1px solid #dddddd);\n      outline: none; }\n      :host .search-box input::placeholder {\n        text-align: center;\n        color: var(--subtle-font-color, #828688); }\n      :host .search-box input::-webkit-input-placeholder {\n        text-align: center;\n        color: var(--subtle-font-color, #828688); }\n    :host .search-box .icon {\n      position: absolute;\n      top: 0;\n      left: 0;\n      height: 100%;\n      padding: 0 7px; }\n    :host .search-box .clear {\n      position: absolute;\n      top: 0;\n      right: 0;\n      height: 100%;\n      padding: 0 7px;\n      cursor: pointer; }\n",""])},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(15),a=n(28),l=n(0),c=n(12);let d=class extends c.CTCLComponent{initialize(){return o(this,void 0,void 0,function*(){})}setupListeners(){}generateComponentMarkup(){return this.showing?this.setAttribute("showing",""):this.removeAttribute("showing"),window.__CTRender("div",{class:"ct-cl-toast-container"},window.__CTRender("div",{class:"icon"},window.__CTRender(a.CTIcon,{class:"action",width:"30",height:"30",icon:this.icon,color:"#000"})),window.__CTRender("div",{class:"content"},window.__CTRender("div",{class:"heading"},this.heading),window.__CTRender("div",{class:"text"},this.renderHtml(this.text))))}show(e,t,n,i=3e3){return o(this,void 0,void 0,function*(){return new Promise(s=>{this.heading=e,this.text=t,this.icon=n,this.showing=!0,setTimeout(()=>o(this,void 0,void 0,function*(){yield this.dismiss(),s()}),i)})})}dismiss(){return o(this,void 0,void 0,function*(){return new Promise(e=>{this.addEventListener("transitionend",()=>{this.heading="",this.text="",this.icon=l.Icons.COMMON.Info,e()},{once:!0}),this.showing=!1})})}};i([s.prop({type:Boolean,attribute:!0,default:!1})],d.prototype,"showing",void 0),i([s.prop({type:String,attribute:!0})],d.prototype,"heading",void 0),i([s.prop({type:String,attribute:!0})],d.prototype,"text",void 0),i([s.prop({type:Object,attribute:!1,default:l.Icons.COMMON.User})],d.prototype,"icon",void 0),d=i([r.component({tag:"ct-cl-toast",styles:[n(403)]})],d),t.CTCLToast=d},function(e,t,n){var i=n(404);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,"/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n:host {\n  position: absolute;\n  will-change: transform, opacity;\n  opacity: 0;\n  transform: translateY(-100px);\n  top: 10px;\n  width: calc(100% - 20px);\n  right: 10px;\n  background: #000;\n  color: #FFF;\n  height: 80px;\n  display: flex;\n  z-index: 99999991;\n  box-sizing: border-box;\n  border-radius: 10px;\n  box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5);\n  transition: 300ms ease-in-out opacity, 300ms ease-in-out transform; }\n  @media only screen and (min-width: 700px) {\n    :host {\n      width: 45%;\n      transform: translateY(0) translateX(150%); } }\n  @media only screen and (min-width: 1300px) {\n    :host {\n      width: 35%; } }\n  @media only screen and (min-width: 1600px) {\n    :host {\n      width: 25%; } }\n  :host .ct-cl-toast-container {\n    flex: 1;\n    display: flex;\n    flex-direction: row;\n    padding: 10px;\n    overflow: hidden; }\n    :host .ct-cl-toast-container .content {\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n      margin-left: 20px;\n      overflow: hidden; }\n      :host .ct-cl-toast-container .content .heading {\n        font-size: 1.2em;\n        font-weight: bold;\n        line-height: 30px;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        flex: 1;\n        margin-top: 5px; }\n      :host .ct-cl-toast-container .content .text {\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        flex: 1;\n        padding-right: 20px; }\n    :host .ct-cl-toast-container .icon {\n      flex-basis: 60px;\n      height: 60px;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: #FFF;\n      border-radius: 50%;\n      flex-shrink: 0;\n      flex-grow: 0; }\n\n:host([showing]) {\n  transform: translateY(0);\n  opacity: 0.9; }\n  @media only screen and (min-width: 700px) {\n    :host([showing]) {\n      width: 45%;\n      transform: translateX(0); } }\n",""])},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=n(12),r=n(1);class a extends s.CTCLComponent{constructor(){super(),this._show=!1}static get is(){return"ct-cl-dynamic-action-sheet"}get generateComponentStyles(){return n(406)}setupListeners(){this.addListener("show-dynamic-action-sheet",()=>{this._show=!0})}initialize(e){const t=e=>super[e];return o(this,void 0,void 0,function*(){yield t("initialize").call(this,e)})}generateComponentMarkup(){const e=["DynamicActionSheet-container",`${this._show?" DynamicActionSheet--showBackdrop":""}`],t=["DynamicActionSheet-actionsContainer",`${this._show?" DynamicActionSheet--showActions":""}`];return window.__CTRender("div",{class:e.join(" ")},window.__CTRender("div",{class:t.join(" ")},this.actions.map((e,t)=>{const n=["DynamicActionSheet-action","DynamicActionSheet-actionSheet"];return t+1===this.actions.length&&n.push("DynamicActionSheet--last"),window.__CTRender("button",{class:n.join(" "),onClick:()=>{e.action()}},window.__CTRender("h3",{class:"DynamicActionSheet-actionHeading"},e.primaryText),window.__CTRender("span",{class:"DynamicActionSheet-actionSubHeading"},e.subtitleText))}),window.__CTRender("button",{class:"DynamicActionSheet-action DynamicActionSheet-cancelAction",onClick:()=>{this._show=!this._show,this.forceRedraw()}},"Cancel")))}}i([r.prop({type:Array,attribute:!1,default:!1})],a.prototype,"actions",void 0),i([r.prop({type:Function,attribute:!1})],a.prototype,"onClick",void 0),t.CTCLDynamicActionSheet=a,a.register()},function(e,t,n){var i=n(407);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,".DynamicActionSheet-container {\n  background-color: rgba(0, 0, 0, 0.3);\n  opacity: 0;\n  position: fixed;\n  height: 100%;\n  left: 0;\n  top: 0;\n  width: 100%;\n  z-index: -99999991;\n  -webkit-transition: all .25s ease-in-out;\n  -moz-transition: all .25s ease-in-out;\n  -ms-transition: all .25s ease-in-out;\n  -o-transition: all .25s ease-in-out;\n  transition: all .25s ease-in-out; }\n\n.DynamicActionSheet-actionsContainer {\n  box-sizing: border-box;\n  bottom: -100%;\n  padding: 0 20px;\n  position: fixed;\n  z-index: 100000000;\n  width: 100%;\n  left: 0;\n  -webkit-transition: all .25s ease-in-out;\n  -moz-transition: all .25s ease-in-out;\n  -ms-transition: all .25s ease-in-out;\n  -o-transition: all .25s ease-in-out;\n  transition: all .25s ease-in-out; }\n\n.DynamicActionSheet-action {\n  background-color: #fff;\n  box-sizing: border-box;\n  position: relative;\n  color: #000;\n  padding: 0.55em 1em;\n  border: 1px solid transparent;\n  font-family: inherit;\n  font-size: inherit;\n  font-weight: inherit;\n  outline: none;\n  cursor: pointer;\n  overflow: hidden;\n  width: 100%;\n  height: 100%;\n  min-height: 45px;\n  border-radius: inherit; }\n\n.DynamicActionSheet-action:hover {\n  filter: brightness(95%); }\n\n.DynamicActionSheet-actionSheet {\n  border-bottom: 1px solid #dddddd;\n  height: 75px; }\n\n.DynamicActionSheet-actionSheet:first-child {\n  border-top-left-radius: 10px;\n  border-top-right-radius: 10px;\n  border-bottom-left-radius: 0;\n  border-bottom-right-radius: 0; }\n\n.DynamicActionSheet--last {\n  border-top-left-radius: 0;\n  border-top-right-radius: 0;\n  border-bottom-left-radius: 10px;\n  border-bottom-right-radius: 10px; }\n\n.DynamicActionSheet-actionHeading {\n  color: #0072ce;\n  font-size: 1.4em;\n  font-weight: normal;\n  margin: 0; }\n\n.DynamicActionSheet-actionSubHeading {\n  color: #828688; }\n\n.DynamicActionSheet-cancelAction {\n  border-radius: 10px;\n  color: #0072ce;\n  margin-top: 10px;\n  font-size: 1.4em;\n  font-weight: normal;\n  height: 45px; }\n\n.DynamicActionSheet--showBackdrop {\n  opacity: 1;\n  z-index: 99999991; }\n\n.DynamicActionSheet--showActions {\n  bottom: 10px; }\n",""])},function(e,t,n){var i=n(409);e.exports="string"==typeof i?i:i.toString()},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,'/*! Copyright (c) 2018 CommonTime Ltd */\n/*! Copyright (c) 2018 CommonTime Ltd */\n/* === Alerts === */\ninput:not([type=checkbox]):not([type=radio]) {\n  -webkit-appearance: none; }\n\n@-moz-keyframes blinker {\n  0% {\n    opacity: 1.0; }\n  50% {\n    opacity: 0.25; }\n  100% {\n    opacity: 1.0; } }\n\n@-webkit-keyframes blinker {\n  0% {\n    opacity: 1.0; }\n  50% {\n    opacity: 0.25; }\n  100% {\n    opacity: 1.0; } }\n\n@keyframes blinker {\n  0% {\n    opacity: 1.0; }\n  50% {\n    opacity: 0.25; }\n  100% {\n    opacity: 1.0; } }\n\n:host {\n  display: block;\n  height: 100%;\n  font-size: 1em; }\n  :host .conversation-list {\n    flex: 1 1 auto;\n    display: flex;\n    flex-direction: column;\n    height: 100%; }\n    :host .conversation-list .header .action {\n      cursor: pointer; }\n    :host .conversation-list .filter {\n      flex: 0 0 55px;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background: var(--secondary-color, #f2f2f2);\n      border-bottom: var(--secondary-border, 1px solid #dddddd);\n      padding: 0 20px; }\n      :host .conversation-list .filter .search-box {\n        width: 80%;\n        font-size: 0.833em; }\n    :host .conversation-list .update-banner {\n      position: relative;\n      flex: 0 0 57px;\n      display: flex;\n      align-items: center;\n      background: #1b2341;\n      border-bottom: var(--secondary-border, 1px solid #dddddd);\n      padding: var(--avatar-tile-padding, 6px 10px);\n      color: #ffffff; }\n      :host .conversation-list .update-banner .icon {\n        flex: none;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        align-items: center;\n        background-color: transparent;\n        border: 3px solid #ffffff;\n        border-radius: 50%;\n        width: 34px;\n        height: 34px;\n        margin: 0 10px 0 0; }\n      :host .conversation-list .update-banner .message {\n        flex: 1 1 auto;\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        font-size: 16px; }\n      :host .conversation-list .update-banner .button {\n        background-color: var(--primary-accent-color);\n        border-radius: 4px;\n        border: none;\n        color: #ffffff;\n        font-size: 16px;\n        padding: 5px 18px;\n        cursor: pointer; }\n    :host .conversation-list .column-headings {\n      display: none;\n      background: var(--secondary-color, #f2f2f2);\n      border-bottom: var(--secondary-border, 1px solid #dddddd);\n      color: var(--subtle-font-color);\n      align-items: center;\n      padding: 5px 10px; }\n      @media only screen and (min-width: 960px) {\n        :host .conversation-list .column-headings {\n          display: flex;\n          flex: 0 0 auto;\n          overflow: hidden; } }\n      :host .conversation-list .column-headings div.type {\n        flex: 0 0 6vw; }\n      :host .conversation-list .column-headings div.from-to {\n        flex: 0 0 20vw;\n        margin-right: 20px; }\n      :host .conversation-list .column-headings div.subject {\n        flex: 0 0 27vw;\n        margin-right: 20px; }\n      :host .conversation-list .column-headings div.last-response {\n        flex: 0 0 30vw;\n        margin-right: 20px; }\n      :host .conversation-list .column-headings div.raised-at {\n        flex: 0 0 13vw; }\n      :host .conversation-list .column-headings div span {\n        text-transform: uppercase; }\n    :host .conversation-list .fetching,\n    :host .conversation-list .no-conversations {\n      flex: 1 1 auto;\n      display: flex;\n      justify-content: center;\n      align-items: flex-start;\n      text-align: center;\n      height: 100%;\n      padding: 25px 10px;\n      background: var(--list-bg, #f2f2f2);\n      color: var(--subtle-font-color, #828688); }\n    :host .conversation-list .conversations {\n      flex: 1 1 auto;\n      overflow: auto;\n      -webkit-overflow-scrolling: touch;\n      background: var(--list-bg, #f2f2f2); }\n      :host .conversation-list .conversations .conversations-content .conversation {\n        cursor: pointer; }\n        @media (pointer: fine) {\n          :host .conversation-list .conversations .conversations-content .conversation {\n            transition: filter 0.3s ease-out; }\n            :host .conversation-list .conversations .conversations-content .conversation:hover {\n              filter: brightness(95%); } }\n        :host .conversation-list .conversations .conversations-content .conversation .avatar {\n          flex: none;\n          display: flex;\n          flex-direction: column;\n          justify-content: center;\n          align-items: center;\n          width: 40px;\n          height: 40px;\n          background: var(--avatar-bg, #7b7e80);\n          color: var(--avatar-color, #ffffff);\n          border-radius: 50%; }\n          :host .conversation-list .conversations .conversations-content .conversation .avatar.group {\n            background: var(--group-avatar-bg, #22b1c8);\n            color: var(--group-avatar-color, #ffffff); }\n            :host .conversation-list .conversations .conversations-content .conversation .avatar.group .icon {\n              margin: -2px 0 2px 0; }\n            :host .conversation-list .conversations .conversations-content .conversation .avatar.group .count {\n              line-height: 0.8em;\n              font-size: 16px;\n              letter-spacing: -1px; }\n              :host .conversation-list .conversations .conversations-content .conversation .avatar.group .count.small {\n                font-size: 1em; }\n              :host .conversation-list .conversations .conversations-content .conversation .avatar.group .count.smallest {\n                font-size: 0.833em; }\n          :host .conversation-list .conversations .conversations-content .conversation .avatar.closed {\n            background: none;\n            justify-content: flex-start; }\n            :host .conversation-list .conversations .conversations-content .conversation .avatar.closed .badge {\n              background: #303233;\n              color: #ffffff;\n              font-size: 0.75em;\n              font-weight: 300;\n              text-transform: uppercase;\n              padding: 3px 4px;\n              margin: 5px 0 0 0;\n              border-radius: 4px;\n              line-height: 1em; }\n              :host .conversation-list .conversations .conversations-content .conversation .avatar.closed .badge.blink {\n                -webkit-animation-name: blinker;\n                -webkit-animation-duration: 3s;\n                -webkit-animation-timing-function: linear;\n                -webkit-animation-iteration-count: infinite;\n                -moz-animation-name: blinker;\n                -moz-animation-duration: 3s;\n                -moz-animation-timing-function: linear;\n                -moz-animation-iteration-count: infinite;\n                animation-name: blinker;\n                animation-duration: 3s;\n                animation-timing-function: linear;\n                animation-iteration-count: infinite; }\n        :host .conversation-list .conversations .conversations-content .conversation .expanded {\n          display: none; }\n          @media only screen and (min-width: 960px) {\n            :host .conversation-list .conversations .conversations-content .conversation .expanded {\n              display: flex;\n              flex-basis: 20vw;\n              overflow: hidden;\n              flex-direction: column; }\n              :host .conversation-list .conversations .conversations-content .conversation .expanded div.from,\n              :host .conversation-list .conversations .conversations-content .conversation .expanded div.to {\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis; } }\n        :host .conversation-list .conversations .conversations-content .conversation .subject {\n          display: flex;\n          align-items: center;\n          overflow: hidden; }\n          @media only screen and (min-width: 960px) {\n            :host .conversation-list .conversations .conversations-content .conversation .subject {\n              flex: 0 0 20vw;\n              margin-right: 20px; } }\n          :host .conversation-list .conversations .conversations-content .conversation .subject .badge {\n            flex: none;\n            background: var(--primary-color, #22b1c8);\n            color: var(--primary-font-color, #ffffff);\n            font-size: 0.75em;\n            font-weight: 300;\n            text-transform: uppercase;\n            margin: 0 5px 0 0;\n            padding: 3px 4px;\n            border-radius: 4px;\n            line-height: 1em; }\n            :host .conversation-list .conversations .conversations-content .conversation .subject .badge.blink {\n              -webkit-animation-name: blinker;\n              -webkit-animation-duration: 1s;\n              -webkit-animation-timing-function: linear;\n              -webkit-animation-iteration-count: infinite;\n              -moz-animation-name: blinker;\n              -moz-animation-duration: 1s;\n              -moz-animation-timing-function: linear;\n              -moz-animation-iteration-count: infinite;\n              animation-name: blinker;\n              animation-duration: 1s;\n              animation-timing-function: linear;\n              animation-iteration-count: infinite; }\n          :host .conversation-list .conversations .conversations-content .conversation .subject .title {\n            flex: 1 1 auto;\n            font-size: 1.333em;\n            white-space: nowrap;\n            overflow: hidden;\n            text-overflow: ellipsis; }\n            @media only screen and (min-width: 960px) {\n              :host .conversation-list .conversations .conversations-content .conversation .subject .title {\n                display: none; } }\n          :host .conversation-list .conversations .conversations-content .conversation .subject .icon {\n            flex: none;\n            margin: 0 0 0 10px; }\n            :host .conversation-list .conversations .conversations-content .conversation .subject .icon.pending {\n              color: var(--conversation-has-draft-color, #7e8080); }\n            :host .conversation-list .conversations .conversations-content .conversation .subject .icon.error {\n              color: var(--conversation-has-error-color, #d93247); }\n            :host .conversation-list .conversations .conversations-content .conversation .subject .icon.remove {\n              color: var(--subtle-font-color, #828688);\n              cursor: pointer; }\n        :host .conversation-list .conversations .conversations-content .conversation .description {\n          display: none; }\n          @media only screen and (min-width: 960px) {\n            :host .conversation-list .conversations .conversations-content .conversation .description {\n              display: flex;\n              flex: 0 0 27vw;\n              flex-direction: column;\n              overflow: hidden;\n              margin-right: 20px;\n              justify-content: center; }\n              :host .conversation-list .conversations .conversations-content .conversation .description div.subject-desc {\n                font-size: 1.333em; }\n              :host .conversation-list .conversations .conversations-content .conversation .description div.subject-desc,\n              :host .conversation-list .conversations .conversations-content .conversation .description div.user-desc {\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis; } }\n        :host .conversation-list .conversations .conversations-content .conversation .preview {\n          display: flex;\n          align-items: center;\n          flex-direction: row;\n          margin-right: 20px;\n          color: var(--conversation-read-text, #828688); }\n          :host .conversation-list .conversations .conversations-content .conversation .preview pre.code, :host .conversation-list .conversations .conversations-content .conversation .preview code {\n            margin: 0 0 0 0; }\n          @media only screen and (min-width: 960px) {\n            :host .conversation-list .conversations .conversations-content .conversation .preview {\n              flex: 0 0 30vw;\n              overflow: hidden; } }\n          :host .conversation-list .conversations .conversations-content .conversation .preview .mobile-preview {\n            flex: 1 1 auto;\n            display: flex;\n            align-items: center;\n            overflow: hidden;\n            white-space: nowrap;\n            text-overflow: ellipsis; }\n            @media only screen and (min-width: 960px) {\n              :host .conversation-list .conversations .conversations-content .conversation .preview .mobile-preview {\n                display: none; } }\n            :host .conversation-list .conversations .conversations-content .conversation .preview .mobile-preview .entry {\n              flex: 1 1 auto;\n              display: flex;\n              align-items: center;\n              overflow: hidden;\n              white-space: nowrap;\n              text-overflow: ellipsis; }\n              :host .conversation-list .conversations .conversations-content .conversation .preview .mobile-preview .entry .message {\n                text-overflow: ellipsis;\n                overflow: hidden; }\n                :host .conversation-list .conversations .conversations-content .conversation .preview .mobile-preview .entry .message.has-attachment {\n                  display: flex;\n                  align-items: center; }\n                  :host .conversation-list .conversations .conversations-content .conversation .preview .mobile-preview .entry .message.has-attachment .icon {\n                    margin: 0 3px 0 5px;\n                    color: var(--subtle-font-color, #828688); }\n                  :host .conversation-list .conversations .conversations-content .conversation .preview .mobile-preview .entry .message.has-attachment .label {\n                    font-size: 0.833em;\n                    color: var(--subtle-font-color, #828688);\n                    overflow: hidden;\n                    text-overflow: ellipsis; }\n            :host .conversation-list .conversations .conversations-content .conversation .preview .mobile-preview .when {\n              flex: none;\n              margin: 0 0 0 10px; }\n            :host .conversation-list .conversations .conversations-content .conversation .preview .mobile-preview .marker {\n              flex: none;\n              margin: 0 0 0 5px;\n              width: 16px; }\n              :host .conversation-list .conversations .conversations-content .conversation .preview .mobile-preview .marker:before {\n                display: block;\n                content: "";\n                width: 10px;\n                height: 10px;\n                margin: 0 auto;\n                border-radius: 50%;\n                background: var(--conversation-read-marker-bg, #ffffff);\n                border: var(--conversation-read-marker-border, 1px solid #dddddd); }\n          :host .conversation-list .conversations .conversations-content .conversation .preview .desktop-preview {\n            display: none; }\n            @media only screen and (min-width: 960px) {\n              :host .conversation-list .conversations .conversations-content .conversation .preview .desktop-preview {\n                display: flex;\n                flex: 0 0 30vw;\n                flex-direction: column;\n                overflow: hidden;\n                justify-content: center; }\n                :host .conversation-list .conversations .conversations-content .conversation .preview .desktop-preview div.entry div.message {\n                  font-size: 1.1em; }\n                  :host .conversation-list .conversations .conversations-content .conversation .preview .desktop-preview div.entry div.message.has-attachment .icon {\n                    width: min-content; }\n                  :host .conversation-list .conversations .conversations-content .conversation .preview .desktop-preview div.entry div.message.has-attachment .label {\n                    word-break: break-all;\n                    overflow: hidden;\n                    text-overflow: ellipsis;\n                    display: -webkit-box;\n                    -webkit-line-clamp: 1;\n                    -webkit-box-orient: vertical; } }\n        :host .conversation-list .conversations .conversations-content .conversation div.raised-on {\n          display: none; }\n          @media only screen and (min-width: 960px) {\n            :host .conversation-list .conversations .conversations-content .conversation div.raised-on {\n              display: flex;\n              flex: 0 0 13vw;\n              flex-direction: row;\n              overflow: hidden;\n              align-content: center; }\n              :host .conversation-list .conversations .conversations-content .conversation div.raised-on span {\n                margin: auto 0; }\n              :host .conversation-list .conversations .conversations-content .conversation div.raised-on div.marker {\n                margin: auto 0 auto 5px;\n                flex: none;\n                width: 16px; }\n                :host .conversation-list .conversations .conversations-content .conversation div.raised-on div.marker:before {\n                  display: block;\n                  content: "";\n                  width: 10px;\n                  height: 10px;\n                  margin: 0 auto;\n                  border-radius: 50%;\n                  background: var(--conversation-read-marker-bg, #ffffff);\n                  border: var(--conversation-read-marker-border, 1px solid #dddddd); } }\n        :host .conversation-list .conversations .conversations-content .conversation.unread .subject .title {\n          font-weight: 600; }\n        :host .conversation-list .conversations .conversations-content .conversation.unread .description .subject-desc {\n          font-weight: 600; }\n        :host .conversation-list .conversations .conversations-content .conversation.unread .preview .entry,\n        :host .conversation-list .conversations .conversations-content .conversation.unread .raised-on .entry {\n          color: var(--conversation-unread-text, #212121); }\n        :host .conversation-list .conversations .conversations-content .conversation.unread .preview .marker:before,\n        :host .conversation-list .conversations .conversations-content .conversation.unread .raised-on .marker:before {\n          background: var(--conversation-unread-marker-bg, #22b1c8);\n          border: var(--conversation-unread-marker-border, 1px solid #22b1c8); }\n        :host .conversation-list .conversations .conversations-content .conversation.closed {\n          position: relative;\n          cursor: default; }\n          :host .conversation-list .conversations .conversations-content .conversation.closed .subject {\n            color: var(--subtle-font-color, #828688); }\n            :host .conversation-list .conversations .conversations-content .conversation.closed .subject .title {\n              font-weight: 400; }\n          :host .conversation-list .conversations .conversations-content .conversation.closed .preview .entry {\n            color: var(--subtle-font-color, #828688); }\n          :host .conversation-list .conversations .conversations-content .conversation.closed .preview .when {\n            color: var(--subtle-font-color, #828688); }\n          :host .conversation-list .conversations .conversations-content .conversation.closed .preview .marker {\n            display: none; }\n',""])},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});
/*! Copyright (c) 2018 CommonTime Ltd */
const o=n(19),s=n(411),r=n(412);t.Store=class extends s.BaseStore{constructor(e,t,n){super(e,t),this.SCHEMA_VERSION=1.1,this._config=n}init(){const e=e=>super[e];return i(this,void 0,void 0,function*(){yield e("init").call(this),this.state.schemaVersion===this.SCHEMA_VERSION?this.logger.log(o.LoggerTypes.DataStorage,` %cSTATE IS USING EXPECTED SCHEMA VERSION: %c${this.state.schemaVersion}`,"color: #606; font-weight: bold;","color: #999; font-weight: normal;"):this.state.schemaVersion<this.SCHEMA_VERSION?(this.logger.log(o.LoggerTypes.DataStorage," %cSTATE IS USING OLD SCHEMA VERSION:","color: #C00; font-weight: bold;",{current:this.state.schemaVersion,expected:this.SCHEMA_VERSION}),this.state=r.upgradeTo1_1(this.state),this.state.schemaVersion=this.SCHEMA_VERSION,yield this.saveToPersistent()):this.logger.log(o.LoggerTypes.DataStorage," %cSTATE IS NEWER THAN EXPECTED SCHEMA VERSION:","color: #C00; font-weight: bold;",{current:this.state.schemaVersion,expected:this.SCHEMA_VERSION})})}getLatestIdentifier(){return i(this,void 0,void 0,function*(){return this.state.latestIdentifier})}getCurrentUser(){return this.state.currentUser}setCurrentUser(e){return i(this,void 0,void 0,function*(){this.state.currentUser=e,yield this.saveToPersistent()})}updateLatestIdentifier(e,t){return i(this,void 0,void 0,function*(){if(e){const n=this.state.delegateConversations[e];if(n){const i=n.latestIdentifier;t>i&&(this.state.delegateConversations[e].latestIdentifier=t,yield this.saveToPersistent())}}else t>this.state.latestIdentifier&&(this.logger.log(o.LoggerTypes.DataStorage,` %cSTORING latestIdentifier '${t}':`,"color: #C00; font-weight: bold;"),this.state.latestIdentifier=t,yield this.saveToPersistent())})}loadConversations(){return i(this,void 0,void 0,function*(){return this.state.conversations||[]})}saveConversations(e){return i(this,void 0,void 0,function*(){this.state.conversations=e,yield this.saveToPersistent()})}clearChatData(){return i(this,void 0,void 0,function*(){this.state.latestIdentifier=0,this.state.conversations=[],yield this.saveToPersistent()})}addToPendingAlerts(e){return i(this,void 0,void 0,function*(){this.state.pendingAlerts||(this.state.pendingAlerts=[]),this.state.pendingAlerts.includes(e.id)||(this.state.pendingAlerts=[e.id,...this.state.pendingAlerts],yield this.saveToPersistent())})}getPendingAlerts(){return this.state.pendingAlerts?this.state.pendingAlerts.reduce((e,t)=>{let n=this.getConversationById(t);if(!n)for(const i in this.state.delegateConversations){const e=this.state.delegateConversations[i].conversations.find(e=>e.id===t);if(e){n=e;break}}return n?[...e,n]:e},[]):[]}clearPendingAlert(e){return i(this,void 0,void 0,function*(){if(this.state.pendingAlerts&&e){const t=this.state.pendingAlerts.indexOf(e.id);this.state.pendingAlerts.splice(t,1),yield this.saveToPersistent()}})}getWorkspaceAccount(){return this.state.workspaceAccount}setWorkspaceAccount(e){return i(this,void 0,void 0,function*(){this.state.workspaceAccount=e?e.toLowerCase():null,yield this.saveToPersistent()})}getConversationById(e){return this.state.conversations.find(t=>t.id===e)}getDelegateConversations(){return this.state.delegateConversations}setDelegateConversations(e={}){return i(this,void 0,void 0,function*(){return this.state.delegateConversations=e,yield this.saveToPersistent()})}deleteDelegateConversations(e){return i(this,void 0,void 0,function*(){return delete this.state.delegateConversations[e],yield this.saveToPersistent()})}setMyDelegates(e=[]){return i(this,void 0,void 0,function*(){return this.state.myDelegateAccounts=e,yield this.saveToPersistent()})}getMyDelegates(){return this.state.myDelegateAccounts||[]}generateInitialState(){return{_id:this.name,_rev:"",schemaVersion:this.SCHEMA_VERSION,latestIdentifier:0,conversations:[],pendingAlerts:[],myDelegateAccounts:[],delegateConversations:{},workspaceAccount:null,currentUser:null}}}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const o=n(44),s=n(19),r=n(5);t.BaseStore=class{constructor(e,t,n=!1,i=!0){this._saveToPersistentQueue=Promise.resolve(),this._isDestoryingDb=!1,this.name=e,this.logger=t,this._autoCompact=n,this._encryption=i}init(){return i(this,void 0,void 0,function*(){if(this._db||(yield this._createDb(this.name)),this.state=yield this.getFromPersistent(),this.logger.shouldLog(s.LoggerTypes.DataStorage)){const e=r.deepCloneObject(this.state);this.logger.log(s.LoggerTypes.DataStorage," %cINITIAL STATE:","color: #606; font-weight: bold;",Object.assign({},e)),this.prevState=e}})}savePushNotificationToken(e){return i(this,void 0,void 0,function*(){this.state.pushNotificationToken=e,yield this.saveToPersistent()})}getPushNotificationToken(){return i(this,void 0,void 0,function*(){return this.state.pushNotificationToken})}savePushNotificationAzureId(e){return i(this,void 0,void 0,function*(){this.state.pushNotificationTokenAzureId=e,yield this.saveToPersistent()})}getPushNotificationAzureId(){return i(this,void 0,void 0,function*(){return this.state.pushNotificationTokenAzureId})}clearAllData(){return i(this,void 0,void 0,function*(){return new Promise(e=>{localStorage.removeItem(this.name),this._db&&!this._isDestoryingDb?(this._isDestoryingDb=!0,this._db.destroy().then(()=>(this._createDb(this.name),this.init())).then(()=>{this._isDestoryingDb=!1,e()})):e()})})}getLoggerTypes(){return i(this,void 0,void 0,function*(){return this.state.loggerTypes})}saveLoggerTypes(e){return i(this,void 0,void 0,function*(){return this.state.loggerTypes=e,yield this.saveToPersistent()})}deleteLoggerTypes(){return i(this,void 0,void 0,function*(){return delete this.state.loggerTypes,yield this.saveToPersistent()})}getStateSnapshot(){return this.state}getTheme(){return i(this,void 0,void 0,function*(){return this.state.theme||""})}saveTheme(e){return i(this,void 0,void 0,function*(){return this.state.theme=e,yield this.saveToPersistent()})}getFromPersistent(){return i(this,void 0,void 0,function*(){if(!this._db)return localStorage.getItem(this.name)?JSON.parse(localStorage.getItem(this.name)):this.generateInitialState();try{return yield this._db.get(this.name)}catch(e){const t=this.generateInitialState(),n=yield this._db.put(t);return t._rev=n.rev,t}})}saveToPersistent(){return i(this,void 0,void 0,function*(){clearTimeout(this._saveDebouncer),this._saveDebouncer=setTimeout(()=>{this._db?this._saveToPersistentQueue=this._saveToPersistentQueue.then(()=>i(this,void 0,void 0,function*(){try{const e=yield this._db.put(this.state);this.state._rev=e.rev,this.logger.shouldLog(s.LoggerTypes.DataStorage)}catch(e){throw new Error(e)}})):(localStorage[this.name]=JSON.stringify(this.state),this.logger.shouldLog(s.LoggerTypes.DataStorage))},150)})}_createDb(e){return i(this,void 0,void 0,function*(){if(window.PouchDB){if(this.logger.log(s.LoggerTypes.DataStorage,` %cUSING POUCHDB: %c${e}`,"color: #606; font-weight: bold;","color: #999; font-weight: normal;"),this._db=new window.PouchDB(`${e}`,{revs_limit:1,auto_compaction:this._autoCompact}),!0===this._encryption){this.logger.log(s.LoggerTypes.DataStorage," %cENCRYPTING POUCHDB...","color: #606; font-weight: bold;","color: #999; font-weight: normal;");const t=yield o.getEncryptionKey(e+"_layer");this._db.crypto({key:t})}}else this.logger.log(s.LoggerTypes.DataStorage," %cCANNOT FIND POUCHDB, USING LOCAL STORAGE INSTEAD","color: #606; font-weight: bold;")})}_logUpdate(){const e=r.deepCloneObject(this.state),t=r.getDiffs(this.prevState,e),n=r.groupArrayItemsByKey(t,e=>e.path),i=Object.keys(n);0===t.length?this.logger.log(s.LoggerTypes.DataStorage," %cSTATE UPDATED %c- NO STATE CHANGES","color: #606; font-weight: bold;","color: #999; font-weight: bold;",Object.assign({},e)):(this.logger.log(s.LoggerTypes.DataStorage," %cSTATE UPDATED","color: #606; font-weight: bold;",Object.assign({},e)),this.logger.group(s.LoggerTypes.DataStorage,t.length<3,` %c${t.length} STATE CHANGE(S):`,"color: #999; font-weight: bold;"),i.forEach(e=>{this.logger.log(s.LoggerTypes.DataStorage,`%cstate.${e}:`,"color: #666; font-weight: normal;"),n[e].forEach(e=>{if(e.added||e.deleted){const t=e.added?"090":"900";this.logger.log(s.LoggerTypes.DataStorage,`  %c${e.type.toLowerCase()}:`,`color: #${t}; font-weight: normal;`,e.rhs)}else this.logger.log(s.LoggerTypes.DataStorage,`  %c${e.lhs||"<empty>"} %c %c${e.rhs}`,"color: #900; font-weight: normal;","color: #CCC;","color: #090; font-weight: normal;")})}),this.logger.groupEnd(s.LoggerTypes.DataStorage)),this.prevState=e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.upgradeTo1_1=function(e){return e.delegateState&&delete e.delegateState,e.myDelegateAccounts||(e.myDelegateAccounts=[]),e.delegateConversations||(e.delegateConversations={}),e}},function(e,t,n){"use strict";
/*! Copyright (c) 2018 CommonTime Ltd */Object.defineProperty(t,"__esModule",{value:!0});const i=n(14);t.PriorityConversationNotificationEventArgs=class extends i.BaseEventArgs{constructor(e,t,n){super(),this.conversation=e,this.alert=t,this.mustAcknowledge=n}}},function(e,t,n){"use strict";n.r(t),Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,function(n,i){return Array.isArray(i)?n.push.apply(n,e.call(i,t-1)):n.push(i),n},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0})},function(e,t,n){e.exports=function(){"use strict";var e=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var n=Object.prototype.toString.call(e);return"[object RegExp]"===n||"[object Date]"===n||function(e){return e.$$typeof===t}(e)}(e)},t="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function n(e,t){return!1!==t.clone&&t.isMergeableObject(e)?r(function(e){return Array.isArray(e)?[]:{}}(e),e,t):e}function i(e,t,i){return e.concat(t).map(function(e){return n(e,i)})}function o(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter(function(t){return e.propertyIsEnumerable(t)}):[]}(e))}function s(e,t,i){var s={};return i.isMergeableObject(e)&&o(e).forEach(function(t){s[t]=n(e[t],i)}),o(t).forEach(function(o){i.isMergeableObject(t[o])&&e[o]?s[o]=function(e,t){if(!t.customMerge)return r;var n=t.customMerge(e);return"function"==typeof n?n:r}(o,i)(e[o],t[o],i):s[o]=n(t[o],i)}),s}function r(t,o,r){(r=r||{}).arrayMerge=r.arrayMerge||i,r.isMergeableObject=r.isMergeableObject||e;var a=Array.isArray(o),l=Array.isArray(t),c=a===l;return c?a?r.arrayMerge(t,o,r):s(t,o,r):n(o,r)}return r.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(e,n){return r(e,n,t)},{})},r}()}]);